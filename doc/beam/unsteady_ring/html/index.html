<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: Large-amplitude non-axisymmetric oscillations of a thin-walled elastic ring</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Demo problem: Large-amplitude non-axisymmetric oscillations of a thin-walled elastic ring </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this document we discuss the solution of a time-dependent beam problem: The large-amplitude oscillations of a thin-walled elastic ring. Specifically we shall</p><ul>
<li>demonstrate how to specify initial conditions for time-dependent simulations with <code>oomph-lib's</code> <code>KirchhoffLoveBeam</code> elements,</li>
<li>demonstrate how to use the <code>dump/restart</code> functions for <code>KirchhoffLoveBeam</code> elements,</li>
<li>show that timesteppers from the <code>Newmark</code> family<ul>
<li>can be used with variable timesteps,</li>
<li>conserve energy,</li>
<li>can allocate and maintain storage for the solution at previous timesteps.</li>
</ul>
</li>
</ul>
<center> <table class="doxtable">
<tr>
<td><center> <b>Large-amplitude oscillations of a thin-walled elastic beam</b> </center><p class="intertd">We wish to compute the large-amplitude oscillations of a linearly-elastic, circular ring of undeformed radius <img class="formulaInl" alt="$ R_0 $" src="form_0.png" width="14" height="13"/> and wall thickness <img class="formulaInl" alt="$ h^* $" src="form_1.png" width="11" height="10"/> , subject to a transient pressure load </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ p_{ext}\left(\xi ,t \right) = \left\{ \begin{array}{ll} -P_{cos}\cos\left(2\xi\right) &amp; \mbox{for $t&lt;T_{kick}$} \\ 0 &amp; \mbox{for $t&gt;T_{kick}$} \end{array} \right. \mbox{\ \ \ \ \ \ \ \ \ \ (1) } \]" src="form_2.png" width="304" height="31"/>
</p>
<p> which initiates an oscillation in which the ring deforms into a non-axisymmetric mode, as indicated in the sketch below:</p>
<div class="image">
<img src="ring_sketch.gif" alt=""/>
<div class="caption">
Sketch of the buckling ring. </div></div>
 <p class="intertd">We choose the same non-dimensionalisation as in <a href="../../steady_ring/html/index.html">the previous steady example</a> and parametrise the position vector to the ring's undeformed centreline as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf r}_w(\xi) = {\bf R}_w(\xi,t=0) = \left( \begin{array}{c} \cos(\xi) \\ \sin(\xi) \end{array} \right), \]" src="form_3.png" width="199" height="31"/>
</p>
<p> where the non-dimensional arclength <img class="formulaInl" alt="$ \xi \in [0,2\pi] $" src="form_4.png" width="54" height="14"/> along the ring's undeformed centreline acts as the Lagrangian coordinate. Assuming that the ring is at rest for <img class="formulaInl" alt="$ t\le 0 $" src="form_5.png" width="29" height="11"/> , we wish to compute the position vector to the deformed ring's centreline, <img class="formulaInl" alt="$ {\bf R}_w(\xi,t) $" src="form_6.png" width="45" height="14"/> , for <img class="formulaInl" alt="$ t &gt; 0 $" src="form_7.png" width="29" height="10"/> .</p>
<p class="endtd"></p>
</td></tr>
</table>
<br  />
 </center><p> <br  />
</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="results"></a>
Results</h1>
<p>The figure below shows a snapshot, taken from <a href="../figures/unsteady_ring.avi">an animation of the ring's computed deformation </a> for a wall thickness of <img class="formulaInl" alt="$ h^*/R_0 = 1/20$" src="form_8.png" width="76" height="14"/> , a pressure load of <img class="formulaInl" alt="$ p_{cos} = 1.0 \times 10^{-4}$" src="form_9.png" width="95" height="14"/> , and <img class="formulaInl" alt="$ T_{kick} = 15 $" src="form_10.png" width="56" height="11"/> . The arrows represent the instantaneous velocity of the ring and show that at this point in time the ring is still collapsing inwards.</p>
<div class="image">
<img src="unsteady_ring.gif" alt=""/>
<div class="caption">
Shape and velocity of the ring. </div></div>
 <p>The red line with square markers in the figure below shows the time-history of the ring's control displacement: At <img class="formulaInl" alt="$ t=0 $" src="form_11.png" width="29" height="9"/> the ring is in its initial undeformed configuration and we have <img class="formulaInl" alt="$ R_{ctrl} = 1 $" src="form_12.png" width="49" height="13"/> . Application of the cosinusoidal pressure load during the interval <img class="formulaInl" alt="$ 0 &lt; t &lt; T_{kick} = 15 $" src="form_13.png" width="101" height="11"/> causes the ring to deform non-axisymmetrically in the mode shape shown in the plot above. Because of inertia, the ring continues to collapse inwards even after the pressure load has been "switched off". The ring reaches its most strongly collapsed configuration, in which the radius of the control point is reduced to just above 20% of its original value, at <img class="formulaInl" alt="$ t \approx 50 $" src="form_14.png" width="35" height="9"/> . Subsequently, the elastic restoring forces cause the ring to "reopen" to its axisymmetric configuration (where <img class="formulaInl" alt="$ R_{ctrl}=1 $" src="form_15.png" width="49" height="13"/> again), which it traverses with finite velocity at <img class="formulaInl" alt="$ t \approx 100 $" src="form_16.png" width="41" height="9"/> . The ring overshoots the axisymmetric state and deforms in the "opposite" direction to the deformation during the initial stages of collapse. It reverses its motion again when it reaches a second non-axisymmetric extreme at <img class="formulaInl" alt="$ t \approx 150 $" src="form_17.png" width="41" height="9"/> . This is seen most clearly in the <a href="../figures/unsteady_ring.avi">animation of the ring's motion. </a></p>
<div class="image">
<img src="trace_file.gif" alt=""/>
<div class="caption">
Plot of the control radius, the kinetic and potential (=strain) energy and their sum. </div></div>
 <p>The remaining lines in the plot show the ring's kinetic and potential (i.e. the strain) energy and their sum. Up to <img class="formulaInl" alt="$ t = T_{kick} $" src="form_18.png" width="49" height="11"/> , the external load does work on the ring and increases its kinetic and potential (strain) energy. Once the external load is "switched off" the total energy stored in the system should (and indeed does) remain constant. See the section <a class="el" href="index.html#energies">The default non-dimensionalisation for the kinetic and potential (strain) energies</a> for further details.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="namespace"></a>
Global parameters and functions</h1>
<p>As usual, we employ a namespace to define the problem's physical parameters and the load that acts on the ring. For the pressure loading defined in equation (1), the load is given by </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mathbf{f} = -P_{cos}\cos\left(2\xi\right)\mathbf{N}, \]" src="form_19.png" width="114" height="14"/>
</p>
<p> where <img class="formulaInl" alt="$ \mathbf{N} $" src="form_20.png" width="13" height="10"/> is the outer unit normal to the ring's deformed centreline.</p>
 <div class="fragment"><div class="line"><span class="comment">//====start_of_namespace============================</span></div>
<div class="line"><span class="comment">/// Namespace for global parameters</span></div>
<div class="line"><span class="comment"></span><span class="comment">//==================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Perturbation pressure</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#ab55734aaa66260cd9d4bf68a4ecafdd5">Pcos</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Duration of transient load</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a8a2c0589daf61085e7ebec410cbbbc76">T_kick</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Load function: Perturbation pressure to force non-axisymmetric deformation</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a86fd8f502cb8c4c7939ffae742f023eb">press_load</a>(<span class="keyword">const</span> Vector&lt;double&gt;&amp; xi,</div>
<div class="line">                 <span class="keyword">const</span> Vector&lt;double&gt; &amp;x,</div>
<div class="line">                 <span class="keyword">const</span> Vector&lt;double&gt;&amp; N,</div>
<div class="line">                 Vector&lt;double&gt;&amp; load)</div>
<div class="line"> {</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;2;i++) </div>
<div class="line">   {</div>
<div class="line">    load[i] = -<a class="code" href="namespaceGlobal__Physical__Variables.html#ab55734aaa66260cd9d4bf68a4ecafdd5">Pcos</a>*cos(2.0*xi[0])*N[i];</div>
<div class="line">   }</div>
<div class="line"> } <span class="comment">//end of load</span></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div><div class="ttdoc">///////////////////////////////////////////////////////////////////// ///////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="lin__unsteady__ring_8cc_source.html#l00045">lin_unsteady_ring.cc:46</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a86fd8f502cb8c4c7939ffae742f023eb"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a86fd8f502cb8c4c7939ffae742f023eb">Global_Physical_Variables::press_load</a></div><div class="ttdeci">void press_load(const Vector&lt; double &gt; &amp;xi, const Vector&lt; double &gt; &amp;x, const Vector&lt; double &gt; &amp;N, Vector&lt; double &gt; &amp;load)</div><div class="ttdoc">Load function: Perturbation pressure to force non-axisymmetric deformation.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00060">unsteady_ring.cc:60</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a8a2c0589daf61085e7ebec410cbbbc76"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a8a2c0589daf61085e7ebec410cbbbc76">Global_Physical_Variables::T_kick</a></div><div class="ttdeci">double T_kick</div><div class="ttdoc">Duration of transient load.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00057">unsteady_ring.cc:57</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_ab55734aaa66260cd9d4bf68a4ecafdd5"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#ab55734aaa66260cd9d4bf68a4ecafdd5">Global_Physical_Variables::Pcos</a></div><div class="ttdeci">double Pcos</div><div class="ttdoc">Perturbation pressure.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00054">unsteady_ring.cc:54</a></div></div>
</div><!-- fragment --><p> We also define the non-dimensional wall thickness <img class="formulaInl" alt="$ h $" src="form_21.png" width="8" height="10"/> and the timescale ratio <img class="formulaInl" alt="$ \Lambda^2 $" src="form_22.png" width="15" height="11"/>. These are multiplied by powers of a scaling factor whose role will become apparent in the <a class="el" href="index.html#exercises">Exercises</a>. (By default, the scaling factor is set to 1.0 and does not play any role.)</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Scaling factor for wall thickness (to be used in an exercise)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#aa2e802ee7cc8e1ac900ba94c3ce86eb7">Alpha</a>=1.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Wall thickness -- 1/20 for default value of scaling factor</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">H</a>=<a class="code" href="namespaceGlobal__Physical__Variables.html#aa2e802ee7cc8e1ac900ba94c3ce86eb7">Alpha</a>*1.0/20.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Square of timescale ratio (i.e. non-dimensional density)  </span></div>
<div class="line"><span class="comment"> /// -- 1.0 for default value of scaling factor</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a6fe17557ceb32dd353827fba60408363">Lambda_sq</a>=pow(<a class="code" href="namespaceGlobal__Physical__Variables.html#aa2e802ee7cc8e1ac900ba94c3ce86eb7">Alpha</a>,2);</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of namespace</span></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a6fe17557ceb32dd353827fba60408363"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a6fe17557ceb32dd353827fba60408363">Global_Physical_Variables::Lambda_sq</a></div><div class="ttdeci">double Lambda_sq</div><div class="ttdoc">Square of timescale ratio (i.e. non-dimensional density)   – 1.0 for default value of scaling factor.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00080">unsteady_ring.cc:80</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_aa2e802ee7cc8e1ac900ba94c3ce86eb7"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#aa2e802ee7cc8e1ac900ba94c3ce86eb7">Global_Physical_Variables::Alpha</a></div><div class="ttdeci">double Alpha</div><div class="ttdoc">Scaling factor for wall thickness (to be used in an exercise)</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00073">unsteady_ring.cc:73</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_af6e07423e22c0991084d9a2f43727805"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a></div><div class="ttdeci">double H</div><div class="ttdoc">Wall thickness – 1/20 for default value of scaling factor.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00076">unsteady_ring.cc:76</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="main"></a>
The driver code</h1>
<p>The main function is very simple. We store the (up to) two optional command line arguments which (if present) specify (i) a flag that indicates if the code is run in validation mode, and (ii) the name of a restart file.</p>
<div class="fragment"><div class="line"><span class="comment">//===start_of_main=====================================================</span></div>
<div class="line"><span class="comment">/// Driver for oscillating ring problem </span></div>
<div class="line"><span class="comment"></span><span class="comment">//=====================================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="unsteady__ring_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Store command line arguments</span></div>
<div class="line"> CommandLineArgs::setup(argc,argv);</div>
<div class="ttc" id="aunsteady__ring_8cc_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="unsteady__ring_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdoc">Driver for oscillating ring problem.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00549">unsteady_ring.cc:549</a></div></div>
</div><!-- fragment --><p> Next, we build the problem with thirteen <code>HermiteBeamElements</code> and a <code>Newmark&lt;3&gt;</code> timestepper ( <a href="../../../linear_wave/two_d_linear_wave/html/index.html#IC">recall </a> that a <code>Newmark&lt;NSTEPS&gt;</code> timestepper allocates and manages storage for the solution at <code>NSTEPS</code> previous timesteps; we shall illustrate this capability in the section <a class="el" href="index.html#prev">How to retrieve the solution at previous timesteps</a> ), before executing the timestepping loop.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Number of elements</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nelem = 13;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Set up the problem</span></div>
<div class="line"> <a class="code" href="classElasticRingProblem.html">ElasticRingProblem&lt;HermiteBeamElement,Newmark&lt;3&gt;</a> &gt; problem(nelem);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Do unsteady run</span></div>
<div class="line"> problem.unsteady_run();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of main</span></div>
<div class="ttc" id="aclassElasticRingProblem_html"><div class="ttname"><a href="classElasticRingProblem.html">ElasticRingProblem</a></div><div class="ttdoc">////////////////////////////////////////////////////////////////// //////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="lin__unsteady__ring_8cc_source.html#l00071">lin_unsteady_ring.cc:72</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="problem"></a>
The problem class</h1>
<p>The problem class is very similar to that used in the <a href="../../steady_ring/html/index.html">previous, steady example</a> , but includes a few (obvious) additional functions that specify the initial conditions (<a class="el" href="index.html#IC">Setting the initial condition</a>) and perform the timestepping (<a class="el" href="index.html#unsteady_run">The timestepping loop</a>). We also provide two functions that allow us to dump the solution to disk (<a class="el" href="index.html#dump">Writing a restart file</a>) and to restart the time-dependent simulation (<a class="el" href="index.html#restart">Restarting from a file</a>).</p>
 <div class="fragment"><div class="line"><span class="comment">//===start_of_problem_class=============================================</span></div>
<div class="line"><span class="comment">/// Ring problem</span></div>
<div class="line"><span class="comment"></span><span class="comment">//======================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT, <span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classElasticRingProblem.html">ElasticRingProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor: Number of elements</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classElasticRingProblem.html#a57be33a379c1ec4418a7fb3e8db8ef2b">ElasticRingProblem</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; n_element);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function for the specific mesh</span></div>
<div class="line"><span class="comment"></span> OneDLagrangianMesh&lt;ELEMENT&gt;* <a class="code" href="classElasticRingProblem.html#a763200d4985bca4a120f2be2a217f4a8">mesh_pt</a>() </div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">return</span> <span class="keyword">dynamic_cast&lt;</span>OneDLagrangianMesh&lt;ELEMENT&gt;*<span class="keyword">&gt;</span>(Problem::mesh_pt());</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update function is empty </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#ab0eb0dcecfa7e9c9e52ecf319f6e873e">actions_after_newton_solve</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update function is empty </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#aac5f3adac1e1a42492bd428eeb732a3d">actions_before_newton_solve</a>() {}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Setup initial conditions</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#ab435f36b59e5f76301123c3440363704">set_initial_conditions</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#a9aa904e4cf82d45711f890cd8440ced9">doc_solution</a>(DocInfo&amp; doc_info);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Do unsteady run</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#acd30c4363ffedbaadc1523aa8b85523b">unsteady_run</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Dump problem-specific parameter values, then dump</span></div>
<div class="line"><span class="comment"> /// generic problem data.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#a5d932c03b49cb7fe4da256a5c3c9be26">dump_it</a>(ofstream&amp; dump_file);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Read problem-specific parameter values, then recover</span></div>
<div class="line"><span class="comment"> /// generic problem data.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#a0b7d864f52a18bb2a9f3a2378d8b02aa">restart</a>(ifstream&amp; restart_file);</div>
<div class="ttc" id="aclassElasticRingProblem_html_a0b7d864f52a18bb2a9f3a2378d8b02aa"><div class="ttname"><a href="classElasticRingProblem.html#a0b7d864f52a18bb2a9f3a2378d8b02aa">ElasticRingProblem::restart</a></div><div class="ttdeci">void restart(ifstream &amp;restart_file)</div><div class="ttdoc">Read problem-specific parameter values, then recover generic problem data.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00347">unsteady_ring.cc:347</a></div></div>
<div class="ttc" id="aclassElasticRingProblem_html_a57be33a379c1ec4418a7fb3e8db8ef2b"><div class="ttname"><a href="classElasticRingProblem.html#a57be33a379c1ec4418a7fb3e8db8ef2b">ElasticRingProblem::ElasticRingProblem</a></div><div class="ttdeci">ElasticRingProblem(const unsigned &amp;N, const double &amp;L)</div><div class="ttdoc">Constructor: Number of elements, length of domain, flag for setting Newmark IC directly or consistent...</div><div class="ttdef"><b>Definition:</b> <a href="lin__unsteady__ring_8cc_source.html#l00127">lin_unsteady_ring.cc:128</a></div></div>
<div class="ttc" id="aclassElasticRingProblem_html_a5d932c03b49cb7fe4da256a5c3c9be26"><div class="ttname"><a href="classElasticRingProblem.html#a5d932c03b49cb7fe4da256a5c3c9be26">ElasticRingProblem::dump_it</a></div><div class="ttdeci">void dump_it(ofstream &amp;dump_file)</div><div class="ttdoc">Dump problem-specific parameter values, then dump generic problem data.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00325">unsteady_ring.cc:325</a></div></div>
<div class="ttc" id="aclassElasticRingProblem_html_a763200d4985bca4a120f2be2a217f4a8"><div class="ttname"><a href="classElasticRingProblem.html#a763200d4985bca4a120f2be2a217f4a8">ElasticRingProblem::mesh_pt</a></div><div class="ttdeci">OneDLagrangianMesh&lt; ELEMENT &gt; * mesh_pt()</div><div class="ttdoc">Access function for the mesh.</div><div class="ttdef"><b>Definition:</b> <a href="lin__unsteady__ring_8cc_source.html#l00081">lin_unsteady_ring.cc:81</a></div></div>
<div class="ttc" id="aclassElasticRingProblem_html_a9aa904e4cf82d45711f890cd8440ced9"><div class="ttname"><a href="classElasticRingProblem.html#a9aa904e4cf82d45711f890cd8440ced9">ElasticRingProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(DocInfo &amp;doc_info)</div><div class="ttdoc">Doc solution.</div><div class="ttdef"><b>Definition:</b> <a href="lin__unsteady__ring_8cc_source.html#l00213">lin_unsteady_ring.cc:213</a></div></div>
<div class="ttc" id="aclassElasticRingProblem_html_aac5f3adac1e1a42492bd428eeb732a3d"><div class="ttname"><a href="classElasticRingProblem.html#aac5f3adac1e1a42492bd428eeb732a3d">ElasticRingProblem::actions_before_newton_solve</a></div><div class="ttdeci">void actions_before_newton_solve()</div><div class="ttdoc">Update function is empty.</div><div class="ttdef"><b>Definition:</b> <a href="lin__unsteady__ring_8cc_source.html#l00090">lin_unsteady_ring.cc:90</a></div></div>
<div class="ttc" id="aclassElasticRingProblem_html_ab0eb0dcecfa7e9c9e52ecf319f6e873e"><div class="ttname"><a href="classElasticRingProblem.html#ab0eb0dcecfa7e9c9e52ecf319f6e873e">ElasticRingProblem::actions_after_newton_solve</a></div><div class="ttdeci">void actions_after_newton_solve()</div><div class="ttdoc">Update function is empty.</div><div class="ttdef"><b>Definition:</b> <a href="lin__unsteady__ring_8cc_source.html#l00087">lin_unsteady_ring.cc:87</a></div></div>
<div class="ttc" id="aclassElasticRingProblem_html_ab435f36b59e5f76301123c3440363704"><div class="ttname"><a href="classElasticRingProblem.html#ab435f36b59e5f76301123c3440363704">ElasticRingProblem::set_initial_conditions</a></div><div class="ttdeci">void set_initial_conditions()</div><div class="ttdoc">Setup initial conditions.</div><div class="ttdef"><b>Definition:</b> <a href="unsteady__ring_8cc_source.html#l00380">unsteady_ring.cc:380</a></div></div>
<div class="ttc" id="aclassElasticRingProblem_html_acd30c4363ffedbaadc1523aa8b85523b"><div class="ttname"><a href="classElasticRingProblem.html#acd30c4363ffedbaadc1523aa8b85523b">ElasticRingProblem::unsteady_run</a></div><div class="ttdeci">void unsteady_run()</div><div class="ttdoc">Do unsteady run.</div><div class="ttdef"><b>Definition:</b> <a href="lin__unsteady__ring_8cc_source.html#l00320">lin_unsteady_ring.cc:320</a></div></div>
</div><!-- fragment --><p> The private member data includes an output stream that we shall use to write a trace file. The two boolean flags indicate if the code is run in validation mode, and if the simulation has been restarted, respectively.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Trace file for recording control data</span></div>
<div class="line"><span class="comment"></span> ofstream Trace_file;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Flag for validation run: Default: 0 = no validation run</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">unsigned</span> Validation_run_flag;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Restart flag specified via command line?</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">bool</span> Restart_flag;</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// end of problem class</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="constructor"></a>
The problem constructor</h1>
<p>The constructor assigns default values for the two control flags corresponding to a non-validation run without restart. We create a timestepper of the type specified by the template parameter and add it to the <code>Problem's</code> collection of timesteppers.</p>
<div class="fragment"><div class="line"><span class="comment">//===start_of_constructor===============================================</span></div>
<div class="line"><span class="comment">/// Constructor for elastic ring problem</span></div>
<div class="line"><span class="comment"></span><span class="comment">//======================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT,<span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><a class="code" href="classElasticRingProblem.html#a57be33a379c1ec4418a7fb3e8db8ef2b">ElasticRingProblem&lt;ELEMENT,TIMESTEPPER&gt;::ElasticRingProblem</a></div>
<div class="line">(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; n_element) :</div>
<div class="line"> Validation_run_flag(0), <span class="comment">//default: false</span></div>
<div class="line"> Restart_flag(false)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create the timestepper and add it to the Problem&#39;s collection of</span></div>
<div class="line"> <span class="comment">// timesteppers -- this creates the Problem&#39;s Time object.</span></div>
<div class="line"> add_time_stepper_pt(<span class="keyword">new</span> TIMESTEPPER());</div>
</div><!-- fragment --><p> Next we build the geometric object that defines the shape of the ring's undeformed centreline (an ellipse with unit half axes, i.e. a unit circle) and use it to build the mesh. As in <a href="../../steady_ring/html/index.html">the previous steady example</a> we exploit the symmetry of the deformation and only discretise a quarter of the domain.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Undeformed beam is an ellipse with unit axes</span></div>
<div class="line"> GeomObject* undef_geom_pt=<span class="keyword">new</span> Ellipse(1.0,1.0); </div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Length of domain</span></div>
<div class="line"> <span class="keywordtype">double</span> length = MathematicalConstants::Pi/2.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Now create the (Lagrangian!) mesh</span></div>
<div class="line"> Problem::mesh_pt() = <span class="keyword">new</span> OneDLagrangianMesh&lt;ELEMENT&gt;(</div>
<div class="line">  n_element,length,undef_geom_pt,Problem::time_stepper_pt()); </div>
</div><!-- fragment --><p> The boundary conditions are identical to those in <a href="../../steady_ring/html/index.html">the steady example</a>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Boundary condition: </span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Bottom: </span></div>
<div class="line"> <span class="keywordtype">unsigned</span> ibound=0;</div>
<div class="line"> <span class="comment">// No vertical displacement</span></div>
<div class="line"> mesh_pt()-&gt;boundary_node_pt(ibound,0)-&gt;pin_position(1); </div>
<div class="line"> <span class="comment">// Zero slope: Pin type 1 (slope) dof for displacement direction 0 </span></div>
<div class="line"> mesh_pt()-&gt;boundary_node_pt(ibound,0)-&gt;pin_position(1,0);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Top: </span></div>
<div class="line"> ibound=1;</div>
<div class="line"> <span class="comment">// No horizontal displacement</span></div>
<div class="line"> mesh_pt()-&gt;boundary_node_pt(ibound,0)-&gt;pin_position(0); </div>
<div class="line"> <span class="comment">// Zero slope: Pin type 1 (slope) dof for displacement direction 1</span></div>
<div class="line"> mesh_pt()-&gt;boundary_node_pt(ibound,0)-&gt;pin_position(1,1); </div>
</div><!-- fragment --><p> Finally, we pass the pointers to the load function and the pointer to the geometric object that specifies the ring's initial shape to the elements and assign the equation numbers.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Complete build of all elements so they are fully functional</span></div>
<div class="line"> <span class="comment">// -----------------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Loop over the elements to set physical parameters etc.</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_element;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Cast to proper element type</span></div>
<div class="line">   ELEMENT *elem_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(mesh_pt()-&gt;element_pt(i));</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Pass pointer to square of timescale ratio (non-dimensional density)</span></div>
<div class="line">   elem_pt-&gt;lambda_sq_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#a6fe17557ceb32dd353827fba60408363">Global_Physical_Variables::Lambda_sq</a>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Pass pointer to non-dimensional wall thickness</span></div>
<div class="line">   elem_pt-&gt;h_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Function that specifies load vector</span></div>
<div class="line">   elem_pt-&gt;load_vector_fct_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#a86fd8f502cb8c4c7939ffae742f023eb">Global_Physical_Variables::press_load</a>;</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Assign the undeformed surface</span></div>
<div class="line">   elem_pt-&gt;undeformed_beam_pt() = undef_geom_pt;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Do equation numbering</span></div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;# of dofs &quot;</span> &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of constructor</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="doc"></a>
Post-processing</h1>
<p>We compute the total kinetic and potential (=strain) energies stored in the (quarter-)ring and document them, their sum, and the control radius in the trace file.</p>
<div class="fragment"><div class="line"><span class="comment">//====start_of_doc_solution===============================================</span></div>
<div class="line"><span class="comment">/// Document solution</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT, <span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#a9aa904e4cf82d45711f890cd8440ced9">ElasticRingProblem&lt;ELEMENT, TIMESTEPPER&gt;::doc_solution</a>(</div>
<div class="line"> DocInfo&amp; doc_info)</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;Doc-ing step &quot;</span> &lt;&lt;  doc_info.number()</div>
<div class="line">      &lt;&lt; <span class="stringliteral">&quot; for time &quot;</span> &lt;&lt; time_stepper_pt()-&gt;time_pt()-&gt;time() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over all elements to get global kinetic and potential energy</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_elem=mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordtype">double</span> global_kin=0;</div>
<div class="line"> <span class="keywordtype">double</span> global_pot=0;</div>
<div class="line"> <span class="keywordtype">double</span> pot,kin;</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ielem=0;ielem&lt;n_elem;ielem++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(mesh_pt()-&gt;element_pt(ielem))-&gt;get_energy(pot,kin);</div>
<div class="line">   global_kin+=kin;</div>
<div class="line">   global_pot+=pot;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Get pointer to last element to document displacement</span></div>
<div class="line"> FiniteElement* trace_elem_pt=mesh_pt()-&gt;finite_element_pt(n_elem-1);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Vector of local coordinates at control point</span></div>
<div class="line"> Vector&lt;double&gt; s_trace(1);</div>
<div class="line"> s_trace[0]=1.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Write trace file: Time, control position, energies</span></div>
<div class="line"> Trace_file &lt;&lt; time_pt()-&gt;time()  &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; trace_elem_pt-&gt;interpolated_x(s_trace,1) </div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; global_pot  &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; global_kin</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; global_pot + global_kin</div>
<div class="line">            &lt;&lt; std::endl; <span class="comment">// end of output to trace file</span></div>
</div><!-- fragment --><p> Next we use the default output function to document the ring shape and add a few tecplot commands to facilitate the animation of the results.</p>
<div class="fragment"><div class="line">  </div>
<div class="line"> ofstream some_file;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line">  </div>
<div class="line"> <span class="comment">// Number of plot points</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> npts=5;</div>
<div class="line">  </div>
<div class="line"> <span class="comment">// Output solution </span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/ring%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> mesh_pt()-&gt;output(some_file,npts);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Write file as a tecplot text object</span></div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot;TEXT X=2.5,Y=93.6,F=HELV,HU=POINT,C=BLUE,H=26,T=\&quot;time = &quot;</span> </div>
<div class="line">           &lt;&lt; time_pt()-&gt;time() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// ...and draw a horizontal line whose length is proportional</span></div>
<div class="line"> <span class="comment">// to the elapsed time</span></div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot;GEOMETRY X=2.5,Y=98,T=LINE,C=BLUE,LT=0.4&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot;1&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot;2&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot; 0 0&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file &lt;&lt; time_pt()-&gt;time()*20.0 &lt;&lt; <span class="stringliteral">&quot; 0&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file.close();</div>
</div><!-- fragment --> <h2><a class="anchor" id="prev"></a>
How to retrieve the solution at previous timesteps</h2>
<p>The next few lines illustrate how to retrieve (and document) the ring shape at previous timesteps. <a href="../../../linear_wave/two_d_linear_wave/html/index.html#IC">Recall </a> that <code>Newmark</code> timesteppers are implicit, single-step timestepping schemes that compute approximations for the time-derivatives, based on the solution at the current time level, and on "history values" that represent quantities at a single previous timestep. In some applications (particularly in fluid-structure interaction problems) it is necessary to keep track of the solution at additional previous timesteps. Storage for such additional history values is allocated (and managed) by the generalised <code>Newmark&lt;NSTEPS&gt;</code> timesteppers if <code>NSTEPS</code> &gt; 1. We stress that these additional history values are not involved in the approximation of the time-derivatives; they are simply stored and updated by the timestepper when the solution is advanced to the next timestep.</p>
<p><a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html#IC">Recall </a> also that the member function <code>TimeStepper::nprev_values()</code> may be used to determine how many of the history values that are stored in an associated <code>Data</code> object represent the solution at previous timesteps. Finally, <a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html#IC">recall </a> that history values that represent the solution at previous timesteps are always stored before those that represent "generalised" history values (such as approximations of the first time-derivative at the previous timestep, etc). It is therefore always possible to determine how many previous solutions are stored in a <code>Data</code> object, and where they are stored.</p>
<p>To document the shape of a <code>HermiteBeamElement</code> at a previous timestep, the <code>HermiteBeamElement</code> provides an additional three-argument output function that may be called as follows:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over all elements do dump out previous solutions</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nsteps=time_stepper_pt()-&gt;nprev_values();</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> t=0;t&lt;=nsteps;t++)</div>
<div class="line">  {     </div>
<div class="line">   sprintf(filename,<span class="stringliteral">&quot;%s/ring%i-%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">           doc_info.number(),t);</div>
<div class="line">   some_file.open(filename);</div>
<div class="line">   <span class="keywordtype">unsigned</span> n_elem=mesh_pt()-&gt;nelement();</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ielem=0;ielem&lt;n_elem;ielem++)</div>
<div class="line">    {</div>
<div class="line">     <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(mesh_pt()-&gt;element_pt(ielem))-&gt;</div>
<div class="line">      output(t,some_file,npts);</div>
<div class="line">    }</div>
<div class="line">   some_file.close();</div>
<div class="line">  } <span class="comment">// end of output of previous solutions</span></div>
</div><!-- fragment --><p> At timestep <code>t</code>, these statements create the output files <code>RESLT/ring</code> t<code>-0<code></code>.dat</code>, <code>RESLT/ring</code> t<code>-1<code></code>.dat</code>, <code>RESLT/ring</code> t<code>-2<code></code>.dat</code>, <code>RESLT/ring</code> t<code>-3<code></code>.dat</code>, which contain the shape of the ring at the <code>t</code> -th, ( <code>t</code> -1)th, ( <code>t</code> -2)th and <br  />
 ( <code>t</code> -3)th, timestep, respectively.</p>
<p>Finally, we write a restart file that will allow us to restart the simulation.</p>
<div class="fragment"><div class="line">  </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Write restart file</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/ring_restart%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> dump_it(some_file);</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line">       </div>
<div class="line">} <span class="comment">// end of doc solution</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="dump"></a>
Writing a restart file</h1>
<p>Writing the restart file for the present problem is as easy as in the previous examples, as the generic <code>Problem</code> data may again be written with the <code>Problem::dump(...)</code> function. We customise the restart file slightly by adding the value <img class="formulaInl" alt="$ p_{cos} $" src="form_23.png" width="21" height="9"/> and the flag that indicates if the code is run in validation mode.</p>
<div class="fragment"><div class="line"><span class="comment">//===start_of_dump_it====================================================</span></div>
<div class="line"><span class="comment">/// Dump problem-specific parameter values, then dump</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// generic problem data.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT,<span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#a5d932c03b49cb7fe4da256a5c3c9be26">ElasticRingProblem&lt;ELEMENT,TIMESTEPPER&gt;::dump_it</a>(ofstream&amp; dump_file)</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">  </div>
<div class="line"> <span class="comment">// Write Pcos</span></div>
<div class="line"> dump_file &lt;&lt; <a class="code" href="namespaceGlobal__Physical__Variables.html#ab55734aaa66260cd9d4bf68a4ecafdd5">Global_Physical_Variables::Pcos</a> &lt;&lt; <span class="stringliteral">&quot; # Pcos&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Write validation run flag</span></div>
<div class="line"> dump_file &lt;&lt; Validation_run_flag </div>
<div class="line">           &lt;&lt; <span class="stringliteral">&quot; # Validation run flag&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Call generic dump()</span></div>
<div class="line"> Problem::dump(dump_file);</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of dump it</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="restart"></a>
Restarting from a file</h1>
<p>The restart operation reverses the steps performed in the dump function: We recover the two problem-specific parameters and then read the generic <code>Problem</code> data with the <code>Problem::read(...)</code> function.</p>
<div class="fragment"><div class="line"><span class="comment">//==start_of_restart=====================================================</span></div>
<div class="line"><span class="comment">/// Read problem-specific parameter values, then recover</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// generic problem data.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT,<span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#a0b7d864f52a18bb2a9f3a2378d8b02aa">ElasticRingProblem&lt;ELEMENT,TIMESTEPPER&gt;::restart</a>(ifstream&amp; restart_file)</div>
<div class="line">{</div>
<div class="line">  </div>
<div class="line"> <span class="keywordtype">string</span> input_string;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Read line up to termination sign</span></div>
<div class="line"> getline(restart_file,input_string,<span class="charliteral">&#39;#&#39;</span>);</div>
<div class="line"> <span class="comment">// Ignore rest of line</span></div>
<div class="line"> restart_file.ignore(80,<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"> <span class="comment">// Read in pcos</span></div>
<div class="line"> <a class="code" href="namespaceGlobal__Physical__Variables.html#ab55734aaa66260cd9d4bf68a4ecafdd5">Global_Physical_Variables::Pcos</a>=atof(input_string.c_str());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Read line up to termination sign</span></div>
<div class="line"> getline(restart_file,input_string,<span class="charliteral">&#39;#&#39;</span>);</div>
<div class="line"> <span class="comment">// Ignore rest of line</span></div>
<div class="line"> restart_file.ignore(80,<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"> <span class="comment">// Read in Long run flag</span></div>
<div class="line"> Validation_run_flag=</div>
<div class="line">  unsigned(atof(input_string.c_str()));</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Call generic read()</span></div>
<div class="line"> Problem::read(restart_file);</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of restart</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="IC"></a>
Setting the initial condition</h1>
<p>The assignment of initial conditions depends on whether or not a restart from a previous computation is performed. If no restart is performed, we specify the initial timestep, <code>dt</code>, and assign history values that are consistent with an impulsive start from the ring's initial shape.</p>
<div class="fragment"><div class="line"><span class="comment">//=====start_of_set_ic=====================================================</span></div>
<div class="line"><span class="comment">/// Setup initial conditions -- either restart from solution </span></div>
<div class="line"><span class="comment"></span><span class="comment">/// specified via command line or impulsive start. </span></div>
<div class="line"><span class="comment"></span><span class="comment">//=========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT,<span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#ab435f36b59e5f76301123c3440363704">ElasticRingProblem&lt;ELEMENT,TIMESTEPPER&gt;::set_initial_conditions</a>()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// No restart file --&gt; impulsive start from initial configuration</span></div>
<div class="line"> <span class="comment">// assigned in the Lagrangian mesh.</span></div>
<div class="line"> <span class="keywordflow">if</span> (!Restart_flag)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Set initial timestep</span></div>
<div class="line">   <span class="keywordtype">double</span> dt=1.0; </div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Assign impulsive start</span></div>
<div class="line">   assign_initial_values_impulsive(dt);</div>
<div class="line">  }</div>
</div><!-- fragment --><p> If the computation is restarted, the name of the restart file will have been specified on the command line. We try to open the restart file</p>
<div class="fragment"><div class="line"> <span class="comment">// Restart file specified via command line</span></div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Try to open restart file</span></div>
<div class="line">   ifstream* restart_file_pt= </div>
<div class="line">    <span class="keyword">new</span> ifstream(CommandLineArgs::Argv[2],ios_base::in);</div>
<div class="line">   <span class="keywordflow">if</span> (restart_file_pt!=0)</div>
<div class="line">    {</div>
<div class="line">     cout &lt;&lt; <span class="stringliteral">&quot;Have opened &quot;</span> &lt;&lt; CommandLineArgs::Argv[2] &lt;&lt; </div>
<div class="line">      <span class="stringliteral">&quot; for restart. &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
</div><!-- fragment --><p> and display an error message and terminate the program execution if the file cannot be opened.</p>
<div class="fragment"><div class="line">   <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">     std::ostringstream error_stream;</div>
<div class="line">     error_stream &lt;&lt; <span class="stringliteral">&quot;ERROR while trying to open &quot;</span> </div>
<div class="line">                  &lt;&lt; CommandLineArgs::Argv[2] </div>
<div class="line">                  &lt;&lt; <span class="stringliteral">&quot; for restart.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">     <span class="keywordflow">throw</span> OomphLibError(error_stream.str(),</div>
<div class="line">                         OOMPH_CURRENT_FUNCTION,</div>
<div class="line">                         OOMPH_EXCEPTION_LOCATION);</div>
<div class="line">    }</div>
</div><!-- fragment --><p> If the file can be opened we call the restart function which returns the the <code>Problem</code> into the state it was in when the restart file was written. No further steps are required.</p>
<div class="fragment"><div class="line"> </div>
<div class="line">   <span class="comment">// Read restart data:</span></div>
<div class="line">   restart(*restart_file_pt);</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of set ic</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="unsteady_run"></a>
The timestepping loop</h1>
<p>We start by converting the (optional) command line arguments into the flags that determine what mode the code is run in: Without command line arguments, we use the default assignments, as specified in <a class="el" href="index.html#constructor">The problem constructor</a>.</p>
<div class="fragment"><div class="line"><span class="comment">//===start_of_unsteady_run=================================================</span></div>
<div class="line"><span class="comment">/// Solver loop to perform unsteady run.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT,<span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classElasticRingProblem.html#acd30c4363ffedbaadc1523aa8b85523b">ElasticRingProblem&lt;ELEMENT,TIMESTEPPER&gt;::unsteady_run</a>()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Convert command line arguments (if any) into flags:</span></div>
<div class="line"> <span class="comment">//----------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::Argc&lt;2)</div>
<div class="line">  {</div>
<div class="line">   cout &lt;&lt; <span class="stringliteral">&quot;No command line arguments -- using defaults.&quot;</span> </div>
<div class="line">        &lt;&lt; std::endl;</div>
<div class="line">  }</div>
</div><!-- fragment --><p> A single command line argument is interpreted as the "validation run" flag (1 for true, 0 for false) which will be used to limit the number of timesteps.</p>
<div class="fragment"><div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CommandLineArgs::Argc==2)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Flag for validation run</span></div>
<div class="line">   Validation_run_flag=atoi(CommandLineArgs::Argv[1]);</div>
<div class="line">  }</div>
</div><!-- fragment --><p> The presence of two command line arguments indicates that a restart is performed. In this case the second argument specifies the name of the restart file.</p>
<div class="fragment"><div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CommandLineArgs::Argc==3)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Flag for validation run</span></div>
<div class="line">   Validation_run_flag=atoi(CommandLineArgs::Argv[1]);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Second argument is restart file. If it&#39;s there we&#39;re performing</span></div>
<div class="line">   <span class="comment">// a restart</span></div>
<div class="line">   Restart_flag=<span class="keyword">true</span>;</div>
<div class="line">  }</div>
</div><!-- fragment --><p> We print an error message if the code is run with any other number of command line arguments.</p>
<div class="fragment"><div class="line"> <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">   std::string error_message =</div>
<div class="line">    <span class="stringliteral">&quot;Wrong number of command line arguments. Specify two or fewer.\n&quot;</span>;</div>
<div class="line">   error_message += <span class="stringliteral">&quot;Arg1: Validation_run_flag [0/1] for [false/true]\n&quot;</span>;</div>
<div class="line">   error_message += <span class="stringliteral">&quot;Arg2: Name of restart_file (optional)\n&quot;</span>;</div>
<div class="line">   error_message += <span class="stringliteral">&quot;No arguments specified --&gt; default run\n&quot;</span>;</div>
<div class="line">   </div>
<div class="line">   <span class="keywordflow">throw</span> OomphLibError(error_message,</div>
<div class="line">                       OOMPH_CURRENT_FUNCTION,</div>
<div class="line">                       OOMPH_EXCEPTION_LOCATION);</div>
<div class="line">  }</div>
</div><!-- fragment --><p> We create a <code>DocInfo</code> object to specify the name of the output directory, and open the trace file.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Label for output</span></div>
<div class="line"> DocInfo doc_info;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output directory</span></div>
<div class="line"> doc_info.set_directory(<span class="stringliteral">&quot;RESLT&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Step number</span></div>
<div class="line"> doc_info.number()=0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set up trace file</span></div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/trace_ring.dat&quot;</span>,doc_info.directory().c_str());</div>
<div class="line"> Trace_file.open(filename);</div>
<div class="line"> </div>
<div class="line"> Trace_file &lt;&lt;  <span class="stringliteral">&quot;VARIABLES=\&quot;time\&quot;,\&quot;R&lt;sub&gt;ctrl&lt;/sub&gt;\&quot;,\&quot;E&lt;sub&gt;pot&lt;/sub&gt;\&quot;&quot;</span>;</div>
<div class="line"> Trace_file &lt;&lt; <span class="stringliteral">&quot;,\&quot;E&lt;sub&gt;kin&lt;/sub&gt;\&quot;,\&quot;E&lt;sub&gt;kin&lt;/sub&gt;+E&lt;sub&gt;pot&lt;/sub&gt;\&quot;&quot;</span> </div>
<div class="line">            &lt;&lt; std::endl;</div>
</div><!-- fragment --><p> Next, we set the problem parameters and the number of timesteps to be performed, before assigning the initial conditions.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Perturbation pressure -- incl. scaling factor (Alpha=1.0 by default)</span></div>
<div class="line"> <a class="code" href="namespaceGlobal__Physical__Variables.html#ab55734aaa66260cd9d4bf68a4ecafdd5">Global_Physical_Variables::Pcos</a>=1.0e-4</div>
<div class="line">  *pow(<a class="code" href="namespaceGlobal__Physical__Variables.html#aa2e802ee7cc8e1ac900ba94c3ce86eb7">Global_Physical_Variables::Alpha</a>,3); </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Duration of transient load</span></div>
<div class="line"> <a class="code" href="namespaceGlobal__Physical__Variables.html#a8a2c0589daf61085e7ebec410cbbbc76">Global_Physical_Variables::T_kick</a>=15.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of steps</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nstep=600; </div>
<div class="line"> <span class="keywordflow">if</span> (Validation_run_flag==1) {nstep=10;}</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup initial condition (either restart or impulsive start)</span></div>
<div class="line"> set_initial_conditions();</div>
</div><!-- fragment --><p> The timestepping loop itself is practically identical to that used in <a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html#main">driver codes for other unsteady problems</a>. To demonstrate that <code>Newmark</code> timesteppers can deal with variable timesteps, we reduce the timestep slightly after every step.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Extract initial timestep as set up in set_initial_conditions()</span></div>
<div class="line"> <span class="keywordtype">double</span> dt=time_pt()-&gt;dt();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output initial data</span></div>
<div class="line"> doc_solution(doc_info);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// If the run is restarted, dt() contains the size of the timestep</span></div>
<div class="line"> <span class="comment">// that was taken to reach the dumped solution. In a non-restarted run</span></div>
<div class="line"> <span class="comment">// the next step would have been taken with a slightly smaller </span></div>
<div class="line"> <span class="comment">// timestep (see below). For a restarted run we therefore adjust </span></div>
<div class="line"> <span class="comment">// the next timestep accordingly.</span></div>
<div class="line"> <span class="keywordflow">if</span> (Restart_flag&amp;&amp;(time_pt()-&gt;time()&gt;10.0)&amp;&amp;(time_pt()-&gt;time()&lt;100.0))</div>
<div class="line">  {</div>
<div class="line">   dt=0.995*dt;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Time integration loop</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=1;i&lt;=nstep;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Switch off perturbation pressure </span></div>
<div class="line">   <span class="keywordflow">if</span> (time_pt()-&gt;time()&gt;<a class="code" href="namespaceGlobal__Physical__Variables.html#a8a2c0589daf61085e7ebec410cbbbc76">Global_Physical_Variables::T_kick</a>) </div>
<div class="line">     {<span class="comment"></span></div>
<div class="line"><span class="comment">      /// Perturbation pressure</span></div>
<div class="line"><span class="comment"></span>      <a class="code" href="namespaceGlobal__Physical__Variables.html#ab55734aaa66260cd9d4bf68a4ecafdd5">Global_Physical_Variables::Pcos</a>=0.0; </div>
<div class="line">     }</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Solve</span></div>
<div class="line">   unsteady_newton_solve(dt);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Doc solution</span></div>
<div class="line">   doc_info.number()++;</div>
<div class="line">   doc_solution(doc_info);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Reduce timestep for the next solve</span></div>
<div class="line">   <span class="keywordflow">if</span> ((time_pt()-&gt;time()&gt;10.0)&amp;&amp;(time_pt()-&gt;time()&lt;100.0))</div>
<div class="line">    {</div>
<div class="line">     dt=0.995*dt;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of unsteady run</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="comments"></a>
Comments and Exercises</h1>
<h2><a class="anchor" id="timescale"></a>
The default non-dimensionalisation of time</h2>
<p>The non-dimensionalisation of the principle of virtual displacements that forms the basis of <code>oomph-lib's</code> beam elements, was discussed in detail in <a href="../../tensioned_string/html/index.html">an earlier example</a>. However, since this is the first time-dependent beam problem it is worth re-iterating that, by default, time is non-dimensionalised on the timescale for extensional deformations i.e. on the natural timescale </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\cal T}_{natural} = {\cal L} \sqrt{\frac{\rho}{E_{eff}}} \]" src="form_24.png" width="110" height="30"/>
</p>
<p> of oscillations in which the beam is stretched/compressed along its centreline. The relation between the dimensional time <img class="formulaInl" alt="$ t^* $" src="form_25.png" width="10" height="10"/> and its non-dimensional equivalent <img class="formulaInl" alt="$ t $" src="form_26.png" width="5" height="9"/> is given by </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ t^* = \underbrace{{\cal L} \sqrt{\frac{\rho}{E_{eff}}}}_{{\cal T}_{natural}} \ t, \]" src="form_27.png" width="91" height="49"/>
</p>
<p> where <img class="formulaInl" alt="$ {\cal L} $" src="form_28.png" width="10" height="10"/> is the lengthscale used to non-dimensionalise all lengths (in the present example <img class="formulaInl" alt="$ {\cal L} = R_0 $" src="form_29.png" width="40" height="13"/> , the undeformed radius of the ring), <img class="formulaInl" alt="$ \rho $" src="form_30.png" width="8" height="9"/> is the density of the ring, and <img class="formulaInl" alt="$ E_{eff} = E/(1-\nu^2)$" src="form_31.png" width="101" height="15"/> is the "effective" 1D Young's modulus of the beam, formed with its 3D Young's modulus <img class="formulaInl" alt="$ E $" src="form_32.png" width="10" height="9"/> , and its Poisson ratio <img class="formulaInl" alt="$ \nu $" src="form_33.png" width="6" height="6"/> .</p>
<p>This non-dimensionalisation of time is consistent with the non-dimensionalisation of all stresses/loads on <img class="formulaInl" alt="$ E_{eff}$" src="form_34.png" width="25" height="13"/>. It implies that if the beam deforms in a mode in which its deformation is dominated by bending effects, the numerical values for the non-dimensional load are relatively small (indicating that the loads required to induce a deformation of a given size are much smaller if the ring deforms in a bending-dominated mode, than in a mode in which it is dominated by extensional deformations), while the non-dimensional period of the oscillation is relatively large (indicating that bending oscillations occur at a much smaller frequency than oscillations in which the beam's deformation is dominated by extensional deformations). <br  />
</p>
<hr  />
<h2><a class="anchor" id="energies"></a>
The default non-dimensionalisation for the kinetic and potential (strain) energies</h2>
<p>With the default non-dimensionalisation discussed above, the non-dimensional kinetic and potential (strain) energies are given by </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Pi_{strain} = \frac{\Pi_{strain}^*}{{\cal L} \, h^* E_{eff} } = \frac{1}{2}\int \left( \gamma^2 + \frac{1}{12}\left(\frac{h^*}{{\cal L}}\right)^2 \kappa^2 \right) \ d \xi \]" src="form_35.png" width="289" height="39"/>
</p>
<p> and </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Pi_{kin} = \frac{\Pi_{kin}^*}{{\cal L} \, h^* E_{eff}} = \frac{1}{2} \int \frac{\partial {\bf R}_w}{\partial t} \cdot \frac{\partial {\bf R}_w}{\partial t} \ d \xi, \]" src="form_36.png" width="224" height="31"/>
</p>
<p> respectively. Conservation of energy implies that </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Pi_{kin} + \Pi_{strain} = const. \]" src="form_37.png" width="129" height="13"/>
</p>
<p> if there is no external forcing. The plot of the energies shown at the beginning of this document shows that the time-integration with the Newmark method is energy-conserving.</p>
<hr  />
 <h2><a class="anchor" id="change_T"></a>
Changing the timescale used to non-dimensionalise the equations</h2>
<p>It is possible to non-dimensionalise the governing equations on a different timescale, <img class="formulaInl" alt="$ {\cal T} $" src="form_38.png" width="11" height="11"/> , so that </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ t^* = {\cal T} \ t. \]" src="form_39.png" width="49" height="11"/>
</p>
<p> This is achieved by overwriting the default assignment for the ratio </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Lambda = \frac{{\cal T}_{natural}}{{\cal T}} = \frac{{\cal L}}{{\cal T}} \sqrt{\frac{\rho}{E_{eff}}}, \]" src="form_40.png" width="145" height="31"/>
</p>
<p> of the natural timescale <img class="formulaInl" alt="$ {\cal T}_{natural}$" src="form_41.png" width="43" height="13"/> and the time <img class="formulaInl" alt="$ {\cal T} $" src="form_38.png" width="11" height="11"/> used to non-dimensionalise the equations.</p>
<p>By default, we have <img class="formulaInl" alt="$ \Lambda = 1 $" src="form_42.png" width="33" height="10"/> but the member function </p><div class="fragment"><div class="line">KirchhoffLoveBeamEquations::lambda_sq_pt()</div>
</div><!-- fragment --><p> may be used to assign a different value for the <em>square</em> of the timescale ratio which may also be interpreted as the non-dimensional density. The case <img class="formulaInl" alt="$ \Lambda^2=0 $" src="form_43.png" width="38" height="11"/> therefore corresponds to the case of zero wall inertia. (We store <img class="formulaInl" alt="$ \Lambda^2 $" src="form_22.png" width="15" height="11"/> rather than <img class="formulaInl" alt="$ \Lambda $" src="form_44.png" width="10" height="10"/> itself because the governing equations contain only the square of the timescale ratio). As with most other physical parameters, <img class="formulaInl" alt="$ \Lambda^2 $" src="form_22.png" width="15" height="11"/> must be defined as a global variable, preferably by adding it to the namespace that contains the problem parameters, e.g.</p>
<div class="fragment"><div class="line"><span class="comment">//====start_of_namespace============================</span><span class="comment"></span></div>
<div class="line"><span class="comment">/// Namespace for global parameters</span></div>
<div class="line"><span class="comment"></span><span class="comment">//==================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Square of timescale ratio, i.e. the non-dimensional density</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a6fe17557ceb32dd353827fba60408363">Lambda_sq</a>=4.0;</div>
<div class="line"> </div>
<div class="line"> [...]</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of namespace</span></div>
</div><!-- fragment --><p>...and passing a pointer to <img class="formulaInl" alt="$ \Lambda^2 $" src="form_22.png" width="15" height="11"/> to the elements. The statement can be added to the loop over the elements that passes the pointer to the pressure load to the elements.</p>
<div class="fragment"><div class="line"><span class="comment">//Loop over the elements to set physical parameters etc.</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_element;i++)</div>
<div class="line"> {</div>
<div class="line">  <span class="comment">// Cast to proper element type</span></div>
<div class="line">  ELEMENT *elem_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(mesh_pt()-&gt;element_pt(i));</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Pass pointer to square of timescale ratio (non-dimensional density)</span></div>
<div class="line">  elem_pt-&gt;lambda_sq_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#a6fe17557ceb32dd353827fba60408363">Global_Physical_Variables::Lambda_sq</a>;</div>
<div class="line"> </div>
<div class="line">  [...]</div>
<div class="line"> </div>
<div class="line"> }</div>
</div><!-- fragment --><p>The definition of the non-dimensional kinetic energy used in <code>KirchhoffLoveBeamEquations::get_energy(...)</code> incorporates the timescale ratio by computing the non-dimensional kinetic energy as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Pi_{kin} = \frac{\Pi_{kin}^*}{{\cal L} \, h^* E_{eff}} = \frac{1}{2} \Lambda^2 \int \frac{\partial {\bf R}_w}{\partial t} \cdot \frac{\partial {\bf R}_w}{\partial t} \ d \xi \]" src="form_45.png" width="236" height="31"/>
</p>
<p> which, for the default assignment <img class="formulaInl" alt="$ \Lambda^2 = 1 $" src="form_46.png" width="38" height="11"/> , reduces to the definition given above. </p><hr  />
<h2><a class="anchor" id="exercises"></a>
Exercises</h2>
<ol type="1">
<li>As discussed in <a class="el" href="index.html#timescale">The default non-dimensionalisation of time</a> , the period of the oscillation ( <img class="formulaInl" alt="$ \approx 170 $" src="form_47.png" width="31" height="9"/> ) computed in the above example has a large numerical value because time was non-dimensionalised on a timescale that is representative for oscillations in which the ring's motion is dominated by extensional (rather than bending) deformations. Furthermore, because the load is non-dimensionalised on the ring's extensional (rather than its bending) stiffness, a very small load <img class="formulaInl" alt="$ p_{cos} = 10^{-4} $" src="form_48.png" width="64" height="14"/> was sufficient to induce large-amplitude oscillations. <br  />
 <br  />
 Change the load function to a spatially-constant external pressure (which will deform the ring axisymmetrically so that its motion is dominated by extensional deformations) to confirm that in this mode<ol type="a">
<li><img class="formulaInl" alt="$ {\cal O}(1) $" src="form_49.png" width="25" height="14"/> pressures are required to induce <img class="formulaInl" alt="$ {\cal O}(1) $" src="form_49.png" width="25" height="14"/> axisymmetric displacements, and</li>
<li>the period of the axisymmetric oscillations is <img class="formulaInl" alt="$ {\cal O}(1) $" src="form_49.png" width="25" height="14"/>.</li>
</ol>
</li>
</ol>
<p>[<b>Hint:</b> You will have to reduce the timestep to capture the much faster axisymmetric oscillations.]</p><ol type="1">
<li>Use the principle of virtual displacements (without prestress) <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \int_0^{L} \left[ \gamma \ \delta \gamma + \frac{1}{12} h^2 \kappa \ \delta \kappa - \left(\frac{1}{h} \sqrt{\frac{A}{a}} \ {\bf f} - \Lambda^2 \frac{\partial^2 {\bf R}_w}{\partial t^2} \right) \cdot \delta {\bf R}_w \right] \ \sqrt{a} \ d\xi = 0, \ \ \ \ \ \ \ \ \ (2) \]" src="form_50.png" width="428" height="39"/>
</p>
 to show (analytically) that for bending-dominated deformations (i.e. deformations for which <img class="formulaInl" alt="$ |\gamma| \ll |\kappa| $" src="form_51.png" width="46" height="14"/>)<ol type="a">
<li>an increase in the wall thickness <img class="formulaInl" alt="$ h $" src="form_21.png" width="8" height="10"/> by a factor 2, say, will<ol type="i">
<li>reduce the amplitude of the ring's static deformation by a factor of 8 (thicker rings are stiffer)</li>
<li>reduces the period of the unforced oscillations (i.e. the oscillations it performs when <img class="formulaInl" alt="$ {\bf f} = {\bf 0} $" src="form_52.png" width="30" height="10"/> ) by factor of 4 (thicker rings oscillate more rapidly).</li>
</ol>
</li>
</ol>
</li>
</ol>
<ol type="1">
<li>an increase in the ring's density <img class="formulaInl" alt="$ \rho \sim \Lambda^2$" src="form_53.png" width="38" height="14"/> by a factor of 2, say, increases the period of its bending-dominated oscillations by a factor of 4 (heavier rings oscillate more slowly).</li>
</ol>
<p>Combine these results to show that a ring of wall thickness <img class="formulaInl" alt="$ h $" src="form_21.png" width="8" height="10"/> and a density <img class="formulaInl" alt="$ \rho $" src="form_30.png" width="8" height="9"/>, subject to a forcing of magnitude <img class="formulaInl" alt="$ f $" src="form_54.png" width="8" height="13"/> will deform (approximately) as a ring of wall thickness <img class="formulaInl" alt="$ \alpha h $" src="form_55.png" width="15" height="10"/> with a density <img class="formulaInl" alt="$ \alpha^2 \rho $" src="form_56.png" width="20" height="14"/>, subject to a forcing of magnitude <img class="formulaInl" alt="$ \alpha^3 f$" src="form_57.png" width="21" height="14"/>. Confirm these theoretical predictions computationally: Change the initial assignment for the scaling factor <code><a class="el" href="namespaceGlobal__Physical__Variables.html#aa2e802ee7cc8e1ac900ba94c3ce86eb7" title="Scaling factor for wall thickness (to be used in an exercise)">Global_Physical_Variables::Alpha</a></code> and repeat the computation.</p><ol type="1">
<li>Confirm that the restart procedure works correctly by plotting the time-trace obtained from a restarted simulation on top of the original time-trace.</li>
<li>Compare the results obtained from a simulation with a variable timestep against the results obtained from a computation with a fixed timestep (comment out the line that reduces the timestep after every solve).</li>
<li>Compare the various output files generated in <code>doc_solution()</code> to confirm that the <code>Newmark&lt;3&gt;</code> timestepper correctly maintains the history of the solution at three previous timesteps. E.g. confirm that the output file <code>RESLT/ring3-0.dat</code> which contains the ring shape at timestep 3 is identical to <code>RESLT/ring5-2.dat</code> which contains the ring shape computed two timesteps before timestep 5. Explore <code>oomph-lib's</code> internal use of the history values by analysing the functions <div class="fragment"><div class="line">HermiteBeamElement::output(...)</div>
</div><!-- fragment --> <div class="fragment"><div class="line">FiniteElement::interpolated_x(...)</div>
</div><!-- fragment --> and <div class="fragment"><div class="line">FiniteElement::x_gen(...)</div>
</div><!-- fragment --></li>
</ol>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory: <center> <a href="../../../../demo_drivers/beam/unsteady_ring/">demo_drivers/beam/unsteady_ring/ </a> </center></li>
<li>The driver code is: <center> <a href="../../../../demo_drivers/beam/unsteady_ring/unsteady_ring.cc">demo_drivers/beam/unsteady_ring/unsteady_ring.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:25:26
        </div>
      </div>
    </footer>
</body>
</html>
