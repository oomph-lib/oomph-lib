<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: Solution of the 2D linear wave equation</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.2 -->
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Demo problem: Solution of the 2D linear wave equation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >In this example we demonstrate the solution of the 2D linear wave equation &ndash; a hyperbolic PDE that involves second time-derivatives. Timestepping of such problems may be performed with timesteppers from the <code>Newmark</code> family. We demonstrate their use and illustrate how to assign the initial conditions.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="example_problem"></a>
The example problem</h1>
<p >We shall illustrate the timestepping procedures for hyperbolic problems by considering the solution of the 2D linear wave equation in a rectangular domain:</p>
<center> <table class="doxtable">
<tr>
<td><center> <b>The two-dimensional linear wave equation in a rectangular domain.</b> </center> Solve <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \sum_{i=1}^2\frac{\partial^2 u}{\partial x_i^2} = \frac{\partial^2 u}{\partial t^2} + f\left(x_1,x_2,t\right), \ \ \ \ \ \ \ \ \ \ (1) \]" src="form_0.png" width="223" height="38"/>
</p>
 in the rectangular domain <img class="formulaInl" alt="$ D = \left\{ (x_1,x_2) \ \bigg| \ x_1 \in [0,1],\ x_2 \in [0,2] \right\} $" src="form_1.png" width="213" height="31"/>, subject to the Dirichlet boundary conditions <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \left. u\right|_{\partial D}=g_0 \ \ \ \ \ \ \ \ \ \ (2) \]" src="form_2.png" width="110" height="14"/>
</p>
 and the initial conditions <p class="formulaDsp">
<img class="formulaDsp" alt="\[ u(x_1,x_2,t=0)=h_0(x_1,x_2), \ \ \ \ \ \ \ \ \ \ (3) \]" src="form_3.png" width="214" height="14"/>
</p>
 and <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \left. \frac{\partial u}{\partial t}\right|_{t=0}=k_0(x_1,x_2), \ \ \ \ \ \ \ \ \ \ (4) \]" src="form_4.png" width="169" height="33"/>
</p>
 where the functions <img class="formulaInl" alt="$ g_0, h_0$" src="form_5.png" width="30" height="13"/> and <img class="formulaInl" alt="$ k_0 $" src="form_6.png" width="11" height="13"/> are given.   </td></tr>
</table>
</center><p >Here we consider the unforced case, <img class="formulaInl" alt="$ f=0 $" src="form_7.png" width="30" height="13"/>, and choose boundary and initial conditions that are consistent with the exact, travelling-wave solution </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ u_0(x_1,x_2,t) = \tanh\left(1-\alpha\left(\zeta-t\right)\right), \ \ \ \ \ \ \ \ \ \ (5) \]" src="form_8.png" width="249" height="14"/>
</p>
<p> where </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \zeta=\cos\left(\phi\right)x_1+\sin\left(\phi\right)x_2, \ \ \ \ \ \ \ \ \ \ (6) \]" src="form_9.png" width="201" height="14"/>
</p>
<p> is the travelling-wave coordinate. The solution represents a tanh step profile that propagates with unit speed through the domain. The parameter <img class="formulaInl" alt="$ \alpha $" src="form_10.png" width="8" height="6"/> controls the steepness of the step while <img class="formulaInl" alt="$ \phi $" src="form_11.png" width="8" height="13"/> controls the orientation of the step in the <img class="formulaInl" alt="$ (x_1,x_2) $" src="form_12.png" width="40" height="14"/> - plane.</p>
<p >The figure below shows a plot of computed and exact solutions at time <img class="formulaInl" alt="$ t = 0.25 $" src="form_13.png" width="44" height="9"/>, for a steepness parameter <img class="formulaInl" alt="$ \alpha=4 $" src="form_14.png" width="31" height="9"/>, and an angle <img class="formulaInl" alt="$ \phi=\pi/6 $" src="form_15.png" width="44" height="14"/> . The plot is a snapshot, taken from the <a href="../figures/wave_sol.avi">animation of the solution</a>.</p>
<div class="image">
<img src="wave_sol.gif" alt=""/>
<div class="caption">
Snapshot of the exact and computed solutions. </div></div>
 <hr  />
 <hr  />
<h1><a class="anchor" id="namespace"></a>
Global parameters and functions</h1>
<p >As usual, we store the problem parameters in a namespace. Note that we define not only the exact solution but also its first and second time-derivatives, as both are needed to assign the initial conditions for the Newmark timestepper; see <a class="el" href="index.html#IC">Setting the initial conditions for Newmark timesteppers</a> for details.</p>
 <div class="fragment"><div class="line"><span class="comment">//==start_of_tanh_solution============================================</span></div>
<div class="line"><span class="comment">/// Namespace for exact solution for LinearWave equation </span><span class="comment"></span></div>
<div class="line"><span class="comment">/// with sharp step </span></div>
<div class="line"><span class="comment"></span><span class="comment">//====================================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceTanhSolnForLinearWave.html">TanhSolnForLinearWave</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Parameter for steepness of step</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Orientation of step wave</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">Phi</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Exact solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aceea2935b2d3815ce72aae8c9de2b468">exact_u</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; time, <span class="keyword">const</span> Vector&lt;double&gt;&amp; x)</div>
<div class="line"> {</div>
<div class="line">  <span class="keywordtype">double</span> zeta=cos(<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">Phi</a>)*x[0]+sin(<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">Phi</a>)*x[1];</div>
<div class="line">  <span class="keywordflow">return</span> tanh(1.0-<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>*(zeta-time));</div>
<div class="line"> }</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// 1st time-deriv of exact solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aa2081bd3d3d518a38497f664b0e498bc">exact_dudt</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; time, <span class="keyword">const</span> Vector&lt;double&gt;&amp; x)</div>
<div class="line"> {</div>
<div class="line">  <span class="keywordtype">double</span> zeta=cos(<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">Phi</a>)*x[0]+sin(<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">Phi</a>)*x[1];</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>/(cosh(1.0-<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>*(zeta-time))*</div>
<div class="line">              cosh(1.0-<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>*(zeta-time)));</div>
<div class="line"> }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// 2nd time-deriv of exact solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a63b7a0f5fd5d06cc2c0a43322a81fe43">exact_d2udt2</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; time, <span class="keyword">const</span> Vector&lt;double&gt;&amp; x)</div>
<div class="line"> {</div>
<div class="line">  <span class="keywordtype">double</span> zeta=cos(<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">Phi</a>)*x[0]+sin(<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">Phi</a>)*x[1];</div>
<div class="line">  <span class="keywordflow">return</span> -2.0*<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>*<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>*tanh(1.0-<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>*(zeta-time))/</div>
<div class="line">   (cosh(1.0-<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>*(zeta-time))*cosh(1.0-<a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">Alpha</a>*(zeta-time)));</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Exact solution as a vector</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a7dd7e9f155d19f871ba87d3fe41fd8e9">get_exact_u</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; time, <span class="keyword">const</span> Vector&lt;double&gt;&amp; x, </div>
<div class="line">                  Vector&lt;double&gt;&amp; u)</div>
<div class="line"> {</div>
<div class="line">  u[0]=<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aceea2935b2d3815ce72aae8c9de2b468">exact_u</a>(time,x);</div>
<div class="line">  u[1]=<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aa2081bd3d3d518a38497f664b0e498bc">exact_dudt</a>(time,x);</div>
<div class="line">  u[2]=<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a63b7a0f5fd5d06cc2c0a43322a81fe43">exact_d2udt2</a>(time,x);</div>
<div class="line"> }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Source function to make it an exact solution </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a3bc9643b40e62283dc09f405ed17c805">get_source</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; time, <span class="keyword">const</span> Vector&lt;double&gt;&amp; x, <span class="keywordtype">double</span>&amp; source)</div>
<div class="line"> {</div>
<div class="line">  source=0.0;</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of tanh solution</span></div>
<div class="ttc" id="anamespaceTanhSolnForLinearWave_html"><div class="ttname"><a href="namespaceTanhSolnForLinearWave.html">TanhSolnForLinearWave</a></div><div class="ttdoc">Namespace for exact solution for LinearWave equation with sharp step.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00048">two_d_linear_wave.cc:49</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForLinearWave_html_a3bc9643b40e62283dc09f405ed17c805"><div class="ttname"><a href="namespaceTanhSolnForLinearWave.html#a3bc9643b40e62283dc09f405ed17c805">TanhSolnForLinearWave::get_source</a></div><div class="ttdeci">void get_source(const double &amp;time, const Vector&lt; double &gt; &amp;x, double &amp;source)</div><div class="ttdoc">Source function to make it an exact solution.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00091">two_d_linear_wave.cc:91</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForLinearWave_html_a48021142056bdea20e6432e360fd0314"><div class="ttname"><a href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">TanhSolnForLinearWave::Alpha</a></div><div class="ttdeci">double Alpha</div><div class="ttdoc">Parameter for steepness of step.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00052">two_d_linear_wave.cc:52</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForLinearWave_html_a5242d421b567b803323bc127081351a6"><div class="ttname"><a href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">TanhSolnForLinearWave::Phi</a></div><div class="ttdeci">double Phi</div><div class="ttdoc">Orientation of step wave.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00055">two_d_linear_wave.cc:55</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForLinearWave_html_a63b7a0f5fd5d06cc2c0a43322a81fe43"><div class="ttname"><a href="namespaceTanhSolnForLinearWave.html#a63b7a0f5fd5d06cc2c0a43322a81fe43">TanhSolnForLinearWave::exact_d2udt2</a></div><div class="ttdeci">double exact_d2udt2(const double &amp;time, const Vector&lt; double &gt; &amp;x)</div><div class="ttdoc">2nd time-deriv of exact solution</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00073">two_d_linear_wave.cc:73</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForLinearWave_html_a7dd7e9f155d19f871ba87d3fe41fd8e9"><div class="ttname"><a href="namespaceTanhSolnForLinearWave.html#a7dd7e9f155d19f871ba87d3fe41fd8e9">TanhSolnForLinearWave::get_exact_u</a></div><div class="ttdeci">void get_exact_u(const double &amp;time, const Vector&lt; double &gt; &amp;x, Vector&lt; double &gt; &amp;u)</div><div class="ttdoc">Exact solution as a vector.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00082">two_d_linear_wave.cc:82</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForLinearWave_html_aa2081bd3d3d518a38497f664b0e498bc"><div class="ttname"><a href="namespaceTanhSolnForLinearWave.html#aa2081bd3d3d518a38497f664b0e498bc">TanhSolnForLinearWave::exact_dudt</a></div><div class="ttdeci">double exact_dudt(const double &amp;time, const Vector&lt; double &gt; &amp;x)</div><div class="ttdoc">1st time-deriv of exact solution</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00065">two_d_linear_wave.cc:65</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForLinearWave_html_aceea2935b2d3815ce72aae8c9de2b468"><div class="ttname"><a href="namespaceTanhSolnForLinearWave.html#aceea2935b2d3815ce72aae8c9de2b468">TanhSolnForLinearWave::exact_u</a></div><div class="ttdeci">double exact_u(const double &amp;time, const Vector&lt; double &gt; &amp;x)</div><div class="ttdoc">Exact solution.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00058">two_d_linear_wave.cc:58</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="main"></a>
The driver code</h1>
<p >As in most previous time-dependent example codes, we use the command line arguments as flags that indicate if the code is run in validation mode &ndash; if command line arguments are specified, the code will only perform a small number of timesteps.</p>
<div class="fragment"><div class="line"><span class="comment">//===start_of_main========================================================</span></div>
<div class="line"><span class="comment">/// Demonstrate how to solve LinearWave problem.</span></div>
<div class="line"><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="two__d__linear__wave_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Store command line arguments: If a command line argument is specied</span></div>
<div class="line"> <span class="comment">// we regard this as validation run.</span></div>
<div class="line"> CommandLineArgs::setup(argc,argv);</div>
<div class="ttc" id="atwo__d__linear__wave_8cc_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="two__d__linear__wave_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdoc">///////////////////////////////////////////////////////////////////// ///////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00553">two_d_linear_wave.cc:553</a></div></div>
</div><!-- fragment --><p> We build the problem with 2D bi-quadratic <code>QLinearWaveElements</code> and a <code>Newmark&lt;1&gt;</code> timestepper (see <a class="el" href="index.html#IC">Setting the initial conditions for Newmark timesteppers</a> for an explanation of the template argument), passing the number of elements, and the pointer to the source function to the constructor, and run the time time-dependent simulation. We solve the problem twice, once with an impulsive start and once a with "smooth" start from the travelling-wave solution (5).</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Number of elements in x direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_x=10;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of elements in y direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_y=20;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Impulsive start?</span></div>
<div class="line"> <span class="keywordtype">bool</span> impulsive_start;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Run with impulsive start</span></div>
<div class="line"> <span class="comment">// ------------------------</span></div>
<div class="line"> {</div>
<div class="line">  impulsive_start=<span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Build problem</span></div>
<div class="line">  <a class="code hl_class" href="classLinearWaveProblem.html">LinearWaveProblem&lt;QLinearWaveElement&lt;2,3&gt;</a>, Newmark&lt;1&gt; &gt;</div>
<div class="line">   problem(n_x,n_y,impulsive_start,&amp;<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a3bc9643b40e62283dc09f405ed17c805">TanhSolnForLinearWave::get_source</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Run it</span></div>
<div class="line">  problem.unsteady_run();</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Run with &quot;smooth&quot; start</span></div>
<div class="line"> <span class="comment">// -----------------------</span></div>
<div class="line"> {</div>
<div class="line">  impulsive_start=<span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Build problem</span></div>
<div class="line">  <a class="code hl_class" href="classLinearWaveProblem.html">LinearWaveProblem&lt;QLinearWaveElement&lt;2,3&gt;</a>, Newmark&lt;1&gt; &gt;</div>
<div class="line">   problem(n_x,n_y,impulsive_start,&amp;<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a3bc9643b40e62283dc09f405ed17c805">TanhSolnForLinearWave::get_source</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Run it</span></div>
<div class="line">  problem.unsteady_run();</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// end of main</span></div>
<div class="ttc" id="aclassLinearWaveProblem_html"><div class="ttname"><a href="classLinearWaveProblem.html">LinearWaveProblem</a></div><div class="ttdoc">///////////////////////////////////////////////////////////////////// ///////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00108">two_d_linear_wave.cc:109</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="problem"></a>
The problem class</h1>
<p >The problem class is practically identical to that used for <a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html">the corresponding unsteady heat problem</a>. No actions are required before or after the solve but the time-dependent boundary conditions must be updated before every timestep.</p>
 <div class="fragment"><div class="line"><span class="comment">//===start_of_problem_class===========================================</span></div>
<div class="line"><span class="comment">/// LinearWave problem in rectanglular domain</span></div>
<div class="line"><span class="comment">//====================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT, <span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classLinearWaveProblem.html">LinearWaveProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor: pass number of elements in x and y directions,</span></div>
<div class="line"><span class="comment"> /// bool indicating impulsive or &quot;smooth&quot; start,</span></div>
<div class="line"><span class="comment"> /// and pointer to source function</span></div>
<div class="line"><span class="comment"></span> <a class="code hl_function" href="classLinearWaveProblem.html#a459a58b7afd588cfa78a5e1e98c3c41e">LinearWaveProblem</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; nx, <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; ny, </div>
<div class="line">                   <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; impulsive_start,</div>
<div class="line">                   LinearWaveEquations&lt;2&gt;::LinearWaveSourceFctPt source_fct_pt);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Destructor (empty) </span></div>
<div class="line"><span class="comment"></span> <a class="code hl_function" href="classLinearWaveProblem.html#af1f3879114813b0acdfd2567c5c7b1e9">~LinearWaveProblem</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the problem specs after solve (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#a5b45c619af141b19162f990a95490e80">actions_after_newton_solve</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the problem specs before solve (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#a66e87510f6fa8af693cede514cb7a62e">actions_before_newton_solve</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the problem specs after solve (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#a521290f43f9aac37c9604e744fa71075">actions_after_implicit_timestep</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the problem specs before next timestep: </span></div>
<div class="line"><span class="comment"> /// Set time-dependent Dirchlet boundary from exact solution.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#a39cfcb8ce06463ace1ac09fa43afa00a">actions_before_implicit_timestep</a>()</div>
<div class="line">  {</div>
<div class="line">   Vector&lt;typename TIMESTEPPER::NodeInitialConditionFctPt&gt; </div>
<div class="line">    initial_value_fct(1);</div>
<div class="line">   Vector&lt;typename TIMESTEPPER::NodeInitialConditionFctPt&gt;</div>
<div class="line">    initial_veloc_fct(1);</div>
<div class="line">   Vector&lt;typename TIMESTEPPER::NodeInitialConditionFctPt&gt; </div>
<div class="line">    initial_accel_fct(1);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Assign values for analytical value, veloc and accel:</span></div>
<div class="line">   initial_value_fct[0]=&amp;<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aceea2935b2d3815ce72aae8c9de2b468">TanhSolnForLinearWave::exact_u</a>;</div>
<div class="line">   initial_veloc_fct[0]=&amp;<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aa2081bd3d3d518a38497f664b0e498bc">TanhSolnForLinearWave::exact_dudt</a>;</div>
<div class="line">   initial_accel_fct[0]=&amp;<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a63b7a0f5fd5d06cc2c0a43322a81fe43">TanhSolnForLinearWave::exact_d2udt2</a>;</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Loop over boundaries</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> num_bound=mesh_pt()-&gt;nboundary();</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ibound=0;ibound&lt;num_bound;ibound++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Loop over boundary nodes</span></div>
<div class="line">     <span class="keywordtype">unsigned</span> num_nod=mesh_pt()-&gt;nboundary_node(ibound);</div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">      {</div>
<div class="line">       <span class="comment">// Set the boundary condition from the exact solution</span></div>
<div class="line">       Node* nod_pt=mesh_pt()-&gt;boundary_node_pt(ibound,inod);</div>
<div class="line"> </div>
<div class="line">       <span class="keywordtype">bool</span> use_direct_assignment=<span class="keyword">false</span>;</div>
<div class="line">       <span class="keywordflow">if</span> (use_direct_assignment)</div>
<div class="line">        {</div>
<div class="line">         <span class="comment">// Set nodal coordinates for evaluation of BC:</span></div>
<div class="line">         Vector&lt;double&gt; x(2);</div>
<div class="line">         x[0]=nod_pt-&gt;x(0);</div>
<div class="line">         x[1]=nod_pt-&gt;x(1);</div>
<div class="line">         </div>
<div class="line">         <span class="comment">// Set exact solution at current time</span></div>
<div class="line">         nod_pt-&gt;set_value(0,</div>
<div class="line">                           <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aceea2935b2d3815ce72aae8c9de2b468">TanhSolnForLinearWave::exact_u</a>(time_pt()-&gt;time(),x));</div>
<div class="line">        }</div>
<div class="line">       <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">         <span class="comment">// Get timestepper</span></div>
<div class="line">         TIMESTEPPER* timestepper_pt=<span class="keyword">dynamic_cast&lt;</span>TIMESTEPPER*<span class="keyword">&gt;</span></div>
<div class="line">          (time_stepper_pt());</div>
<div class="line">         </div>
<div class="line">         <span class="comment">// Assign the history values</span></div>
<div class="line">         timestepper_pt-&gt;assign_initial_data_values(nod_pt, </div>
<div class="line">                                                    initial_value_fct,</div>
<div class="line">                                                    initial_veloc_fct,</div>
<div class="line">                                                    initial_accel_fct);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// end of actions before timestep</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> ///  Set initial condition (incl history values)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#afb5d327791d8289a8a0a565afc8aee37">set_initial_condition</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc the solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#a6d9396a693be0479ece9ac1f14f9233a">doc_solution</a>(DocInfo&amp; doc_info);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Do unsteady run </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#a9993365201bfffcc04dd2034f0d3d391">unsteady_run</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Trace file</span></div>
<div class="line"> ofstream <a class="code hl_variable" href="classLinearWaveProblem.html#ac75d13211cfb08c7cfba0ea129711a09">Trace_file</a>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Impulsive start?</span></div>
<div class="line"> <span class="keywordtype">bool</span> <a class="code hl_variable" href="classLinearWaveProblem.html#a296c67402f065a1a3776064492003670">Impulsive_start</a>;</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// end of problem class</span></div>
<div class="ttc" id="aclassLinearWaveProblem_html_a296c67402f065a1a3776064492003670"><div class="ttname"><a href="classLinearWaveProblem.html#a296c67402f065a1a3776064492003670">LinearWaveProblem::Impulsive_start</a></div><div class="ttdeci">bool Impulsive_start</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00202">two_d_linear_wave.cc:202</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_a39cfcb8ce06463ace1ac09fa43afa00a"><div class="ttname"><a href="classLinearWaveProblem.html#a39cfcb8ce06463ace1ac09fa43afa00a">LinearWaveProblem::actions_before_implicit_timestep</a></div><div class="ttdeci">void actions_before_implicit_timestep()</div><div class="ttdoc">Update the problem specs before next timestep: Set time-dependent Dirchlet boundary from exact soluti...</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00134">two_d_linear_wave.cc:134</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_a459a58b7afd588cfa78a5e1e98c3c41e"><div class="ttname"><a href="classLinearWaveProblem.html#a459a58b7afd588cfa78a5e1e98c3c41e">LinearWaveProblem::LinearWaveProblem</a></div><div class="ttdeci">LinearWaveProblem(const unsigned &amp;nx, const unsigned &amp;ny, const bool &amp;impulsive_start, LinearWaveEquations&lt; 2 &gt;::LinearWaveSourceFctPt source_fct_pt)</div><div class="ttdoc">Constructor: pass number of elements in x and y directions, bool indicating impulsive or &quot;smooth&quot; sta...</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00212">two_d_linear_wave.cc:212</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_a521290f43f9aac37c9604e744fa71075"><div class="ttname"><a href="classLinearWaveProblem.html#a521290f43f9aac37c9604e744fa71075">LinearWaveProblem::actions_after_implicit_timestep</a></div><div class="ttdeci">void actions_after_implicit_timestep()</div><div class="ttdoc">Update the problem specs after solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00130">two_d_linear_wave.cc:130</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_a5b45c619af141b19162f990a95490e80"><div class="ttname"><a href="classLinearWaveProblem.html#a5b45c619af141b19162f990a95490e80">LinearWaveProblem::actions_after_newton_solve</a></div><div class="ttdeci">void actions_after_newton_solve()</div><div class="ttdoc">Update the problem specs after solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00124">two_d_linear_wave.cc:124</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_a66e87510f6fa8af693cede514cb7a62e"><div class="ttname"><a href="classLinearWaveProblem.html#a66e87510f6fa8af693cede514cb7a62e">LinearWaveProblem::actions_before_newton_solve</a></div><div class="ttdeci">void actions_before_newton_solve()</div><div class="ttdoc">Update the problem specs before solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00127">two_d_linear_wave.cc:127</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_a6d9396a693be0479ece9ac1f14f9233a"><div class="ttname"><a href="classLinearWaveProblem.html#a6d9396a693be0479ece9ac1f14f9233a">LinearWaveProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(DocInfo &amp;doc_info)</div><div class="ttdoc">Doc the solution.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00404">two_d_linear_wave.cc:404</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_a9993365201bfffcc04dd2034f0d3d391"><div class="ttname"><a href="classLinearWaveProblem.html#a9993365201bfffcc04dd2034f0d3d391">LinearWaveProblem::unsteady_run</a></div><div class="ttdeci">void unsteady_run()</div><div class="ttdoc">Do unsteady run.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00472">two_d_linear_wave.cc:472</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_ac75d13211cfb08c7cfba0ea129711a09"><div class="ttname"><a href="classLinearWaveProblem.html#ac75d13211cfb08c7cfba0ea129711a09">LinearWaveProblem::Trace_file</a></div><div class="ttdeci">ofstream Trace_file</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00199">two_d_linear_wave.cc:199</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_af1f3879114813b0acdfd2567c5c7b1e9"><div class="ttname"><a href="classLinearWaveProblem.html#af1f3879114813b0acdfd2567c5c7b1e9">LinearWaveProblem::~LinearWaveProblem</a></div><div class="ttdeci">~LinearWaveProblem()</div><div class="ttdoc">Destructor (empty)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00121">two_d_linear_wave.cc:121</a></div></div>
<div class="ttc" id="aclassLinearWaveProblem_html_afb5d327791d8289a8a0a565afc8aee37"><div class="ttname"><a href="classLinearWaveProblem.html#afb5d327791d8289a8a0a565afc8aee37">LinearWaveProblem::set_initial_condition</a></div><div class="ttdeci">void set_initial_condition()</div><div class="ttdoc">Set initial condition (incl history values)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__linear__wave_8cc_source.html#l00289">two_d_linear_wave.cc:289</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="constructor"></a>
The problem constructor</h1>
<p >The problem constructor is also fairly standard: We start by creating the timestepper (of the type specified by the template argument), pass it to the Problem's collection of timesteppers, and initialise the parameters for the exact solution.</p>
<div class="fragment"><div class="line"><span class="comment">//===start_of_constructor=================================================</span></div>
<div class="line"><span class="comment">/// Constructor for LinearWave problem </span></div>
<div class="line"><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT, <span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><a class="code hl_function" href="classLinearWaveProblem.html#a459a58b7afd588cfa78a5e1e98c3c41e">LinearWaveProblem&lt;ELEMENT,TIMESTEPPER&gt;::LinearWaveProblem</a>(</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; nx, <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; ny, <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; impulsive_start, </div>
<div class="line"> LinearWaveEquations&lt;2&gt;::LinearWaveSourceFctPt source_fct_pt) :</div>
<div class="line"> Impulsive_start(impulsive_start)</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Allocate the timestepper -- this constructs the time object as well</span></div>
<div class="line"> add_time_stepper_pt(<span class="keyword">new</span> TIMESTEPPER());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set up parameters for exact solution</span></div>
<div class="line"> <span class="comment">//-------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Steepness of tanh profile</span></div>
<div class="line"> <a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a48021142056bdea20e6432e360fd0314">TanhSolnForLinearWave::Alpha</a>=4.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Orientation of step wave</span></div>
<div class="line"> <a class="code hl_variable" href="namespaceTanhSolnForLinearWave.html#a5242d421b567b803323bc127081351a6">TanhSolnForLinearWave::Phi</a>=MathematicalConstants::Pi/180.0*30.0;</div>
</div><!-- fragment --><p> Next, we build the mesh and pin the nodal values on the Dirichlet boundaries (i.e. at all boundary nodes). <a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html">Recall</a> that the pointer to the timestepper must be passed the mesh constructor to allow the creation of <code>Nodes</code> that provide sufficient storage for the "history values" required by the timestepper.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Set up mesh</span></div>
<div class="line"> <span class="comment">//------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// # of elements in x-direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> Nx=nx;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// # of elements in y-direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> Ny=ny;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Domain length in x-direction</span></div>
<div class="line"> <span class="keywordtype">double</span> Lx=1.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Domain length in y-direction</span></div>
<div class="line"> <span class="keywordtype">double</span> Ly=2.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build and assign mesh</span></div>
<div class="line"> Problem::mesh_pt()=<span class="keyword">new</span> RectangularQuadMesh&lt;ELEMENT&gt;(</div>
<div class="line">  Nx,Ny,Lx,Ly,time_stepper_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set the boundary conditions for this problem: All nodes are</span></div>
<div class="line"> <span class="comment">// free by default -- just pin the ones that have Dirichlet conditions</span></div>
<div class="line"> <span class="comment">// here. </span></div>
<div class="line"> <span class="keywordtype">unsigned</span> num_bound = mesh_pt()-&gt;nboundary();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=0;ibound&lt;num_bound;ibound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod= mesh_pt()-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {</div>
<div class="line">     mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;pin(0); </div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">//end of boundary conditions</span></div>
</div><!-- fragment --><p >Finally, we complete the build of the elements by passing the pointer to the source function to the elements, and set up the equation numbering scheme.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Complete build of elements</span></div>
<div class="line"> <span class="comment">// --------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over the elements to set up element-specific </span></div>
<div class="line"> <span class="comment">// things that cannot be handled by constructor </span></div>
<div class="line"><span class="keywordtype">unsigned</span> n_element = mesh_pt()-&gt;nelement();</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_element;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Upcast from GeneralisedElement to the present element</span></div>
<div class="line">   ELEMENT *el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(mesh_pt()-&gt;element_pt(i));</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Set the source function pointer</span></div>
<div class="line">   el_pt-&gt;source_fct_pt() = source_fct_pt;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup equation numbering scheme</span></div>
<div class="line"> cout &lt;&lt;<span class="stringliteral">&quot;Number of equations: &quot;</span> &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl; </div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of constructor</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="IC"></a>
Setting the initial conditions for Newmark timesteppers</h1>
<p >Most of the code discussed so far was (and most of what follows is) practically identical to that in <a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html">the corresponding unsteady heat example</a>. The main difference between the two example codes is the way in which the initial conditions are applied. This is closely related to the different role of the "history values" in <code>BDF</code> and <code>Newmark</code> timestepping schemes:</p>
<hr  />
<h2><a class="anchor" id="BDFvsNewmark"></a>
The interpretation of history values in BDF and Newmark timesteppers</h2>
<p >In problems in which first time-derivatives are discretised by <code>BDF</code> timesteppers, the "history values" represent the values of the solution at previous timesteps, i.e. for a <code>Data</code> object that is associated with a timestepper from the <code>BDF</code> family, <code>Data::value(t,i)</code> returns the i-th value stored in the <code>Data</code> object, at the t-th previous timestep. We recall that when assigning initial conditions for computations with higher-order timesteppers from the <code>BDF</code> family, the number of (mathematical) initial conditions (the solution at the intial time, <img class="formulaInl" alt="$ t=t_0 $" src="form_16.png" width="31" height="11"/> , say) is <em>smaller</em> than the number of "history values" required by the timestepper. For instance, a computation with a <code>BDF&lt;2&gt;</code> timestepper and a timestep <code>dt</code> not only requires the solution at <img class="formulaInl" alt="$ t=t_0 $" src="form_16.png" width="31" height="11"/> but also the solution at <img class="formulaInl" alt="$ t=t_0- {\tt dt} $" src="form_17.png" width="60" height="11"/> . In most of our examples, this did not cause any problems. We either started the simulation with an "impulsive start" by setting <em>all</em> history values to the solution at <img class="formulaInl" alt="$ t=t_0 $" src="form_16.png" width="31" height="11"/> , or we assigned the history values from an explicitly-given function (usually an exact solution of the governing equations), in which case the evaluation of the history values at previous timesteps was trivial.</p>
<p >Timesteppers from the <code>Newmark</code> family compute second-order accurate approximations for the first and second time-derivatives of the values stored in an associated <code>Data</code> object. <code>Newmark</code> timesteppers are implicit, single-step schemes since the approximation of the time-derivatives only involves quantities evaluated at the current time (where the solution is unknown) and at a single previous timestep. To facilitate their application in multiphysics problems where parts of a <code>Problem</code> might be discretised by timesteppers from the <code>BDF</code> family, say, <code>Newmark</code> timesteppers can allocate additional storage for the solution at the previous <code>NSTEPS</code> timesteps. These history values are stored in the <code>Data</code> objects and are updated by the timestepper when the solution is advanced to the next time level, but they are not used in the computation of the time-derivatives.</p>
<p >For a <code>Data</code> object that is associated with a <code>Newmark&lt;NSTEPS&gt;</code> timestepper, the history value obtained from <code>Data::value(t,i)</code> may be interpreted as follows:</p><ul>
<li>t=0: The i-th value at at present time, <code>Time_pt-&gt;time()</code> </li>
<li>t=1: The i-th value at the previous timestep, <code>Time_pt-&gt;time()-dt</code> </li>
<li>...</li>
<li>t=NSTEPS: The i-th value at the NSTEPS-th previous timestep, i.e. at <code>Time_pt-&gt;time()-NSTEPS*dt</code> if the timestep dt was kept constant.</li>
<li>t=NSTEPS+1: The 1st time derivative (= "the velocity") of the i-th value at the previous timestep, <code>Time_pt-&gt;time()-dt</code> </li>
<li>t=NSTEPS+2: The 2nd time derivative (= "the acceleration") of the i-th value at the previous timestep, <code>Time_pt-&gt;time()-dt</code>.</li>
</ul>
<p>The <code>Newmark&lt;1&gt;</code> timestepper is equivalent to the classical Newmark scheme.</p>
<hr  />
<h2><a class="anchor" id="ic_for_newmark"></a>
Assigning the history values for Newmark timesteppers</h2>
<p >The <code>Newmark</code> timestepper provides a number of helper functions that facilitate the assignment of "history values".</p><ol type="1">
<li><b>Impulsive starts: </b> <br  />
<br  />
 Given a pointer, <code>data_pt</code>, to a <code>Data</code> object, the function <code>Newmark&lt;NSTEPS&gt;::assign_initial_values_impulsive(data_pt)</code> assigns history values that are consistent with an impulsive start from the <code>Data</code> object's current values.</li>
<li><b>"Smooth" starts from explicitly given time-histories: </b> <br  />
<br  />
 If the solution <img class="formulaInl" alt="$ u $" src="form_18.png" width="9" height="6"/> and its first <em>and</em> second time-derivatives are available analytically for <img class="formulaInl" alt="$ t \le t_0$" src="form_19.png" width="31" height="11"/>, the function <code>Newmark&lt;NSTEPS&gt;::assign_initial_data_values(...)</code> may be used to assign history values that are consistent <br  />
 with this time history. Note that, as in the case of the higher-order <code>BDF</code> timesteppers, we require more information than is provided by the (mathematical) initial conditions which only provide the value and the first time-derivative of the unknown function at the initial time.</li>
</ol>
<hr  />
<h2><a class="anchor" id="implement_ic"></a>
Implementation in the demo code</h2>
<p >The function <code>set_initial_condition()</code> demonstrates the use of these functions in our example problem. The assignment of the "history values" for the nodal <code>Data</code> is handled by the timestepper, a pointer to which can be obtained from the <code>Problem:</code> </p>
<div class="fragment"><div class="line"><span class="comment">//===start_of_set_initial_condition=======================================</span></div>
<div class="line"><span class="comment">/// Set initial condition.</span></div>
<div class="line"><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT, <span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#afb5d327791d8289a8a0a565afc8aee37">LinearWaveProblem&lt;ELEMENT,TIMESTEPPER&gt;::set_initial_condition</a>()</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Get timestepper</span></div>
<div class="line"> TIMESTEPPER* timestepper_pt=<span class="keyword">dynamic_cast&lt;</span>TIMESTEPPER*<span class="keyword">&gt;</span>(time_stepper_pt());</div>
</div><!-- fragment --><p> To start the simulation with an impulsive start from the travelling-wave solution, defined in the namespace <code><a class="el" href="namespaceTanhSolnForLinearWave.html" title="Namespace for exact solution for LinearWave equation with sharp step.">TanhSolnForLinearWave</a></code>, we loop over all nodes and determine their positions. We then compute the value of the exact solution at that point and assign it to the current nodal value. "History values" that correspond to an impulsive start from this value are then assigned by calling <code>Newmark&lt;NSTEPS&gt;::assign_initial_values_impulsive(...)</code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Impulsive start</span></div>
<div class="line"> <span class="comment">//----------------</span></div>
<div class="line"> <span class="keywordflow">if</span> (Impulsive_start)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Loop over the nodes to set initial conditions everywhere</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod=mesh_pt()-&gt;nnode();</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> jnod=0;jnod&lt;num_nod;jnod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Pointer to node</span></div>
<div class="line">     Node* nod_pt=mesh_pt()-&gt;node_pt(jnod);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Get nodal coordinates</span></div>
<div class="line">     Vector&lt;double&gt; x(2);</div>
<div class="line">     x[0]=nod_pt-&gt;x(0);</div>
<div class="line">     x[1]=nod_pt-&gt;x(1);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Assign initial value from exact solution</span></div>
<div class="line">     nod_pt-&gt;set_value(0,<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aceea2935b2d3815ce72aae8c9de2b468">TanhSolnForLinearWave::exact_u</a>(time_pt()-&gt;time(),x));</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Set history values so that they are consistent with an impulsive</span></div>
<div class="line">     <span class="comment">// start from this value</span></div>
<div class="line">     timestepper_pt-&gt;assign_initial_values_impulsive(nod_pt);</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// end impulsive start</span></div>
</div><!-- fragment --><p> To start the simulation with a "smooth" start from the travelling-wave solution we have to pass function pointers to the functions that specify the function and its first and second time-derivatives to <code>Newmark&lt;NSTEPS&gt;::assign_initial_data_values(...)</code>. As usual, the required form of the function pointer is defined as a public <code>typedef</code> in the Newmark class. Since <code>Data</code> objects can store multiple values, each of which will generally have a different time-history, <code>Newmark&lt;NSTEPS&gt;::assign_initial_data_values(...)</code> expects a vector of function pointers. In the current example where each node only stores a single value, these vectors only have a single entry.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// &quot;Smooth&quot; start from analytical time history</span></div>
<div class="line"> <span class="comment">//--------------------------------------------</span></div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Vector of function pointers to functions that specify the</span></div>
<div class="line">   <span class="comment">// value, and the first and second time-derivatives of the</span></div>
<div class="line">   <span class="comment">// function used as the initial condition</span></div>
<div class="line">   Vector&lt;typename TIMESTEPPER::NodeInitialConditionFctPt&gt; </div>
<div class="line">    initial_value_fct(1);</div>
<div class="line">   Vector&lt;typename TIMESTEPPER::NodeInitialConditionFctPt&gt;</div>
<div class="line">    initial_veloc_fct(1);</div>
<div class="line">   Vector&lt;typename TIMESTEPPER::NodeInitialConditionFctPt&gt; </div>
<div class="line">    initial_accel_fct(1);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Assign values for analytical value, veloc and accel:</span></div>
<div class="line">   initial_value_fct[0]=&amp;<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aceea2935b2d3815ce72aae8c9de2b468">TanhSolnForLinearWave::exact_u</a>;</div>
<div class="line">   initial_veloc_fct[0]=&amp;<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aa2081bd3d3d518a38497f664b0e498bc">TanhSolnForLinearWave::exact_dudt</a>;</div>
<div class="line">   initial_accel_fct[0]=&amp;<a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a63b7a0f5fd5d06cc2c0a43322a81fe43">TanhSolnForLinearWave::exact_d2udt2</a>;</div>
</div><!-- fragment --><p> Now we loop over all nodes and pass the vectors of function pointers <br  />
 to <code>Newmark&lt;NSTEPS&gt;::assign_initial_data_values(...)</code> to assign the required history values.</p>
<div class="fragment"><div class="line">   </div>
<div class="line">   <span class="comment">// Assign Newmark history values so that Newmark approximations</span></div>
<div class="line">   <span class="comment">// for velocity and accel are correct at initial time:</span></div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Loop over the nodes to set initial conditions everywhere</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod=mesh_pt()-&gt;nnode();</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> jnod=0;jnod&lt;num_nod;jnod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Pointer to node</span></div>
<div class="line">     Node* nod_pt=mesh_pt()-&gt;node_pt(jnod);</div>
<div class="line">    </div>
<div class="line">     <span class="comment">// Assign the history values</span></div>
<div class="line">     timestepper_pt-&gt;assign_initial_data_values(nod_pt, </div>
<div class="line">                                                initial_value_fct,</div>
<div class="line">                                                initial_veloc_fct,</div>
<div class="line">                                                initial_accel_fct);</div>
<div class="line">    } <span class="comment">// end of smooth start</span></div>
</div><!-- fragment --><p> To check/demonstrate that the assignment of the initial condition was successful, we compare the Newmark approximation for the zero-th, first and second time-derivatives of the nodal values against the exact solution and document the maximum discrepancy.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Paranoia: Check that the initial values were assigned correctly</span></div>
<div class="line">   <span class="keywordtype">double</span> err_max=0.0;</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> jnod=0;jnod&lt;num_nod;jnod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Pointer to node</span></div>
<div class="line">     Node* nod_pt=mesh_pt()-&gt;node_pt(jnod);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Get nodal coordinates</span></div>
<div class="line">     Vector&lt;double&gt; x(2);</div>
<div class="line">     x[0]=nod_pt-&gt;x(0);</div>
<div class="line">     x[1]=nod_pt-&gt;x(1);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Get exact value and first and second time-derivatives</span></div>
<div class="line">     <span class="keywordtype">double</span> u_exact=</div>
<div class="line">      <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aceea2935b2d3815ce72aae8c9de2b468">TanhSolnForLinearWave::exact_u</a>(time_pt()-&gt;time(),x);</div>
<div class="line">     <span class="keywordtype">double</span> dudt_exact=</div>
<div class="line">      <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#aa2081bd3d3d518a38497f664b0e498bc">TanhSolnForLinearWave::exact_dudt</a>(time_pt()-&gt;time(),x);</div>
<div class="line">     <span class="keywordtype">double</span> d2udt2_exact=</div>
<div class="line">      <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a63b7a0f5fd5d06cc2c0a43322a81fe43">TanhSolnForLinearWave::exact_d2udt2</a>(time_pt()-&gt;time(),x);</div>
<div class="line">    </div>
<div class="line">     <span class="comment">// Get Newmark approximations for zero-th, first and second </span></div>
<div class="line">     <span class="comment">// time-derivatives of the nodal values. </span></div>
<div class="line">     <span class="keywordtype">double</span> u_fe=timestepper_pt-&gt;time_derivative(0,nod_pt,0);</div>
<div class="line">     <span class="keywordtype">double</span> dudt_fe=timestepper_pt-&gt;time_derivative(1,nod_pt,0);</div>
<div class="line">     <span class="keywordtype">double</span> d2udt2_fe=timestepper_pt-&gt;time_derivative(2,nod_pt,0);</div>
<div class="line">     </div>
<div class="line">     <span class="comment">// Error</span></div>
<div class="line">     <span class="keywordtype">double</span> error=sqrt(pow(u_exact-u_fe,2)+</div>
<div class="line">                       pow(dudt_exact-dudt_fe,2)+</div>
<div class="line">                       pow(d2udt2_exact-d2udt2_fe,2));</div>
<div class="line">     <span class="keywordflow">if</span> (error&gt;err_max) err_max=error;</div>
<div class="line">    }</div>
<div class="line">   cout &lt;&lt; <span class="stringliteral">&quot;Max. error in assignment of initial condition &quot;</span> </div>
<div class="line">        &lt;&lt; err_max &lt;&lt; std::endl;   </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of set initial condition</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="doc"></a>
Post processing</h1>
<p >The post-processing routine is practically identical to that in the <a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html">corresponding unsteady heat example</a>. We output the solution, and compare the computed and exact solutions.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">//===start_of_doc_solution================================================</span><span class="comment"></span></div>
<div class="line"><span class="comment">/// Doc the solution</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT, <span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#a6d9396a693be0479ece9ac1f14f9233a">LinearWaveProblem&lt;ELEMENT,TIMESTEPPER&gt;::doc_solution</a>(DocInfo&amp; doc_info)</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> ofstream some_file;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of plot points</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> npts;</div>
<div class="line"> npts=5; </div>
<div class="line"> </div>
<div class="line"> cout &lt;&lt; std::endl;</div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;=================================================&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;Docing solution for t=&quot;</span> &lt;&lt; time_pt()-&gt;time() &lt;&lt; std::endl;</div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;=================================================&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output solution </span></div>
<div class="line"> <span class="comment">//-----------------</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> mesh_pt()-&gt;output(some_file,npts);</div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot;TEXT X=2.5,Y=93.6,F=HELV,HU=POINT,C=BLUE,H=26,T=\&quot;time = &quot;</span> </div>
<div class="line">           &lt;&lt; time_pt()-&gt;time() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;</div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot;GEOMETRY X=2.5,Y=98,T=LINE,C=BLUE,LT=0.4&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot;1&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot;2&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file &lt;&lt; <span class="stringliteral">&quot; 0 0&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file &lt;&lt; time_pt()-&gt;time()*20.0 &lt;&lt; <span class="stringliteral">&quot; 0&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output exact solution </span></div>
<div class="line"> <span class="comment">//----------------------</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/exact_soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> oomph_info &lt;&lt; <span class="stringliteral">&quot; FILENAME: &quot;</span> &lt;&lt; filename &lt;&lt; std::endl;</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> mesh_pt()-&gt;output_fct(some_file,npts,time_pt()-&gt;time(),</div>
<div class="line">                        <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a7dd7e9f155d19f871ba87d3fe41fd8e9">TanhSolnForLinearWave::get_exact_u</a>); </div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Doc error</span></div>
<div class="line"> <span class="comment">//----------</span></div>
<div class="line"> <span class="keywordtype">double</span> error,norm;</div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/error%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> mesh_pt()-&gt;compute_error(some_file,</div>
<div class="line">                          <a class="code hl_function" href="namespaceTanhSolnForLinearWave.html#a7dd7e9f155d19f871ba87d3fe41fd8e9">TanhSolnForLinearWave::get_exact_u</a>,</div>
<div class="line">                          time_pt()-&gt;time(),</div>
<div class="line">                          error,norm); </div>
<div class="line"> some_file.close();</div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;error: &quot;</span> &lt;&lt; error &lt;&lt; std::endl; </div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;norm : &quot;</span> &lt;&lt; norm &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Write trace file</span></div>
<div class="line"> Trace_file &lt;&lt; time_pt()-&gt;time() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; time_pt()-&gt;dt()</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mesh_pt()-&gt;nelement() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; error &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; norm &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of doc solution</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="unsteady_run"></a>
The timestepping loop</h1>
<p >Timestepping the linear wave equation involves exactly the same steps as in the <a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html">unsteady heat example:</a> We start by creating a <code>DocInfo</code> object to specify the output directories and open the trace file in which we record the time-evolution of the error.</p>
<div class="fragment"><div class="line"><span class="comment">//===start_of_unsteady_run================================================</span></div>
<div class="line"><span class="comment">/// Unsteady run.</span></div>
<div class="line"><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT, <span class="keyword">class</span> TIMESTEPPER&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classLinearWaveProblem.html#a9993365201bfffcc04dd2034f0d3d391">LinearWaveProblem&lt;ELEMENT,TIMESTEPPER&gt;::unsteady_run</a>()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup labels for output</span></div>
<div class="line"> DocInfo doc_info;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output directory</span></div>
<div class="line"> <span class="keywordflow">if</span> (Impulsive_start)</div>
<div class="line">  {</div>
<div class="line">   doc_info.set_directory(<span class="stringliteral">&quot;RESLT_impulsive&quot;</span>); </div>
<div class="line">  }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">   doc_info.set_directory(<span class="stringliteral">&quot;RESLT_smooth&quot;</span>); </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Open trace file</span></div>
<div class="line"> <span class="keywordtype">char</span> filename[100];   </div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/trace.dat&quot;</span>,doc_info.directory().c_str());</div>
<div class="line"> Trace_file.open(filename);</div>
</div><!-- fragment --><p> We then initialise the time, set the initial condition and output the initial solution.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Initialise time</span></div>
<div class="line"> <span class="keywordtype">double</span> time0=0.0;</div>
<div class="line"> time_pt()-&gt;time()=time0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set initial timestep</span></div>
<div class="line"> <span class="keywordtype">double</span> dt=0.005;</div>
<div class="line"> time_pt()-&gt;initialise_dt(dt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set IC</span></div>
<div class="line"> set_initial_condition();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Output initial condition</span></div>
<div class="line"> doc_solution(doc_info);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Increment counter for solutions </span></div>
<div class="line"> doc_info.number()++;</div>
</div><!-- fragment --><p> Next we set up the number of timesteps to be performed. If the code is run in validation mode, indicated by a non-zero number of command line arguments, we only perform two timesteps. <br  />
</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Maximum time</span></div>
<div class="line"> <span class="keywordtype">double</span> t_max=4.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of steps</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nstep=unsigned(t_max/dt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// If validation run only do 2 timesteps</span></div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::Argc&gt;1)</div>
<div class="line">  { </div>
<div class="line">   nstep=2; </div>
<div class="line">   cout &lt;&lt; <span class="stringliteral">&quot;Validation run -- only doing two timesteps.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
</div><!-- fragment --><p> Finally, we loop over the timesteps, solve the equations at each time level and document the results.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Timestepping loop</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> istep=0;istep&lt;nstep;istep++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">//Take fixed timestep without spatial adaptivity</span></div>
<div class="line">   unsteady_newton_solve(dt);</div>
<div class="line">      </div>
<div class="line">   <span class="comment">//Output solution</span></div>
<div class="line">   doc_solution(doc_info);</div>
<div class="line">     </div>
<div class="line">   <span class="comment">//Increment counter for solutions </span></div>
<div class="line">   doc_info.number()++;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Close trace file</span></div>
<div class="line"> Trace_file.close();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of unsteady run</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="comments"></a>
Comments and Exercises</h1>
<h2><a class="anchor" id="default"></a>
Default parameters for the linear wave equations</h2>
<p >The linear wave equation does not contain any parameters, therefore the <code>Problem</code> constructor only passed the pointer to the pointer to the source function to the elements. Passing the pointer to the source function is optional &ndash; if no source function pointer is specified, the linear-wave elements will use the default <img class="formulaInl" alt="$ f(x_1,x_2,t)=0 $" src="form_20.png" width="81" height="14"/> , so that the unforced linear wave equation is solved. You should confirm this by commenting out the assignment of the source function pointer in the Problem constructor &ndash; the code should (and does!) still compute the correct results. This is because the travelling-wave solution (5) is in fact a solution of the <em>unforced</em> wave equation &ndash; the source function defined in the namespace <code><a class="el" href="namespaceTanhSolnForLinearWave.html" title="Namespace for exact solution for LinearWave equation with sharp step.">TanhSolnForLinearWave</a></code> implements <img class="formulaInl" alt="$ f(x_1,x_2,t)=0 $" src="form_20.png" width="81" height="14"/> .</p>
<h2><a class="anchor" id="imp_soln"></a>
The errors induced by an impulsive start</h2>
<ol type="1">
<li>View <a href="../figures/impulsive_wave_solution.avi">the animation of the results obtained from the simulation that was started impulsively </a> and explain how the differences to the exact solution arise.</li>
<li>Does the error induced by the impulsive start decay with time? Contrast this with the behaviour in the <a href="../../../unsteady_heat/two_d_unsteady_heat/html/index.html">unsteady heat example. </a></li>
</ol>
<h2><a class="anchor" id="flux"></a>
The use of Neumann boundary conditions.</h2>
<p >Neumann ("flux") boundary conditions for the linear wave equation can be applied by attaching elements of type <code>LinearWaveFluxElement&lt;BULK_LINEAR_WAVE_ELEMENT&gt;</code> to the boundary in exactly the same way as in the <a href="../../../poisson/two_d_poisson_flux_bc2/html/index.html">Poisson </a> and <a href="../../../unsteady_heat/two_d_unsteady_heat_adapt/html/index.html">unsteady heat </a> examples. We will therefore not discuss this case in detail but simply refer to the listing of the (well-documented) <a href="../../../../demo_drivers/linear_wave/two_d_linear_wave/two_d_linear_wave_flux.cc">driver code two_d_linear_wave_flux.cc</a></p>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory: <center> <a href="../../../../demo_drivers/linear_wave/two_d_linear_wave/">demo_drivers/linear_wave/two_d_linear_wave/ </a> </center></li>
<li>The driver code is: <center> <a href="../../../../demo_drivers/linear_wave/two_d_linear_wave/two_d_linear_wave.cc">demo_drivers/linear_wave/two_d_linear_wave/two_d_linear_wave.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p >A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Mon May 9 2022 09:58:05
        </div>
      </div>
    </footer>
</body>
</html>
