\hypertarget{refineable__mesh_8cc_source}{}\doxysection{refineable\+\_\+mesh.\+cc}
\label{refineable__mesh_8cc_source}\index{refineable\_mesh.cc@{refineable\_mesh.cc}}
\mbox{\hyperlink{refineable__mesh_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2021 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00028}00028 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00029}00029 \textcolor{preprocessor}{\#include "{}mpi.h"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00030}00030 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00032}00032 \textcolor{preprocessor}{\#include <cstdlib>}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00033}00033 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00034}00034 \textcolor{preprocessor}{\#include <limits>}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00036}00036 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{refineable__mesh_8h}{refineable\_mesh.h}}"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00037}00037 \textcolor{comment}{// Include to fill in additional\_synchronise\_hanging\_nodes() function}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00038}00038 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{refineable__mesh_8template_8cc}{refineable\_mesh.template.cc}}"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00039}00039 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00040}00040 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00041}00041 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00042}00042   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00043}00043 \textcolor{comment}{  /// Get refinement pattern of mesh: Consider the hypothetical mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00044}00044 \textcolor{comment}{  /// obtained by truncating the refinement of the current mesh to a given level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00045}00045 \textcolor{comment}{  /// (where \(\backslash\)c level=0 is the un-\/refined base mesh). To advance}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00046}00046 \textcolor{comment}{  /// to the next refinement level, we need to refine (split) the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00047}00047 \textcolor{comment}{  /// \(\backslash\)c to\_be\_refined[level].size() elements identified by the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00048}00048 \textcolor{comment}{  /// element numbers contained in \(\backslash\)c vector to\_be\_refined[level][...]}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00049}00049 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00050}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dba989c0d0735d8fe34ceb231425401}{00050}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dba989c0d0735d8fe34ceb231425401}{TreeBasedRefineableMeshBase::get\_refinement\_pattern}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00051}00051     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>\& to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00052}00052   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00053}00053     \textcolor{comment}{// Extract *all* elements from current (fully refined) mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00054}00054     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} all\_tree\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00055}00055     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a40bd3735303f019892b03d6a5355c8db}{stick\_all\_tree\_nodes\_into\_vector}}(all\_tree\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00057}00057     \textcolor{comment}{// Find out maximum refinement level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00058}00058     \textcolor{keywordtype}{unsigned} max\_level = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00059}00059     \textcolor{keywordtype}{unsigned} nnodes = all\_tree\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00060}00060     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nnodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00061}00061     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00062}00062       \textcolor{keywordtype}{unsigned} level = all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>level();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00063}00063       \textcolor{keywordflow}{if} (level > max\_level) max\_level = level;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00064}00064     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00066}00066     \textcolor{comment}{// Assign storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00067}00067     to\_be\_refined.clear();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00068}00068     to\_be\_refined.resize(max\_level);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00069}00069     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} el\_count(max\_level);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00071}00071     \textcolor{comment}{// Initialise count of elements that exist in mesh when refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00072}00072     \textcolor{comment}{// has proceeded to this level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00073}00073     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < max\_level; l++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00074}00074     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00075}00075       el\_count[l] = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00076}00076     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00077}00077 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00078}00078     \textcolor{comment}{// Loop over all levels and extract all elements that exist}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00079}00079     \textcolor{comment}{// in reference mesh when refinement has proceeded to this level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00080}00080     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < max\_level; l++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00081}00081     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00082}00082       \textcolor{comment}{// Loop over all elements (tree nodes)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00083}00083       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nnodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00084}00084       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00085}00085         \textcolor{comment}{// What level does this element exist on?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00086}00086         \textcolor{keywordtype}{unsigned} level = all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>level();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00088}00088         \textcolor{comment}{// Element is part of the mesh at this refinement level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00089}00089         \textcolor{comment}{// if it exists at this level OR if it exists at a lower level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00090}00090         \textcolor{comment}{// and is a leaf}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00091}00091         \textcolor{keywordflow}{if} ((level == l) || ((level < l) \&\& (all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>is\_leaf())))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00092}00092         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00093}00093           \textcolor{comment}{// If element exsts at this level and is not a leaf it will}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00094}00094           \textcolor{comment}{// be refined when we move to the next level:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00095}00095           \textcolor{keywordflow}{if} ((level == l) \&\& (!all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>is\_leaf()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00096}00096           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00097}00097             \textcolor{comment}{// Add element number (in mesh at current refinement level)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00098}00098             \textcolor{comment}{// to the list of elements that need to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00099}00099             to\_be\_refined[l].push\_back(el\_count[l]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00100}00100           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00101}00101           \textcolor{comment}{// Element exists in this mesh: Add to counter}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00102}00102           el\_count[l]++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00103}00103         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00104}00104       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00105}00105     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00106}00106   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00107}00107 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00108}00108   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00109}00109 \textcolor{comment}{  /// Extract the elements at a particular refinement level in}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00110}00110 \textcolor{comment}{  /// the refinement pattern (used in Mesh::redistribute or whatever it's}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00111}00111 \textcolor{comment}{  /// going to be called (RefineableMeshBase::reduce\_halo\_layers or something)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00112}00112 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00113}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0d5d1cfce0db7953c21eef213049c433}{00113}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0d5d1cfce0db7953c21eef213049c433}{TreeBasedRefineableMeshBase::get\_elements\_at\_refinement\_level}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00114}00114     \textcolor{keywordtype}{unsigned}\& refinement\_level, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<RefineableElement*>}}\& level\_elements)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00115}00115   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00116}00116     \textcolor{comment}{// Extract *all* elements from current (fully refined) mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00117}00117     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} all\_tree\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00118}00118     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a40bd3735303f019892b03d6a5355c8db}{stick\_all\_tree\_nodes\_into\_vector}}(all\_tree\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00119}00119 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00120}00120     \textcolor{comment}{// Add the element to the vector if its level matches refinement\_level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00121}00121     \textcolor{keywordtype}{unsigned} nnodes = all\_tree\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00122}00122     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nnodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00123}00123     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00124}00124       \textcolor{keywordtype}{unsigned} level = all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>level();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00125}00125       \textcolor{keywordflow}{if} (level == refinement\_level)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00126}00126       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00127}00127         level\_elements.push\_back(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00128}00128           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(all\_tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00129}00129       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00130}00130     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00131}00131   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00132}00132 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00133}00133   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00134}00134 \textcolor{comment}{  /// Refine original, unrefined mesh according to specified refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00135}00135 \textcolor{comment}{  /// pattern (relative to original, unrefined mesh).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00136}00136 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00137}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a77c2eb2c650ba34c79cf3b156204ee3b}{00137}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a77c2eb2c650ba34c79cf3b156204ee3b}{TreeBasedRefineableMeshBase::refine\_base\_mesh}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00138}00138     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>\& to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00139}00139   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00140}00140     \textcolor{comment}{// Get mesh back to unrefined state}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00141}00141     \textcolor{keywordtype}{unsigned} my\_max, my\_min;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00142}00142     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4321288b6642d5057498f7659d76}{get\_refinement\_levels}}(my\_min, my\_max);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00143}00143 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00144}00144     \textcolor{comment}{// Max refinement level:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00145}00145     \textcolor{keywordtype}{unsigned} my\_max\_level = to\_be\_refined.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00146}00146 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00147}00147     \textcolor{keywordtype}{unsigned} global\_max = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00148}00148     \textcolor{keywordtype}{unsigned} global\_max\_level = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00149}00149     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} data(2, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00150}00150     data[0] = my\_max;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00151}00151     data[1] = my\_max\_level;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00152}00152     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} global\_data(2, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00153}00153 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00154}00154     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00155}00155     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00156}00156       MPI\_Allreduce(\&data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00157}00157                     \&global\_data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00158}00158                     2,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00159}00159                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00160}00160                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00161}00161                     \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00162}00162       global\_max = global\_data[0];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00163}00163       global\_max\_level = global\_data[1];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00164}00164     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00165}00165     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00166}00166 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00167}00167     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00168}00168       global\_max = my\_max;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00169}00169       global\_max\_level = my\_max\_level;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00170}00170     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00172}00172 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00173}00173     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < global\_max; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00174}00174     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00175}00175       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a52940028ba9f6472df7e7c65be265057}{unrefine\_uniformly}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00176}00176     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00177}00177 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00178}00178     \textcolor{comment}{// Do refinement steps in current mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00179}00179     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < global\_max\_level; l++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00180}00180     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00181}00181       \textcolor{comment}{// Loop over elements that need to be refined at this level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00182}00182       \textcolor{keywordtype}{unsigned} n\_to\_be\_refined = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00183}00183       \textcolor{keywordflow}{if} (l < my\_max\_level) n\_to\_be\_refined = to\_be\_refined[l].size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00184}00184 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00185}00185       \textcolor{comment}{// Select relevant elements to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00186}00186       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_to\_be\_refined; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00187}00187       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00188}00188         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(to\_be\_refined[l][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00189}00189           -\/>select\_for\_refinement();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00190}00190       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00191}00191 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00192}00192       \textcolor{comment}{// Now do the actual mesh refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00193}00193       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a64608ddedb7eb56e11bee2805aa01360}{adapt\_mesh}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00194}00194     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00195}00195   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00196}00196 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00197}00197 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00198}00198   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00199}00199 \textcolor{comment}{  /// Refine base mesh according to refinement pattern in restart file}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00200}00200 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00201}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a5753ea33897c77342d00644bef86ba74}{00201}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a5753ea33897c77342d00644bef86ba74}{TreeBasedRefineableMeshBase::refine}}(std::ifstream\& restart\_file)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00202}00202   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00203}00203     \textcolor{comment}{// Assign storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00204}00204     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> to\_be\_refined;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00205}00205 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00206}00206     \textcolor{comment}{// Read refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00207}00207     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0c601c4e58e2d7dcfe587739f17e44e9}{read\_refinement}}(restart\_file, to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00208}00208 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00209}00209     \textcolor{comment}{// Refine}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00210}00210     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a77c2eb2c650ba34c79cf3b156204ee3b}{refine\_base\_mesh}}(to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00211}00211   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00212}00212 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00213}00213 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00214}00214   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00215}00215 \textcolor{comment}{  /// Dump refinement pattern to allow for rebuild}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00216}00216 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00217}00217 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00218}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a2398683f533e5ba0960fbbe9ff545fb2}{00218}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a2398683f533e5ba0960fbbe9ff545fb2}{TreeBasedRefineableMeshBase::dump\_refinement}}(std::ostream\& outfile)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00219}00219   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00220}00220     \textcolor{comment}{// Assign storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00221}00221     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> to\_be\_refined;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00222}00222 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00223}00223     \textcolor{comment}{// Get refinement pattern of reference mesh:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00224}00224     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dba989c0d0735d8fe34ceb231425401}{get\_refinement\_pattern}}(to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00225}00225 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00226}00226     \textcolor{comment}{// Dump max refinement level:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00227}00227     \textcolor{keywordtype}{unsigned} max\_level = to\_be\_refined.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00228}00228     outfile << max\_level << \textcolor{stringliteral}{"{} \# max. refinement level "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00229}00229 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00230}00230     \textcolor{comment}{// Doc the numbers of the elements that need to be refined at this level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00231}00231     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < max\_level; l++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00232}00232     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00233}00233       \textcolor{comment}{// Loop over elements that need to be refined at this level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00234}00234       \textcolor{keywordtype}{unsigned} n\_to\_be\_refined = to\_be\_refined[l].size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00235}00235       outfile << n\_to\_be\_refined << \textcolor{stringliteral}{"{} \# number of elements to be refined. "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00236}00236               << \textcolor{stringliteral}{"{}What follows are the numbers of the elements. "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00237}00237 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00238}00238       \textcolor{comment}{// Select relevant elements to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00239}00239       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_to\_be\_refined; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00240}00240       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00241}00241         outfile << to\_be\_refined[l][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00242}00242       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00243}00243     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00244}00244   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00245}00245 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00246}00246 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00247}00247   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00248}00248 \textcolor{comment}{  /// Read refinement pattern to allow for rebuild}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00249}00249 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00250}00250 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00251}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0c601c4e58e2d7dcfe587739f17e44e9}{00251}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0c601c4e58e2d7dcfe587739f17e44e9}{TreeBasedRefineableMeshBase::read\_refinement}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00252}00252     std::ifstream\& restart\_file, \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}>\& to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00253}00253   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00254}00254     \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} input\_string;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00255}00255 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00256}00256     \textcolor{comment}{// Read max refinement level:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00257}00257 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00258}00258     \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00259}00259     getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00260}00260 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00261}00261     \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00262}00262     restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00263}00263 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00264}00264     \textcolor{comment}{// Convert}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00265}00265     \textcolor{keywordtype}{unsigned} max\_level = std::atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00266}00266 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00267}00267     \textcolor{comment}{// Assign storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00268}00268     to\_be\_refined.resize(max\_level);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00269}00269 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00270}00270     \textcolor{comment}{// Read the number of the elements that need to be refined at different}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00271}00271     \textcolor{comment}{// levels}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00272}00272     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < max\_level; l++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00273}00273     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00274}00274       \textcolor{comment}{// Read line up to termination sign}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00275}00275       getline(restart\_file, input\_string, \textcolor{charliteral}{'\#'});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00276}00276 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00277}00277       \textcolor{comment}{// Ignore rest of line}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00278}00278       restart\_file.ignore(80, \textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00279}00279 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00280}00280       \textcolor{comment}{// Convert}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00281}00281       \textcolor{keywordtype}{unsigned} n\_to\_be\_refined = atoi(input\_string.c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00282}00282       ;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00283}00283 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00284}00284       \textcolor{comment}{// Assign storage}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00285}00285       to\_be\_refined[l].resize(n\_to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00286}00286 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00287}00287       \textcolor{comment}{// Read numbers of the elements that need to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00288}00288       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_to\_be\_refined; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00289}00289       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00290}00290         restart\_file >> to\_be\_refined[l][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00291}00291       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00292}00292     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00293}00293   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00294}00294 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00295}00295 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00296}00296   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00297}00297 \textcolor{comment}{  /// Do adaptive refinement for mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00298}00298 \textcolor{comment}{  /// -\/ Pass Vector of error estimates for all elements.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00299}00299 \textcolor{comment}{  /// -\/ Refine those whose errors exceeds the threshold}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00300}00300 \textcolor{comment}{  /// -\/ (Try to) unrefine those whose errors is less than}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00301}00301 \textcolor{comment}{  ///   threshold (only possible if the three brothers also want to be}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00302}00302 \textcolor{comment}{  ///   unrefined, of course.)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00303}00303 \textcolor{comment}{  /// -\/ Update the nodal positions in the whole lot}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00304}00304 \textcolor{comment}{  /// -\/ Store \# of refined/unrefined elements.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00305}00305 \textcolor{comment}{  /// -\/ Doc refinement process (if required)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00306}00306 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00307}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ac98d4120b99d5c6cbcf7225a9ee5648d}{00307}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ac98d4120b99d5c6cbcf7225a9ee5648d}{TreeBasedRefineableMeshBase::adapt}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& elemental\_error)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00308}00308   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00309}00309     \textcolor{comment}{// Set the refinement tolerance to be the max permissible error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00310}00310     \textcolor{keywordtype}{double} refine\_tol = \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_aebcb375a38f7491b52c1f5c757d51fd3}{max\_permitted\_error}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00311}00311 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00312}00312     \textcolor{comment}{// Set the unrefinement tolerance to be the min permissible error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00313}00313     \textcolor{keywordtype}{double} unrefine\_tol = \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1bb8bffa773bed50db992c9732c7665c}{min\_permitted\_error}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00314}00314 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00315}00315     \textcolor{comment}{// Setup doc info}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00316}00316     \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}} local\_doc\_info;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00317}00317     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a2615c121a310c1c0977637bf9cb34a7d}{doc\_info\_pt}}() == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00318}00318     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00319}00319       local\_doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a666a20817ab9c396b225d8652bc0a338}{disable\_doc}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00320}00320     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00321}00321     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00322}00322     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00323}00323       local\_doc\_info = \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00324}00324     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00325}00325 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00326}00326 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00327}00327     \textcolor{comment}{// Check that the errors make sense}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00328}00328     \textcolor{keywordflow}{if} (refine\_tol <= unrefine\_tol)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00329}00329     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00330}00330       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00331}00331       error\_stream << \textcolor{stringliteral}{"{}Refinement tolerance <= Unrefinement tolerance"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00332}00332                    << refine\_tol << \textcolor{stringliteral}{"{} "{}} << unrefine\_tol << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00333}00333                    << \textcolor{stringliteral}{"{}doesn't make sense and will almost certainly crash"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00334}00334                    << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00335}00335                    << \textcolor{stringliteral}{"{}this beautiful code!"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00336}00336 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00337}00337       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00338}00338         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00339}00339     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00340}00340 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00341}00341 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00342}00342     \textcolor{comment}{// Select elements for refinement and unrefinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00343}00343     \textcolor{comment}{//================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00344}00344     \textcolor{comment}{// Reset counter for number of elements that would like to be}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00345}00345     \textcolor{comment}{// refined further but can't}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00346}00346     \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a54749f251f0ac4b33fa3e95d2c19ec38}{nrefinement\_overruled}}() = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00347}00347 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00348}00348     \textcolor{comment}{// Note: Yes, this needs to be a map because we'll have to check}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00349}00349     \textcolor{comment}{// the refinement wishes of brothers (who we only access via pointers)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00350}00350     std::map<RefineableElement*, bool> wants\_to\_be\_unrefined;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00351}00351 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00352}00352     \textcolor{comment}{// Initialise a variable to store the number of elements for refinment}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00353}00353     \textcolor{keywordtype}{unsigned} n\_refine = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00354}00354 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00355}00355     \textcolor{comment}{// Loop over all elements and mark them according to the error criterion}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00356}00356     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Nelement = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00357}00357     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Nelement; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00358}00358     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00359}00359       \textcolor{comment}{// (Cast) pointer to the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00360}00360       \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00361}00361         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00362}00362 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00363}00363       \textcolor{comment}{// Initially element is not to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00364}00364       el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a984bf7bf6132e11648e3e54845d852b7}{deselect\_for\_refinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00365}00365 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00366}00366       \textcolor{comment}{// If the element error exceeds the threshold ...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00367}00367       \textcolor{keywordflow}{if} (elemental\_error[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] > refine\_tol)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00368}00368       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00369}00369         \textcolor{comment}{// ... and its refinement level is less than the maximum desired level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00370}00370         \textcolor{comment}{// mark is to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00371}00371         \textcolor{keywordflow}{if} ((el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a8f5e9e69342ed6258c6f450fec4d0999}{refinement\_is\_enabled}}()) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00372}00372             (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a6b9153d7933baf6092febaca278a6fc7}{refinement\_level}}() < \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6fc73b3052bd60ffd39e0a07ae6e6ab3}{max\_refinement\_level}}()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00373}00373         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00374}00374           el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a2a129d9c143cb0bb330c1bcba0343826}{select\_for\_refinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00375}00375           n\_refine++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00376}00376         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00377}00377         \textcolor{comment}{// ... otherwise mark it as having been over-\/ruled}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00378}00378         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00379}00379         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00380}00380           \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a54749f251f0ac4b33fa3e95d2c19ec38}{nrefinement\_overruled}}() += 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00381}00381         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00382}00382       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00383}00383 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00384}00384       \textcolor{comment}{// Now worry about unrefinement (first pass):}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00385}00385 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00386}00386       \textcolor{comment}{// Is my error too small AND do I have a father?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00387}00387       \textcolor{keywordflow}{if} ((elemental\_error[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] < unrefine\_tol) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00388}00388           (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_aa2918f6d84795c9f366adb178e287843}{father\_pt}}() != 0))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00389}00389       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00390}00390         \textcolor{comment}{// Flag to indicate whether to unrefine}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00391}00391         \textcolor{keywordtype}{bool} unrefine = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00392}00392         \textcolor{keywordtype}{unsigned} n\_sons = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_aa2918f6d84795c9f366adb178e287843}{father\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a31e4123b40f6fb52d180a154c9123e85}{nsons}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00393}00393 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00394}00394         \textcolor{comment}{// Are all brothers leaf nodes?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00395}00395         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ison = 0; ison < n\_sons; ison++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00396}00396         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00397}00397           \textcolor{comment}{// (At least) one brother is not a leaf: end of story; we're not doing}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00398}00398           \textcolor{comment}{// it (= the unrefinement)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00399}00399           \textcolor{keywordflow}{if} (!(el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_aa2918f6d84795c9f366adb178e287843}{father\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a9851a9dd06212b6891ce9a8bc832d4cf}{son\_pt}}(ison)-\/>\mbox{\hyperlink{classoomph_1_1Tree_a72000456c76880e3f78f8f8fb43d49d8}{is\_leaf}}()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00400}00400           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00401}00401             unrefine = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00402}00402           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00403}00403         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00404}00404 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00405}00405         \textcolor{comment}{// Don't allow unrefinement of elements that would become larger}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00406}00406         \textcolor{comment}{// than the minimum legal refinement level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00407}00407         \textcolor{keywordflow}{if} (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a6b9153d7933baf6092febaca278a6fc7}{refinement\_level}}() -\/ 1 < \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a5e68b05c7b029384039d5d9bb6aa6ca8}{min\_refinement\_level}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00408}00408         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00409}00409           unrefine = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00410}00410         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00411}00411 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00412}00412         \textcolor{comment}{// So, all things considered, is the element eligbible for refinement?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00413}00413         \textcolor{keywordflow}{if} (unrefine)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00414}00414         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00415}00415           wants\_to\_be\_unrefined[el\_pt] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00416}00416         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00417}00417         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00418}00418         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00419}00419           wants\_to\_be\_unrefined[el\_pt] = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00420}00420         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00421}00421       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00422}00422     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00423}00423 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00424}00424     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} \(\backslash\)n Number of elements to be refined: "{}} << n\_refine}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00425}00425                << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00426}00426     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} \(\backslash\)n Number of elements whose refinement was overruled: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00427}00427                << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a54749f251f0ac4b33fa3e95d2c19ec38}{nrefinement\_overruled}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00428}00428 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00429}00429     \textcolor{comment}{// Second pass for unrefinement -\/-\/-\/ an element cannot be unrefined unless}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00430}00430     \textcolor{comment}{// all brothers want to be unrefined.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00431}00431     \textcolor{comment}{// Loop over all elements again and let the first set of sons check if their}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00432}00432     \textcolor{comment}{// brothers also want to be unrefined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00433}00433     \textcolor{keywordtype}{unsigned} n\_unrefine = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00434}00434     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Nelement; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00435}00435     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00436}00436       \textcolor{comment}{//(Cast) pointer to the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00437}00437       \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00438}00438         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00439}00439 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00440}00440       \textcolor{comment}{// hierher: This is a bit naughty... We want to put the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00441}00441       \textcolor{comment}{// first son in charge -\/-\/ the statement below assumes (correctly) that the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00442}00442       \textcolor{comment}{// enumeration of all (!) trees starts with son types.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00443}00443       \textcolor{comment}{// This is correct for oc and quadtrees but will bite us if we}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00444}00444       \textcolor{comment}{// ever introduce other trees if/when we accidentally break this}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00445}00445       \textcolor{comment}{// tacit assumption. Not sure what to do about it for}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00446}00446       \textcolor{comment}{// now other than leaving it hierher-\/ed...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00447}00447       \textcolor{keywordflow}{if} (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a7537f8fe7c896d2220eb2da03567b34d}{son\_type}}() == \mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40abed39d2cabdadba8a0746381691ccf77}{OcTreeNames::LDB}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00448}00448       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00449}00449         \textcolor{comment}{// Do all sons want to be unrefined?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00450}00450         \textcolor{keywordtype}{bool} unrefine = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00451}00451         \textcolor{keywordtype}{unsigned} n\_sons = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_aa2918f6d84795c9f366adb178e287843}{father\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a31e4123b40f6fb52d180a154c9123e85}{nsons}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00452}00452         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ison = 0; ison < n\_sons; ison++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00453}00453         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00454}00454           \textcolor{keywordflow}{if} (!(wants\_to\_be\_unrefined[\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00455}00455                 el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_aa2918f6d84795c9f366adb178e287843}{father\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Tree_a9851a9dd06212b6891ce9a8bc832d4cf}{son\_pt}}(ison)-\/>\mbox{\hyperlink{classoomph_1_1Tree_a7d630dad19ef861ab6a5f37ad6ea67f4}{object\_pt}}())]))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00456}00456           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00457}00457             \textcolor{comment}{// One guy isn't cooperating and spoils the party.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00458}00458             unrefine = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00459}00459           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00460}00460         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00461}00461 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00462}00462         \textcolor{comment}{// Tell father that his sons need to be merged}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00463}00463         \textcolor{keywordflow}{if} (unrefine)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00464}00464         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00465}00465           el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00466}00466             -\/>\mbox{\hyperlink{classoomph_1_1Tree_aa2918f6d84795c9f366adb178e287843}{father\_pt}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00467}00467             -\/>\mbox{\hyperlink{classoomph_1_1Tree_a7d630dad19ef861ab6a5f37ad6ea67f4}{object\_pt}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00468}00468             -\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a0f756235a17399d9175e05b29efed292}{select\_sons\_for\_unrefinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00469}00469           n\_unrefine += n\_sons;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00470}00470         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00471}00471         \textcolor{comment}{// Otherwise mark the sons as not to be touched}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00472}00472         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00473}00473         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00474}00474           el\_pt-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_a4b783f4e5b6aeed83d49e478510d614f}{tree\_pt}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00475}00475             -\/>\mbox{\hyperlink{classoomph_1_1Tree_aa2918f6d84795c9f366adb178e287843}{father\_pt}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00476}00476             -\/>\mbox{\hyperlink{classoomph_1_1Tree_a7d630dad19ef861ab6a5f37ad6ea67f4}{object\_pt}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00477}00477             -\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_afa0572f14ecd9cc2021f853218d7a659}{deselect\_sons\_for\_unrefinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00478}00478         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00479}00479       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00480}00480     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00481}00481     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} \(\backslash\)n Number of elements to be merged : "{}} << n\_unrefine}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00482}00482                << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00483}00483                << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00484}00484 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00485}00485 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00486}00486     \textcolor{comment}{// Now do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00487}00487     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00488}00488 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00489}00489     \textcolor{comment}{// Check whether its worth our while}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00490}00490     \textcolor{comment}{// Either some elements want to be refined,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00491}00491     \textcolor{comment}{// or the number that want to be unrefined are greater than the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00492}00492     \textcolor{comment}{// specified tolerance}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00493}00493 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00494}00494     \textcolor{comment}{// In a parallel job, it is possible that one process may not have}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00495}00495     \textcolor{comment}{// any elements to refine, BUT a neighbouring process may refine an}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00496}00496     \textcolor{comment}{// element which changes the hanging status of a node that is on}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00497}00497     \textcolor{comment}{// both processes (i.e. a halo(ed) node).  To get around this issue,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00498}00498     \textcolor{comment}{// ALL processes need to call adapt\_mesh if ANY refinement is to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00499}00499     \textcolor{comment}{// take place anywhere.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00500}00500 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00501}00501     \textcolor{keywordtype}{unsigned} total\_n\_refine = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00502}00502 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00503}00503     \textcolor{comment}{// Sum n\_refine across all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00504}00504     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00505}00505     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00506}00506       MPI\_Allreduce(\&n\_refine,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00507}00507                     \&total\_n\_refine,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00508}00508                     1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00509}00509                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00510}00510                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00511}00511                     \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00512}00512     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00513}00513     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00514}00514     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00515}00515       total\_n\_refine = n\_refine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00516}00516     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00517}00517 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00518}00518     total\_n\_refine = n\_refine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00519}00519 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00520}00520 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00521}00521     \textcolor{comment}{// There may be some issues with unrefinement too, but I have not}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00522}00522     \textcolor{comment}{// been able to come up with an example (either in my head or in a}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00523}00523     \textcolor{comment}{// particular problem) where anything has arisen. I can see that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00524}00524     \textcolor{comment}{// there may be an issue if n\_unrefine differs across processes so}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00525}00525     \textcolor{comment}{// that (total\_n\_unrefine > max\_keep\_unrefined()) on some but not}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00526}00526     \textcolor{comment}{// all processes. I haven't seen any examples of this yet so the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00527}00527     \textcolor{comment}{// following code may or may not work!  (Andy, 06/03/08)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00528}00528 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00529}00529     \textcolor{keywordtype}{unsigned} total\_n\_unrefine = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00530}00530 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00531}00531     \textcolor{comment}{// Sum n\_unrefine across all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00532}00532     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00533}00533     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00534}00534       MPI\_Allreduce(\&n\_unrefine,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00535}00535                     \&total\_n\_unrefine,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00536}00536                     1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00537}00537                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00538}00538                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00539}00539                     \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00540}00540     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00541}00541     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00542}00542     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00543}00543       total\_n\_unrefine = n\_unrefine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00544}00544     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00545}00545 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00546}00546     total\_n\_unrefine = n\_unrefine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00547}00547 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00548}00548 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00549}00549     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}-\/-\/-\/> "{}} << total\_n\_refine << \textcolor{stringliteral}{"{} elements to be refined, and "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00550}00550                << total\_n\_unrefine << \textcolor{stringliteral}{"{} to be unrefined, in total.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00551}00551                << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00552}00552 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00553}00553     \textcolor{keywordflow}{if} ((total\_n\_refine > 0) || (total\_n\_unrefine > \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a09009ca14843d8bf7109e90dbcd38635}{max\_keep\_unrefined}}()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00554}00554     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00555}00555 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00556}00556 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00557}00557 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00558}00558 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00559}00559       \textcolor{comment}{// Sanity check: Each processor checks if the enforced unrefinement of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00560}00560       \textcolor{comment}{// its haloed element is matched by enforced unrefinement of the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00561}00561       \textcolor{comment}{// corresponding halo elements on the other processors.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00562}00562       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00563}00563       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00564}00564         \textcolor{comment}{// Store number of processors and current process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00565}00565         MPI\_Status status;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00566}00566         \textcolor{keywordtype}{int} n\_proc = \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00567}00567         \textcolor{keywordtype}{int} my\_rank = \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00568}00568 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00569}00569         \textcolor{comment}{// Loop over processes: Each processor sends unrefinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00570}00570         \textcolor{comment}{// for halo elements with processor d to processor d where it's}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00571}00571         \textcolor{comment}{// compared against the unrefinement pattern for the corresponding}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00572}00572         \textcolor{comment}{// haloed elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00573}00573         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00574}00574         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00575}00575           \textcolor{comment}{// No halo with self: Send unrefinement info to proc d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00576}00576           \textcolor{keywordflow}{if} (d != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00577}00577           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00578}00578             \textcolor{comment}{// Get the vector of halo elements whose non-\/halo counterpart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00579}00579             \textcolor{comment}{// are on processor d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00580}00580             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} halo\_elem\_pt(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}(d));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00581}00581 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00582}00582             \textcolor{comment}{// Create vector containing (0)1 to indicate that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00583}00583             \textcolor{comment}{// halo element is (not) to be unrefined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00584}00584             \textcolor{keywordtype}{unsigned} nhalo = halo\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00585}00585             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} halo\_to\_be\_unrefined(nhalo, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00586}00586             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nhalo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00587}00587             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00588}00588               \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(halo\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00589}00589                     -\/>sons\_to\_be\_unrefined())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00590}00590               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00591}00591                 halo\_to\_be\_unrefined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00592}00592               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00593}00593             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00594}00594 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00595}00595             \textcolor{comment}{// Trap the case when there are no halo elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00596}00596             \textcolor{comment}{// so that we don't get a segfault in the MPI send}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00597}00597             \textcolor{keywordflow}{if} (nhalo > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00598}00598             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00599}00599               \textcolor{comment}{// Send it across to proc d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00600}00600               MPI\_Send(\&halo\_to\_be\_unrefined[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00601}00601                        nhalo,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00602}00602                        MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00603}00603                        d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00604}00604                        0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00605}00605                        \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00606}00606             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00607}00607           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00608}00608           \textcolor{comment}{// else (d=my\_rank): Receive unrefinement pattern from all}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00609}00609           \textcolor{comment}{// other processors (dd)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00610}00610           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00611}00611           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00612}00612             \textcolor{comment}{// Loop over other processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00613}00613             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} dd = 0; dd < n\_proc; dd++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00614}00614             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00615}00615               \textcolor{comment}{// No halo with yourself}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00616}00616               \textcolor{keywordflow}{if} (dd != d)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00617}00617               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00618}00618                 \textcolor{comment}{// Get the vector of haloed elements on current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00619}00619                 \textcolor{comment}{// with processor dd}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00620}00620                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} haloed\_elem\_pt(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00621}00621                   this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(dd));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00622}00622 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00623}00623                 \textcolor{comment}{// Ask processor dd to send vector containing (0)1 for}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00624}00624                 \textcolor{comment}{// halo element with current processor to be (not)unrefined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00625}00625                 \textcolor{keywordtype}{unsigned} nhaloed = haloed\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00626}00626                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} halo\_to\_be\_unrefined(nhaloed);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00627}00627                 \textcolor{comment}{// Trap to catch the case that there are no haloed elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00628}00628                 \textcolor{keywordflow}{if} (nhaloed > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00629}00629                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00630}00630                   \textcolor{comment}{// Receive unrefinement pattern of haloes from proc dd}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00631}00631                   MPI\_Recv(\&halo\_to\_be\_unrefined[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00632}00632                            nhaloed,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00633}00633                            MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00634}00634                            dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00635}00635                            0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00636}00636                            \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00637}00637                            \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00638}00638                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00639}00639 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00640}00640                 \textcolor{comment}{// Check it}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00641}00641                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nhaloed; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00642}00642                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00643}00643                   \textcolor{keywordflow}{if} (((halo\_to\_be\_unrefined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == 0) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00644}00644                        (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00645}00645                           -\/>sons\_to\_be\_unrefined())) ||}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00646}00646                       ((halo\_to\_be\_unrefined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == 1) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00647}00647                        (!\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00648}00648                            -\/>sons\_to\_be\_unrefined())))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00649}00649                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00650}00650                     std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00651}00651                     error\_message}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00652}00652                       << \textcolor{stringliteral}{"{}Error in unrefinement: \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00653}00653                       << \textcolor{stringliteral}{"{}Haloed element: "{}} << \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} << \textcolor{stringliteral}{"{} on proc "{}} << my\_rank}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00654}00654                       << \textcolor{stringliteral}{"{} \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00655}00655                       << \textcolor{stringliteral}{"{}wants to be unrefined whereas its halo counterpart "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00656}00656                          \textcolor{stringliteral}{"{}on\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00657}00657                       << \textcolor{stringliteral}{"{}proc "{}} << dd << \textcolor{stringliteral}{"{} doesn't (or vice versa)...\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00658}00658                       << \textcolor{stringliteral}{"{}This is most likely because the error estimator\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00659}00659                       << \textcolor{stringliteral}{"{}has not assigned the same errors to halo and haloed\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00660}00660                       << \textcolor{stringliteral}{"{}elements -\/-\/ it ought to!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00661}00661                     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00662}00662                                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00663}00663                                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00664}00664                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00665}00665                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00666}00666               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00667}00667             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00668}00668           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00669}00669         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00670}00670 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00671}00671 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00672}00672         \textcolor{comment}{// Loop over processes: Each processor sends refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00673}00673         \textcolor{comment}{// for halo elements with processor d to processor d where it's}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00674}00674         \textcolor{comment}{// compared against the refinement pattern for the corresponding}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00675}00675         \textcolor{comment}{// haloed elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00676}00676         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00677}00677         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00678}00678           \textcolor{comment}{// No halo with self: Send refinement info to proc d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00679}00679           \textcolor{keywordflow}{if} (d != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00680}00680           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00681}00681             \textcolor{comment}{// Get the vector of halo elements whose non-\/halo counterpart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00682}00682             \textcolor{comment}{// are on processor d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00683}00683             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} halo\_elem\_pt(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}(d));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00684}00684 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00685}00685             \textcolor{comment}{// Create vector containing (0)1 to indicate that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00686}00686             \textcolor{comment}{// halo element is (not) to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00687}00687             \textcolor{keywordtype}{unsigned} nhalo = halo\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00688}00688             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} halo\_to\_be\_refined(nhalo, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00689}00689             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nhalo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00690}00690             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00691}00691               \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(halo\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00692}00692                     -\/>to\_be\_refined())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00693}00693               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00694}00694                 halo\_to\_be\_refined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00695}00695               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00696}00696             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00697}00697 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00698}00698             \textcolor{comment}{// Trap the case when there are no halo elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00699}00699             \textcolor{comment}{// so that we don't get a segfault in the MPI send}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00700}00700             \textcolor{keywordflow}{if} (nhalo > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00701}00701             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00702}00702               \textcolor{comment}{// Send it across to proc d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00703}00703               MPI\_Send(\&halo\_to\_be\_refined[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00704}00704                        nhalo,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00705}00705                        MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00706}00706                        d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00707}00707                        0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00708}00708                        \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00709}00709             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00710}00710           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00711}00711           \textcolor{comment}{// else (d=my\_rank): Receive refinement pattern from all}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00712}00712           \textcolor{comment}{// other processors (dd)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00713}00713           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00714}00714           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00715}00715             \textcolor{comment}{// Loop over other processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00716}00716             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} dd = 0; dd < n\_proc; dd++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00717}00717             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00718}00718               \textcolor{comment}{// No halo with yourself}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00719}00719               \textcolor{keywordflow}{if} (dd != d)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00720}00720               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00721}00721                 \textcolor{comment}{// Get the vector of haloed elements on current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00722}00722                 \textcolor{comment}{// with processor dd}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00723}00723                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} haloed\_elem\_pt(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00724}00724                   this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(dd));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00725}00725 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00726}00726                 \textcolor{comment}{// Ask processor dd to send vector containing (0)1 for}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00727}00727                 \textcolor{comment}{// halo element with current processor to be (not)refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00728}00728                 \textcolor{keywordtype}{unsigned} nhaloed = haloed\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00729}00729                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} halo\_to\_be\_refined(nhaloed);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00730}00730                 \textcolor{comment}{// Trap to catch the case that there are no haloed elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00731}00731                 \textcolor{keywordflow}{if} (nhaloed > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00732}00732                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00733}00733                   \textcolor{comment}{// Receive unrefinement pattern of haloes from proc dd}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00734}00734                   MPI\_Recv(\&halo\_to\_be\_refined[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00735}00735                            nhaloed,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00736}00736                            MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00737}00737                            dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00738}00738                            0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00739}00739                            \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00740}00740                            \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00741}00741                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00742}00742 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00743}00743                 \textcolor{comment}{// Check it}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00744}00744                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nhaloed; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00745}00745                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00746}00746                   \textcolor{keywordflow}{if} (((halo\_to\_be\_refined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == 0) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00747}00747                        (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00748}00748                           -\/>to\_be\_refined())) ||}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00749}00749                       ((halo\_to\_be\_refined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == 1) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00750}00750                        (!\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00751}00751                            -\/>to\_be\_refined())))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00752}00752                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00753}00753                     std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00754}00754                     error\_message}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00755}00755                       << \textcolor{stringliteral}{"{}Error in refinement: \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00756}00756                       << \textcolor{stringliteral}{"{}Haloed element: "{}} << \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} << \textcolor{stringliteral}{"{} on proc "{}} << my\_rank}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00757}00757                       << \textcolor{stringliteral}{"{} \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00758}00758                       << \textcolor{stringliteral}{"{}wants to be refined whereas its halo counterpart on\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00759}00759                       << \textcolor{stringliteral}{"{}proc "{}} << dd << \textcolor{stringliteral}{"{} doesn't (or vice versa)...\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00760}00760                       << \textcolor{stringliteral}{"{}This is most likely because the error estimator\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00761}00761                       << \textcolor{stringliteral}{"{}has not assigned the same errors to halo and haloed\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00762}00762                       << \textcolor{stringliteral}{"{}elements -\/-\/ it ought to!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00763}00763                     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00764}00764                                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00765}00765                                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00766}00766                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00767}00767                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00768}00768               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00769}00769             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00770}00770           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00771}00771         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00772}00772       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00773}00773 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00774}00774 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00775}00775 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00776}00776 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00777}00777       \textcolor{comment}{// Perform the actual adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00778}00778       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a64608ddedb7eb56e11bee2805aa01360}{adapt\_mesh}}(local\_doc\_info);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00779}00779 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00780}00780       \textcolor{comment}{// The number of refineable elements is still local to each process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00781}00781       \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a62c0314a69b2e40355a2aa27ff5ea133}{Nunrefined}} = n\_unrefine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00782}00782       \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1a35c13c3c37ddc5ac2852217d903459}{Nrefined}} = n\_refine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00783}00783     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00784}00784     \textcolor{comment}{// If not worthwhile, say so but still reorder nodes and kill}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00785}00785     \textcolor{comment}{// external storage for consistency in parallel computations}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00786}00786     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00787}00787     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00788}00788 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00789}00789       \textcolor{comment}{// Delete any external element storage -\/ any interaction will still}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00790}00790       \textcolor{comment}{// be set up on the fly again, so we need to get rid of old information.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00791}00791       \textcolor{comment}{// This particularly causes problems in multi-\/domain examples where}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00792}00792       \textcolor{comment}{// we decide not to refine one of the meshes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00793}00793       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9e3ecb07dc622cf37ce0085446ff9aa6}{delete\_all\_external\_storage}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00794}00794 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00795}00795 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00796}00796       \textcolor{comment}{// Reorder the nodes within the mesh's node vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00797}00797       \textcolor{comment}{// to establish a standard ordering regardless of the sequence}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00798}00798       \textcolor{comment}{// of mesh refinements -\/-\/ this is required to allow dump/restart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00799}00799       \textcolor{comment}{// on refined meshes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00800}00800       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a801e77424d1bf8a35c9bba055230f1e3}{reorder\_nodes}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00801}00801 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00802}00802 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00803}00803 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00804}00804       \textcolor{comment}{// Now (re-\/)classify halo and haloed nodes and synchronise hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00805}00805       \textcolor{comment}{// nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00806}00806       \textcolor{comment}{// This is required in cases where delete\_all\_external\_storage()}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00807}00807       \textcolor{comment}{// made dependent nodes to external halo nodes nonhanging.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00808}00808       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00809}00809       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00810}00810         \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}} \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00811}00811         \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a666a20817ab9c396b225d8652bc0a338}{disable\_doc}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00812}00812         \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aec7c6fc41272ec883c589ee56d1b01e6}{classify\_halo\_and\_haloed\_nodes}}(\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}, \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00813}00813       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00814}00814 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00815}00815 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00816}00816 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00817}00817       \textcolor{keywordflow}{if} (n\_refine == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00818}00818       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00819}00819         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} Not enough benefit in adapting mesh."{}} << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00820}00820                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00821}00821       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00822}00822       \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a62c0314a69b2e40355a2aa27ff5ea133}{Nunrefined}} = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00823}00823       \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1a35c13c3c37ddc5ac2852217d903459}{Nrefined}} = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00824}00824     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00825}00825   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00826}00826 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00827}00827   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00828}00828 \textcolor{comment}{  /// Get max/min refinement level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00829}00829 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00830}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4321288b6642d5057498f7659d76}{00830}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4321288b6642d5057498f7659d76}{TreeBasedRefineableMeshBase::get\_refinement\_levels}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00831}00831     \textcolor{keywordtype}{unsigned}\& min\_refinement\_level, \textcolor{keywordtype}{unsigned}\& max\_refinement\_level)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00832}00832   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00833}00833     \textcolor{comment}{// Initialise}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00834}00834     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a5e68b05c7b029384039d5d9bb6aa6ca8}{min\_refinement\_level}} = UINT\_MAX;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00835}00835     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6fc73b3052bd60ffd39e0a07ae6e6ab3}{max\_refinement\_level}} = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00836}00836 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00837}00837     \textcolor{comment}{// Loop over all elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00838}00838     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00839}00839     \textcolor{keywordflow}{if} (n\_element == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00840}00840     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00841}00841       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a5e68b05c7b029384039d5d9bb6aa6ca8}{min\_refinement\_level}} = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00842}00842       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6fc73b3052bd60ffd39e0a07ae6e6ab3}{max\_refinement\_level}} = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00843}00843     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00844}00844     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00845}00845     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00846}00846       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00847}00847       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00848}00848         \textcolor{comment}{// Get the refinement level of the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00849}00849         \textcolor{keywordtype}{unsigned} level = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00850}00850                            -\/>refinement\_level();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00851}00851 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00852}00852         \textcolor{keywordflow}{if} (level > \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6fc73b3052bd60ffd39e0a07ae6e6ab3}{max\_refinement\_level}}) \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6fc73b3052bd60ffd39e0a07ae6e6ab3}{max\_refinement\_level}} = level;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00853}00853         \textcolor{keywordflow}{if} (level < \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a5e68b05c7b029384039d5d9bb6aa6ca8}{min\_refinement\_level}}) \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a5e68b05c7b029384039d5d9bb6aa6ca8}{min\_refinement\_level}} = level;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00854}00854       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00855}00855     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00856}00856   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00857}00857 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00858}00858 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00859}00859   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00860}00860 \textcolor{comment}{  /// Adapt mesh, which exists in two representations,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00861}00861 \textcolor{comment}{  /// namely as:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00862}00862 \textcolor{comment}{  ///  -\/ a FE mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00863}00863 \textcolor{comment}{  ///  -\/ a forest of Oc or QuadTrees}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00864}00864 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00865}00865 \textcolor{comment}{  /// Refinement/derefinement process is documented (in tecplot-\/able form)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00866}00866 \textcolor{comment}{  /// if requested.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00867}00867 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00868}00868 \textcolor{comment}{  /// Procedure:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00869}00869 \textcolor{comment}{  /// -\/ Loop over all elements and do the refinement for those who want to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00870}00870 \textcolor{comment}{  ///   be refined. Note: Refinement/splitting only allocates elements but}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00871}00871 \textcolor{comment}{  ///   doesn't build them.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00872}00872 \textcolor{comment}{  /// -\/ Build the new elements (i.e. give them nodes (create new ones where}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00873}00873 \textcolor{comment}{  ///   necessary), assign boundary conditions, and add nodes to mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00874}00874 \textcolor{comment}{  ///   and mesh boundaries.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00875}00875 \textcolor{comment}{  /// -\/ For all nodes that were hanging on the previous mesh (and are still}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00876}00876 \textcolor{comment}{  ///   marked as such), fill in their nodal values (consistent}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00877}00877 \textcolor{comment}{  ///   with the current hanging node scheme) to make sure they are fully}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00878}00878 \textcolor{comment}{  ///   functional, should they have become non-\/hanging during the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00879}00879 \textcolor{comment}{  ///   mesh-\/adaptation. Then mark the nodes as non-\/hanging.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00880}00880 \textcolor{comment}{  /// -\/ Unrefine selected elements (which may cause nodes to be re-\/built).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00881}00881 \textcolor{comment}{  /// -\/ Add the new elements to the mesh (by completely overwriting}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00882}00882 \textcolor{comment}{  ///   the old Vector of elements).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00883}00883 \textcolor{comment}{  /// -\/ Delete any nodes that have become obsolete.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00884}00884 \textcolor{comment}{  /// -\/ Mark up hanging nodes and setup hanging node scheme (incl.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00885}00885 \textcolor{comment}{  ///   recursive cleanup for hanging nodes that depend on other}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00886}00886 \textcolor{comment}{  ///   hanging nodes).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00887}00887 \textcolor{comment}{  /// -\/ Adjust position of hanging nodes to make sure their position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00888}00888 \textcolor{comment}{  ///   is consistent with the FE-\/based represenetation of their larger}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00889}00889 \textcolor{comment}{  ///   neighbours.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00890}00890 \textcolor{comment}{  /// -\/ run a quick self-\/test on the neighbour finding scheme and}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00891}00891 \textcolor{comment}{  ///   check the integrity of the elements (if PARANOID)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00892}00892 \textcolor{comment}{  /// -\/ doc hanging node status, boundary conditions, neighbour}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00893}00893 \textcolor{comment}{  ///   scheme if requested.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00894}00894 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00895}00895 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00896}00896 \textcolor{comment}{  /// After adaptation, all nodes (whether new or old) have up-\/to-\/date}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00897}00897 \textcolor{comment}{  /// current and previous values.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00898}00898 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00899}00899 \textcolor{comment}{  /// If refinement process is being documented, the following information}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00900}00900 \textcolor{comment}{  /// is documented:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00901}00901 \textcolor{comment}{  /// -\/ The files}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00902}00902 \textcolor{comment}{  ///   -\/ "{}neighbours.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00903}00903 \textcolor{comment}{  ///   -\/ "{}all\_nodes.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00904}00904 \textcolor{comment}{  ///   -\/ "{}new\_nodes.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00905}00905 \textcolor{comment}{  ///   -\/ "{}hang\_nodes\_*.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00906}00906 \textcolor{comment}{  ///     where the * denotes a direction (n,s,e,w) in 2D}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00907}00907 \textcolor{comment}{  ///     or (r,l,u,d,f,b) in 3D}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00908}00908 \textcolor{comment}{  /// .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00909}00909 \textcolor{comment}{  ///   can be viewed with}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00910}00910 \textcolor{comment}{  ///   -\/ QHangingNodes.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00911}00911 \textcolor{comment}{  ///   .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00912}00912 \textcolor{comment}{  /// -\/ The file}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00913}00913 \textcolor{comment}{  ///    -\/ "{}hangnodes\_withmasters.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00914}00914 \textcolor{comment}{  ///    .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00915}00915 \textcolor{comment}{  ///    can be viewed with}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00916}00916 \textcolor{comment}{  ///    -\/ QHangingNodesWithMasters.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00917}00917 \textcolor{comment}{  ///    .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00918}00918 \textcolor{comment}{  ///    to check the hanging node status.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00919}00919 \textcolor{comment}{  /// -\/ The neighbour status of the elements is documented in}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00920}00920 \textcolor{comment}{  ///   -\/ "{}neighbours.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00921}00921 \textcolor{comment}{  ///   .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00922}00922 \textcolor{comment}{  ///   and can be viewed with}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00923}00923 \textcolor{comment}{  ///   -\/ QuadTreeNeighbours.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00924}00924 \textcolor{comment}{  ///   .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00925}00925 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00926}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_acef8ac2f0f2cffe938031db1499c598b}{00926}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a64608ddedb7eb56e11bee2805aa01360}{TreeBasedRefineableMeshBase::adapt\_mesh}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00927}00927   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00928}00928 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00929}00929     \textcolor{comment}{// Delete any external element storage before performing the adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00930}00930     \textcolor{comment}{// (in particular, external halo nodes that are on mesh boundaries)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00931}00931     this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9e3ecb07dc622cf37ce0085446ff9aa6}{delete\_all\_external\_storage}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00932}00932 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00933}00933 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00934}00934     \textcolor{comment}{// Only perform the adapt step if the mesh has any elements.  This is}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00935}00935     \textcolor{comment}{// relevant in a distributed problem with multiple meshes, where a}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00936}00936     \textcolor{comment}{// particular process may not have any elements on a particular submesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00937}00937     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}() > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00938}00938     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00939}00939       \textcolor{comment}{// Pointer to mesh needs to be passed to some functions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00940}00940       \mbox{\hyperlink{classoomph_1_1Mesh}{Mesh}}* mesh\_pt = \textcolor{keyword}{this};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00941}00941 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00942}00942       \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00943}00943       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00944}00944       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00945}00945         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00946}00946       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00947}00947 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00948}00948       \textcolor{comment}{// Do refinement(=splitting) of elements that have been selected}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00949}00949       \textcolor{comment}{// This function encapsulates the template parameter}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00950}00950       this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a86dace1f78991fb9b401a31215df89ef}{split\_elements\_if\_required}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00951}00951 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00952}00952 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00953}00953       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00954}00954       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00955}00955         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00956}00956         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for split\_elements\_if\_required: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00957}00957                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00958}00958         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00959}00959       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00960}00960 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00961}00961       \textcolor{comment}{// Now elements have been created -\/-\/ build all the leaves}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00962}00962       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00963}00963       \textcolor{comment}{// Firstly put all the elements into a vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00964}00964       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} leaf\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00965}00965       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a6d99d1f513a60b9bd053ff98699cbe52}{stick\_leaves\_into\_vector}}(leaf\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00966}00966 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00967}00967 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00968}00968       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00969}00969       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00970}00970         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00971}00971         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for stick\_leaves\_into\_vector: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00972}00972                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00973}00973         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00974}00974       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00975}00975 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00976}00976       \textcolor{comment}{// If we are documenting the output, create the filename}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00977}00977       std::ostringstream fullname;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00978}00978       std::ofstream new\_nodes\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00979}00979       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00980}00980       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00981}00981         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/new\_nodes"{}} << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00982}00982                  << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00983}00983         new\_nodes\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00984}00984       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00985}00985 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00986}00986 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00987}00987       \textcolor{comment}{// Build all elements and store vector of pointers to new nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00988}00988       \textcolor{comment}{// (Note: build() checks if the element has been built}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00989}00989       \textcolor{comment}{// already, i.e. if it's not a new element).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00990}00990       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}} new\_node\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00991}00991       \textcolor{keywordtype}{bool} was\_already\_built;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00992}00992       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} num\_tree\_nodes = leaf\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00993}00993       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00994}00994       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00995}00995         \textcolor{comment}{// Pre-\/build must be performed before any elements are built}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00996}00996         leaf\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()-\/>pre\_build(mesh\_pt, new\_node\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00997}00997       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00998}00998       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l00999}00999       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01000}01000         \textcolor{comment}{// Now do the actual build of the new elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01001}01001         leaf\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()-\/>build(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01002}01002           mesh\_pt, new\_node\_pt, was\_already\_built, new\_nodes\_file);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01003}01003       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01004}01004 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01005}01005 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01006}01006       \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01007}01007       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01008}01008       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01009}01009         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01010}01010         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for building "{}} << num\_tree\_nodes}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01011}01011                    << \textcolor{stringliteral}{"{} new elements: "{}} << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01012}01012         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01013}01013       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01014}01014 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01015}01015       \textcolor{comment}{// Close the new nodes files, if it was opened}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01016}01016       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01017}01017       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01018}01018         new\_nodes\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01019}01019       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01020}01020 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01021}01021       \textcolor{comment}{// Loop over all nodes in mesh and free the dofs of those that were}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01022}01022       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01023}01023       \textcolor{comment}{// pinned only because they were hanging nodes. Also update their}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01024}01024       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01025}01025       \textcolor{comment}{// nodal values so that they contain data that is consistent}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01026}01026       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01027}01027       \textcolor{comment}{// with the hanging node representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01028}01028       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01029}01029       \textcolor{comment}{// (Even if the nodal data isn't actually accessed because the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01030}01030       \textcolor{comment}{// is still hanging -\/-\/ we don't know this yet, and this step makes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01031}01031       \textcolor{comment}{// sure that all nodes are fully functional and up-\/to-\/date, should}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01032}01032       \textcolor{comment}{// they become non-\/hanging below).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01033}01033       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01034}01034       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01035}01035       \textcolor{comment}{// However, if we have a fixed mesh and hanging nodes on the boundary}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01036}01036       \textcolor{comment}{// become non-\/hanging they will not necessarily respect the curvilinear}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01037}01037       \textcolor{comment}{// boundaries. This can only happen in 3D of course because it is not}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01038}01038       \textcolor{comment}{// possible to have hanging nodes on boundaries in 2D.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01039}01039       \textcolor{comment}{// The solution is to store those nodes on the boundaries that are}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01040}01040       \textcolor{comment}{// currently hanging and then check to see whether they have changed}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01041}01041       \textcolor{comment}{// status at the end of the refinement procedure.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01042}01042       \textcolor{comment}{// If it has changed, then we need to adjust their positions.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01043}01043       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_boundary = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a84543564d6babe4faacbb9d87043fc19}{nboundary}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01044}01044       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} mesh\_dim = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a479059b0964826a8cee6eb506b57268a}{finite\_element\_pt}}(0)-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a5f8fe59f06da1da9f6b7bbcbdb90ef93}{dim}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01045}01045       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::set<Node*>}}> hanging\_nodes\_on\_boundary\_pt(n\_boundary);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01046}01046 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01047}01047       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_node = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01048}01048       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01049}01049       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01050}01050         \textcolor{comment}{// Get the pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01051}01051         Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01052}01052 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01053}01053         \textcolor{comment}{// Get the number of values in the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01054}01054         \textcolor{keywordtype}{unsigned} n\_value = nod\_pt-\/>nvalue();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01055}01055 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01056}01056         \textcolor{comment}{// We need to find if any of the values are hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01057}01057         \textcolor{keywordtype}{bool} is\_hanging = nod\_pt-\/>is\_hanging();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01058}01058         \textcolor{comment}{// Loop over the values and find out whether any are hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01059}01059         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_value; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01060}01060         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01061}01061           is\_hanging |= nod\_pt-\/>is\_hanging(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01062}01062         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01063}01063 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01064}01064         \textcolor{comment}{// If the node is hanging then ...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01065}01065         \textcolor{keywordflow}{if} (is\_hanging)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01066}01066         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01067}01067           \textcolor{comment}{// Unless they are turned into hanging nodes again below}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01068}01068           \textcolor{comment}{// (this might or might not happen), fill in all the necessary}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01069}01069           \textcolor{comment}{// data to make them 'proper' nodes again.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01070}01070 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01071}01071           \textcolor{comment}{// Reconstruct the nodal values/position from the node's}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01072}01072           \textcolor{comment}{// hanging node representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01073}01073           \textcolor{keywordtype}{unsigned} nt = nod\_pt-\/>ntstorage();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01074}01074           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} values(n\_value);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01075}01075           \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01076}01076           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} position(n\_dim);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01077}01077           \textcolor{comment}{// Loop over all history values}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01078}01078           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < nt; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01079}01079           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01080}01080             nod\_pt-\/>value(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, values);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01081}01081             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_value; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01082}01082             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01083}01083               nod\_pt-\/>set\_value(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, values[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01084}01084             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01085}01085             nod\_pt-\/>position(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, position);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01086}01086             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01087}01087             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01088}01088               nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = position[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01089}01089             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01090}01090           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01091}01091 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01092}01092           \textcolor{comment}{// If it's an algebraic node: Update its previous nodal positions too}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01093}01093           \mbox{\hyperlink{classoomph_1_1AlgebraicNode}{AlgebraicNode}}* alg\_node\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1AlgebraicNode}{AlgebraicNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01094}01094           \textcolor{keywordflow}{if} (alg\_node\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01095}01095           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01096}01096             \textcolor{keywordtype}{bool} update\_all\_time\_levels = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01097}01097             alg\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1AlgebraicNode_a754dc8fcac3382a07f60262c9792c84c}{node\_update}}(update\_all\_time\_levels);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01098}01098           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01099}01099 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01100}01100 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01101}01101           \textcolor{comment}{// If it's a Solid node, update Lagrangian coordinates}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01102}01102           \textcolor{comment}{// from its hanging node representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01103}01103           \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* solid\_node\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01104}01104           \textcolor{keywordflow}{if} (solid\_node\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01105}01105           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01106}01106             \textcolor{keywordtype}{unsigned} n\_lagrangian = solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_af98a0623f9e41a10f48112b9ff7b38a0}{nlagrangian}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01107}01107             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_lagrangian; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01108}01108             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01109}01109               solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_aa6780c66ed3f5db5cbb8fe2c0a476974}{xi}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a790277999eb7d8ff0c3f2398d8aaedb0}{lagrangian\_position}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01110}01110             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01111}01111           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01112}01112 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01113}01113           \textcolor{comment}{// Now store geometrically hanging nodes on boundaries that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01114}01114           \textcolor{comment}{// may need updating after refinement.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01115}01115           \textcolor{comment}{// There will only be a problem if we have 3 spatial dimensions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01116}01116           \textcolor{keywordflow}{if} ((mesh\_dim > 2) \&\& (nod\_pt-\/>is\_hanging()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01117}01117           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01118}01118             \textcolor{comment}{// If the node is on a boundary then add a pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01119}01119             \textcolor{comment}{// to our lookup scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01120}01120             \textcolor{keywordflow}{if} (nod\_pt-\/>is\_on\_boundary())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01121}01121             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01122}01122               \textcolor{comment}{// Storage for the boundaries on which the Node is located}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01123}01123               std::set<unsigned>* boundaries\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01124}01124               nod\_pt-\/>get\_boundaries\_pt(boundaries\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01125}01125               \textcolor{keywordflow}{if} (boundaries\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01126}01126               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01127}01127                 \textcolor{comment}{// Loop over the boundaries and add a pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01128}01128                 \textcolor{comment}{// to the appropriate storage scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01129}01129                 \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it = boundaries\_pt-\/>begin();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01130}01130                      it != boundaries\_pt-\/>end();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01131}01131                      ++it)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01132}01132                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01133}01133                   hanging\_nodes\_on\_boundary\_pt[*it].insert(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01134}01134                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01135}01135               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01136}01136             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01137}01137           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01138}01138 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01139}01139         \} \textcolor{comment}{// End of is\_hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01140}01140 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01141}01141         \textcolor{comment}{// Initially mark all nodes as 'non-\/hanging' and `obsolete'}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01142}01142         nod\_pt-\/>set\_nonhanging();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01143}01143         nod\_pt-\/>set\_obsolete();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01144}01144       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01145}01145 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01146}01146       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01147}01147       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01148}01148         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01149}01149         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for sorting out initial hanging status: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01150}01150                    << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01151}01151         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01152}01152       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01153}01153 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01154}01154       \textcolor{comment}{// Unrefine all the selected elements: This needs to be}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01155}01155       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01156}01156       \textcolor{comment}{// all elements, because the father elements are not actually leaves.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01157}01157       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01158}01158 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01159}01159       \textcolor{comment}{// Unrefine}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01160}01160       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a6796a34cf1211f554a59055ff5765863}{ntree}}(); \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01161}01161       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01162}01162         \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_aaa58320cabce1668093eca8647d5be26}{tree\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>\mbox{\hyperlink{classoomph_1_1Tree_a3caab39c8bee6fb65bbafed523aa6d3d}{traverse\_all}}(\&\mbox{\hyperlink{classoomph_1_1Tree_af4f977931ece6b719a9e616037bb2481}{Tree::merge\_sons\_if\_required}},}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01163}01163                                             mesh\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01164}01164       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01165}01165 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01166}01166       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01167}01167       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01168}01168         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01169}01169         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for unrefinement: "{}} << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01170}01170         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01171}01171       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01172}01172 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01173}01173       \textcolor{comment}{// Add the newly created elements to mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01174}01174       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01175}01175 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01176}01176       \textcolor{comment}{// Stick all elements into a new vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01177}01177       \textcolor{comment}{//(note the leaves may have changed, so this is not duplicated work)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01178}01178       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} tree\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01179}01179       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a6d99d1f513a60b9bd053ff98699cbe52}{stick\_leaves\_into\_vector}}(tree\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01180}01180 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01181}01181       \textcolor{comment}{// Copy the elements into the mesh Vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01182}01182       num\_tree\_nodes = tree\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01183}01183       \mbox{\hyperlink{classoomph_1_1Mesh_aca12acfe655a4d5c4a4eab4a7b970812}{Element\_pt}}.resize(num\_tree\_nodes);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01184}01184       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01185}01185       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01186}01186         \mbox{\hyperlink{classoomph_1_1Mesh_aca12acfe655a4d5c4a4eab4a7b970812}{Element\_pt}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01187}01187 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01188}01188         \textcolor{comment}{// Now loop over all nodes in element and mark them as non-\/obsolete}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01189}01189         \textcolor{comment}{// Logic: Initially all nodes in the unrefined mesh were labeled}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01190}01190         \textcolor{comment}{// as deleteable. Then we create new elements (whose newly created}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01191}01191         \textcolor{comment}{// nodes are obviously non-\/obsolete), and killed some other elements (by}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01192}01192         \textcolor{comment}{// by deleting them and marking the nodes that were not shared by}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01193}01193         \textcolor{comment}{// their father as obsolete. Now we loop over all the remaining}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01194}01194         \textcolor{comment}{// elements and (re-\/)label all their nodes as non-\/obsolete. This}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01195}01195         \textcolor{comment}{// saves some nodes that were regarded as obsolete by deleted}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01196}01196         \textcolor{comment}{// elements but are still required in some surviving ones}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01197}01197         \textcolor{comment}{// from a tragic early death...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01198}01198         \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* this\_el\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a479059b0964826a8cee6eb506b57268a}{finite\_element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01199}01199         \textcolor{keywordtype}{unsigned} n\_node = this\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}(); \textcolor{comment}{// caching pre-\/loop}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01200}01200         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01201}01201         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01202}01202           this\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n)-\/>set\_non\_obsolete();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01203}01203         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01204}01204       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01205}01205 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01206}01206 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01207}01207       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01208}01208       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01209}01209         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01210}01210         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for adding elements to mesh: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01211}01211                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01212}01212         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01213}01213       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01214}01214 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01215}01215       \textcolor{comment}{// Cannot delete nodes that are still marked as obsolete}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01216}01216       \textcolor{comment}{// because they may still be required to assemble the hanging schemes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01217}01217       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01218}01218 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01219}01219       \textcolor{comment}{// Mark up hanging nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01220}01220       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01221}01221 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01222}01222       \textcolor{comment}{// Output streams for the hanging nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01223}01223       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::ofstream*>}} hanging\_output\_files;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01224}01224       \textcolor{comment}{// Setup the output files for hanging nodes, this must be called}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01225}01225       \textcolor{comment}{// precisely once for the forest. Note that the files will only}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01226}01226       \textcolor{comment}{// actually be opened if doc\_info.is\_doc\_enabled() is true}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01227}01227       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a635443274eaa2fb1afa889e4e748608f}{open\_hanging\_node\_files}}(\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}, hanging\_output\_files);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01228}01228 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01229}01229       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01230}01230       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01231}01231         \textcolor{comment}{// Generic setup}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01232}01232         tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()-\/>setup\_hanging\_nodes(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01233}01233           hanging\_output\_files);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01234}01234         \textcolor{comment}{// Element specific setup}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01235}01235         tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()-\/>further\_setup\_hanging\_nodes();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01236}01236       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01237}01237 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01238}01238       \textcolor{comment}{// Close the hanging node files and delete the memory allocated}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01239}01239       \textcolor{comment}{// for the streams}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01240}01240       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_ace63bb552b21ba46eb5ae062826dab26}{close\_hanging\_node\_files}}(\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}, hanging\_output\_files);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01241}01241 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01242}01242 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01243}01243       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01244}01244       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01245}01245         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01246}01246         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup\_hanging\_nodes() and "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01247}01247                       \textcolor{stringliteral}{"{}further\_setup\_hanging\_nodes() for "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01248}01248                    << num\_tree\_nodes << \textcolor{stringliteral}{"{} elements: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01249}01249                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01250}01250         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01251}01251       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01252}01252 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01253}01253       \textcolor{comment}{// Read out the number of continously interpolated values}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01254}01254       \textcolor{comment}{// from one of the elements (assuming it's the same in all elements)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01255}01255       \textcolor{keywordtype}{unsigned} ncont\_interpolated\_values =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01256}01256         tree\_nodes\_pt[0]-\/>object\_pt()-\/>ncont\_interpolated\_values();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01257}01257 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01258}01258       \textcolor{comment}{// Complete the hanging nodes schemes by dealing with the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01259}01259       \textcolor{comment}{// recursively hanging nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01260}01260       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aab6f14b0933edc819231a88b1d555f62}{complete\_hanging\_nodes}}(ncont\_interpolated\_values);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01261}01261 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01262}01262       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01263}01263       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01264}01264         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01265}01265         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for complete\_hanging\_nodes: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01266}01266                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01267}01267         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01268}01268       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01269}01269 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01270}01270 \textcolor{comment}{      /// Update the boundary element info -\/-\/ this can be a costly procedure}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01271}01271 \textcolor{comment}{      /// and for this reason the mesh writer might have decided not to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01272}01272 \textcolor{comment}{      /// set up this scheme. If so, we won't change this and suppress}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01273}01273 \textcolor{comment}{      /// its creation...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01274}01274 \textcolor{comment}{}      \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Mesh_a37f6d27447f643a74694012b09350ce9}{Lookup\_for\_elements\_next\_boundary\_is\_setup}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01275}01275       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01276}01276         this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a6cc8bcd6b41209f0e9295cc993d9c6bb}{setup\_boundary\_element\_info}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01277}01277       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01278}01278 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01279}01279       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01280}01280       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01281}01281         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01282}01282         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for boundary element info: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01283}01283                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01284}01284         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01285}01285       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01286}01286 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01287}01287 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01288}01288 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01289}01289       \textcolor{comment}{// Doc/check the neighbours}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01290}01290       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01291}01291       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} all\_tree\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01292}01292       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a40bd3735303f019892b03d6a5355c8db}{stick\_all\_tree\_nodes\_into\_vector}}(all\_tree\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01293}01293 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01294}01294       \textcolor{comment}{// Check the neighbours}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01295}01295       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a0e6a7f821d9f14374c6d23d8766c7679}{check\_all\_neighbours}}(\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01296}01296 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01297}01297       \textcolor{comment}{// Check the integrity of the elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01298}01298       \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01299}01299 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01300}01300       \textcolor{comment}{// Loop over elements and get the elemental integrity}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01301}01301       \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01302}01302       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01303}01303       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01304}01304         \textcolor{keywordtype}{double} max\_el\_error;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01305}01305         tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()-\/>check\_integrity(max\_el\_error);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01306}01306         \textcolor{comment}{// If the elemental error is greater than our maximum error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01307}01307         \textcolor{comment}{// reset the maximum}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01308}01308         \textcolor{keywordflow}{if} (max\_el\_error > \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01309}01309         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01310}01310           \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} = max\_el\_error;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01311}01311         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01312}01312       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01313}01313 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01314}01314       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} > \mbox{\hyperlink{classoomph_1_1RefineableElement_a5cdf00847c81f896f91193d82c00d5b2}{RefineableElement::max\_integrity\_tolerance}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01315}01315       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01316}01316         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01317}01317         error\_stream << \textcolor{stringliteral}{"{}Mesh refined: Max. error in integrity check: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01318}01318                      << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} << \textcolor{stringliteral}{"{} is too big\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01319}01319         error\_stream}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01320}01320           << \textcolor{stringliteral}{"{}i.e. bigger than RefineableElement::max\_integrity\_tolerance()="{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01321}01321           << \mbox{\hyperlink{classoomph_1_1RefineableElement_a5cdf00847c81f896f91193d82c00d5b2}{RefineableElement::max\_integrity\_tolerance}}() << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01322}01322           << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01323}01323 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01324}01324         std::ofstream some\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01325}01325         some\_file.open(\textcolor{stringliteral}{"{}ProblemMesh.dat"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01326}01326         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01327}01327         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01328}01328           \textcolor{comment}{// Get the pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01329}01329           Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01330}01330           \textcolor{comment}{// Get the dimension}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01331}01331           \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01332}01332           \textcolor{comment}{// Output the coordinates}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01333}01333           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01334}01334           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01335}01335             some\_file << this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n)-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01336}01336           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01337}01337           some\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01338}01338         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01339}01339         some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01340}01340 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01341}01341         error\_stream << \textcolor{stringliteral}{"{}Doced problem mesh in ProblemMesh.dat"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01342}01342 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01343}01343         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01344}01344           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01345}01345       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01346}01346       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01347}01347       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01348}01348         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Mesh refined: Max. error in integrity check: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01349}01349                    << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} << \textcolor{stringliteral}{"{} is OK"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01350}01350         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01351}01351           << \textcolor{stringliteral}{"{}i.e. less than RefineableElement::max\_integrity\_tolerance()="{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01352}01352           << \mbox{\hyperlink{classoomph_1_1RefineableElement_a5cdf00847c81f896f91193d82c00d5b2}{RefineableElement::max\_integrity\_tolerance}}() << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01353}01353           << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01354}01354       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01355}01355 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01356}01356 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01357}01357       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01358}01358       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01359}01359         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01360}01360         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for (paranoid only) checking of integrity: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01361}01361                    << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01362}01362         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01363}01363       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01364}01364 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01365}01365 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01366}01366 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01367}01367       \textcolor{comment}{// Loop over all elements other than the final level and deactivate the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01368}01368       \textcolor{comment}{// objects, essentially set the pointer that point to nodes that are}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01369}01369       \textcolor{comment}{// about to be deleted to NULL. This must take place here because nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01370}01370       \textcolor{comment}{// addressed by elements that are dead but still living in the tree might}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01371}01371       \textcolor{comment}{// have been made obsolete in the last round of refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01372}01372       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a6796a34cf1211f554a59055ff5765863}{ntree}}(); \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01373}01373       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01374}01374         \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aaf121b2595ff71815c4e9db35247f951}{Forest\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_aaa58320cabce1668093eca8647d5be26}{tree\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>\mbox{\hyperlink{classoomph_1_1Tree_aef175445b09edb47624c4b88c6d548bc}{traverse\_all\_but\_leaves}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01375}01375           \&\mbox{\hyperlink{classoomph_1_1Tree_aea17489589a1872db51f2b142da4c1fb}{Tree::deactivate\_object}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01376}01376       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01377}01377 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01378}01378       \textcolor{comment}{// Now we can prune the dead nodes from the mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01379}01379       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}} deleted\_node\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ac9f58929371a3f39dd646d2756547ad2}{prune\_dead\_nodes}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01380}01380 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01381}01381       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01382}01382       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01383}01383         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01384}01384         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for deactivating objects and pruning nodes: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01385}01385                    << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01386}01386         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01387}01387       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01388}01388 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01389}01389       \textcolor{comment}{// Finally: Reorder the nodes within the mesh's node vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01390}01390       \textcolor{comment}{// to establish a standard ordering regardless of the sequence}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01391}01391       \textcolor{comment}{// of mesh refinements -\/-\/ this is required to allow dump/restart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01392}01392       \textcolor{comment}{// on refined meshes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01393}01393       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a801e77424d1bf8a35c9bba055230f1e3}{reorder\_nodes}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01394}01394 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01395}01395       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01396}01396       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01397}01397         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01398}01398         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for reordering "{}} << \mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01399}01399                    << \textcolor{stringliteral}{"{} nodes: "{}} << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01400}01400         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01401}01401       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01402}01402 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01403}01403       \textcolor{comment}{// Now we can correct the nodes on boundaries that were hanging that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01404}01404       \textcolor{comment}{// are no longer hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01405}01405       \textcolor{comment}{// Only bother if we have more than two dimensions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01406}01406       \textcolor{keywordflow}{if} (mesh\_dim > 2)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01407}01407       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01408}01408         \textcolor{comment}{// Loop over the boundaries}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01409}01409         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_boundary; b++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01410}01410         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01411}01411           \textcolor{comment}{// Remove deleted nodes from the set}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01412}01412           \textcolor{keywordtype}{unsigned} n\_del = deleted\_node\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01413}01413           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_del; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01414}01414           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01415}01415             hanging\_nodes\_on\_boundary\_pt[b].erase(deleted\_node\_pt[j]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01416}01416           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01417}01417 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01418}01418           \textcolor{comment}{// If the nodes that were hanging are still hanging then remove them}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01419}01419           \textcolor{comment}{// from the set (note increment is not in for command for efficiencty)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01420}01420           \textcolor{keywordflow}{for} (std::set<Node*>::iterator it =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01421}01421                  hanging\_nodes\_on\_boundary\_pt[b].begin();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01422}01422                it != hanging\_nodes\_on\_boundary\_pt[b].end();)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01423}01423           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01424}01424             \textcolor{keywordflow}{if} ((*it)-\/>is\_hanging())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01425}01425             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01426}01426               hanging\_nodes\_on\_boundary\_pt[b].erase(it++);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01427}01427             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01428}01428             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01429}01429             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01430}01430               ++it;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01431}01431             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01432}01432           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01433}01433 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01434}01434           \textcolor{comment}{// Are there any nodes that have changed geometric hanging status}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01435}01435           \textcolor{comment}{// on the boundary}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01436}01436           \textcolor{comment}{// The slightly painful part is that we must adjust the position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01437}01437           \textcolor{comment}{// via the macro-\/elements which are only available through the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01438}01438           \textcolor{comment}{// elements and not the nodes.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01439}01439           \textcolor{keywordflow}{if} (hanging\_nodes\_on\_boundary\_pt[b].size() > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01440}01440           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01441}01441             \textcolor{comment}{// If so we loop over all elements adjacent to the boundary}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01442}01442             \textcolor{keywordtype}{unsigned} n\_boundary\_element = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a68e04b3b70cff70d53d75f66661555e8}{nboundary\_element}}(b);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01443}01443             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_boundary\_element; ++\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01444}01444             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01445}01445               \textcolor{comment}{// Get a pointer to the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01446}01446               \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* el\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a6dcf10c6fff9d13b309549ba73e10069}{boundary\_element\_pt}}(b, \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01447}01447 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01448}01448               \textcolor{comment}{// Do we have a solid element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01449}01449               \mbox{\hyperlink{classoomph_1_1SolidFiniteElement}{SolidFiniteElement}}* solid\_el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01450}01450                 \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidFiniteElement}{SolidFiniteElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01451}01451 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01452}01452               \textcolor{comment}{// Determine whether there is a macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01453}01453               \textcolor{keywordtype}{bool} macro\_present = (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a801bbe89619c28e181afa8fa3e9ac836}{macro\_elem\_pt}}() != 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01454}01454               \textcolor{comment}{// Or a solid macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01455}01455               \textcolor{keywordflow}{if} (solid\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01456}01456               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01457}01457                 macro\_present |= (solid\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidFiniteElement_a2c4a2681d29251acc0af8e7d95227cad}{undeformed\_macro\_elem\_pt}}() != 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01458}01458               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01459}01459 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01460}01460               \textcolor{comment}{// Only bother to do anything if there is a macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01461}01461               \textcolor{comment}{// or undeformed macro element in a SolidElement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01462}01462               \textcolor{keywordflow}{if} (macro\_present)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01463}01463               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01464}01464                 \textcolor{comment}{// Loop over the nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01465}01465                 \textcolor{comment}{// ALH: (could optimise to only loop over}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01466}01466                 \textcolor{comment}{// node associated with the boundary with more effort)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01467}01467                 \textcolor{keywordtype}{unsigned} n\_el\_node = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01468}01468                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_el\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01469}01469                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01470}01470                   \textcolor{comment}{// Cache pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01471}01471                   Node* nod\_pt = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01472}01472                   \textcolor{keywordflow}{if} (nod\_pt-\/>is\_on\_boundary(b))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01473}01473                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01474}01474                     \textcolor{comment}{// Is the Node in our set}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01475}01475                     std::set<Node*>::iterator it =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01476}01476                       hanging\_nodes\_on\_boundary\_pt[b].find(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01477}01477 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01478}01478                     \textcolor{comment}{// If we have found the Node then update the position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01479}01479                     \textcolor{comment}{// to be consistent with the macro-\/element representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01480}01480                     \textcolor{keywordflow}{if} (it != hanging\_nodes\_on\_boundary\_pt[b].end())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01481}01481                     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01482}01482                       \textcolor{comment}{// Specialise local and global coordinates to 3D}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01483}01483                       \textcolor{comment}{// because there is only a problem in 3D.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01484}01484                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(3), \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}(3);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01485}01485 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01486}01486                       \textcolor{comment}{// Find the local coordinate of the ndoe}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01487}01487                       el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a22bc4ee35e4f948d8d7fba18c7b4f4c4}{local\_coordinate\_of\_node}}(n, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01488}01488 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01489}01489                       \textcolor{comment}{// Find the number of time history values}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01490}01490                       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ntstorage = nod\_pt-\/>ntstorage();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01491}01491 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01492}01492                       \textcolor{comment}{// Do we have a solid node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01493}01493                       \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* solid\_node\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01494}01494                         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01495}01495                       \textcolor{keywordflow}{if} (solid\_node\_pt)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01496}01496                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01497}01497                         \textcolor{comment}{// Assign Lagrangian coordinates from undeformed}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01498}01498                         \textcolor{comment}{// macro element (if it has one -\/-\/ get\_x\_and\_xi()}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01499}01499                         \textcolor{comment}{// does "{}the right thing"{} anyway. Leave actual}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01500}01500                         \textcolor{comment}{// nodal positions alone -\/-\/ we're doing a solid}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01501}01501                         \textcolor{comment}{// mechanics problem and once we're going}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01502}01502                         \textcolor{comment}{// the nodal positions are always computed, never}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01503}01503                         \textcolor{comment}{// (automatically) reset to macro-\/element based}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01504}01504                         \textcolor{comment}{// positions; not even on pinned boundaries}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01505}01505                         \textcolor{comment}{// because the user may have other ideas about where}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01506}01506                         \textcolor{comment}{// these should go -\/-\/ pinning means "{}don't touch the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01507}01507                         \textcolor{comment}{// value"{}, not "{}leave where the macro-\/element thinks}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01508}01508                         \textcolor{comment}{// it should be"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01509}01509                         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} x\_fe(3), xi(3), xi\_fe(3);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01510}01510                         solid\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidFiniteElement_a2e557cb3647e40fe3225bab4d8f834a0}{get\_x\_and\_xi}}(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, x\_fe, \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}, xi\_fe, xi);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01511}01511                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 3; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01512}01512                         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01513}01513                           solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_aa6780c66ed3f5db5cbb8fe2c0a476974}{xi}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = xi[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01514}01514                         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01515}01515                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01516}01516                       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01517}01517                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01518}01518                         \textcolor{comment}{// Set position and history values from the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01519}01519                         \textcolor{comment}{// macro-\/element representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01520}01520                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < ntstorage; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01521}01521                         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01522}01522                           \textcolor{comment}{// Get the history value from the macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01523}01523                           el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6fc14cbf4e1d031acbc59b415cefa1ca}{get\_x}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01524}01524 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01525}01525                           \textcolor{comment}{// Set the coordinate to that of the macroelement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01526}01526                           \textcolor{comment}{// representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01527}01527                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 3; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01528}01528                           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01529}01529                             nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01530}01530                           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01531}01531                         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01532}01532                       \} \textcolor{comment}{// End of non-\/solid node case}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01533}01533 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01534}01534                       \textcolor{comment}{// Now remove the node from the list}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01535}01535                       hanging\_nodes\_on\_boundary\_pt[b].erase(it);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01536}01536 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01537}01537                       \textcolor{comment}{// If there are no Nodes left then exit the loops}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01538}01538                       \textcolor{keywordflow}{if} (hanging\_nodes\_on\_boundary\_pt[b].size() == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01539}01539                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01540}01540                         \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = n\_boundary\_element;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01541}01541                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01542}01542                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01543}01543                     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01544}01544                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01545}01545                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01546}01546               \} \textcolor{comment}{// End of macro element case}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01547}01547             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01548}01548           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01549}01549         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01550}01550       \} \textcolor{comment}{// End of case when we have fixed nodal positions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01551}01551 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01552}01552 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01553}01553       \textcolor{comment}{// Final doc}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01554}01554       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01555}01555       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01556}01556       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01557}01557         \textcolor{comment}{// Doc the boundary conditions ('0' for non-\/existent, '1' for free,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01558}01558         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01559}01559         \textcolor{comment}{// '2' for pinned -\/-\/ ideal for tecplot scatter sizing.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01560}01560         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01561}01561         \textcolor{comment}{// num\_tree\_nodes=tree\_nodes\_pt.size();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01562}01562 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01563}01563         \textcolor{comment}{// Determine maximum number of values at any node in this type of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01564}01564         \textcolor{comment}{// element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01565}01565         \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* el\_pt = tree\_nodes\_pt[0]-\/>object\_pt();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01566}01566         \textcolor{comment}{// Initalise max\_nval}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01567}01567         \textcolor{keywordtype}{unsigned} max\_nval = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01568}01568         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}(); n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01569}01569         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01570}01570           \textcolor{keywordflow}{if} (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n)-\/>nvalue() > max\_nval)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01571}01571           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01572}01572             max\_nval = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n)-\/>nvalue();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01573}01573           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01574}01574         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01575}01575 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01576}01576         \textcolor{comment}{// Open the output file}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01577}01577         std::ofstream bcs\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01578}01578         fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01579}01579         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/bcs"{}} << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01580}01580                  << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01581}01581         bcs\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01582}01582 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01583}01583         \textcolor{comment}{// Loop over elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01584}01584         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01585}01585         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01586}01586           el\_pt = tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01587}01587           \textcolor{comment}{// Loop over nodes in element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01588}01588           \textcolor{keywordtype}{unsigned} n\_nod = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01589}01589           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_nod; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01590}01590           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01591}01591             \textcolor{comment}{// Get pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01592}01592             Node* nod\_pt = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01593}01593             \textcolor{comment}{// Find the dimension of the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01594}01594             \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01595}01595             \textcolor{comment}{// Write the nodal coordinates to the file}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01596}01596             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01597}01597             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01598}01598               bcs\_file << nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01599}01599             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01600}01600 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01601}01601             \textcolor{comment}{// Loop over all values in this element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01602}01602             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_nval; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01603}01603             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01604}01604               \textcolor{comment}{// Value exists at this node:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01605}01605               \textcolor{keywordflow}{if} (i < nod\_pt-\/>nvalue())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01606}01606               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01607}01607                 bcs\_file << \textcolor{stringliteral}{"{} "{}} << 1 + nod\_pt-\/>is\_pinned(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01608}01608               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01609}01609               \textcolor{comment}{// ...if not just dump out a zero}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01610}01610               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01611}01611               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01612}01612                 bcs\_file << \textcolor{stringliteral}{"{} 0 "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01613}01613               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01614}01614             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01615}01615             bcs\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01616}01616           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01617}01617         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01618}01618         bcs\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01619}01619 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01620}01620         \textcolor{comment}{// Doc all nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01621}01621         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01622}01622         std::ofstream all\_nodes\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01623}01623         fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01624}01624         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/all\_nodes"{}} << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01625}01625                  << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01626}01626         all\_nodes\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01627}01627 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01628}01628         all\_nodes\_file << \textcolor{stringliteral}{"{}ZONE \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01629}01629 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01630}01630         \textcolor{comment}{// Need to recompute the number of nodes since it may have}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01631}01631         \textcolor{comment}{// changed during mesh refinement/unrefinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01632}01632         n\_node = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01633}01633         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01634}01634         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01635}01635           Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01636}01636           \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01637}01637           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01638}01638           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01639}01639             all\_nodes\_file << this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n)-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01640}01640           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01641}01641           all\_nodes\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01642}01642         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01643}01643 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01644}01644         all\_nodes\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01645}01645 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01646}01646 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01647}01647         \textcolor{comment}{// Doc all hanging nodes:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01648}01648         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01649}01649         std::ofstream some\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01650}01650         fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01651}01651         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/all\_hangnodes"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01652}01652                  << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01653}01653         some\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01654}01654         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01655}01655         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01656}01656           Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01657}01657 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01658}01658           \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01659}01659           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01660}01660             \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01661}01661             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01662}01662             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01663}01663               some\_file << nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01664}01664             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01665}01665 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01666}01666             \textcolor{comment}{// ALH: Added this to stop Solid problems seg-\/faulting}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01667}01667             \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n)-\/>nvalue() > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01668}01668             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01669}01669               some\_file << \textcolor{stringliteral}{"{} "{}} << nod\_pt-\/>raw\_value(0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01670}01670             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01671}01671             some\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01672}01672           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01673}01673         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01674}01674         some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01675}01675 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01676}01676         \textcolor{comment}{// Doc all hanging nodes and their masters}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01677}01677         \textcolor{comment}{// View with QHangingNodesWithMasters.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01678}01678         fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01679}01679         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/geometric\_hangnodes\_withmasters"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01680}01680                  << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01681}01681         some\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01682}01682         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01683}01683         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01684}01684           Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01685}01685           \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01686}01686           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01687}01687             \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01688}01688             \textcolor{keywordtype}{unsigned} nmaster = nod\_pt-\/>hanging\_pt()-\/>nmaster();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01689}01689             some\_file << \textcolor{stringliteral}{"{}ZONE I="{}} << nmaster + 1 << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01690}01690             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01691}01691             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01692}01692               some\_file << nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01693}01693             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01694}01694             some\_file << \textcolor{stringliteral}{"{} 2 "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01695}01695 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01696}01696             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imaster = 0; imaster < nmaster; imaster++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01697}01697             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01698}01698               Node* master\_nod\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01699}01699                 nod\_pt-\/>hanging\_pt()-\/>master\_node\_pt(imaster);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01700}01700               \textcolor{keywordtype}{unsigned} n\_dim = master\_nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01701}01701               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01702}01702               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01703}01703                 some\_file << master\_nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01704}01704               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01705}01705               some\_file << \textcolor{stringliteral}{"{} 1 "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01706}01706             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01707}01707           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01708}01708         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01709}01709         some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01710}01710 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01711}01711         \textcolor{comment}{// Doc all hanging nodes and their masters}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01712}01712         \textcolor{comment}{// View with QHangingNodesWithMasters.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01713}01713         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ncont\_interpolated\_values; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01714}01714         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01715}01715           fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01716}01716           fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01717}01717                    << \textcolor{stringliteral}{"{}/nonstandard\_hangnodes\_withmasters"{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}\_"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01718}01718                    << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01719}01719           some\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01720}01720           \textcolor{keywordtype}{unsigned} n\_nod = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01721}01721           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_nod; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01722}01722           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01723}01723             Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01724}01724             \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01725}01725             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01726}01726               \textcolor{keywordflow}{if} (nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) != nod\_pt-\/>hanging\_pt())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01727}01727               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01728}01728                 \textcolor{keywordtype}{unsigned} nmaster = nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>nmaster();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01729}01729                 some\_file << \textcolor{stringliteral}{"{}ZONE I="{}} << nmaster + 1 << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01730}01730                 \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01731}01731                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_dim; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01732}01732                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01733}01733                   some\_file << nod\_pt-\/>x(j) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01734}01734                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01735}01735                 some\_file << \textcolor{stringliteral}{"{} 2 "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01736}01736                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imaster = 0; imaster < nmaster; imaster++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01737}01737                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01738}01738                   Node* master\_nod\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01739}01739                     nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>master\_node\_pt(imaster);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01740}01740                   \textcolor{keywordtype}{unsigned} n\_dim = master\_nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01741}01741                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_dim; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01742}01742                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01743}01743                     \textcolor{comment}{//               some\_file << master\_nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01744}01744                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01745}01745                   some\_file << \textcolor{stringliteral}{"{} 1 "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01746}01746                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01747}01747               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01748}01748             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01749}01749           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01750}01750           some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01751}01751         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01752}01752       \} \textcolor{comment}{// End of documentation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01753}01753     \} \textcolor{comment}{// End if (this-\/>nelement()>0)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01754}01754 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01755}01755 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01756}01756 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01757}01757 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01758}01758     \textcolor{comment}{// Now (re-\/)classify halo and haloed nodes and synchronise hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01759}01759     \textcolor{comment}{// nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01760}01760     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01761}01761     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01762}01762       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aec7c6fc41272ec883c589ee56d1b01e6}{classify\_halo\_and\_haloed\_nodes}}(doc\_info, \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01763}01763     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01764}01764 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01765}01765 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01766}01766   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01767}01767 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01768}01768 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01769}01769   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01770}01770 \textcolor{comment}{  /// Refine mesh uniformly}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01771}01771 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01772}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae238476195a0ceeb2cdb680620fb97a3}{01772}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a8e67b50fecb03fe1ac93dcb81e4ac6e9}{TreeBasedRefineableMeshBase::refine\_uniformly}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01773}01773   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01774}01774     \textcolor{comment}{// Select all elements for refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01775}01775     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Nelement = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01776}01776     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Nelement; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01777}01777     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01778}01778       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01779}01779         -\/>select\_for\_refinement();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01780}01780     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01781}01781 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01782}01782     \textcolor{comment}{// Do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01783}01783     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a64608ddedb7eb56e11bee2805aa01360}{adapt\_mesh}}(\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01784}01784   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01785}01785 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01786}01786 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01787}01787   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01788}01788 \textcolor{comment}{  /// p-\/refine mesh uniformly}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01789}01789 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01790}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a270d74e0e30f9956c85e4cdcc202c98b}{01790}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae922698aeb358f174c37dac5101c5369}{TreeBasedRefineableMeshBase::p\_refine\_uniformly}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01791}01791   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01792}01792     \textcolor{comment}{// Select all elements for refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01793}01793     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Nelement = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01794}01794     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Nelement; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01795}01795     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01796}01796       \textcolor{comment}{// Get pointer to p-\/refineable element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01797}01797       \mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}* el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01798}01798         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01799}01799       \textcolor{comment}{// Mark for p-\/refinement if possible. If not then p\_adapt\_mesh() will}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01800}01800       \textcolor{comment}{// report the error.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01801}01801       \textcolor{keywordflow}{if} (el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01802}01802       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01803}01803         el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a89ecf3e300ea9c7dd37ce981053377f4}{select\_for\_p\_refinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01804}01804       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01805}01805     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01806}01806 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01807}01807     \textcolor{comment}{// Do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01808}01808     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae36ab5e807acc10ccc31a7886ffc040a}{p\_adapt\_mesh}}(\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01809}01809   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01810}01810 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01811}01811 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01812}01812   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01813}01813 \textcolor{comment}{  /// Refine mesh by splitting the elements identified}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01814}01814 \textcolor{comment}{  /// by their numbers.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01815}01815 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01816}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a171be4c171cc60de5831f6a2ffaf278e}{01816}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a171be4c171cc60de5831f6a2ffaf278e}{TreeBasedRefineableMeshBase::refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01817}01817     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& elements\_to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01818}01818   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01819}01819 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01820}01820     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01821}01821     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01822}01822       std::ostringstream warn\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01823}01823       warn\_stream << \textcolor{stringliteral}{"{}You are attempting to refine selected elements of a "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01824}01824                   << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01825}01825                   << \textcolor{stringliteral}{"{}distributed mesh. This may have undesired effects."{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01826}01826                   << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01827}01827 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01828}01828       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_stream.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01829}01829                       \textcolor{stringliteral}{"{}TreeBasedRefineableMeshBase::refine\_selected\_elements()"{}},}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01830}01830                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01831}01831     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01832}01832 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01833}01833 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01834}01834     \textcolor{comment}{// Select elements for refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01835}01835     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} nref = elements\_to\_be\_refined.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01836}01836     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nref; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01837}01837     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01838}01838       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01839}01839         this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(elements\_to\_be\_refined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01840}01840         -\/>select\_for\_refinement();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01841}01841     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01842}01842 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01843}01843     \textcolor{comment}{// Do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01844}01844     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a64608ddedb7eb56e11bee2805aa01360}{adapt\_mesh}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01845}01845   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01846}01846 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01847}01847 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01848}01848   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01849}01849 \textcolor{comment}{  /// Refine mesh by splitting the elements identified}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01850}01850 \textcolor{comment}{  /// by their pointers}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01851}01851 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01852}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6d88d6365af7f92bf766b73b115bcf3f}{01852}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a171be4c171cc60de5831f6a2ffaf278e}{TreeBasedRefineableMeshBase::refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01853}01853     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<RefineableElement*>}}\& elements\_to\_be\_refined\_pt)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01854}01854   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01855}01855 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01856}01856     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01857}01857     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01858}01858       std::ostringstream warn\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01859}01859       warn\_stream << \textcolor{stringliteral}{"{}You are attempting to refine selected elements of a "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01860}01860                   << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01861}01861                   << \textcolor{stringliteral}{"{}distributed mesh. This may have undesired effects."{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01862}01862                   << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01863}01863 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01864}01864       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_stream.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01865}01865                       \textcolor{stringliteral}{"{}TreeBasedRefineableMeshBase::refine\_selected\_elements()"{}},}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01866}01866                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01867}01867     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01868}01868 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01869}01869 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01870}01870     \textcolor{comment}{// Select elements for refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01871}01871     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} nref = elements\_to\_be\_refined\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01872}01872     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nref; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01873}01873     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01874}01874       elements\_to\_be\_refined\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>select\_for\_refinement();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01875}01875     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01876}01876 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01877}01877     \textcolor{comment}{// Do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01878}01878     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a64608ddedb7eb56e11bee2805aa01360}{adapt\_mesh}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01879}01879   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01880}01880 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01881}01881 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01882}01882   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01883}01883 \textcolor{comment}{  /// Refine to same degree as the reference mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01884}01884 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01885}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6a69f5485eb426f6f60ed5a92db383a3}{01885}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6a69f5485eb426f6f60ed5a92db383a3}{TreeBasedRefineableMeshBase::refine\_base\_mesh\_as\_in\_reference\_mesh}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01886}01886     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* \textcolor{keyword}{const}\& ref\_mesh\_pt)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01887}01887   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01888}01888     \textcolor{comment}{// Assign storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01889}01889     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> to\_be\_refined;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01890}01890 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01891}01891     \textcolor{comment}{// Get refinement pattern of reference mesh:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01892}01892     ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dba989c0d0735d8fe34ceb231425401}{get\_refinement\_pattern}}(to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01893}01893 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01894}01894     \textcolor{comment}{// Refine mesh according to given refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01895}01895     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a77c2eb2c650ba34c79cf3b156204ee3b}{refine\_base\_mesh}}(to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01896}01896   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01897}01897 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01898}01898 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01899}01899   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01900}01900 \textcolor{comment}{  /// Refine to same degree as the reference mesh minus one. Useful}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01901}01901 \textcolor{comment}{  /// function for multigrid solvers; allows the easy copy of a mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01902}01902 \textcolor{comment}{  /// to the level of refinement just below the current one. Returns}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01903}01903 \textcolor{comment}{  /// a boolean variable which indicates if the reference mesh has not}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01904}01904 \textcolor{comment}{  /// been refined at all}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01905}01905 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01906}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae6fc7cc7acf368423cc49cc10ab276bc}{01906}}   \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae6fc7cc7acf368423cc49cc10ab276bc}{TreeBasedRefineableMeshBase::}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01907}01907 \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae6fc7cc7acf368423cc49cc10ab276bc}{    refine\_base\_mesh\_as\_in\_reference\_mesh\_minus\_one}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01908}01908       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* \textcolor{keyword}{const}\& ref\_mesh\_pt)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01909}01909   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01910}01910     \textcolor{comment}{// Assign storage for refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01911}01911     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> to\_be\_refined;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01912}01912 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01913}01913     \textcolor{comment}{// Get refinement pattern of reference mesh:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01914}01914     ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dba989c0d0735d8fe34ceb231425401}{get\_refinement\_pattern}}(to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01915}01915 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01916}01916     \textcolor{comment}{// Find the length of the vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01917}01917     \textcolor{keywordtype}{unsigned} nrefinement\_levels = to\_be\_refined.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01918}01918 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01919}01919     \textcolor{comment}{// If the reference mesh has not been refined a single time then}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01920}01920     \textcolor{comment}{// we cannot create an unrefined copy so stop here}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01921}01921     \textcolor{keywordflow}{if} (nrefinement\_levels == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01922}01922     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01923}01923       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01924}01924     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01925}01925     \textcolor{comment}{// If the reference mesh has been refined at least once}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01926}01926     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01927}01927     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01928}01928       \textcolor{comment}{// Remove the last entry of the vector to make sure we refine to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01929}01929       \textcolor{comment}{// the same level minus one}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01930}01930       to\_be\_refined.resize(nrefinement\_levels -\/ 1);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01931}01931 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01932}01932       \textcolor{comment}{// Refine mesh according to given refinement pattern}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01933}01933       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a77c2eb2c650ba34c79cf3b156204ee3b}{refine\_base\_mesh}}(to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01934}01934 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01935}01935       \textcolor{comment}{// Indicate that it was possible to create an unrefined copy}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01936}01936       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01937}01937     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01938}01938   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01939}01939 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01940}01940 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01941}01941   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01942}01942 \textcolor{comment}{  /// Refine mesh once so that its topology etc becomes that of the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01943}01943 \textcolor{comment}{  /// (finer!) reference mesh -\/-\/ if possible! Useful for meshes in multigrid}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01944}01944 \textcolor{comment}{  /// hierarchies. If the meshes are too different and the conversion}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01945}01945 \textcolor{comment}{  /// cannot be performed, the code dies (provided PARANOID is enabled).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01946}01946 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01947}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a7451ff312a3ac482b2f62ded020630c3}{01947}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a7451ff312a3ac482b2f62ded020630c3}{TreeBasedRefineableMeshBase::refine\_as\_in\_reference\_mesh}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01948}01948     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase}{TreeBasedRefineableMeshBase}}* \textcolor{keyword}{const}\& ref\_mesh\_pt)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01949}01949   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01950}01950     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}WARNING : This has not been checked comprehensively yet"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01951}01951                << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01952}01952                << \textcolor{stringliteral}{"{}Check it and remove this break "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01953}01953     \mbox{\hyperlink{namespaceoomph_a4a82243b0ce4c28469a290fe2d7cd2c4}{pause}}(\textcolor{stringliteral}{"{}Yes really pause"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01954}01954 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01955}01955 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01956}01956     \textcolor{comment}{// The max. refinement levels of the two meshes need to differ}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01957}01957     \textcolor{comment}{// by one, otherwise what we're doing here doesn't make sense.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01958}01958     \textcolor{keywordtype}{unsigned} my\_min, my\_max;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01959}01959     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4321288b6642d5057498f7659d76}{get\_refinement\_levels}}(my\_min, my\_max);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01960}01960 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01961}01961     \textcolor{keywordtype}{unsigned} ref\_min, ref\_max;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01962}01962     ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4321288b6642d5057498f7659d76}{get\_refinement\_levels}}(ref\_min, ref\_max);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01963}01963 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01964}01964     \textcolor{keywordflow}{if} (ref\_max != my\_max + 1)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01965}01965     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01966}01966       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01967}01967       error\_stream}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01968}01968         << \textcolor{stringliteral}{"{}Meshes definitely don't differ by one refinement level \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01969}01969         << \textcolor{stringliteral}{"{}max. refinement levels: "{}} << ref\_max << \textcolor{stringliteral}{"{} "{}} << my\_max << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01970}01970 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01971}01971       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01972}01972         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01973}01973     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01974}01974 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01975}01975 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01976}01976     \textcolor{comment}{// Vector storing the elements of the uniformly unrefined mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01977}01977     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} coarse\_elements\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01978}01978 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01979}01979     \textcolor{comment}{// Map storing which father elements have already been added to coarse mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01980}01980     \textcolor{comment}{// (Default return is 0).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01981}01981     std::map<Tree*, unsigned> father\_element\_included;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01982}01982 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01983}01983     \textcolor{comment}{// Extract active elements (=leaf nodes in the quadtree) from reference}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01984}01984     \textcolor{comment}{// mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01985}01985     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} leaf\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01986}01986     ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a6d99d1f513a60b9bd053ff98699cbe52}{stick\_leaves\_into\_vector}}(leaf\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01987}01987 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01988}01988     \textcolor{comment}{// Loop over all elements (in their quadtree impersonation) and}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01989}01989     \textcolor{comment}{// check if their fathers's sons are all leaves too:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01990}01990     \textcolor{keywordtype}{unsigned} nelem = leaf\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01991}01991     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01992}01992     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01993}01993       \textcolor{comment}{// Pointer to leaf node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01994}01994       \mbox{\hyperlink{classoomph_1_1Tree}{Tree}}* leaf\_pt = leaf\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01995}01995 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01996}01996       \textcolor{comment}{// Get pointer to father:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01997}01997       \mbox{\hyperlink{classoomph_1_1Tree}{Tree}}* father\_pt = leaf\_pt-\/>\mbox{\hyperlink{classoomph_1_1Tree_aa2918f6d84795c9f366adb178e287843}{father\_pt}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01998}01998 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l01999}01999       \textcolor{comment}{// If we don't have a father we're at the root level in which}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02000}02000       \textcolor{comment}{// case this element can't be unrefined.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02001}02001       \textcolor{keywordflow}{if} (0 == father\_pt)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02002}02002       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02003}02003         coarse\_elements\_pt.push\_back(leaf\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02004}02004       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02005}02005       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02006}02006       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02007}02007         \textcolor{comment}{// Loop over the father's sons to check if they're}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02008}02008         \textcolor{comment}{// all non-\/leafs, i.e. if they can be unrefined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02009}02009         \textcolor{keywordtype}{bool} can\_unrefine = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02010}02010         \textcolor{keywordtype}{unsigned} n\_sons = father\_pt-\/>\mbox{\hyperlink{classoomph_1_1Tree_a31e4123b40f6fb52d180a154c9123e85}{nsons}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02011}02011         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_sons; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02012}02012         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02013}02013           \textcolor{comment}{// If (at least) one of the sons is not a leaf, we can't unrefine}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02014}02014           \textcolor{keywordflow}{if} (!father\_pt-\/>\mbox{\hyperlink{classoomph_1_1Tree_a9851a9dd06212b6891ce9a8bc832d4cf}{son\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>\mbox{\hyperlink{classoomph_1_1Tree_a72000456c76880e3f78f8f8fb43d49d8}{is\_leaf}}()) can\_unrefine = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02015}02015         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02016}02016 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02017}02017         \textcolor{comment}{// If we can unrefine, the father element will be}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02018}02018         \textcolor{comment}{// an element in the coarse mesh, the sons won't}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02019}02019         \textcolor{keywordflow}{if} (can\_unrefine)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02020}02020         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02021}02021           \textcolor{keywordflow}{if} (father\_element\_included[father\_pt] == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02022}02022           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02023}02023             coarse\_elements\_pt.push\_back(father\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02024}02024             father\_element\_included[father\_pt] = 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02025}02025           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02026}02026         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02027}02027         \textcolor{comment}{// Son will still be there on the coarse mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02028}02028         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02029}02029         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02030}02030           coarse\_elements\_pt.push\_back(leaf\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02031}02031         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02032}02032       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02033}02033     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02034}02034 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02035}02035     \textcolor{comment}{// Number of elements in ref mesh if it was unrefined uniformly:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02036}02036     \textcolor{keywordtype}{unsigned} nel\_coarse = coarse\_elements\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02037}02037 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02038}02038 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02039}02039 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02040}02040     \textcolor{keywordtype}{bool} stop\_it = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02041}02041     \textcolor{comment}{// The numbers had better match otherwise we might as well stop now...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02042}02042     \textcolor{keywordflow}{if} (nel\_coarse != this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02043}02043     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02044}02044       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of elements in uniformly unrefined reference mesh: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02045}02045                  << nel\_coarse << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02046}02046       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of elements in 'this' mesh: "{}} << nel\_coarse}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02047}02047                  << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02048}02048       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}don't match"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02049}02049       stop\_it = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02050}02050     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02051}02051 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02052}02052 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02053}02053     \textcolor{comment}{// Now loop over all elements in uniformly coarsened reference mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02054}02054     \textcolor{comment}{// and check if add the number of any element that was created}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02055}02055     \textcolor{comment}{// by having had its sons merged to the vector of elements that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02056}02056     \textcolor{comment}{// need to get refined if we go the other way}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02057}02057     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} elements\_to\_be\_refined;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02058}02058     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nel\_coarse; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02059}02059     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02060}02060       \textcolor{keywordflow}{if} (father\_element\_included[coarse\_elements\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] == 1)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02061}02061       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02062}02062         elements\_to\_be\_refined.push\_back(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02063}02063       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02064}02064     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02065}02065 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02066}02066 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02067}02067 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02068}02068     \textcolor{comment}{// Doc troublesome meshes:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02069}02069     \textcolor{keywordflow}{if} (stop\_it)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02070}02070     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02071}02071       std::ofstream some\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02072}02072       some\_file.open(\textcolor{stringliteral}{"{}orig\_mesh.dat"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02073}02073       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aab74388e8e21325f3ca26f1bd99c26f7}{output}}(some\_file);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02074}02074       some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02075}02075       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Documented original ('this')mesh in orig\_mesh.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02076}02076                  << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02077}02077     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02078}02078 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02079}02079 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02080}02080 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02081}02081     \textcolor{comment}{// Now refine precisely these elements in "{}this"{} mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02082}02082     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a171be4c171cc60de5831f6a2ffaf278e}{refine\_selected\_elements}}(elements\_to\_be\_refined);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02083}02083 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02084}02084 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02085}02085 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02086}02086 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02087}02087     \textcolor{comment}{// Check if the nodal positions of all element's nodes agree}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02088}02088     \textcolor{comment}{// in the two fine meshes:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02089}02089     \textcolor{keywordtype}{double} tol = 1.0e-\/5;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02090}02090     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nelem; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02091}02091     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02092}02092       \textcolor{comment}{// Get elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02093}02093       \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* ref\_el\_pt = ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a479059b0964826a8cee6eb506b57268a}{finite\_element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02094}02094       \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* el\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a479059b0964826a8cee6eb506b57268a}{finite\_element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02095}02095 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02096}02096       \textcolor{comment}{// Loop over nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02097}02097       \textcolor{keywordtype}{unsigned} nnod = ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02098}02098       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnod; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02099}02099       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02100}02100         \textcolor{comment}{// Get nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02101}02101         Node* ref\_node\_pt = ref\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02102}02102         Node* \mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}} = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02103}02103 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02104}02104         \textcolor{comment}{// Check error in position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02105}02105         \textcolor{keywordtype}{double} error = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02106}02106         \textcolor{keywordtype}{unsigned} ndim = \mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02107}02107         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ndim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02108}02108         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02109}02109           error += pow(\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) -\/ ref\_node\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}), 2);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02110}02110         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02111}02111         error = sqrt(error);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02112}02112 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02113}02113         \textcolor{keywordflow}{if} (error > tol)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02114}02114         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02115}02115           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Error in nodal position of node "{}} << j << \textcolor{stringliteral}{"{}: "{}} << error}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02116}02116                      << \textcolor{stringliteral}{"{}           [tol="{}} << tol << \textcolor{stringliteral}{"{}]"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02117}02117           stop\_it = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02118}02118         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02119}02119       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02120}02120     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02121}02121 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02122}02122     \textcolor{comment}{// Do we have a death wish?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02123}02123     \textcolor{keywordflow}{if} (stop\_it)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02124}02124     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02125}02125       \textcolor{comment}{// Doc troublesome meshes:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02126}02126       std::ofstream some\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02127}02127       some\_file.open(\textcolor{stringliteral}{"{}refined\_mesh.dat"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02128}02128       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aab74388e8e21325f3ca26f1bd99c26f7}{output}}(some\_file);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02129}02129       some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02130}02130 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02131}02131       some\_file.open(\textcolor{stringliteral}{"{}finer\_mesh.dat"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02132}02132       ref\_mesh\_pt-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aab74388e8e21325f3ca26f1bd99c26f7}{output}}(some\_file);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02133}02133       some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02134}02134 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02135}02135       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02136}02136         \textcolor{stringliteral}{"{}Bailing out. Doced refined\_mesh.dat finer\_mesh.dat\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02137}02137         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02138}02138         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02139}02139     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02140}02140 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02141}02141 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02142}02142   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02143}02143 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02144}02144 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02145}02145   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02146}02146 \textcolor{comment}{  /// Unrefine mesh uniformly. Return 0 for success,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02147}02147 \textcolor{comment}{  /// 1 for failure (if unrefinement has reached the coarsest permitted}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02148}02148 \textcolor{comment}{  /// level)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02149}02149 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02150}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a52940028ba9f6472df7e7c65be265057}{02150}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a52940028ba9f6472df7e7c65be265057}{TreeBasedRefineableMeshBase::unrefine\_uniformly}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02151}02151   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02152}02152     \textcolor{comment}{// We can't just select all elements for unrefinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02153}02153     \textcolor{comment}{// because they need to merge with their brothers.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02154}02154     \textcolor{comment}{// -\/-\/> Rather than repeating the convoluted logic of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02155}02155     \textcolor{comment}{// RefineableQuadMesh<ELEMENT>::adapt(Vector<double>\& elemental\_error)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02156}02156     \textcolor{comment}{// here (code duplication!) hack it by filling the error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02157}02157     \textcolor{comment}{// vector with values that ensure unrefinement for all}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02158}02158     \textcolor{comment}{// elements where this is possible}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02159}02159 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02160}02160     \textcolor{comment}{// Create dummy vector for elemental errors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02161}02161     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Nelement = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02162}02162     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} elemental\_error(Nelement);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02163}02163 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02164}02164     \textcolor{comment}{// In order to force unrefinement, set the min permitted error to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02165}02165     \textcolor{comment}{// be the default and then set the actual error to be below this.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02166}02166     \textcolor{comment}{// This avoids problems when the actual min error is zero (or small)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02167}02167     \textcolor{comment}{// For sanity's sake, also set the max permitted error back to the default}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02168}02168     \textcolor{comment}{// so that we have a max error bigger than a min error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02169}02169     \textcolor{keyword}{const} \textcolor{keywordtype}{double} current\_min\_error = this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1bb8bffa773bed50db992c9732c7665c}{min\_permitted\_error}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02170}02170     \textcolor{keyword}{const} \textcolor{keywordtype}{double} current\_max\_error = this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_aebcb375a38f7491b52c1f5c757d51fd3}{max\_permitted\_error}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02171}02171 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02172}02172     this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1bb8bffa773bed50db992c9732c7665c}{min\_permitted\_error}}() = 1.0e-\/5;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02173}02173     this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_aebcb375a38f7491b52c1f5c757d51fd3}{max\_permitted\_error}}() = 1.0e-\/3;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02174}02174 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02175}02175     \textcolor{keywordtype}{double} error = \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1bb8bffa773bed50db992c9732c7665c}{min\_permitted\_error}}() / 100.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02176}02176     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Nelement; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02177}02177     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02178}02178       elemental\_error[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = error;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02179}02179     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02180}02180 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02181}02181     \textcolor{comment}{// Temporarily lift any restrictions on the minimum number of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02182}02182     \textcolor{comment}{// elements that need to be unrefined to make it worthwhile}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02183}02183     \textcolor{keywordtype}{unsigned} backup = \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a09009ca14843d8bf7109e90dbcd38635}{max\_keep\_unrefined}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02184}02184     \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a09009ca14843d8bf7109e90dbcd38635}{max\_keep\_unrefined}}() = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02185}02185 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02186}02186     \textcolor{comment}{// Do the actual mesh adaptation with fake error vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02187}02187     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ac98d4120b99d5c6cbcf7225a9ee5648d}{adapt}}(elemental\_error);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02188}02188 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02189}02189     \textcolor{comment}{// Reset the minimum number of elements that need to be unrefined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02190}02190     \textcolor{comment}{// to make it worthwhile}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02191}02191     \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a09009ca14843d8bf7109e90dbcd38635}{max\_keep\_unrefined}}() = backup;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02192}02192 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02193}02193     \textcolor{comment}{// Now restore the error tolerances}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02194}02194     this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1bb8bffa773bed50db992c9732c7665c}{min\_permitted\_error}}() = current\_min\_error;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02195}02195     this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_aebcb375a38f7491b52c1f5c757d51fd3}{max\_permitted\_error}}() = current\_max\_error;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02196}02196 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02197}02197     \textcolor{comment}{// Has the unrefinement actually changed anything?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02198}02198     \textcolor{keywordflow}{if} (Nelement == this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02199}02199     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02200}02200       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02201}02201     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02202}02202     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02203}02203     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02204}02204       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02205}02205     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02206}02206   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02207}02207 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02208}02208   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02209}02209 \textcolor{comment}{  /// Given a node, return a vector of pointers to master nodes and a}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02210}02210 \textcolor{comment}{  /// vector of the associated weights.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02211}02211 \textcolor{comment}{  /// This is done recursively, so if a node is not hanging,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02212}02212 \textcolor{comment}{  /// the node is regarded as its own master node which has weight 1.0.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02213}02213 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02214}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dd9c95ee6c2ffcd687ad0ed736c5ba3}{02214}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dd9c95ee6c2ffcd687ad0ed736c5ba3}{TreeBasedRefineableMeshBase::complete\_hanging\_nodes\_recursively}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02215}02215     Node*\& nod\_pt,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02216}02216     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}}\& master\_nodes,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02217}02217     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& hang\_weights,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02218}02218     \textcolor{keyword}{const} \textcolor{keywordtype}{int}\& \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02219}02219   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02220}02220     \textcolor{comment}{// Is the node hanging in the variable i}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02221}02221     \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02222}02222     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02223}02223       \textcolor{comment}{// Loop over all master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02224}02224       \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}}* \textcolor{keyword}{const} hang\_pt = nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02225}02225       \textcolor{keywordtype}{unsigned} nmaster = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02226}02226 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02227}02227       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nmaster; m++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02228}02228       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02229}02229         \textcolor{comment}{// Get the master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02230}02230         Node* master\_nod\_pt = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_a7a935ae7eeca594a648ca1800444827c}{master\_node\_pt}}(m);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02231}02231 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02232}02232         \textcolor{comment}{// Keep in memory the size of the list before adding the nodes this}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02233}02233         \textcolor{comment}{// master node depends on. This is required so that the recursion is}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02234}02234         \textcolor{comment}{// only performed on these particular master nodes. A master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02235}02235         \textcolor{comment}{// could contain contributions from two separate pseudo-\/masters.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02236}02236         \textcolor{comment}{// These contributions must be summed, not multiplied.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02237}02237         \textcolor{keywordtype}{int} first\_new\_node = master\_nodes.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02238}02238 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02239}02239         \textcolor{comment}{// Now check which master nodes this master node depends on}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02240}02240         \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dd9c95ee6c2ffcd687ad0ed736c5ba3}{complete\_hanging\_nodes\_recursively}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02241}02241           master\_nod\_pt, master\_nodes, hang\_weights, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02242}02242 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02243}02243         \textcolor{comment}{// Multiply old weight by new weight for all the nodes this master}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02244}02244         \textcolor{comment}{// node depends on}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02245}02245         \textcolor{keywordtype}{unsigned} n\_new\_master\_node = master\_nodes.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02246}02246 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02247}02247         \textcolor{keywordtype}{double} mtr\_weight = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_ac49ebdd8957a658fe4a2420108d2dcee}{master\_weight}}(m);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02248}02248 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02249}02249         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = first\_new\_node; k < n\_new\_master\_node; k++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02250}02250         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02251}02251           hang\_weights[k] = mtr\_weight * hang\_weights[k];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02252}02252         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02253}02253       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02254}02254     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02255}02255     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02256}02256     \textcolor{comment}{// Node isn't hanging so it enters itself with the full weight}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02257}02257     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02258}02258       master\_nodes.push\_back(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02259}02259       hang\_weights.push\_back(1.0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02260}02260     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02261}02261   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02262}02262 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02263}02263 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02264}02264   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02265}02265 \textcolor{comment}{  /// Complete the hanging node scheme recursively.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02266}02266 \textcolor{comment}{  /// After the initial markup scheme, hanging nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02267}02267 \textcolor{comment}{  /// can depend on other hanging nodes -\/-\/-\/> AAAAAAAAARGH!}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02268}02268 \textcolor{comment}{  /// Need to translate this into a scheme where all}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02269}02269 \textcolor{comment}{  /// hanging  nodes only depend on non-\/hanging nodes...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02270}02270 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02271}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aab6f14b0933edc819231a88b1d555f62}{02271}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aab6f14b0933edc819231a88b1d555f62}{TreeBasedRefineableMeshBase::complete\_hanging\_nodes}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02272}02272     \textcolor{keyword}{const} \textcolor{keywordtype}{int}\& ncont\_interpolated\_values)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02273}02273   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02274}02274     \textcolor{comment}{// Number of nodes in mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02275}02275     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_node = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02276}02276     \textcolor{keywordtype}{double} min\_weight = 1.0e-\/8; \textcolor{comment}{// RefineableBrickElement::min\_weight\_value();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02277}02277 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02278}02278     \textcolor{comment}{// Loop over the nodes in the mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02279}02279     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02280}02280     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02281}02281       \textcolor{comment}{// Assign a local pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02282}02282       Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02283}02283 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02284}02284       \textcolor{comment}{// Loop over the values,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02285}02285       \textcolor{comment}{// N.B. geometric hanging data is stored at the index -\/1}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02286}02286       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = -\/1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ncont\_interpolated\_values; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02287}02287       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02288}02288         \textcolor{comment}{// Is the node hanging?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02289}02289         \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02290}02290         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02291}02291           \textcolor{comment}{// If it is geometric OR has hanging node data that differs}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02292}02292           \textcolor{comment}{// from the geometric data, we must do some work}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02293}02293           \textcolor{keywordflow}{if} ((\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} == -\/1) || (nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) != nod\_pt-\/>hanging\_pt()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02294}02294           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02295}02295             \textcolor{comment}{// Find out the ultimate map of dependencies: Master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02296}02296             \textcolor{comment}{// and associated weights}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02297}02297             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}} master\_nodes;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02298}02298             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} hanging\_weights;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02299}02299             \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a6dd9c95ee6c2ffcd687ad0ed736c5ba3}{complete\_hanging\_nodes\_recursively}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02300}02300               nod\_pt, master\_nodes, hanging\_weights, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02301}02301 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02302}02302             \textcolor{comment}{// put them into a map to merge all the occurences of the same node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02303}02303             \textcolor{comment}{// (add the weights)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02304}02304             std::map<Node*, double> hang\_weights;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02305}02305             \textcolor{keywordtype}{unsigned} n\_master = master\_nodes.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02306}02306             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_master; k++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02307}02307             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02308}02308               \textcolor{keywordflow}{if} (std::fabs(hanging\_weights[k]) > min\_weight)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02309}02309                 hang\_weights[master\_nodes[k]] += hanging\_weights[k];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02310}02310             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02311}02311 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02312}02312             \textcolor{comment}{// Create new hanging data (we know how many data there are)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02313}02313             \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}}* hang\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}}(hang\_weights.size());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02314}02314 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02315}02315             \textcolor{keywordtype}{unsigned} hang\_weights\_index = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02316}02316             \textcolor{comment}{// Copy the map into the HangInfo object}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02317}02317             \textcolor{keyword}{typedef} std::map<Node*, double>::iterator IT;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02318}02318             \textcolor{keywordflow}{for} (IT it = hang\_weights.begin(); it != hang\_weights.end(); ++it)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02319}02319             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02320}02320               hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_afe4042d5805342d5e12b6a28e376885a}{set\_master\_node\_pt}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02321}02321                 hang\_weights\_index, it-\/>first, it-\/>second);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02322}02322               ++hang\_weights\_index;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02323}02323             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02324}02324 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02325}02325             \textcolor{comment}{// Assign the new hanging pointer to the appropriate value}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02326}02326             nod\_pt-\/>set\_hanging\_pt(hang\_pt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02327}02327           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02328}02328         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02329}02329       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02330}02330     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02331}02331 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02332}02332 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02333}02333 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02334}02334     \textcolor{comment}{// Check hanging node scheme: The weights need to add up to one}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02335}02335     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02336}02336     \textcolor{comment}{// Loop over all values indices}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02337}02337     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = -\/1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ncont\_interpolated\_values; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02338}02338     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02339}02339       \textcolor{comment}{// Loop over all nodes in mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02340}02340       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02341}02341       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02342}02342         \textcolor{comment}{// Set a local pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02343}02343         Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02344}02344 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02345}02345         \textcolor{comment}{// Is it hanging?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02346}02346         \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02347}02347         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02348}02348           \textcolor{keywordtype}{unsigned} nmaster = nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>nmaster();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02349}02349           \textcolor{keywordtype}{double} sum = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02350}02350           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imaster = 0; imaster < nmaster; imaster++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02351}02351           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02352}02352             sum += nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>master\_weight(imaster);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02353}02353           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02354}02354           \textcolor{keywordflow}{if} (std::fabs(sum -\/ 1.0) > 1.0e-\/7)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02355}02355           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02356}02356             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}WARNING: Sum of master node weights fabs(sum-\/1.0) "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02357}02357                        << std::fabs(sum -\/ 1.0) << \textcolor{stringliteral}{"{} for node number "{}} << n}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02358}02358                        << \textcolor{stringliteral}{"{} at value "{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02359}02359           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02360}02360         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02361}02361       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02362}02362     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02363}02363 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02364}02364   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02365}02365 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02366}02366   \textcolor{comment}{// Sorting out the cases of nodes that are hanging on at least one but not}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02367}02367   \textcolor{comment}{// all of the processors for which they are part of the local mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02368}02368 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02369}02369 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02370}02370 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02371}02371   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02372}02372 \textcolor{comment}{  /// Deal with nodes that are hanging on one process but not another}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02373}02373 \textcolor{comment}{  /// (i.e. the hanging status of the haloed and halo layers disagrees)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02374}02374 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02375}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0ba902eb4b63aaa8c4da1aadcf25709a}{02375}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0ba902eb4b63aaa8c4da1aadcf25709a}{TreeBasedRefineableMeshBase::synchronise\_hanging\_nodes}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02376}02376     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ncont\_interpolated\_values)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02377}02377   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02378}02378     \textcolor{comment}{// Store number of processors and current process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02379}02379     MPI\_Status status;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02380}02380     \textcolor{keywordtype}{int} n\_proc = \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02381}02381     \textcolor{keywordtype}{int} my\_rank = \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02382}02382 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02383}02383     \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02384}02384     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02385}02385 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02386}02386     \textcolor{comment}{// Storage for the hanging status of halo/haloed nodes on elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02387}02387     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<int>}}> haloed\_hanging(n\_proc);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02388}02388     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<int>}}> halo\_hanging(n\_proc);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02389}02389 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02390}02390     \textcolor{comment}{// Counter for the number of nodes which require additional synchronisation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02391}02391     \textcolor{keywordtype}{unsigned} nnode\_still\_requiring\_synchronisation = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02392}02392 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02393}02393     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02394}02394     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02395}02395       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02396}02396     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02397}02397 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02398}02398     \textcolor{comment}{// Store number of continuosly interpolated values as int}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02399}02399     \textcolor{keywordtype}{int} ncont\_inter\_values = ncont\_interpolated\_values;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02400}02400 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02401}02401     \textcolor{comment}{// Loop over processes: Each processor checks that is haloed nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02402}02402     \textcolor{comment}{// with proc d have consistent hanging stats with halo counterparts.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02403}02403     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02404}02404     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02405}02405       \textcolor{comment}{// No halo with self: Setup hang info for my haloed nodes with proc d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02406}02406       \textcolor{comment}{// then get ready to receive halo info from processor d.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02407}02407       \textcolor{keywordflow}{if} (d != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02408}02408       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02409}02409         \textcolor{comment}{// Loop over haloed nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02410}02410         \textcolor{keywordtype}{unsigned} nh = \mbox{\hyperlink{classoomph_1_1Mesh_ad3202cdf7b1b35f8b3db51430dbbb8c6}{nhaloed\_node}}(d);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02411}02411         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nh; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02412}02412         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02413}02413           \textcolor{comment}{// Get node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02414}02414           Node* nod\_pt = \mbox{\hyperlink{classoomph_1_1Mesh_ab29fbaa5e88f722de752b3fd642a75e4}{haloed\_node\_pt}}(d, j);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02415}02415 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02416}02416           \textcolor{comment}{// Loop over the hanging status for each interpolated variable}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02417}02417           \textcolor{comment}{// (and the geometry)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02418}02418           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} icont = -\/1; icont < ncont\_inter\_values; icont++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02419}02419           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02420}02420             \textcolor{comment}{// Store the hanging status of this haloed node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02421}02421             \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging(icont))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02422}02422             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02423}02423               \textcolor{keywordtype}{unsigned} n\_master = nod\_pt-\/>hanging\_pt(icont)-\/>nmaster();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02424}02424               haloed\_hanging[d].push\_back(n\_master);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02425}02425             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02426}02426             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02427}02427             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02428}02428               haloed\_hanging[d].push\_back(0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02429}02429             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02430}02430           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02431}02431         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02432}02432 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02433}02433         \textcolor{comment}{// Receive the hanging status information from the corresponding process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02434}02434         \textcolor{keywordtype}{unsigned} count\_haloed = haloed\_hanging[d].size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02435}02435 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02436}02436 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02437}02437         \textcolor{comment}{// Check that number of halo and haloed data match}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02438}02438         \textcolor{keywordtype}{unsigned} tmp = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02439}02439         MPI\_Recv(\&tmp, 1, MPI\_UNSIGNED, d, 0, \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(), \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02440}02440         \textcolor{keywordflow}{if} (tmp != count\_haloed)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02441}02441         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02442}02442           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02443}02443           error\_stream << \textcolor{stringliteral}{"{}Number of halo data, "{}} << tmp}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02444}02444                        << \textcolor{stringliteral}{"{}, does not match number of haloed data, "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02445}02445                        << count\_haloed << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02446}02446           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02447}02447                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02448}02448                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02449}02449         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02450}02450 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02451}02451 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02452}02452         \textcolor{comment}{// Get the data (if any)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02453}02453         \textcolor{keywordflow}{if} (count\_haloed != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02454}02454         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02455}02455           halo\_hanging[d].resize(count\_haloed);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02456}02456           MPI\_Recv(\&halo\_hanging[d][0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02457}02457                    count\_haloed,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02458}02458                    MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02459}02459                    d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02460}02460                    0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02461}02461                    \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02462}02462                    \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02463}02463         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02464}02464       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02465}02465       \textcolor{keywordflow}{else} \textcolor{comment}{// d==my\_rank, i.e. current process: Send halo hanging status}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02466}02466            \textcolor{comment}{// to process dd where it's received (see above) and compared}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02467}02467            \textcolor{comment}{// and compared against the hang status of the haloed nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02468}02468       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02469}02469         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} dd = 0; dd < n\_proc; dd++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02470}02470         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02471}02471           \textcolor{comment}{// No halo with yourself}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02472}02472           \textcolor{keywordflow}{if} (dd != d)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02473}02473           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02474}02474             \textcolor{comment}{// Storage for halo hanging status and counter}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02475}02475             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} local\_halo\_hanging;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02476}02476 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02477}02477             \textcolor{comment}{// Loop over halo nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02478}02478             \textcolor{keywordtype}{unsigned} nh = \mbox{\hyperlink{classoomph_1_1Mesh_aa19080c0e68facf0e8c8ec55b327279f}{nhalo\_node}}(dd);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02479}02479             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nh; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02480}02480             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02481}02481               \textcolor{comment}{// Get node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02482}02482               Node* nod\_pt = \mbox{\hyperlink{classoomph_1_1Mesh_ad7ba73da180acb43523166ee71fb2e99}{halo\_node\_pt}}(dd, j);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02483}02483 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02484}02484               \textcolor{comment}{// Loop over the hanging status for each interpolated variable}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02485}02485               \textcolor{comment}{// (and the geometry)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02486}02486               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} icont = -\/1; icont < ncont\_inter\_values; icont++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02487}02487               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02488}02488                 \textcolor{comment}{// Store hanging status of halo node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02489}02489                 \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging(icont))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02490}02490                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02491}02491                   \textcolor{keywordtype}{unsigned} n\_master = nod\_pt-\/>hanging\_pt(icont)-\/>nmaster();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02492}02492                   local\_halo\_hanging.push\_back(n\_master);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02493}02493                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02494}02494                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02495}02495                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02496}02496                   local\_halo\_hanging.push\_back(0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02497}02497                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02498}02498               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02499}02499             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02500}02500 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02501}02501 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02502}02502             \textcolor{comment}{// Send the information to the relevant process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02503}02503             \textcolor{keywordtype}{unsigned} count\_halo = local\_halo\_hanging.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02504}02504 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02505}02505 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02506}02506             \textcolor{comment}{// Check that number of halo and haloed data match}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02507}02507             MPI\_Send(\&count\_halo, 1, MPI\_UNSIGNED, dd, 0, \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02508}02508 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02509}02509 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02510}02510             \textcolor{comment}{// Send data (if any)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02511}02511             \textcolor{keywordflow}{if} (count\_halo != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02512}02512             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02513}02513               MPI\_Send(\&local\_halo\_hanging[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02514}02514                        count\_halo,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02515}02515                        MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02516}02516                        dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02517}02517                        0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02518}02518                        \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02519}02519             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02520}02520           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02521}02521         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02522}02522       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02523}02523     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02524}02524 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02525}02525     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02526}02526     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02527}02527       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02528}02528       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for first all-\/to-\/all in synchronise\_hanging\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02529}02529                  << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02530}02530       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02531}02531     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02532}02532 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02533}02533 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02534}02534     \textcolor{comment}{// Now compare equivalent halo and haloed vectors to find discrepancies.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02535}02535     \textcolor{comment}{// It is possible that a master node may not be on either process involved}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02536}02536     \textcolor{comment}{// in the halo-\/haloed scheme; to work round this, we use the shared\_node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02537}02537     \textcolor{comment}{// storage scheme, which stores all nodes that are on each pair of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02538}02538     \textcolor{comment}{// processors in the same order on each of the two processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02539}02539 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02540}02540     \textcolor{comment}{// Vector to store info that will help us locate master nodes on "{}other"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02541}02541     \textcolor{comment}{// processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02542}02542     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<HangHelperStruct>}} hang\_info;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02543}02543 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02544}02544     \textcolor{comment}{// Copy vector-\/based representation of shared nodes into}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02545}02545     \textcolor{comment}{// map for faster search}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02546}02546     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::map<Node*, unsigned>}}> shared\_node\_map(n\_proc);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02547}02547     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02548}02548     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02549}02549       \textcolor{keywordtype}{unsigned} n = \mbox{\hyperlink{classoomph_1_1Mesh_a0fba80dc38b8577982b94309e4e1d3d7}{Shared\_node\_pt}}[d].size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02550}02550       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} jj = 0; jj < n; jj++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02551}02551       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02552}02552         shared\_node\_map[d][\mbox{\hyperlink{classoomph_1_1Mesh_a0fba80dc38b8577982b94309e4e1d3d7}{Shared\_node\_pt}}[d][jj]] = jj;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02553}02553       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02554}02554     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02555}02555 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02556}02556 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02557}02557     \textcolor{comment}{// Loop over domains: Each processor checks consistency of hang status}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02558}02558     \textcolor{comment}{// of its haloed nodes with proc d against the halo counterpart. Haloed}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02559}02559     \textcolor{comment}{// wins if there are any discrepancies.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02560}02560     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02561}02561     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02562}02562       \textcolor{comment}{// No halo with yourself}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02563}02563       \textcolor{keywordflow}{if} (d != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02564}02564       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02565}02565         \textcolor{keywordtype}{unsigned} discrepancy\_count = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02566}02566         \textcolor{keywordtype}{unsigned} discrepancy\_count\_buff = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02567}02567 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02568}02568         \textcolor{comment}{// Storage for hanging information that needs to be sent to the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02569}02569         \textcolor{comment}{// relevant process if there is a discrepancy in the hanging status}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02570}02570         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_data;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02571}02571         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} send\_double\_data;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02572}02572         \textcolor{comment}{// Buffer storage for data to be sent}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02573}02573         \textcolor{comment}{//(We need this because we cannot tell until the end of the loop over}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02574}02574         \textcolor{comment}{// a node's master nodes whether we can reconcile its hanging status)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02575}02575         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_data\_buff(0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02576}02576         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} send\_double\_data\_buff(0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02577}02577 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02578}02578         \textcolor{comment}{// Counter for traversing haloed data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02579}02579         \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02580}02580 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02581}02581         \textcolor{comment}{// Indicate presence of discrepancy. Default: there's none}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02582}02582         \textcolor{keywordtype}{unsigned} discrepancy = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02583}02583         \textcolor{keywordtype}{unsigned} discrepancy\_buff = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02584}02584 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02585}02585         \textcolor{comment}{// Loop over haloed nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02586}02586         \textcolor{keywordtype}{unsigned} nh = \mbox{\hyperlink{classoomph_1_1Mesh_ad3202cdf7b1b35f8b3db51430dbbb8c6}{nhaloed\_node}}(d);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02587}02587         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nh; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02588}02588         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02589}02589           \textcolor{comment}{// Get node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02590}02590           Node* nod\_pt = \mbox{\hyperlink{classoomph_1_1Mesh_ab29fbaa5e88f722de752b3fd642a75e4}{haloed\_node\_pt}}(d, j);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02591}02591 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02592}02592           \textcolor{comment}{// Loop over the hanging status for each interpolated variable}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02593}02593           \textcolor{comment}{// (and the geometry)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02594}02594           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} icont = -\/1; icont < ncont\_inter\_values; icont++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02595}02595           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02596}02596             \textcolor{comment}{// Compare hanging status of halo/haloed counterpart structure}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02597}02597 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02598}02598             \textcolor{comment}{// Haloed is is hanging and haloed has different number}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02599}02599             \textcolor{comment}{// of master nodes (which includes none in which case it isn't}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02600}02600             \textcolor{comment}{// hanging)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02601}02601             \textcolor{keywordflow}{if} ((haloed\_hanging[d][count] > 0) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02602}02602                 (haloed\_hanging[d][count] != halo\_hanging[d][count]))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02603}02603             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02604}02604               discrepancy\_buff = 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02605}02605               discrepancy\_count\_buff++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02606}02606 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02607}02607               \textcolor{comment}{// Flag to check if all masters of this node have been found}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02608}02608               \textcolor{keywordtype}{bool} found\_all\_masters = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02609}02609 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02610}02610               \textcolor{comment}{// Find master nodes of haloed node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02611}02611               \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}}* hang\_pt = nod\_pt-\/>hanging\_pt(icont);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02612}02612               \textcolor{keywordtype}{unsigned} nhd\_master = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02613}02613 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02614}02614               \textcolor{comment}{// Add the number of master nodes to the hanging\_nodes vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02615}02615               send\_data\_buff.push\_back(nhd\_master);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02616}02616 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02617}02617               \textcolor{comment}{// Loop over master nodes required for HangInfo}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02618}02618               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nhd\_master; m++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02619}02619               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02620}02620                 \textcolor{comment}{// Get mth master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02621}02621                 Node* master\_nod\_pt = hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_a7a935ae7eeca594a648ca1800444827c}{master\_node\_pt}}(m);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02622}02622 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02623}02623 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02624}02624                 \textcolor{comment}{//              //-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02625}02625                 \textcolor{comment}{//              // Old direct search is much slower!}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02626}02626                 \textcolor{comment}{//              // Keep this code alive to allow comparisons}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02627}02627                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02628}02628                 \textcolor{comment}{//              double t\_start\_search=TimingHelpers::timer();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02629}02629                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02630}02630                 \textcolor{comment}{//              // This node will be shared: find it!}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02631}02631                 \textcolor{comment}{//              bool found=false;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02632}02632                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02633}02633                 \textcolor{comment}{//              // Look in shared node storage with domain d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02634}02634                 \textcolor{comment}{//              first unsigned nnod\_shared=nshared\_node(d); for}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02635}02635                 \textcolor{comment}{//              (unsigned k=0; k<nnod\_shared; k++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02636}02636                 \textcolor{comment}{//               \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02637}02637                 \textcolor{comment}{//                if (master\_nod\_pt==shared\_node\_pt(d,k))}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02638}02638                 \textcolor{comment}{//                 \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02639}02639                 \textcolor{comment}{//                  // Found a master: Put its number in the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02640}02640                 \textcolor{comment}{//                  shared}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02641}02641                 \textcolor{comment}{//                  // scheme into send data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02642}02642                 \textcolor{comment}{//                  send\_data.push\_back(k);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02643}02643                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02644}02644                 \textcolor{comment}{//                  // Add the weight}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02645}02645                 \textcolor{comment}{//                  send\_double\_data.push\_back(hang\_pt-\/>master\_weight(m));}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02646}02646                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02647}02647                 \textcolor{comment}{//                  // Done}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02648}02648                 \textcolor{comment}{//                  found=true;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02649}02649                 \textcolor{comment}{//                  break;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02650}02650                 \textcolor{comment}{//                 \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02651}02651                 \textcolor{comment}{//               \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02652}02652                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02653}02653                 \textcolor{comment}{//              double t\_end\_search=TimingHelpers::timer();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02654}02654                 \textcolor{comment}{//              t\_start\_search\_total+=(t\_end\_search-\/t\_start\_search);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02655}02655                 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02656}02656                 \textcolor{comment}{//              // end direct search demo}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02657}02657                 \textcolor{comment}{//              //-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02658}02658 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02659}02659 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02660}02660                 \textcolor{comment}{// This node will be shared: find it!}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02661}02661                 \textcolor{keywordtype}{bool} found = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02662}02662 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02663}02663                 \textcolor{comment}{// Which processor holds the non-\/halo counterpart of this}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02664}02664                 \textcolor{comment}{// node?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02665}02665                 \textcolor{keywordtype}{int} non\_halo\_proc\_id = master\_nod\_pt-\/>non\_halo\_proc\_ID();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02666}02666 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02667}02667                 \textcolor{comment}{// Try to find node in map with proc d and get iterator to entry}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02668}02668                 std::map<Node*, unsigned>::iterator it =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02669}02669                   shared\_node\_map[d].find(master\_nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02670}02670 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02671}02671                 \textcolor{comment}{// If it's not in there iterator points to end of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02672}02672                 \textcolor{comment}{// set}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02673}02673                 \textcolor{keywordflow}{if} (it != shared\_node\_map[d].end())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02674}02674                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02675}02675                   \textcolor{comment}{// Found a master: When looking up the node in the shared}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02676}02676                   \textcolor{comment}{// node scheme on processor d, which processor do I work}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02677}02677                   \textcolor{comment}{// with? The current one}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02678}02678                   send\_data\_buff.push\_back(my\_rank);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02679}02679 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02680}02680                   \textcolor{comment}{// Found a master: Send its index in the shared}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02681}02681                   \textcolor{comment}{// node scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02682}02682                   send\_data\_buff.push\_back((*it).second);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02683}02683 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02684}02684                   \textcolor{comment}{// Add the weight}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02685}02685                   send\_double\_data\_buff.push\_back(hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_ac49ebdd8957a658fe4a2420108d2dcee}{master\_weight}}(m));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02686}02686 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02687}02687                   \textcolor{comment}{// Done}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02688}02688                   found = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02689}02689                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02690}02690 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02691}02691                 \textcolor{comment}{// If we haven't found it in the shared node scheme with proc d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02692}02692                 \textcolor{comment}{// find it in the shared node scheme with the processor that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02693}02693                 \textcolor{comment}{// holds the non-\/halo version}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02694}02694                 \textcolor{keywordflow}{if} (!found)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02695}02695                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02696}02696                   \textcolor{comment}{// This is odd -\/-\/ can't currently handle the case where}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02697}02697                   \textcolor{comment}{// node is owned by current processor (indicated by}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02698}02698                   \textcolor{comment}{// non\_halo\_proc\_id being negative}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02699}02699                   \textcolor{keywordflow}{if} (non\_halo\_proc\_id < 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02700}02700                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02701}02701                     \textcolor{comment}{// This case is now handled by the function}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02702}02702                     \textcolor{comment}{// additional\_synchronise\_hanging\_nodes()}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02703}02703                     \textcolor{comment}{// called (if necessary) at the end}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02704}02704                     \textcolor{comment}{// OomphLibWarning(}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02705}02705                     \textcolor{comment}{// "{}Odd: missing master node is owned by current proc. Will}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02706}02706                     \textcolor{comment}{// crash below."{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02707}02707                     \textcolor{comment}{// "{}TreeBasedRefineableMeshBase::synchronise\_hanging\_nodes(...)"{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02708}02708                     \textcolor{comment}{// OOMPH\_EXCEPTION\_LOCATION);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02709}02709                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02710}02710                   \textcolor{keywordflow}{else} \textcolor{comment}{// i.e. (non\_halo\_proc\_id>=0)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02711}02711                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02712}02712                     \textcolor{keywordflow}{if} (shared\_node\_map[non\_halo\_proc\_id].size() > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02713}02713                     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02714}02714                       std::map<Node*, unsigned>::iterator it =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02715}02715                         shared\_node\_map[non\_halo\_proc\_id].find(master\_nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02716}02716 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02717}02717                       \textcolor{comment}{// If it's not in there iterator points to end of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02718}02718                       \textcolor{comment}{// set}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02719}02719                       \textcolor{keywordflow}{if} (it != shared\_node\_map[non\_halo\_proc\_id].end())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02720}02720                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02721}02721                         \textcolor{comment}{// Found a master: Send ID of processor that holds}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02722}02722                         \textcolor{comment}{// non-\/halo (the fact that this is different from}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02723}02723                         \textcolor{comment}{// my\_rank (the processor that sends this) will alert}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02724}02724                         \textcolor{comment}{// the other processor to the fact that it needs to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02725}02725                         send\_data\_buff.push\_back(non\_halo\_proc\_id);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02726}02726 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02727}02727                         \textcolor{comment}{// Found a master: Send its index in the shared}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02728}02728                         \textcolor{comment}{// node scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02729}02729                         send\_data\_buff.push\_back((*it).second);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02730}02730 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02731}02731                         \textcolor{comment}{// Add the weight}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02732}02732                         send\_double\_data\_buff.push\_back(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02733}02733                           hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_ac49ebdd8957a658fe4a2420108d2dcee}{master\_weight}}(m));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02734}02734 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02735}02735                         \textcolor{comment}{// Done}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02736}02736                         found = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02737}02737 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02738}02738                         \textcolor{comment}{// It is possible that the master node found in the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02739}02739                         \textcolor{comment}{// shared storage with processor <non\_halo\_proc\_id> does}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02740}02740                         \textcolor{comment}{// not actually exist on processor d. If it does turn}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02741}02741                         \textcolor{comment}{// out to exist, we are ok, but if not then we must}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02742}02742                         \textcolor{comment}{// remember to create it later (in the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02743}02743                         \textcolor{comment}{// additional\_synchronise\_hanging\_nodes() function)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02744}02744                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02745}02745                     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02746}02746                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02747}02747                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02748}02748 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02749}02749                 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02750}02750 \textcolor{comment}{                // Don't throw error, we will construct missing master nodes in}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02751}02751 \textcolor{comment}{                // additional\_synchronise\_hanging\_nodes() below}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02752}02752 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02753}02753 \textcolor{comment}{                // Paranoid check: if we haven't found the master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02754}02754 \textcolor{comment}{                // then throw an error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02755}02755 \textcolor{comment}{                if (!found)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02756}02756 \textcolor{comment}{                 \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02757}02757 \textcolor{comment}{                  char filename[100];}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02758}02758 \textcolor{comment}{                  std::ofstream some\_file;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02759}02759 \textcolor{comment}{                  sprintf(filename,"{}sync\_hanging\_node\_crash\_mesh\_proc\%i.dat"{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02760}02760 \textcolor{comment}{                          my\_rank);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02761}02761 \textcolor{comment}{                  some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02762}02762 \textcolor{comment}{                  this-\/>output(some\_file);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02763}02763 \textcolor{comment}{                  some\_file.close();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02764}02764 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02765}02765 \textcolor{comment}{                  sprintf(filename,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02766}02766 \textcolor{comment}{                          "{}sync\_hanging\_node\_crash\_mesh\_with\_haloes\_proc\%i.dat"{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02767}02767 \textcolor{comment}{                          my\_rank);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02768}02768 \textcolor{comment}{                  some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02769}02769 \textcolor{comment}{                  this-\/>enable\_output\_of\_halo\_elements();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02770}02770 \textcolor{comment}{                  this-\/>output(some\_file);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02771}02771 \textcolor{comment}{                  this-\/>disable\_output\_of\_halo\_elements();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02772}02772 \textcolor{comment}{                  some\_file.close();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02773}02773 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02774}02774 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02775}02775 \textcolor{comment}{                  std::set<unsigned> other\_proc\_id;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02776}02776 \textcolor{comment}{                  other\_proc\_id.insert(d);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02777}02777 \textcolor{comment}{                  other\_proc\_id.insert(non\_halo\_proc\_id);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02778}02778 \textcolor{comment}{                  for (std::set<unsigned>::iterator it=other\_proc\_id.begin();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02779}02779 \textcolor{comment}{                       it!=other\_proc\_id.end();it++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02780}02780 \textcolor{comment}{                   \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02781}02781 \textcolor{comment}{                    unsigned d\_doc=(*it);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02782}02782 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02783}02783 \textcolor{comment}{                    sprintf(}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02784}02784 \textcolor{comment}{                     filename,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02785}02785 \textcolor{comment}{                     "{}sync\_hanging\_node\_crash\_halo\_elements\_with\_proc\%i\_proc\%i.dat"{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02786}02786 \textcolor{comment}{                     d\_doc,my\_rank);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02787}02787 \textcolor{comment}{                    some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02788}02788 \textcolor{comment}{                    Vector<GeneralisedElement*>}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02789}02789 \textcolor{comment}{                     halo\_elem\_pt(this-\/>halo\_element\_pt(d\_doc));}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02790}02790 \textcolor{comment}{                    unsigned nelem=halo\_elem\_pt.size();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02791}02791 \textcolor{comment}{                    for (unsigned e=0;e<nelem;e++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02792}02792 \textcolor{comment}{                     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02793}02793 \textcolor{comment}{                      FiniteElement* el\_pt=}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02794}02794 \textcolor{comment}{                       dynamic\_cast<FiniteElement*>(halo\_elem\_pt[e]);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02795}02795 \textcolor{comment}{                      el\_pt-\/>output(some\_file);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02796}02796 \textcolor{comment}{                     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02797}02797 \textcolor{comment}{                    some\_file.close();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02798}02798 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02799}02799 \textcolor{comment}{                    sprintf(}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02800}02800 \textcolor{comment}{                     filename,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02801}02801 \textcolor{comment}{                     "{}sync\_hanging\_node\_crash\_haloed\_elements\_with\_proc\%i\_proc\%i.dat"{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02802}02802 \textcolor{comment}{                     d\_doc,my\_rank);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02803}02803 \textcolor{comment}{                    some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02804}02804 \textcolor{comment}{                    Vector<GeneralisedElement*>}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02805}02805 \textcolor{comment}{                     haloed\_elem\_pt(this-\/>haloed\_element\_pt(d\_doc));}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02806}02806 \textcolor{comment}{                    nelem=haloed\_elem\_pt.size();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02807}02807 \textcolor{comment}{                    for (unsigned e=0;e<nelem;e++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02808}02808 \textcolor{comment}{                     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02809}02809 \textcolor{comment}{                      FiniteElement* el\_pt=}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02810}02810 \textcolor{comment}{                       dynamic\_cast<FiniteElement*>(haloed\_elem\_pt[e]);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02811}02811 \textcolor{comment}{                      el\_pt-\/>output(some\_file);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02812}02812 \textcolor{comment}{                     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02813}02813 \textcolor{comment}{                    some\_file.close();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02814}02814 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02815}02815 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02816}02816 \textcolor{comment}{                    sprintf(}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02817}02817 \textcolor{comment}{                     filename,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02818}02818 \textcolor{comment}{                     "{}sync\_hanging\_node\_crash\_shared\_nodes\_with\_proc\%i\_proc\%i.dat"{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02819}02819 \textcolor{comment}{                     d\_doc,my\_rank);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02820}02820 \textcolor{comment}{                    some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02821}02821 \textcolor{comment}{                    unsigned n=nshared\_node(d\_doc);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02822}02822 \textcolor{comment}{                    for (unsigned j=0;j<n;j++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02823}02823 \textcolor{comment}{                     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02824}02824 \textcolor{comment}{                      Node* nod\_pt=shared\_node\_pt(d\_doc,j);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02825}02825 \textcolor{comment}{                      unsigned nd=nod\_pt-\/>ndim();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02826}02826 \textcolor{comment}{                      for (unsigned i=0;i<nd;i++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02827}02827 \textcolor{comment}{                       \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02828}02828 \textcolor{comment}{                        some\_file << nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02829}02829 \textcolor{comment}{                       \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02830}02830 \textcolor{comment}{                      some\_file << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02831}02831 \textcolor{comment}{                     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02832}02832 \textcolor{comment}{                    some\_file.close();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02833}02833 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02834}02834 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02835}02835 \textcolor{comment}{                    sprintf(}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02836}02836 \textcolor{comment}{                     filename,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02837}02837 \textcolor{comment}{                     "{}sync\_hanging\_node\_crash\_halo\_nodes\_with\_proc\%i\_proc\%i.dat"{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02838}02838 \textcolor{comment}{                     d\_doc,my\_rank);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02839}02839 \textcolor{comment}{                    some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02840}02840 \textcolor{comment}{                    n=nhalo\_node(d\_doc);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02841}02841 \textcolor{comment}{                    for (unsigned j=0;j<n;j++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02842}02842 \textcolor{comment}{                     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02843}02843 \textcolor{comment}{                      Node* nod\_pt=halo\_node\_pt(d\_doc,j);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02844}02844 \textcolor{comment}{                      unsigned nd=nod\_pt-\/>ndim();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02845}02845 \textcolor{comment}{                      for (unsigned i=0;i<nd;i++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02846}02846 \textcolor{comment}{                       \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02847}02847 \textcolor{comment}{                        some\_file << nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02848}02848 \textcolor{comment}{                       \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02849}02849 \textcolor{comment}{                      some\_file << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02850}02850 \textcolor{comment}{                     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02851}02851 \textcolor{comment}{                    some\_file.close();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02852}02852 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02853}02853 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02854}02854 \textcolor{comment}{                    sprintf(}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02855}02855 \textcolor{comment}{                     filename,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02856}02856 \textcolor{comment}{                     "{}sync\_hanging\_node\_crash\_haloed\_nodes\_with\_proc\%i\_proc\%i.dat"{},}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02857}02857 \textcolor{comment}{                     d\_doc,my\_rank);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02858}02858 \textcolor{comment}{                    some\_file.open(filename);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02859}02859 \textcolor{comment}{                    n=nhaloed\_node(d\_doc);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02860}02860 \textcolor{comment}{                    for (unsigned j=0;j<n;j++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02861}02861 \textcolor{comment}{                     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02862}02862 \textcolor{comment}{                      Node* nod\_pt=haloed\_node\_pt(d\_doc,j);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02863}02863 \textcolor{comment}{                      unsigned nd=nod\_pt-\/>ndim();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02864}02864 \textcolor{comment}{                      for (unsigned i=0;i<nd;i++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02865}02865 \textcolor{comment}{                       \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02866}02866 \textcolor{comment}{                        some\_file << nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02867}02867 \textcolor{comment}{                       \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02868}02868 \textcolor{comment}{                      some\_file << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02869}02869 \textcolor{comment}{                     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02870}02870 \textcolor{comment}{                    some\_file.close();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02871}02871 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02872}02872 \textcolor{comment}{                   \} // end of loop over all inter-\/processor lookup schemes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02873}02873 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02874}02874 \textcolor{comment}{                  std::ostringstream error\_stream;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02875}02875 \textcolor{comment}{                  unsigned n=master\_nod\_pt-\/>ndim();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02876}02876 \textcolor{comment}{                  error\_stream  << "{}Error: Master node at:\(\backslash\)n\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02877}02877 \textcolor{comment}{                  for (unsigned i=0;i<n;i++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02878}02878 \textcolor{comment}{                   \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02879}02879 \textcolor{comment}{                    error\_stream <<  master\_nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02880}02880 \textcolor{comment}{                   \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02881}02881 \textcolor{comment}{                  error\_stream   << "{}\(\backslash\)n\(\backslash\)nnot found for icont="{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02882}02882 \textcolor{comment}{                                 << icont << "{}in  "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02883}02883 \textcolor{comment}{                                 << "{}shared node storage with proc "{} << d <<}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02884}02884 \textcolor{comment}{                "{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02885}02885 \textcolor{comment}{                                 << "{}or in shared node storage with proc "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02886}02886 \textcolor{comment}{                                 << non\_halo\_proc\_id}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02887}02887 \textcolor{comment}{                                 << "{} which is where its non-\/halo counterpart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02888}02888 \textcolor{comment}{                lives.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02889}02889 \textcolor{comment}{                                 << "{}Relevant files:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02890}02890 \textcolor{comment}{                sync\_hanging\_node\_crash*.dat\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02891}02891 \textcolor{comment}{                                 << "{}Hanging node itself: \(\backslash\)n\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02892}02892 \textcolor{comment}{                  n=nod\_pt-\/>ndim();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02893}02893 \textcolor{comment}{                  for (unsigned i=0;i<n;i++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02894}02894 \textcolor{comment}{                   \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02895}02895 \textcolor{comment}{                    error\_stream << nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02896}02896 \textcolor{comment}{                   \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02897}02897 \textcolor{comment}{                  error\_stream << nod\_pt-\/>non\_halo\_proc\_ID();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02898}02898 \textcolor{comment}{                  error\_stream << "{}\(\backslash\)n\(\backslash\)nMaster nodes:\(\backslash\)n\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02899}02899 \textcolor{comment}{                  for (unsigned m=0; m<nhd\_master; m++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02900}02900 \textcolor{comment}{                   \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02901}02901 \textcolor{comment}{                    Node* master\_nod\_pt=hang\_pt-\/>master\_node\_pt(m);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02902}02902 \textcolor{comment}{                    n=master\_nod\_pt-\/>ndim();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02903}02903 \textcolor{comment}{                    for (unsigned i=0;i<n;i++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02904}02904 \textcolor{comment}{                     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02905}02905 \textcolor{comment}{                      error\_stream << master\_nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02906}02906 \textcolor{comment}{                     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02907}02907 \textcolor{comment}{                    error\_stream << master\_nod\_pt-\/>non\_halo\_proc\_ID();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02908}02908 \textcolor{comment}{                    error\_stream << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02909}02909 \textcolor{comment}{                   \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02910}02910 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02911}02911 \textcolor{comment}{                  // try to find it somewhere else -\/-\/ sub-\/optimal search but}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02912}02912 \textcolor{comment}{                  // we're about to die on our arses (yes, plural -\/-\/ this is}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02913}02913 \textcolor{comment}{                  // a parallel run!) anyway...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02914}02914 \textcolor{comment}{                  for (int dddd=0;dddd<n\_proc;dddd++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02915}02915 \textcolor{comment}{                   \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02916}02916 \textcolor{comment}{                    bool loc\_found=false;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02917}02917 \textcolor{comment}{                    unsigned nnnod\_shared=nshared\_node(dddd);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02918}02918 \textcolor{comment}{                    for (unsigned k=0; k<nnnod\_shared; k++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02919}02919 \textcolor{comment}{                     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02920}02920 \textcolor{comment}{                      if (master\_nod\_pt==shared\_node\_pt(dddd,k))}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02921}02921 \textcolor{comment}{                       \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02922}02922 \textcolor{comment}{                        loc\_found=true;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02923}02923 \textcolor{comment}{                        error\_stream}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02924}02924 \textcolor{comment}{                         << "{}Found that master node as "{} << k}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02925}02925 \textcolor{comment}{                         << "{}-\/th entry in shared node storage with proc "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02926}02926 \textcolor{comment}{                         << dddd << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02927}02927 \textcolor{comment}{                       \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02928}02928 \textcolor{comment}{                     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02929}02929 \textcolor{comment}{                    if (!loc\_found)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02930}02930 \textcolor{comment}{                     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02931}02931 \textcolor{comment}{                      error\_stream}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02932}02932 \textcolor{comment}{                       << "{}Did not find that master node in shared node storage}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02933}02933 \textcolor{comment}{                with proc "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02934}02934 \textcolor{comment}{                       << dddd << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02935}02935 \textcolor{comment}{                     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02936}02936 \textcolor{comment}{                   \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02937}02937 \textcolor{comment}{                  error\_stream << "{}\(\backslash\)n\(\backslash\)n"{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02938}02938 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02939}02939 \textcolor{comment}{                  throw OomphLibError(}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02940}02940 \textcolor{comment}{                   error\_stream.str(),}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02941}02941 \textcolor{comment}{                   OOMPH\_CURRENT\_FUNCTION,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02942}02942 \textcolor{comment}{                   OOMPH\_EXCEPTION\_LOCATION);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02943}02943 \textcolor{comment}{                 \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02944}02944 \textcolor{comment}{                */}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02945}02945 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02946}02946                 \textcolor{comment}{// Check if the master has been found}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02947}02947                 \textcolor{keywordflow}{if} (!found)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02948}02948                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02949}02949                   \textcolor{comment}{// If this master hasn't been found then set the flag}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02950}02950                   found\_all\_masters = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02951}02951                   \textcolor{comment}{// No need to continue searching for masters}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02952}02952                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02953}02953                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02954}02954 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02955}02955 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02956}02956               \} \textcolor{comment}{// loop over master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02957}02957 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02958}02958 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02959}02959               \textcolor{comment}{// Check if we need to send the data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02960}02960               \textcolor{keywordflow}{if} (found\_all\_masters)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02961}02961               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02962}02962                 \textcolor{comment}{// All masters were found, so populate send data from buffer}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02963}02963                 discrepancy = discrepancy\_buff;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02964}02964                 discrepancy\_count += discrepancy\_count\_buff;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02965}02965                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < send\_data\_buff.size(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02966}02966                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02967}02967                   send\_data.push\_back(send\_data\_buff[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02968}02968                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02969}02969                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < send\_double\_data\_buff.size(); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02970}02970                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02971}02971                   send\_double\_data.push\_back(send\_double\_data\_buff[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02972}02972                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02973}02973 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02974}02974                 \textcolor{comment}{// Clear buffers and reset}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02975}02975                 discrepancy\_buff = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02976}02976                 discrepancy\_count\_buff = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02977}02977                 send\_data\_buff.clear();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02978}02978                 send\_double\_data\_buff.clear();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02979}02979               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02980}02980               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02981}02981               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02982}02982                 \textcolor{comment}{// At least one master node was not found, so we can't}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02983}02983                 \textcolor{comment}{// reconcile the hanging status of this node yet. We tell}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02984}02984                 \textcolor{comment}{// the other processor to do nothing for now.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02985}02985                 send\_data.push\_back(0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02986}02986 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02987}02987                 \textcolor{comment}{// Clear buffers and reset}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02988}02988                 discrepancy\_buff = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02989}02989                 discrepancy\_count\_buff = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02990}02990                 send\_data\_buff.clear();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02991}02991                 send\_double\_data\_buff.clear();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02992}02992 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02993}02993                 \textcolor{comment}{// Set flag to trigger another round of synchronisation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02994}02994                 nnode\_still\_requiring\_synchronisation++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02995}02995               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02996}02996             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02997}02997             \textcolor{comment}{// Haloed node isn't hanging but halo is: the latter}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02998}02998             \textcolor{comment}{// shouldn't so send a -\/1 to indicate that it's to be made}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l02999}02999             \textcolor{comment}{// non-\/hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03000}03000             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((haloed\_hanging[d][count] == 0) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03001}03001                      (halo\_hanging[d][count] > 0))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03002}03002             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03003}03003               discrepancy = 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03004}03004               discrepancy\_count++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03005}03005               send\_data.push\_back(-\/1);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03006}03006             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03007}03007             \textcolor{comment}{// Both halo and haloed node have the same number of masters}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03008}03008             \textcolor{comment}{// we're happy!}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03009}03009             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (haloed\_hanging[d][count] == halo\_hanging[d][count])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03010}03010             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03011}03011               send\_data.push\_back(0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03012}03012             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03013}03013             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03014}03014             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03015}03015               std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03016}03016               error\_stream << \textcolor{stringliteral}{"{}Never get here!\(\backslash\)n "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03017}03017                            << \textcolor{stringliteral}{"{}haloed\_hanging[d][count]="{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03018}03018                            << haloed\_hanging[d][count]}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03019}03019                            << \textcolor{stringliteral}{"{}; halo\_hanging[d][count]="{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03020}03020                            << halo\_hanging[d][count] << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03021}03021               \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03022}03022                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03023}03023                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03024}03024             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03025}03025             \textcolor{comment}{// Increment counter for number of haloed data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03026}03026             count++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03027}03027           \} \textcolor{comment}{// end of loop over icont}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03028}03028         \} \textcolor{comment}{// end of loop over haloed nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03029}03029 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03030}03030         \textcolor{comment}{// Now send all the required info to the equivalent halo layer -\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03031}03031         \textcolor{comment}{// If there are no discrepancies, no need to send anything}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03032}03032         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} n\_all\_send(2, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03033}03033         \textcolor{keywordflow}{if} (discrepancy == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03034}03034         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03035}03035           MPI\_Send(\&n\_all\_send[0], 2, MPI\_UNSIGNED, d, 0, \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03036}03036         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03037}03037         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03038}03038         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03039}03039           \textcolor{comment}{// How much data is there to be sent?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03040}03040           n\_all\_send[0] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03041}03041           n\_all\_send[1] = send\_double\_data.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03042}03042           MPI\_Send(\&n\_all\_send[0], 2, MPI\_UNSIGNED, d, 0, \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03043}03043 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03044}03044           \textcolor{comment}{// Send flat-\/packed ints}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03045}03045           \textcolor{keywordflow}{if} (n\_all\_send[0] != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03046}03046           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03047}03047             MPI\_Send(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03048}03048               \&send\_data[0], n\_all\_send[0], MPI\_INT, d, 1, \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03049}03049           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03050}03050 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03051}03051           \textcolor{comment}{// Send flat-\/packed double data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03052}03052           \textcolor{keywordflow}{if} (n\_all\_send[1] != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03053}03053           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03054}03054             MPI\_Send(\&send\_double\_data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03055}03055                      n\_all\_send[1],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03056}03056                      MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03057}03057                      d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03058}03058                      1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03059}03059                      \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03060}03060           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03061}03061         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03062}03062       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03063}03063       \textcolor{keywordflow}{else} \textcolor{comment}{// (d==my\_rank), current process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03064}03064       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03065}03065         \textcolor{comment}{// Receive the master nodes and weights in order to modify the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03066}03066         \textcolor{comment}{// hanging status of nodes in the halo layer}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03067}03067         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} dd = 0; dd < n\_proc; dd++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03068}03068         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03069}03069           \textcolor{keywordflow}{if} (dd != d) \textcolor{comment}{// don't talk to yourself}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03070}03070           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03071}03071             \textcolor{comment}{// Are we going to receive anything? This is zero}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03072}03072             \textcolor{comment}{// either if there are no discrepancies or there's zero}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03073}03073             \textcolor{comment}{// data to be sent.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03074}03074             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} n\_all\_recv(2, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03075}03075             MPI\_Recv(\&n\_all\_recv[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03076}03076                      2,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03077}03077                      MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03078}03078                      dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03079}03079                      0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03080}03080                      \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03081}03081                      \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03082}03082 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03083}03083             \textcolor{comment}{// Storage for received information}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03084}03084             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_data;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03085}03085             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} receive\_double\_data;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03086}03086 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03087}03087             \textcolor{comment}{// Receive unsigneds (if any)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03088}03088             \textcolor{keywordflow}{if} (n\_all\_recv[0] != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03089}03089             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03090}03090               \textcolor{comment}{// Receive the data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03091}03091               receive\_data.resize(n\_all\_recv[0]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03092}03092               MPI\_Recv(\&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03093}03093                        n\_all\_recv[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03094}03094                        MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03095}03095                        dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03096}03096                        1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03097}03097                        \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03098}03098                        \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03099}03099             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03100}03100 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03101}03101             \textcolor{comment}{// Receive doubles (if any)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03102}03102             \textcolor{keywordflow}{if} (n\_all\_recv[1] != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03103}03103             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03104}03104               \textcolor{comment}{// Receive the data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03105}03105               receive\_double\_data.resize(n\_all\_recv[1]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03106}03106               MPI\_Recv(\&receive\_double\_data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03107}03107                        n\_all\_recv[1],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03108}03108                        MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03109}03109                        dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03110}03110                        1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03111}03111                        \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03112}03112                        \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03113}03113             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03114}03114 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03115}03115             \textcolor{comment}{// If no information, no need to do anything else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03116}03116             \textcolor{keywordflow}{if} (n\_all\_recv[0] != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03117}03117             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03118}03118               \textcolor{comment}{// Counters for traversing received data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03119}03119               \textcolor{keywordtype}{unsigned} count = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03120}03120               \textcolor{keywordtype}{unsigned} count\_double = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03121}03121 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03122}03122               \textcolor{comment}{// Loop over halo nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03123}03123               \textcolor{keywordtype}{unsigned} nh = \mbox{\hyperlink{classoomph_1_1Mesh_aa19080c0e68facf0e8c8ec55b327279f}{nhalo\_node}}(dd);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03124}03124               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nh; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03125}03125               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03126}03126                 \textcolor{comment}{// Get node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03127}03127                 Node* nod\_pt = \mbox{\hyperlink{classoomph_1_1Mesh_ad7ba73da180acb43523166ee71fb2e99}{halo\_node\_pt}}(dd, j);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03128}03128 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03129}03129                 \textcolor{comment}{// Loop over the hanging status for each interpolated variable}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03130}03130                 \textcolor{comment}{// (and the geometry)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03131}03131                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} icont = -\/1; icont < ncont\_inter\_values; icont++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03132}03132                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03133}03133                   \textcolor{comment}{// Read next entry}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03134}03134                   \textcolor{keywordtype}{int} next\_entry = receive\_data[count++];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03135}03135 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03136}03136                   \textcolor{comment}{// If it's positive, then the number tells us how}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03137}03137                   \textcolor{comment}{// many master nodes we have}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03138}03138                   \textcolor{keywordflow}{if} (next\_entry > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03139}03139                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03140}03140                     \textcolor{keywordtype}{unsigned} nhd\_master = unsigned(next\_entry);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03141}03141 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03142}03142                     \textcolor{comment}{// Set up a new HangInfo for this node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03143}03143                     \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}}* hang\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}}(nhd\_master);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03144}03144 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03145}03145                     \textcolor{comment}{// Now set up the master nodes and weights}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03146}03146                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < nhd\_master; m++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03147}03147                     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03148}03148                       \textcolor{comment}{// Get the sent master node (a shared node) and}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03149}03149                       \textcolor{comment}{// the weight}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03150}03150 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03151}03151                       \textcolor{comment}{// ID of proc in whose shared node lookup scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03152}03152                       \textcolor{comment}{// the sending processor found the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03153}03153                       \textcolor{keywordtype}{unsigned} shared\_node\_proc =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03154}03154                         unsigned(receive\_data[count++]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03155}03155 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03156}03156                       \textcolor{comment}{// Index of node in the shared node lookup scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03157}03157                       \textcolor{keywordtype}{unsigned} shared\_node\_id = unsigned(receive\_data[count++]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03158}03158 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03159}03159                       \textcolor{comment}{// Get weight}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03160}03160                       \textcolor{keywordtype}{double} mtr\_weight = receive\_double\_data[count\_double++];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03161}03161 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03162}03162                       \textcolor{comment}{// If the shared node processor is the same as the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03163}03163                       \textcolor{comment}{// the sending processor we can processor everything here}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03164}03164                       \textcolor{keywordflow}{if} (shared\_node\_proc == \textcolor{keywordtype}{unsigned}(dd))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03165}03165                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03166}03166                         \textcolor{comment}{// Get node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03167}03167                         Node* master\_nod\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03168}03168                           \mbox{\hyperlink{classoomph_1_1Mesh_ae43776ad2c2cf72ed50cc32f927386d4}{shared\_node\_pt}}(dd, shared\_node\_id);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03169}03169 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03170}03170                         \textcolor{comment}{// Set as a master node (with corresponding weight)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03171}03171                         hang\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_afe4042d5805342d5e12b6a28e376885a}{set\_master\_node\_pt}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03172}03172                           m, master\_nod\_pt, mtr\_weight);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03173}03173                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03174}03174                       \textcolor{comment}{// ...otherwise we have do another communication with}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03175}03175                       \textcolor{comment}{// intermediate processor that holds the non-\/halo}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03176}03176                       \textcolor{comment}{// version of the master node -\/-\/ only that processor can}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03177}03177                       \textcolor{comment}{// translate the index of the node the share node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03178}03178                       \textcolor{comment}{// lookup scheme with the sending processor to the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03179}03179                       \textcolor{comment}{// index in the shared node lookup scheme with this}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03180}03180                       \textcolor{comment}{// processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03181}03181                       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03182}03182                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03183}03183                         \textcolor{comment}{// Store}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03184}03184                         \mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct}{HangHelperStruct}} tmp;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03185}03185                         tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_a293cbfe9698ea90db02075cd4c5aa539}{Sending\_processor}} = dd;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03186}03186                         tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_acd0bbce82b5faf25ff369c9746414467}{Shared\_node\_id\_on\_sending\_processor}} =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03187}03187                           shared\_node\_id;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03188}03188                         tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_a28da444296c07df207c92baf457a7cbf}{Shared\_node\_proc}} = shared\_node\_proc;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03189}03189                         tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_a9fe8ccacbdb16699f3b8909c184847de}{Weight}} = mtr\_weight;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03190}03190                         tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_a3ae5d1dcd6c1f8575cd729580e8cbb26}{Hang\_pt}} = hang\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03191}03191                         tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_ad27054cbdb0f2aee8cc57e2cdd068941}{Master\_node\_index}} = m;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03192}03192                         tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_ad427be917515d875cabad06307e9ae03}{Node\_pt}} = nod\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03193}03193                         tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_af54b83ec0892b7c9f67419dd36d57933}{icont}} = icont;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03194}03194                         hang\_info.push\_back(tmp);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03195}03195                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03196}03196                     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03197}03197 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03198}03198                     \textcolor{comment}{// Set the hanging pointer for the current halo node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03199}03199                     \textcolor{comment}{// (does delete any previous hang data)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03200}03200                     nod\_pt-\/>set\_hanging\_pt(hang\_pt, icont);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03201}03201                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03202}03202                   \textcolor{comment}{// Negative entry: the hanging node already exists,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03203}03203                   \textcolor{comment}{// but it shouldn't, so set it to nonhanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03204}03204                   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (next\_entry < 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03205}03205                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03206}03206                     nod\_pt-\/>set\_hanging\_pt(0, icont);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03207}03207                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03208}03208 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03209}03209                 \} \textcolor{comment}{// end of loop over icont}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03210}03210               \} \textcolor{comment}{// end of loop over nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03211}03211             \} \textcolor{comment}{// end of anything to receive}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03212}03212           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03213}03213         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03214}03214       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03215}03215     \} \textcolor{comment}{// end loop over all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03216}03216 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03217}03217 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03218}03218     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03219}03219     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03220}03220       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03221}03221       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for second all-\/to-\/all in synchronise\_hanging\_nodes() "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03222}03222                  << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03223}03223       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03224}03224     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03225}03225 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03226}03226 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03227}03227     \textcolor{comment}{// Now identify master nodes by translating index in shared}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03228}03228     \textcolor{comment}{// node lookup scheme from the lookup scheme with the sending}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03229}03229     \textcolor{comment}{// processor to that with the current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03230}03230     \textcolor{keywordtype}{unsigned} n = hang\_info.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03231}03231 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03232}03232     \textcolor{comment}{// Is there anything to do be done?}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03233}03233     \textcolor{keywordtype}{unsigned} global\_n = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03234}03234     MPI\_Allreduce(\&n, \&global\_n, 1, MPI\_UNSIGNED, MPI\_MAX, \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03235}03235     \textcolor{keywordflow}{if} (global\_n == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03236}03236     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03237}03237       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03238}03238         << \textcolor{stringliteral}{"{}No need for reconciliation of wrongly synchronised hang nodes\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03239}03239     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03240}03240     \textcolor{comment}{// Reconcilation required}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03241}03241     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03242}03242     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03243}03243       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Need to reconcile of wrongly syncronised hang nodes\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03244}03244 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03245}03245       \textcolor{comment}{// Storage for the translated entries (in order) for/from}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03246}03246       \textcolor{comment}{// other processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03247}03247       \textcolor{comment}{// Must be ints so that an entry of -\/1 tells the other processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03248}03248       \textcolor{comment}{// that the node could not be found. See comment above for why}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03249}03249       \textcolor{comment}{// this may be necessary.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03250}03250       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<int>}}> translated\_entry(n\_proc);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03251}03251 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03252}03252       \textcolor{comment}{// Storage for how-\/many-\/th entry in this processor's}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03253}03253       \textcolor{comment}{// hang\_info vector will be completed by processor rank.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03254}03254       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> hang\_info\_index\_for\_proc(n\_proc);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03255}03255 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03256}03256       \textcolor{comment}{// Send information to intermediate processor that holds}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03257}03257       \textcolor{comment}{// non-\/halo version of missing master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03258}03258       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03259}03259         \textcolor{comment}{// Storage for number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03260}03260         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03261}03261 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03262}03262         \textcolor{comment}{// Storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03263}03263         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_data;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03264}03264 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03265}03265         \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03266}03266         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03267}03267 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03268}03268         \textcolor{comment}{// Loop over all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03269}03269         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; rank++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03270}03270         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03271}03271           \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03272}03272           send\_displacement[rank] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03273}03273 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03274}03274           \textcolor{comment}{// Don't bother to do anything if the processor in the loop is the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03275}03275           \textcolor{comment}{// current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03276}03276           \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03277}03277           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03278}03278             \textcolor{comment}{// Search through the (typically few) entries}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03279}03279             \textcolor{comment}{// in hang info vector to find the ones that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03280}03280             \textcolor{comment}{// must be sent to proc rank (the proc that holds}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03281}03281             \textcolor{comment}{// the non-\/halo version of the "{}missing"{} master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03282}03282             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03283}03283             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03284}03284               \mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct}{HangHelperStruct}} tmp = hang\_info[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03285}03285               \textcolor{keywordflow}{if} (tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_a28da444296c07df207c92baf457a7cbf}{Shared\_node\_proc}} == \textcolor{keywordtype}{unsigned}(rank))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03286}03286               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03287}03287                 \textcolor{comment}{// Add the sending processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03288}03288                 send\_data.push\_back(tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_a293cbfe9698ea90db02075cd4c5aa539}{Sending\_processor}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03289}03289 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03290}03290                 \textcolor{comment}{// Add the index of the missing master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03291}03291                 \textcolor{comment}{// in the shared node lookup scheme between}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03292}03292                 \textcolor{comment}{// sending processor and processor rank}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03293}03293                 send\_data.push\_back(tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_acd0bbce82b5faf25ff369c9746414467}{Shared\_node\_id\_on\_sending\_processor}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03294}03294 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03295}03295                 \textcolor{comment}{// Record the how-\/many-\/th entry in this processor's}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03296}03296                 \textcolor{comment}{// hang\_info vector will be completed by processor rank.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03297}03297                 hang\_info\_index\_for\_proc[rank].push\_back(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03298}03298               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03299}03299             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03300}03300           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03301}03301 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03302}03302           \textcolor{comment}{// Find the number of data added to the vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03303}03303           send\_n[rank] = send\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03304}03304         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03305}03305 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03306}03306 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03307}03307         \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03308}03308         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03309}03309 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03310}03310         \textcolor{comment}{// Now send numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03311}03311         MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03312}03312                      1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03313}03313                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03314}03314                      \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03315}03315                      1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03316}03316                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03317}03317                      \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03318}03318 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03319}03319         \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03320}03320         \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03321}03321         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03322}03322         \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03323}03323         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03324}03324         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03325}03325           \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03326}03326           receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03327}03327           receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03328}03328         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03329}03329 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03330}03330         \textcolor{comment}{// Now resize the receive buffer for all data from all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03331}03331         \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03332}03332         \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03333}03333         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03334}03334           ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03335}03335         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03336}03336         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03337}03337 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03338}03338         \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03339}03339         \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03340}03340         \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03341}03341         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03342}03342           send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03343}03343         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03344}03344 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03345}03345         \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03346}03346         MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03347}03347                       \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03348}03348                       \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03349}03349                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03350}03350                       \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03351}03351                       \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03352}03352                       \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03353}03353                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03354}03354                       \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03355}03355 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03356}03356         \textcolor{comment}{// Now use the received data to update the halo nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03357}03357         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03358}03358         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03359}03359           \textcolor{comment}{// Don't bother to do anything for the processor corresponding to the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03360}03360           \textcolor{comment}{// current processor or if no data were received from this processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03361}03361           \textcolor{keywordflow}{if} ((send\_rank != my\_rank) \&\& (receive\_n[send\_rank] != 0))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03362}03362           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03363}03363             \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03364}03364             \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03365}03365 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03366}03366             \textcolor{comment}{// We're reading two numbers per missing halo node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03367}03367             \textcolor{keywordtype}{unsigned} n\_rec = unsigned(receive\_n[send\_rank]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03368}03368             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_rec / 2; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03369}03369             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03370}03370               \textcolor{comment}{// Receive orig sending proc}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03371}03371               \textcolor{keywordtype}{unsigned} orig\_sending\_proc = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03372}03372               count++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03373}03373 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03374}03374               \textcolor{comment}{// Receive the index of the missing master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03375}03375               \textcolor{comment}{// in the shared node lookup scheme between}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03376}03376               \textcolor{comment}{// orig sending processor and current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03377}03377               \textcolor{keywordtype}{unsigned} shared\_node\_id\_on\_orig\_sending\_proc =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03378}03378                 receive\_data[count];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03379}03379               count++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03380}03380 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03381}03381               \textcolor{comment}{// Extract node from shared node lookup scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03382}03382               Node* master\_nod\_pt = \mbox{\hyperlink{classoomph_1_1Mesh_ae43776ad2c2cf72ed50cc32f927386d4}{shared\_node\_pt}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03383}03383                 orig\_sending\_proc, shared\_node\_id\_on\_orig\_sending\_proc);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03384}03384 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03385}03385               \textcolor{comment}{// Now find it in shared halo scheme with the processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03386}03386               \textcolor{comment}{// that's sent the request}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03387}03387 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03388}03388               std::map<Node*, unsigned>::iterator it =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03389}03389                 shared\_node\_map[send\_rank].find(master\_nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03390}03390 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03391}03391               \textcolor{comment}{// If it's not in there iterator points to end of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03392}03392               \textcolor{comment}{// set}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03393}03393               \textcolor{keywordflow}{if} (it != shared\_node\_map[send\_rank].end())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03394}03394               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03395}03395                 \textcolor{comment}{// Store it so we can send it back}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03396}03396                 translated\_entry[send\_rank].push\_back((*it).second);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03397}03397               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03398}03398               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03399}03399               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03400}03400                 \textcolor{comment}{// This node has not been found in the shared scheme, so}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03401}03401                 \textcolor{comment}{// the translation query has failed. We send a -\/1 to tell}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03402}03402                 \textcolor{comment}{// the other processor the bad news.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03403}03403                 translated\_entry[send\_rank].push\_back(-\/1);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03404}03404 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03405}03405                 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03406}03406 \textcolor{comment}{                // We don't need to crash anymore because the function}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03407}03407 \textcolor{comment}{                // additional\_synchronise\_hanging\_nodes() will magically}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03408}03408 \textcolor{comment}{                // sort out all the problems!}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03409}03409 \textcolor{comment}{                std::ostringstream error\_stream;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03410}03410 \textcolor{comment}{                error\_stream}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03411}03411 \textcolor{comment}{                 << "{}Received translation query for shared node"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03412}03412 \textcolor{comment}{                 << "{} entry "{} << shared\_node\_id\_on\_orig\_sending\_proc}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03413}03413 \textcolor{comment}{                 << "{} with processor "{} << orig\_sending\_proc}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03414}03414 \textcolor{comment}{                 << "{} from proc "{} << send\_rank << std::endl}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03415}03415 \textcolor{comment}{                 << "{}but did not find node in shared node scheme with proc "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03416}03416 \textcolor{comment}{                 << send\_rank << std::endl;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03417}03417 \textcolor{comment}{                throw OomphLibError(}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03418}03418 \textcolor{comment}{                 error\_stream.str(),}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03419}03419 \textcolor{comment}{                 OOMPH\_CURRENT\_FUNCTION,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03420}03420 \textcolor{comment}{                 OOMPH\_EXCEPTION\_LOCATION);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03421}03421 \textcolor{comment}{                */}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03422}03422               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03423}03423             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03424}03424           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03425}03425         \} \textcolor{comment}{// End of data is received}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03426}03426 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03427}03427       \} \textcolor{comment}{// end of sending stuff to intermediate processor that holds}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03428}03428         \textcolor{comment}{// non halo version of missing master node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03429}03429 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03430}03430 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03431}03431       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03432}03432       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03433}03433         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03434}03434         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03435}03435           << \textcolor{stringliteral}{"{}Time for third all-\/to-\/all in synchronise\_hanging\_nodes() "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03436}03436           << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03437}03437         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03438}03438       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03439}03439 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03440}03440 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03441}03441       \textcolor{comment}{// Send information back to processor that needs to identify}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03442}03442       \textcolor{comment}{// missing master node via shared node lookup scheme with}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03443}03443       \textcolor{comment}{// this processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03444}03444       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03445}03445         \textcolor{comment}{// Storage for number of data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03446}03446         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03447}03447 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03448}03448         \textcolor{comment}{// Storage for all values to be sent to all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03449}03449         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_data;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03450}03450 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03451}03451         \textcolor{comment}{// Start location within send\_data for data to be sent to each processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03452}03452         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03453}03453 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03454}03454         \textcolor{comment}{// Loop over all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03455}03455         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; rank++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03456}03456         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03457}03457           \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03458}03458           send\_displacement[rank] = send\_data.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03459}03459 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03460}03460           \textcolor{comment}{// Don't bother to do anything if the processor in the loop is the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03461}03461           \textcolor{comment}{// current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03462}03462           \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03463}03463           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03464}03464             \textcolor{comment}{// Put the translated entries for processor rank into}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03465}03465             \textcolor{comment}{// send data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03466}03466             \textcolor{keywordtype}{unsigned} n = translated\_entry[rank].size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03467}03467             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03468}03468             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03469}03469               send\_data.push\_back(translated\_entry[rank][j]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03470}03470             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03471}03471           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03472}03472 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03473}03473           \textcolor{comment}{// Find the number of data added to the vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03474}03474           send\_n[rank] = send\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03475}03475         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03476}03476 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03477}03477 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03478}03478         \textcolor{comment}{// Storage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03479}03479         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_n(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03480}03480 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03481}03481         \textcolor{comment}{// Now send numbers of data to be sent between all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03482}03482         MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03483}03483                      1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03484}03484                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03485}03485                      \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03486}03486                      1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03487}03487                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03488}03488                      \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03489}03489 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03490}03490         \textcolor{comment}{// We now prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03491}03491         \textcolor{comment}{// by working out the displacements from the received data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03492}03492         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} receive\_displacement(n\_proc, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03493}03493         \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03494}03494         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rank = 0; rank < n\_proc; ++rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03495}03495         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03496}03496           \textcolor{comment}{// Displacement is number of data received so far}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03497}03497           receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03498}03498           receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03499}03499         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03500}03500 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03501}03501         \textcolor{comment}{// Now resize the receive buffer for all data from all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03502}03502         \textcolor{comment}{// Make sure that it has a size of at least one}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03503}03503         \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03504}03504         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03505}03505           ++receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03506}03506         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03507}03507         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} receive\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03508}03508 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03509}03509         \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03510}03510         \textcolor{comment}{// so that we don't get a segmentation fault}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03511}03511         \textcolor{keywordflow}{if} (send\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03512}03512         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03513}03513           send\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03514}03514         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03515}03515 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03516}03516         \textcolor{comment}{// Now send the data between all the processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03517}03517         MPI\_Alltoallv(\&send\_data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03518}03518                       \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03519}03519                       \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03520}03520                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03521}03521                       \&receive\_data[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03522}03522                       \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03523}03523                       \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03524}03524                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03525}03525                       \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03526}03526 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03527}03527         \textcolor{comment}{// Now use the received data to update the halo nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03528}03528         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} send\_rank = 0; send\_rank < n\_proc; send\_rank++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03529}03529         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03530}03530           \textcolor{comment}{// Don't bother to do anything for the processor corresponding to the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03531}03531           \textcolor{comment}{// current processor or if no data were received from this processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03532}03532           \textcolor{keywordflow}{if} ((send\_rank != my\_rank) \&\& (receive\_n[send\_rank] != 0))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03533}03533           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03534}03534             \textcolor{comment}{// Counter for the data within the large array}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03535}03535             \textcolor{keywordtype}{unsigned} count = receive\_displacement[send\_rank];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03536}03536 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03537}03537             \textcolor{comment}{// We're reading one number per missing halo node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03538}03538             \textcolor{keywordtype}{unsigned} n\_rec = unsigned(receive\_n[send\_rank]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03539}03539             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_rec; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03540}03540             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03541}03541               \textcolor{comment}{// Index of missing master node in shared node lookup scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03542}03542               \textcolor{comment}{// with processor send\_rank:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03543}03543               \textcolor{comment}{// Must be an int because failure returns -\/1}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03544}03544               \textcolor{keywordtype}{int} index = receive\_data[count];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03545}03545               count++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03546}03546 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03547}03547               \textcolor{comment}{// Translation query has been successful if index >= 0}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03548}03548               \textcolor{keywordflow}{if} (index >= 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03549}03549               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03550}03550                 \textcolor{comment}{// Recall information associated with that missing master}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03551}03551                 \textcolor{keywordtype}{unsigned} hang\_info\_index =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03552}03552                   hang\_info\_index\_for\_proc[send\_rank][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03553}03553                 \mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct}{HangHelperStruct}} tmp = hang\_info[hang\_info\_index];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03554}03554 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03555}03555                 \textcolor{comment}{// Extract node from shared node lookup scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03556}03556                 Node* master\_nod\_pt = \mbox{\hyperlink{classoomph_1_1Mesh_ae43776ad2c2cf72ed50cc32f927386d4}{shared\_node\_pt}}(send\_rank, index);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03557}03557 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03558}03558                 \textcolor{comment}{// Set as a master node (with corresponding weight)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03559}03559                 tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_a3ae5d1dcd6c1f8575cd729580e8cbb26}{Hang\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_afe4042d5805342d5e12b6a28e376885a}{set\_master\_node\_pt}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03560}03560                   tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_ad27054cbdb0f2aee8cc57e2cdd068941}{Master\_node\_index}}, master\_nod\_pt, tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_a9fe8ccacbdb16699f3b8909c184847de}{Weight}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03561}03561               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03562}03562               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03563}03563               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03564}03564                 \textcolor{comment}{// Translation query has failed. This is the processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03565}03565                 \textcolor{comment}{// on which the node was a halo, so we must delete the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03566}03566                 \textcolor{comment}{// partial hang info.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03567}03567 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03568}03568                 \textcolor{comment}{// Recall information associated with that missing master}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03569}03569                 \textcolor{keywordtype}{unsigned} hang\_info\_index =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03570}03570                   hang\_info\_index\_for\_proc[send\_rank][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03571}03571                 \mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct}{HangHelperStruct}} tmp = hang\_info[hang\_info\_index];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03572}03572 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03573}03573                 \textcolor{comment}{// Delete partial hanging information}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03574}03574                 tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_ad427be917515d875cabad06307e9ae03}{Node\_pt}}-\/>set\_hanging\_pt(0, tmp.\mbox{\hyperlink{structoomph_1_1TreeBasedRefineableMeshBase_1_1HangHelperStruct_af54b83ec0892b7c9f67419dd36d57933}{icont}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03575}03575 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03576}03576                 \textcolor{comment}{// Set flag to trigger another round of synchronisation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03577}03577                 \textcolor{comment}{// This works even though we don't own the node that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03578}03578                 \textcolor{comment}{// still requires synchrionisation because this variable}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03579}03579                 \textcolor{comment}{// is reduced over all processors at the end}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03580}03580                 nnode\_still\_requiring\_synchronisation++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03581}03581               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03582}03582             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03583}03583           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03584}03584         \} \textcolor{comment}{// End of data is received}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03585}03585 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03586}03586       \} \textcolor{comment}{// end of completing hang info for missing master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03587}03587 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03588}03588 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03589}03589       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03590}03590       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03591}03591         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03592}03592         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03593}03593           << \textcolor{stringliteral}{"{}Time for fourth all-\/to-\/all in synchronise\_hanging\_nodes() "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03594}03594           << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03595}03595       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03596}03596     \} \textcolor{comment}{// end  of reconciliation required}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03597}03597 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03598}03598 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03599}03599     \textcolor{comment}{// Get global number of nodes still requiring synchronisation due to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03600}03600     \textcolor{comment}{// missing master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03601}03601     \textcolor{comment}{// This will only be necessary for meshes involving elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03602}03602     \textcolor{comment}{// with nonuniformly spaced nodes. All other cases will continue to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03603}03603     \textcolor{comment}{// work as before because all nodes will have been successfully}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03604}03604     \textcolor{comment}{// synchronised by now}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03605}03605     \textcolor{keywordtype}{unsigned} global\_nnode\_still\_requiring\_synchronisation = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03606}03606     MPI\_Allreduce(\&nnode\_still\_requiring\_synchronisation,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03607}03607                   \&global\_nnode\_still\_requiring\_synchronisation,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03608}03608                   1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03609}03609                   MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03610}03610                   MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03611}03611                   \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03612}03612     \textcolor{keywordflow}{if} (global\_nnode\_still\_requiring\_synchronisation > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03613}03613     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03614}03614       \textcolor{keywordtype}{double} tt\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03615}03615       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03616}03616       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03617}03617         tt\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03618}03618       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03619}03619 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03620}03620       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Need to do additional synchronisation of hanging nodes"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03621}03621                  << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03622}03622 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03623}03623       \textcolor{comment}{// Do additional synchronisation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03624}03624       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a59d0404f8e5ebd7199f25c794c5c715c}{additional\_synchronise\_hanging\_nodes}}(ncont\_interpolated\_values);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03625}03625 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03626}03626       \textcolor{keywordtype}{double} tt\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03627}03627       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03628}03628       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03629}03629         tt\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03630}03630         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03631}03631           << \textcolor{stringliteral}{"{}Time for RefineableMesh::additional\_synchronise\_hanging\_nodes() "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03632}03632           << \textcolor{stringliteral}{"{}in TreeBasedRefineableMeshBase::synchronise\_hanging\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03633}03633           << tt\_end -\/ tt\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03634}03634         tt\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03635}03635       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03636}03636     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03637}03637     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03638}03638     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03639}03639       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}No need to do additional synchronisation of hanging nodes"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03640}03640                  << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03641}03641     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03642}03642   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03643}03643 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03644}03644   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03645}03645 \textcolor{comment}{  /// Synchronise the positions of non-\/hanging nodes that depend on}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03646}03646 \textcolor{comment}{  /// non-\/existent neighbours (e.g. h-\/refinement of neighbouring elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03647}03647 \textcolor{comment}{  /// with different p-\/orders where the shared edge is on the outer edge of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03648}03648 \textcolor{comment}{  /// the halo layer)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03649}03649 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03650}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ac6091e7d077cf416f296b95f086efe55}{03650}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ac6091e7d077cf416f296b95f086efe55}{TreeBasedRefineableMeshBase::synchronise\_nonhanging\_nodes}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03651}03651   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03652}03652     \textcolor{comment}{// Store number of processors and current process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03653}03653     MPI\_Status status;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03654}03654     \textcolor{keywordtype}{int} n\_proc = \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03655}03655     \textcolor{keywordtype}{int} my\_rank = \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03656}03656 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03657}03657     \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03658}03658     \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03659}03659 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03660}03660     \textcolor{comment}{// Storage for the hanging status of halo/haloed nodes on elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03661}03661     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<unsigned>}}> recv\_unsigneds(n\_proc);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03662}03662     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> recv\_doubles(n\_proc);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03663}03663 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03664}03664     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03665}03665     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03666}03666       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03667}03667     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03668}03668 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03669}03669     \textcolor{comment}{// Loop over processes: Each processor checks if its nonhaning nodes in}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03670}03670     \textcolor{comment}{// haloed elements with proc d require additional information to determine}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03671}03671     \textcolor{comment}{// their positions.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03672}03672     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03673}03673     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03674}03674       \textcolor{comment}{// No halo with self: Setup hang info for my haloed nodes with proc d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03675}03675       \textcolor{comment}{// then get ready to receive halo info from processor d.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03676}03676       \textcolor{keywordflow}{if} (d != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03677}03677       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03678}03678         \textcolor{comment}{// Receive the position information from the corresponding process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03679}03679         \textcolor{keywordtype}{unsigned} recv\_unsigneds\_count = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03680}03680         MPI\_Recv(\&recv\_unsigneds\_count,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03681}03681                  1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03682}03682                  MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03683}03683                  d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03684}03684                  0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03685}03685                  \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03686}03686                  \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03687}03687         \textcolor{keywordtype}{unsigned} recv\_doubles\_count = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03688}03688         MPI\_Recv(\&recv\_doubles\_count,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03689}03689                  1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03690}03690                  MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03691}03691                  d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03692}03692                  1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03693}03693                  \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03694}03694                  \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03695}03695 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03696}03696         \textcolor{comment}{// Get the data (if any)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03697}03697         \textcolor{keywordflow}{if} (recv\_unsigneds\_count != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03698}03698         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03699}03699           recv\_unsigneds[d].resize(recv\_unsigneds\_count);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03700}03700           MPI\_Recv(\&recv\_unsigneds[d][0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03701}03701                    recv\_unsigneds\_count,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03702}03702                    MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03703}03703                    d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03704}03704                    0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03705}03705                    \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03706}03706                    \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03707}03707         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03708}03708         \textcolor{keywordflow}{if} (recv\_doubles\_count != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03709}03709         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03710}03710           recv\_doubles[d].resize(recv\_doubles\_count);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03711}03711           MPI\_Recv(\&recv\_doubles[d][0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03712}03712                    recv\_doubles\_count,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03713}03713                    MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03714}03714                    d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03715}03715                    1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03716}03716                    \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03717}03717                    \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03718}03718         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03719}03719 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03720}03720         \textcolor{comment}{// Counters for received data}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03721}03721         \textcolor{keywordtype}{unsigned} recv\_unsigneds\_index = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03722}03722         \textcolor{keywordtype}{double} recv\_doubles\_index = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03723}03723 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03724}03724         \textcolor{comment}{// Get halo elements with processor d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03725}03725         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} \mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}(d));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03726}03726 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03727}03727         \textcolor{comment}{// Loop over recieved indices}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03728}03728         \textcolor{keywordflow}{while} (recv\_unsigneds\_index < recv\_unsigneds\_count)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03729}03729         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03730}03730           \textcolor{comment}{// Get (finite) element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03731}03731           \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* el\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03732}03732             \mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}[recv\_unsigneds[d][recv\_unsigneds\_index++]]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03733}03733 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03734}03734           \textcolor{comment}{// If we have a finite element...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03735}03735           \textcolor{keywordflow}{if} (el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03736}03736           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03737}03737             \textcolor{comment}{// Get dimension}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03738}03738             \textcolor{keywordtype}{unsigned} n\_dim = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a5f8fe59f06da1da9f6b7bbcbdb90ef93}{dim}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03739}03739 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03740}03740             \textcolor{comment}{// Get node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03741}03741             Node* nod\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03742}03742               el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(recv\_unsigneds[d][recv\_unsigneds\_index++]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03743}03743 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03744}03744             \textcolor{comment}{// Get current position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03745}03745             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} x\_cur(n\_dim);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03746}03746             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dir = 0; dir < n\_dim; dir++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03747}03747             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03748}03748               x\_cur[dir] = nod\_pt-\/>x(dir);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03749}03749             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03750}03750 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03751}03751             \textcolor{comment}{// Get recieved position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03752}03752             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} x\_rec(n\_dim);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03753}03753             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dir = 0; dir < n\_dim; dir++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03754}03754             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03755}03755               x\_rec[dir] = recv\_doubles[d][recv\_doubles\_index + dir];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03756}03756             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03757}03757 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03758}03758             \textcolor{comment}{// Compare actual and expected positions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03759}03759             \textcolor{keywordtype}{bool} node\_pos\_differs = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03760}03760             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dir = 0; dir < n\_dim; dir++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03761}03761             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03762}03762               node\_pos\_differs = node\_pos\_differs ||}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03763}03763                                  (std::fabs(x\_cur[dir] -\/ x\_rec[dir]) > 1.0e-\/14);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03764}03764             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03765}03765 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03766}03766             \textcolor{comment}{// Set the actual position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03767}03767             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} x\_act(n\_dim);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03768}03768             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dir = 0; dir < n\_dim; dir++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03769}03769             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03770}03770               nod\_pt-\/>x(dir) = recv\_doubles[d][recv\_doubles\_index++];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03771}03771             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03772}03772           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03773}03773         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03774}03774 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03775}03775         \textcolor{keywordflow}{if} (recv\_unsigneds\_count != recv\_unsigneds\_index)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03776}03776         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03777}03777           std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03778}03778           error\_stream << \textcolor{stringliteral}{"{}recv\_unsigneds\_count != recv\_unsigneds\_index ( "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03779}03779                        << recv\_unsigneds\_count << \textcolor{stringliteral}{"{} != "{}} << recv\_unsigneds\_index}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03780}03780                        << \textcolor{stringliteral}{"{})"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03781}03781           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03782}03782             error\_stream.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03783}03783             \textcolor{stringliteral}{"{}TreeBasedRefineableMeshBase::synchronise\_nonhanging\_nodes()"{}},}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03784}03784             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03785}03785         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03786}03786       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03787}03787       \textcolor{keywordflow}{else} \textcolor{comment}{// d==my\_rank, i.e. current process: Send halo hanging status}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03788}03788            \textcolor{comment}{// to process dd where it's received (see above) and compared}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03789}03789            \textcolor{comment}{// and compared against the hang status of the haloed nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03790}03790       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03791}03791         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} dd = 0; dd < n\_proc; dd++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03792}03792         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03793}03793           \textcolor{comment}{// No halo with yourself}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03794}03794           \textcolor{keywordflow}{if} (dd != d)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03795}03795           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03796}03796             \textcolor{comment}{// Storage for halo hanging status and counter}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03797}03797             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} send\_unsigneds;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03798}03798             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} send\_doubles;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03799}03799 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03800}03800             \textcolor{comment}{// Set to store nodes whose position requires adjustment}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03801}03801             std::set<Node*> nodes\_requiring\_adjustment;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03802}03802 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03803}03803             \textcolor{comment}{// Get haloed elements with processor dd}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03804}03804             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} \mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03805}03805               this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(dd));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03806}03806 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03807}03807             \textcolor{comment}{// Loop over haloed elements with processor dd}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03808}03808             \textcolor{keywordtype}{unsigned} nh = \mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03809}03809             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nh; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03810}03810             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03811}03811               \textcolor{comment}{// Get (finite) element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03812}03812               \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03813}03813                 \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03814}03814 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03815}03815               \textcolor{comment}{// If we have a finite element...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03816}03816               \textcolor{keywordflow}{if} (el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03817}03817               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03818}03818                 \textcolor{comment}{// Get dimension}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03819}03819                 \textcolor{keywordtype}{unsigned} n\_dim = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a5f8fe59f06da1da9f6b7bbcbdb90ef93}{dim}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03820}03820 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03821}03821                 \textcolor{comment}{// Loop over element nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03822}03822                 \textcolor{keywordtype}{unsigned} n\_node = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03823}03823                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_node; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03824}03824                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03825}03825                   \textcolor{comment}{// Get node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03826}03826                   Node* nod\_pt = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(j);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03827}03827 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03828}03828                   \textcolor{comment}{// Only do non-\/hanging nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03829}03829                   \textcolor{keywordflow}{if} (!nod\_pt-\/>is\_hanging())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03830}03830                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03831}03831                     \textcolor{comment}{// Check if node's position is the same as that interpolated}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03832}03832                     \textcolor{comment}{// using its local coordinate in the haloed element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03833}03833 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03834}03834                     \textcolor{comment}{// Loop over all history values}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03835}03835                     \textcolor{keywordtype}{unsigned} nt = nod\_pt-\/>ntstorage();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03836}03836                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < nt; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03837}03837                     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03838}03838                       \textcolor{comment}{// Get expected position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03839}03839                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(n\_dim), x\_exp(n\_dim);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03840}03840                       el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a22bc4ee35e4f948d8d7fba18c7b4f4c4}{local\_coordinate\_of\_node}}(j, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03841}03841                       el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6fc14cbf4e1d031acbc59b415cefa1ca}{get\_x}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, x\_exp);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03842}03842 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03843}03843                       \textcolor{comment}{// Get actual position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03844}03844                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} x\_act(n\_dim);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03845}03845                       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dir = 0; dir < n\_dim; dir++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03846}03846                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03847}03847                         x\_act[dir] = nod\_pt-\/>x(dir);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03848}03848                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03849}03849 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03850}03850                       \textcolor{comment}{// Compare actual and expected positions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03851}03851                       \textcolor{keywordtype}{bool} node\_pos\_differs = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03852}03852                       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dir = 0; dir < n\_dim; dir++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03853}03853                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03854}03854                         node\_pos\_differs =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03855}03855                           node\_pos\_differs ||}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03856}03856                           (std::fabs(x\_act[dir] -\/ x\_exp[dir]) > 1.0e-\/14);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03857}03857                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03858}03858 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03859}03859                       \textcolor{comment}{// If the node's actual position differs from its}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03860}03860                       \textcolor{comment}{// expected position we need to communicate this}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03861}03861                       \textcolor{comment}{// information to processors on which this is a halo node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03862}03862                       \textcolor{keywordflow}{if} (node\_pos\_differs)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03863}03863                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03864}03864                         \textcolor{comment}{// Check that node has not been done already}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03865}03865                         \textcolor{keywordflow}{if} (nodes\_requiring\_adjustment.insert(nod\_pt).second)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03866}03866                         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03867}03867                           \textcolor{comment}{// Send index of haloed element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03868}03868                           send\_unsigneds.push\_back(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03869}03869                           \textcolor{comment}{// Send index of node in the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03870}03870                           send\_unsigneds.push\_back(j);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03871}03871                           \textcolor{comment}{// Send actual position of node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03872}03872                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dir = 0; dir < n\_dim; dir++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03873}03873                           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03874}03874                             send\_doubles.push\_back(x\_act[dir]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03875}03875                           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03876}03876                         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03877}03877                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03878}03878                     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03879}03879                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03880}03880                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03881}03881               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03882}03882             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03883}03883 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03884}03884             \textcolor{comment}{// Send the information to the relevant process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03885}03885             \textcolor{keywordtype}{unsigned} send\_unsigneds\_count = send\_unsigneds.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03886}03886             \textcolor{keywordtype}{unsigned} send\_doubles\_count = send\_doubles.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03887}03887 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03888}03888             \textcolor{keywordflow}{if} (send\_unsigneds\_count > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03889}03889             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03890}03890               \textcolor{comment}{// exit(1);}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03891}03891             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03892}03892 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03893}03893             \textcolor{comment}{// Tell processor dd how much data to receive}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03894}03894             MPI\_Send(\&send\_unsigneds\_count,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03895}03895                      1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03896}03896                      MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03897}03897                      dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03898}03898                      0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03899}03899                      \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03900}03900             MPI\_Send(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03901}03901               \&send\_doubles\_count, 1, MPI\_UNSIGNED, dd, 1, \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03902}03902 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03903}03903             \textcolor{comment}{// Send data (if any)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03904}03904             \textcolor{keywordflow}{if} (send\_unsigneds\_count != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03905}03905             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03906}03906               MPI\_Send(\&send\_unsigneds[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03907}03907                        send\_unsigneds\_count,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03908}03908                        MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03909}03909                        dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03910}03910                        0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03911}03911                        \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03912}03912             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03913}03913             \textcolor{keywordflow}{if} (send\_doubles\_count != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03914}03914             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03915}03915               MPI\_Send(\&send\_doubles[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03916}03916                        send\_doubles\_count,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03917}03917                        MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03918}03918                        dd,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03919}03919                        1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03920}03920                        \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03921}03921             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03922}03922           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03923}03923         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03924}03924       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03925}03925     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03926}03926 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03927}03927     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03928}03928     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03929}03929       t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03930}03930       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for synchronise\_nonhanging\_nodes(): "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03931}03931                  << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03932}03932       t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03933}03933     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03934}03934   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03935}03935 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03936}03936 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03937}03937 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03938}03938 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03939}03939 \textcolor{comment}{  /// /////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03940}03940 \textcolor{comment}{  /// /////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03941}03941 \textcolor{comment}{  /// /////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03942}03942 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03943}03943 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03944}03944   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03945}03945 \textcolor{comment}{  /// Do adaptive p-\/refinement for mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03946}03946 \textcolor{comment}{  /// -\/ Pass Vector of error estimates for all elements.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03947}03947 \textcolor{comment}{  /// -\/ p-\/refine those whose errors exceeds the threshold}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03948}03948 \textcolor{comment}{  /// -\/ p-\/unrefine those whose errors is less than}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03949}03949 \textcolor{comment}{  ///   threshold.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03950}03950 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03951}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_acec4254dc1b7c75870cfa0bd0c4e363e}{03951}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_acec4254dc1b7c75870cfa0bd0c4e363e}{TreeBasedRefineableMeshBase::p\_adapt}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03952}03952     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& elemental\_error)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03953}03953   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03954}03954     \textcolor{comment}{// Set the refinement tolerance to be the max permissible error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03955}03955     \textcolor{keywordtype}{double} refine\_tol = this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_aebcb375a38f7491b52c1f5c757d51fd3}{max\_permitted\_error}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03956}03956 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03957}03957     \textcolor{comment}{// Set the unrefinement tolerance to be the min permissible error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03958}03958     \textcolor{keywordtype}{double} unrefine\_tol = this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1bb8bffa773bed50db992c9732c7665c}{min\_permitted\_error}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03959}03959 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03960}03960     \textcolor{comment}{// Setup doc info}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03961}03961     \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}} local\_doc\_info;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03962}03962     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a2615c121a310c1c0977637bf9cb34a7d}{doc\_info\_pt}}() == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03963}03963     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03964}03964       local\_doc\_info.\mbox{\hyperlink{classoomph_1_1DocInfo_a666a20817ab9c396b225d8652bc0a338}{disable\_doc}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03965}03965     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03966}03966     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03967}03967     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03968}03968       local\_doc\_info = this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03969}03969     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03970}03970 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03971}03971 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03972}03972     \textcolor{comment}{// Check that the errors make sense}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03973}03973     \textcolor{keywordflow}{if} (refine\_tol <= unrefine\_tol)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03974}03974     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03975}03975       std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03976}03976       error\_stream << \textcolor{stringliteral}{"{}Refinement tolerance <= Unrefinement tolerance"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03977}03977                    << refine\_tol << \textcolor{stringliteral}{"{} "{}} << unrefine\_tol << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03978}03978                    << \textcolor{stringliteral}{"{}doesn't make sense and will almost certainly crash"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03979}03979                    << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03980}03980                    << \textcolor{stringliteral}{"{}this beautiful code!"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03981}03981 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03982}03982       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03983}03983         error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03984}03984     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03985}03985 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03986}03986 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03987}03987     \textcolor{comment}{// Select elements for refinement and unrefinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03988}03988     \textcolor{comment}{//==============================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03989}03989     \textcolor{comment}{// Reset counter for number of elements that would like to be}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03990}03990     \textcolor{comment}{// refined further but can't}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03991}03991     this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a54749f251f0ac4b33fa3e95d2c19ec38}{nrefinement\_overruled}}() = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03992}03992 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03993}03993     \textcolor{keywordtype}{unsigned} n\_refine = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03994}03994     \textcolor{keywordtype}{unsigned} n\_unrefine = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03995}03995     \textcolor{comment}{// Loop over all elements and mark them according to the error criterion}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03996}03996     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Nelement = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03997}03997     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Nelement; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03998}03998     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l03999}03999       \textcolor{comment}{//(Cast) pointer to the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04000}04000       \mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}* el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04001}04001         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04002}04002 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04003}04003       \textcolor{comment}{// Check that we can p-\/refine the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04004}04004       \textcolor{keywordflow}{if} (el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04005}04005       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04006}04006         \textcolor{comment}{// Initially element is not to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04007}04007         el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_ae09fd11dea8f804c352a447a6bbdfb9a}{deselect\_for\_p\_refinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04008}04008         el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a9885c7f63cc66df42692505f2261dc88}{deselect\_for\_p\_unrefinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04009}04009 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04010}04010         \textcolor{comment}{// If the element error exceeds the threshold ...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04011}04011         \textcolor{keywordflow}{if} (elemental\_error[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] > refine\_tol)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04012}04012         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04013}04013           \textcolor{comment}{// ... and its refinement level is less than the maximum desired level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04014}04014           \textcolor{comment}{// mark is to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04015}04015           \textcolor{keywordflow}{if} ((el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a086636c6717bb5bbe7e31123bc0cd511}{p\_refinement\_is\_enabled}}()) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04016}04016               (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a83b9554e28ce574cc7759e88388575b0}{p\_order}}() < this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a192404f29acbc21ebd8626f277538671}{max\_p\_refinement\_level}}()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04017}04017           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04018}04018             el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a89ecf3e300ea9c7dd37ce981053377f4}{select\_for\_p\_refinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04019}04019             n\_refine++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04020}04020           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04021}04021           \textcolor{comment}{// ... otherwise mark it as having been over-\/ruled}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04022}04022           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04023}04023           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04024}04024             this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a54749f251f0ac4b33fa3e95d2c19ec38}{nrefinement\_overruled}}() += 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04025}04025           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04026}04026         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04027}04027         \textcolor{keywordflow}{if} (elemental\_error[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] < unrefine\_tol)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04028}04028         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04029}04029           \textcolor{comment}{// ... and its refinement level is more than the minimum desired level}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04030}04030           \textcolor{comment}{// mark is to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04031}04031           \textcolor{comment}{//(Also check that we don't unrefine past the initial refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04032}04032           \textcolor{comment}{// level)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04033}04033           \textcolor{keywordflow}{if} ((el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a086636c6717bb5bbe7e31123bc0cd511}{p\_refinement\_is\_enabled}}()) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04034}04034               (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a83b9554e28ce574cc7759e88388575b0}{p\_order}}() > this-\/>min\_p\_refinement\_level()) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04035}04035               (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a83b9554e28ce574cc7759e88388575b0}{p\_order}}() > el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a6babd48e981414ad54cbfc1d89977f43}{initial\_p\_order}}()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04036}04036           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04037}04037             el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a99c9cb3bc0a1d6877f58e741f9b36df4}{select\_for\_p\_unrefinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04038}04038             n\_unrefine++;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04039}04039           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04040}04040           \textcolor{comment}{// Don't mark as overruled -\/ it's misleading}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04041}04041 \textcolor{comment}{          /// / ... otherwise mark it as having been over-\/ruled}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04042}04042 \textcolor{comment}{}          \textcolor{comment}{// else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04043}04043           \textcolor{comment}{// \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04044}04044           \textcolor{comment}{//  this-\/>nrefinement\_overruled()+=1;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04045}04045           \textcolor{comment}{// \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04046}04046         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04047}04047       \} \textcolor{comment}{// End of check for p-\/refineability of element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04048}04048       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04049}04049       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04050}04050         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}p-\/refinement is not possible for these elements"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04051}04051                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04052}04052         \textcolor{comment}{// Don't try to p-\/refine any more elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04053}04053         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04054}04054       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04055}04055     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04056}04056 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04057}04057     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} \(\backslash\)n Number of elements to be refined: "{}} << n\_refine}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04058}04058                << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04059}04059     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} \(\backslash\)n Number of elements whose refinement was overruled: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04060}04060                << this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a54749f251f0ac4b33fa3e95d2c19ec38}{nrefinement\_overruled}}() << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04061}04061 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04062}04062     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{} \(\backslash\)n Number of elements to be unrefined : "{}} << n\_unrefine}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04063}04063                << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04064}04064                << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04065}04065 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04066}04066 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04067}04067     \textcolor{comment}{// Now do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04068}04068     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04069}04069 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04070}04070     \textcolor{comment}{// Check whether its worth our while}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04071}04071     \textcolor{comment}{// Either some elements want to be refined,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04072}04072     \textcolor{comment}{// or the number that want to be unrefined are greater than the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04073}04073     \textcolor{comment}{// specified tolerance}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04074}04074 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04075}04075     \textcolor{comment}{// In a parallel job, it is possible that one process may not have}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04076}04076     \textcolor{comment}{// any elements to refine, BUT a neighbouring process may refine an}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04077}04077     \textcolor{comment}{// element which changes the hanging status of a node that is on}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04078}04078     \textcolor{comment}{// both processes (i.e. a halo(ed) node).  To get around this issue,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04079}04079     \textcolor{comment}{// ALL processes need to call adapt\_mesh if ANY refinement is to}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04080}04080     \textcolor{comment}{// take place anywhere.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04081}04081 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04082}04082     \textcolor{keywordtype}{unsigned} total\_n\_refine = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04083}04083 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04084}04084     \textcolor{comment}{// Sum n\_refine across all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04085}04085     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04086}04086     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04087}04087       MPI\_Allreduce(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04088}04088         \&n\_refine, \&total\_n\_refine, 1, MPI\_INT, MPI\_SUM, \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04089}04089     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04090}04090     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04091}04091     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04092}04092       total\_n\_refine = n\_refine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04093}04093     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04094}04094 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04095}04095     total\_n\_refine = n\_refine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04096}04096 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04097}04097 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04098}04098     \textcolor{comment}{// There may be some issues with unrefinement too, but I have not}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04099}04099     \textcolor{comment}{// been able to come up with an example (either in my head or in a}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04100}04100     \textcolor{comment}{// particular problem) where anything has arisen.  I can see that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04101}04101     \textcolor{comment}{// there may be an issue if n\_unrefine differs across processes so}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04102}04102     \textcolor{comment}{// that (total\_n\_unrefine > max\_keep\_unrefined()) on some but not}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04103}04103     \textcolor{comment}{// all processes. I haven't seen any examples of this yet so the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04104}04104     \textcolor{comment}{// following code may or may not work!  (Andy, 06/03/08)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04105}04105 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04106}04106     \textcolor{keywordtype}{unsigned} total\_n\_unrefine = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04107}04107 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04108}04108     \textcolor{comment}{// Sum n\_unrefine across all processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04109}04109     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04110}04110     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04111}04111       MPI\_Allreduce(\&n\_unrefine,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04112}04112                     \&total\_n\_unrefine,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04113}04113                     1,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04114}04114                     MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04115}04115                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04116}04116                     \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04117}04117     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04118}04118     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04119}04119     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04120}04120       total\_n\_unrefine = n\_unrefine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04121}04121     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04122}04122 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04123}04123     total\_n\_unrefine = n\_unrefine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04124}04124 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04125}04125 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04126}04126     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}-\/-\/-\/> "{}} << total\_n\_refine << \textcolor{stringliteral}{"{} elements to be refined, and "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04127}04127                << total\_n\_unrefine << \textcolor{stringliteral}{"{} to be unrefined, in total."{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04128}04128                << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04129}04129 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04130}04130     \textcolor{keywordflow}{if} ((total\_n\_refine > 0) || (total\_n\_unrefine > this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a09009ca14843d8bf7109e90dbcd38635}{max\_keep\_unrefined}}()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04131}04131     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04132}04132 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04133}04133 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04134}04134 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04135}04135       \textcolor{comment}{// Sanity check: Each processor checks if the enforced unrefinement of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04136}04136       \textcolor{comment}{// its haloed element is matched by enforced unrefinement of the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04137}04137       \textcolor{comment}{// corresponding halo elements on the other processors.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04138}04138       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04139}04139       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04140}04140         \textcolor{comment}{// Store number of processors and current process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04141}04141         MPI\_Status status;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04142}04142         \textcolor{keywordtype}{int} n\_proc = \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>nproc();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04143}04143         \textcolor{keywordtype}{int} my\_rank = \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04144}04144 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04145}04145         \textcolor{comment}{// Loop over all other domains/processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04146}04146         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04147}04147         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04148}04148           \textcolor{comment}{// Don't talk to yourself}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04149}04149           \textcolor{keywordflow}{if} (d != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04150}04150           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04151}04151             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04152}04152               \textcolor{comment}{// Get the vector of halo elements whose non-\/halo counterpart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04153}04153               \textcolor{comment}{// are on processor d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04154}04154               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} halo\_elem\_pt(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04155}04155                 this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}(d));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04156}04156 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04157}04157               \textcolor{comment}{// Create vector containing (0)1 to indicate that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04158}04158               \textcolor{comment}{// halo element is (not) to be unrefined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04159}04159               \textcolor{keywordtype}{unsigned} nhalo = halo\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04160}04160               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} halo\_to\_be\_unrefined(nhalo, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04161}04161               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nhalo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04162}04162               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04163}04163                 \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(halo\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04164}04164                       -\/>to\_be\_p\_unrefined())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04165}04165                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04166}04166                   halo\_to\_be\_unrefined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04167}04167                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04168}04168               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04169}04169 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04170}04170               \textcolor{comment}{// Trap the case when there are no halo elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04171}04171               \textcolor{comment}{// so that we don't get a segfault in the MPI send}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04172}04172               \textcolor{keywordflow}{if} (nhalo > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04173}04173               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04174}04174                 \textcolor{comment}{// Send it across}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04175}04175                 MPI\_Send(\&halo\_to\_be\_unrefined[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04176}04176                          nhalo,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04177}04177                          MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04178}04178                          d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04179}04179                          0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04180}04180                          \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04181}04181               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04182}04182             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04183}04183 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04184}04184             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04185}04185               \textcolor{comment}{// Get the vector of haloed elements on current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04186}04186               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} haloed\_elem\_pt(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04187}04187                 this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(d));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04188}04188 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04189}04189               \textcolor{comment}{// Ask processor d to send vector containing (0)1 for}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04190}04190               \textcolor{comment}{// halo element with current processor to be (not)unrefined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04191}04191               \textcolor{keywordtype}{unsigned} nhaloed = haloed\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04192}04192               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} halo\_to\_be\_unrefined(nhaloed);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04193}04193               \textcolor{comment}{// Trap to catch the case that there are no haloed elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04194}04194               \textcolor{keywordflow}{if} (nhaloed > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04195}04195               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04196}04196                 MPI\_Recv(\&halo\_to\_be\_unrefined[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04197}04197                          nhaloed,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04198}04198                          MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04199}04199                          d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04200}04200                          0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04201}04201                          \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04202}04202                          \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04203}04203               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04204}04204 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04205}04205               \textcolor{comment}{// Check it}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04206}04206               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nhaloed; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04207}04207               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04208}04208                 \textcolor{keywordflow}{if} (((halo\_to\_be\_unrefined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == 0) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04209}04209                      (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04210}04210                         -\/>to\_be\_p\_unrefined())) ||}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04211}04211                     ((halo\_to\_be\_unrefined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == 1) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04212}04212                      (!\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04213}04213                          -\/>to\_be\_p\_unrefined())))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04214}04214                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04215}04215                   std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04216}04216                   error\_message}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04217}04217                     << \textcolor{stringliteral}{"{}Error in refinement: \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04218}04218                     << \textcolor{stringliteral}{"{}Haloed element: "{}} << \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} << \textcolor{stringliteral}{"{} on proc "{}} << my\_rank}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04219}04219                     << \textcolor{stringliteral}{"{} \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04220}04220                     << \textcolor{stringliteral}{"{}wants to be unrefined whereas its halo counterpart on\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04221}04221                     << \textcolor{stringliteral}{"{}proc "{}} << d << \textcolor{stringliteral}{"{} doesn't (or vice versa)...\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04222}04222                     << \textcolor{stringliteral}{"{}This is most likely because the error estimator\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04223}04223                     << \textcolor{stringliteral}{"{}has not assigned the same errors to halo and haloed\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04224}04224                     << \textcolor{stringliteral}{"{}elements -\/-\/ it ought to!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04225}04225                   \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04226}04226                                       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04227}04227                                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04228}04228                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04229}04229               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04230}04230             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04231}04231           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04232}04232         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04233}04233 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04234}04234 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04235}04235         \textcolor{comment}{// Loop over all other domains/processors}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04236}04236         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04237}04237         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04238}04238           \textcolor{comment}{// Don't talk to yourself}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04239}04239           \textcolor{keywordflow}{if} (d != my\_rank)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04240}04240           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04241}04241             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04242}04242               \textcolor{comment}{// Get the vector of halo elements whose non-\/halo counterpart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04243}04243               \textcolor{comment}{// are on processor d}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04244}04244               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} halo\_elem\_pt(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04245}04245                 this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a882f5825ab0369b49d1d694f8e87d951}{halo\_element\_pt}}(d));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04246}04246 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04247}04247               \textcolor{comment}{// Create vector containing (0)1 to indicate that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04248}04248               \textcolor{comment}{// halo element is (not) to be refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04249}04249               \textcolor{keywordtype}{unsigned} nhalo = halo\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04250}04250               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} halo\_to\_be\_refined(nhalo, 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04251}04251               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nhalo; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04252}04252               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04253}04253                 \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(halo\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04254}04254                       -\/>to\_be\_p\_refined())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04255}04255                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04256}04256                   halo\_to\_be\_refined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] = 1;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04257}04257                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04258}04258               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04259}04259 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04260}04260               \textcolor{comment}{// Send it across}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04261}04261               \textcolor{keywordflow}{if} (nhalo > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04262}04262               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04263}04263                 MPI\_Send(\&halo\_to\_be\_refined[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04264}04264                          nhalo,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04265}04265                          MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04266}04266                          d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04267}04267                          0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04268}04268                          \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04269}04269               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04270}04270             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04271}04271 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04272}04272             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04273}04273               \textcolor{comment}{// Get the vector of haloed elements on current processor}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04274}04274               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeneralisedElement*>}} haloed\_elem\_pt(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04275}04275                 this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ae1376f1c2e3e2dbd66b9334992f02ae0}{haloed\_element\_pt}}(d));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04276}04276 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04277}04277               \textcolor{comment}{// Ask processor d to send vector containing (0)1 for}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04278}04278               \textcolor{comment}{// halo element with current processor to be (not)refined}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04279}04279               \textcolor{keywordtype}{unsigned} nhaloed = haloed\_elem\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04280}04280               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} halo\_to\_be\_refined(nhaloed);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04281}04281               \textcolor{keywordflow}{if} (nhaloed > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04282}04282               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04283}04283                 MPI\_Recv(\&halo\_to\_be\_refined[0],}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04284}04284                          nhaloed,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04285}04285                          MPI\_INT,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04286}04286                          d,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04287}04287                          0,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04288}04288                          \mbox{\hyperlink{classoomph_1_1Mesh_a775158642d3320e0d709bcccd790875f}{Comm\_pt}}-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04289}04289                          \&status);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04290}04290               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04291}04291 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04292}04292               \textcolor{comment}{// Check it}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04293}04293               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nhaloed; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04294}04294               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04295}04295                 \textcolor{keywordflow}{if} (((halo\_to\_be\_refined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == 0) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04296}04296                      (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04297}04297                         -\/>to\_be\_p\_refined())) ||}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04298}04298                     ((halo\_to\_be\_refined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}] == 1) \&\&}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04299}04299                      (!\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(haloed\_elem\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}])}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04300}04300                          -\/>to\_be\_p\_refined())))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04301}04301                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04302}04302                   std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04303}04303                   error\_message}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04304}04304                     << \textcolor{stringliteral}{"{}Error in refinement: \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04305}04305                     << \textcolor{stringliteral}{"{}Haloed element: "{}} << \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} << \textcolor{stringliteral}{"{} on proc "{}} << my\_rank}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04306}04306                     << \textcolor{stringliteral}{"{} \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04307}04307                     << \textcolor{stringliteral}{"{}wants to be refined whereas its halo counterpart on\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04308}04308                     << \textcolor{stringliteral}{"{}proc "{}} << d << \textcolor{stringliteral}{"{} doesn't (or vice versa)...\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04309}04309                     << \textcolor{stringliteral}{"{}This is most likely because the error estimator\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04310}04310                     << \textcolor{stringliteral}{"{}has not assigned the same errors to halo and haloed\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04311}04311                     << \textcolor{stringliteral}{"{}elements -\/-\/ it ought to!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04312}04312                   \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04313}04313                                       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04314}04314                                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04315}04315                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04316}04316               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04317}04317             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04318}04318           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04319}04319         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04320}04320       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04321}04321 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04322}04322 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04323}04323 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04324}04324       \textcolor{comment}{// Perform the actual adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04325}04325       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae36ab5e807acc10ccc31a7886ffc040a}{p\_adapt\_mesh}}(local\_doc\_info);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04326}04326 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04327}04327       \textcolor{comment}{// The number of refineable elements is still local to each process}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04328}04328       this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a62c0314a69b2e40355a2aa27ff5ea133}{Nunrefined}} = n\_unrefine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04329}04329       this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1a35c13c3c37ddc5ac2852217d903459}{Nrefined}} = n\_refine;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04330}04330     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04331}04331     \textcolor{comment}{// If not worthwhile, say so but still reorder nodes and kill external}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04332}04332     \textcolor{comment}{// storage for consistency in parallel computations}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04333}04333     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04334}04334     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04335}04335 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04336}04336       \textcolor{comment}{// Delete any external element storage -\/ any interaction will still}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04337}04337       \textcolor{comment}{// be set up on the fly again, so we need to get rid of old information.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04338}04338       \textcolor{comment}{// This particularly causes problems in multi-\/domain examples where}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04339}04339       \textcolor{comment}{// we decide not to refine one of the meshes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04340}04340       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9e3ecb07dc622cf37ce0085446ff9aa6}{delete\_all\_external\_storage}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04341}04341 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04342}04342 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04343}04343       \textcolor{comment}{// Reorder the nodes within the mesh's node vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04344}04344       \textcolor{comment}{// to establish a standard ordering regardless of the sequence}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04345}04345       \textcolor{comment}{// of mesh refinements -\/-\/ this is required to allow dump/restart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04346}04346       \textcolor{comment}{// on refined meshes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04347}04347       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a801e77424d1bf8a35c9bba055230f1e3}{reorder\_nodes}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04348}04348 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04349}04349 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04350}04350 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04351}04351       \textcolor{comment}{// Now (re-\/)classify halo and haloed nodes and synchronise hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04352}04352       \textcolor{comment}{// nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04353}04353       \textcolor{comment}{// This is required in cases where delete\_all\_external\_storage()}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04354}04354       \textcolor{comment}{// made dependent nodes to external halo nodes nonhanging.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04355}04355       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04356}04356       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04357}04357         \mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}} \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04358}04358         \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a666a20817ab9c396b225d8652bc0a338}{disable\_doc}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04359}04359         \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aec7c6fc41272ec883c589ee56d1b01e6}{classify\_halo\_and\_haloed\_nodes}}(\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}, \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04360}04360       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04361}04361 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04362}04362 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04363}04363 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04364}04364       \textcolor{keywordflow}{if} (n\_refine == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04365}04365       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04366}04366         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n Not enough benefit in adapting mesh. "{}} << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04367}04367                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04368}04368       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04369}04369       this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a62c0314a69b2e40355a2aa27ff5ea133}{Nunrefined}} = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04370}04370       this-\/>\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a1a35c13c3c37ddc5ac2852217d903459}{Nrefined}} = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04371}04371     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04372}04372   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04373}04373 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04374}04374 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04375}04375   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04376}04376 \textcolor{comment}{  /// p-\/adapt mesh, which exists in two representations,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04377}04377 \textcolor{comment}{  /// namely as:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04378}04378 \textcolor{comment}{  ///  -\/ a FE mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04379}04379 \textcolor{comment}{  ///  -\/ a forest of Oc or QuadTrees}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04380}04380 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04381}04381 \textcolor{comment}{  /// p-\/refinement/derefinement process is documented (in tecplot-\/able form)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04382}04382 \textcolor{comment}{  /// if requested.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04383}04383 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04384}04384 \textcolor{comment}{  /// Procedure:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04385}04385 \textcolor{comment}{  /// -\/ Loop over all elements and do the p-\/refinement/unrefinement for}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04386}04386 \textcolor{comment}{  ///   those who want to be refined. Note: p-\/refinement builds fully-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04387}04387 \textcolor{comment}{  ///   functional elements.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04388}04388 \textcolor{comment}{  /// -\/ For all nodes that were hanging on the previous mesh (and are still}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04389}04389 \textcolor{comment}{  ///   marked as such), fill in their nodal values (consistent}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04390}04390 \textcolor{comment}{  ///   with the current hanging node scheme) to make sure they are fully}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04391}04391 \textcolor{comment}{  ///   functional, should they have become non-\/hanging during the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04392}04392 \textcolor{comment}{  ///   mesh-\/adaptation. Then mark the nodes as non-\/hanging.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04393}04393 \textcolor{comment}{  /// -\/ Delete any nodes that have become obsolete.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04394}04394 \textcolor{comment}{  /// -\/ Mark up hanging nodes and setup hanging node scheme (incl.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04395}04395 \textcolor{comment}{  ///   recursive cleanup for hanging nodes that depend on other}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04396}04396 \textcolor{comment}{  ///   hanging nodes).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04397}04397 \textcolor{comment}{  /// -\/ run a quick self-\/test on the neighbour finding scheme and}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04398}04398 \textcolor{comment}{  ///   check the integrity of the elements (if PARANOID)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04399}04399 \textcolor{comment}{  /// -\/ doc hanging node status, boundary conditions, neighbour}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04400}04400 \textcolor{comment}{  ///   scheme if requested.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04401}04401 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04402}04402 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04403}04403 \textcolor{comment}{  /// After adaptation, all nodes (whether new or old) have up-\/to-\/date}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04404}04404 \textcolor{comment}{  /// current and previous values.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04405}04405 \textcolor{comment}{  ///}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04406}04406 \textcolor{comment}{  /// If refinement process is being documented, the following information}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04407}04407 \textcolor{comment}{  /// is documented:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04408}04408 \textcolor{comment}{  /// -\/ The files}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04409}04409 \textcolor{comment}{  ///   -\/ "{}neighbours.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04410}04410 \textcolor{comment}{  ///   -\/ "{}all\_nodes.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04411}04411 \textcolor{comment}{  ///   -\/ "{}new\_nodes.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04412}04412 \textcolor{comment}{  ///   -\/ "{}hang\_nodes\_*.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04413}04413 \textcolor{comment}{  ///     where the * denotes a direction (n,s,e,w) in 2D}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04414}04414 \textcolor{comment}{  ///     or (r,l,u,d,f,b) in 3D}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04415}04415 \textcolor{comment}{  /// .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04416}04416 \textcolor{comment}{  ///   can be viewed with}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04417}04417 \textcolor{comment}{  ///   -\/ QHangingNodes.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04418}04418 \textcolor{comment}{  ///   .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04419}04419 \textcolor{comment}{  /// -\/ The file}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04420}04420 \textcolor{comment}{  ///    -\/ "{}hangnodes\_withmasters.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04421}04421 \textcolor{comment}{  ///    .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04422}04422 \textcolor{comment}{  ///    can be viewed with}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04423}04423 \textcolor{comment}{  ///    -\/ QHangingNodesWithMasters.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04424}04424 \textcolor{comment}{  ///    .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04425}04425 \textcolor{comment}{  ///    to check the hanging node status.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04426}04426 \textcolor{comment}{  /// -\/ The neighbour status of the elements is documented in}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04427}04427 \textcolor{comment}{  ///   -\/ "{}neighbours.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04428}04428 \textcolor{comment}{  ///   .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04429}04429 \textcolor{comment}{  ///   and can be viewed with}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04430}04430 \textcolor{comment}{  ///   -\/ QuadTreeNeighbours.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04431}04431 \textcolor{comment}{  ///   .}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04432}04432 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04433}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a5d714967dc71ba477c2ca807bbf6d6bd}{04433}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae36ab5e807acc10ccc31a7886ffc040a}{TreeBasedRefineableMeshBase::p\_adapt\_mesh}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04434}04434   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04435}04435 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04436}04436     \textcolor{comment}{// Delete any external element storage before performing the adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04437}04437     \textcolor{comment}{// (in particular, external halo nodes that are on mesh boundaries)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04438}04438     this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9e3ecb07dc622cf37ce0085446ff9aa6}{delete\_all\_external\_storage}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04439}04439 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04440}04440 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04441}04441     \textcolor{comment}{// Only perform the adapt step if the mesh has any elements.  This is}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04442}04442     \textcolor{comment}{// relevant in a distributed problem with multiple meshes, where a}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04443}04443     \textcolor{comment}{// particular process may not have any elements on a particular submesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04444}04444     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}() > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04445}04445     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04446}04446       \textcolor{keywordtype}{double} t\_start = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04447}04447       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04448}04448       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04449}04449         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04450}04450       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04451}04451 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04452}04452       \textcolor{comment}{// Do refinement/unrefinement if required}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04453}04453       this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a9a2f26f447d6386505bdbdd0ac518321}{p\_refine\_elements\_if\_required}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04454}04454 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04455}04455       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04456}04456       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04457}04457         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04458}04458         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for p-\/refinement/unrefinement: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04459}04459                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04460}04460         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04461}04461       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04462}04462 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04463}04463       \textcolor{comment}{// Loop over all nodes in mesh and free the dofs of those that were}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04464}04464       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04465}04465       \textcolor{comment}{// pinned only because they were hanging nodes. Also update their}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04466}04466       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04467}04467       \textcolor{comment}{// nodal values so that they contain data that is consistent}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04468}04468       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04469}04469       \textcolor{comment}{// with the hanging node representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04470}04470       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04471}04471       \textcolor{comment}{// (Even if the nodal data isn't actually accessed because the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04472}04472       \textcolor{comment}{// is still hanging -\/-\/ we don't know this yet, and this step makes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04473}04473       \textcolor{comment}{// sure that all nodes are fully functional and up-\/to-\/date, should}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04474}04474       \textcolor{comment}{// they become non-\/hanging below).}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04475}04475       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04476}04476       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04477}04477       \textcolor{comment}{// However, if we have a fixed mesh and hanging nodes on the boundary}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04478}04478       \textcolor{comment}{// become non-\/hanging they will not necessarily respect the curvilinear}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04479}04479       \textcolor{comment}{// boundaries. This can only happen in 3D of course because it is not}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04480}04480       \textcolor{comment}{// possible to have hanging nodes on boundaries in 2D.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04481}04481       \textcolor{comment}{// The solution is to store those nodes on the boundaries that are}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04482}04482       \textcolor{comment}{// currently hanging and then check to see whether they have changed}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04483}04483       \textcolor{comment}{// status at the end of the refinement procedure.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04484}04484       \textcolor{comment}{// If it has changed, then we need to adjust their positions.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04485}04485       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_boundary = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a84543564d6babe4faacbb9d87043fc19}{nboundary}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04486}04486       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} mesh\_dim = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a479059b0964826a8cee6eb506b57268a}{finite\_element\_pt}}(0)-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a5f8fe59f06da1da9f6b7bbcbdb90ef93}{dim}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04487}04487       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::set<Node*>}}> hanging\_nodes\_on\_boundary\_pt(n\_boundary);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04488}04488 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04489}04489       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_node = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04490}04490       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04491}04491       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04492}04492         \textcolor{comment}{// Get the pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04493}04493         Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04494}04494 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04495}04495         \textcolor{comment}{// Get the number of values in the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04496}04496         \textcolor{keywordtype}{unsigned} n\_value = nod\_pt-\/>nvalue();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04497}04497 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04498}04498         \textcolor{comment}{// We need to find if any of the values are hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04499}04499         \textcolor{keywordtype}{bool} is\_hanging = nod\_pt-\/>is\_hanging();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04500}04500         \textcolor{comment}{// Loop over the values and find out whether any are hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04501}04501         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_value; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04502}04502         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04503}04503           is\_hanging |= nod\_pt-\/>is\_hanging(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04504}04504         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04505}04505 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04506}04506         \textcolor{comment}{// If the node is hanging then ...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04507}04507         \textcolor{keywordflow}{if} (is\_hanging)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04508}04508         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04509}04509           \textcolor{comment}{// Unless they are turned into hanging nodes again below}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04510}04510           \textcolor{comment}{// (this might or might not happen), fill in all the necessary}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04511}04511           \textcolor{comment}{// data to make them 'proper' nodes again.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04512}04512 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04513}04513           \textcolor{comment}{// Reconstruct the nodal values/position from the node's}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04514}04514           \textcolor{comment}{// hanging node representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04515}04515           \textcolor{keywordtype}{unsigned} nt = nod\_pt-\/>ntstorage();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04516}04516           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} values(n\_value);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04517}04517           \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04518}04518           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} position(n\_dim);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04519}04519           \textcolor{comment}{// Loop over all history values}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04520}04520           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < nt; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04521}04521           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04522}04522             nod\_pt-\/>value(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, values);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04523}04523             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_value; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04524}04524             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04525}04525               nod\_pt-\/>set\_value(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, values[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04526}04526             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04527}04527             nod\_pt-\/>position(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, position);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04528}04528             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04529}04529             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04530}04530               nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = position[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04531}04531             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04532}04532           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04533}04533 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04534}04534           \textcolor{comment}{// If it's an algebraic node: Update its previous nodal positions too}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04535}04535           \mbox{\hyperlink{classoomph_1_1AlgebraicNode}{AlgebraicNode}}* alg\_node\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1AlgebraicNode}{AlgebraicNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04536}04536           \textcolor{keywordflow}{if} (alg\_node\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04537}04537           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04538}04538             \textcolor{keywordtype}{bool} update\_all\_time\_levels = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04539}04539             alg\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1AlgebraicNode_a754dc8fcac3382a07f60262c9792c84c}{node\_update}}(update\_all\_time\_levels);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04540}04540           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04541}04541 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04542}04542 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04543}04543           \textcolor{comment}{// If it's a Solid node, update Lagrangian coordinates}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04544}04544           \textcolor{comment}{// from its hanging node representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04545}04545           \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* solid\_node\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04546}04546           \textcolor{keywordflow}{if} (solid\_node\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04547}04547           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04548}04548             \textcolor{keywordtype}{unsigned} n\_lagrangian = solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_af98a0623f9e41a10f48112b9ff7b38a0}{nlagrangian}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04549}04549             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_lagrangian; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04550}04550             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04551}04551               solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_aa6780c66ed3f5db5cbb8fe2c0a476974}{xi}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_a790277999eb7d8ff0c3f2398d8aaedb0}{lagrangian\_position}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04552}04552             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04553}04553           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04554}04554 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04555}04555           \textcolor{comment}{// Now store geometrically hanging nodes on boundaries that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04556}04556           \textcolor{comment}{// may need updating after refinement.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04557}04557           \textcolor{comment}{// There will only be a problem if we have 3 spatial dimensions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04558}04558           \textcolor{keywordflow}{if} ((mesh\_dim > 2) \&\& (nod\_pt-\/>is\_hanging()))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04559}04559           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04560}04560             \textcolor{comment}{// If the node is on a boundary then add a pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04561}04561             \textcolor{comment}{// to our lookup scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04562}04562             \textcolor{keywordflow}{if} (nod\_pt-\/>is\_on\_boundary())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04563}04563             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04564}04564               \textcolor{comment}{// Storage for the boundaries on which the Node is located}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04565}04565               std::set<unsigned>* boundaries\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04566}04566               nod\_pt-\/>get\_boundaries\_pt(boundaries\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04567}04567               \textcolor{keywordflow}{if} (boundaries\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04568}04568               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04569}04569                 \textcolor{comment}{// Loop over the boundaries and add a pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04570}04570                 \textcolor{comment}{// to the appropriate storage scheme}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04571}04571                 \textcolor{keywordflow}{for} (std::set<unsigned>::iterator it = boundaries\_pt-\/>begin();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04572}04572                      it != boundaries\_pt-\/>end();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04573}04573                      ++it)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04574}04574                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04575}04575                   hanging\_nodes\_on\_boundary\_pt[*it].insert(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04576}04576                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04577}04577               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04578}04578             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04579}04579           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04580}04580 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04581}04581         \} \textcolor{comment}{// End of is\_hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04582}04582 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04583}04583         \textcolor{comment}{// Initially mark all nodes as 'non-\/hanging' and `obsolete'}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04584}04584         nod\_pt-\/>set\_nonhanging();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04585}04585         nod\_pt-\/>set\_obsolete();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04586}04586       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04587}04587 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04588}04588       \textcolor{keywordtype}{double} t\_end = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04589}04589       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04590}04590       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04591}04591         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04592}04592         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for sorting out initial hanging status: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04593}04593                    << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04594}04594         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04595}04595       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04596}04596 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04597}04597       \textcolor{comment}{// Stick all elements into a vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04598}04598       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} tree\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04599}04599       this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a6d99d1f513a60b9bd053ff98699cbe52}{stick\_leaves\_into\_vector}}(tree\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04600}04600 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04601}04601       \textcolor{comment}{// Copy the elements into the mesh Vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04602}04602       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} num\_tree\_nodes = tree\_nodes\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04603}04603       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}().resize(num\_tree\_nodes);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04604}04604       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04605}04605       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04606}04606         this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}) = tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04607}04607 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04608}04608         \textcolor{comment}{// Now loop over all nodes in element and mark them as non-\/obsolete}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04609}04609         \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* this\_el\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a479059b0964826a8cee6eb506b57268a}{finite\_element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04610}04610         \textcolor{keywordtype}{unsigned} n\_node = this\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}(); \textcolor{comment}{// caching pre-\/loop}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04611}04611         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04612}04612         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04613}04613           this\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n)-\/>set\_non\_obsolete();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04614}04614         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04615}04615 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04616}04616         \textcolor{comment}{// Mark up so that repeated refinements do not occur}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04617}04617         \textcolor{comment}{// (Required because refined element is the same element as the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04618}04618         \textcolor{comment}{// original)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04619}04619         \mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}* cast\_el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04620}04620           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04621}04621         cast\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_ae09fd11dea8f804c352a447a6bbdfb9a}{deselect\_for\_p\_refinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04622}04622         cast\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a9885c7f63cc66df42692505f2261dc88}{deselect\_for\_p\_unrefinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04623}04623       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04624}04624 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04625}04625       \textcolor{comment}{// Cannot delete nodes that are still marked as obsolete}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04626}04626       \textcolor{comment}{// because they may still be required to assemble the hanging schemes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04627}04627       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04628}04628 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04629}04629       \textcolor{comment}{// Mark up hanging nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04630}04630       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04631}04631 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04632}04632       \textcolor{comment}{// Output streams for the hanging nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04633}04633       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::ofstream*>}} hanging\_output\_files;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04634}04634       \textcolor{comment}{// Setup the output files for hanging nodes, this must be called}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04635}04635       \textcolor{comment}{// precisely once for the forest. Note that the files will only}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04636}04636       \textcolor{comment}{// actually be opened if doc\_info.Doc\_flag is true}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04637}04637       this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a635443274eaa2fb1afa889e4e748608f}{open\_hanging\_node\_files}}(doc\_info,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04638}04638                                                  hanging\_output\_files);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04639}04639 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04640}04640       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04641}04641       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04642}04642         \textcolor{comment}{// Generic setup}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04643}04643         tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()-\/>setup\_hanging\_nodes(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04644}04644           hanging\_output\_files);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04645}04645         \textcolor{comment}{// Element specific setup}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04646}04646         tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()-\/>further\_setup\_hanging\_nodes();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04647}04647       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04648}04648 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04649}04649       \textcolor{comment}{// Close the hanging node files and delete the memory allocated}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04650}04650       \textcolor{comment}{// for the streams}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04651}04651       this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_ace63bb552b21ba46eb5ae062826dab26}{close\_hanging\_node\_files}}(doc\_info,}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04652}04652                                                   hanging\_output\_files);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04653}04653 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04654}04654 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04655}04655       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04656}04656       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04657}04657         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04658}04658         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup\_hanging\_nodes() and "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04659}04659                       \textcolor{stringliteral}{"{}further\_setup\_hanging\_nodes() for "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04660}04660                    << num\_tree\_nodes << \textcolor{stringliteral}{"{} elements: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04661}04661                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04662}04662         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04663}04663       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04664}04664 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04665}04665       \textcolor{comment}{// Read out the number of continously interpolated values}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04666}04666       \textcolor{comment}{// from one of the elements (assuming it's the same in all elements)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04667}04667       \textcolor{keywordtype}{unsigned} ncont\_interpolated\_values =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04668}04668         tree\_nodes\_pt[0]-\/>object\_pt()-\/>ncont\_interpolated\_values();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04669}04669 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04670}04670       \textcolor{comment}{// Complete the hanging nodes schemes by dealing with the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04671}04671       \textcolor{comment}{// recursively hanging nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04672}04672       this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aab6f14b0933edc819231a88b1d555f62}{complete\_hanging\_nodes}}(ncont\_interpolated\_values);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04673}04673 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04674}04674 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04675}04675       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04676}04676       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04677}04677         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04678}04678         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for complete\_hanging\_nodes: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04679}04679                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04680}04680         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04681}04681       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04682}04682 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04683}04683 \textcolor{comment}{      /// Update the boundary element info -\/-\/ this can be a costly procedure}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04684}04684 \textcolor{comment}{      /// and for this reason the mesh writer might have decided not to set up}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04685}04685 \textcolor{comment}{      /// this scheme. If so, we won't change this and suppress its creation...}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04686}04686 \textcolor{comment}{}      \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1Mesh_a37f6d27447f643a74694012b09350ce9}{Lookup\_for\_elements\_next\_boundary\_is\_setup}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04687}04687       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04688}04688         this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a6cc8bcd6b41209f0e9295cc993d9c6bb}{setup\_boundary\_element\_info}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04689}04689       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04690}04690 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04691}04691       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04692}04692       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04693}04693         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04694}04694         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for boundary element info: "{}} << t\_end -\/ t\_start}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04695}04695                    << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04696}04696         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04697}04697       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04698}04698 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04699}04699       \textcolor{comment}{// BENFLAG: Reset all the node update elements.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04700}04700       \textcolor{comment}{//         This is necessary to prevent the following case: A node N is}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04701}04701       \textcolor{comment}{//         shared between two elements, A and B. The update element for}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04702}04702       \textcolor{comment}{//         the node is set to A, say. Element A is p-\/refined and now}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04703}04703       \textcolor{comment}{//         nolonger has N as a node. However the node update element for N}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04704}04704       \textcolor{comment}{//         is still A but the node doesn't exist in A.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04705}04705       \mbox{\hyperlink{classoomph_1_1MacroElementNodeUpdateElementBase}{MacroElementNodeUpdateElementBase}}* first\_macro\_el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04706}04706         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1MacroElementNodeUpdateElementBase}{MacroElementNodeUpdateElementBase}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(0));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04707}04707       \textcolor{keywordflow}{if} (first\_macro\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04708}04708       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04709}04709         \textcolor{comment}{// Now set the node update info elementwise}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04710}04710         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}(); \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04711}04711         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04712}04712           \textcolor{comment}{// Cast to macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04713}04713           \mbox{\hyperlink{classoomph_1_1MacroElementNodeUpdateElementBase}{MacroElementNodeUpdateElementBase}}* macro\_el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04714}04714             \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1MacroElementNodeUpdateElementBase}{MacroElementNodeUpdateElementBase}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04715}04715               this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04716}04716           \textcolor{keywordflow}{if} (macro\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04717}04717           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04718}04718             \textcolor{comment}{// Get vector of geometric objects from element (construct vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04719}04719             \textcolor{comment}{// via copy operation)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04720}04720             \mbox{\hyperlink{classoomph_1_1Vector}{Vector<GeomObject*>}} geom\_object\_pt(macro\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1MacroElementNodeUpdateElementBase_afcffd290cc0292a571e7a443bc23728b}{geom\_object\_pt}}());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04721}04721 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04722}04722             \textcolor{comment}{// (Re)set node update info for all the nodes in the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04723}04723             macro\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1MacroElementNodeUpdateElementBase_aa2408d8463e8cecc2ad12a93e10390b1}{set\_node\_update\_info}}(geom\_object\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04724}04724           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04725}04725         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04726}04726       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04727}04727 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04728}04728 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04729}04729 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04730}04730       \textcolor{comment}{// Doc/check the neighbours}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04731}04731       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04732}04732       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Tree*>}} all\_tree\_nodes\_pt;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04733}04733       this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a40bd3735303f019892b03d6a5355c8db}{stick\_all\_tree\_nodes\_into\_vector}}(all\_tree\_nodes\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04734}04734 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04735}04735       \textcolor{comment}{// Check the neighbours}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04736}04736       this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a0e6a7f821d9f14374c6d23d8766c7679}{check\_all\_neighbours}}(doc\_info);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04737}04737 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04738}04738       \textcolor{comment}{// Check the integrity of the elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04739}04739       \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04740}04740 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04741}04741       \textcolor{comment}{// Loop over elements and get the elemental integrity}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04742}04742       \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04743}04743       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04744}04744       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04745}04745         \textcolor{keywordtype}{double} max\_el\_error;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04746}04746         tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt()-\/>check\_integrity(max\_el\_error);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04747}04747         \textcolor{comment}{// If the elemental error is greater than our maximum error}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04748}04748         \textcolor{comment}{// reset the maximum}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04749}04749         \textcolor{keywordflow}{if} (max\_el\_error > \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04750}04750         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04751}04751           \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} = max\_el\_error;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04752}04752         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04753}04753       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04754}04754 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04755}04755       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} > \mbox{\hyperlink{classoomph_1_1RefineableElement_a5cdf00847c81f896f91193d82c00d5b2}{RefineableElement::max\_integrity\_tolerance}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04756}04756       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04757}04757         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04758}04758         error\_stream << \textcolor{stringliteral}{"{}Mesh refined: Max. error in integrity check: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04759}04759                      << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} << \textcolor{stringliteral}{"{} is too big"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04760}04760                      << \textcolor{stringliteral}{"{}\(\backslash\)ni.e. bigger than RefineableElement::"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04761}04761                      << \textcolor{stringliteral}{"{}max\_integrity\_tolerance()="{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04762}04762                      << \mbox{\hyperlink{classoomph_1_1RefineableElement_a5cdf00847c81f896f91193d82c00d5b2}{RefineableElement::max\_integrity\_tolerance}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04763}04763                      << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04764}04764 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04765}04765         std::ofstream some\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04766}04766         some\_file.open(\textcolor{stringliteral}{"{}ProblemMesh.dat"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04767}04767         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04768}04768         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04769}04769           \textcolor{comment}{// Get the pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04770}04770           Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04771}04771           \textcolor{comment}{// Get the dimension}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04772}04772           \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04773}04773           \textcolor{comment}{// Output the coordinates}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04774}04774           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04775}04775           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04776}04776             some\_file << this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n)-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04777}04777           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04778}04778           some\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04779}04779         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04780}04780         some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04781}04781 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04782}04782         error\_stream << \textcolor{stringliteral}{"{}Documented problem mesh in ProblemMesh.dat"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04783}04783                      << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04784}04784 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04785}04785         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04786}04786           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04787}04787       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04788}04788       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04789}04789       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04790}04790         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Mesh refined: Max. error in integrity check: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04791}04791                    << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_ae201c5ddcc37716ee2901da78dda5b47}{max\_error}} << \textcolor{stringliteral}{"{} is OK"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04792}04792         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04793}04793           << \textcolor{stringliteral}{"{}i.e. less than RefineableElement::max\_integrity\_tolerance()="{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04794}04794           << \mbox{\hyperlink{classoomph_1_1RefineableElement_a5cdf00847c81f896f91193d82c00d5b2}{RefineableElement::max\_integrity\_tolerance}}() << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04795}04795           << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04796}04796       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04797}04797 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04798}04798 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04799}04799       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04800}04800       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04801}04801         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04802}04802         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for (paranoid only) checking of integrity: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04803}04803                    << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04804}04804         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04805}04805       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04806}04806 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04807}04807 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04808}04808 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04809}04809       \textcolor{comment}{// Loop over all elements other than the final level and deactivate the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04810}04810       \textcolor{comment}{// objects, essentially set the pointer that point to nodes that are}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04811}04811       \textcolor{comment}{// about to be deleted to NULL. This must take place here because nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04812}04812       \textcolor{comment}{// addressed by elements that are dead but still living in the tree might}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04813}04813       \textcolor{comment}{// have been made obsolete in the last round of refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04814}04814       \textcolor{comment}{//(Not strictly required, as tree structure has not changed, but does no}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04815}04815       \textcolor{comment}{// harm)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04816}04816       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_a6796a34cf1211f554a59055ff5765863}{ntree}}(); \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04817}04817       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04818}04818         this-\/>\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a0819e694e4fa30a78502aff0fbab5acd}{forest\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TreeForest_aaa58320cabce1668093eca8647d5be26}{tree\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})-\/>\mbox{\hyperlink{classoomph_1_1Tree_a3caab39c8bee6fb65bbafed523aa6d3d}{traverse\_all}}(\&\mbox{\hyperlink{classoomph_1_1Tree_aea17489589a1872db51f2b142da4c1fb}{Tree::deactivate\_object}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04819}04819       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04820}04820 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04821}04821       \textcolor{comment}{// Now we can prune the dead nodes from the mesh.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04822}04822       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Node*>}} deleted\_node\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_ac9f58929371a3f39dd646d2756547ad2}{prune\_dead\_nodes}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04823}04823 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04824}04824       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04825}04825       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04826}04826         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04827}04827         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for deactivating objects and pruning nodes: "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04828}04828                    << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04829}04829         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04830}04830       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04831}04831 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04832}04832       \textcolor{comment}{// Finally: Reorder the nodes within the mesh's node vector}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04833}04833       \textcolor{comment}{// to establish a standard ordering regardless of the sequence}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04834}04834       \textcolor{comment}{// of mesh refinements -\/-\/ this is required to allow dump/restart}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04835}04835       \textcolor{comment}{// on refined meshes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04836}04836       this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a801e77424d1bf8a35c9bba055230f1e3}{reorder\_nodes}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04837}04837 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04838}04838       \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1Global__timings_af25dd181537f6e338daadd0a73d269a0}{Global\_timings::Doc\_comprehensive\_timings}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04839}04839       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04840}04840         t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04841}04841         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for reordering "{}} << \mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04842}04842                    << \textcolor{stringliteral}{"{} nodes: "{}} << t\_end -\/ t\_start << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04843}04843         t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04844}04844       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04845}04845 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04846}04846       \textcolor{comment}{// Now we can correct the nodes on boundaries that were hanging that}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04847}04847       \textcolor{comment}{// are no longer hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04848}04848       \textcolor{comment}{// Only bother if we have more than two dimensions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04849}04849       \textcolor{keywordflow}{if} (mesh\_dim > 2)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04850}04850       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04851}04851         \textcolor{comment}{// Loop over the boundaries}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04852}04852         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} b = 0; b < n\_boundary; b++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04853}04853         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04854}04854           \textcolor{comment}{// Remove deleted nodes from the set}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04855}04855           \textcolor{keywordtype}{unsigned} n\_del = deleted\_node\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04856}04856           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_del; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04857}04857           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04858}04858             hanging\_nodes\_on\_boundary\_pt[b].erase(deleted\_node\_pt[j]);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04859}04859           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04860}04860 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04861}04861           \textcolor{comment}{// If the nodes that were hanging are still hanging then remove them}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04862}04862           \textcolor{comment}{// from the set (note increment is not in for command for efficiencty)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04863}04863           \textcolor{keywordflow}{for} (std::set<Node*>::iterator it =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04864}04864                  hanging\_nodes\_on\_boundary\_pt[b].begin();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04865}04865                it != hanging\_nodes\_on\_boundary\_pt[b].end();)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04866}04866           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04867}04867             \textcolor{keywordflow}{if} ((*it)-\/>is\_hanging())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04868}04868             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04869}04869               hanging\_nodes\_on\_boundary\_pt[b].erase(it++);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04870}04870             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04871}04871             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04872}04872             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04873}04873               ++it;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04874}04874             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04875}04875           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04876}04876 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04877}04877           \textcolor{comment}{// Are there any nodes that have changed geometric hanging status}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04878}04878           \textcolor{comment}{// on the boundary}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04879}04879           \textcolor{comment}{// The slightly painful part is that we must adjust the position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04880}04880           \textcolor{comment}{// via the macro-\/elements which are only available through the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04881}04881           \textcolor{comment}{// elements and not the nodes.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04882}04882           \textcolor{keywordflow}{if} (hanging\_nodes\_on\_boundary\_pt[b].size() > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04883}04883           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04884}04884             \textcolor{comment}{// If so we loop over all elements adjacent to the boundary}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04885}04885             \textcolor{keywordtype}{unsigned} n\_boundary\_element = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a68e04b3b70cff70d53d75f66661555e8}{nboundary\_element}}(b);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04886}04886             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_boundary\_element; ++\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}})}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04887}04887             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04888}04888               \textcolor{comment}{// Get a pointer to the element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04889}04889               \mbox{\hyperlink{classoomph_1_1FiniteElement}{FiniteElement}}* el\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a6dcf10c6fff9d13b309549ba73e10069}{boundary\_element\_pt}}(b, \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04890}04890 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04891}04891               \textcolor{comment}{// Do we have a solid element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04892}04892               \mbox{\hyperlink{classoomph_1_1SolidFiniteElement}{SolidFiniteElement}}* solid\_el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04893}04893                 \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidFiniteElement}{SolidFiniteElement}}*\textcolor{keyword}{>}(el\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04894}04894 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04895}04895               \textcolor{comment}{// Determine whether there is a macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04896}04896               \textcolor{keywordtype}{bool} macro\_present = (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a801bbe89619c28e181afa8fa3e9ac836}{macro\_elem\_pt}}() != 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04897}04897               \textcolor{comment}{// Or a solid macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04898}04898               \textcolor{keywordflow}{if} (solid\_el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04899}04899               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04900}04900                 macro\_present |= (solid\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidFiniteElement_a2c4a2681d29251acc0af8e7d95227cad}{undeformed\_macro\_elem\_pt}}() != 0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04901}04901               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04902}04902 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04903}04903               \textcolor{comment}{// Only bother to do anything if there is a macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04904}04904               \textcolor{comment}{// or undeformed macro element in a SolidElement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04905}04905               \textcolor{keywordflow}{if} (macro\_present)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04906}04906               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04907}04907                 \textcolor{comment}{// Loop over the nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04908}04908                 \textcolor{comment}{// ALH: (could optimise to only loop over}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04909}04909                 \textcolor{comment}{// node associated with the boundary with more effort)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04910}04910                 \textcolor{keywordtype}{unsigned} n\_el\_node = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04911}04911                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_el\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04912}04912                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04913}04913                   \textcolor{comment}{// Cache pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04914}04914                   Node* nod\_pt = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04915}04915                   \textcolor{keywordflow}{if} (nod\_pt-\/>is\_on\_boundary(b))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04916}04916                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04917}04917                     \textcolor{comment}{// Is the Node in our set}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04918}04918                     std::set<Node*>::iterator it =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04919}04919                       hanging\_nodes\_on\_boundary\_pt[b].find(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04920}04920                     \textcolor{comment}{// If we have found the Node then update the position}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04921}04921                     \textcolor{comment}{// to be consistent with the macro-\/element representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04922}04922                     \textcolor{keywordflow}{if} (it != hanging\_nodes\_on\_boundary\_pt[b].end())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04923}04923                     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04924}04924                       \textcolor{comment}{// Specialise local and global coordinates to 3D}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04925}04925                       \textcolor{comment}{// because there is only a problem in 3D.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04926}04926                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(3), \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}(3);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04927}04927                       \textcolor{comment}{// Find the local coordinate of the ndoe}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04928}04928                       el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a22bc4ee35e4f948d8d7fba18c7b4f4c4}{local\_coordinate\_of\_node}}(n, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04929}04929                       \textcolor{comment}{// Find the number of time history values}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04930}04930                       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} ntstorage = nod\_pt-\/>ntstorage();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04931}04931 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04932}04932                       \textcolor{comment}{// Do we have a solid node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04933}04933                       \mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}* solid\_node\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04934}04934                         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1SolidNode}{SolidNode}}*\textcolor{keyword}{>}(nod\_pt);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04935}04935                       \textcolor{keywordflow}{if} (solid\_node\_pt)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04936}04936                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04937}04937                         \textcolor{comment}{// Assign Lagrangian coordinates from undeformed}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04938}04938                         \textcolor{comment}{// macro element (if it has one -\/-\/ get\_x\_and\_xi()}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04939}04939                         \textcolor{comment}{// does "{}the right thing"{} anyway. Leave actual}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04940}04940                         \textcolor{comment}{// nodal positions alone -\/-\/ we're doing a solid}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04941}04941                         \textcolor{comment}{// mechanics problem and once we're going}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04942}04942                         \textcolor{comment}{// the nodal positions are always computed, never}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04943}04943                         \textcolor{comment}{// (automatically) reset to macro-\/element based}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04944}04944                         \textcolor{comment}{// positions; not even on pinned boundaries}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04945}04945                         \textcolor{comment}{// because the user may have other ideas about where}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04946}04946                         \textcolor{comment}{// these should go -\/-\/ pinning means "{}don't touch the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04947}04947                         \textcolor{comment}{// value"{}, not "{}leave where the macro-\/element thinks}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04948}04948                         \textcolor{comment}{// it should be"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04949}04949                         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} x\_fe(3), xi(3), xi\_fe(3);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04950}04950                         solid\_el\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidFiniteElement_a2e557cb3647e40fe3225bab4d8f834a0}{get\_x\_and\_xi}}(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, x\_fe, \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}, xi\_fe, xi);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04951}04951                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 3; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04952}04952                         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04953}04953                           solid\_node\_pt-\/>\mbox{\hyperlink{classoomph_1_1SolidNode_aa6780c66ed3f5db5cbb8fe2c0a476974}{xi}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = xi[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04954}04954                         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04955}04955                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04956}04956                       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04957}04957                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04958}04958                         \textcolor{comment}{// Set position and history values from the}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04959}04959                         \textcolor{comment}{// macro-\/element representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04960}04960                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} = 0; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}} < ntstorage; \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04961}04961                         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04962}04962                           \textcolor{comment}{// Get the history value from the macro element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04963}04963                           el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6fc14cbf4e1d031acbc59b415cefa1ca}{get\_x}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04964}04964 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04965}04965                           \textcolor{comment}{// Set the coordinate to that of the macroelement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04966}04966                           \textcolor{comment}{// representation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04967}04967                           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 3; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04968}04968                           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04969}04969                             nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) = \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04970}04970                           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04971}04971                         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04972}04972                       \} \textcolor{comment}{// End of non-\/solid node case}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04973}04973 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04974}04974                       \textcolor{comment}{// Now remove the node from the list}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04975}04975                       hanging\_nodes\_on\_boundary\_pt[b].erase(it);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04976}04976                       \textcolor{comment}{// If there are no Nodes left then exit the loops}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04977}04977                       \textcolor{keywordflow}{if} (hanging\_nodes\_on\_boundary\_pt[b].size() == 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04978}04978                       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04979}04979                         \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = n\_boundary\_element;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04980}04980                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04981}04981                       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04982}04982                     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04983}04983                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04984}04984                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04985}04985               \} \textcolor{comment}{// End of macro element case}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04986}04986             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04987}04987           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04988}04988         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04989}04989       \} \textcolor{comment}{// End of case when we have fixed nodal positions}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04990}04990 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04991}04991       \textcolor{comment}{// Final doc}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04992}04992       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04993}04993       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04994}04994       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04995}04995         \textcolor{comment}{// Doc the boundary conditions ('0' for non-\/existent, '1' for free,}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04996}04996         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04997}04997         \textcolor{comment}{// '2' for pinned -\/-\/ ideal for tecplot scatter sizing.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04998}04998         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l04999}04999         \textcolor{comment}{// num\_tree\_nodes=tree\_nodes\_pt.size();}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05000}05000 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05001}05001         \textcolor{comment}{// Determine maximum number of values at any node in this type of}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05002}05002         \textcolor{comment}{// element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05003}05003         \mbox{\hyperlink{classoomph_1_1RefineableElement}{RefineableElement}}* el\_pt = tree\_nodes\_pt[0]-\/>object\_pt();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05004}05004         \textcolor{comment}{// Initalise max\_nval}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05005}05005         \textcolor{keywordtype}{unsigned} max\_nval = 0;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05006}05006         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}(); n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05007}05007         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05008}05008           \textcolor{keywordflow}{if} (el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n)-\/>nvalue() > max\_nval)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05009}05009           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05010}05010             max\_nval = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n)-\/>nvalue();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05011}05011           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05012}05012         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05013}05013 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05014}05014         \textcolor{comment}{// Open the output file}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05015}05015         std::ostringstream fullname;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05016}05016         std::ofstream bcs\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05017}05017         fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05018}05018         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/bcs"{}} << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05019}05019                  << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05020}05020         bcs\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05021}05021 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05022}05022         \textcolor{comment}{// Loop over elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05023}05023         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < num\_tree\_nodes; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05024}05024         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05025}05025           el\_pt = tree\_nodes\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>object\_pt();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05026}05026           \textcolor{comment}{// Loop over nodes in element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05027}05027           \textcolor{keywordtype}{unsigned} n\_nod = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05028}05028           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_nod; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05029}05029           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05030}05030             \textcolor{comment}{// Get pointer to the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05031}05031             Node* nod\_pt = el\_pt-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05032}05032             \textcolor{comment}{// Find the dimension of the node}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05033}05033             \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05034}05034             \textcolor{comment}{// Write the nodal coordinates to the file}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05035}05035             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05036}05036             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05037}05037               bcs\_file << nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05038}05038             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05039}05039 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05040}05040             \textcolor{comment}{// Loop over all values in this element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05041}05041             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < max\_nval; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05042}05042             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05043}05043               \textcolor{comment}{// Value exists at this node:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05044}05044               \textcolor{keywordflow}{if} (i < nod\_pt-\/>nvalue())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05045}05045               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05046}05046                 bcs\_file << \textcolor{stringliteral}{"{} "{}} << 1 + nod\_pt-\/>is\_pinned(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05047}05047               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05048}05048               \textcolor{comment}{// ...if not just dump out a zero}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05049}05049               \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05050}05050               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05051}05051                 bcs\_file << \textcolor{stringliteral}{"{} 0 "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05052}05052               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05053}05053             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05054}05054             bcs\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05055}05055           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05056}05056         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05057}05057         bcs\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05058}05058 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05059}05059         \textcolor{comment}{// Doc all nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05060}05060         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05061}05061         std::ofstream all\_nodes\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05062}05062         fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05063}05063         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/all\_nodes"{}} << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05064}05064                  << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05065}05065         all\_nodes\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05066}05066 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05067}05067         all\_nodes\_file << \textcolor{stringliteral}{"{}ZONE \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05068}05068 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05069}05069         \textcolor{comment}{// Need to recompute the number of nodes since it may have}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05070}05070         \textcolor{comment}{// changed during mesh refinement/unrefinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05071}05071         n\_node = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05072}05072         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05073}05073         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05074}05074           Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05075}05075           \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05076}05076           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05077}05077           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05078}05078             all\_nodes\_file << this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n)-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05079}05079           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05080}05080           all\_nodes\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05081}05081         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05082}05082 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05083}05083         all\_nodes\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05084}05084 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05085}05085 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05086}05086         \textcolor{comment}{// Doc all hanging nodes:}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05087}05087         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05088}05088         std::ofstream some\_file;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05089}05089         fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05090}05090         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/all\_hangnodes"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05091}05091                  << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05092}05092         some\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05093}05093         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05094}05094         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05095}05095           Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05096}05096 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05097}05097           \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05098}05098           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05099}05099             \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05100}05100             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05101}05101             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05102}05102               some\_file << nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05103}05103             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05104}05104 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05105}05105             \textcolor{comment}{// ALH: Added this to stop Solid problems seg-\/faulting}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05106}05106             \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n)-\/>nvalue() > 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05107}05107             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05108}05108               some\_file << \textcolor{stringliteral}{"{} "{}} << nod\_pt-\/>raw\_value(0);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05109}05109             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05110}05110             some\_file << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05111}05111           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05112}05112         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05113}05113         some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05114}05114 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05115}05115         \textcolor{comment}{// Doc all hanging nodes and their masters}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05116}05116         \textcolor{comment}{// View with QHangingNodesWithMasters.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05117}05117         fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05118}05118         fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}() << \textcolor{stringliteral}{"{}/geometric\_hangnodes\_withmasters"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05119}05119                  << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05120}05120         some\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05121}05121         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_node; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05122}05122         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05123}05123           Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05124}05124           \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05125}05125           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05126}05126             \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05127}05127             \textcolor{keywordtype}{unsigned} nmaster = nod\_pt-\/>hanging\_pt()-\/>nmaster();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05128}05128             some\_file << \textcolor{stringliteral}{"{}ZONE I="{}} << nmaster + 1 << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05129}05129             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05130}05130             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05131}05131               some\_file << nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05132}05132             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05133}05133             some\_file << \textcolor{stringliteral}{"{} 2 "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05134}05134 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05135}05135             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imaster = 0; imaster < nmaster; imaster++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05136}05136             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05137}05137               Node* master\_nod\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05138}05138                 nod\_pt-\/>hanging\_pt()-\/>master\_node\_pt(imaster);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05139}05139               \textcolor{keywordtype}{unsigned} n\_dim = master\_nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05140}05140               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dim; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05141}05141               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05142}05142                 some\_file << master\_nod\_pt-\/>x(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05143}05143               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05144}05144               some\_file << \textcolor{stringliteral}{"{} 1 "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05145}05145             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05146}05146           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05147}05147         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05148}05148         some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05149}05149 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05150}05150         \textcolor{comment}{// Doc all hanging nodes and their masters}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05151}05151         \textcolor{comment}{// View with QHangingNodesWithMasters.mcr}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05152}05152         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < ncont\_interpolated\_values; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05153}05153         \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05154}05154           fullname.str(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05155}05155           fullname << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a85d58bcfce0a7b7cae461624e6fcd08a}{directory}}()}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05156}05156                    << \textcolor{stringliteral}{"{}/nonstandard\_hangnodes\_withmasters"{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}\_"{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05157}05157                    << \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a9d9ce638a7834bbd4961779af426bf13}{number}}() << \textcolor{stringliteral}{"{}.dat"{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05158}05158           some\_file.open(fullname.str().c\_str());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05159}05159           \textcolor{keywordtype}{unsigned} n\_nod = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a945e7823d1a2af243b5b7f7866aaff5e}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05160}05160           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < n\_nod; n++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05161}05161           \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05162}05162             Node* nod\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a69d22c2070f1649c4cb2607f26070d7c}{node\_pt}}(n);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05163}05163             \textcolor{keywordflow}{if} (nod\_pt-\/>is\_hanging(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}))}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05164}05164             \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05165}05165               \textcolor{keywordflow}{if} (nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) != nod\_pt-\/>hanging\_pt())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05166}05166               \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05167}05167                 \textcolor{keywordtype}{unsigned} nmaster = nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>nmaster();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05168}05168                 some\_file << \textcolor{stringliteral}{"{}ZONE I="{}} << nmaster + 1 << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05169}05169                 \textcolor{keywordtype}{unsigned} n\_dim = nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05170}05170                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_dim; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05171}05171                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05172}05172                   some\_file << nod\_pt-\/>x(j) << \textcolor{stringliteral}{"{} "{}};}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05173}05173                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05174}05174                 some\_file << \textcolor{stringliteral}{"{} 2 "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05175}05175                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} imaster = 0; imaster < nmaster; imaster++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05176}05176                 \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05177}05177                   Node* master\_nod\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05178}05178                     nod\_pt-\/>hanging\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})-\/>master\_node\_pt(imaster);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05179}05179                   \textcolor{keywordtype}{unsigned} n\_dim = master\_nod\_pt-\/>ndim();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05180}05180                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_dim; j++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05181}05181                   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05182}05182                     \textcolor{comment}{//               some\_file << master\_nod\_pt-\/>x(i) << "{} "{};}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05183}05183                   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05184}05184                   some\_file << \textcolor{stringliteral}{"{} 1 "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05185}05185                 \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05186}05186               \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05187}05187             \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05188}05188           \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05189}05189           some\_file.close();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05190}05190         \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05191}05191 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05192}05192       \} \textcolor{comment}{// End of documentation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05193}05193     \} \textcolor{comment}{// End if (this-\/>nelement()>0)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05194}05194 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05195}05195 \textcolor{comment}{    /// /BENFLAG: Check that all the nodes belong to their update elements}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05196}05196 \textcolor{comment}{}    \textcolor{comment}{// std::cout << "{}p\_adapt\_mesh(): Checking stuff works!"{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05197}05197     \textcolor{comment}{// for(unsigned j=0; j<this-\/>nnode(); j++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05198}05198     \textcolor{comment}{// \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05199}05199     \textcolor{comment}{//  MacroElementNodeUpdateNode* macro\_nod\_pt =}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05200}05200     \textcolor{comment}{//  dynamic\_cast<MacroElementNodeUpdateNode*>(this-\/>node\_pt(j));}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05201}05201     \textcolor{comment}{//  if(macro\_nod\_pt!=0)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05202}05202     \textcolor{comment}{//   \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05203}05203     \textcolor{comment}{//    bool big\_problem = true;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05204}05204     \textcolor{comment}{//    std::cout << "{}Node "{} << macro\_nod\_pt << "{} at [ "{} << macro\_nod\_pt-\/>x(0)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05205}05205     \textcolor{comment}{//    << "{}, "{} << macro\_nod\_pt-\/>x(1) << "{} ]"{} << std::endl; FiniteElement*}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05206}05206     \textcolor{comment}{//    up\_el\_pt =}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05207}05207     \textcolor{comment}{//    dynamic\_cast<FiniteElement*>(macro\_nod\_pt-\/>node\_update\_element\_pt());}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05208}05208     \textcolor{comment}{//    for(unsigned l=0; l<up\_el\_pt-\/>nnode(); l++)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05209}05209     \textcolor{comment}{//     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05210}05210     \textcolor{comment}{//      if(up\_el\_pt-\/>node\_pt(l)==macro\_nod\_pt)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05211}05211     \textcolor{comment}{//       \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05212}05212     \textcolor{comment}{//        big\_problem = false;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05213}05213     \textcolor{comment}{//        break;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05214}05214     \textcolor{comment}{//       \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05215}05215     \textcolor{comment}{//     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05216}05216     \textcolor{comment}{//    if(big\_problem)}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05217}05217     \textcolor{comment}{//     \{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05218}05218     \textcolor{comment}{//      std::cout << "{}  This node doesn't exist in it's update element!"{} <<}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05219}05219     \textcolor{comment}{//      std::endl;}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05220}05220     \textcolor{comment}{//     \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05221}05221     \textcolor{comment}{//   \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05222}05222     \textcolor{comment}{// \}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05223}05223 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05224}05224 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05225}05225 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05226}05226     \textcolor{comment}{// Now (re-\/)classify halo and haloed nodes and synchronise hanging}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05227}05227     \textcolor{comment}{// nodes}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05228}05228     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05229}05229     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05230}05230       \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_aec7c6fc41272ec883c589ee56d1b01e6}{classify\_halo\_and\_haloed\_nodes}}(doc\_info, \mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}}.\mbox{\hyperlink{classoomph_1_1DocInfo_a2ce90cf54f24b4ab523c624031fbb76b}{is\_doc\_enabled}}());}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05231}05231     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05232}05232 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05233}05233 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05234}05234   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05235}05235 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05236}05236   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05237}05237 \textcolor{comment}{  /// p-\/unrefine mesh uniformly}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05238}05238 \textcolor{comment}{  /// Unlike in h-\/refinement, we can simply p-\/unrefine each element in the mesh}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05239}05239 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05240}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4097d480ed921b86ec4a7e885df6}{05240}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a937e4097d480ed921b86ec4a7e885df6}{TreeBasedRefineableMeshBase::p\_unrefine\_uniformly}}(\mbox{\hyperlink{classoomph_1_1DocInfo}{DocInfo}}\& doc\_info)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05241}05241   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05242}05242     \textcolor{comment}{// Select all elements for unrefinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05243}05243     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Nelement = this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05244}05244     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < Nelement; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05245}05245     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05246}05246       \textcolor{comment}{// Get pointer to p-\/refineable element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05247}05247       \mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}* el\_pt =}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05248}05248         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05249}05249       \textcolor{comment}{// Mark for p-\/refinement if possible. If not then p\_adapt\_mesh() will}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05250}05250       \textcolor{comment}{// report the error.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05251}05251       \textcolor{keywordflow}{if} (el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05252}05252       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05253}05253         el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a99c9cb3bc0a1d6877f58e741f9b36df4}{select\_for\_p\_unrefinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05254}05254       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05255}05255     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05256}05256 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05257}05257     \textcolor{comment}{// Do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05258}05258     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae36ab5e807acc10ccc31a7886ffc040a}{p\_adapt\_mesh}}(\mbox{\hyperlink{classoomph_1_1RefineableMeshBase_a266f8b2a1499cc2ae7b24b19813923ee}{doc\_info}});}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05259}05259   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05260}05260 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05261}05261   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05262}05262 \textcolor{comment}{  /// p-\/refine mesh by refining the elements identified by their numbers.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05263}05263 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05264}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a8596076849247d63cadfe579fdc17d60}{05264}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a8596076849247d63cadfe579fdc17d60}{TreeBasedRefineableMeshBase::p\_refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05265}05265     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}}\& elements\_to\_be\_refined)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05266}05266   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05267}05267 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05268}05268     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05269}05269     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05270}05270       std::ostringstream warn\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05271}05271       warn\_stream << \textcolor{stringliteral}{"{}You are attempting to refine selected elements of a "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05272}05272                   << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05273}05273                   << \textcolor{stringliteral}{"{}distributed mesh. This may have undesired effects."{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05274}05274                   << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05275}05275 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05276}05276       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_stream.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05277}05277                       \textcolor{stringliteral}{"{}TreeBasedRefineableMeshBase::refine\_selected\_elements()"{}},}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05278}05278                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05279}05279     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05280}05280 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05281}05281 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05282}05282     \textcolor{comment}{// Select elements for refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05283}05283     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} nref = elements\_to\_be\_refined.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05284}05284     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nref; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05285}05285     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05286}05286       \textcolor{comment}{// Get pointer to p-\/refineable element}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05287}05287       \mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}* el\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1PRefineableElement}{PRefineableElement}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05288}05288         this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_aaa46cc70f706199e91fa58aef74763c2}{element\_pt}}(elements\_to\_be\_refined[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]));}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05289}05289       \textcolor{comment}{// Mark for p-\/refinement if possible. If not then p\_adapt\_mesh() will}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05290}05290       \textcolor{comment}{// report the error.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05291}05291       \textcolor{keywordflow}{if} (el\_pt != 0)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05292}05292       \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05293}05293         el\_pt-\/>\mbox{\hyperlink{classoomph_1_1PRefineableElement_a89ecf3e300ea9c7dd37ce981053377f4}{select\_for\_p\_refinement}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05294}05294       \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05295}05295     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05296}05296 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05297}05297     \textcolor{comment}{// Do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05298}05298     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae36ab5e807acc10ccc31a7886ffc040a}{p\_adapt\_mesh}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05299}05299   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05300}05300 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05301}05301   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05302}05302 \textcolor{comment}{  /// p-\/refine mesh by refining the elements identified by their pointers.}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05303}05303 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05304}\mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a178431e8c17ca9784f6fdc2501404471}{05304}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_a8596076849247d63cadfe579fdc17d60}{TreeBasedRefineableMeshBase::p\_refine\_selected\_elements}}(}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05305}05305     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<PRefineableElement*>}}\& elements\_to\_be\_refined\_pt)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05306}05306   \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05307}05307 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05308}05308     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a1ab35b022b95f2d28c53aa58859bd6b5}{is\_mesh\_distributed}}())}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05309}05309     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05310}05310       std::ostringstream warn\_stream;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05311}05311       warn\_stream << \textcolor{stringliteral}{"{}You are attempting to refine selected elements of a "{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05312}05312                   << std::endl}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05313}05313                   << \textcolor{stringliteral}{"{}distributed mesh. This may have undesired effects."{}}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05314}05314                   << std::endl;}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05315}05315 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05316}05316       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warn\_stream.str(),}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05317}05317                       \textcolor{stringliteral}{"{}TreeBasedRefineableMeshBase::refine\_selected\_elements()"{}},}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05318}05318                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05319}05319     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05320}05320 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05321}05321 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05322}05322     \textcolor{comment}{// Select elements for refinement}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05323}05323     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} nref = elements\_to\_be\_refined\_pt.size();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05324}05324     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < nref; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05325}05325     \{}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05326}05326       elements\_to\_be\_refined\_pt[\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}]-\/>select\_for\_p\_refinement();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05327}05327     \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05328}05328 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05329}05329     \textcolor{comment}{// Do the actual mesh adaptation}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05330}05330     \mbox{\hyperlink{classoomph_1_1TreeBasedRefineableMeshBase_ae36ab5e807acc10ccc31a7886ffc040a}{p\_adapt\_mesh}}();}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05331}05331   \}}
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05332}05332 }
\DoxyCodeLine{\Hypertarget{refineable__mesh_8cc_source_l05333}05333 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
