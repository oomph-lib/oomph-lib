\hypertarget{matrices_8cc_source}{}\doxysection{matrices.\+cc}
\label{matrices_8cc_source}\index{matrices.cc@{matrices.cc}}
\mbox{\hyperlink{matrices_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2021 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00026}00026 \textcolor{comment}{// Non-\/inline member functions for the matrix classes}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00028}00028 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00029}00029 \textcolor{preprocessor}{\#include "{}mpi.h"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00030}00030 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00032}00032 \textcolor{preprocessor}{\#include <cstring>}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00034}00034 \textcolor{preprocessor}{\#include <set>}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00035}00035 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00037}00037 \textcolor{comment}{//\#include <valgrind/callgrind.h>}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00039}00039 \textcolor{comment}{// oomph-\/lib headers}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00040}00040 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{matrices_8h}{matrices.h}}"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00041}00041 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{linear__solver_8h}{linear\_solver.h}}"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00042}00042 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00043}00043 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00044}00044 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00045}00045 \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00046}00046   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00047}00047 \textcolor{comment}{  /// Complete LU solve (overwrites RHS with solution). This is the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00048}00048 \textcolor{comment}{  /// generic version which should not need to be over-\/written.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00049}00049 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00050}\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a4d445c4a1204da569f40ec1bdace9ef3}{00050}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a4d445c4a1204da569f40ec1bdace9ef3}{DoubleMatrixBase::solve}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00051}00051   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00052}00052 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00053}00053     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00054}00054     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00055}00055       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Linear\_solver\_pt not set in matrix"{}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00056}00056                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00057}00057                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00058}00058     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00059}00059 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00061}00061     \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00062}00062     \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00063}00063     \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00064}00064     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} actual\_rhs(rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00066}00066     \textcolor{comment}{// Use the linear algebra interface to the linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00067}00067     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\textcolor{keyword}{this}, actual\_rhs, rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00068}00068   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00070}00070   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00071}00071 \textcolor{comment}{  /// Complete LU solve (Nothing gets overwritten!). This generic}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00072}00072 \textcolor{comment}{  /// version should never need to be overwritten}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00073}00073 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00074}\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_ac35083cf8225822363c25b921b4ca1ce}{00074}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a4d445c4a1204da569f40ec1bdace9ef3}{DoubleMatrixBase::solve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& soln)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00075}00075   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00076}00076 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00077}00077     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00078}00078     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00079}00079       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Linear\_solver\_pt not set in matrix"{}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00080}00080                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00081}00081                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00082}00082     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00083}00083 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00084}00084     \textcolor{comment}{// Use the linear algebra interface to the linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00085}00085     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\textcolor{keyword}{this}, rhs, soln);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00086}00086   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00088}00088   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00089}00089 \textcolor{comment}{  /// Complete LU solve (overwrites RHS with solution). This is the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00090}00090 \textcolor{comment}{  /// generic version which should not need to be over-\/written.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00091}00091 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00092}\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_ae9098f3e129833a6b1cb5fe6ebdd9835}{00092}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a4d445c4a1204da569f40ec1bdace9ef3}{DoubleMatrixBase::solve}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& rhs)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00093}00093   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00094}00094 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00095}00095     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00096}00096     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00097}00097       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Linear\_solver\_pt not set in matrix"{}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00098}00098                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00099}00099                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00100}00100     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00101}00101 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00103}00103     \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00104}00104     \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00105}00105     \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00106}00106     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} actual\_rhs(rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00107}00107 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00108}00108     \textcolor{comment}{// Use the linear algebra interface to the linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00109}00109     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\textcolor{keyword}{this}, actual\_rhs, rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00110}00110   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00112}00112   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00113}00113 \textcolor{comment}{  /// Complete LU solve (Nothing gets overwritten!). This generic}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00114}00114 \textcolor{comment}{  /// version should never need to be overwritten}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00115}00115 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00116}\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a8d9fb5fddec05a0b6e35cff23c79255c}{00116}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a4d445c4a1204da569f40ec1bdace9ef3}{DoubleMatrixBase::solve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& rhs, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& soln)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00117}00117   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00118}00118 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00119}00119     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00120}00120     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00121}00121       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Linear\_solver\_pt not set in matrix"{}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00122}00122                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00123}00123                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00124}00124     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00125}00125 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00126}00126     \textcolor{comment}{// Use the linear algebra interface to the linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00127}00127     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(\textcolor{keyword}{this}, rhs, soln);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00128}00128   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00130}00130 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00131}00131 \textcolor{comment}{  /// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00132}00132 \textcolor{comment}{  /// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00133}00133 \textcolor{comment}{  /// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00134}00134 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00135}00135   \textcolor{comment}{//===============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00136}00136 \textcolor{comment}{  /// Constructor, set the default linear solver to be the DenseLU}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00137}00137 \textcolor{comment}{  /// solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00138}00138 \textcolor{comment}{}  \textcolor{comment}{//===============================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00139}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a3f4448fda5506f6f8080228c3f8c7e06}{00139}}   \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a3f4448fda5506f6f8080228c3f8c7e06}{DenseDoubleMatrix::DenseDoubleMatrix}}() : \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix}}<double>()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00140}00140   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00141}00141     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DenseLU}{DenseLU}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00142}00142   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00143}00143 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00144}00144   \textcolor{comment}{//==============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00145}00145 \textcolor{comment}{  /// Constructor to build a square n by n matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00146}00146 \textcolor{comment}{  /// Set the default linear solver to be DenseLU}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00147}00147 \textcolor{comment}{}  \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00148}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a50b8a6f60661c30b3875212f67c83a04}{00148}}   \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a3f4448fda5506f6f8080228c3f8c7e06}{DenseDoubleMatrix::DenseDoubleMatrix}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& n)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00149}00149     : \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix}}<double>(n)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00150}00150   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00151}00151     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DenseLU}{DenseLU}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00152}00152   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00153}00153 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00154}00154 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00155}00155   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00156}00156 \textcolor{comment}{  /// Constructor to build a matrix with n rows and m columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00157}00157 \textcolor{comment}{  /// Set the default linear solver to be DenseLU}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00158}00158 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00159}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_ab810633bd06c5d09b6b05d8173083e1e}{00159}}   \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a3f4448fda5506f6f8080228c3f8c7e06}{DenseDoubleMatrix::DenseDoubleMatrix}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& n,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00160}00160                                        \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& m)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00161}00161     : \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix}}<double>(n, m)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00162}00162   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00163}00163     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DenseLU}{DenseLU}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00164}00164   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00166}00166   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00167}00167 \textcolor{comment}{  /// Constructor to build a matrix with n rows and m columns,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00168}00168 \textcolor{comment}{  /// with initial value initial\_val}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00169}00169 \textcolor{comment}{  /// Set the default linear solver to be DenseLU}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00170}00170 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00171}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a8b964715b2e8fa266d3676fc965296b0}{00171}}   \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a3f4448fda5506f6f8080228c3f8c7e06}{DenseDoubleMatrix::DenseDoubleMatrix}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& n,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00172}00172                                        \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& m,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00173}00173                                        \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& initial\_val)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00174}00174     : \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix}}<double>(n, m, initial\_val)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00175}00175   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00176}00176     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DenseLU}{DenseLU}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00177}00177   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00179}00179   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00180}00180 \textcolor{comment}{  /// Destructor delete the default linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00181}00181 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00182}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a5b68ac6eb31db9b0221d0dd724bcc3a6}{00182}}   \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a5b68ac6eb31db9b0221d0dd724bcc3a6}{DenseDoubleMatrix::\string~DenseDoubleMatrix}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00183}00183   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00184}00184     \textcolor{comment}{// Delete the default linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00185}00185     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00186}00186   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00187}00187 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00188}00188   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00189}00189 \textcolor{comment}{  /// LU decompose a matrix, by using the default linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00190}00190 \textcolor{comment}{  /// (DenseLU)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00191}00191 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00192}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a741d54dbea2a16e6e3f10bbd2d9d726e}{00192}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a741d54dbea2a16e6e3f10bbd2d9d726e}{DenseDoubleMatrix::ludecompose}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00193}00193   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00194}00194     \textcolor{comment}{// Use the default (DenseLU) solver to ludecompose the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00195}00195     \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1DenseLU}{DenseLU}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}})-\/>factorise(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00196}00196   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00197}00197 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00198}00198 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00199}00199   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00200}00200 \textcolor{comment}{  ///  Back substitute an LU decomposed matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00201}00201 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00202}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a52515653ab5b792388258ca04e9dcbcc}{00202}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a52515653ab5b792388258ca04e9dcbcc}{DenseDoubleMatrix::lubksub}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00203}00203   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00204}00204     \textcolor{comment}{// Use the default (DenseLU) solver to perform the backsubstitution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00205}00205     \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1DenseLU}{DenseLU}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}})-\/>backsub(rhs, rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00206}00206   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00208}00208   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00209}00209 \textcolor{comment}{  ///  Back substitute an LU decomposed matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00210}00210 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00211}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a0abbfbf61337d53ad1b239ba4431a47c}{00211}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a52515653ab5b792388258ca04e9dcbcc}{DenseDoubleMatrix::lubksub}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& rhs)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00212}00212   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00213}00213     \textcolor{comment}{// Use the default (DenseLU) solver to perform the backsubstitution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00214}00214     \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1DenseLU}{DenseLU}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}})-\/>backsub(rhs, rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00215}00215   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00216}00216 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00217}00217 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00218}00218   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00219}00219 \textcolor{comment}{  ///  Determine eigenvalues and eigenvectors, using}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00220}00220 \textcolor{comment}{  /// Jacobi rotations. Only for symmetric matrices. Nothing gets overwritten!}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00221}00221 \textcolor{comment}{  /// -\/ \(\backslash\)c eigen\_vect(i,j) = j-\/th component of i-\/th eigenvector.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00222}00222 \textcolor{comment}{  /// -\/ \(\backslash\)c eigen\_val[i] is the i-\/th eigenvalue; same ordering as in eigenvectors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00223}00223 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00224}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_aef56ba05f1ba190c3461cf27d57abd9d}{00224}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_aef56ba05f1ba190c3461cf27d57abd9d}{DenseDoubleMatrix::eigenvalues\_by\_jacobi}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00225}00225     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& eigen\_vals, \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& eigen\_vect)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00226}00226 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00227}00227 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00228}00228     \textcolor{comment}{// Check Matrix is square}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00229}00229     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}} != \mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00230}00230     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00231}00231       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00232}00232         \textcolor{stringliteral}{"{}This matrix is not square, the matrix MUST be square!"{}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00233}00233         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00234}00234         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00235}00235     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00236}00236 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00237}00237     \textcolor{comment}{// Make a copy of the matrix \& check that it's symmetric}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00238}00238 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00239}00239     \textcolor{comment}{// Check that the sizes of eigen\_vals and eigen\_vect are correct. If not}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00240}00240     \textcolor{comment}{// correct them.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00241}00241     \textcolor{keywordflow}{if} (eigen\_vals.size() != \mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00242}00242     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00243}00243       eigen\_vals.resize(\mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00244}00244     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00245}00245     \textcolor{keywordflow}{if} (eigen\_vect.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}() != \mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}} || eigen\_vect.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}() != \mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00246}00246     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00247}00247       eigen\_vect.\mbox{\hyperlink{classoomph_1_1DenseMatrix_adec1ef741b1c5048a12ba9a540c2719c}{resize}}(\mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00248}00248     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00249}00249 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00250}00250     \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix}{DenseDoubleMatrix}} working\_matrix(\mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00251}00251     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00252}00252     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00253}00253       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = 0; j < \mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}}; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00254}00254       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00255}00255 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00256}00256         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[\mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}} * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + j] != \mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[\mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}} * j + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00257}00257         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00258}00258           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00259}00259             \textcolor{stringliteral}{"{}Matrix needs to be symmetric for eigenvalues\_by\_jacobi()"{}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00260}00260             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00261}00261             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00262}00262         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00263}00263 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00264}00264         working\_matrix(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) = (*this)(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00265}00265       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00266}00266     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00267}00267 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00268}00268     \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix}{DenseDoubleMatrix}} aux\_eigen\_vect(\mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00269}00269 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00270}00270     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Sorry JacobiEigenSolver::jacobi() removed because of "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00271}00271                         \textcolor{stringliteral}{"{}licencing problems."{}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00272}00272                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00273}00273                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00274}00274 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00275}00275     \textcolor{comment}{// // Call eigensolver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00276}00276     \textcolor{comment}{// unsigned long nrot;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00277}00277     \textcolor{comment}{// JacobiEigenSolver::jacobi(working\_matrix, eigen\_vals, aux\_eigen\_vect,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00278}00278     \textcolor{comment}{//                           nrot);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00279}00279 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00280}00280     \textcolor{comment}{// Copy across (and transpose)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00281}00281     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00282}00282     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00283}00283       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = 0; j < \mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}}; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00284}00284       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00285}00285         eigen\_vect(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) = aux\_eigen\_vect(j, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00286}00286       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00287}00287     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00288}00288   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00289}00289 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00290}00290 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00291}00291   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00292}00292 \textcolor{comment}{  ///  Multiply the matrix by the vector x: soln=Ax}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00293}00293 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00294}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_ab575dfefa0bdd8f495453baa5575a4a0}{00294}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_ab575dfefa0bdd8f495453baa5575a4a0}{DenseDoubleMatrix::multiply}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00295}00295                                    \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& soln)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00296}00296 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00297}00297 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00298}00298     \textcolor{comment}{// Check to see if x.size() = ncol().}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00299}00299     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.nrow() != this-\/>ncol())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00300}00300     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00301}00301       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00302}00302       error\_message\_stream << \textcolor{stringliteral}{"{}The x vector is not the right size. It is "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00303}00303                            << \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.nrow() << \textcolor{stringliteral}{"{}, it should be "{}} << this-\/>\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_aec36d12984999f29f5fc21feea55df1d}{ncol}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00304}00304                            << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00305}00305       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00306}00306                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00307}00307                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00308}00308     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00309}00309     \textcolor{comment}{// check that x is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00310}00310     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distributed())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00311}00311     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00312}00312       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00313}00313       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00314}00314         << \textcolor{stringliteral}{"{}The x vector cannot be distributed for DenseDoubleMatrix "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00315}00315         << \textcolor{stringliteral}{"{}matrix-\/vector multiply"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00316}00316       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00317}00317                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00318}00318                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00319}00319     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00320}00320     \textcolor{comment}{// if soln is setup...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00321}00321     \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00322}00322     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00323}00323       \textcolor{comment}{// check that soln is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00324}00324       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00325}00325       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00326}00326         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00327}00327         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00328}00328           << \textcolor{stringliteral}{"{}The x vector cannot be distributed for DenseDoubleMatrix "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00329}00329           << \textcolor{stringliteral}{"{}matrix-\/vector multiply"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00330}00330         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00331}00331                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00332}00332                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00333}00333       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00334}00334       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != this-\/>nrow())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00335}00335       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00336}00336         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00337}00337         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00338}00338           << \textcolor{stringliteral}{"{}The soln vector is setup and therefore must have the same "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00339}00339           << \textcolor{stringliteral}{"{}number of rows as the matrix"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00340}00340         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00341}00341                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00342}00342                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00343}00343       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00344}00344       \textcolor{keywordflow}{if} (*\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt() !=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00345}00345           *soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00346}00346       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00347}00347         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00348}00348         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00349}00349           << \textcolor{stringliteral}{"{}The soln vector and the x vector must have the same communicator"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00350}00350           << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00351}00351         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00352}00352                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00353}00353                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00354}00354       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00355}00355     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00356}00356 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00357}00357 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00358}00358     \textcolor{comment}{// if soln is not setup then setup the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00359}00359     \textcolor{keywordflow}{if} (!soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00360}00360     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00361}00361       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00362}00362         \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt(), this-\/>nrow(), \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00363}00363       soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\&dist, 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00364}00364     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00365}00365 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00366}00366     \textcolor{comment}{// Initialise the solution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00367}00367     soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00368}00368 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00369}00369     \textcolor{comment}{// Multiply the matrix A, by the vector x}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00370}00370     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* x\_pt = \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.values\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00371}00371     \textcolor{keywordtype}{double}* soln\_pt = soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00372}00372     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00373}00373     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00374}00374       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = 0; j < \mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}}; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00375}00375       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00376}00376         soln\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += \mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[\mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}} * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + j] * x\_pt[j];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00377}00377       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00378}00378     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00379}00379   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00380}00380 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00381}00381 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00382}00382   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00383}00383 \textcolor{comment}{  /// Multiply the transposed matrix by the vector x: soln=A\string^T x}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00384}00384 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00385}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a7cc35997d87b4ee7b77fcaaf85eeeaec}{00385}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a7cc35997d87b4ee7b77fcaaf85eeeaec}{DenseDoubleMatrix::multiply\_transpose}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00386}00386                                              \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& soln)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00387}00387 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00388}00388 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00389}00389     \textcolor{comment}{// Check to see if x.size() = ncol().}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00390}00390     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.nrow() != this-\/>nrow())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00391}00391     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00392}00392       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00393}00393       error\_message\_stream << \textcolor{stringliteral}{"{}The x vector is not the right size. It is "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00394}00394                            << \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.nrow() << \textcolor{stringliteral}{"{}, it should be "{}} << this-\/>\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_ab67993d1a41ca5ddf05c8210673723f0}{nrow}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00395}00395                            << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00396}00396       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00397}00397                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00398}00398                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00399}00399     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00400}00400     \textcolor{comment}{// check that x is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00401}00401     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distributed())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00402}00402     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00403}00403       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00404}00404       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00405}00405         << \textcolor{stringliteral}{"{}The x vector cannot be distributed for DenseDoubleMatrix "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00406}00406         << \textcolor{stringliteral}{"{}matrix-\/vector multiply"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00407}00407       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00408}00408                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00409}00409                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00410}00410     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00411}00411     \textcolor{comment}{// if soln is setup...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00412}00412     \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00413}00413     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00414}00414       \textcolor{comment}{// check that soln is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00415}00415       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00416}00416       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00417}00417         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00418}00418         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00419}00419           << \textcolor{stringliteral}{"{}The x vector cannot be distributed for DenseDoubleMatrix "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00420}00420           << \textcolor{stringliteral}{"{}matrix-\/vector multiply"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00421}00421         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00422}00422                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00423}00423                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00424}00424       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00425}00425       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != this-\/>ncol())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00426}00426       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00427}00427         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00428}00428         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00429}00429           << \textcolor{stringliteral}{"{}The soln vector is setup and therefore must have the same "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00430}00430           << \textcolor{stringliteral}{"{}number of columns as the matrix"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00431}00431         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00432}00432                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00433}00433                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00434}00434       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00435}00435       \textcolor{keywordflow}{if} (*soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}() !=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00436}00436           *\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00437}00437       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00438}00438         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00439}00439         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00440}00440           << \textcolor{stringliteral}{"{}The soln vector and the x vector must have the same communicator"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00441}00441           << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00442}00442         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00443}00443                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00444}00444                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00445}00445       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00446}00446     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00447}00447 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00448}00448 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00449}00449     \textcolor{comment}{// if soln is not setup then setup the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00450}00450     \textcolor{keywordflow}{if} (!soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00451}00451     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00452}00452       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00453}00453         \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt(), this-\/>ncol(), \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00454}00454       soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00455}00455       \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00456}00456     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00457}00457 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00458}00458     \textcolor{comment}{// Initialise the solution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00459}00459     soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00460}00460 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00461}00461     \textcolor{comment}{// Matrix vector product}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00462}00462     \textcolor{keywordtype}{double}* soln\_pt = soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00463}00463     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* x\_pt = \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.values\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00464}00464     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00465}00465     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00466}00466       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = 0; j < \mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}}; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00467}00467       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00468}00468         soln\_pt[j] += \mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[\mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}} * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + j] * x\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00469}00469       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00470}00470     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00471}00471   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00472}00472 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00473}00473 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00474}00474   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00475}00475 \textcolor{comment}{  /// For every row, find the maximum absolute value of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00476}00476 \textcolor{comment}{  /// entries in this row. Set all values that are less than alpha times}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00477}00477 \textcolor{comment}{  /// this maximum to zero and return the resulting matrix in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00478}00478 \textcolor{comment}{  /// reduced\_matrix. Note: Diagonal entries are retained regardless}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00479}00479 \textcolor{comment}{  /// of their size.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00480}00480 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00481}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a64b81a329f8e9204e50b75ea367a77d4}{00481}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_a64b81a329f8e9204e50b75ea367a77d4}{DenseDoubleMatrix::matrix\_reduction}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& alpha,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00482}00482                                            \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix}{DenseDoubleMatrix}}\& reduced\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00483}00483   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00484}00484     reduced\_matrix.\mbox{\hyperlink{classoomph_1_1DenseMatrix_adec1ef741b1c5048a12ba9a540c2719c}{resize}}(\mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}}, \mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}}, 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00485}00485     \textcolor{comment}{// maximum value in a row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00486}00486     \textcolor{keywordtype}{double} max\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00487}00487 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00488}00488     \textcolor{comment}{// Loop over rows}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00489}00489     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1DenseMatrix_a23cb539be0b4ef0381b9f18e8e50f75e}{N}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00490}00490     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00491}00491       \textcolor{comment}{// Initialise max value in row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00492}00492       max\_row = 0.0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00493}00493 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00494}00494       \textcolor{comment}{// Loop over entries in columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00495}00495       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = 0; j < \mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}}; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00496}00496       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00497}00497         \textcolor{comment}{// Find max. value in row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00498}00498         \textcolor{keywordflow}{if} (std::fabs(\mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[\mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}} * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + j]) > max\_row)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00499}00499         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00500}00500           max\_row = std::fabs(\mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[\mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}} * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00501}00501         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00502}00502       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00503}00503 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00504}00504       \textcolor{comment}{// Decide if we need to retain the entries in the row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00505}00505       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = 0; j < \mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}}; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00506}00506       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00507}00507         \textcolor{comment}{// If we're on the diagonal or the value is sufficiently large: retain}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00508}00508         \textcolor{comment}{// i.e. copy across.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00509}00509         \textcolor{keywordflow}{if} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} == j || std::fabs(\mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[\mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}} * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + j]) > alpha * max\_row)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00510}00510         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00511}00511           reduced\_matrix(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) = \mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[\mbox{\hyperlink{classoomph_1_1DenseMatrix_aa36631ee95fe55afe697377b03d05d6a}{M}} * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + j];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00512}00512         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00513}00513       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00514}00514     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00515}00515   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00516}00516 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00517}00517 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00518}00518   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00519}00519 \textcolor{comment}{  /// Function to multiply this matrix by the DenseDoubleMatrix  matrix\_in.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00520}00520 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00521}\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_aab687b1136f0265434ada2684aa1b0a4}{00521}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_ab575dfefa0bdd8f495453baa5575a4a0}{DenseDoubleMatrix::multiply}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix}{DenseDoubleMatrix}}\& matrix\_in,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00522}00522                                    \mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix}{DenseDoubleMatrix}}\& result)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00523}00523   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00524}00524 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00525}00525     \textcolor{comment}{// check matrix dimensions are compatable}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00526}00526     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_aec36d12984999f29f5fc21feea55df1d}{ncol}}() != matrix\_in.\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_ab67993d1a41ca5ddf05c8210673723f0}{nrow}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00527}00527     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00528}00528       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00529}00529       error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00530}00530         << \textcolor{stringliteral}{"{}Matrix dimensions incompatable for matrix-\/matrix multiplication"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00531}00531         << \textcolor{stringliteral}{"{}ncol() for first matrix:"{}} << this-\/>\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_aec36d12984999f29f5fc21feea55df1d}{ncol}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00532}00532         << \textcolor{stringliteral}{"{}nrow() for second matrix: "{}} << matrix\_in.\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_ab67993d1a41ca5ddf05c8210673723f0}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00533}00533 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00534}00534       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00535}00535         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00536}00536     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00537}00537 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00538}00538 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00539}00539     \textcolor{comment}{// NB N is number of rows!}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00540}00540     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_row = this-\/>\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_ab67993d1a41ca5ddf05c8210673723f0}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00541}00541     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} m\_col = matrix\_in.\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_aec36d12984999f29f5fc21feea55df1d}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00542}00542 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00543}00543     \textcolor{comment}{// resize and intialize result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00544}00544     result.\mbox{\hyperlink{classoomph_1_1DenseMatrix_adec1ef741b1c5048a12ba9a540c2719c}{resize}}(n\_row, m\_col, 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00545}00545 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00546}00546     \textcolor{comment}{// clock\_t clock1 = clock();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00547}00547 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00548}00548     \textcolor{comment}{// do calculation}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00549}00549     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_col = this-\/>\mbox{\hyperlink{classoomph_1_1DenseDoubleMatrix_aec36d12984999f29f5fc21feea55df1d}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00550}00550     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} k = 0; k < n\_col; k++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00551}00551     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00552}00552       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00553}00553       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00554}00554         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = 0; j < m\_col; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00555}00555         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00556}00556           result(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) += \mbox{\hyperlink{classoomph_1_1DenseMatrix_a92a2eea603a42e22fd4d3ea0a258e6f8}{Matrixdata}}[m\_col * \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + k] * matrix\_in(k, j);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00557}00557         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00558}00558       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00559}00559     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00560}00560   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00561}00561 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00562}00562 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00563}00563 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00564}00564 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00565}00565 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00566}00566 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00567}00567 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00568}00568   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00569}00569 \textcolor{comment}{  /// Default constructor, set the default linear solver and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00570}00570 \textcolor{comment}{  /// matrix-\/matrix multiplication method.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00571}00571 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00572}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_abc80ef8ffa3a961daf6759bb2c574239}{00572}}   \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_abc80ef8ffa3a961daf6759bb2c574239}{CCDoubleMatrix::CCDoubleMatrix}}() : \mbox{\hyperlink{classoomph_1_1CCMatrix}{CCMatrix}}<double>()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00573}00573   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00574}00574     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00575}00575     \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_afb1660974c8f6218c2a000c2d6c6d267}{Matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00576}00576   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00577}00577 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00578}00578   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00579}00579 \textcolor{comment}{  /// Constructor: Pass vector of values, vector of row indices,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00580}00580 \textcolor{comment}{  /// vector of column starts and number of rows (can be suppressed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00581}00581 \textcolor{comment}{  /// for square matrices). Number of nonzero entries is read}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00582}00582 \textcolor{comment}{  /// off from value, so make sure the vector has been shrunk}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00583}00583 \textcolor{comment}{  /// to its correct length.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00584}00584 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00585}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_ad98b162e3cc1aac48e9f5e1e06e262a5}{00585}}   \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_abc80ef8ffa3a961daf6759bb2c574239}{CCDoubleMatrix::CCDoubleMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00586}00586                                  \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& row\_index,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00587}00587                                  \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& column\_start,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00588}00588                                  \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& n,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00589}00589                                  \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& m)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00590}00590     : \mbox{\hyperlink{classoomph_1_1CCMatrix}{CCMatrix}}<double>(value, row\_index, column\_start, n, m)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00591}00591   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00592}00592     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00593}00593     \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_afb1660974c8f6218c2a000c2d6c6d267}{Matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00594}00594   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00595}00595 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00596}00596 \textcolor{comment}{  /// Destructor: delete the default linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00597}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_a89019bdd7b9a64a2f32cd4efa07fe45c}{00597}} \textcolor{comment}{}  \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_a89019bdd7b9a64a2f32cd4efa07fe45c}{CCDoubleMatrix::\string~CCDoubleMatrix}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00598}00598   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00599}00599     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00600}00600   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00601}00601 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00602}00602 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00603}00603   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00604}00604 \textcolor{comment}{  /// Perform LU decomposition. Return the sign of the determinant}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00605}00605 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00606}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_acb7c9b4e04b877b3ef40be905829eb41}{00606}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_acb7c9b4e04b877b3ef40be905829eb41}{CCDoubleMatrix::ludecompose}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00607}00607   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00608}00608     \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}})-\/>factorise(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00609}00609   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00610}00610 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00611}00611   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00612}00612 \textcolor{comment}{  /// Do the backsubstitution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00613}00613 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00614}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_a59fbc30e6a856794cd2678856c8aea6d}{00614}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_a59fbc30e6a856794cd2678856c8aea6d}{CCDoubleMatrix::lubksub}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00615}00615   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00616}00616     \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}})-\/>backsub(rhs, rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00617}00617   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00618}00618 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00619}00619   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00620}00620 \textcolor{comment}{  ///  Multiply the matrix by the vector x}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00621}00621 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00622}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_add24c25e344b84fb5b732e294af5e8b2}{00622}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_add24c25e344b84fb5b732e294af5e8b2}{CCDoubleMatrix::multiply}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& soln)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00623}00623 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00624}00624 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00625}00625     \textcolor{comment}{// Check to see if x.size() = ncol().}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00626}00626     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.nrow() != this-\/>ncol())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00627}00627     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00628}00628       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00629}00629       error\_message\_stream << \textcolor{stringliteral}{"{}The x vector is not the right size. It is "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00630}00630                            << \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.nrow() << \textcolor{stringliteral}{"{}, it should be "{}} << this-\/>\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_aa38cc544ab30f9318161763e13c20957}{ncol}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00631}00631                            << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00632}00632       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00633}00633                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00634}00634                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00635}00635     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00636}00636     \textcolor{comment}{// check that x is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00637}00637     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distributed())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00638}00638     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00639}00639       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00640}00640       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00641}00641         << \textcolor{stringliteral}{"{}The x vector cannot be distributed for CCDoubleMatrix "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00642}00642         << \textcolor{stringliteral}{"{}matrix-\/vector multiply"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00643}00643       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00644}00644                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00645}00645                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00646}00646     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00647}00647     \textcolor{comment}{// if soln is setup...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00648}00648     \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00649}00649     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00650}00650       \textcolor{comment}{// check that soln is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00651}00651       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00652}00652       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00653}00653         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00654}00654         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00655}00655           << \textcolor{stringliteral}{"{}The x vector cannot be distributed for CCDoubleMatrix "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00656}00656           << \textcolor{stringliteral}{"{}matrix-\/vector multiply"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00657}00657         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00658}00658                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00659}00659                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00660}00660       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00661}00661       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != this-\/>nrow())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00662}00662       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00663}00663         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00664}00664         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00665}00665           << \textcolor{stringliteral}{"{}The soln vector is setup and therefore must have the same "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00666}00666           << \textcolor{stringliteral}{"{}number of rows as the matrix"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00667}00667         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00668}00668                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00669}00669                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00670}00670       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00671}00671       \textcolor{keywordflow}{if} (*soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}() !=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00672}00672           *\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00673}00673       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00674}00674         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00675}00675         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00676}00676           << \textcolor{stringliteral}{"{}The soln vector and the x vector must have the same communicator"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00677}00677           << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00678}00678         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00679}00679                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00680}00680                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00681}00681       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00682}00682     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00683}00683 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00684}00684 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00685}00685     \textcolor{comment}{// if soln is not setup then setup the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00686}00686     \textcolor{keywordflow}{if} (!soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00687}00687     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00688}00688       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00689}00689         \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt(), this-\/>nrow(), \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00690}00690       soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00691}00691       \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00692}00692     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00693}00693 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00694}00694     \textcolor{comment}{// zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00695}00695     soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00696}00696 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00697}00697     \textcolor{comment}{// multiply}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00698}00698     \textcolor{keywordtype}{double}* soln\_pt = soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00699}00699     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* x\_pt = \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.values\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00700}00700     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = 0; j < \mbox{\hyperlink{classoomph_1_1SparseMatrix_a8f15f962605f52fc75e8679efc6c8677}{N}}; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00701}00701     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00702}00702       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} k = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[j]; k < \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[j + 1]; k++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00703}00703       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00704}00704         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00705}00705         \textcolor{keywordtype}{double} a\_ij = \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00706}00706         soln\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += a\_ij * x\_pt[j];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00707}00707       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00708}00708     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00709}00709   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00710}00710 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00711}00711 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00712}00712   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00713}00713 \textcolor{comment}{  /// Multiply the  transposed matrix by the vector x: soln=A\string^T x}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00714}00714 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00715}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_a582352912b0a7e097f9ac31c5054beed}{00715}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_a582352912b0a7e097f9ac31c5054beed}{CCDoubleMatrix::multiply\_transpose}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00716}00716                                           \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& soln)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00717}00717 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00718}00718 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00719}00719     \textcolor{comment}{// Check to see if x.size() = ncol().}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00720}00720     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.nrow() != this-\/>nrow())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00721}00721     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00722}00722       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00723}00723       error\_message\_stream << \textcolor{stringliteral}{"{}The x vector is not the right size. It is "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00724}00724                            << \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.nrow() << \textcolor{stringliteral}{"{}, it should be "{}} << this-\/>\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_ab541153fa5ab2c1bc18e5339bacadfb9}{nrow}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00725}00725                            << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00726}00726       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00727}00727                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00728}00728                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00729}00729     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00730}00730     \textcolor{comment}{// check that x is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00731}00731     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distributed())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00732}00732     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00733}00733       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00734}00734       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00735}00735         << \textcolor{stringliteral}{"{}The x vector cannot be distributed for CCDoubleMatrix "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00736}00736         << \textcolor{stringliteral}{"{}matrix-\/vector multiply"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00737}00737       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00738}00738                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00739}00739                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00740}00740     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00741}00741     \textcolor{comment}{// if soln is setup...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00742}00742     \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00743}00743     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00744}00744       \textcolor{comment}{// check that soln is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00745}00745       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00746}00746       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00747}00747         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00748}00748         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00749}00749           << \textcolor{stringliteral}{"{}The x vector cannot be distributed for CCDoubleMatrix "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00750}00750           << \textcolor{stringliteral}{"{}matrix-\/vector multiply"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00751}00751         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00752}00752                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00753}00753                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00754}00754       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00755}00755       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != this-\/>ncol())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00756}00756       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00757}00757         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00758}00758         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00759}00759           << \textcolor{stringliteral}{"{}The soln vector is setup and therefore must have the same "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00760}00760           << \textcolor{stringliteral}{"{}number of columns as the matrix"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00761}00761         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00762}00762                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00763}00763                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00764}00764       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00765}00765       \textcolor{keywordflow}{if} (*soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}() !=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00766}00766           *\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00767}00767       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00768}00768         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00769}00769         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00770}00770           << \textcolor{stringliteral}{"{}The soln vector and the x vector must have the same communicator"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00771}00771           << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00772}00772         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00773}00773                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00774}00774                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00775}00775       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00776}00776     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00777}00777 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00778}00778 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00779}00779     \textcolor{comment}{// if soln is not setup then setup the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00780}00780     \textcolor{keywordflow}{if} (!soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00781}00781     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00782}00782       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00783}00783         \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt(), this-\/>ncol(), \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00784}00784       soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00785}00785       \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00786}00786     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00787}00787 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00788}00788     \textcolor{comment}{// zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00789}00789     soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00790}00790 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00791}00791     \textcolor{comment}{// Matrix vector product}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00792}00792     \textcolor{keywordtype}{double}* soln\_pt = soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00793}00793     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* x\_pt = \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.values\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00794}00794     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1SparseMatrix_a8f15f962605f52fc75e8679efc6c8677}{N}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00795}00795     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00796}00796       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} k = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; k < \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]; k++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00797}00797       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00798}00798         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00799}00799         \textcolor{keywordtype}{double} a\_ij = \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00800}00800         soln\_pt[j] += a\_ij * x\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00801}00801       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00802}00802     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00803}00803   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00804}00804 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00805}00805 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00806}00806   \textcolor{comment}{//===========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00807}00807 \textcolor{comment}{  /// Function to multiply this matrix by the CCDoubleMatrix matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00808}00808 \textcolor{comment}{  /// The multiplication method used can be selected using the flag}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00809}00809 \textcolor{comment}{  /// Matrix\_matrix\_multiply\_method. By default Method 2 is used.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00810}00810 \textcolor{comment}{  /// Method 1: First runs through this matrix and matrix\_in to find the storage}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00811}00811 \textcolor{comment}{  ///           requirements for result -\/ arrays of the correct size are}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00812}00812 \textcolor{comment}{  ///           then allocated before performing the calculation.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00813}00813 \textcolor{comment}{  ///           Minimises memory requirements but more costly.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00814}00814 \textcolor{comment}{  /// Method 2: Grows storage for values and column indices of result 'on the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00815}00815 \textcolor{comment}{  ///           fly' using an array of maps. Faster but more memory}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00816}00816 \textcolor{comment}{  ///           intensive.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00817}00817 \textcolor{comment}{  /// Method 3: Grows storage for values and column indices of result 'on the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00818}00818 \textcolor{comment}{  ///           fly' using a vector of vectors. Not particularly impressive}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00819}00819 \textcolor{comment}{  ///           on the platforms we tried...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00820}00820 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00821}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_ae6834fcfc28dca27243ec53ea48d34be}{00821}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_add24c25e344b84fb5b732e294af5e8b2}{CCDoubleMatrix::multiply}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix}{CCDoubleMatrix}}\& matrix\_in,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00822}00822                                 \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix}{CCDoubleMatrix}}\& result)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00823}00823   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00824}00824 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00825}00825     \textcolor{comment}{// check matrix dimensions are compatible}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00826}00826     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_aa38cc544ab30f9318161763e13c20957}{ncol}}() != matrix\_in.\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_ab541153fa5ab2c1bc18e5339bacadfb9}{nrow}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00827}00827     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00828}00828       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00829}00829       error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00830}00830         << \textcolor{stringliteral}{"{}Matrix dimensions incompatable for matrix-\/matrix multiplication"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00831}00831         << \textcolor{stringliteral}{"{}ncol() for first matrix:"{}} << this-\/>\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_aa38cc544ab30f9318161763e13c20957}{ncol}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00832}00832         << \textcolor{stringliteral}{"{}nrow() for second matrix: "{}} << matrix\_in.\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_ab541153fa5ab2c1bc18e5339bacadfb9}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00833}00833 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00834}00834       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00835}00835         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00836}00836     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00837}00837 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00838}00838 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00839}00839     \textcolor{comment}{// NB N is number of rows!}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00840}00840     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1SparseMatrix_a8f15f962605f52fc75e8679efc6c8677}{N}} = this-\/>\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_ab541153fa5ab2c1bc18e5339bacadfb9}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00841}00841     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}} = matrix\_in.\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_aa38cc544ab30f9318161763e13c20957}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00842}00842     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}} = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00843}00843 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00844}00844     \textcolor{comment}{// pointers to arrays which store result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00845}00845     \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00846}00846     \textcolor{keywordtype}{double}* \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00847}00847     \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00848}00848 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00849}00849     \textcolor{comment}{// get pointers to matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00850}00850     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* matrix\_in\_col\_start = matrix\_in.\mbox{\hyperlink{classoomph_1_1CCMatrix_a9cf931b97d5e6f57ae6dd7d03727dbdd}{column\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00851}00851     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* matrix\_in\_row\_index = matrix\_in.\mbox{\hyperlink{classoomph_1_1CCMatrix_ae72bd1ac1b78c2433197587b499a0d62}{row\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00852}00852     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* matrix\_in\_value = matrix\_in.\mbox{\hyperlink{classoomph_1_1SparseMatrix_a7a5b585410f9b23da6f269faa4a1db72}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00853}00853 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00854}00854     \textcolor{comment}{// get pointers to this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00855}00855     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* this\_value = this-\/>\mbox{\hyperlink{classoomph_1_1SparseMatrix_a7a5b585410f9b23da6f269faa4a1db72}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00856}00856     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* this\_col\_start = this-\/>\mbox{\hyperlink{classoomph_1_1CCMatrix_a9cf931b97d5e6f57ae6dd7d03727dbdd}{column\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00857}00857     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* this\_row\_index = this-\/>\mbox{\hyperlink{classoomph_1_1CCMatrix_ae72bd1ac1b78c2433197587b499a0d62}{row\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00858}00858 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00859}00859     \textcolor{comment}{// set method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00860}00860     \textcolor{keywordtype}{unsigned} method = \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_afb1660974c8f6218c2a000c2d6c6d267}{Matrix\_matrix\_multiply\_method}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00861}00861 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00862}00862     \textcolor{comment}{// clock\_t clock1 = clock();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00863}00863 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00864}00864     \textcolor{comment}{// METHOD 1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00865}00865     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00866}00866     \textcolor{keywordflow}{if} (method == 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00867}00867     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00868}00868       \textcolor{comment}{// allocate storage for column starts}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00869}00869       \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}} = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00870}00870       \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00871}00871 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00872}00872       \textcolor{comment}{// a set to store number of non-\/zero rows in each column of result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00873}00873       std::set<unsigned> rows;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00874}00874 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00875}00875       \textcolor{comment}{// run through columns of this matrix and matrix\_in to find number of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00876}00876       \textcolor{comment}{// non-\/zero entries in each column of result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00877}00877       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_col = 0; this\_col < \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}; this\_col++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00878}00878       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00879}00879         \textcolor{comment}{// run through non-\/zeros in this\_col of this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00880}00880         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} this\_ptr = this\_col\_start[this\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00881}00881              this\_ptr < this\_col\_start[this\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00882}00882              this\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00883}00883         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00884}00884           \textcolor{comment}{// find row index for non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00885}00885           \textcolor{keywordtype}{unsigned} matrix\_in\_col = this\_row\_index[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00886}00886 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00887}00887           \textcolor{comment}{// run through corresponding column in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00888}00888           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} matrix\_in\_ptr = matrix\_in\_col\_start[matrix\_in\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00889}00889                matrix\_in\_ptr < matrix\_in\_col\_start[matrix\_in\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00890}00890                matrix\_in\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00891}00891           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00892}00892             \textcolor{comment}{// find row index for non-\/zero in matrix\_in and store in rows}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00893}00893             rows.insert(matrix\_in\_row\_index[matrix\_in\_ptr]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00894}00894           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00895}00895         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00896}00896         \textcolor{comment}{// update Column\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00897}00897         \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[this\_col + 1] = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[this\_col] + rows.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00898}00898 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00899}00899         \textcolor{comment}{// wipe values in rows}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00900}00900         rows.clear();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00901}00901       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00902}00902 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00903}00903       \textcolor{comment}{// set Nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00904}00904       \mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}} = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00905}00905 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00906}00906       \textcolor{comment}{// allocate arrays for result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00907}00907       \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}} = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00908}00908       \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}} = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00909}00909 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00910}00910       \textcolor{comment}{// set all values of Row\_index to -\/1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00911}00911       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++) \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = -\/1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00912}00912 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00913}00913       \textcolor{comment}{// Calculate values for result -\/ first run through columns of this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00914}00914       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_col = 0; this\_col < \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}; this\_col++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00915}00915       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00916}00916         \textcolor{comment}{// run through non-\/zeros in this\_column}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00917}00917         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} this\_ptr = this\_col\_start[this\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00918}00918              this\_ptr < this\_col\_start[this\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00919}00919              this\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00920}00920         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00921}00921           \textcolor{comment}{// find value of non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00922}00922           \textcolor{keywordtype}{double} this\_val = this\_value[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00923}00923 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00924}00924           \textcolor{comment}{// find row associated with non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00925}00925           \textcolor{keywordtype}{unsigned} matrix\_in\_col = this\_row\_index[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00926}00926 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00927}00927           \textcolor{comment}{// run through corresponding column in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00928}00928           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} matrix\_in\_ptr = matrix\_in\_col\_start[matrix\_in\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00929}00929                matrix\_in\_ptr < matrix\_in\_col\_start[matrix\_in\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00930}00930                matrix\_in\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00931}00931           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00932}00932             \textcolor{comment}{// find row index for non-\/zero in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00933}00933             \textcolor{keywordtype}{int} row = matrix\_in\_row\_index[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00934}00934 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00935}00935             \textcolor{comment}{// find position in result to insert value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00936}00936             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ptr = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[this\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00937}00937                  ptr <= \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[this\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00938}00938                  ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00939}00939             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00940}00940               \textcolor{keywordflow}{if} (ptr == \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[this\_col + 1])}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00941}00941               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00942}00942                 \textcolor{comment}{// error -\/ have passed end of column without finding}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00943}00943                 \textcolor{comment}{// correct row index}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00944}00944                 std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00945}00945                 error\_message << \textcolor{stringliteral}{"{}Error inserting value in result"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00946}00946 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00947}00947                 \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00948}00948                                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00949}00949                                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00950}00950               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00951}00951               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[ptr] == -\/1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00952}00952               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00953}00953                 \textcolor{comment}{// first entry for this row index}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00954}00954                 \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[ptr] = row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00955}00955                 \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[ptr] = this\_val * matrix\_in\_value[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00956}00956                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00957}00957               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00958}00958               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[ptr] == row)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00959}00959               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00960}00960                 \textcolor{comment}{// row index already exists -\/ add value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00961}00961                 \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[ptr] += this\_val * matrix\_in\_value[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00962}00962                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00963}00963               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00964}00964             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00965}00965           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00966}00966         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00967}00967       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00968}00968     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00969}00969 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00970}00970     \textcolor{comment}{// METHOD 2}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00971}00971     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00972}00972     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (method == 2)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00973}00973     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00974}00974       \textcolor{comment}{// generate array of maps to store values for result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00975}00975       std::map<int, double>* result\_maps = \textcolor{keyword}{new} std::map<int, double>[\mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00976}00976 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00977}00977       \textcolor{comment}{// run through columns of this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00978}00978       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_col = 0; this\_col < \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}; this\_col++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00979}00979       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00980}00980         \textcolor{comment}{// run through non-\/zeros in this\_col}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00981}00981         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} this\_ptr = this\_col\_start[this\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00982}00982              this\_ptr < this\_col\_start[this\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00983}00983              this\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00984}00984         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00985}00985           \textcolor{comment}{// find value of non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00986}00986           \textcolor{keywordtype}{double} this\_val = this\_value[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00987}00987 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00988}00988           \textcolor{comment}{// find row index associated with non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00989}00989           \textcolor{keywordtype}{unsigned} matrix\_in\_col = this\_row\_index[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00990}00990 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00991}00991           \textcolor{comment}{// run through corresponding column in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00992}00992           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} matrix\_in\_ptr = matrix\_in\_col\_start[matrix\_in\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00993}00993                matrix\_in\_ptr < matrix\_in\_col\_start[matrix\_in\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00994}00994                matrix\_in\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00995}00995           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00996}00996             \textcolor{comment}{// find row index for non-\/zero in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00997}00997             \textcolor{keywordtype}{int} row = matrix\_in\_row\_index[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00998}00998 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l00999}00999             \textcolor{comment}{// insert value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01000}01000             result\_maps[this\_col][row] +=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01001}01001               this\_val * matrix\_in\_value[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01002}01002           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01003}01003         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01004}01004       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01005}01005 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01006}01006       \textcolor{comment}{// allocate Column\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01007}01007       \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}} = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01008}01008 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01009}01009       \textcolor{comment}{// copy across column starts}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01010}01010       \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01011}01011       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} col = 0; col < \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}; col++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01012}01012       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01013}01013         \textcolor{keywordtype}{int} size = result\_maps[col].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01014}01014         \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[col + 1] = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[col] + size;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01015}01015       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01016}01016 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01017}01017       \textcolor{comment}{// set Nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01018}01018       \mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}} = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01019}01019 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01020}01020       \textcolor{comment}{// allocate other arrays}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01021}01021       \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}} = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01022}01022       \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}} = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01023}01023 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01024}01024       \textcolor{comment}{// copy values and row indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01025}01025       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} col = 0; col < \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}; col++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01026}01026       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01027}01027         \textcolor{keywordtype}{unsigned} ptr = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01028}01028         \textcolor{keywordflow}{for} (std::map<int, double>::iterator \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = result\_maps[col].begin();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01029}01029              \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} != result\_maps[col].end();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01030}01030              \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01031}01031         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01032}01032           \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[ptr] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}-\/>first;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01033}01033           \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[ptr] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}-\/>second;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01034}01034           ptr++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01035}01035         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01036}01036       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01037}01037 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01038}01038       \textcolor{comment}{// tidy up memory}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01039}01039       \textcolor{keyword}{delete}[] result\_maps;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01040}01040     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01041}01041 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01042}01042     \textcolor{comment}{// METHOD 3}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01043}01043     \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01044}01044     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (method == 3)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01045}01045     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01046}01046       \textcolor{comment}{// vectors of vectors to store results}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01047}01047       std::vector<std::vector<int>> result\_rows(\mbox{\hyperlink{classoomph_1_1SparseMatrix_a8f15f962605f52fc75e8679efc6c8677}{N}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01048}01048       std::vector<std::vector<double>> result\_vals(\mbox{\hyperlink{classoomph_1_1SparseMatrix_a8f15f962605f52fc75e8679efc6c8677}{N}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01049}01049 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01050}01050       \textcolor{comment}{// run through the columns of this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01051}01051       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_col = 0; this\_col < \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}; this\_col++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01052}01052       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01053}01053         \textcolor{comment}{// run through non-\/zeros in this\_col}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01054}01054         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} this\_ptr = this\_col\_start[this\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01055}01055              this\_ptr < this\_col\_start[this\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01056}01056              this\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01057}01057         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01058}01058           \textcolor{comment}{// find value of non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01059}01059           \textcolor{keywordtype}{double} this\_val = this\_value[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01060}01060 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01061}01061           \textcolor{comment}{// find row index associated with non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01062}01062           \textcolor{keywordtype}{unsigned} matrix\_in\_col = this\_row\_index[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01063}01063 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01064}01064           \textcolor{comment}{// run through corresponding column in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01065}01065           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} matrix\_in\_ptr = matrix\_in\_col\_start[matrix\_in\_col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01066}01066                matrix\_in\_ptr < matrix\_in\_col\_start[matrix\_in\_col + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01067}01067                matrix\_in\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01068}01068           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01069}01069             \textcolor{comment}{// find row index for non-\/zero in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01070}01070             \textcolor{keywordtype}{int} row = matrix\_in\_row\_index[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01071}01071 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01072}01072             \textcolor{comment}{// insert value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01073}01073             \textcolor{keywordtype}{int} size = result\_rows[this\_col].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01074}01074             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} <= size; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01075}01075             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01076}01076               \textcolor{keywordflow}{if} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} == size)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01077}01077               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01078}01078                 \textcolor{comment}{// first entry for this row index}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01079}01079                 result\_rows[this\_col].push\_back(row);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01080}01080                 result\_vals[this\_col].push\_back(this\_val *}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01081}01081                                                 matrix\_in\_value[matrix\_in\_ptr]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01082}01082               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01083}01083               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (row == result\_rows[this\_col][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01084}01084               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01085}01085                 \textcolor{comment}{// row index already exists}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01086}01086                 result\_vals[this\_col][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01087}01087                   this\_val * matrix\_in\_value[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01088}01088                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01089}01089               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01090}01090             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01091}01091           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01092}01092         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01093}01093       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01094}01094 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01095}01095       \textcolor{comment}{// allocate Column\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01096}01096       \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}} = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01097}01097 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01098}01098       \textcolor{comment}{// copy across column starts}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01099}01099       \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01100}01100       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} col = 0; col < \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}; col++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01101}01101       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01102}01102         \textcolor{keywordtype}{int} size = result\_rows[col].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01103}01103         \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[col + 1] = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[col] + size;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01104}01104       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01105}01105 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01106}01106       \textcolor{comment}{// set Nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01107}01107       \mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}} = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01108}01108 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01109}01109       \textcolor{comment}{// allocate other arrays}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01110}01110       \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}} = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01111}01111       \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}} = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01112}01112 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01113}01113       \textcolor{comment}{// copy across values and row indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01114}01114       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} col = 0; col < \mbox{\hyperlink{classoomph_1_1SparseMatrix_a8f15f962605f52fc75e8679efc6c8677}{N}}; col++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01115}01115       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01116}01116         \textcolor{keywordtype}{unsigned} ptr = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[col];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01117}01117         \textcolor{keywordtype}{unsigned} n\_rows = result\_rows[col].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01118}01118         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_rows; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01119}01119         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01120}01120           \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[ptr] = result\_rows[col][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01121}01121           \mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[ptr] = result\_vals[col][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01122}01122           ptr++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01123}01123         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01124}01124       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01125}01125     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01126}01126 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01127}01127     \textcolor{comment}{// INCORRECT VALUE FOR METHOD}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01128}01128     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01129}01129     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01130}01130       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01131}01131       error\_message << \textcolor{stringliteral}{"{}Incorrect method set in matrix-\/matrix multiply"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01132}01132                     << \textcolor{stringliteral}{"{}method="{}} << method << \textcolor{stringliteral}{"{} not allowed"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01133}01133 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01134}01134       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01135}01135         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01136}01136     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01137}01137 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01138}01138     result.\mbox{\hyperlink{classoomph_1_1CCMatrix_a57eddb79a6a3af698a1c92196482335a}{build\_without\_copy}}(\mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}, \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}, \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}, \mbox{\hyperlink{classoomph_1_1SparseMatrix_a1459cbaeec275fe95ba45f7d843b26a5}{Nnz}}, \mbox{\hyperlink{classoomph_1_1SparseMatrix_a8f15f962605f52fc75e8679efc6c8677}{N}}, \mbox{\hyperlink{classoomph_1_1SparseMatrix_ae558ff039363bd2aa163525442090508}{M}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01139}01139   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01140}01140 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01141}01141 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01142}01142   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01143}01143 \textcolor{comment}{  /// For every row, find the maximum absolute value of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01144}01144 \textcolor{comment}{  /// entries in this row. Set all values that are less than alpha times}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01145}01145 \textcolor{comment}{  /// this maximum to zero and return the resulting matrix in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01146}01146 \textcolor{comment}{  /// reduced\_matrix. Note: Diagonal entries are retained regardless}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01147}01147 \textcolor{comment}{  /// of their size.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01148}01148 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01149}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_a600a58c92baf401a534598cedcfd3415}{01149}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_a600a58c92baf401a534598cedcfd3415}{CCDoubleMatrix::matrix\_reduction}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& alpha,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01150}01150                                         \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix}{CCDoubleMatrix}}\& reduced\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01151}01151   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01152}01152     \textcolor{comment}{// number of columns in matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01153}01153     \textcolor{keywordtype}{long} n\_coln = \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_aa38cc544ab30f9318161763e13c20957}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01154}01154 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01155}01155     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} max\_row(\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_ab541153fa5ab2c1bc18e5339bacadfb9}{nrow}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01156}01156 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01157}01157     \textcolor{comment}{// Here's the packed format for the new matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01158}01158     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} B\_row\_start(1);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01159}01159     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} B\_column\_index;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01160}01160     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} B\_value;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01161}01161 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01162}01162 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01163}01163     \textcolor{comment}{// k is counter for the number of entries in the reduced matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01164}01164     \textcolor{keywordtype}{unsigned} k = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01165}01165 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01166}01166     \textcolor{comment}{// Initialise row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01167}01167     B\_row\_start[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01168}01168 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01169}01169     \textcolor{comment}{// Loop over columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01170}01170     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_coln; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01171}01171     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01172}01172       \textcolor{comment}{// Loop over entries in columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01173}01173       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} j = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; j < \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01174}01174       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01175}01175         \textcolor{comment}{// Find max. value in row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01176}01176         \textcolor{keywordflow}{if} (std::fabs(\mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[j]) > max\_row[\mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[j]])}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01177}01177         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01178}01178           max\_row[\mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[j]] = std::fabs(\mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01179}01179         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01180}01180       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01181}01181 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01182}01182       \textcolor{comment}{// Decide if we need to retain the entries in the row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01183}01183       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} j = \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; j < \mbox{\hyperlink{classoomph_1_1CCMatrix_a6a38ae2bd1a69905375585d5b24c6136}{Column\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01184}01184       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01185}01185         \textcolor{comment}{// If we're on the diagonal or the value is sufficiently large: retain}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01186}01186         \textcolor{comment}{// i.e. copy across.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01187}01187         \textcolor{keywordflow}{if} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} == \mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[j] ||}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01188}01188             std::fabs(\mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[j]) > alpha * max\_row[\mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[j]])}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01189}01189         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01190}01190           B\_value.push\_back(\mbox{\hyperlink{classoomph_1_1SparseMatrix_a55b53c70fe3906a65d0f84c429e963b1}{Value}}[j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01191}01191           B\_column\_index.push\_back(\mbox{\hyperlink{classoomph_1_1CCMatrix_a7dba85934f3059d0163dda06f94ddf9b}{Row\_index}}[j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01192}01192           k++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01193}01193         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01194}01194       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01195}01195       \textcolor{comment}{// This writes the row start for the next row -\/-\/ equal to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01196}01196       \textcolor{comment}{// to the number of entries written so far (C++ zero-\/based indexing!)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01197}01197       B\_row\_start.push\_back(k);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01198}01198     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01199}01199 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01200}01200 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01201}01201     \textcolor{comment}{// Build the matrix from the compressed format}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01202}01202     \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CCDoubleMatrix}{CCDoubleMatrix}}\&\textcolor{keyword}{>}(reduced\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01203}01203       .\mbox{\hyperlink{classoomph_1_1CCMatrix_aa08192365e3c87357d1f7ca8131f03de}{build}}(B\_value, B\_column\_index, B\_row\_start, \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_ab541153fa5ab2c1bc18e5339bacadfb9}{nrow}}(), \mbox{\hyperlink{classoomph_1_1CCDoubleMatrix_aa38cc544ab30f9318161763e13c20957}{ncol}}());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01204}01204   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01205}01205 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01206}01206 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01207}01207 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01208}01208 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01209}01209 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01210}01210 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01211}01211   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01212}01212 \textcolor{comment}{  /// Default constructor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01213}01213 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01214}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad8914fa1a5a98f7602a1724b76eef26c}{01214}}   \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad8914fa1a5a98f7602a1724b76eef26c}{CRDoubleMatrix::CRDoubleMatrix}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01215}01215   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01216}01216     \textcolor{comment}{// set the default solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01217}01217     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01218}01218 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01219}01219     \textcolor{comment}{// matrix not built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01220}01220     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01221}01221 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01222}01222     \textcolor{comment}{// set the serial matrix-\/matrix multiply method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01223}01223 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRILINOS}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01224}01224     \textcolor{comment}{//    Serial\_matrix\_matrix\_multiply\_method = 4;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01225}01225     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01226}01226 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01227}01227     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01228}01228 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01229}01229   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01230}01230 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01231}01231   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01232}01232 \textcolor{comment}{  /// Copy constructor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01233}01233 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01234}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af88437afe2b838fd6b508c590d26bd26}{01234}}   \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad8914fa1a5a98f7602a1724b76eef26c}{CRDoubleMatrix::CRDoubleMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& other\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01235}01235   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01236}01236     \textcolor{comment}{// copy the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01237}01237     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(other\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01238}01238 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01239}01239     \textcolor{comment}{// copy coefficients}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01240}01240     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* values\_pt = other\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01241}01241     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* column\_indices = other\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01242}01242     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}} = other\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01243}01243 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01244}01244     \textcolor{comment}{// This is the local nnz.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01245}01245     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}} = other\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01246}01246 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01247}01247     \textcolor{comment}{// Using number of local rows since the underlying CRMatrix is local to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01248}01248     \textcolor{comment}{// each processor.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01249}01249     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} = other\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01250}01250 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01251}01251     \textcolor{comment}{// Storage for the (yet to be copied) data.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01252}01252     \textcolor{keywordtype}{double}* my\_values\_pt = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01253}01253     \textcolor{keywordtype}{int}* my\_column\_indices = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01254}01254     \textcolor{keywordtype}{int}* my\_row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01255}01255 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01256}01256     \textcolor{comment}{// Copying over the data.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01257}01257     std::copy(values\_pt, values\_pt + \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}, my\_values\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01258}01258     std::copy(column\_indices, column\_indices + \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}, my\_column\_indices);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01259}01259     std::copy(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}} + \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} + 1, my\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01260}01260 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01261}01261 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01262}01262     \textcolor{comment}{// Build without copy since we have made a deep copy of the data structure.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01263}01263     this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01264}01264       other\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}(), \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}, my\_values\_pt, my\_column\_indices, my\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01265}01265 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01266}01266     \textcolor{comment}{// set the default solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01267}01267     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01268}01268 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01269}01269     \textcolor{comment}{// matrix is built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01270}01270     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01271}01271 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01272}01272     \textcolor{comment}{// set the serial matrix-\/matrix multiply method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01273}01273 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRILINOS}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01274}01274     \textcolor{comment}{// Serial\_matrix\_matrix\_multiply\_method = 4;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01275}01275     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01276}01276 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01277}01277     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01278}01278 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01279}01279   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01280}01280 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01281}01281 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01282}01282   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01283}01283 \textcolor{comment}{  /// Constructor: just stores the distribution but does not build the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01284}01284 \textcolor{comment}{  /// matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01285}01285 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01286}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a80b1f351988b2a7c0bd39387c77b85f3}{01286}}   \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad8914fa1a5a98f7602a1724b76eef26c}{CRDoubleMatrix::CRDoubleMatrix}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01287}01287     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* distribution\_pt)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01288}01288   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01289}01289     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(distribution\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01290}01290 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01291}01291     \textcolor{comment}{// set the default solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01292}01292     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01293}01293 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01294}01294     \textcolor{comment}{// matrix not built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01295}01295     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01296}01296 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01297}01297 \textcolor{comment}{// set the serial matrix-\/matrix multiply method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01298}01298 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRILINOS}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01299}01299     \textcolor{comment}{//    Serial\_matrix\_matrix\_multiply\_method = 4;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01300}01300     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01301}01301 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01302}01302     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01303}01303 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01304}01304   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01305}01305 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01306}01306   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01307}01307 \textcolor{comment}{  /// Constructor: Takes the distribution and the number of columns, as}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01308}01308 \textcolor{comment}{  /// well as the vector of values, vector of column indices,vector of row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01309}01309 \textcolor{comment}{  /// starts.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01310}01310 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01311}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a1f1ffece5cbd2d25d46fe3db3b9c3ff5}{01311}}   \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad8914fa1a5a98f7602a1724b76eef26c}{CRDoubleMatrix::CRDoubleMatrix}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01312}01312                                  \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ncol,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01313}01313                                  \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01314}01314                                  \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& column\_index,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01315}01315                                  \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& row\_start)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01316}01316   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01317}01317     \textcolor{comment}{// build the compressed row matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01318}01318     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.build(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01319}01319       \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}, dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(), \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01320}01320 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01321}01321     \textcolor{comment}{// store the Distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01322}01322     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01323}01323 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01324}01324     \textcolor{comment}{// set the linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01325}01325     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} = \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01326}01326 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01327}01327     \textcolor{comment}{// set the serial matrix-\/matrix multiply method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01328}01328 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRILINOS}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01329}01329     \textcolor{comment}{// Serial\_matrix\_matrix\_multiply\_method = 4;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01330}01330     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01331}01331 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01332}01332     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}} = 2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01333}01333 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01334}01334 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01335}01335     \textcolor{comment}{// matrix has been built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01336}01336     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01337}01337   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01338}01338 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01339}01339 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01340}01340   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01341}01341 \textcolor{comment}{  /// Destructor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01342}01342 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01343}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a27c30b4faf3d2328f3b9ce9c590f43a4}{01343}}   \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a27c30b4faf3d2328f3b9ce9c590f43a4}{CRDoubleMatrix::\string~CRDoubleMatrix}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01344}01344   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01345}01345     this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a70c8a67158c081e70b4d07a6b248bc7a}{clear}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01346}01346     \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01347}01347     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01348}01348   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01349}01349 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01350}01350   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01351}01351 \textcolor{comment}{  /// Rebuild the matrix -\/ assembles an empty matrix with a defined distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01352}01352 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01353}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a7fc397b91a7289df8ee64287ae20e132}{01353}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{CRDoubleMatrix::build}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* distribution\_pt)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01354}01354   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01355}01355     this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a70c8a67158c081e70b4d07a6b248bc7a}{clear}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01356}01356     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(distribution\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01357}01357   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01358}01358 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01359}01359   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01360}01360 \textcolor{comment}{  /// Runs through the column index vector and checks if the entries}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01361}01361 \textcolor{comment}{  /// are arranged arbitrarily or if they follow the regular lexicographical}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01362}01362 \textcolor{comment}{  /// of matrices. If a boolean argument is provided with the assignment}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01363}01363 \textcolor{comment}{  /// TRUE then information on the first entry which is not in the correct}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01364}01364 \textcolor{comment}{  /// position will also be given}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01365}01365 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01366}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ae35fbae1702bbf75601c2a1026df103e}{01366}}   \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ae35fbae1702bbf75601c2a1026df103e}{CRDoubleMatrix::entries\_are\_sorted}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01367}01367     \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& doc\_unordered\_entries)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01368}01368 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01369}01369 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01370}01370     \textcolor{comment}{// We only need to produce a warning if the matrix is distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01371}01371     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01372}01372     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01373}01373       \textcolor{comment}{// Create an ostringstream object to store the warning message}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01374}01374       std::ostringstream warning\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01375}01375 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01376}01376       \textcolor{comment}{// Create the warning messsage}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01377}01377       warning\_message << \textcolor{stringliteral}{"{}This method currently works for serial but "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01378}01378                       << \textcolor{stringliteral}{"{}has not been implemented for use with MPI!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01379}01379 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01380}01380       \textcolor{comment}{// Issue the warning}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01381}01381       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warning\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01382}01382                       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01383}01383                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01384}01384     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01385}01385 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01386}01386 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01387}01387     \textcolor{comment}{// Get the number of rows in this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01388}01388     \textcolor{keywordtype}{unsigned} n\_rows = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01389}01389 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01390}01390     \textcolor{comment}{// Acquire access to the value, row\_start and column\_index arrays from}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01391}01391     \textcolor{comment}{// the CR matrix. Since we do not change anything in row\_start\_pt we}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01392}01392     \textcolor{comment}{// give it the const prefix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01393}01393     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* column\_index\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01394}01394     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* row\_start\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01395}01395 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01396}01396     \textcolor{comment}{// Loop over the rows of matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01397}01397     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_rows; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01398}01398     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01399}01399       \textcolor{comment}{// Calculate the number of nonzeros in the i-\/th row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01400}01400       \textcolor{keywordtype}{unsigned} nnz\_row\_i = *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1) -\/ *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01401}01401 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01402}01402       \textcolor{comment}{// Get the index of the first entry in row i}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01403}01403       \textcolor{keywordtype}{unsigned} i\_row\_start = *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01404}01404 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01405}01405       \textcolor{comment}{// Loop over the entries of the i-\/th row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01406}01406       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnz\_row\_i -\/ 1; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01407}01407       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01408}01408         \textcolor{comment}{// Check if the column index of the following entry is greater than the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01409}01409         \textcolor{comment}{// current entry}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01410}01410         \textcolor{keywordflow}{if} ((*(column\_index\_pt + i\_row\_start + j + 1)) <}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01411}01411             (*(column\_index\_pt + i\_row\_start + j)))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01412}01412         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01413}01413           \textcolor{comment}{// If the input argument was set to TRUE we document we output}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01414}01414           \textcolor{comment}{// information of the first entry which is not in the correct position}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01415}01415           \textcolor{keywordflow}{if} (doc\_unordered\_entries)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01416}01416           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01417}01417             \textcolor{comment}{// Tell the user}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01418}01418             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Matrix has not been correctly sorted!"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01419}01419                        << \textcolor{stringliteral}{"{}\(\backslash\)nOn row: "{}} << \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} << \textcolor{stringliteral}{"{}\(\backslash\)nEntry: "{}} << j}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01420}01420                        << \textcolor{stringliteral}{"{}\(\backslash\)nEntry 1 = "{}} << *(column\_index\_pt + i\_row\_start + j)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01421}01421                        << \textcolor{stringliteral}{"{}\(\backslash\)nEntry 2 = "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01422}01422                        << *(column\_index\_pt + i\_row\_start + j + 1) << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01423}01423           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01424}01424 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01425}01425           \textcolor{comment}{// It hasn't worked}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01426}01426           \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01427}01427         \} \textcolor{comment}{// if ((*(column\_index\_pt+i\_row\_start+j+1)) ...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01428}01428       \} \textcolor{comment}{// for (unsigned j=0;j<nnz\_row\_i-\/1;j++)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01429}01429     \} \textcolor{comment}{// for (unsigned i=0;i<n\_rows;i++)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01430}01430 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01431}01431     \textcolor{comment}{// If it gets here without a warning then the entries in each row of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01432}01432     \textcolor{comment}{// the matrix are ordered by increasing column index}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01433}01433     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01434}01434   \} \textcolor{comment}{// End of entries\_are\_sorted()}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01435}01435 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01436}01436   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01437}01437 \textcolor{comment}{  /// This helper function sorts the entries in the column index vector}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01438}01438 \textcolor{comment}{  /// and the value vector. During the construction of the matrix the entries}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01439}01439 \textcolor{comment}{  /// were most likely assigned in an arbitrary order. As a result, it cannot}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01440}01440 \textcolor{comment}{  /// be assumed that the entries in the column index vector corresponding to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01441}01441 \textcolor{comment}{  /// each row of the matrix have been arranged in increasing order. During}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01442}01442 \textcolor{comment}{  /// the setup an additional vector will be set up; Index\_of\_diagonal\_entries.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01443}01443 \textcolor{comment}{  /// The i-\/th entry of this vector contains the index of the last entry}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01444}01444 \textcolor{comment}{  /// below or on the diagonal. If there are no entries below or on the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01445}01445 \textcolor{comment}{  /// diagonal then the corresponding entry is -\/1. If, however, there are}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01446}01446 \textcolor{comment}{  /// no entries in the row then the entry is irrelevant and is kept}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01447}01447 \textcolor{comment}{  /// as the initialised value; 0.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01448}01448 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01449}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a2107875787d4dfa1cf007c05a041b078}{01449}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a2107875787d4dfa1cf007c05a041b078}{CRDoubleMatrix::sort\_entries}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01450}01450   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01451}01451 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01452}01452     \textcolor{comment}{// We only need to produce a warning if the matrix is distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01453}01453     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01454}01454     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01455}01455       \textcolor{comment}{// Create an ostringstream object to store the warning message}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01456}01456       std::ostringstream warning\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01457}01457 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01458}01458       \textcolor{comment}{// Create the warning messsage}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01459}01459       warning\_message << \textcolor{stringliteral}{"{}This method currently works for serial but "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01460}01460                       << \textcolor{stringliteral}{"{}has not been tested with MPI!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01461}01461 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01462}01462       \textcolor{comment}{// Issue the warning}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01463}01463       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warning\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01464}01464                       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01465}01465                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01466}01466     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01467}01467 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01468}01468 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01469}01469     \textcolor{comment}{// Get the number of rows in the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01470}01470     \textcolor{keywordtype}{unsigned} n\_rows = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01471}01471 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01472}01472     \textcolor{comment}{// Acquire access to the value, row\_start and column\_index arrays from}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01473}01473     \textcolor{comment}{// the CR matrix. Since we do not change anything in row\_start\_pt we}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01474}01474     \textcolor{comment}{// give it the const prefix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01475}01475     \textcolor{keywordtype}{double}* value\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01476}01476     \textcolor{keywordtype}{int}* column\_index\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01477}01477     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* row\_start\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01478}01478 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01479}01479     \textcolor{comment}{// Resize the Index\_of\_diagonal\_entries vector}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01480}01480     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cb9860ebacf742fc7fc47d77703cc82}{Index\_of\_diagonal\_entries}}.resize(n\_rows, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01481}01481 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01482}01482     \textcolor{comment}{// Vector of pairs to store the column\_index of each value in the i-\/th row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01483}01483     \textcolor{comment}{// and its corresponding matrix entry}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01484}01484     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::pair<int, double>}}> column\_index\_and\_value\_row\_i;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01485}01485 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01486}01486     \textcolor{comment}{// Loop over the rows of the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01487}01487     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_rows; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01488}01488     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01489}01489       \textcolor{comment}{// Find the number of nonzeros in the i-\/th row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01490}01490       \textcolor{keywordtype}{unsigned} nnz\_row\_i = *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1) -\/ *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01491}01491 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01492}01492       \textcolor{comment}{// Variable to store the start of the i-\/th row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01493}01493       \textcolor{keywordtype}{unsigned} i\_row\_start = *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01494}01494 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01495}01495       \textcolor{comment}{// If there are no nonzeros in this row then the i-\/th entry of the vector}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01496}01496       \textcolor{comment}{// Index\_of\_diagonal\_entries is irrelevant so we can simply let it be 0}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01497}01497       \textcolor{keywordflow}{if} (nnz\_row\_i == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01498}01498       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01499}01499         \textcolor{comment}{// Set the i-\/th entry}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01500}01500         \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cb9860ebacf742fc7fc47d77703cc82}{Index\_of\_diagonal\_entries}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01501}01501       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01502}01502       \textcolor{comment}{// If there are nonzeros in the i-\/th row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01503}01503       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01504}01504       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01505}01505         \textcolor{comment}{// If there is more than one entry in the row resize the vector}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01506}01506         \textcolor{comment}{// column\_index\_and\_value\_row\_i}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01507}01507         column\_index\_and\_value\_row\_i.resize(nnz\_row\_i);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01508}01508 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01509}01509         \textcolor{comment}{// Loop over the entries in the row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01510}01510         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnz\_row\_i; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01511}01511         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01512}01512           \textcolor{comment}{// Assign the appropriate entries to column\_index\_and\_value\_row\_i}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01513}01513           column\_index\_and\_value\_row\_i[j] =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01514}01514             std::make\_pair(*(column\_index\_pt + i\_row\_start + j),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01515}01515                            *(value\_pt + i\_row\_start + j));}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01516}01516         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01517}01517 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01518}01518         \textcolor{comment}{// Sort the vector of pairs using the struct}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01519}01519         \textcolor{comment}{// CRDoubleMatrixComparisonHelper}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01520}01520         std::sort(column\_index\_and\_value\_row\_i.begin(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01521}01521                   column\_index\_and\_value\_row\_i.end(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01522}01522                   \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a37d76ad3814e127802b80e1e274a3f15}{Comparison\_struct}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01523}01523 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01524}01524         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01525}01525         \textcolor{comment}{// Now that the entries of the i-\/th row have been sorted we can read}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01526}01526         \textcolor{comment}{// them back into value\_pt and column\_index\_pt:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01527}01527         \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01528}01528 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01529}01529         \textcolor{comment}{// Create a boolean variable to indicate whether or not the i-\/th entry}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01530}01530         \textcolor{comment}{// of Index\_of\_diagonal\_entries has been set}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01531}01531         \textcolor{keywordtype}{bool} is\_ith\_entry\_set = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01532}01532 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01533}01533         \textcolor{comment}{// Loop over the entries in the vector column\_index\_and\_value\_row\_i and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01534}01534         \textcolor{comment}{// assign its entries to value\_pt and column\_index\_pt}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01535}01535         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nnz\_row\_i; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01536}01536         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01537}01537           \textcolor{comment}{// Set the column index of the j-\/th nonzero value in the i-\/th row of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01538}01538           \textcolor{comment}{// the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01539}01539           *(column\_index\_pt + i\_row\_start + j) =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01540}01540             column\_index\_and\_value\_row\_i[j].first;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01541}01541 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01542}01542           \textcolor{comment}{// Set the value of the j-\/th nonzero value in the i-\/th row of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01543}01543           \textcolor{comment}{// the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01544}01544           *(value\_pt + i\_row\_start + j) =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01545}01545             column\_index\_and\_value\_row\_i[j].second;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01546}01546 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01547}01547           \textcolor{comment}{// This if statement is used to set the i-\/th entry of the vector}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01548}01548           \textcolor{comment}{// Index\_of\_diagonal\_entries if it has not yet been set}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01549}01549           \textcolor{keywordflow}{if} (!is\_ith\_entry\_set)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01550}01550           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01551}01551             \textcolor{comment}{// If the column index of the first entry in row i is greater than}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01552}01552             \textcolor{comment}{// the row number then the first entry must lie above the diagonal}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01553}01553             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{unsigned}(*(column\_index\_pt + i\_row\_start)) > \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01554}01554             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01555}01555               \textcolor{comment}{// If the column index of the first entry in the row is greater}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01556}01556               \textcolor{comment}{// than the row number, i, then the i-\/th entry of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01557}01557               \textcolor{comment}{// Index\_of\_diagonal\_entries needs to be set to -\/1 to indicate}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01558}01558               \textcolor{comment}{// there are no entries below or on the diagonal}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01559}01559               \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cb9860ebacf742fc7fc47d77703cc82}{Index\_of\_diagonal\_entries}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = -\/1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01560}01560 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01561}01561               \textcolor{comment}{// Indicate that the i-\/th entry of Index\_of\_diagonal\_entries has}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01562}01562               \textcolor{comment}{// been set}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01563}01563               is\_ith\_entry\_set = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01564}01564             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01565}01565             \textcolor{comment}{// If there are entries below or on the diagonal}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01566}01566             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01567}01567             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01568}01568               \textcolor{comment}{// If there is only one entry in the row then we know that this}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01569}01569               \textcolor{comment}{// will be the last entry below or on the diagonal because we have}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01570}01570               \textcolor{comment}{// eliminated the possibility that if there is only one entry,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01571}01571               \textcolor{comment}{// that it lies above the diagonal}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01572}01572               \textcolor{keywordflow}{if} (nnz\_row\_i == 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01573}01573               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01574}01574                 \textcolor{comment}{// Set the index of the current entry to be the value of i-\/th}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01575}01575                 \textcolor{comment}{// entry of Index\_of\_diagonal\_entries}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01576}01576                 \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cb9860ebacf742fc7fc47d77703cc82}{Index\_of\_diagonal\_entries}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = i\_row\_start + j;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01577}01577 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01578}01578                 \textcolor{comment}{// Indicate that the i-\/th entry of Index\_of\_diagonal\_entries has}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01579}01579                 \textcolor{comment}{// been set}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01580}01580                 is\_ith\_entry\_set = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01581}01581               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01582}01582               \textcolor{comment}{// It remains to now check the case that there is more than one}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01583}01583               \textcolor{comment}{// entry in the row. If there is more than one entry in the row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01584}01584               \textcolor{comment}{// and there are entries below or on the diagonal then we have}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01585}01585               \textcolor{comment}{// three cases:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01586}01586               \textcolor{comment}{//          (1) The current entry lies on the diagonal;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01587}01587               \textcolor{comment}{//          (2) The current entry lies above the diagonal;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01588}01588               \textcolor{comment}{//          (3) The current entry lies below the diagonal;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01589}01589               \textcolor{comment}{// The first case can easily be checked as done below. If the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01590}01590               \textcolor{comment}{// second case occurs then we have just passed the last entry. We}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01591}01591               \textcolor{comment}{// know this because at least one entry lies on or below the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01592}01592               \textcolor{comment}{// diagonal. If the second case it true then we need to assign the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01593}01593               \textcolor{comment}{// previous entry to the vector Index\_of\_diagonal\_entries.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01594}01594               \textcolor{comment}{// Finally, we are left with case (3), which can be split into two}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01595}01595               \textcolor{comment}{// cases:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01596}01596               \textcolor{comment}{//          (3.1) The current entry lies below the diagonal but it}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01597}01597               \textcolor{comment}{//                is not the last entry below or on the diagonal;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01598}01598               \textcolor{comment}{//          (3.2) The current entry lies below the diagonal and is}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01599}01599               \textcolor{comment}{//                the last entry below or on the diagonal.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01600}01600               \textcolor{comment}{// If case (3.1) holds then we can simply wait until we get to the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01601}01601               \textcolor{comment}{// next entry in the row and examine that. If the next entry lies}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01602}01602               \textcolor{comment}{// on the diagonal then it will be swept up by case (1). If the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01603}01603               \textcolor{comment}{// next entry lies above the diagonal then case (2) will sweep it}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01604}01604               \textcolor{comment}{// up and if neither is the case then we wait until the next entry}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01605}01605               \textcolor{comment}{// and so on. If, instead, case (3.2) holds then our last check}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01606}01606               \textcolor{comment}{// simply needs to check if the current entry is the last entry in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01607}01607               \textcolor{comment}{// the row because if the last entry lies on the diagonal, case}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01608}01608               \textcolor{comment}{// (1) will sweep it up. If it lies above the diagonal, case (2)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01609}01609               \textcolor{comment}{// will take care of it. Therefore, the only remaining case is}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01610}01610               \textcolor{comment}{// that it lies strictly below the diagonal and since it is the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01611}01611               \textcolor{comment}{// last entry in the row it means the index of this entry needs to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01612}01612               \textcolor{comment}{// be assigned to Index\_of\_diagonal\_entries}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01613}01613 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01614}01614               \textcolor{comment}{// Case (1) : The current entry lies on the diagonal}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01615}01615               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\textcolor{keywordtype}{unsigned}(*(column\_index\_pt + i\_row\_start + j)) == \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01616}01616               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01617}01617                 \textcolor{comment}{// Set the index of the current entry to be the value of i-\/th}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01618}01618                 \textcolor{comment}{// entry of Index\_of\_diagonal\_entries}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01619}01619                 \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cb9860ebacf742fc7fc47d77703cc82}{Index\_of\_diagonal\_entries}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = i\_row\_start + j;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01620}01620 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01621}01621                 \textcolor{comment}{// Indicate that the i-\/th entry of Index\_of\_diagonal\_entries has}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01622}01622                 \textcolor{comment}{// been set}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01623}01623                 is\_ith\_entry\_set = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01624}01624               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01625}01625               \textcolor{comment}{// Case (2) : The current entry lies above the diagonal}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01626}01626               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\textcolor{keywordtype}{unsigned}(*(column\_index\_pt + i\_row\_start + j)) > \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01627}01627               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01628}01628                 \textcolor{comment}{// Set the index of the current entry to be the value of i-\/th}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01629}01629                 \textcolor{comment}{// entry of Index\_of\_diagonal\_entries}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01630}01630                 \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cb9860ebacf742fc7fc47d77703cc82}{Index\_of\_diagonal\_entries}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = i\_row\_start + j -\/ 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01631}01631 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01632}01632                 \textcolor{comment}{// Indicate that the i-\/th entry of Index\_of\_diagonal\_entries has}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01633}01633                 \textcolor{comment}{// been set}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01634}01634                 is\_ith\_entry\_set = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01635}01635               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01636}01636               \textcolor{comment}{// Case (3.2) : The current entry is the last entry in the row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01637}01637               \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (j == nnz\_row\_i -\/ 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01638}01638               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01639}01639                 \textcolor{comment}{// Set the index of the current entry to be the value of i-\/th}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01640}01640                 \textcolor{comment}{// entry of Index\_of\_diagonal\_entries}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01641}01641                 \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cb9860ebacf742fc7fc47d77703cc82}{Index\_of\_diagonal\_entries}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = i\_row\_start + j;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01642}01642 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01643}01643                 \textcolor{comment}{// Indicate that the i-\/th entry of Index\_of\_diagonal\_entries has}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01644}01644                 \textcolor{comment}{// been set}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01645}01645                 is\_ith\_entry\_set = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01646}01646               \} \textcolor{comment}{// if (nnz\_row\_i==1) else if}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01647}01647             \} \textcolor{comment}{// if (*(column\_index\_pt+i\_row\_start)>i)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01648}01648           \} \textcolor{comment}{// if (!is\_ith\_entry\_set)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01649}01649         \} \textcolor{comment}{// for (unsigned j=0;j<nnz\_row\_i;j++)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01650}01650       \} \textcolor{comment}{// if (nnz\_row\_i==0) else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01651}01651     \} \textcolor{comment}{// for (unsigned i=0;i<n\_rows;i++)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01652}01652   \} \textcolor{comment}{// End of sort\_entries()}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01653}01653 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01654}01654   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01655}01655 \textcolor{comment}{  /// Clean method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01656}01656 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01657}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a70c8a67158c081e70b4d07a6b248bc7a}{01657}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a70c8a67158c081e70b4d07a6b248bc7a}{CRDoubleMatrix::clear}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01658}01658   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01659}01659     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a30742aa2ac9abcfa037179f2d28ff43a}{clear\_distribution}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01660}01660     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.clean\_up\_memory();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01661}01661     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01662}01662 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01663}01663     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}} != 0) \textcolor{comment}{// Only clean up if it exists}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01664}01664       \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a86f0315e581cd5b41b75867383aa3760}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a9d66f3262e80ca06a365f98216afd85f}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01665}01665   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01666}01666 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01667}01667   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01668}01668 \textcolor{comment}{  /// build method: Takes the distribution and the number of columns, as}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01669}01669 \textcolor{comment}{  /// well as the vector of values, vector of column indices,vector of row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01670}01670 \textcolor{comment}{  /// starts.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01671}01671 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01672}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{01672}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{CRDoubleMatrix::build}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* distribution\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01673}01673                              \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ncol,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01674}01674                              \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01675}01675                              \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& column\_index,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01676}01676                              \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& row\_start)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01677}01677   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01678}01678     \textcolor{comment}{// clear}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01679}01679     this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a70c8a67158c081e70b4d07a6b248bc7a}{clear}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01680}01680 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01681}01681     \textcolor{comment}{// store the Distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01682}01682     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(distribution\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01683}01683 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01684}01684     \textcolor{comment}{// set the linear solver}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01685}01685     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01686}01686 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01687}01687     \textcolor{comment}{// now build the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01688}01688     this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(ncol, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01689}01689   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01690}01690 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01691}01691   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01692}01692 \textcolor{comment}{  /// method to rebuild the matrix, but not the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01693}01693 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01694}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac04c0787a123256b3dbaf6acf40df4e2}{01694}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{CRDoubleMatrix::build}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ncol,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01695}01695                              \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01696}01696                              \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& column\_index,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01697}01697                              \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& row\_start)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01698}01698   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01699}01699     \textcolor{comment}{// call the underlying build method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01700}01700     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.clean\_up\_memory();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01701}01701     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.build(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}, this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}(), ncol);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01702}01702 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01703}01703     \textcolor{comment}{// matrix has been build}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01704}01704     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01705}01705   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01706}01706 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01707}01707   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01708}01708 \textcolor{comment}{  /// method to rebuild the matrix, but not the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01709}01709 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01710}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{01710}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{CRDoubleMatrix::build\_without\_copy}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ncol,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01711}01711                                           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& nnz,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01712}01712                                           \textcolor{keywordtype}{double}* value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01713}01713                                           \textcolor{keywordtype}{int}* column\_index,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01714}01714                                           \textcolor{keywordtype}{int}* row\_start)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01715}01715   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01716}01716     \textcolor{comment}{// call the underlying build method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01717}01717     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.clean\_up\_memory();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01718}01718     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.build\_without\_copy(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01719}01719       \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}, this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}(), ncol);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01720}01720 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01721}01721     \textcolor{comment}{// matrix has been build}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01722}01722     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01723}01723   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01724}01724 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01725}01725   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01726}01726 \textcolor{comment}{  /// Do LU decomposition}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01727}01727 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01728}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4b90203edbcbfec4e5e1c79f7d8d2722}{01728}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4b90203edbcbfec4e5e1c79f7d8d2722}{CRDoubleMatrix::ludecompose}}()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01729}01729   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01730}01730 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01731}01731     \textcolor{comment}{// check that the this matrix is built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01732}01732     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01733}01733     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01734}01734       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01735}01735       error\_message\_stream << \textcolor{stringliteral}{"{}This matrix has not been built."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01736}01736       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01737}01737                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01738}01738                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01739}01739     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01740}01740 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01741}01741 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01742}01742     \textcolor{comment}{// factorise using superlu or superlu dist if we oomph has mpi}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01743}01743     \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}})-\/>factorise(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01744}01744   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01745}01745 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01746}01746   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01747}01747 \textcolor{comment}{  /// Do back-\/substitution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01748}01748 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01749}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af2c0f286f77ca44453f0da684b8f9dc7}{01749}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af2c0f286f77ca44453f0da684b8f9dc7}{CRDoubleMatrix::lubksub}}(\mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01750}01750   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01751}01751 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01752}01752     \textcolor{comment}{// check that the rhs vector is setup}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01753}01753     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01754}01754     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01755}01755       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01756}01756       error\_message\_stream << \textcolor{stringliteral}{"{}The vector rhs has not been setup"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01757}01757       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01758}01758                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01759}01759                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01760}01760     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01761}01761     \textcolor{comment}{// check that the rhs vector has the same distribution as this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01762}01762     \textcolor{keywordflow}{if} (!(*this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01763}01763     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01764}01764       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01765}01765       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01766}01766         << \textcolor{stringliteral}{"{}The vector rhs must have the same distribution as the matrix"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01767}01767       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01768}01768                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01769}01769                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01770}01770     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01771}01771 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01772}01772 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01773}01773     \textcolor{comment}{// backsub}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01774}01774     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} rhs\_copy(rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01775}01775     \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1SuperLUSolver}{SuperLUSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a6ef2e36e4e5907af2738934f131e8dcf}{Default\_linear\_solver\_pt}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01776}01776       -\/>backsub(rhs\_copy, rhs);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01777}01777   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01778}01778 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01779}01779   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01780}01780 \textcolor{comment}{  ///  Multiply the matrix by the vector x}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01781}01781 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01782}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a54b75960df52e3aebd21aaab20e9869d}{01782}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a54b75960df52e3aebd21aaab20e9869d}{CRDoubleMatrix::multiply}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& soln)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01783}01783 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01784}01784 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01785}01785     \textcolor{comment}{// check that this matrix is built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01786}01786     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01787}01787     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01788}01788       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01789}01789       error\_message\_stream << \textcolor{stringliteral}{"{}This matrix has not been built"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01790}01790       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01791}01791                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01792}01792                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01793}01793     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01794}01794     \textcolor{comment}{// check that the distribution of x is setup}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01795}01795     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.built())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01796}01796     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01797}01797       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01798}01798       error\_message\_stream << \textcolor{stringliteral}{"{}The distribution of the vector x must be setup"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01799}01799       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01800}01800                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01801}01801                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01802}01802     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01803}01803     \textcolor{comment}{// Check to see if x.size() = ncol().}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01804}01804     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}() != x.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01805}01805     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01806}01806       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01807}01807       error\_message\_stream << \textcolor{stringliteral}{"{}The number of rows in the x vector and the "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01808}01808                               \textcolor{stringliteral}{"{}number of columns in the "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01809}01809                            << \textcolor{stringliteral}{"{}matrix must be the same"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01810}01810       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01811}01811                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01812}01812                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01813}01813     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01814}01814     \textcolor{comment}{// if the soln is distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01815}01815     \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01816}01816     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01817}01817       \textcolor{keywordflow}{if} (!(*soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *this-\/>distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01818}01818       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01819}01819         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01820}01820         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01821}01821           << \textcolor{stringliteral}{"{}The soln vector is setup and therefore must have the same "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01822}01822           << \textcolor{stringliteral}{"{}distribution as the matrix"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01823}01823         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01824}01824                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01825}01825                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01826}01826       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01827}01827     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01828}01828 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01829}01829 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01830}01830     \textcolor{comment}{// if soln is not setup then setup the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01831}01831     \textcolor{keywordflow}{if} (!soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01832}01832     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01833}01833       \textcolor{comment}{// Resize and initialize the solution vector}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01834}01834       soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01835}01835     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01836}01836 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01837}01837     \textcolor{comment}{// Initialise}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01838}01838     soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01839}01839 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01840}01840     \textcolor{comment}{// if distributed and on more than one processor use trilinos}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01841}01841     \textcolor{comment}{// otherwise use the oomph-\/lib methods}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01842}01842     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() \&\&}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01843}01843         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01844}01844     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01845}01845 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRILINOS}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01846}01846       \textcolor{comment}{// This will only work if we have trilinos on board}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01847}01847       \mbox{\hyperlink{namespaceoomph_1_1TrilinosEpetraHelpers_a595c337ff02ad53b3dcac04ed142f8db}{TrilinosEpetraHelpers::multiply}}(\textcolor{keyword}{this}, \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}, soln);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01848}01848 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01849}01849       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01850}01850       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01851}01851         << \textcolor{stringliteral}{"{}Matrix-\/vector product on multiple processors with distributed "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01852}01852         << \textcolor{stringliteral}{"{}CRDoubleMatrix requires Trilinos."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01853}01853       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01854}01854                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01855}01855                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01856}01856 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01857}01857     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01858}01858     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01859}01859     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01860}01860       \textcolor{keywordtype}{unsigned} n = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01861}01861       \textcolor{keyword}{const} \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01862}01862       \textcolor{keyword}{const} \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.column\_index();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01863}01863       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01864}01864       \textcolor{keywordtype}{double}* soln\_pt = soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01865}01865       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* x\_pt = \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.values\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01866}01866       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01867}01867       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01868}01868         soln\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01869}01869         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} k = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; k < \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]; k++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01870}01870         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01871}01871           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01872}01872           \textcolor{keywordtype}{double} a\_ij = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01873}01873           soln\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += a\_ij * x\_pt[j];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01874}01874         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01875}01875       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01876}01876     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01877}01877   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01878}01878 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01879}01879   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01880}01880 \textcolor{comment}{  /// Multiply the transposed matrix by the vector x: soln=A\string^T x}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01881}01881 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01882}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a42fb274c98ccf4c2a542ca15343fcc0e}{01882}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a42fb274c98ccf4c2a542ca15343fcc0e}{CRDoubleMatrix::multiply\_transpose}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01883}01883                                           \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& soln)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01884}01884 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01885}01885 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01886}01886     \textcolor{comment}{// check that this matrix is built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01887}01887     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01888}01888     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01889}01889       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01890}01890       error\_message\_stream << \textcolor{stringliteral}{"{}This matrix has not been built"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01891}01891       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01892}01892                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01893}01893                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01894}01894     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01895}01895     \textcolor{comment}{// Check to see if x.size() = ncol().}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01896}01896     \textcolor{keywordflow}{if} (!(*this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *x.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01897}01897     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01898}01898       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01899}01899       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01900}01900         << \textcolor{stringliteral}{"{}The x vector and this matrix must have the same distribution."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01901}01901       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01902}01902                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01903}01903                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01904}01904     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01905}01905     \textcolor{comment}{// if soln is setup then it should have the same distribution as x}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01906}01906     \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01907}01907     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01908}01908       \textcolor{keywordflow}{if} (soln.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}() != this-\/>ncol())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01909}01909       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01910}01910         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01911}01911         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01912}01912           << \textcolor{stringliteral}{"{}The soln vector is setup and therefore must have the same "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01913}01913           << \textcolor{stringliteral}{"{}number of rows as the vector x"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01914}01914         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01915}01915                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01916}01916                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01917}01917       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01918}01918     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01919}01919 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01920}01920 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01921}01921     \textcolor{comment}{// if soln is not setup then setup the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01922}01922     \textcolor{keywordflow}{if} (!soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01923}01923     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01924}01924       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01925}01925         \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.distribution\_pt()-\/>communicator\_pt(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01926}01926                                       this-\/>ncol(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01927}01927                                       this-\/>distributed());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01928}01928       soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01929}01929       \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01930}01930     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01931}01931 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01932}01932     \textcolor{comment}{// Initialise}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01933}01933     soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01934}01934 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01935}01935     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() \&\&}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01936}01936         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01937}01937     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01938}01938 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRILINOS}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01939}01939       \textcolor{comment}{// This will only work if we have trilinos on board}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01940}01940       \mbox{\hyperlink{namespaceoomph_1_1TrilinosEpetraHelpers_a595c337ff02ad53b3dcac04ed142f8db}{TrilinosEpetraHelpers::multiply}}(\textcolor{keyword}{this}, \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}, soln);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01941}01941 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01942}01942       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01943}01943       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01944}01944         << \textcolor{stringliteral}{"{}Matrix-\/vector product on multiple processors with distributed "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01945}01945         << \textcolor{stringliteral}{"{}CRDoubleMatrix requires Trilinos."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01946}01946       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01947}01947                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01948}01948                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01949}01949 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01950}01950     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01951}01951     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01952}01952     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01953}01953       \textcolor{keywordtype}{unsigned} n = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01954}01954       \textcolor{keyword}{const} \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01955}01955       \textcolor{keyword}{const} \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.column\_index();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01956}01956       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01957}01957       \textcolor{keywordtype}{double}* soln\_pt = soln.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01958}01958       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* x\_pt = \mbox{\hyperlink{namespaceoomph_a9d1d2da2b8bb8e73af72b5cadb8fe97c}{x}}.values\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01959}01959       \textcolor{comment}{// Matrix vector product}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01960}01960       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01961}01961       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01962}01962         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} k = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; k < \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]; k++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01963}01963         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01964}01964           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} j = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01965}01965           \textcolor{keywordtype}{double} a\_ij = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01966}01966           soln\_pt[j] += a\_ij * x\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01967}01967         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01968}01968       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01969}01969     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01970}01970   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01971}01971 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01972}01972   \textcolor{comment}{//===========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01973}01973 \textcolor{comment}{  /// Function to multiply this matrix by the CRDoubleMatrix matrix\_in.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01974}01974 \textcolor{comment}{  /// In a serial matrix, there are 4 methods available:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01975}01975 \textcolor{comment}{  /// Method 1: First runs through this matrix and matrix\_in to find the storage}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01976}01976 \textcolor{comment}{  ///           requirements for result -\/ arrays of the correct size are}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01977}01977 \textcolor{comment}{  ///           then allocated before performing the calculation.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01978}01978 \textcolor{comment}{  ///           Minimises memory requirements but more costly.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01979}01979 \textcolor{comment}{  /// Method 2: Grows storage for values and column indices of result 'on the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01980}01980 \textcolor{comment}{  ///           fly' using an array of maps. Faster but more memory}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01981}01981 \textcolor{comment}{  ///           intensive.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01982}01982 \textcolor{comment}{  /// Method 3: Grows storage for values and column indices of result 'on the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01983}01983 \textcolor{comment}{  ///           fly' using a vector of vectors. Not particularly impressive}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01984}01984 \textcolor{comment}{  ///           on the platforms we tried...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01985}01985 \textcolor{comment}{  /// Method 4: Trilinos Epetra Matrix Matrix multiply.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01986}01986 \textcolor{comment}{  /// Method 5: Trilinox Epetra Matrix Matrix Mulitply (ml based)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01987}01987 \textcolor{comment}{  /// If Trilinos is installed then Method 4 is employed by default, otherwise}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01988}01988 \textcolor{comment}{  /// Method 2 is employed by default.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01989}01989 \textcolor{comment}{  /// In a distributed matrix, only Trilinos Epetra Matrix Matrix multiply}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01990}01990 \textcolor{comment}{  /// is available.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01991}01991 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01992}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af08fd73a7edbdbde9facf47b913e3e43}{01992}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a54b75960df52e3aebd21aaab20e9869d}{CRDoubleMatrix::multiply}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& matrix\_in,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01993}01993                                 \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& result)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01994}01994 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01995}01995 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01996}01996     \textcolor{comment}{// check that this matrix is built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01997}01997     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a63afd9976f0970a4e6ffee3755d21540}{Built}})}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01998}01998     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l01999}01999       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02000}02000       error\_message\_stream << \textcolor{stringliteral}{"{}This matrix has not been built"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02001}02001       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02002}02002                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02003}02003                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02004}02004     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02005}02005     \textcolor{comment}{// check that this matrix is built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02006}02006     \textcolor{keywordflow}{if} (!matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aa0503bc64ef0ccb60cb7d7e645425a62}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02007}02007     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02008}02008       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02009}02009       error\_message\_stream << \textcolor{stringliteral}{"{}This matrix matrix\_in has not been built"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02010}02010       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02011}02011                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02012}02012                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02013}02013     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02014}02014     \textcolor{comment}{// if soln is setup then it should have the same distribution as x}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02015}02015     \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aa0503bc64ef0ccb60cb7d7e645425a62}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02016}02016     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02017}02017       \textcolor{keywordflow}{if} (!(*result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *this-\/>distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02018}02018       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02019}02019         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02020}02020         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02021}02021           << \textcolor{stringliteral}{"{}The matrix result is setup and therefore must have the same "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02022}02022           << \textcolor{stringliteral}{"{}distribution as the vector x"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02023}02023         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02024}02024                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02025}02025                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02026}02026       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02027}02027     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02028}02028 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02029}02029 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02030}02030     \textcolor{comment}{// if the result has not been setup, then store the distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02031}02031     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02032}02032     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02033}02033       result.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02034}02034     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02035}02035 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02036}02036     \textcolor{comment}{// short name for Serial\_matrix\_matrix\_multiply\_method}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02037}02037     \textcolor{keywordtype}{unsigned} method = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02038}02038 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02039}02039     \textcolor{comment}{// if this matrix is not distributed and matrix in is not distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02040}02040     \textcolor{keywordflow}{if} (!this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() \&\& !matrix\_in.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() \&\&}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02041}02041         ((method == 1) || (method == 2) || (method == 3)))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02042}02042     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02043}02043       \textcolor{comment}{// NB N is number of rows!}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02044}02044       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}} = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02045}02045       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} M = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02046}02046       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} Nnz = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02047}02047 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02048}02048       \textcolor{comment}{// pointers to arrays which store result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02049}02049       \textcolor{keywordtype}{int}* Row\_start = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02050}02050       \textcolor{keywordtype}{double}* Value = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02051}02051       \textcolor{keywordtype}{int}* Column\_index = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02052}02052 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02053}02053       \textcolor{comment}{// get pointers to matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02054}02054       \textcolor{keyword}{const} \textcolor{keywordtype}{int}* matrix\_in\_row\_start = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02055}02055       \textcolor{keyword}{const} \textcolor{keywordtype}{int}* matrix\_in\_column\_index = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02056}02056       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* matrix\_in\_value = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02057}02057 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02058}02058       \textcolor{comment}{// get pointers to this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02059}02059       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* this\_value = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02060}02060       \textcolor{keyword}{const} \textcolor{keywordtype}{int}* this\_row\_start = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02061}02061       \textcolor{keyword}{const} \textcolor{keywordtype}{int}* this\_column\_index = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02062}02062 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02063}02063       \textcolor{comment}{// clock\_t clock1 = clock();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02064}02064 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02065}02065       \textcolor{comment}{// METHOD 1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02066}02066       \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02067}02067       \textcolor{keywordflow}{if} (method == 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02068}02068       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02069}02069         \textcolor{comment}{// allocate storage for row starts}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02070}02070         Row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02071}02071         Row\_start[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02072}02072 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02073}02073         \textcolor{comment}{// a set to store number of non-\/zero columns in each row of result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02074}02074         std::set<unsigned> columns;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02075}02075 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02076}02076         \textcolor{comment}{// run through rows of this matrix and matrix\_in to find number of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02077}02077         \textcolor{comment}{// non-\/zero entries in each row of result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02078}02078         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_row = 0; this\_row < \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}; this\_row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02079}02079         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02080}02080           \textcolor{comment}{// run through non-\/zeros in this\_row of this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02081}02081           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} this\_ptr = this\_row\_start[this\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02082}02082                this\_ptr < this\_row\_start[this\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02083}02083                this\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02084}02084           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02085}02085             \textcolor{comment}{// find column index for non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02086}02086             \textcolor{keywordtype}{int} matrix\_in\_row = this\_column\_index[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02087}02087 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02088}02088             \textcolor{comment}{// run through corresponding row in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02089}02089             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} matrix\_in\_ptr = matrix\_in\_row\_start[matrix\_in\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02090}02090                  matrix\_in\_ptr < matrix\_in\_row\_start[matrix\_in\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02091}02091                  matrix\_in\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02092}02092             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02093}02093               \textcolor{comment}{// find column index for non-\/zero in matrix\_in and store in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02094}02094               \textcolor{comment}{// columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02095}02095               columns.insert(matrix\_in\_column\_index[matrix\_in\_ptr]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02096}02096             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02097}02097           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02098}02098           \textcolor{comment}{// update Row\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02099}02099           Row\_start[this\_row + 1] = Row\_start[this\_row] + columns.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02100}02100 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02101}02101           \textcolor{comment}{// wipe values in columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02102}02102           columns.clear();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02103}02103         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02104}02104 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02105}02105         \textcolor{comment}{// set Nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02106}02106         Nnz = Row\_start[\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02107}02107 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02108}02108         \textcolor{comment}{// allocate arrays for result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02109}02109         Value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[Nnz];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02110}02110         Column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nnz];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02111}02111 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02112}02112         \textcolor{comment}{// set all values of Column\_index to -\/1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02113}02113         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < Nnz; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02114}02114         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02115}02115           Column\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = -\/1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02116}02116         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02117}02117 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02118}02118         \textcolor{comment}{// Calculate values for result -\/ first run through rows of this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02119}02119         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_row = 0; this\_row < \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}; this\_row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02120}02120         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02121}02121           \textcolor{comment}{// run through non-\/zeros in this\_row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02122}02122           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} this\_ptr = this\_row\_start[this\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02123}02123                this\_ptr < this\_row\_start[this\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02124}02124                this\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02125}02125           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02126}02126             \textcolor{comment}{// find value of non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02127}02127             \textcolor{keywordtype}{double} this\_val = this\_value[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02128}02128 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02129}02129             \textcolor{comment}{// find column associated with non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02130}02130             \textcolor{keywordtype}{int} matrix\_in\_row = this\_column\_index[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02131}02131 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02132}02132             \textcolor{comment}{// run through corresponding row in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02133}02133             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} matrix\_in\_ptr = matrix\_in\_row\_start[matrix\_in\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02134}02134                  matrix\_in\_ptr < matrix\_in\_row\_start[matrix\_in\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02135}02135                  matrix\_in\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02136}02136             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02137}02137               \textcolor{comment}{// find column index for non-\/zero in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02138}02138               \textcolor{keywordtype}{int} col = matrix\_in\_column\_index[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02139}02139 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02140}02140               \textcolor{comment}{// find position in result to insert value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02141}02141               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ptr = Row\_start[this\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02142}02142                    ptr <= Row\_start[this\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02143}02143                    ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02144}02144               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02145}02145                 \textcolor{keywordflow}{if} (ptr == Row\_start[this\_row + 1])}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02146}02146                 \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02147}02147                   \textcolor{comment}{// error -\/ have passed end of row without finding}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02148}02148                   \textcolor{comment}{// correct column}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02149}02149                   std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02150}02150                   error\_message << \textcolor{stringliteral}{"{}Error inserting value in result"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02151}02151 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02152}02152                   \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02153}02153                                       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02154}02154                                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02155}02155                 \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02156}02156                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (Column\_index[ptr] == -\/1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02157}02157                 \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02158}02158                   \textcolor{comment}{// first entry for this column index}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02159}02159                   Column\_index[ptr] = col;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02160}02160                   Value[ptr] = this\_val * matrix\_in\_value[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02161}02161                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02162}02162                 \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02163}02163                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (Column\_index[ptr] == col)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02164}02164                 \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02165}02165                   \textcolor{comment}{// column index already exists -\/ add value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02166}02166                   Value[ptr] += this\_val * matrix\_in\_value[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02167}02167                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02168}02168                 \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02169}02169               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02170}02170             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02171}02171           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02172}02172         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02173}02173       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02174}02174 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02175}02175       \textcolor{comment}{// METHOD 2}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02176}02176       \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02177}02177       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (method == 2)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02178}02178       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02179}02179         \textcolor{comment}{// generate array of maps to store values for result}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02180}02180         std::map<int, double>* result\_maps = \textcolor{keyword}{new} std::map<int, double>[\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02181}02181 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02182}02182         \textcolor{comment}{// run through rows of this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02183}02183         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_row = 0; this\_row < \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}; this\_row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02184}02184         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02185}02185           \textcolor{comment}{// run through non-\/zeros in this\_row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02186}02186           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} this\_ptr = this\_row\_start[this\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02187}02187                this\_ptr < this\_row\_start[this\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02188}02188                this\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02189}02189           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02190}02190             \textcolor{comment}{// find value of non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02191}02191             \textcolor{keywordtype}{double} this\_val = this\_value[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02192}02192 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02193}02193             \textcolor{comment}{// find column index associated with non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02194}02194             \textcolor{keywordtype}{int} matrix\_in\_row = this\_column\_index[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02195}02195 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02196}02196             \textcolor{comment}{// run through corresponding row in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02197}02197             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} matrix\_in\_ptr = matrix\_in\_row\_start[matrix\_in\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02198}02198                  matrix\_in\_ptr < matrix\_in\_row\_start[matrix\_in\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02199}02199                  matrix\_in\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02200}02200             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02201}02201               \textcolor{comment}{// find column index for non-\/zero in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02202}02202               \textcolor{keywordtype}{int} col = matrix\_in\_column\_index[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02203}02203 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02204}02204               \textcolor{comment}{// insert value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02205}02205               result\_maps[this\_row][col] +=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02206}02206                 this\_val * matrix\_in\_value[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02207}02207             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02208}02208           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02209}02209         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02210}02210 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02211}02211         \textcolor{comment}{// allocate Row\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02212}02212         Row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02213}02213 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02214}02214         \textcolor{comment}{// copy across row starts}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02215}02215         Row\_start[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02216}02216         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} row = 0; row < \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}; row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02217}02217         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02218}02218           \textcolor{keywordtype}{int} size = result\_maps[row].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02219}02219           Row\_start[row + 1] = Row\_start[row] + size;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02220}02220         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02221}02221 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02222}02222         \textcolor{comment}{// set Nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02223}02223         Nnz = Row\_start[\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02224}02224 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02225}02225         \textcolor{comment}{// allocate other arrays}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02226}02226         Value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[Nnz];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02227}02227         Column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nnz];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02228}02228 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02229}02229         \textcolor{comment}{// copy values and column indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02230}02230         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} row = 0; row < \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}; row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02231}02231         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02232}02232           \textcolor{keywordtype}{unsigned} ptr = Row\_start[row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02233}02233           \textcolor{keywordflow}{for} (std::map<int, double>::iterator \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = result\_maps[row].begin();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02234}02234                \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} != result\_maps[row].end();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02235}02235                \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02236}02236           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02237}02237             Column\_index[ptr] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}-\/>first;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02238}02238             Value[ptr] = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}-\/>second;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02239}02239             ptr++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02240}02240           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02241}02241         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02242}02242 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02243}02243         \textcolor{comment}{// tidy up memory}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02244}02244         \textcolor{keyword}{delete}[] result\_maps;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02245}02245       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02246}02246 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02247}02247       \textcolor{comment}{// METHOD 3}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02248}02248       \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02249}02249       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (method == 3)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02250}02250       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02251}02251         \textcolor{comment}{// vectors of vectors to store results}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02252}02252         std::vector<std::vector<int>> result\_cols(\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02253}02253         std::vector<std::vector<double>> result\_vals(\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02254}02254 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02255}02255         \textcolor{comment}{// run through the rows of this matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02256}02256         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_row = 0; this\_row < \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}; this\_row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02257}02257         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02258}02258           \textcolor{comment}{// run through non-\/zeros in this\_row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02259}02259           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} this\_ptr = this\_row\_start[this\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02260}02260                this\_ptr < this\_row\_start[this\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02261}02261                this\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02262}02262           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02263}02263             \textcolor{comment}{// find value of non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02264}02264             \textcolor{keywordtype}{double} this\_val = this\_value[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02265}02265 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02266}02266             \textcolor{comment}{// find column index associated with non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02267}02267             \textcolor{keywordtype}{int} matrix\_in\_row = this\_column\_index[this\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02268}02268 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02269}02269             \textcolor{comment}{// run through corresponding row in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02270}02270             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} matrix\_in\_ptr = matrix\_in\_row\_start[matrix\_in\_row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02271}02271                  matrix\_in\_ptr < matrix\_in\_row\_start[matrix\_in\_row + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02272}02272                  matrix\_in\_ptr++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02273}02273             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02274}02274               \textcolor{comment}{// find column index for non-\/zero in matrix\_in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02275}02275               \textcolor{keywordtype}{int} col = matrix\_in\_column\_index[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02276}02276 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02277}02277               \textcolor{comment}{// insert value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02278}02278               \textcolor{keywordtype}{int} size = result\_cols[this\_row].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02279}02279               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} <= size; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02280}02280               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02281}02281                 \textcolor{keywordflow}{if} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} == size)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02282}02282                 \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02283}02283                   \textcolor{comment}{// first entry for this column}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02284}02284                   result\_cols[this\_row].push\_back(col);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02285}02285                   result\_vals[this\_row].push\_back(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02286}02286                     this\_val * matrix\_in\_value[matrix\_in\_ptr]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02287}02287                 \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02288}02288                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (col == result\_cols[this\_row][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}])}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02289}02289                 \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02290}02290                   \textcolor{comment}{// column already exists}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02291}02291                   result\_vals[this\_row][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02292}02292                     this\_val * matrix\_in\_value[matrix\_in\_ptr];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02293}02293                   \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02294}02294                 \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02295}02295               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02296}02296             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02297}02297           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02298}02298         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02299}02299 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02300}02300         \textcolor{comment}{// allocate Row\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02301}02301         Row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02302}02302 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02303}02303         \textcolor{comment}{// copy across row starts}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02304}02304         Row\_start[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02305}02305         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} row = 0; row < \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}; row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02306}02306         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02307}02307           \textcolor{keywordtype}{int} size = result\_cols[row].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02308}02308           Row\_start[row + 1] = Row\_start[row] + size;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02309}02309         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02310}02310 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02311}02311         \textcolor{comment}{// set Nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02312}02312         Nnz = Row\_start[\mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02313}02313 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02314}02314         \textcolor{comment}{// allocate other arrays}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02315}02315         Value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[Nnz];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02316}02316         Column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[Nnz];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02317}02317 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02318}02318         \textcolor{comment}{// copy across values and column indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02319}02319         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} row = 0; row < \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7dabc60bec4cc294aa2adf92726c6d6823a}{N}}; row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02320}02320         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02321}02321           \textcolor{keywordtype}{unsigned} ptr = Row\_start[row];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02322}02322           \textcolor{keywordtype}{unsigned} nnn = result\_cols[row].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02323}02323           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nnn; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02324}02324           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02325}02325             Column\_index[ptr] = result\_cols[row][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02326}02326             Value[ptr] = result\_vals[row][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02327}02327             ptr++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02328}02328           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02329}02329         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02330}02330       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02331}02331 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02332}02332       \textcolor{comment}{// build}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02333}02333       result.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(M, Nnz, Value, Column\_index, Row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02334}02334     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02335}02335 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02336}02336     \textcolor{comment}{// else we have to use trilinos}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02337}02337     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02338}02338     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02339}02339 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_TRILINOS}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02340}02340       \textcolor{keywordtype}{bool} use\_ml = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02341}02341       \textcolor{keywordflow}{if} (method == 5)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02342}02342       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02343}02343         use\_ml = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02344}02344       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02345}02345       \mbox{\hyperlink{namespaceoomph_1_1TrilinosEpetraHelpers_a595c337ff02ad53b3dcac04ed142f8db}{TrilinosEpetraHelpers::multiply}}(*\textcolor{keyword}{this}, matrix\_in, result, use\_ml);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02346}02346 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02347}02347       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02348}02348       error\_message << \textcolor{stringliteral}{"{}Serial\_matrix\_matrix\_multiply\_method = "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02349}02349                     << \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ac8fab9824a0766b6bb6361a6b25df9ce}{Serial\_matrix\_matrix\_multiply\_method}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02350}02350                     << \textcolor{stringliteral}{"{} requires trilinos."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02351}02351       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02352}02352         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02353}02353 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02354}02354     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02355}02355   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02356}02356 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02357}02357 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02358}02358   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02359}02359 \textcolor{comment}{  /// For every row, find the maximum absolute value of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02360}02360 \textcolor{comment}{  /// entries in this row. Set all values that are less than alpha times}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02361}02361 \textcolor{comment}{  /// this maximum to zero and return the resulting matrix in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02362}02362 \textcolor{comment}{  /// reduced\_matrix. Note: Diagonal entries are retained regardless}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02363}02363 \textcolor{comment}{  /// of their size.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02364}02364 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02365}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a3853068b7fce9e83bc817930262e9ca1}{02365}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a3853068b7fce9e83bc817930262e9ca1}{CRDoubleMatrix::matrix\_reduction}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& alpha,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02366}02366                                         \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& reduced\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02367}02367   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02368}02368     \textcolor{comment}{// number of rows in matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02369}02369     \textcolor{keywordtype}{long} n\_row = \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02370}02370     \textcolor{keywordtype}{double} max\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02371}02371 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02372}02372     \textcolor{comment}{// Here's the packed format for the new matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02373}02373     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} B\_row\_start(1);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02374}02374     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} B\_column\_index;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02375}02375     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} B\_value;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02376}02376 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02377}02377     \textcolor{comment}{// get pointers to the underlying data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02378}02378     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02379}02379     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.column\_index();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02380}02380     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02381}02381 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02382}02382     \textcolor{comment}{// k is counter for the number of entries in the reduced matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02383}02383     \textcolor{keywordtype}{unsigned} k = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02384}02384 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02385}02385     \textcolor{comment}{// Initialise row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02386}02386     B\_row\_start[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02387}02387 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02388}02388     \textcolor{comment}{// Loop over rows}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02389}02389     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02390}02390     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02391}02391       \textcolor{comment}{// Initialise max value in row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02392}02392       max\_row = 0.0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02393}02393 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02394}02394       \textcolor{comment}{// Loop over entries in columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02395}02395       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} j = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; j < \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02396}02396       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02397}02397         \textcolor{comment}{// Find max. value in row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02398}02398         \textcolor{keywordflow}{if} (std::fabs(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}[j]) > max\_row)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02399}02399         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02400}02400           max\_row = std::fabs(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}[j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02401}02401         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02402}02402       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02403}02403 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02404}02404       \textcolor{comment}{// Decide if we need to retain the entries in the row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02405}02405       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} j = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; j < \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02406}02406       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02407}02407         \textcolor{comment}{// If we're on the diagonal or the value is sufficiently large: retain}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02408}02408         \textcolor{comment}{// i.e. copy across.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02409}02409         \textcolor{keywordflow}{if} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} == \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}[j] || std::fabs(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}[j]) > alpha * max\_row)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02410}02410         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02411}02411           B\_value.push\_back(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}[j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02412}02412           B\_column\_index.push\_back(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}[j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02413}02413           k++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02414}02414         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02415}02415       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02416}02416       \textcolor{comment}{// This writes the row start for the next row -\/-\/ equal to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02417}02417       \textcolor{comment}{// to the number of entries written so far (C++ zero-\/based indexing!)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02418}02418       B\_row\_start.push\_back(k);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02419}02419     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02420}02420 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02421}02421     \textcolor{comment}{// Build the matrix from the compressed format}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02422}02422     \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\&\textcolor{keyword}{>}(reduced\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02423}02423       .\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}(), B\_value, B\_column\_index, B\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02424}02424   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02425}02425 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02426}02426   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02427}02427 \textcolor{comment}{  /// if this matrix is distributed then the equivalent global matrix is built}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02428}02428 \textcolor{comment}{  /// using new and returned. The calling method is responsible for the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02429}02429 \textcolor{comment}{  /// destruction of the new matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02430}02430 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02431}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a984602c9df0c573451f315a025820ced}{02431}}   \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a984602c9df0c573451f315a025820ced}{CRDoubleMatrix::global\_matrix}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02432}02432 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02433}02433 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02434}02434     \textcolor{comment}{// if this matrix is not distributed then this method is redundant}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02435}02435     \textcolor{keywordflow}{if} (!this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() ||}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02436}02436         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>nproc() == 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02437}02437     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02438}02438       \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad8914fa1a5a98f7602a1724b76eef26c}{CRDoubleMatrix}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02439}02439     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02440}02440 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02441}02441     \textcolor{comment}{// nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02442}02442     \textcolor{keywordtype}{int} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}} = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02443}02443 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02444}02444     \textcolor{comment}{// my nrow local}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02445}02445     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02446}02446 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02447}02447     \textcolor{comment}{// nrow global}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02448}02448     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}} = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02449}02449 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02450}02450     \textcolor{comment}{// cache nproc}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02451}02451     \textcolor{keywordtype}{int} nproc = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02452}02452 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02453}02453     \textcolor{comment}{// get the nnzs on the other processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02454}02454     \textcolor{keywordtype}{int}* dist\_nnz\_pt = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02455}02455     MPI\_Allgather(\&\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02456}02456                   1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02457}02457                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02458}02458                   dist\_nnz\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02459}02459                   1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02460}02460                   MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02461}02461                   this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02462}02462 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02463}02463     \textcolor{comment}{// create a int vector of first rows and nrow local and compute nnz global}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02464}02464     \textcolor{keywordtype}{int}* dist\_first\_row = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02465}02465     \textcolor{keywordtype}{int}* dist\_nrow\_local = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02466}02466     \textcolor{keywordtype}{int} nnz\_global = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02467}02467     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02468}02468     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02469}02469       nnz\_global += dist\_nnz\_pt[p];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02470}02470       dist\_first\_row[p] = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}}(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02471}02471       dist\_nrow\_local[p] = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02472}02472     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02473}02473 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02474}02474     \textcolor{comment}{// compute the offset for the values and column index data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02475}02475     \textcolor{keywordtype}{int}* nnz\_offset = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02476}02476     nnz\_offset[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02477}02477     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 1; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02478}02478     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02479}02479       nnz\_offset[p] = nnz\_offset[p -\/ 1] + dist\_nnz\_pt[p -\/ 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02480}02480     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02481}02481 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02482}02482     \textcolor{comment}{// get pointers to the (current) distributed data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02483}02483     \textcolor{comment}{// const\_cast required because MPI requires non-\/const data when sending}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02484}02484     \textcolor{comment}{// data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02485}02485     \textcolor{keywordtype}{int}* dist\_row\_start = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{int}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02486}02486     \textcolor{keywordtype}{int}* dist\_column\_index = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{int}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02487}02487     \textcolor{keywordtype}{double}* dist\_value = \textcolor{keyword}{const\_cast<}\textcolor{keywordtype}{double}*\textcolor{keyword}{>}(this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02488}02488 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02489}02489     \textcolor{comment}{// space for the global matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02490}02490     \textcolor{keywordtype}{int}* global\_row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02491}02491     \textcolor{keywordtype}{int}* global\_column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nnz\_global];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02492}02492     \textcolor{keywordtype}{double}* global\_value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz\_global];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02493}02493 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02494}02494     \textcolor{comment}{// get the row starts}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02495}02495     MPI\_Allgatherv(dist\_row\_start,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02496}02496                    \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02497}02497                    MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02498}02498                    global\_row\_start,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02499}02499                    dist\_nrow\_local,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02500}02500                    dist\_first\_row,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02501}02501                    MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02502}02502                    this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02503}02503 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02504}02504     \textcolor{comment}{// get the column indexes}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02505}02505     MPI\_Allgatherv(dist\_column\_index,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02506}02506                    \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02507}02507                    MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02508}02508                    global\_column\_index,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02509}02509                    dist\_nnz\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02510}02510                    nnz\_offset,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02511}02511                    MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02512}02512                    this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02513}02513 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02514}02514     \textcolor{comment}{// get the values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02515}02515     MPI\_Allgatherv(dist\_value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02516}02516                    \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02517}02517                    MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02518}02518                    global\_value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02519}02519                    dist\_nnz\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02520}02520                    nnz\_offset,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02521}02521                    MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02522}02522                    this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02523}02523 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02524}02524     \textcolor{comment}{// finally the last row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02525}02525     global\_row\_start[\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}] = nnz\_global;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02526}02526 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02527}02527     \textcolor{comment}{// update the other row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02528}02528     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02529}02529     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02530}02530       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < dist\_nrow\_local[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02531}02531       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02532}02532         \textcolor{keywordtype}{unsigned} j = dist\_first\_row[p] + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02533}02533         global\_row\_start[j] += nnz\_offset[p];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02534}02534       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02535}02535     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02536}02536 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02537}02537     \textcolor{comment}{// create the global distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02538}02538     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02539}02539       this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt(), \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02540}02540 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02541}02541     \textcolor{comment}{// create the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02542}02542     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* matrix\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad8914fa1a5a98f7602a1724b76eef26c}{CRDoubleMatrix}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02543}02543 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02544}02544     \textcolor{comment}{// copy of distribution taken so delete}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02545}02545     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02546}02546 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02547}02547     \textcolor{comment}{// pass data into matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02548}02548     matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02549}02549                                   nnz\_global,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02550}02550                                   global\_value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02551}02551                                   global\_column\_index,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02552}02552                                   global\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02553}02553 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02554}02554     \textcolor{comment}{// clean up}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02555}02555     \textcolor{keyword}{delete}[] dist\_first\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02556}02556     \textcolor{keyword}{delete}[] dist\_nrow\_local;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02557}02557     \textcolor{keyword}{delete}[] nnz\_offset;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02558}02558     \textcolor{keyword}{delete}[] dist\_nnz\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02559}02559 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02560}02560     \textcolor{comment}{// and return}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02561}02561     \textcolor{keywordflow}{return} matrix\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02562}02562 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02563}02563     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad8914fa1a5a98f7602a1724b76eef26c}{CRDoubleMatrix}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02564}02564 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02565}02565   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02566}02566 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02567}02567   \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02568}02568 \textcolor{comment}{  /// The contents of the matrix are redistributed to match the new}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02569}02569 \textcolor{comment}{  /// distribution. In a non-\/MPI build this method does nothing.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02570}02570 \textcolor{comment}{  /// \(\backslash\)b NOTE 1: The current distribution and the new distribution must have}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02571}02571 \textcolor{comment}{  /// the same number of global rows.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02572}02572 \textcolor{comment}{  /// \(\backslash\)b NOTE 2: The current distribution and the new distribution must have}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02573}02573 \textcolor{comment}{  /// the same Communicator.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02574}02574 \textcolor{comment}{}  \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02575}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9ba295a04e08e3153ae06bc0556f507d}{02575}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9ba295a04e08e3153ae06bc0556f507d}{CRDoubleMatrix::redistribute}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02576}02576     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* \textcolor{keyword}{const}\& dist\_pt)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02577}02577   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02578}02578 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02579}02579 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02580}02580     \textcolor{comment}{// paranoid check that the nrows for both distributions is the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02581}02581     \textcolor{comment}{// same}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02582}02582     \textcolor{keywordflow}{if} (dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}() != this-\/>distribution\_pt()-\/>nrow())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02583}02583     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02584}02584       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02585}02585       error\_message << \textcolor{stringliteral}{"{}The number of global rows in the new distribution ("{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02586}02586                     << dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}() << \textcolor{stringliteral}{"{}) is not equal to the number"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02587}02587                     << \textcolor{stringliteral}{"{} of global rows in the current distribution ("{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02588}02588                     << this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_aafad0b69de2284808366b65bd63e493b}{nrow}}() << \textcolor{stringliteral}{"{}).\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02589}02589       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02590}02590         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02591}02591     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02592}02592     \textcolor{comment}{// paranoid check that the current distribution and the new distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02593}02593     \textcolor{comment}{// have the same Communicator}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02594}02594     \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}} temp\_comm(*dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02595}02595     \textcolor{keywordflow}{if} (!(temp\_comm == *this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02596}02596     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02597}02597       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02598}02598       error\_message << \textcolor{stringliteral}{"{}The new distribution and the current distribution must "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02599}02599                     << \textcolor{stringliteral}{"{}have the same communicator."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02600}02600       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02601}02601         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02602}02602     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02603}02603     \textcolor{comment}{// paranoid check that the matrix is build}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02604}02604     \textcolor{keywordflow}{if} (!this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aa0503bc64ef0ccb60cb7d7e645425a62}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02605}02605     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02606}02606       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02607}02607       error\_message << \textcolor{stringliteral}{"{}The matrix must be build to be redistributed"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02608}02608       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02609}02609         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02610}02610     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02611}02611 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02612}02612 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02613}02613     \textcolor{comment}{// if the two distributions are not the same}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02614}02614     \textcolor{comment}{// =========================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02615}02615     \textcolor{keywordflow}{if} (!((*this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) == *dist\_pt))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02616}02616     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02617}02617       \textcolor{comment}{// Get the number of columns to build the matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02618}02618       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}} = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02619}02619 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02620}02620       \textcolor{comment}{// current data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02621}02621       \textcolor{keywordtype}{int}* current\_row\_start = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02622}02622       \textcolor{keywordtype}{int}* current\_column\_index = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02623}02623       \textcolor{keywordtype}{double}* current\_value = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02624}02624 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02625}02625       \textcolor{comment}{// get the rank and the number of processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02626}02626       \textcolor{keywordtype}{int} my\_rank = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02627}02627       \textcolor{keywordtype}{int} nproc = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02628}02628 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02629}02629       \textcolor{comment}{// if both distributions are distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02630}02630       \textcolor{comment}{// =====================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02631}02631       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() \&\& dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02632}02632       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02633}02633         \textcolor{comment}{// new nrow\_local and first\_row data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02634}02634         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} new\_first\_row(nproc);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02635}02635         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} new\_nrow\_local(nproc);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02636}02636         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} current\_first\_row(nproc);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02637}02637         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} current\_nrow\_local(nproc);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02638}02638         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nproc; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02639}02639         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02640}02640           new\_first\_row[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2634e540a78fe1ee3f5c907aff500b58}{first\_row}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02641}02641           new\_nrow\_local[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02642}02642           current\_first\_row[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02643}02643           current\_nrow\_local[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02644}02644         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02645}02645 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02646}02646         \textcolor{comment}{// compute which local rows are expected to be received from each}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02647}02647         \textcolor{comment}{// processor / sent to each processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02648}02648         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} first\_row\_for\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02649}02649         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nrow\_local\_for\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02650}02650         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} first\_row\_from\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02651}02651         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nrow\_local\_from\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02652}02652 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02653}02653         \textcolor{comment}{// for every processor compute first\_row and nrow\_local that will}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02654}02654         \textcolor{comment}{// will sent and received by this processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02655}02655         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02656}02656         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02657}02657           \textcolor{comment}{// start with data to be sent}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02658}02658           \textcolor{keywordflow}{if} ((new\_first\_row[p] <}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02659}02659                (current\_first\_row[my\_rank] + current\_nrow\_local[my\_rank])) \&\&}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02660}02660               (current\_first\_row[my\_rank] <}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02661}02661                (new\_first\_row[p] + new\_nrow\_local[p])))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02662}02662           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02663}02663             first\_row\_for\_proc[p] =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02664}02664               std::max(current\_first\_row[my\_rank], new\_first\_row[p]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02665}02665             nrow\_local\_for\_proc[p] =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02666}02666               std::min(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02667}02667                 (current\_first\_row[my\_rank] + current\_nrow\_local[my\_rank]),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02668}02668                 (new\_first\_row[p] + new\_nrow\_local[p])) -\/}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02669}02669               first\_row\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02670}02670           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02671}02671 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02672}02672           \textcolor{comment}{// and data to be received}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02673}02673           \textcolor{keywordflow}{if} ((new\_first\_row[my\_rank] <}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02674}02674                (current\_first\_row[p] + current\_nrow\_local[p])) \&\&}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02675}02675               (current\_first\_row[p] <}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02676}02676                (new\_first\_row[my\_rank] + new\_nrow\_local[my\_rank])))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02677}02677           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02678}02678             first\_row\_from\_proc[p] =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02679}02679               std::max(current\_first\_row[p], new\_first\_row[my\_rank]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02680}02680             nrow\_local\_from\_proc[p] =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02681}02681               std::min((current\_first\_row[p] + current\_nrow\_local[p]),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02682}02682                        (new\_first\_row[my\_rank] + new\_nrow\_local[my\_rank])) -\/}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02683}02683               first\_row\_from\_proc[p];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02684}02684           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02685}02685         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02686}02686 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02687}02687         \textcolor{comment}{// determine how many nnzs to send to each processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02688}02688         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nnz\_for\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02689}02689         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02690}02690         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02691}02691           \textcolor{keywordflow}{if} (nrow\_local\_for\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02692}02692           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02693}02693             nnz\_for\_proc[p] = (current\_row\_start[first\_row\_for\_proc[p] -\/}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02694}02694                                                  current\_first\_row[my\_rank] +}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02695}02695                                                  nrow\_local\_for\_proc[p]] -\/}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02696}02696                                current\_row\_start[first\_row\_for\_proc[p] -\/}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02697}02697                                                  current\_first\_row[my\_rank]]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02698}02698           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02699}02699         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02700}02700 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02701}02701         \textcolor{comment}{// next post non-\/blocking sends and recv for the nnzs}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02702}02702         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nnz\_from\_proc(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02703}02703         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} send\_req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02704}02704         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} nnz\_recv\_req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02705}02705         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02706}02706         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02707}02707           \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02708}02708           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02709}02709             \textcolor{comment}{// send}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02710}02710             \textcolor{keywordflow}{if} (nrow\_local\_for\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02711}02711             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02712}02712               MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02713}02713               MPI\_Isend(\&nnz\_for\_proc[p],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02714}02714                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02715}02715                         MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02716}02716                         p,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02717}02717                         0,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02718}02718                         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02719}02719                         \&req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02720}02720               send\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02721}02721             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02722}02722 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02723}02723             \textcolor{comment}{// recv}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02724}02724             \textcolor{keywordflow}{if} (nrow\_local\_from\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02725}02725             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02726}02726               MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02727}02727               MPI\_Irecv(\&nnz\_from\_proc[p],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02728}02728                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02729}02729                         MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02730}02730                         p,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02731}02731                         0,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02732}02732                         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02733}02733                         \&req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02734}02734               nnz\_recv\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02735}02735             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02736}02736           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02737}02737           \textcolor{comment}{// "{}send to self"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02738}02738           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02739}02739           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02740}02740             nnz\_from\_proc[p] = nnz\_for\_proc[p];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02741}02741           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02742}02742         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02743}02743 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02744}02744         \textcolor{comment}{// allocate new storage for the new row\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02745}02745         \textcolor{keywordtype}{int}* new\_row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[new\_nrow\_local[my\_rank] + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02746}02746 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02747}02747         \textcolor{comment}{// wait for recvs to complete}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02748}02748         \textcolor{keywordtype}{unsigned} n\_recv\_req = nnz\_recv\_req.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02749}02749         \textcolor{keywordflow}{if} (n\_recv\_req > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02750}02750         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02751}02751           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} recv\_status(n\_recv\_req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02752}02752           MPI\_Waitall(n\_recv\_req, \&nnz\_recv\_req[0], \&recv\_status[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02753}02753         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02754}02754 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02755}02755         \textcolor{comment}{// compute the nnz offset for each processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02756}02756         \textcolor{keywordtype}{unsigned} next\_row = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02757}02757         \textcolor{keywordtype}{unsigned} nnz\_count = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02758}02758         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nnz\_offset(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02759}02759         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02760}02760         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02761}02761           \textcolor{keywordtype}{unsigned} pp = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02762}02762           \textcolor{keywordflow}{while} (new\_first\_row[pp] != next\_row)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02763}02763           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02764}02764             pp++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02765}02765           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02766}02766           nnz\_offset[pp] = nnz\_count;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02767}02767           nnz\_count += nnz\_from\_proc[pp];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02768}02768           next\_row += new\_nrow\_local[pp];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02769}02769         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02770}02770 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02771}02771         \textcolor{comment}{// allocate storage for the values and column indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02772}02772         \textcolor{keywordtype}{int}* new\_column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nnz\_count];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02773}02773         \textcolor{keywordtype}{double}* new\_value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz\_count];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02774}02774 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02775}02775         \textcolor{comment}{// post the sends and recvs for the matrix data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02776}02776         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} recv\_req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02777}02777         MPI\_Aint base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02778}02778         MPI\_Get\_address(new\_value, \&base\_address);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02779}02779         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02780}02780         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02781}02781           \textcolor{comment}{// communicated with other processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02782}02782           \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02783}02783           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02784}02784             \textcolor{comment}{// SEND}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02785}02785             \textcolor{keywordflow}{if} (nrow\_local\_for\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02786}02786             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02787}02787               \textcolor{comment}{// array of datatypes}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02788}02788               MPI\_Datatype types[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02789}02789 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02790}02790               \textcolor{comment}{// array of offsets}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02791}02791               MPI\_Aint offsets[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02792}02792 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02793}02793               \textcolor{comment}{// array of lengths}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02794}02794               \textcolor{keywordtype}{int} len[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02795}02795 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02796}02796               \textcolor{comment}{// row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02797}02797               \textcolor{keywordtype}{unsigned} first\_row\_to\_send =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02798}02798                 first\_row\_for\_proc[p] -\/ current\_first\_row[my\_rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02799}02799               MPI\_Type\_contiguous(nrow\_local\_for\_proc[p], MPI\_INT, \&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02800}02800               MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02801}02801               len[0] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02802}02802               MPI\_Get\_address(current\_row\_start + first\_row\_to\_send,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02803}02803                               \&offsets[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02804}02804               offsets[0] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02805}02805 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02806}02806               \textcolor{comment}{// values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02807}02807               \textcolor{keywordtype}{unsigned} first\_coef\_to\_send =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02808}02808                 current\_row\_start[first\_row\_to\_send];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02809}02809               MPI\_Type\_contiguous(nnz\_for\_proc[p], MPI\_DOUBLE, \&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02810}02810               MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02811}02811               len[1] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02812}02812               MPI\_Get\_address(current\_value + first\_coef\_to\_send, \&offsets[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02813}02813               offsets[1] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02814}02814 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02815}02815               \textcolor{comment}{// column index}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02816}02816               MPI\_Type\_contiguous(nnz\_for\_proc[p], MPI\_DOUBLE, \&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02817}02817               MPI\_Type\_commit(\&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02818}02818               len[2] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02819}02819               MPI\_Get\_address(current\_column\_index + first\_coef\_to\_send,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02820}02820                               \&offsets[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02821}02821               offsets[2] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02822}02822 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02823}02823               \textcolor{comment}{// build the combined datatype}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02824}02824               MPI\_Datatype send\_type;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02825}02825               MPI\_Type\_create\_struct(3, len, offsets, types, \&send\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02826}02826               MPI\_Type\_commit(\&send\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02827}02827               MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02828}02828               MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02829}02829               MPI\_Type\_free(\&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02830}02830 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02831}02831               \textcolor{comment}{// and send}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02832}02832               MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02833}02833               MPI\_Isend(new\_value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02834}02834                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02835}02835                         send\_type,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02836}02836                         p,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02837}02837                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02838}02838                         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02839}02839                         \&req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02840}02840               send\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02841}02841               MPI\_Type\_free(\&send\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02842}02842             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02843}02843 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02844}02844             \textcolor{comment}{// RECV}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02845}02845             \textcolor{keywordflow}{if} (nrow\_local\_from\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02846}02846             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02847}02847               \textcolor{comment}{// array of datatypes}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02848}02848               MPI\_Datatype types[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02849}02849 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02850}02850               \textcolor{comment}{// array of offsets}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02851}02851               MPI\_Aint offsets[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02852}02852 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02853}02853               \textcolor{comment}{// array of lengths}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02854}02854               \textcolor{keywordtype}{int} len[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02855}02855 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02856}02856               \textcolor{comment}{// row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02857}02857               \textcolor{keywordtype}{unsigned} first\_row\_to\_recv =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02858}02858                 first\_row\_from\_proc[p] -\/ new\_first\_row[my\_rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02859}02859               MPI\_Type\_contiguous(nrow\_local\_from\_proc[p], MPI\_INT, \&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02860}02860               MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02861}02861               len[0] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02862}02862               MPI\_Get\_address(new\_row\_start + first\_row\_to\_recv, \&offsets[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02863}02863               offsets[0] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02864}02864 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02865}02865               \textcolor{comment}{// values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02866}02866               \textcolor{keywordtype}{unsigned} first\_coef\_to\_recv = nnz\_offset[p];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02867}02867               MPI\_Type\_contiguous(nnz\_from\_proc[p], MPI\_DOUBLE, \&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02868}02868               MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02869}02869               len[1] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02870}02870               MPI\_Get\_address(new\_value + first\_coef\_to\_recv, \&offsets[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02871}02871               offsets[1] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02872}02872 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02873}02873               \textcolor{comment}{// column index}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02874}02874               MPI\_Type\_contiguous(nnz\_from\_proc[p], MPI\_INT, \&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02875}02875               MPI\_Type\_commit(\&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02876}02876               len[2] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02877}02877               MPI\_Get\_address(new\_column\_index + first\_coef\_to\_recv,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02878}02878                               \&offsets[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02879}02879               offsets[2] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02880}02880 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02881}02881               \textcolor{comment}{// build the combined datatype}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02882}02882               MPI\_Datatype recv\_type;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02883}02883               MPI\_Type\_create\_struct(3, len, offsets, types, \&recv\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02884}02884               MPI\_Type\_commit(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02885}02885               MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02886}02886               MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02887}02887               MPI\_Type\_free(\&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02888}02888 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02889}02889               \textcolor{comment}{// and send}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02890}02890               MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02891}02891               MPI\_Irecv(new\_value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02892}02892                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02893}02893                         recv\_type,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02894}02894                         p,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02895}02895                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02896}02896                         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02897}02897                         \&req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02898}02898               recv\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02899}02899               MPI\_Type\_free(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02900}02900             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02901}02901           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02902}02902           \textcolor{comment}{// other wise transfer data internally}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02903}02903           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02904}02904           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02905}02905             \textcolor{keywordtype}{unsigned} j =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02906}02906               first\_row\_for\_proc[my\_rank] -\/ current\_first\_row[my\_rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02907}02907             \textcolor{keywordtype}{unsigned} k = first\_row\_from\_proc[my\_rank] -\/ new\_first\_row[my\_rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02908}02908             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local\_for\_proc[my\_rank]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02909}02909             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02910}02910               new\_row\_start[k + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = current\_row\_start[j + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02911}02911             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02912}02912             \textcolor{keywordtype}{unsigned} first\_coef\_to\_send = current\_row\_start[j];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02913}02913             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nnz\_for\_proc[my\_rank]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02914}02914             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02915}02915               new\_value[nnz\_offset[p] + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02916}02916                 current\_value[first\_coef\_to\_send + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02917}02917               new\_column\_index[nnz\_offset[p] + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02918}02918                 current\_column\_index[first\_coef\_to\_send + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02919}02919             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02920}02920           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02921}02921         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02922}02922 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02923}02923         \textcolor{comment}{// wait for all recvs to complete}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02924}02924         n\_recv\_req = recv\_req.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02925}02925         \textcolor{keywordflow}{if} (n\_recv\_req > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02926}02926         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02927}02927           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} recv\_status(n\_recv\_req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02928}02928           MPI\_Waitall(n\_recv\_req, \&recv\_req[0], \&recv\_status[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02929}02929         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02930}02930 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02931}02931         \textcolor{comment}{// next we need to update the row starts}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02932}02932         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02933}02933         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02934}02934           \textcolor{keywordflow}{if} (nrow\_local\_from\_proc[p] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02935}02935           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02936}02936             \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02937}02937               first\_row\_from\_proc[p] -\/ new\_first\_row[my\_rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02938}02938             \textcolor{keywordtype}{unsigned} last\_row = \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} + nrow\_local\_from\_proc[p] -\/ 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02939}02939             \textcolor{keywordtype}{int} update = nnz\_offset[p] -\/ new\_row\_start[\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02940}02940             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} <= last\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02941}02941             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02942}02942               new\_row\_start[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += update;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02943}02943             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02944}02944           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02945}02945         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02946}02946         new\_row\_start[dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}()] = nnz\_count;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02947}02947 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02948}02948         \textcolor{comment}{// wait for sends to complete}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02949}02949         \textcolor{keywordtype}{unsigned} n\_send\_req = send\_req.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02950}02950         \textcolor{keywordflow}{if} (n\_recv\_req > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02951}02951         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02952}02952           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} send\_status(n\_recv\_req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02953}02953           MPI\_Waitall(n\_send\_req, \&send\_req[0], \&send\_status[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02954}02954         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02955}02955         \textcolor{comment}{// if (my\_rank == 0)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02956}02956         \textcolor{comment}{//  \{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02957}02957         \textcolor{comment}{//   CRDoubleMatrix* m\_pt = this-\/>global\_matrix();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02958}02958         \textcolor{comment}{//   m\_pt-\/>sparse\_indexed\_output("{}m1.dat"{});}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02959}02959         \textcolor{comment}{//  \}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02960}02960 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02961}02961         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02962}02962         this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02963}02963         this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02964}02964           ncol, nnz\_count, new\_value, new\_column\_index, new\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02965}02965         \textcolor{comment}{// if (my\_rank == 0)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02966}02966         \textcolor{comment}{//  \{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02967}02967         \textcolor{comment}{//   CRDoubleMatrix* m\_pt = this-\/>global\_matrix();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02968}02968         \textcolor{comment}{//   m\_pt-\/>sparse\_indexed\_output("{}m2.dat"{});}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02969}02969         \textcolor{comment}{//  \}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02970}02970         \textcolor{comment}{//       this-\/>sparse\_indexed\_output(oomph\_info);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02971}02971         abort();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02972}02972       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02973}02973 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02974}02974       \textcolor{comment}{// if this matrix is distributed but the new distributed matrix is global}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02975}02975       \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02976}02976       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() \&\& !dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02977}02977       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02978}02978         \textcolor{comment}{// nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02979}02979         \textcolor{keywordtype}{int} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}} = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02980}02980 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02981}02981         \textcolor{comment}{// nrow global}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02982}02982         \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}} = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02983}02983 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02984}02984         \textcolor{comment}{// cache nproc}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02985}02985         \textcolor{keywordtype}{int} nproc = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02986}02986 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02987}02987         \textcolor{comment}{// get the nnzs on the other processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02988}02988         \textcolor{keywordtype}{int}* dist\_nnz\_pt = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02989}02989         MPI\_Allgather(\&\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02990}02990                       1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02991}02991                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02992}02992                       dist\_nnz\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02993}02993                       1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02994}02994                       MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02995}02995                       this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02996}02996 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02997}02997         \textcolor{comment}{// create an int array of first rows and nrow local and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02998}02998         \textcolor{comment}{// compute nnz global}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l02999}02999         \textcolor{keywordtype}{int}* dist\_first\_row = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03000}03000         \textcolor{keywordtype}{int}* dist\_nrow\_local = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nproc];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03001}03001         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03002}03002         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03003}03003           dist\_first\_row[p] = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}}(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03004}03004           dist\_nrow\_local[p] = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03005}03005         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03006}03006 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03007}03007         \textcolor{comment}{// conpute the offset for the values and column index data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03008}03008         \textcolor{comment}{// compute the nnz offset for each processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03009}03009         \textcolor{keywordtype}{int} next\_row = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03010}03010         \textcolor{keywordtype}{unsigned} nnz\_count = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03011}03011         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} nnz\_offset(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03012}03012         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03013}03013         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03014}03014           \textcolor{keywordtype}{unsigned} pp = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03015}03015           \textcolor{keywordflow}{while} (dist\_first\_row[pp] != next\_row)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03016}03016           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03017}03017             pp++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03018}03018           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03019}03019           nnz\_offset[pp] = nnz\_count;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03020}03020           nnz\_count += dist\_nnz\_pt[pp];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03021}03021           next\_row += dist\_nrow\_local[pp];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03022}03022         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03023}03023 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03024}03024         \textcolor{comment}{// get pointers to the (current) distributed data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03025}03025         \textcolor{keywordtype}{int}* dist\_row\_start = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03026}03026         \textcolor{keywordtype}{int}* dist\_column\_index = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03027}03027         \textcolor{keywordtype}{double}* dist\_value = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03028}03028 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03029}03029         \textcolor{comment}{// space for the global matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03030}03030         \textcolor{keywordtype}{int}* global\_row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03031}03031         \textcolor{keywordtype}{int}* global\_column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nnz\_count];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03032}03032         \textcolor{keywordtype}{double}* global\_value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[nnz\_count];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03033}03033 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03034}03034         \textcolor{comment}{// post the sends and recvs for the matrix data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03035}03035         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} recv\_req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03036}03036         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Request>}} send\_req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03037}03037         MPI\_Aint base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03038}03038         MPI\_Get\_address(global\_value, \&base\_address);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03039}03039 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03040}03040         \textcolor{comment}{// SEND}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03041}03041         \textcolor{keywordflow}{if} (dist\_nrow\_local[my\_rank] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03042}03042         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03043}03043           \textcolor{comment}{// types}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03044}03044           MPI\_Datatype types[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03045}03045 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03046}03046           \textcolor{comment}{// offsets}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03047}03047           MPI\_Aint offsets[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03048}03048 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03049}03049           \textcolor{comment}{// lengths}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03050}03050           \textcolor{keywordtype}{int} len[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03051}03051 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03052}03052           \textcolor{comment}{// row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03053}03053           MPI\_Type\_contiguous(dist\_nrow\_local[my\_rank], MPI\_INT, \&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03054}03054           MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03055}03055           MPI\_Get\_address(dist\_row\_start, \&offsets[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03056}03056           offsets[0] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03057}03057           len[0] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03058}03058 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03059}03059           \textcolor{comment}{// value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03060}03060           MPI\_Type\_contiguous(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}, MPI\_DOUBLE, \&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03061}03061           MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03062}03062           MPI\_Get\_address(dist\_value, \&offsets[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03063}03063           offsets[1] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03064}03064           len[1] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03065}03065 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03066}03066           \textcolor{comment}{// column indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03067}03067           MPI\_Type\_contiguous(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}, MPI\_INT, \&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03068}03068           MPI\_Type\_commit(\&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03069}03069           MPI\_Get\_address(dist\_column\_index, \&offsets[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03070}03070           offsets[2] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03071}03071           len[2] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03072}03072 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03073}03073           \textcolor{comment}{// build the send type}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03074}03074           MPI\_Datatype send\_type;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03075}03075           MPI\_Type\_create\_struct(3, len, offsets, types, \&send\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03076}03076           MPI\_Type\_commit(\&send\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03077}03077           MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03078}03078           MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03079}03079           MPI\_Type\_free(\&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03080}03080 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03081}03081           \textcolor{comment}{// and send}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03082}03082           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03083}03083           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03084}03084             \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03085}03085             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03086}03086               MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03087}03087               MPI\_Isend(global\_value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03088}03088                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03089}03089                         send\_type,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03090}03090                         p,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03091}03091                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03092}03092                         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03093}03093                         \&req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03094}03094               send\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03095}03095             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03096}03096           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03097}03097           MPI\_Type\_free(\&send\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03098}03098         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03099}03099 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03100}03100         \textcolor{comment}{// RECV}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03101}03101         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03102}03102         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03103}03103           \textcolor{comment}{// communicated with other processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03104}03104           \textcolor{keywordflow}{if} (p != my\_rank)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03105}03105           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03106}03106             \textcolor{comment}{// RECV}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03107}03107             \textcolor{keywordflow}{if} (dist\_nrow\_local[p] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03108}03108             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03109}03109               \textcolor{comment}{// types}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03110}03110               MPI\_Datatype types[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03111}03111 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03112}03112               \textcolor{comment}{// offsets}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03113}03113               MPI\_Aint offsets[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03114}03114 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03115}03115               \textcolor{comment}{// lengths}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03116}03116               \textcolor{keywordtype}{int} len[3];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03117}03117 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03118}03118               \textcolor{comment}{// row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03119}03119               MPI\_Type\_contiguous(dist\_nrow\_local[p], MPI\_INT, \&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03120}03120               MPI\_Type\_commit(\&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03121}03121               MPI\_Get\_address(global\_row\_start + dist\_first\_row[p],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03122}03122                               \&offsets[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03123}03123               offsets[0] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03124}03124               len[0] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03125}03125 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03126}03126               \textcolor{comment}{// value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03127}03127               MPI\_Type\_contiguous(dist\_nnz\_pt[p], MPI\_DOUBLE, \&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03128}03128               MPI\_Type\_commit(\&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03129}03129               MPI\_Get\_address(global\_value + nnz\_offset[p], \&offsets[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03130}03130               offsets[1] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03131}03131               len[1] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03132}03132 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03133}03133               \textcolor{comment}{// column indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03134}03134               MPI\_Type\_contiguous(dist\_nnz\_pt[p], MPI\_INT, \&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03135}03135               MPI\_Type\_commit(\&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03136}03136               MPI\_Get\_address(global\_column\_index + nnz\_offset[p], \&offsets[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03137}03137               offsets[2] -\/= base\_address;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03138}03138               len[2] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03139}03139 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03140}03140               \textcolor{comment}{// build the send type}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03141}03141               MPI\_Datatype recv\_type;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03142}03142               MPI\_Type\_create\_struct(3, len, offsets, types, \&recv\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03143}03143               MPI\_Type\_commit(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03144}03144               MPI\_Type\_free(\&types[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03145}03145               MPI\_Type\_free(\&types[1]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03146}03146               MPI\_Type\_free(\&types[2]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03147}03147 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03148}03148               \textcolor{comment}{// and send}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03149}03149               MPI\_Request req;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03150}03150               MPI\_Irecv(global\_value,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03151}03151                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03152}03152                         recv\_type,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03153}03153                         p,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03154}03154                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03155}03155                         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03156}03156                         \&req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03157}03157               recv\_req.push\_back(req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03158}03158               MPI\_Type\_free(\&recv\_type);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03159}03159             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03160}03160           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03161}03161           \textcolor{comment}{// otherwise send to self}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03162}03162           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03163}03163           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03164}03164             \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} = dist\_nrow\_local[my\_rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03165}03165             \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} = dist\_first\_row[my\_rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03166}03166             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03167}03167             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03168}03168               global\_row\_start[\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = dist\_row\_start[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03169}03169             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03170}03170             \textcolor{keywordtype}{unsigned} offset = nnz\_offset[my\_rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03171}03171             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03172}03172             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03173}03173               global\_value[offset + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = dist\_value[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03174}03174               global\_column\_index[offset + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = dist\_column\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03175}03175             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03176}03176           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03177}03177         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03178}03178 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03179}03179         \textcolor{comment}{// wait for all recvs to complete}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03180}03180         \textcolor{keywordtype}{unsigned} n\_recv\_req = recv\_req.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03181}03181         \textcolor{keywordflow}{if} (n\_recv\_req > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03182}03182         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03183}03183           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} recv\_status(n\_recv\_req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03184}03184           MPI\_Waitall(n\_recv\_req, \&recv\_req[0], \&recv\_status[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03185}03185         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03186}03186 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03187}03187         \textcolor{comment}{// finally the last row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03188}03188         global\_row\_start[\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}] = nnz\_count;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03189}03189 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03190}03190         \textcolor{comment}{// update the other row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03191}03191         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nproc; p++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03192}03192         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03193}03193           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < dist\_nrow\_local[p]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03194}03194           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03195}03195             \textcolor{keywordtype}{unsigned} j = dist\_first\_row[p] + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03196}03196             global\_row\_start[j] += nnz\_offset[p];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03197}03197           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03198}03198         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03199}03199 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03200}03200         \textcolor{comment}{// wait for sends to complete}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03201}03201         \textcolor{keywordtype}{unsigned} n\_send\_req = send\_req.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03202}03202         \textcolor{keywordflow}{if} (n\_recv\_req > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03203}03203         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03204}03204           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<MPI\_Status>}} send\_status(n\_recv\_req);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03205}03205           MPI\_Waitall(n\_send\_req, \&send\_req[0], \&send\_status[0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03206}03206         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03207}03207 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03208}03208         \textcolor{comment}{// rebuild the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03209}03209         \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03210}03210           this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt(), \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03211}03211         this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03212}03212         this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03213}03213           ncol, nnz\_count, global\_value, global\_column\_index, global\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03214}03214 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03215}03215         \textcolor{comment}{// clean up}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03216}03216         \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03217}03217         \textcolor{keyword}{delete}[] dist\_first\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03218}03218         \textcolor{keyword}{delete}[] dist\_nrow\_local;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03219}03219         \textcolor{keyword}{delete}[] dist\_nnz\_pt;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03220}03220       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03221}03221 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03222}03222       \textcolor{comment}{// other the matrix is not distributed but it needs to be turned}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03223}03223       \textcolor{comment}{// into a distributed matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03224}03224       \textcolor{comment}{// =============================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03225}03225       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() \&\& dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03226}03226       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03227}03227         \textcolor{comment}{// cache the new nrow\_local}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03228}03228         \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} = dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03229}03229 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03230}03230         \textcolor{comment}{// and first\_row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03231}03231         \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} = dist\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2634e540a78fe1ee3f5c907aff500b58}{first\_row}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03232}03232 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03233}03233         \textcolor{comment}{// get pointers to the (current) distributed data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03234}03234         \textcolor{keywordtype}{int}* global\_row\_start = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03235}03235         \textcolor{keywordtype}{int}* global\_column\_index = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03236}03236         \textcolor{keywordtype}{double}* global\_value = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03237}03237 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03238}03238         \textcolor{comment}{// determine the number of non zeros required by this processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03239}03239         \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}} = global\_row\_start[\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} + \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}] -\/}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03240}03240                        global\_row\_start[\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03241}03241 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03242}03242         \textcolor{comment}{// allocate}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03243}03243         \textcolor{keywordtype}{int}* dist\_row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03244}03244         \textcolor{keywordtype}{int}* dist\_column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03245}03245         \textcolor{keywordtype}{double}* dist\_value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03246}03246 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03247}03247         \textcolor{comment}{// copy}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03248}03248         \textcolor{keywordtype}{int} offset = global\_row\_start[\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03249}03249         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} <= \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03250}03250         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03251}03251           dist\_row\_start[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = global\_row\_start[\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ offset;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03252}03252         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03253}03253         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03254}03254         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03255}03255           dist\_column\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = global\_column\_index[offset + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03256}03256           dist\_value[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = global\_value[offset + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03257}03257         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03258}03258 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03259}03259         \textcolor{comment}{// rebuild}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03260}03260         this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(dist\_pt);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03261}03261         this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafb4d7de0a87b4bda560928e6a128060}{build\_without\_copy}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03262}03262           ncol, \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}, dist\_value, dist\_column\_index, dist\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03263}03263       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03264}03264     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03265}03265 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03266}03266   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03267}03267 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03268}03268   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03269}03269 \textcolor{comment}{  /// Compute transpose of matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03270}03270 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03271}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a82cb428139f7c35a7c62a09fad38eecb}{03271}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a82cb428139f7c35a7c62a09fad38eecb}{CRDoubleMatrix::get\_matrix\_transpose}}(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* result)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03272}03272 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03273}03273     \textcolor{comment}{// Get the number of non\_zeros}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03274}03274     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} nnon\_zeros = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9482dafc0a17ebc5b7431369d8d07565}{nnz}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03275}03275 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03276}03276     \textcolor{comment}{// Find the number of rows and columns in the transposed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03277}03277     \textcolor{comment}{// matrix. We differentiate these from those associated}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03278}03278     \textcolor{comment}{// with the original matrix by appending the characters}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03279}03279     \textcolor{comment}{// '\_t' onto the end}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03280}03280     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_rows = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03281}03281     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_rows\_t = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03282}03282 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03283}03283 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03284}03284     \textcolor{comment}{// We only need to produce a warning if the matrix is distributed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03285}03285     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03286}03286     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03287}03287       \textcolor{comment}{// Create an ostringstream object to store the warning message}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03288}03288       std::ostringstream warning\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03289}03289 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03290}03290       \textcolor{comment}{// Create the warning messsage}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03291}03291       warning\_message << \textcolor{stringliteral}{"{}This method currently works for serial but "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03292}03292                       << \textcolor{stringliteral}{"{}has not been tested with MPI!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03293}03293 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03294}03294       \textcolor{comment}{// Issue the warning}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03295}03295       \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warning\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03296}03296                       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03297}03297                       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03298}03298     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03299}03299 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03300}03300 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03301}03301     \textcolor{comment}{// Set up the distribution for the transposed matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03302}03302     result-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03303}03303       this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt(), n\_rows\_t, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03304}03304 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03305}03305     \textcolor{comment}{// Acquire access to the value, row\_start and column\_index}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03306}03306     \textcolor{comment}{// arrays from the CR matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03307}03307     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* value\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03308}03308     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* row\_start\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03309}03309     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* column\_index\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03310}03310 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03311}03311     \textcolor{comment}{// Allocate space for the row\_start and column\_index vectors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03312}03312     \textcolor{comment}{// associated with the transpose of the current matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03313}03313     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} value\_t(nnon\_zeros, 0.0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03314}03314     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} column\_index\_t(nnon\_zeros, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03315}03315     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} row\_start\_t(n\_rows\_t + 1, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03316}03316 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03317}03317     \textcolor{comment}{// Loop over the column index vector and count how many times}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03318}03318     \textcolor{comment}{// each column number occurs and increment the appropriate}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03319}03319     \textcolor{comment}{// entry in row\_start\_t whose i+1'th entry will contain the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03320}03320     \textcolor{comment}{// number of non-\/zeros in the i'th column of the matrix (this}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03321}03321     \textcolor{comment}{// is done so that the cumulative sum done next returns the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03322}03322     \textcolor{comment}{// correct result)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03323}03323     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nnon\_zeros; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03324}03324     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03325}03325       \textcolor{comment}{// Assign entries to row\_start\_t (noting the first}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03326}03326       \textcolor{comment}{// entry is left as 0 for the cumulative sum done later)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03327}03327       row\_start\_t[*(column\_index\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) + 1]++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03328}03328     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03329}03329 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03330}03330     \textcolor{comment}{// Calculate the sum of the first i entries in the row\_start\_t}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03331}03331     \textcolor{comment}{// vector and store the values in the i'th entry of row\_start\_t}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03332}03332     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_rows\_t + 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03333}03333     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03334}03334       \textcolor{comment}{// Calculate the cumulative sum}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03335}03335       row\_start\_t[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += row\_start\_t[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} -\/ 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03336}03336     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03337}03337 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03338}03338     \textcolor{comment}{// Allocate space for variables to store the indices of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03339}03339     \textcolor{comment}{// start and end of the non-\/zeros in a given row of the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03340}03340     \textcolor{keywordtype}{unsigned} i\_row\_s = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03341}03341     \textcolor{keywordtype}{unsigned} i\_row\_e = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03342}03342 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03343}03343     \textcolor{comment}{// Initialise 3 extra variables for readability of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03344}03344     \textcolor{comment}{// code in the subsequent piece of code}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03345}03345     \textcolor{keywordtype}{unsigned} a = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03346}03346     \textcolor{keywordtype}{unsigned} b = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03347}03347     \textcolor{keywordtype}{unsigned} c = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03348}03348 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03349}03349     \textcolor{comment}{// Vector needed to count the number of entries added}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03350}03350     \textcolor{comment}{// to each segment in column\_index\_t where each segment}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03351}03351     \textcolor{comment}{// is associated with each row in the transposed matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03352}03352     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} counter(n\_rows\_t, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03353}03353 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03354}03354     \textcolor{comment}{// Set the entries in column\_index\_t. To do this we loop}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03355}03355     \textcolor{comment}{// over each row of the original matrix (equivalently}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03356}03356     \textcolor{comment}{// the number of columns in the transpose)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03357}03357     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i\_row = 0; i\_row < n\_rows; i\_row++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03358}03358     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03359}03359       \textcolor{comment}{// Here we find the indices of the start and end}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03360}03360       \textcolor{comment}{// of the non-\/zeros in i\_row'th row of the matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03361}03361       \textcolor{comment}{// [Note, there should be a -\/1 on i\_row\_e but this}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03362}03362       \textcolor{comment}{// is ignored so that we use a strict inequality}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03363}03363       \textcolor{comment}{// in the subsequent for-\/loop!]}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03364}03364       i\_row\_s = *(row\_start\_pt + i\_row);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03365}03365       i\_row\_e = *(row\_start\_pt + i\_row + 1);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03366}03366 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03367}03367       \textcolor{comment}{// Loop over the entries in the i\_row'th row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03368}03368       \textcolor{comment}{// of the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03369}03369       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = i\_row\_s; j < i\_row\_e; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03370}03370       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03371}03371         \textcolor{comment}{// The value of a is the column index of the j'th}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03372}03372         \textcolor{comment}{// element in the i\_row'th row of the original matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03373}03373         \textcolor{comment}{// (which is also the row index of the associated}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03374}03374         \textcolor{comment}{// non-\/zero in the transposed matrix)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03375}03375         a = *(column\_index\_pt + j);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03376}03376 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03377}03377         \textcolor{comment}{// The value of b will be used to find the start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03378}03378         \textcolor{comment}{// of the appropriate segment of column\_index\_t}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03379}03379         \textcolor{comment}{// that the non-\/zero belongs in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03380}03380         b = row\_start\_t[a];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03381}03381 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03382}03382         \textcolor{comment}{// Find the number of elements already added to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03383}03383         \textcolor{comment}{// this segment (to find which entry of the segment}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03384}03384         \textcolor{comment}{// the value i\_row, the column index of the non-\/zero}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03385}03385         \textcolor{comment}{// in the transposed matrix, should be assigned to)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03386}03386         c = counter[*(column\_index\_pt + j)];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03387}03387 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03388}03388         \textcolor{comment}{// Assign the value i\_row to the appropriate entry}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03389}03389         \textcolor{comment}{// in column\_index\_t}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03390}03390         column\_index\_t[b + c] = i\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03391}03391         value\_t[b + c] = *(value\_pt + j);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03392}03392 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03393}03393         \textcolor{comment}{// Increment the j'th value of the vector counter}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03394}03394         \textcolor{comment}{// to indicate another non-\/zero index has been}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03395}03395         \textcolor{comment}{// added into the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03396}03396         counter[*(column\_index\_pt + j)]++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03397}03397 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03398}03398       \} \textcolor{comment}{// End of for-\/loop over i\_row'th row of the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03399}03399 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03400}03400     \} \textcolor{comment}{// End of for-\/loop over rows of the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03401}03401 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03402}03402     \textcolor{comment}{// Build the matrix (note: the value of n\_cols for the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03403}03403     \textcolor{comment}{// transposed matrix is n\_rows for the original matrix)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03404}03404     result-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(n\_rows, value\_t, column\_index\_t, row\_start\_t);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03405}03405 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03406}03406   \} \textcolor{comment}{// End of the function}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03407}03407 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03408}03408 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03409}03409   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03410}03410 \textcolor{comment}{  /// Compute infinity (maximum) norm of matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03411}03411 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03412}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cd938ba5f026f1508239cef05b16cb4}{03412}}   \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a6cd938ba5f026f1508239cef05b16cb4}{CRDoubleMatrix::inf\_norm}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03413}03413 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03414}03414 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03415}03415     \textcolor{comment}{// paranoid check that the vector is setup}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03416}03416     \textcolor{keywordflow}{if} (!this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a8c35baa65e335043f62954c92c090a5a}{distribution\_built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03417}03417     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03418}03418       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03419}03419       error\_message << \textcolor{stringliteral}{"{}This matrix must be setup."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03420}03420       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03421}03421         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03422}03422     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03423}03423 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03424}03424 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03425}03425     \textcolor{comment}{// compute the local norm}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03426}03426     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03427}03427     \textcolor{keywordtype}{double} n = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03428}03428     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03429}03429     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}} = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03430}03430     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03431}03431     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03432}03432       \textcolor{keywordtype}{double} a = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03433}03433       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]; j < \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1]; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03434}03434       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03435}03435         a += fabs(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}[j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03436}03436       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03437}03437       n = std::max(n, a);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03438}03438     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03439}03439 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03440}03440     \textcolor{comment}{// if this vector is distributed and on multiple processors then gather}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03441}03441 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03442}03442     \textcolor{keywordtype}{double} n2 = n;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03443}03443     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}() \&\&}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03444}03444         this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03445}03445     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03446}03446       MPI\_Allreduce(\&n,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03447}03447                     \&n2,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03448}03448                     1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03449}03449                     MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03450}03450                     MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03451}03451                     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>communicator\_pt()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03452}03452     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03453}03453     n = n2;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03454}03454 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03455}03455 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03456}03456     \textcolor{comment}{// and return}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03457}03457     \textcolor{keywordflow}{return} n;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03458}03458   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03459}03459 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03460}03460   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03461}03461 \textcolor{comment}{  /// Return the diagonal entries of the matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03462}03462 \textcolor{comment}{  /// This only works with square matrices. This condition may be relaxed}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03463}03463 \textcolor{comment}{  /// in the future if need be.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03464}03464 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03465}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad438e693468cd0ae179460eafcaab038}{03465}}   \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad438e693468cd0ae179460eafcaab038}{CRDoubleMatrix::diagonal\_entries}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03466}03466 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03467}03467 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03468}03468     \textcolor{comment}{// Check if the matrix has been built.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03469}03469     \textcolor{keywordflow}{if} (!this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aa0503bc64ef0ccb60cb7d7e645425a62}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03470}03470     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03471}03471       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03472}03472       error\_message << \textcolor{stringliteral}{"{}The matrix has not been built.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03473}03473                     << \textcolor{stringliteral}{"{}Please build it...\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03474}03474       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03475}03475         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03476}03476     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03477}03477 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03478}03478     \textcolor{comment}{// Check if this is a square matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03479}03479     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}() != this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03480}03480     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03481}03481       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03482}03482       error\_message << \textcolor{stringliteral}{"{}The matrix is not square. Can only get the diagonal\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03483}03483                     << \textcolor{stringliteral}{"{}entries of a square matrix.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03484}03484       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03485}03485         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03486}03486     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03487}03487 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03488}03488 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03489}03489     \textcolor{comment}{// We get the diagonal entries on this processor.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03490}03490     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03491}03491 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03492}03492     \textcolor{comment}{// Create storage for the diagonal entries.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03493}03493     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} result\_vec;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03494}03494     result\_vec.reserve(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}});}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03495}03495 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03496}03496     \textcolor{comment}{// Get the first row for the column offset.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03497}03497     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03498}03498 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03499}03499     \textcolor{comment}{// Loop through the local rows.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03500}03500     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03501}03501     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03502}03502       \textcolor{comment}{// The column entries are globally indexed.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03503}03503       \textcolor{keywordtype}{unsigned} diag\_entry\_col = \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ab00a3919b8634c698749f14a4d92947d}{first\_row}} + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03504}03504 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03505}03505       \textcolor{comment}{// Push back the diagonal entry.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03506}03506       result\_vec.push\_back(\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aefc9a269911694cdd5bde98dc536148f}{CR\_matrix}}.get\_entry(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, diag\_entry\_col));}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03507}03507     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03508}03508 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03509}03509     \textcolor{keywordflow}{return} result\_vec;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03510}03510   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03511}03511 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03512}03512   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03513}03513 \textcolor{comment}{  /// Element-\/wise addition of this matrix with matrix\_in.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03514}03514 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03515}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a57f88253acfa87a764652c06c1bdc362}{03515}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a57f88253acfa87a764652c06c1bdc362}{CRDoubleMatrix::add}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& matrix\_in,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03516}03516                            \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& result\_matrix)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03517}03517 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03518}03518 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03519}03519     \textcolor{comment}{// Check if this matrix is built.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03520}03520     \textcolor{keywordflow}{if} (!this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aa0503bc64ef0ccb60cb7d7e645425a62}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03521}03521     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03522}03522       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03523}03523       error\_message << \textcolor{stringliteral}{"{}The matrix is not built.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03524}03524                     << \textcolor{stringliteral}{"{}Please build the matrix!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03525}03525       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03526}03526         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03527}03527     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03528}03528 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03529}03529     \textcolor{comment}{// Check if this matrix\_in is built.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03530}03530     \textcolor{keywordflow}{if} (!matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aa0503bc64ef0ccb60cb7d7e645425a62}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03531}03531     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03532}03532       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03533}03533       error\_message << \textcolor{stringliteral}{"{}The matrix matrix\_in is not built.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03534}03534                     << \textcolor{stringliteral}{"{}Please build the matrix!\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03535}03535       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03536}03536         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03537}03537     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03538}03538 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03539}03539     \textcolor{comment}{// Check if the dimensions of this matrix and matrix\_in are the same.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03540}03540     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_nrow = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03541}03541     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} matrix\_in\_nrow = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03542}03542     \textcolor{keywordflow}{if} (this\_nrow != matrix\_in\_nrow)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03543}03543     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03544}03544       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03545}03545       error\_message << \textcolor{stringliteral}{"{}matrix\_in has a different number of rows than\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03546}03546                     << \textcolor{stringliteral}{"{}this matrix.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03547}03547       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03548}03548         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03549}03549     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03550}03550 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03551}03551     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} this\_ncol = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03552}03552     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} matrix\_in\_ncol = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03553}03553     \textcolor{keywordflow}{if} (this\_ncol != matrix\_in\_ncol)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03554}03554     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03555}03555       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03556}03556       error\_message << \textcolor{stringliteral}{"{}matrix\_in has a different number of columns than\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03557}03557                     << \textcolor{stringliteral}{"{}this matrix.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03558}03558       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03559}03559         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03560}03560     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03561}03561 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03562}03562     \textcolor{comment}{// Check if the distribution is the same (Otherwise we may have to send and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03563}03563     \textcolor{comment}{// receive data from other processors -\/ which is not implemented!)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03564}03564     \textcolor{keywordflow}{if} (*(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()) != *(matrix\_in.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03565}03565     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03566}03566       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03567}03567       error\_message << \textcolor{stringliteral}{"{}matrix\_in must have the same distribution as\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03568}03568                     << \textcolor{stringliteral}{"{}this matrix.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03569}03569       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03570}03570         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03571}03571     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03572}03572 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03573}03573     \textcolor{comment}{// If the matrix is built, check that it's existing distribution is the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03574}03574     \textcolor{comment}{// same as the in matrix. Since we'll use the same distribution instead}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03575}03575     \textcolor{comment}{// of completely rebuilding it.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03576}03576     \textcolor{keywordflow}{if} (result\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aa0503bc64ef0ccb60cb7d7e645425a62}{built}}() \&\&}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03577}03577         (*result\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() != *matrix\_in.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03578}03578     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03579}03579       std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03580}03580       error\_message << \textcolor{stringliteral}{"{}The result\_matrix is built. "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03581}03581                     << \textcolor{stringliteral}{"{}But has a different distribution from matrix\_in \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03582}03582                     << \textcolor{stringliteral}{"{}They need to be the same.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03583}03583       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03584}03584         error\_message.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03585}03585     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03586}03586 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03587}03587 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03588}03588     \textcolor{comment}{// To add the elements of two CRDoubleMatrices, we need to know the union of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03589}03589     \textcolor{comment}{// the sparsity patterns. This is determined by the column indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03590}03590     \textcolor{comment}{// We add the column indices and values (entries) as a key-\/value pair in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03591}03591     \textcolor{comment}{// a map (per row). We then read these out into two column indices and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03592}03592     \textcolor{comment}{// values vector for the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03593}03593 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03594}03594     \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03595}03595     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} res\_column\_indices;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03596}03596     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} res\_values;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03597}03597     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}} res\_row\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03598}03598     res\_row\_start.reserve(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}} + 1);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03599}03599 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03600}03600     \textcolor{comment}{// The row\_start and column\_indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03601}03601     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* this\_column\_indices = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03602}03602     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* this\_row\_start = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03603}03603     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* in\_column\_indices = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03604}03604     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* in\_row\_start = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03605}03605 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03606}03606     \textcolor{comment}{// Values from this matrix and matrix\_in.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03607}03607     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* this\_values = this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03608}03608     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* in\_values = matrix\_in.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03609}03609 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03610}03610 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03611}03611     \textcolor{comment}{// The first entry in row\_start is always zero.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03612}03612     res\_row\_start.push\_back(0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03613}03613 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03614}03614     \textcolor{comment}{// Loop through the rows of both matrices and insert the column indices and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03615}03615     \textcolor{comment}{// values as a key-\/value pair.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03616}03616     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} row\_i = 0; row\_i < \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}; row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03617}03617     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03618}03618       \textcolor{comment}{// Create the map for this row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03619}03619       std::map<int, double> res\_row\_map;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03620}03620 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03621}03621       \textcolor{comment}{// Insert the column and value pair for this matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03622}03622       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = this\_row\_start[row\_i]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < this\_row\_start[row\_i + 1]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03623}03623       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03624}03624         res\_row\_map[this\_column\_indices[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] = this\_values[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03625}03625       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03626}03626 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03627}03627       \textcolor{comment}{// Insert the column and value pair for in matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03628}03628       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = in\_row\_start[row\_i]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < in\_row\_start[row\_i + 1]; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03629}03629       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03630}03630         res\_row\_map[in\_column\_indices[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]] += in\_values[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03631}03631       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03632}03632 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03633}03633       \textcolor{comment}{// Fill in the row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03634}03634       res\_row\_start.push\_back(res\_row\_start.back() + res\_row\_map.size());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03635}03635 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03636}03636       \textcolor{comment}{// Now insert the key into res\_column\_indices and value into res\_values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03637}03637       \textcolor{keywordflow}{for} (std::map<int, double>::iterator it = res\_row\_map.begin();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03638}03638            it != res\_row\_map.end();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03639}03639            ++it)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03640}03640       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03641}03641         res\_column\_indices.push\_back(it-\/>first);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03642}03642         res\_values.push\_back(it-\/>second);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03643}03643       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03644}03644     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03645}03645 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03646}03646     \textcolor{comment}{// Finally build the result\_matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03647}03647     \textcolor{keywordflow}{if} (result\_matrix.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a92bfff97fd228b9c528922c39ab563b2}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03648}03648     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03649}03649       \textcolor{comment}{// Use the existing distribution.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03650}03650       result\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03651}03651         this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}(), res\_values, res\_column\_indices, res\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03652}03652     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03653}03653     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03654}03654     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03655}03655       \textcolor{comment}{// Build with THIS distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03656}03656       result\_matrix.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03657}03657                           this-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a4ed5597d8a34dd14f90b0e6cfb88ca2e}{ncol}}(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03658}03658                           res\_values,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03659}03659                           res\_column\_indices,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03660}03660                           res\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03661}03661     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03662}03662   \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03663}03663 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03664}03664   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03665}03665 \textcolor{comment}{  /// Namespace for helper functions for CRDoubleMatrices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03666}03666 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03667}\mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers}{03667}}   \textcolor{keyword}{namespace }CRDoubleMatrixHelpers}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03668}03668   \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03669}03669     \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03670}03670 \textcolor{comment}{    /// Builds a uniformly distributed matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03671}03671 \textcolor{comment}{    /// A locally replicated matrix is constructed then redistributed using}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03672}03672 \textcolor{comment}{    /// OOMPH-\/LIB's default uniform row distribution.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03673}03673 \textcolor{comment}{    /// This is memory intensive thus should be used for}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03674}03674 \textcolor{comment}{    /// testing or small problems only.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03675}03675 \textcolor{comment}{}    \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03676}\mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ae3c10e59d5857457c7e34be8e9262035}{03676}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ae3c10e59d5857457c7e34be8e9262035}{create\_uniformly\_distributed\_matrix}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03677}03677       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& nrow,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03678}03678       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ncol,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03679}03679       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}* \textcolor{keyword}{const} comm\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03680}03680       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& values,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03681}03681       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& column\_indices,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03682}03682       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<int>}}\& row\_start,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03683}03683       \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}\& matrix\_out)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03684}03684     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03685}03685 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03686}03686       \textcolor{comment}{// Check if the communicator exists.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03687}03687       \textcolor{keywordflow}{if} (comm\_pt == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03688}03688       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03689}03689         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03690}03690         error\_message << \textcolor{stringliteral}{"{}Please supply the communicator.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03691}03691         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03692}03692                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03693}03693                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03694}03694       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03695}03695       \textcolor{comment}{// Is the out matrix built? We need an empty matrix!}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03696}03696       \textcolor{keywordflow}{if} (matrix\_out.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aa0503bc64ef0ccb60cb7d7e645425a62}{built}}())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03697}03697       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03698}03698         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03699}03699         error\_message << \textcolor{stringliteral}{"{}The result matrix has been built.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03700}03700                       << \textcolor{stringliteral}{"{}Please clear the matrix.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03701}03701         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03702}03702                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03703}03703                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03704}03704       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03705}03705 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03706}03706 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03707}03707       \textcolor{comment}{// Create the locally replicated distribution.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03708}03708       \textcolor{keywordtype}{bool} distributed = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03709}03709       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} locally\_replicated\_distribution(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03710}03710         comm\_pt, nrow, distributed);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03711}03711 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03712}03712       \textcolor{comment}{// Create the matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03713}03713       matrix\_out.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_af44bac2acd071317f96dae49cbb0d977}{build}}(\&locally\_replicated\_distribution,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03714}03714                        ncol,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03715}03715                        values,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03716}03716                        column\_indices,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03717}03717                        row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03718}03718 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03719}03719       \textcolor{comment}{// Create the distributed distribution.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03720}03720       distributed = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03721}03721       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} distributed\_distribution(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03722}03722         comm\_pt, nrow, distributed);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03723}03723 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03724}03724       \textcolor{comment}{// Redistribute the matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03725}03725       matrix\_out.\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a9ba295a04e08e3153ae06bc0556f507d}{redistribute}}(\&distributed\_distribution);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03726}03726     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03727}03727 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03728}03728     \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03729}03729 \textcolor{comment}{    /// Compute infinity (maximum) norm of sub blocks as if it was one matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03730}03730 \textcolor{comment}{}    \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03731}\mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{03731}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{inf\_norm}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<CRDoubleMatrix*>}}\& matrix\_pt)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03732}03732     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03733}03733       \textcolor{comment}{// The number of block rows and columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03734}03734       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblockrow = matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03735}03735       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblockcol = matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03736}03736 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03737}03737 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03738}03738       \textcolor{comment}{// Check that tehre is at least one matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03739}03739       \textcolor{keywordflow}{if} (matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}() == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03740}03740       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03741}03741         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03742}03742         error\_message << \textcolor{stringliteral}{"{}There are no matrices... \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03743}03743         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03744}03744                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03745}03745                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03746}03746       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03747}03747 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03748}03748 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03749}03749       \textcolor{comment}{// Check that all matrix\_pt pointers are not null}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03750}03750       \textcolor{comment}{// and the matrices are built.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03751}03751       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03752}03752       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03753}03753         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03754}03754         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03755}03755           \textcolor{keywordflow}{if} (matrix\_pt(block\_row\_i, block\_col\_i) == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03756}03756           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03757}03757             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03758}03758             error\_message << \textcolor{stringliteral}{"{}The pointer martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03759}03759                           << block\_col\_i << \textcolor{stringliteral}{"{}) is null.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03760}03760             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03761}03761                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03762}03762                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03763}03763           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03764}03764 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03765}03765           \textcolor{keywordflow}{if} (!matrix\_pt(block\_row\_i, block\_col\_i)-\/>built())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03766}03766           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03767}03767             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03768}03768             error\_message << \textcolor{stringliteral}{"{}The matrix at martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03769}03769                           << block\_col\_i << \textcolor{stringliteral}{"{}) is not built.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03770}03770             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03771}03771                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03772}03772                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03773}03773           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03774}03774         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03775}03775       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03776}03776 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03777}03777 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03778}03778 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03779}03779 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03780}03780       \textcolor{comment}{// The communicator pointer from block (0,0)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03781}03781       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}* \textcolor{keyword}{const} comm\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03782}03782         matrix\_pt(0, 0)-\/>distribution\_pt()-\/>communicator\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03783}03783 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03784}03784 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03785}03785 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03786}03786 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03787}03787       \textcolor{comment}{// Check that all communicators are the same}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03788}03788       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03789}03789       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03790}03790         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03791}03791         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03792}03792           \textcolor{comment}{// Communicator for this block matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03793}03793           \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}} current\_block\_comm =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03794}03794             *(matrix\_pt(block\_row\_i, block\_col\_i)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03795}03795                 -\/>distribution\_pt()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03796}03796                 -\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03797}03797           \textcolor{keywordflow}{if} (*comm\_pt != current\_block\_comm)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03798}03798           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03799}03799             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03800}03800             error\_message << \textcolor{stringliteral}{"{}The communicator of block martrix\_pt("{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03801}03801                           << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03802}03802                           << \textcolor{stringliteral}{"{}) is not the same as block "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03803}03803                           << \textcolor{stringliteral}{"{}matrix\_pt(0,0).\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03804}03804             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03805}03805                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03806}03806                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03807}03807           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03808}03808         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03809}03809       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03810}03810 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03811}03811       \textcolor{comment}{// Check that all distributed boolean are the same (if on more than 1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03812}03812       \textcolor{comment}{// core)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03813}03813       \textcolor{keywordflow}{if} (comm\_pt-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03814}03814       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03815}03815         \textcolor{comment}{// Get the distributed boolean from matrix\_pt(0,0)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03816}03816         \textcolor{keywordtype}{bool} first\_distributed = matrix\_pt(0, 0)-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03817}03817 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03818}03818         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03819}03819         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03820}03820           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03821}03821           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03822}03822             \textcolor{comment}{// Is the current block distributed?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03823}03823             \textcolor{keywordtype}{bool} current\_distributed =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03824}03824               matrix\_pt(block\_row\_i, block\_col\_i)-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03825}03825 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03826}03826             \textcolor{keywordflow}{if} (first\_distributed != current\_distributed)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03827}03827             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03828}03828               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03829}03829               error\_message << \textcolor{stringliteral}{"{}Block matrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03830}03830                             << block\_col\_i << \textcolor{stringliteral}{"{}) and block matrix\_pt(0,0) "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03831}03831                             << \textcolor{stringliteral}{"{}have a different distributed boolean.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03832}03832               \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03833}03833                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03834}03834                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03835}03835             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03836}03836           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03837}03837         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03838}03838       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03839}03839 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03840}03840       \textcolor{comment}{// Check that all sub matrix dimensions "{}make sense"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03841}03841       \textcolor{comment}{// We need to check that all the matrices in the same row has the same}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03842}03842       \textcolor{comment}{// nrow. Then repeat for the columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03843}03843 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03844}03844       \textcolor{comment}{// Check the nrow of each block row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03845}03845       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03846}03846       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03847}03847         \textcolor{comment}{// Get the nrow to compare against from the first column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03848}03848         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} first\_block\_nrow = matrix\_pt(block\_row\_i, 0)-\/>\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03849}03849 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03850}03850         \textcolor{comment}{// Loop through the block columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03851}03851         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 1; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03852}03852         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03853}03853           \textcolor{comment}{// If the nrow of this block is not the same as the nrow from the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03854}03854           \textcolor{comment}{// first block in this block row, throw an error.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03855}03855           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} current\_block\_nrow =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03856}03856             matrix\_pt(block\_row\_i, block\_col\_i)-\/>\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03857}03857 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03858}03858           \textcolor{keywordflow}{if} (first\_block\_nrow != current\_block\_nrow)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03859}03859           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03860}03860             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03861}03861             error\_message << \textcolor{stringliteral}{"{}First block has nrow = "{}} << current\_block\_nrow}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03862}03862                           << \textcolor{stringliteral}{"{}. But martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03863}03863                           << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03864}03864                           << \textcolor{stringliteral}{"{}) has nrow = "{}} << current\_block\_nrow << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03865}03865             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03866}03866                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03867}03867                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03868}03868           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03869}03869         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03870}03870       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03871}03871 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03872}03872       \textcolor{comment}{// Check the ncol of each block column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03873}03873       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03874}03874       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03875}03875         \textcolor{comment}{// Get the ncol from the first block row to compare against.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03876}03876         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} first\_block\_ncol = matrix\_pt(0, block\_col\_i)-\/>\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03877}03877 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03878}03878         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 1; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03879}03879         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03880}03880           \textcolor{comment}{// Get the ncol for the current block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03881}03881           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} current\_block\_ncol =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03882}03882             matrix\_pt(block\_row\_i, block\_col\_i)-\/>\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03883}03883 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03884}03884           \textcolor{keywordflow}{if} (first\_block\_ncol != current\_block\_ncol)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03885}03885           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03886}03886             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03887}03887             error\_message << \textcolor{stringliteral}{"{}First block has ncol = "{}} << current\_block\_ncol}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03888}03888                           << \textcolor{stringliteral}{"{}. But martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03889}03889                           << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03890}03890                           << \textcolor{stringliteral}{"{}) has ncol = "{}} << current\_block\_ncol << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03891}03891             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03892}03892                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03893}03893                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03894}03894           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03895}03895         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03896}03896       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03897}03897 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03898}03898       \textcolor{comment}{// Check that the distribution for each block row is the same.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03899}03899       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03900}03900       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03901}03901         \textcolor{comment}{// The first distribution of this block row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03902}03902         \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} first\_dist =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03903}03903           *(matrix\_pt(block\_row\_i, 0)-\/>distribution\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03904}03904 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03905}03905         \textcolor{comment}{// Loop through the rest of the block columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03906}03906         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 1; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03907}03907         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03908}03908           \textcolor{comment}{// Get the distribution from the current block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03909}03909           \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} current\_dist =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03910}03910             matrix\_pt(block\_row\_i, block\_col\_i)-\/>distribution\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03911}03911 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03912}03912           \textcolor{comment}{// Compare the first distribution against the current.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03913}03913           \textcolor{keywordflow}{if} (first\_dist != current\_dist)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03914}03914           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03915}03915             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03916}03916             error\_message << \textcolor{stringliteral}{"{}First distribution of block row "{}} << block\_row\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03917}03917                           << \textcolor{stringliteral}{"{} is different from the distribution from "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03918}03918                           << \textcolor{stringliteral}{"{}martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03919}03919                           << \textcolor{stringliteral}{"{}).\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03920}03920             \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03921}03921                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03922}03922                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03923}03923           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03924}03924         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03925}03925       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03926}03926 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03927}03927 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03928}03928 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03929}03929 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03930}03930       \textcolor{comment}{// Loop thrpugh the block rows, then block columns to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03931}03931       \textcolor{comment}{// compute the local inf norm}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03932}03932       \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{inf\_norm}} = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03933}03933       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03934}03934       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03935}03935         \textcolor{comment}{// Get the number of local rows from the first block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03936}03936         \textcolor{keywordtype}{unsigned} block\_nrow\_local = matrix\_pt(block\_row\_i, 0)-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03937}03937 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03938}03938         \textcolor{comment}{// Loop through the block\_nrow\_local in this block row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03939}03939         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} local\_row\_i = 0; local\_row\_i < block\_nrow\_local;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03940}03940              local\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03941}03941         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03942}03942           \textcolor{keywordtype}{double} abs\_sum\_of\_row = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03943}03943           \textcolor{comment}{// Loop through the block columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03944}03944           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03945}03945           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03946}03946             \textcolor{comment}{// Locally cache the pointer to the current block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03947}03947             \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* block\_pt = matrix\_pt(block\_row\_i, block\_col\_i);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03948}03948 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03949}03949             \textcolor{keyword}{const} \textcolor{keywordtype}{int}* row\_start = block\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03950}03950             \textcolor{keyword}{const} \textcolor{keywordtype}{double}* value = block\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03951}03951 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03952}03952             \textcolor{comment}{// Loop through the values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03953}03953             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} val\_i = row\_start[local\_row\_i];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03954}03954                  val\_i < row\_start[local\_row\_i + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03955}03955                  val\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03956}03956             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03957}03957               abs\_sum\_of\_row += fabs(value[val\_i]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03958}03958             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03959}03959           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03960}03960           \textcolor{comment}{// Store the max row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03961}03961           \mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{inf\_norm}} = std::max(\mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{inf\_norm}}, abs\_sum\_of\_row);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03962}03962         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03963}03963       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03964}03964 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03965}03965       \textcolor{comment}{// if this vector is distributed and on multiple processors then gather}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03966}03966 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03967}03967       \textcolor{keywordtype}{double} inf\_norm\_local = \mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{inf\_norm}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03968}03968       \textcolor{keywordflow}{if} (matrix\_pt(0, 0)-\/>distributed() \&\& comm\_pt-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03969}03969       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03970}03970         MPI\_Allreduce(\&\mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{inf\_norm}},}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03971}03971                       \&inf\_norm\_local,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03972}03972                       1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03973}03973                       MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03974}03974                       MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03975}03975                       comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03976}03976       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03977}03977       \mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{inf\_norm}} = inf\_norm\_local;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03978}03978 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03979}03979 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03980}03980       \textcolor{comment}{// and return}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03981}03981       \textcolor{keywordflow}{return} \mbox{\hyperlink{namespaceoomph_1_1CRDoubleMatrixHelpers_ab17222c9461096e3d5b8cf6250524644}{inf\_norm}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03982}03982     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03983}03983 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03984}03984     \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03985}03985 \textcolor{comment}{    /// Calculates the largest Gershgorin disc whilst preserving the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03986}03986 \textcolor{comment}{    /// sign. Let A be an n by n matrix, with entries aij. For \(\backslash\)f\$ i \(\backslash\)in \(\backslash\)\{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03987}03987 \textcolor{comment}{    /// 1,...,n \(\backslash\)\} \(\backslash\)f\$ let \(\backslash\)f\$ R\_i = \(\backslash\)sum\_\{i\(\backslash\)neq j\} |a\_\{ij\}| \(\backslash\)f\$ be the sum of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03988}03988 \textcolor{comment}{    /// the absolute values of the non-\/diagonal entries in the i-\/th row. Let \(\backslash\)f\$}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03989}03989 \textcolor{comment}{    /// D(a\_\{ii\},R\_i) \(\backslash\)f\$ be the closed disc centered at \(\backslash\)f\$ a\_\{ii\} \(\backslash\)f\$ with}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03990}03990 \textcolor{comment}{    /// radius \(\backslash\)f\$ R\_i \(\backslash\)f\$, such a disc is called a Gershgorin disc.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03991}03991 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03992}03992 \textcolor{comment}{    /// \(\backslash\)n}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03993}03993 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03994}03994 \textcolor{comment}{    /// We calculate \(\backslash\)f\$ |D(a\_\{ii\},R\_i)|\_\{max\} \(\backslash\)f\$ and multiply by the sign of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03995}03995 \textcolor{comment}{    /// the diagonal entry.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03996}03996 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03997}03997 \textcolor{comment}{    /// \(\backslash\)n}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03998}03998 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l03999}03999 \textcolor{comment}{    /// The DenseMatrix of CRDoubleMatrices are treated as if they are one}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04000}04000 \textcolor{comment}{    /// large matrix. Therefore the dimensions of the sub matrices has to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04001}04001 \textcolor{comment}{    /// "{}make sense"{}, there is a paranoid check for this.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04002}04002 \textcolor{comment}{}    \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04003}04003     \textcolor{keywordtype}{double} gershgorin\_eigenvalue\_estimate(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04004}04004       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<CRDoubleMatrix*>}}\& matrix\_pt)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04005}04005     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04006}04006       \textcolor{comment}{// The number of block rows and columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04007}04007       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblockrow = matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04008}04008       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} nblockcol = matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04009}04009 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04010}04010 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04011}04011       \textcolor{comment}{// Check that tehre is at least one matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04012}04012       \textcolor{keywordflow}{if} (matrix\_pt.\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}() == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04013}04013       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04014}04014         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04015}04015         error\_message << \textcolor{stringliteral}{"{}There are no matrices... \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04016}04016         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04017}04017                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04018}04018                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04019}04019       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04020}04020 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04021}04021 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04022}04022       \textcolor{comment}{// Check that all matrix\_pt pointers are not null}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04023}04023       \textcolor{comment}{// and the matrices are built.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04024}04024       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04025}04025       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04026}04026         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04027}04027         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04028}04028           \textcolor{keywordflow}{if} (matrix\_pt(block\_row\_i, block\_col\_i) == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04029}04029           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04030}04030             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04031}04031             error\_message << \textcolor{stringliteral}{"{}The pointer martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04032}04032                           << block\_col\_i << \textcolor{stringliteral}{"{}) is null.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04033}04033             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04034}04034                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04035}04035                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04036}04036           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04037}04037 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04038}04038           \textcolor{keywordflow}{if} (!matrix\_pt(block\_row\_i, block\_col\_i)-\/>built())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04039}04039           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04040}04040             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04041}04041             error\_message << \textcolor{stringliteral}{"{}The matrix at martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04042}04042                           << block\_col\_i << \textcolor{stringliteral}{"{}) is not built.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04043}04043             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04044}04044                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04045}04045                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04046}04046           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04047}04047         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04048}04048       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04049}04049 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04050}04050 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04051}04051 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04052}04052 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04053}04053 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04054}04054       \textcolor{comment}{// The communicator pointer from block (0,0)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04055}04055       \textcolor{comment}{// All communicators should be the same, we check this next.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04056}04056       \textcolor{keyword}{const} OomphCommunicator* \textcolor{keyword}{const} comm\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04057}04057         matrix\_pt(0, 0)-\/>distribution\_pt()-\/>communicator\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04058}04058 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04059}04059 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04060}04060 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04061}04061       \textcolor{comment}{// Check that all communicators are the same}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04062}04062       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04063}04063       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04064}04064         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04065}04065         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04066}04066           \textcolor{comment}{// Communicator for this block matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04067}04067           \textcolor{keyword}{const} OomphCommunicator current\_block\_comm =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04068}04068             *(matrix\_pt(block\_row\_i, block\_col\_i)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04069}04069                 -\/>distribution\_pt()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04070}04070                 -\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04071}04071           \textcolor{keywordflow}{if} (*comm\_pt != current\_block\_comm)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04072}04072           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04073}04073             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04074}04074             error\_message << \textcolor{stringliteral}{"{}The communicator of block martrix\_pt("{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04075}04075                           << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04076}04076                           << \textcolor{stringliteral}{"{}) is not the same as block "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04077}04077                           << \textcolor{stringliteral}{"{}matrix\_pt(0,0).\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04078}04078             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04079}04079                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04080}04080                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04081}04081           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04082}04082         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04083}04083       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04084}04084 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04085}04085       \textcolor{comment}{// Check that all distributed boolean are the same (if on more than 1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04086}04086       \textcolor{comment}{// core)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04087}04087       \textcolor{keywordflow}{if} (comm\_pt-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04088}04088       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04089}04089         \textcolor{comment}{// Get the distributed boolean from matrix\_pt(0,0)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04090}04090         \textcolor{keywordtype}{bool} first\_distributed = matrix\_pt(0, 0)-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04091}04091 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04092}04092         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04093}04093         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04094}04094           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04095}04095           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04096}04096             \textcolor{comment}{// Is the current block distributed?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04097}04097             \textcolor{keywordtype}{bool} current\_distributed =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04098}04098               matrix\_pt(block\_row\_i, block\_col\_i)-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04099}04099 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04100}04100             \textcolor{keywordflow}{if} (first\_distributed != current\_distributed)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04101}04101             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04102}04102               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04103}04103               error\_message << \textcolor{stringliteral}{"{}Block matrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04104}04104                             << block\_col\_i << \textcolor{stringliteral}{"{}) and block matrix\_pt(0,0) "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04105}04105                             << \textcolor{stringliteral}{"{}have a different distributed boolean.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04106}04106               \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04107}04107                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04108}04108                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04109}04109             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04110}04110           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04111}04111         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04112}04112       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04113}04113 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04114}04114       \textcolor{comment}{// Check that all sub matrix dimensions "{}make sense"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04115}04115       \textcolor{comment}{// We need to check that all the matrices in the same row has the same}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04116}04116       \textcolor{comment}{// nrow. Then repeat for the columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04117}04117 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04118}04118       \textcolor{comment}{// Check the nrow of each block row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04119}04119       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04120}04120       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04121}04121         \textcolor{comment}{// Get the nrow to compare against from the first column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04122}04122         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} first\_block\_nrow = matrix\_pt(block\_row\_i, 0)-\/>\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04123}04123 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04124}04124         \textcolor{comment}{// Loop through the block columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04125}04125         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 1; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04126}04126         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04127}04127           \textcolor{comment}{// If the nrow of this block is not the same as the nrow from the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04128}04128           \textcolor{comment}{// first block in this block row, throw an error.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04129}04129           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} current\_block\_nrow =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04130}04130             matrix\_pt(block\_row\_i, block\_col\_i)-\/>\mbox{\hyperlink{classoomph_1_1DenseMatrix_a1b425094510d833ffe91920747a0a962}{nrow}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04131}04131 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04132}04132           \textcolor{keywordflow}{if} (first\_block\_nrow != current\_block\_nrow)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04133}04133           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04134}04134             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04135}04135             error\_message << \textcolor{stringliteral}{"{}First block has nrow = "{}} << current\_block\_nrow}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04136}04136                           << \textcolor{stringliteral}{"{}. But martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04137}04137                           << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04138}04138                           << \textcolor{stringliteral}{"{}) has nrow = "{}} << current\_block\_nrow << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04139}04139             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04140}04140                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04141}04141                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04142}04142           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04143}04143         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04144}04144       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04145}04145 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04146}04146       \textcolor{comment}{// Check the ncol of each block column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04147}04147       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04148}04148       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04149}04149         \textcolor{comment}{// Get the ncol from the first block row to compare against.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04150}04150         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} first\_block\_ncol = matrix\_pt(0, block\_col\_i)-\/>\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04151}04151 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04152}04152         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 1; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04153}04153         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04154}04154           \textcolor{comment}{// Get the ncol for the current block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04155}04155           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} current\_block\_ncol =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04156}04156             matrix\_pt(block\_row\_i, block\_col\_i)-\/>\mbox{\hyperlink{classoomph_1_1DenseMatrix_a9937181f1cb4cfaed7aaf3b483c42456}{ncol}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04157}04157 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04158}04158           \textcolor{keywordflow}{if} (first\_block\_ncol != current\_block\_ncol)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04159}04159           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04160}04160             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04161}04161             error\_message << \textcolor{stringliteral}{"{}First block has ncol = "{}} << current\_block\_ncol}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04162}04162                           << \textcolor{stringliteral}{"{}. But martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04163}04163                           << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04164}04164                           << \textcolor{stringliteral}{"{}) has ncol = "{}} << current\_block\_ncol << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04165}04165             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04166}04166                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04167}04167                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04168}04168           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04169}04169         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04170}04170       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04171}04171 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04172}04172       \textcolor{comment}{// Check that the distribution for each block row is the same.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04173}04173       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04174}04174       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04175}04175         \textcolor{comment}{// The first distribution of this block row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04176}04176         \textcolor{keyword}{const} LinearAlgebraDistribution first\_dist =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04177}04177           *(matrix\_pt(block\_row\_i, 0)-\/>distribution\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04178}04178 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04179}04179         \textcolor{comment}{// Loop through the rest of the block columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04180}04180         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 1; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04181}04181         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04182}04182           \textcolor{comment}{// Get the distribution from the current block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04183}04183           \textcolor{keyword}{const} LinearAlgebraDistribution current\_dist =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04184}04184             matrix\_pt(block\_row\_i, block\_col\_i)-\/>distribution\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04185}04185 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04186}04186           \textcolor{comment}{// Compare the first distribution against the current.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04187}04187           \textcolor{keywordflow}{if} (first\_dist != current\_dist)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04188}04188           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04189}04189             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04190}04190             error\_message << \textcolor{stringliteral}{"{}First distribution of block row "{}} << block\_row\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04191}04191                           << \textcolor{stringliteral}{"{} is different from the distribution from "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04192}04192                           << \textcolor{stringliteral}{"{}martrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04193}04193                           << \textcolor{stringliteral}{"{}).\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04194}04194             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04195}04195                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04196}04196                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04197}04197           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04198}04198         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04199}04199       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04200}04200 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04201}04201 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04202}04202 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04203}04203 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04204}04204       \textcolor{comment}{// Loop thrpugh the block rows, then block columns to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04205}04205       \textcolor{comment}{// compute the local inf norm}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04206}04206       \textcolor{keywordtype}{double} extreme\_disc = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04207}04207       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < nblockrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04208}04208       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04209}04209         \textcolor{comment}{// Get the number of local rows from the first block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04210}04210         \textcolor{keywordtype}{unsigned} block\_nrow\_local = matrix\_pt(block\_row\_i, 0)-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04211}04211 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04212}04212         \textcolor{comment}{// Loop through the block\_nrow\_local in this block row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04213}04213         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} local\_row\_i = 0; local\_row\_i < block\_nrow\_local;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04214}04214              local\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04215}04215         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04216}04216           \textcolor{keywordtype}{double} abs\_sum\_of\_row = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04217}04217           \textcolor{comment}{// Loop through the block columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04218}04218           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < nblockcol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04219}04219           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04220}04220             \textcolor{comment}{// Locally cache the pointer to the current block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04221}04221             CRDoubleMatrix* block\_pt = matrix\_pt(block\_row\_i, block\_col\_i);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04222}04222 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04223}04223             \textcolor{keyword}{const} \textcolor{keywordtype}{int}* row\_start = block\_pt-\/>row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04224}04224             \textcolor{keyword}{const} \textcolor{keywordtype}{double}* value = block\_pt-\/>value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04225}04225 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04226}04226             \textcolor{comment}{// Loop through the values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04227}04227             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} val\_i = row\_start[local\_row\_i];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04228}04228                  val\_i < row\_start[local\_row\_i + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04229}04229                  val\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04230}04230             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04231}04231               abs\_sum\_of\_row += fabs(value[val\_i]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04232}04232             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04233}04233           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04234}04234 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04235}04235           \textcolor{comment}{// Now minus the diagonal entry...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04236}04236           \textcolor{comment}{// Locate the diagonal block matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04237}04237           \textcolor{keywordtype}{double}* s\_values = matrix\_pt(block\_row\_i, block\_row\_i)-\/>value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04238}04238           \textcolor{keywordtype}{int}* s\_column\_index =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04239}04239             matrix\_pt(block\_row\_i, block\_row\_i)-\/>column\_index();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04240}04240           \textcolor{keywordtype}{int}* s\_row\_start = matrix\_pt(block\_row\_i, block\_row\_i)-\/>row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04241}04241           \textcolor{comment}{// int s\_nrow\_local =}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04242}04242           \textcolor{comment}{// matrix\_pt(block\_row\_i,block\_row\_i)-\/>nrow\_local();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04243}04243           \textcolor{keywordtype}{int} s\_first\_row = matrix\_pt(block\_row\_i, block\_row\_i)-\/>first\_row();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04244}04244 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04245}04245           \textcolor{comment}{// Get the diagonal value...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04246}04246           \textcolor{keywordtype}{double} diagonal\_value = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04247}04247           \textcolor{keywordtype}{bool} found = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04248}04248           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = s\_row\_start[local\_row\_i];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04249}04249                j < s\_row\_start[local\_row\_i + 1] \&\& !found;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04250}04250                j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04251}04251           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04252}04252             \textcolor{keywordflow}{if} (s\_column\_index[j] == \textcolor{keywordtype}{int}(local\_row\_i + s\_first\_row))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04253}04253             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04254}04254               diagonal\_value = s\_values[j];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04255}04255               found = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04256}04256             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04257}04257           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04258}04258 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04259}04259           \textcolor{comment}{// Check if the diagonal entry is found.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04260}04260           \textcolor{keywordflow}{if} (!found)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04261}04261           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04262}04262             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04263}04263             error\_message << \textcolor{stringliteral}{"{}The diagonal entry for the block("{}} << block\_row\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04264}04264                           << \textcolor{stringliteral}{"{},"{}} << block\_row\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04265}04265                           << \textcolor{stringliteral}{"{}on local row "{}} << local\_row\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04266}04266                           << \textcolor{stringliteral}{"{} does not exist."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04267}04267             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04268}04268                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04269}04269                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04270}04270           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04271}04271 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04272}04272           \textcolor{comment}{// This is the disc.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04273}04273           abs\_sum\_of\_row -\/= fabs(diagonal\_value);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04274}04274 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04275}04275           \textcolor{comment}{// Now we have to check if the diagonal entry is}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04276}04276           \textcolor{comment}{// on the left or right side of zero.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04277}04277           \textcolor{keywordflow}{if} (diagonal\_value > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04278}04278           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04279}04279             \textcolor{keywordtype}{double} extreme\_disc\_local = diagonal\_value + abs\_sum\_of\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04280}04280             extreme\_disc = std::max(extreme\_disc\_local, extreme\_disc);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04281}04281           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04282}04282           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04283}04283           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04284}04284             \textcolor{keywordtype}{double} extreme\_disc\_local = diagonal\_value -\/ abs\_sum\_of\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04285}04285             extreme\_disc = std::min(extreme\_disc\_local, extreme\_disc);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04286}04286           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04287}04287         \} \textcolor{comment}{// Loop through local row (of all block column)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04288}04288       \} \textcolor{comment}{// Loop through block row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04289}04289 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04290}04290       \textcolor{comment}{// if this vector is distributed and on multiple processors then gather}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04291}04291 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04292}04292       \textcolor{keywordtype}{double} extreme\_disc\_local = extreme\_disc;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04293}04293       \textcolor{keywordflow}{if} (matrix\_pt(0, 0)-\/>distributed() \&\& comm\_pt-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04294}04294       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04295}04295         \textcolor{keywordflow}{if} (extreme\_disc > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04296}04296         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04297}04297           MPI\_Allreduce(\&extreme\_disc,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04298}04298                         \&extreme\_disc\_local,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04299}04299                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04300}04300                         MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04301}04301                         MPI\_MAX,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04302}04302                         comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04303}04303         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04304}04304         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04305}04305         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04306}04306           MPI\_Allreduce(\&extreme\_disc,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04307}04307                         \&extreme\_disc\_local,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04308}04308                         1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04309}04309                         MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04310}04310                         MPI\_MIN,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04311}04311                         comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04312}04312         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04313}04313       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04314}04314       extreme\_disc = extreme\_disc\_local;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04315}04315 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04316}04316 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04317}04317       \textcolor{comment}{// and return}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04318}04318       \textcolor{keywordflow}{return} extreme\_disc;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04319}04319     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04320}04320 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04321}04321     \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04322}04322 \textcolor{comment}{    /// Concatenate CRDoubleMatrix matrices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04323}04323 \textcolor{comment}{    /// The in matrices are concatenated such that the block structure of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04324}04324 \textcolor{comment}{    /// in matrices are preserved in the result matrix. Communication between}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04325}04325 \textcolor{comment}{    /// processors is required. If the block structure of the sub matrices does}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04326}04326 \textcolor{comment}{    /// not need to be preserved, consider using}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04327}04327 \textcolor{comment}{    /// CRDoubleMatrixHelpers::concatenate\_without\_communication(...).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04328}04328 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04329}04329 \textcolor{comment}{    /// The matrix manipulation functions}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04330}04330 \textcolor{comment}{    /// CRDoubleMatrixHelpers::concatenate(...) and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04331}04331 \textcolor{comment}{    /// CRDoubleMatrixHelpers::concatenate\_without\_communication(...)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04332}04332 \textcolor{comment}{    /// are analogous to the Vector manipulation functions}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04333}04333 \textcolor{comment}{    /// DoubleVectorHelpers::concatenate(...) and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04334}04334 \textcolor{comment}{    /// DoubleVectorHelpers::concatenate\_without\_communication(...).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04335}04335 \textcolor{comment}{    /// Please look at the DoubleVector functions for an illustration of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04336}04336 \textcolor{comment}{    /// differences between concatenate(...) and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04337}04337 \textcolor{comment}{    /// concatenate\_without\_communication(...).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04338}04338 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04339}04339 \textcolor{comment}{    /// Distribution of the result matrix:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04340}04340 \textcolor{comment}{    /// If the result matrix does not have a distribution built, then it will be}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04341}04341 \textcolor{comment}{    /// given a uniform row distribution. Otherwise we use the existing}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04342}04342 \textcolor{comment}{    /// distribution. This gives the user the ability to define their own}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04343}04343 \textcolor{comment}{    /// distribution, or save computing power if a distribution has}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04344}04344 \textcolor{comment}{    /// been pre-\/built.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04345}04345 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04346}04346 \textcolor{comment}{    /// NOTE: ALL the matrices pointed to by matrix\_pt has to be built. This is}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04347}04347 \textcolor{comment}{    /// not the case with concatenate\_without\_communication(...)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04348}04348 \textcolor{comment}{}    \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04349}04349     \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceoomph_a2d240459b98565dd04314903d707de48}{concatenate}}(\textcolor{keyword}{const} DenseMatrix<CRDoubleMatrix*>\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04350}04350                      CRDoubleMatrix\& result\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04351}04351     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04352}04352       \textcolor{comment}{// The number of block rows and block columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04353}04353       \textcolor{keywordtype}{unsigned} matrix\_nrow = matrix\_pt.nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04354}04354       \textcolor{keywordtype}{unsigned} matrix\_ncol = matrix\_pt.ncol();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04355}04355 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04356}04356       \textcolor{comment}{// PARANOID checks involving only the in matrices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04357}04357 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04358}04358       \textcolor{comment}{// Are there matrices to concatenate?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04359}04359       \textcolor{keywordflow}{if} (matrix\_nrow == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04360}04360       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04361}04361         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04362}04362         error\_message << \textcolor{stringliteral}{"{}There are no matrices to concatenate.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04363}04363         \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04364}04364                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04365}04365                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04366}04366       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04367}04367 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04368}04368       \textcolor{comment}{// Does this matrix need concatenating?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04369}04369       \textcolor{keywordflow}{if} ((matrix\_nrow == 1) \&\& (matrix\_ncol == 1))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04370}04370       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04371}04371         std::ostringstream warning\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04372}04372         warning\_message << \textcolor{stringliteral}{"{}There is only one matrix to concatenate...\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04373}04373                         << \textcolor{stringliteral}{"{}This does not require concatenating...\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04374}04374         OomphLibWarning(warning\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04375}04375                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04376}04376                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04377}04377       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04378}04378 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04379}04379       \textcolor{comment}{// Are all sub matrices built?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04380}04380       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04381}04381       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04382}04382         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04383}04383         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04384}04384           \textcolor{keywordflow}{if} (!(matrix\_pt(block\_row\_i, block\_col\_i)-\/>built()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04385}04385           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04386}04386             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04387}04387             error\_message << \textcolor{stringliteral}{"{}The sub matrix ("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04388}04388                           << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04389}04389                           << \textcolor{stringliteral}{"{}is not built. \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04390}04390             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04391}04391                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04392}04392                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04393}04393           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04394}04394         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04395}04395       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04396}04396 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04397}04397       \textcolor{comment}{// Do all dimensions of sub matrices "{}make sense"{}?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04398}04398       \textcolor{comment}{// Compare the number of rows of each block matrix in a block row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04399}04399       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04400}04400       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04401}04401         \textcolor{comment}{// Use the first column to compare against the rest.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04402}04402         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} current\_block\_nrow = matrix\_pt(block\_row\_i, 0)-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04403}04403 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04404}04404         \textcolor{comment}{// Compare against columns 1 to matrix\_ncol -\/ 1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04405}04405         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 1; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04406}04406         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04407}04407           \textcolor{comment}{// Get the nrow for this sub block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04408}04408           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} subblock\_nrow =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04409}04409             matrix\_pt(block\_row\_i, block\_col\_i)-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04410}04410 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04411}04411           \textcolor{keywordflow}{if} (current\_block\_nrow != subblock\_nrow)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04412}04412           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04413}04413             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04414}04414             error\_message << \textcolor{stringliteral}{"{}The sub matrix ("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04415}04415                           << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04416}04416                           << \textcolor{stringliteral}{"{}requires nrow = "{}} << current\_block\_nrow}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04417}04417                           << \textcolor{stringliteral}{"{}, but has nrow = "{}} << subblock\_nrow << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04418}04418             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04419}04419                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04420}04420                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04421}04421           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04422}04422         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04423}04423       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04424}04424 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04425}04425       \textcolor{comment}{// Compare the number of columns of each block matrix in a block column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04426}04426       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04427}04427       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04428}04428         \textcolor{comment}{// Use the first row to compare against the rest.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04429}04429         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} current\_block\_ncol = matrix\_pt(0, block\_col\_i)-\/>ncol();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04430}04430 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04431}04431         \textcolor{comment}{// Compare against rows 1 to matrix\_nrow -\/ 1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04432}04432         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 1; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04433}04433         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04434}04434           \textcolor{comment}{// Get the ncol for this sub block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04435}04435           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} subblock\_ncol =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04436}04436             matrix\_pt(block\_row\_i, block\_col\_i)-\/>ncol();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04437}04437 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04438}04438           \textcolor{keywordflow}{if} (current\_block\_ncol != subblock\_ncol)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04439}04439           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04440}04440             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04441}04441             error\_message << \textcolor{stringliteral}{"{}The sub matrix ("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04442}04442                           << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04443}04443                           << \textcolor{stringliteral}{"{}requires ncol = "{}} << current\_block\_ncol}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04444}04444                           << \textcolor{stringliteral}{"{}, but has ncol = "{}} << subblock\_ncol << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04445}04445             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04446}04446                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04447}04447                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04448}04448           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04449}04449         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04450}04450       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04451}04451 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04452}04452 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04453}04453       \textcolor{comment}{// The communicator pointer from block (0,0)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04454}04454       \textcolor{keyword}{const} OomphCommunicator* \textcolor{keyword}{const} comm\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04455}04455         matrix\_pt(0, 0)-\/>distribution\_pt()-\/>communicator\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04456}04456 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04457}04457       \textcolor{comment}{// Check if the block (0,0) is distributed or not.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04458}04458       \textcolor{keywordtype}{bool} distributed = matrix\_pt(0, 0)-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04459}04459 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04460}04460       \textcolor{comment}{// If the result matrix does not have a distribution, we create a uniform}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04461}04461       \textcolor{comment}{// distribution.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04462}04462       \textcolor{keywordflow}{if} (!result\_matrix.distribution\_pt()-\/>built())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04463}04463       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04464}04464         \textcolor{comment}{// Sum of sub matrix nrow. We use the first column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04465}04465         \textcolor{keywordtype}{unsigned} tmp\_nrow = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04466}04466         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04467}04467         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04468}04468           tmp\_nrow += matrix\_pt(block\_row\_i, 0)-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04469}04469         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04470}04470 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04471}04471         LinearAlgebraDistribution tmp\_distribution(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04472}04472           comm\_pt, tmp\_nrow, distributed);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04473}04473 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04474}04474         result\_matrix.build(\&tmp\_distribution);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04475}04475       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04476}04476       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04477}04477       \textcolor{comment}{// A distribution is supplied for the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04478}04478       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04479}04479 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04480}04480         \textcolor{comment}{// Check if the sum of the nrow from the sub matrices is the same as the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04481}04481         \textcolor{comment}{// the nrow from the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04482}04482 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04483}04483         \textcolor{comment}{// Sum of sub matrix nrow. We use the first column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04484}04484         \textcolor{keywordtype}{unsigned} tmp\_nrow = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04485}04485         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04486}04486         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04487}04487           tmp\_nrow += matrix\_pt(block\_row\_i, 0)-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04488}04488         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04489}04489 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04490}04490         \textcolor{keywordflow}{if} (tmp\_nrow != result\_matrix.nrow())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04491}04491         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04492}04492           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04493}04493           error\_message << \textcolor{stringliteral}{"{}The total number of rows from the matrices to\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04494}04494                         << \textcolor{stringliteral}{"{}concatenate does not match the nrow from the\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04495}04495                         << \textcolor{stringliteral}{"{}result matrix\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04496}04496           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04497}04497                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04498}04498                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04499}04499         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04500}04500 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04501}04501       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04502}04502 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04503}04503 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04504}04504 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04505}04505       \textcolor{comment}{// Are all the communicators the same?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04506}04506       \textcolor{comment}{// Compare the communicator for sub matrices (against the result matrix).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04507}04507       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04508}04508         \textcolor{keyword}{const} OomphCommunicator communicator =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04509}04509           *(result\_matrix.distribution\_pt()-\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04510}04510 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04511}04511         \textcolor{comment}{// Are all communicator pointers the same?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04512}04512         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04513}04513         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04514}04514           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04515}04515                block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04516}04516           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04517}04517             \textcolor{keyword}{const} OomphCommunicator another\_communicator =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04518}04518               *(matrix\_pt(block\_row\_i, block\_col\_i)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04519}04519                   -\/>distribution\_pt()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04520}04520                   -\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04521}04521 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04522}04522             \textcolor{keywordflow}{if} (!(communicator == another\_communicator))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04523}04523             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04524}04524               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04525}04525               error\_message << \textcolor{stringliteral}{"{}The OomphCommunicator of the sub matrix ("{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04526}04526                             << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04527}04527                             << \textcolor{stringliteral}{"{}does not have the same communicator as the "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04528}04528                                \textcolor{stringliteral}{"{}result matrix. \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04529}04529               \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04530}04530                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04531}04531                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04532}04532             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04533}04533           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04534}04534         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04535}04535       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04536}04536 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04537}04537       \textcolor{comment}{// Are all the distributed boolean the same? This only applies if we have}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04538}04538       \textcolor{comment}{// more than one processor. If there is only one processor, then it does}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04539}04539       \textcolor{comment}{// not matter if it is distributed or not -\/ they are conceptually the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04540}04540       \textcolor{comment}{// same.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04541}04541       \textcolor{keywordflow}{if} (comm\_pt-\/>nproc() != 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04542}04542       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04543}04543         \textcolor{comment}{// Compare distributed for sub matrices (against the result matrix).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04544}04544         \textcolor{keyword}{const} \textcolor{keywordtype}{bool} res\_distributed = result\_matrix.distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04545}04545 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04546}04546         \textcolor{comment}{// Loop over all sub blocks.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04547}04547         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04548}04548         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04549}04549           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04550}04550                block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04551}04551           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04552}04552             \textcolor{keyword}{const} \textcolor{keywordtype}{bool} another\_distributed =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04553}04553               matrix\_pt(block\_row\_i, block\_col\_i)-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04554}04554 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04555}04555             \textcolor{keywordflow}{if} (res\_distributed != another\_distributed)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04556}04556             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04557}04557               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04558}04558               error\_message << \textcolor{stringliteral}{"{}The distributed boolean of the sub matrix ("{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04559}04559                             << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04560}04560                             << \textcolor{stringliteral}{"{}is not the same as the result matrix. \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04561}04561               \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04562}04562                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04563}04563                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04564}04564             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04565}04565           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04566}04566         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04567}04567       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04568}04568 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04569}04569 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04570}04570 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04571}04571       \textcolor{comment}{// Get the number of columns up to each block for offset}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04572}04572       \textcolor{comment}{// in calculating the result column indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04573}04573       \textcolor{comment}{// Since the number of columns in each block column is the same,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04574}04574       \textcolor{comment}{// we only loop through the first block row (row zero).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04575}04575       Vector<unsigned long> sum\_of\_ncol\_up\_to\_block(matrix\_ncol);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04576}04576 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04577}04577       \textcolor{comment}{// Also compute the total number of columns to build the resulting matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04578}04578       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} res\_ncol = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04579}04579 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04580}04580       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04581}04581       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04582}04582         sum\_of\_ncol\_up\_to\_block[block\_col\_i] = res\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04583}04583         res\_ncol += matrix\_pt(0, block\_col\_i)-\/>ncol();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04584}04584       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04585}04585 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04586}04586       \textcolor{comment}{// We begin the process of extracting and ordering the values,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04587}04587       \textcolor{comment}{// column\_indices and row\_start of all the sub blocks.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04588}04588       \textcolor{keywordflow}{if} ((comm\_pt-\/>nproc() == 1) || !distributed)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04589}04589       \textcolor{comment}{// Serial version of the code.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04590}04590       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04591}04591         \textcolor{comment}{// Get the total number of non zero entries so we can reserve storage}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04592}04592         \textcolor{comment}{// for the values and column\_indices vectors.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04593}04593         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} res\_nnz = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04594}04594         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04595}04595         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04596}04596           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04597}04597                block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04598}04598           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04599}04599             res\_nnz += matrix\_pt(block\_row\_i, block\_col\_i)-\/>nnz();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04600}04600           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04601}04601         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04602}04602 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04603}04603         \textcolor{comment}{// Declare the vectors required to build a CRDoubleMatrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04604}04604         Vector<double> res\_values;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04605}04605         Vector<int> res\_column\_indices;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04606}04606         Vector<int> res\_row\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04607}04607 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04608}04608         \textcolor{comment}{// Reserve space for the vectors.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04609}04609         res\_values.reserve(res\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04610}04610         res\_column\_indices.reserve(res\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04611}04611         res\_row\_start.reserve(result\_matrix.nrow() + 1);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04612}04612 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04613}04613         \textcolor{comment}{// Now we fill in the data.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04614}04614 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04615}04615         \textcolor{comment}{// Running sum of nnz per row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04616}04616         \textcolor{keywordtype}{int} nnz\_running\_sum = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04617}04617 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04618}04618         \textcolor{comment}{// Loop through the block rows.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04619}04619         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04620}04620         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04621}04621           \textcolor{comment}{// Get the number of rows in this block row, from the first block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04622}04622           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} block\_row\_nrow = matrix\_pt(block\_row\_i, 0)-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04623}04623 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04624}04624           \textcolor{comment}{// Loop through the number of rows in this block row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04625}04625           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} row\_i = 0; row\_i < block\_row\_nrow; row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04626}04626           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04627}04627             \textcolor{comment}{// The row start is the nnz at the start of the row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04628}04628             res\_row\_start.push\_back(nnz\_running\_sum);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04629}04629 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04630}04630             \textcolor{comment}{// Loop through the block columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04631}04631             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04632}04632                  block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04633}04633             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04634}04634               \textcolor{comment}{// Get the current block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04635}04635               CRDoubleMatrix* current\_block\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04636}04636                 matrix\_pt(block\_row\_i, block\_col\_i);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04637}04637 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04638}04638               \textcolor{comment}{// Get the values, column\_indices and row\_start for this block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04639}04639               \textcolor{keywordtype}{double}* current\_block\_values = current\_block\_pt-\/>value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04640}04640               \textcolor{keywordtype}{int}* current\_block\_column\_indices =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04641}04641                 current\_block\_pt-\/>column\_index();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04642}04642               \textcolor{keywordtype}{int}* current\_block\_row\_start = current\_block\_pt-\/>row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04643}04643 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04644}04644               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} val\_i = current\_block\_row\_start[row\_i];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04645}04645                    val\_i < current\_block\_row\_start[row\_i + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04646}04646                    val\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04647}04647               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04648}04648                 res\_values.push\_back(current\_block\_values[val\_i]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04649}04649                 res\_column\_indices.push\_back(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04650}04650                   current\_block\_column\_indices[val\_i] +}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04651}04651                   sum\_of\_ncol\_up\_to\_block[block\_col\_i]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04652}04652               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04653}04653 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04654}04654               \textcolor{comment}{// Update the running sum of nnz per row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04655}04655               nnz\_running\_sum += current\_block\_row\_start[row\_i + 1] -\/}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04656}04656                                  current\_block\_row\_start[row\_i];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04657}04657             \} \textcolor{comment}{// for block cols}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04658}04658           \} \textcolor{comment}{// for rows}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04659}04659         \} \textcolor{comment}{// for block rows}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04660}04660 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04661}04661         \textcolor{comment}{// Fill in the last row start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04662}04662         res\_row\_start.push\_back(res\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04663}04663 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04664}04664         \textcolor{comment}{// Build the matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04665}04665         result\_matrix.build(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04666}04666           res\_ncol, res\_values, res\_column\_indices, res\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04667}04667       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04668}04668       \textcolor{comment}{// Otherwise we are dealing with a distributed matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04669}04669       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04670}04670       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04671}04671 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04672}04672 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04673}04673         \textcolor{comment}{// Flag to enable timing. This is for debugging}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04674}04674         \textcolor{comment}{// and/or testing purposes only.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04675}04675         \textcolor{keywordtype}{bool} enable\_timing = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04676}04676 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04677}04677         \textcolor{comment}{// Get the number of processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04678}04678         \textcolor{keywordtype}{unsigned} nproc = comm\_pt-\/>nproc();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04679}04679 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04680}04680         \textcolor{comment}{// My rank}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04681}04681         \textcolor{keywordtype}{unsigned} my\_rank = comm\_pt-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04682}04682 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04683}04683         \textcolor{comment}{// Storage for the data (per processor) to send.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04684}04684         Vector<Vector<unsigned>> column\_indices\_to\_send(nproc);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04685}04685         Vector<Vector<double>> values\_to\_send(nproc);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04686}04686 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04687}04687         \textcolor{comment}{// The sum of the nrow for the sub blocks (so far). This is used as an}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04688}04688         \textcolor{comment}{// offset to calculate the global equation number in the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04689}04689         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} sum\_of\_block\_nrow = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04690}04690 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04691}04691         \textcolor{keywordtype}{double} t\_prep\_data\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04692}04692         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04693}04693         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04694}04694           t\_prep\_data\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04695}04695         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04696}04696 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04697}04697         \textcolor{comment}{// Get the pointer to the result distribution, for convenience...}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04698}04698         LinearAlgebraDistribution* res\_distribution\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04699}04699           result\_matrix.distribution\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04700}04700 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04701}04701         \textcolor{comment}{// loop over the sub blocks to calculate the global\_eqn, get the values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04702}04702         \textcolor{comment}{// and column indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04703}04703         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04704}04704         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04705}04705           \textcolor{comment}{// Get the number of local rows in this block\_row from the first}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04706}04706           \textcolor{comment}{// block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04707}04707           \textcolor{keywordtype}{unsigned} current\_block\_nrow\_local =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04708}04708             matrix\_pt(block\_row\_i, 0)-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04709}04709 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04710}04710           \textcolor{comment}{// Get the first\_row for this block\_row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04711}04711           \textcolor{keywordtype}{unsigned} current\_block\_row\_first\_row =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04712}04712             matrix\_pt(block\_row\_i, 0)-\/>first\_row();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04713}04713 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04714}04714           \textcolor{comment}{// Loop through the number of local rows}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04715}04715           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} sub\_local\_eqn = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04716}04716                sub\_local\_eqn < current\_block\_nrow\_local;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04717}04717                sub\_local\_eqn++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04718}04718           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04719}04719             \textcolor{comment}{// Calculate the corresponding (res\_global\_eqn) equation number}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04720}04720             \textcolor{comment}{// for this local row number in this block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04721}04721             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} res\_global\_eqn =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04722}04722               sub\_local\_eqn + current\_block\_row\_first\_row + sum\_of\_block\_nrow;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04723}04723 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04724}04724             \textcolor{comment}{// Get the processor that this global row belongs to.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04725}04725             \textcolor{comment}{// The rank\_of\_global\_row(...) function loops through all the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04726}04726             \textcolor{comment}{// processors and does two unsigned comparisons. Since we have to do}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04727}04727             \textcolor{comment}{// this for every row, it may be better to store a list mapping for}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04728}04728             \textcolor{comment}{// very large number of processors.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04729}04729             \textcolor{keywordtype}{unsigned} res\_p =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04730}04730               res\_distribution\_pt-\/>rank\_of\_global\_row(res\_global\_eqn);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04731}04731 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04732}04732             \textcolor{comment}{// With the res\_p, we get the res\_first\_row to}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04733}04733             \textcolor{comment}{// work out the res\_local\_eqn}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04734}04734             \textcolor{keywordtype}{unsigned} res\_first\_row = res\_distribution\_pt-\/>first\_row(res\_p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04735}04735             \textcolor{keywordtype}{unsigned} res\_local\_eqn = res\_global\_eqn -\/ res\_first\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04736}04736 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04737}04737             \textcolor{comment}{// Loop through the block columns, calculate the nnz. This is used}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04738}04738             \textcolor{comment}{// to reserve space for the value and column\_indices Vectors.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04739}04739             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} current\_row\_nnz = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04740}04740             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04741}04741                  block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04742}04742             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04743}04743               \textcolor{comment}{// Get the row\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04744}04744               \textcolor{keywordtype}{int}* current\_block\_row\_start =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04745}04745                 matrix\_pt(block\_row\_i, block\_col\_i)-\/>row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04746}04746 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04747}04747               \textcolor{comment}{// Update the nnz for this row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04748}04748               current\_row\_nnz += current\_block\_row\_start[sub\_local\_eqn + 1] -\/}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04749}04749                                  current\_block\_row\_start[sub\_local\_eqn];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04750}04750             \} \textcolor{comment}{// for block column, get nnz.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04751}04751 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04752}04752             \textcolor{comment}{// Reserve space for efficiency.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04753}04753             \textcolor{comment}{// unsigned capacity\_in\_res\_p\_vec}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04754}04754             \textcolor{comment}{//  = column\_indices\_to\_send[res\_p].capacity();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04755}04755 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04756}04756             \textcolor{comment}{// Reserve memory for nnz+2, since we need to store the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04757}04757             \textcolor{comment}{// res\_local\_eqn and nnz as well as the data (values/column}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04758}04758             \textcolor{comment}{// indices). Note: The two reserve functions are called per row. If}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04759}04759             \textcolor{comment}{// the matrix is very sparse (just a few elements per row), it will}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04760}04760             \textcolor{comment}{// be more efficient to not reserve and let the STL vector handle}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04761}04761             \textcolor{comment}{// this. On average, this implementation is more efficient.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04762}04762             \textcolor{comment}{// column\_indices\_to\_send[res\_p].reserve(capacity\_in\_res\_p\_vec}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04763}04763             \textcolor{comment}{//    + current\_row\_nnz+2);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04764}04764             \textcolor{comment}{// values\_to\_send[res\_p].reserve(capacity\_in\_res\_p\_vec}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04765}04765             \textcolor{comment}{//    + current\_row\_nnz+2);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04766}04766 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04767}04767             \textcolor{comment}{// Push back the res\_local\_eqn and nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04768}04768             column\_indices\_to\_send[res\_p].push\_back(res\_local\_eqn);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04769}04769             column\_indices\_to\_send[res\_p].push\_back(current\_row\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04770}04770             values\_to\_send[res\_p].push\_back(res\_local\_eqn);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04771}04771             values\_to\_send[res\_p].push\_back(current\_row\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04772}04772 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04773}04773             \textcolor{comment}{// Loop through the block columns again and get the values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04774}04774             \textcolor{comment}{// and column\_indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04775}04775             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04776}04776                  block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04777}04777             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04778}04778               \textcolor{comment}{// Cache the pointer to the current block for convenience.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04779}04779               CRDoubleMatrix* current\_block\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04780}04780                 matrix\_pt(block\_row\_i, block\_col\_i);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04781}04781 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04782}04782               \textcolor{comment}{// Values, column indices and row\_start for the current block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04783}04783               \textcolor{keywordtype}{double}* current\_block\_values = current\_block\_pt-\/>value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04784}04784               \textcolor{keywordtype}{int}* current\_block\_column\_indices =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04785}04785                 current\_block\_pt-\/>column\_index();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04786}04786               \textcolor{keywordtype}{int}* current\_block\_row\_start = current\_block\_pt-\/>row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04787}04787 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04788}04788               \textcolor{comment}{// Loop though the values and column\_indices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04789}04789               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} val\_i = current\_block\_row\_start[sub\_local\_eqn];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04790}04790                    val\_i < current\_block\_row\_start[sub\_local\_eqn + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04791}04791                    val\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04792}04792               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04793}04793                 \textcolor{comment}{// Push back the value.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04794}04794                 values\_to\_send[res\_p].push\_back(current\_block\_values[val\_i]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04795}04795 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04796}04796                 \textcolor{comment}{// Push back the (offset) column index.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04797}04797                 column\_indices\_to\_send[res\_p].push\_back(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04798}04798                   current\_block\_column\_indices[val\_i] +}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04799}04799                   sum\_of\_ncol\_up\_to\_block[block\_col\_i]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04800}04800               \} \textcolor{comment}{// for block columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04801}04801             \} \textcolor{comment}{// for block column, get values and column\_indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04802}04802           \} \textcolor{comment}{// for sub\_local\_eqn}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04803}04803 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04804}04804           \textcolor{comment}{// update the sum\_of\_block\_nrow}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04805}04805           sum\_of\_block\_nrow += matrix\_pt(block\_row\_i, 0)-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04806}04806 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04807}04807         \} \textcolor{comment}{// for block\_row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04808}04808 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04809}04809         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04810}04810         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04811}04811           \textcolor{keywordtype}{double} t\_prep\_data\_finish = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04812}04812           \textcolor{keywordtype}{double} t\_prep\_data\_time = t\_prep\_data\_finish -\/ t\_prep\_data\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04813}04813           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for prep data: "{}} << t\_prep\_data\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04814}04814         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04815}04815 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04816}04816         \textcolor{comment}{// Prepare to send data!}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04817}04817 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04818}04818         \textcolor{comment}{// Storage for the number of data to be sent to each processor.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04819}04819         Vector<int> send\_n(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04820}04820 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04821}04821         \textcolor{comment}{// Storage for all the values/column indices to be sent}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04822}04822         \textcolor{comment}{// to each processor.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04823}04823         Vector<double> send\_values\_data;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04824}04824         Vector<unsigned> send\_column\_indices\_data;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04825}04825 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04826}04826         \textcolor{comment}{// Storage location within send\_values\_data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04827}04827         \textcolor{comment}{// (and send\_column\_indices\_data) for data to be sent to each processor.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04828}04828         Vector<int> send\_displacement(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04829}04829 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04830}04830         \textcolor{keywordtype}{double} t\_total\_ndata\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04831}04831         \textcolor{keywordflow}{if} (enable\_timing) t\_total\_ndata\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04832}04832 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04833}04833         \textcolor{comment}{// Get the total amount of data which needs to be sent, so we can}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04834}04834         \textcolor{comment}{// reserve space for it.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04835}04835         \textcolor{keywordtype}{unsigned} total\_ndata = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04836}04836         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} rank = 0; rank < nproc; rank++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04837}04837         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04838}04838           \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04839}04839           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04840}04840             total\_ndata += values\_to\_send[rank].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04841}04841           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04842}04842         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04843}04843 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04844}04844         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04845}04845         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04846}04846           \textcolor{keywordtype}{double} t\_total\_ndata\_finish = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04847}04847           \textcolor{keywordtype}{double} t\_total\_ndata\_time =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04848}04848             t\_total\_ndata\_finish -\/ t\_total\_ndata\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04849}04849           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for total\_ndata: "{}} << t\_total\_ndata\_time}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04850}04850                      << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04851}04851         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04852}04852 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04853}04853         \textcolor{keywordtype}{double} t\_flat\_pack\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04854}04854         \textcolor{keywordflow}{if} (enable\_timing) t\_flat\_pack\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04855}04855 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04856}04856         \textcolor{comment}{// Now we don't have to re-\/allocate data/memory when push\_back is}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04857}04857         \textcolor{comment}{// called. Nb. Using push\_back without reserving memory may cause}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04858}04858         \textcolor{comment}{// multiple re-\/allocation behind the scenes, this is expensive.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04859}04859         send\_values\_data.reserve(total\_ndata);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04860}04860         send\_column\_indices\_data.reserve(total\_ndata);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04861}04861 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04862}04862         \textcolor{comment}{// Loop over all the processors to "{}flat pack"{} the data for sending.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04863}04863         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} rank = 0; rank < nproc; rank++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04864}04864         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04865}04865           \textcolor{comment}{// Set the offset for the current processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04866}04866           \textcolor{comment}{// This only has to be done once for both values and column indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04867}04867           send\_displacement[rank] = send\_values\_data.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04868}04868 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04869}04869           \textcolor{comment}{// Don't bother to do anything if}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04870}04870           \textcolor{comment}{// the processor in the loop is the current processor.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04871}04871           \textcolor{keywordflow}{if} (rank != my\_rank)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04872}04872           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04873}04873             \textcolor{comment}{// Put the values into the send data vector.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04874}04874             \textcolor{comment}{// n\_data is the same for both values and column indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04875}04875             \textcolor{keywordtype}{unsigned} n\_data = values\_to\_send[rank].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04876}04876             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_data; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04877}04877             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04878}04878               send\_values\_data.push\_back(values\_to\_send[rank][j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04879}04879               send\_column\_indices\_data.push\_back(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04880}04880                 column\_indices\_to\_send[rank][j]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04881}04881             \} \textcolor{comment}{// for}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04882}04882           \} \textcolor{comment}{// if rank != my\_rank}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04883}04883 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04884}04884           \textcolor{comment}{// Find the number of data to be added to the vector.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04885}04885           \textcolor{comment}{// send\_n is the same for both values and column indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04886}04886           send\_n[rank] = send\_values\_data.size() -\/ send\_displacement[rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04887}04887         \} \textcolor{comment}{// loop over processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04888}04888 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04889}04889         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04890}04890         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04891}04891           \textcolor{keywordtype}{double} t\_flat\_pack\_finish = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04892}04892           \textcolor{keywordtype}{double} t\_flat\_pack\_time = t\_flat\_pack\_finish -\/ t\_flat\_pack\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04893}04893           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}t\_flat\_pack\_time: "{}} << t\_flat\_pack\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04894}04894         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04895}04895 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04896}04896         \textcolor{keywordtype}{double} t\_sendn\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04897}04897         \textcolor{keywordflow}{if} (enable\_timing) t\_sendn\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04898}04898 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04899}04899         \textcolor{comment}{// Strorage for the number of data to be received from each processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04900}04900         Vector<int> receive\_n(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04901}04901 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04902}04902         MPI\_Alltoall(\&send\_n[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04903}04903                      1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04904}04904                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04905}04905                      \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04906}04906                      1,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04907}04907                      MPI\_INT,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04908}04908                      comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04909}04909 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04910}04910         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04911}04911         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04912}04912           \textcolor{keywordtype}{double} t\_sendn\_finish = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04913}04913           \textcolor{keywordtype}{double} t\_sendn\_time = t\_sendn\_finish -\/ t\_sendn\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04914}04914           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}t\_sendn\_time: "{}} << t\_sendn\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04915}04915         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04916}04916 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04917}04917 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04918}04918         \textcolor{comment}{// Prepare the data to be received}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04919}04919         \textcolor{comment}{// by working out the displacement from the received data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04920}04920         \textcolor{comment}{// receive\_displacement is the same for both values and column indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04921}04921         Vector<int> receive\_displacement(nproc, 0);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04922}04922         \textcolor{keywordtype}{int} receive\_data\_count = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04923}04923         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} rank = 0; rank < nproc; rank++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04924}04924         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04925}04925           receive\_displacement[rank] = receive\_data\_count;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04926}04926           receive\_data\_count += receive\_n[rank];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04927}04927         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04928}04928 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04929}04929         \textcolor{comment}{// Now resize the receive buffer for all data from all processors.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04930}04930         \textcolor{comment}{// Make sure that it has a size of at least one.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04931}04931         \textcolor{keywordflow}{if} (receive\_data\_count == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04932}04932         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04933}04933           receive\_data\_count++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04934}04934         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04935}04935         Vector<double> receive\_values\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04936}04936         Vector<unsigned> receive\_column\_indices\_data(receive\_data\_count);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04937}04937 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04938}04938         \textcolor{comment}{// Make sure that the send buffer has size at least one}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04939}04939         \textcolor{comment}{// so that we don't get a segmentation fault.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04940}04940         \textcolor{keywordflow}{if} (send\_values\_data.size() == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04941}04941         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04942}04942           send\_values\_data.resize(1);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04943}04943         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04944}04944 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04945}04945         \textcolor{keywordtype}{double} t\_send\_data\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04946}04946         \textcolor{keywordflow}{if} (enable\_timing) t\_send\_data\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04947}04947 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04948}04948         \textcolor{comment}{// Now send the data between all processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04949}04949         MPI\_Alltoallv(\&send\_values\_data[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04950}04950                       \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04951}04951                       \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04952}04952                       MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04953}04953                       \&receive\_values\_data[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04954}04954                       \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04955}04955                       \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04956}04956                       MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04957}04957                       comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04958}04958 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04959}04959         \textcolor{comment}{// Now send the data between all processors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04960}04960         MPI\_Alltoallv(\&send\_column\_indices\_data[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04961}04961                       \&send\_n[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04962}04962                       \&send\_displacement[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04963}04963                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04964}04964                       \&receive\_column\_indices\_data[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04965}04965                       \&receive\_n[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04966}04966                       \&receive\_displacement[0],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04967}04967                       MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04968}04968                       comm\_pt-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04969}04969 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04970}04970         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04971}04971         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04972}04972           \textcolor{keywordtype}{double} t\_send\_data\_finish = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04973}04973           \textcolor{keywordtype}{double} t\_send\_data\_time = t\_send\_data\_finish -\/ t\_send\_data\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04974}04974           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}t\_send\_data\_time: "{}} << t\_send\_data\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04975}04975         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04976}04976 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04977}04977         \textcolor{comment}{// All the rows for this processor are stored in:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04978}04978         \textcolor{comment}{// from other processors:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04979}04979         \textcolor{comment}{// receive\_column\_indices\_data and receive\_values\_data}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04980}04980         \textcolor{comment}{// from this processor:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04981}04981         \textcolor{comment}{// column\_indices\_to\_send[my\_rank] and values\_to\_send[my\_rank]}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04982}04982         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04983}04983         \textcolor{comment}{// They are in some order determined by the distribution.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04984}04984         \textcolor{comment}{// We need to re-\/arrange them. To do this, we do some pre-\/processing.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04985}04985 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04986}04986         \textcolor{comment}{// nrow\_local for this processor.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04987}04987         \textcolor{keywordtype}{unsigned} res\_nrow\_local = res\_distribution\_pt-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04988}04988 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04989}04989         \textcolor{comment}{// Per row, store:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04990}04990         \textcolor{comment}{// 1) where this row came from, 0 -\/ this proc, 1 -\/ other procs.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04991}04991         \textcolor{comment}{// 2) the nnz,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04992}04992         \textcolor{comment}{// 3) the offset -\/ where the values/columns in the receive data vectors}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04993}04993         \textcolor{comment}{//                 begins. This is different from the offset of where}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04994}04994         \textcolor{comment}{//                 the data from a certain processor starts.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04995}04995         Vector<Vector<unsigned>> value\_column\_locations(res\_nrow\_local,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04996}04996                                                         Vector<unsigned>(3, 0));}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04997}04997 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04998}04998         \textcolor{comment}{// Store the local nnz so we can reserve space for}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l04999}04999         \textcolor{comment}{// the values and column indices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05000}05000         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} res\_nnz\_local = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05001}05001 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05002}05002         \textcolor{keywordtype}{double} t\_locations\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05003}05003         \textcolor{keywordflow}{if} (enable\_timing) t\_locations\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05004}05004 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05005}05005         \textcolor{comment}{// Loop through the data currently on this processor.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05006}05006         \textcolor{keywordtype}{unsigned} location\_i = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05007}05007         \textcolor{keywordtype}{unsigned} my\_column\_indices\_to\_send\_size =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05008}05008           column\_indices\_to\_send[my\_rank].size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05009}05009         \textcolor{keywordflow}{while} (location\_i < my\_column\_indices\_to\_send\_size)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05010}05010         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05011}05011           \textcolor{keywordtype}{unsigned} current\_local\_eqn =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05012}05012             column\_indices\_to\_send[my\_rank][location\_i++];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05013}05013 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05014}05014           \textcolor{keywordtype}{unsigned} current\_nnz = column\_indices\_to\_send[my\_rank][location\_i++];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05015}05015 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05016}05016           \textcolor{comment}{// No need to fill [*][0] with 0 since it is already initialised to 0.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05017}05017 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05018}05018           \textcolor{comment}{// Store the nnz.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05019}05019           value\_column\_locations[current\_local\_eqn][1] = current\_nnz;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05020}05020 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05021}05021           \textcolor{comment}{// Also increment the res\_local\_nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05022}05022           res\_nnz\_local += current\_nnz;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05023}05023 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05024}05024           \textcolor{comment}{// Store the offset.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05025}05025           value\_column\_locations[current\_local\_eqn][2] = location\_i;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05026}05026 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05027}05027           \textcolor{comment}{// Update the location\_i so it starts at the next row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05028}05028           location\_i += current\_nnz;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05029}05029         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05030}05030 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05031}05031         \textcolor{comment}{// Loop through the data from different processors.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05032}05032 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05033}05033         \textcolor{comment}{// Check to see if data has been received.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05034}05034         \textcolor{keywordtype}{bool} data\_has\_been\_received = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05035}05035         \textcolor{keywordtype}{unsigned} send\_rank = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05036}05036         \textcolor{keywordflow}{while} (send\_rank < nproc)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05037}05037         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05038}05038           \textcolor{keywordflow}{if} (receive\_n[send\_rank] > 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05039}05039           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05040}05040             data\_has\_been\_received = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05041}05041             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05042}05042           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05043}05043           send\_rank++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05044}05044         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05045}05045 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05046}05046         location\_i = 0; \textcolor{comment}{// start at 0.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05047}05047         \textcolor{keywordflow}{if} (data\_has\_been\_received)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05048}05048         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05049}05049           \textcolor{keywordtype}{unsigned} receive\_column\_indices\_data\_size =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05050}05050             receive\_column\_indices\_data.size();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05051}05051           \textcolor{keywordflow}{while} (location\_i < receive\_column\_indices\_data\_size)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05052}05052           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05053}05053             \textcolor{keywordtype}{unsigned} current\_local\_eqn =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05054}05054               receive\_column\_indices\_data[location\_i++];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05055}05055             \textcolor{keywordtype}{unsigned} current\_nnz = receive\_column\_indices\_data[location\_i++];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05056}05056 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05057}05057             \textcolor{comment}{// These comes from other processors.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05058}05058             value\_column\_locations[current\_local\_eqn][0] = 1;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05059}05059 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05060}05060             \textcolor{comment}{// Store the nnz.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05061}05061             value\_column\_locations[current\_local\_eqn][1] = current\_nnz;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05062}05062 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05063}05063             \textcolor{comment}{// Also increment the res\_local\_nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05064}05064             res\_nnz\_local += current\_nnz;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05065}05065 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05066}05066             \textcolor{comment}{// Store the offset.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05067}05067             value\_column\_locations[current\_local\_eqn][2] = location\_i;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05068}05068 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05069}05069             \textcolor{comment}{// Update the location\_i so it starts at the next row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05070}05070             location\_i += current\_nnz;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05071}05071           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05072}05072         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05073}05073 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05074}05074         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05075}05075         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05076}05076           \textcolor{keywordtype}{double} t\_locations\_finish = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05077}05077           \textcolor{keywordtype}{double} t\_locations\_time = t\_locations\_finish -\/ t\_locations\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05078}05078           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}t\_locations\_time: "{}} << t\_locations\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05079}05079         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05080}05080 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05081}05081         \textcolor{keywordtype}{double} t\_fillvecs\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05082}05082         \textcolor{keywordflow}{if} (enable\_timing) t\_fillvecs\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05083}05083 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05084}05084         \textcolor{comment}{// Now loop through the locations and store the values}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05085}05085         \textcolor{comment}{// the column indices in the correct order.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05086}05086         Vector<int> res\_column\_indices;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05087}05087         Vector<double> res\_values;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05088}05088         Vector<int> res\_row\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05089}05089 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05090}05090         res\_column\_indices.reserve(res\_nnz\_local);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05091}05091         res\_values.reserve(res\_nnz\_local);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05092}05092         res\_row\_start.reserve(res\_nrow\_local + 1);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05093}05093 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05094}05094         \textcolor{comment}{// Running sum of nnz for the row\_start. Must be int because}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05095}05095         \textcolor{comment}{// res\_row\_start is templated with int.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05096}05096         \textcolor{keywordtype}{int} nnz\_running\_sum = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05097}05097 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05098}05098         \textcolor{comment}{// Now insert the rows.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05099}05099         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} local\_row\_i = 0; local\_row\_i < res\_nrow\_local;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05100}05100              local\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05101}05101         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05102}05102           \textcolor{comment}{// Fill the res\_row\_start with the nnz so far.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05103}05103           res\_row\_start.push\_back(nnz\_running\_sum);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05104}05104 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05105}05105           \textcolor{keywordtype}{bool} data\_is\_from\_other\_proc =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05106}05106             bool(value\_column\_locations[local\_row\_i][0]);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05107}05107 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05108}05108           \textcolor{keywordtype}{unsigned} row\_i\_nnz = value\_column\_locations[local\_row\_i][1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05109}05109 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05110}05110           \textcolor{keywordtype}{unsigned} row\_i\_offset = value\_column\_locations[local\_row\_i][2];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05111}05111 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05112}05112           \textcolor{keywordflow}{if} (data\_is\_from\_other\_proc)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05113}05113           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05114}05114             \textcolor{comment}{// Insert range [offset, offset+nnz) from}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05115}05115             \textcolor{comment}{// receive\_column\_indices\_data and receive\_values\_data into}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05116}05116             \textcolor{comment}{// res\_column\_indices and res\_values respectively.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05117}05117             res\_column\_indices.insert(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05118}05118               res\_column\_indices.end(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05119}05119               receive\_column\_indices\_data.begin() + row\_i\_offset,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05120}05120               receive\_column\_indices\_data.begin() + row\_i\_offset + row\_i\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05121}05121 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05122}05122             res\_values.insert(res\_values.end(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05123}05123                               receive\_values\_data.begin() + row\_i\_offset,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05124}05124                               receive\_values\_data.begin() + row\_i\_offset +}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05125}05125                                 row\_i\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05126}05126           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05127}05127           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05128}05128           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05129}05129             res\_column\_indices.insert(res\_column\_indices.end(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05130}05130                                       column\_indices\_to\_send[my\_rank].begin() +}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05131}05131                                         row\_i\_offset,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05132}05132                                       column\_indices\_to\_send[my\_rank].begin() +}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05133}05133                                         row\_i\_offset + row\_i\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05134}05134 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05135}05135             res\_values.insert(res\_values.end(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05136}05136                               values\_to\_send[my\_rank].begin() + row\_i\_offset,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05137}05137                               values\_to\_send[my\_rank].begin() + row\_i\_offset +}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05138}05138                                 row\_i\_nnz);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05139}05139           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05140}05140 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05141}05141           \textcolor{comment}{// Update the running sum of nnz}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05142}05142           nnz\_running\_sum += row\_i\_nnz;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05143}05143         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05144}05144 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05145}05145         \textcolor{comment}{// Insert the last row\_start value}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05146}05146         res\_row\_start.push\_back(res\_nnz\_local);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05147}05147 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05148}05148         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05149}05149         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05150}05150           \textcolor{keywordtype}{double} t\_fillvecs\_finish = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05151}05151           \textcolor{keywordtype}{double} t\_fillvecs\_time = t\_fillvecs\_finish -\/ t\_fillvecs\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05152}05152           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}t\_fillvecs\_time: "{}} << t\_fillvecs\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05153}05153         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05154}05154 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05155}05155         \textcolor{keywordtype}{double} t\_buildres\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05156}05156         \textcolor{keywordflow}{if} (enable\_timing) t\_buildres\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05157}05157 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05158}05158         \textcolor{comment}{// build the matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05159}05159         result\_matrix.build(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05160}05160           res\_ncol, res\_values, res\_column\_indices, res\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05161}05161 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05162}05162         \textcolor{keywordflow}{if} (enable\_timing)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05163}05163         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05164}05164           \textcolor{keywordtype}{double} t\_buildres\_finish = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05165}05165           \textcolor{keywordtype}{double} t\_buildres\_time = t\_buildres\_finish -\/ t\_buildres\_start;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05166}05166           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}t\_buildres\_time: "{}} << t\_buildres\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05167}05167         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05168}05168         \textcolor{comment}{//  */}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05169}05169 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05170}05170       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05171}05171     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05172}05172 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05173}05173     \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05174}05174 \textcolor{comment}{    /// Concatenate CRDoubleMatrix matrices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05175}05175 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05176}05176 \textcolor{comment}{    /// The Vector row\_distribution\_pt contains the LinearAlgebraDistribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05177}05177 \textcolor{comment}{    /// of each block row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05178}05178 \textcolor{comment}{    /// The Vector col\_distribution\_pt contains the LinearAlgebraDistribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05179}05179 \textcolor{comment}{    /// of each block column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05180}05180 \textcolor{comment}{    /// The DenseMatrix matrix\_pt contains pointers to the CRDoubleMatrices}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05181}05181 \textcolor{comment}{    /// to concatenate.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05182}05182 \textcolor{comment}{    /// The CRDoubleMatrix result\_matrix is the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05183}05183 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05184}05184 \textcolor{comment}{    /// The result matrix is a permutation of the sub matrices such that the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05185}05185 \textcolor{comment}{    /// data stays on the same processor when the result matrix is built, there}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05186}05186 \textcolor{comment}{    /// is no communication between processors. Thus the block structure of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05187}05187 \textcolor{comment}{    /// sub matrices are NOT preserved in the result matrix. The rows are}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05188}05188 \textcolor{comment}{    /// block-\/permuted, defined by the concatenation of the distributions in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05189}05189 \textcolor{comment}{    /// row\_distribution\_pt. Similarly, the columns are block-\/permuted, defined}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05190}05190 \textcolor{comment}{    /// by the concatenation of the distributions in col\_distribution\_pt. For}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05191}05191 \textcolor{comment}{    /// more details on the block-\/permutation, see}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05192}05192 \textcolor{comment}{    /// LinearAlgebraDistributionHelpers::concatenate(...).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05193}05193 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05194}05194 \textcolor{comment}{    /// If one wishes to preserve the block structure of the sub matrices in the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05195}05195 \textcolor{comment}{    /// result matrix, consider using CRDoubleMatrixHelpers::concatenate(...),}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05196}05196 \textcolor{comment}{    /// which uses communication between processors to ensure that the block}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05197}05197 \textcolor{comment}{    /// structure of the sub matrices are preserved.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05198}05198 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05199}05199 \textcolor{comment}{    /// The matrix manipulation functions}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05200}05200 \textcolor{comment}{    /// CRDoubleMatrixHelpers::concatenate(...) and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05201}05201 \textcolor{comment}{    /// CRDoubleMatrixHelpers::concatenate\_without\_communication(...)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05202}05202 \textcolor{comment}{    /// are analogous to the Vector manipulation functions}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05203}05203 \textcolor{comment}{    /// DoubleVectorHelpers::concatenate(...) and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05204}05204 \textcolor{comment}{    /// DoubleVectorHelpers::concatenate\_without\_communication(...).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05205}05205 \textcolor{comment}{    /// Please look at the DoubleVector functions for an illustration of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05206}05206 \textcolor{comment}{    /// differences between concatenate(...) and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05207}05207 \textcolor{comment}{    /// concatenate\_without\_communication(...).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05208}05208 \textcolor{comment}{    ///}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05209}05209 \textcolor{comment}{    /// Distribution of the result matrix:}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05210}05210 \textcolor{comment}{    /// If the result matrix does not have a distribution built, then it will be}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05211}05211 \textcolor{comment}{    /// given a distribution built from the concatenation of the distributions}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05212}05212 \textcolor{comment}{    /// from row\_distribution\_pt, see}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05213}05213 \textcolor{comment}{    /// LinearAlgebraDistributionHelpers::concatenate(...) for more detail.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05214}05214 \textcolor{comment}{    /// Otherwise we use the existing distribution.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05215}05215 \textcolor{comment}{    /// If there is an existing distribution then it must be the same as the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05216}05216 \textcolor{comment}{    /// distribution from the concatenation of row distributions as described}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05217}05217 \textcolor{comment}{    /// above.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05218}05218 \textcolor{comment}{    /// Why don't we always compute the distribution "{}on the fly"{}?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05219}05219 \textcolor{comment}{    /// Because a non-\/uniform distribution requires communication.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05220}05220 \textcolor{comment}{    /// All block preconditioner distributions are concatenations of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05221}05221 \textcolor{comment}{    /// distributions of the individual blocks.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05222}05222 \textcolor{comment}{}    \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05223}05223     \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceoomph_a60abbd397064d971f529752aa9644fc7}{concatenate\_without\_communication}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05224}05224       \textcolor{keyword}{const} Vector<LinearAlgebraDistribution*>\& row\_distribution\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05225}05225       \textcolor{keyword}{const} Vector<LinearAlgebraDistribution*>\& col\_distribution\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05226}05226       \textcolor{keyword}{const} DenseMatrix<CRDoubleMatrix*>\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05227}05227       CRDoubleMatrix\& result\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05228}05228     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05229}05229       \textcolor{comment}{// The number of block rows and block columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05230}05230       \textcolor{keywordtype}{unsigned} matrix\_nrow = matrix\_pt.nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05231}05231       \textcolor{keywordtype}{unsigned} matrix\_ncol = matrix\_pt.ncol();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05232}05232 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05233}05233       \textcolor{comment}{// PARANOID checks involving in matrices and block\_distribution only.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05234}05234       \textcolor{comment}{// PARANOID checks involving the result matrix will come later since}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05235}05235       \textcolor{comment}{// we have to create the result matrix distribution from the in}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05236}05236       \textcolor{comment}{// distribution if it does not already exist.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05237}05237 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05238}05238 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05239}05239       \textcolor{comment}{// Are there matrices to concatenate?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05240}05240       \textcolor{keywordflow}{if} (matrix\_nrow == 0 || matrix\_ncol == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05241}05241       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05242}05242         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05243}05243         error\_message << \textcolor{stringliteral}{"{}There are no matrices to concatenate.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05244}05244         \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05245}05245                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05246}05246                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05247}05247       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05248}05248 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05249}05249       \textcolor{comment}{// Does this matrix need concatenating?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05250}05250       \textcolor{keywordflow}{if} ((matrix\_nrow == 1) \&\& (matrix\_ncol == 1))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05251}05251       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05252}05252         std::ostringstream warning\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05253}05253         warning\_message << \textcolor{stringliteral}{"{}There is only one matrix to concatenate...\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05254}05254                         << \textcolor{stringliteral}{"{}This does not require concatenating...\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05255}05255         OomphLibWarning(warning\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05256}05256                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05257}05257                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05258}05258       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05259}05259 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05260}05260 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05261}05261       \textcolor{comment}{// The distribution for each block row is stored in row\_distribution\_pt.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05262}05262       \textcolor{comment}{// So the number of distributions in row\_distribution\_pt must be the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05263}05263       \textcolor{comment}{// same as matrix\_nrow.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05264}05264       \textcolor{keywordflow}{if} (matrix\_nrow != row\_distribution\_pt.size())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05265}05265       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05266}05266         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05267}05267         error\_message << \textcolor{stringliteral}{"{}The number of row distributions must be the same as\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05268}05268                       << \textcolor{stringliteral}{"{}the number of block rows."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05269}05269         \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05270}05270                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05271}05271                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05272}05272       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05273}05273 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05274}05274       \textcolor{comment}{// The number of distributions for the columns must match the number of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05275}05275       \textcolor{comment}{// block columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05276}05276       \textcolor{keywordflow}{if} (matrix\_ncol != col\_distribution\_pt.size())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05277}05277       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05278}05278         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05279}05279         error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05280}05280           << \textcolor{stringliteral}{"{}The number of column distributions must be the same as\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05281}05281           << \textcolor{stringliteral}{"{}the number of block columns."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05282}05282         \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05283}05283                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05284}05284                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05285}05285       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05286}05286 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05287}05287       \textcolor{comment}{// Check that all pointers in row\_distribution\_pt is not null.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05288}05288       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05289}05289       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05290}05290         \textcolor{keywordflow}{if} (row\_distribution\_pt[block\_row\_i] == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05291}05291         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05292}05292           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05293}05293           error\_message << \textcolor{stringliteral}{"{}The row distribution pointer in position "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05294}05294                         << block\_row\_i << \textcolor{stringliteral}{"{} is null.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05295}05295           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05296}05296                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05297}05297                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05298}05298         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05299}05299       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05300}05300 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05301}05301       \textcolor{comment}{// Check that all pointers in row\_distribution\_pt is not null.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05302}05302       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05303}05303       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05304}05304         \textcolor{keywordflow}{if} (col\_distribution\_pt[block\_col\_i] == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05305}05305         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05306}05306           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05307}05307           error\_message << \textcolor{stringliteral}{"{}The column distribution pointer in position "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05308}05308                         << block\_col\_i << \textcolor{stringliteral}{"{} is null.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05309}05309           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05310}05310                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05311}05311                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05312}05312         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05313}05313       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05314}05314 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05315}05315       \textcolor{comment}{// Check that all distributions are built.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05316}05316       \textcolor{comment}{// First the row distributions}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05317}05317       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05318}05318       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05319}05319         \textcolor{keywordflow}{if} (!row\_distribution\_pt[block\_row\_i]-\/>built())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05320}05320         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05321}05321           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05322}05322           error\_message << \textcolor{stringliteral}{"{}The distribution pointer in position "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05323}05323                         << block\_row\_i << \textcolor{stringliteral}{"{} is not built.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05324}05324           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05325}05325                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05326}05326                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05327}05327         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05328}05328       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05329}05329       \textcolor{comment}{// Now the column distributions}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05330}05330       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05331}05331       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05332}05332         \textcolor{keywordflow}{if} (!col\_distribution\_pt[block\_col\_i]-\/>built())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05333}05333         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05334}05334           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05335}05335           error\_message << \textcolor{stringliteral}{"{}The distribution pointer in position "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05336}05336                         << block\_col\_i << \textcolor{stringliteral}{"{} is not built.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05337}05337           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05338}05338                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05339}05339                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05340}05340         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05341}05341       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05342}05342 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05343}05343       \textcolor{comment}{// Check that all communicators in row\_distribution\_pt are the same.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05344}05344       \textcolor{keyword}{const} OomphCommunicator first\_row\_comm =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05345}05345         *(row\_distribution\_pt[0]-\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05346}05346 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05347}05347       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 1; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05348}05348       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05349}05349         \textcolor{keyword}{const} OomphCommunicator current\_comm =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05350}05350           *(row\_distribution\_pt[block\_row\_i]-\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05351}05351 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05352}05352         \textcolor{keywordflow}{if} (first\_row\_comm != current\_comm)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05353}05353         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05354}05354           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05355}05355           error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05356}05356             << \textcolor{stringliteral}{"{}The communicator from the row distribution in position "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05357}05357             << block\_row\_i << \textcolor{stringliteral}{"{} is not the same as the first "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05358}05358             << \textcolor{stringliteral}{"{}communicator from row\_distribution\_pt"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05359}05359           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05360}05360                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05361}05361                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05362}05362         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05363}05363       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05364}05364 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05365}05365       \textcolor{comment}{// Check that all communicators in col\_distribution\_pt are the same as the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05366}05366       \textcolor{comment}{// first row communicator from above.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05367}05367       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05368}05368       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05369}05369         \textcolor{keyword}{const} OomphCommunicator current\_comm =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05370}05370           *(col\_distribution\_pt[block\_col\_i]-\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05371}05371 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05372}05372         \textcolor{keywordflow}{if} (first\_row\_comm != current\_comm)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05373}05373         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05374}05374           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05375}05375           error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05376}05376             << \textcolor{stringliteral}{"{}The communicator from the col distribution in position "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05377}05377             << block\_col\_i << \textcolor{stringliteral}{"{} is not the same as the first "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05378}05378             << \textcolor{stringliteral}{"{}communicator from row\_distribution\_pt"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05379}05379           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05380}05380                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05381}05381                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05382}05382         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05383}05383       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05384}05384 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05385}05385       \textcolor{comment}{// Are all sub matrices built? If the matrix\_pt is not null, make sure}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05386}05386       \textcolor{comment}{// that it is built.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05387}05387       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05388}05388       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05389}05389         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05390}05390         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05391}05391           \textcolor{keywordflow}{if} (matrix\_pt(block\_row\_i, block\_col\_i) != 0 \&\&}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05392}05392               !(matrix\_pt(block\_row\_i, block\_col\_i)-\/>built()))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05393}05393           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05394}05394             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05395}05395             error\_message << \textcolor{stringliteral}{"{}The sub matrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05396}05396                           << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05397}05397                           << \textcolor{stringliteral}{"{}is not built.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05398}05398             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05399}05399                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05400}05400                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05401}05401           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05402}05402         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05403}05403       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05404}05404 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05405}05405       \textcolor{comment}{// For the matrices which are built, do they have the same communicator as}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05406}05406       \textcolor{comment}{// the first communicator from row\_distribution\_pt?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05407}05407       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05408}05408       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05409}05409         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05410}05410         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05411}05411           \textcolor{keywordflow}{if} (matrix\_pt(block\_row\_i, block\_col\_i) != 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05412}05412           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05413}05413             \textcolor{keyword}{const} OomphCommunicator current\_comm =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05414}05414               *(matrix\_pt(block\_row\_i, block\_col\_i)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05415}05415                   -\/>distribution\_pt()}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05416}05416                   -\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05417}05417             \textcolor{keywordflow}{if} (first\_row\_comm != current\_comm)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05418}05418             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05419}05419               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05420}05420               error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05421}05421                 << \textcolor{stringliteral}{"{}The sub matrix\_pt("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05422}05422                 << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05423}05423                 << \textcolor{stringliteral}{"{}does not have the same communicator pointer as those in\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05424}05424                 << \textcolor{stringliteral}{"{}(row|col)\_distribution\_pt.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05425}05425               \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05426}05426                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05427}05427                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05428}05428             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05429}05429           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05430}05430         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05431}05431       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05432}05432 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05433}05433       \textcolor{comment}{// Do all dimensions of sub matrices "{}make sense"{}?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05434}05434       \textcolor{comment}{// Compare the number of rows of each block matrix in a block row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05435}05435       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05436}05436       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05437}05437         \textcolor{comment}{// Use the first column to compare against the rest.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05438}05438         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} current\_block\_nrow =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05439}05439           row\_distribution\_pt[block\_row\_i]-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05440}05440 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05441}05441         \textcolor{comment}{// Compare against columns 0 to matrix\_ncol -\/ 1}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05442}05442         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05443}05443         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05444}05444           \textcolor{comment}{// Perform the check if the matrix\_pt is not null.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05445}05445           \textcolor{keywordflow}{if} (matrix\_pt(block\_row\_i, block\_col\_i) != 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05446}05446           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05447}05447             \textcolor{comment}{// Get the nrow for this sub block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05448}05448             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} subblock\_nrow =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05449}05449               matrix\_pt(block\_row\_i, block\_col\_i)-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05450}05450 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05451}05451             \textcolor{keywordflow}{if} (current\_block\_nrow != subblock\_nrow)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05452}05452             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05453}05453               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05454}05454               error\_message << \textcolor{stringliteral}{"{}The sub matrix ("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05455}05455                             << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05456}05456                             << \textcolor{stringliteral}{"{}requires nrow = "{}} << current\_block\_nrow}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05457}05457                             << \textcolor{stringliteral}{"{}, but has nrow = "{}} << subblock\_nrow << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05458}05458                             << \textcolor{stringliteral}{"{}Either the row\_distribution\_pt is incorrect or "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05459}05459                             << \textcolor{stringliteral}{"{}the sub matrices are incorrect.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05460}05460               \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05461}05461                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05462}05462                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05463}05463             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05464}05464           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05465}05465         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05466}05466       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05467}05467 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05468}05468       \textcolor{comment}{// Compare the number of columns of each block matrix in a block column.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05469}05469       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05470}05470       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05471}05471         \textcolor{comment}{// Get the current block ncol from the linear algebra distribution.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05472}05472         \textcolor{comment}{// Note that we assume that the dimensions are symmetrical.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05473}05473         \textcolor{keywordtype}{unsigned} current\_block\_ncol = col\_distribution\_pt[block\_col\_i]-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05474}05474 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05475}05475         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05476}05476         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05477}05477           \textcolor{keywordflow}{if} (matrix\_pt(block\_row\_i, block\_col\_i) != 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05478}05478           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05479}05479             \textcolor{comment}{// Get the ncol for this sub block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05480}05480             \textcolor{keywordtype}{unsigned} subblock\_ncol =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05481}05481               matrix\_pt(block\_row\_i, block\_col\_i)-\/>ncol();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05482}05482 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05483}05483             \textcolor{keywordflow}{if} (current\_block\_ncol != subblock\_ncol)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05484}05484             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05485}05485               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05486}05486               error\_message << \textcolor{stringliteral}{"{}The sub matrix ("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05487}05487                             << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05488}05488                             << \textcolor{stringliteral}{"{}requires ncol = "{}} << current\_block\_ncol}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05489}05489                             << \textcolor{stringliteral}{"{}, but has ncol = "{}} << subblock\_ncol << \textcolor{stringliteral}{"{}.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05490}05490                             << \textcolor{stringliteral}{"{}Either the col\_distribution\_pt is incorrect or "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05491}05491                             << \textcolor{stringliteral}{"{}the sub matrices are incorrect.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05492}05492               \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05493}05493                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05494}05494                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05495}05495             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05496}05496           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05497}05497         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05498}05498       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05499}05499 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05500}05500       \textcolor{comment}{// Ensure that the distributions for all sub matrices in the same block}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05501}05501       \textcolor{comment}{// row are the same. This is because we permute the row across several}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05502}05502       \textcolor{comment}{// matrices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05503}05503 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05504}05504       \textcolor{comment}{// Loop through each block row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05505}05505       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05506}05506       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05507}05507         \textcolor{comment}{// Get the distribution from the first block in this row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05508}05508         LinearAlgebraDistribution* block\_row\_distribution\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05509}05509           row\_distribution\_pt[block\_row\_i];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05510}05510 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05511}05511         \textcolor{comment}{// Loop through the block columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05512}05512         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05513}05513         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05514}05514           \textcolor{keywordflow}{if} (matrix\_pt(block\_row\_i, block\_col\_i) != 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05515}05515           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05516}05516             \textcolor{comment}{// Get the distribution for this block.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05517}05517             LinearAlgebraDistribution* current\_block\_distribution\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05518}05518               matrix\_pt(block\_row\_i, block\_col\_i)-\/>distribution\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05519}05519 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05520}05520             \textcolor{comment}{// Ensure that the in matrices is a square block matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05521}05521             \textcolor{keywordflow}{if} ((*block\_row\_distribution\_pt) !=}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05522}05522                 (*current\_block\_distribution\_pt))}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05523}05523             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05524}05524               std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05525}05525               error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05526}05526                 << \textcolor{stringliteral}{"{}Sub block("{}} << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i << \textcolor{stringliteral}{"{})"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05527}05527                 << \textcolor{stringliteral}{"{}does not have the same distributoin as the first"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05528}05528                 << \textcolor{stringliteral}{"{}block in this block row.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05529}05529                 << \textcolor{stringliteral}{"{}All distributions on a block row must be the same"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05530}05530                 << \textcolor{stringliteral}{"{}for this function to concatenate matrices.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05531}05531               \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05532}05532                                   OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05533}05533                                   OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05534}05534             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05535}05535           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05536}05536         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05537}05537       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05538}05538 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05539}05539 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05540}05540       \textcolor{comment}{// The communicator pointer from the first row\_distribution\_pt}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05541}05541       \textcolor{keyword}{const} OomphCommunicator* \textcolor{keyword}{const} comm\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05542}05542         row\_distribution\_pt[0]-\/>communicator\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05543}05543 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05544}05544       \textcolor{comment}{// Renamed for so it makes more sense.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05545}05545       \textcolor{keywordtype}{unsigned} nblock\_row = matrix\_nrow;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05546}05546 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05547}05547       \textcolor{comment}{// If the result matrix does not have a distribution, then we concatenate}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05548}05548       \textcolor{comment}{// the sub matrix distributions.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05549}05549       \textcolor{keywordflow}{if} (!result\_matrix.distribution\_pt()-\/>built())}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05550}05550       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05551}05551         \textcolor{comment}{// The result distribution}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05552}05552         LinearAlgebraDistribution tmp\_distribution;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05553}05553         \mbox{\hyperlink{namespaceoomph_1_1LinearAlgebraDistributionHelpers_af11187289196182ce650da88cfe37fc2}{LinearAlgebraDistributionHelpers::concatenate}}(row\_distribution\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05554}05554                                                       tmp\_distribution);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05555}05555 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05556}05556         result\_matrix.build(\&tmp\_distribution);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05557}05557       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05558}05558       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05559}05559       \textcolor{comment}{// A distribution is supplied for the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05560}05560       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05561}05561 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05562}05562         \textcolor{comment}{// Check that the result distribution is a concatenation of the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05563}05563         \textcolor{comment}{// distributions of the sub matrices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05564}05564 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05565}05565         LinearAlgebraDistribution wanted\_distribution;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05566}05566 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05567}05567         \mbox{\hyperlink{namespaceoomph_1_1LinearAlgebraDistributionHelpers_af11187289196182ce650da88cfe37fc2}{LinearAlgebraDistributionHelpers::concatenate}}(row\_distribution\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05568}05568                                                       wanted\_distribution);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05569}05569 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05570}05570         \textcolor{keywordflow}{if} (*(result\_matrix.distribution\_pt()) != wanted\_distribution)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05571}05571         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05572}05572           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05573}05573           error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05574}05574             << \textcolor{stringliteral}{"{}The result distribution is not correct.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05575}05575             << \textcolor{stringliteral}{"{}Please call the function without a result\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05576}05576             << \textcolor{stringliteral}{"{}distribution (clear the result matrix) or check the\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05577}05577             << \textcolor{stringliteral}{"{}distribution of the result matrix.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05578}05578             << \textcolor{stringliteral}{"{}The result distribution must be the same as the one \(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05579}05579             << \textcolor{stringliteral}{"{}created by\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05580}05580             << \textcolor{stringliteral}{"{}LinearAlgebraDistributionHelpers::concatenate(...)"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05581}05581           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05582}05582                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05583}05583                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05584}05584         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05585}05585 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05586}05586       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05587}05587 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05588}05588       \textcolor{comment}{// The rest of the paranoid checks.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05589}05589 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05590}05590 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05591}05591       \textcolor{comment}{// Make sure that the communicator from the result matrix is the same as}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05592}05592       \textcolor{comment}{// all the others. This test is redundant if this function created the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05593}05593       \textcolor{comment}{// result matrix distribution, since then it is guaranteed that the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05594}05594       \textcolor{comment}{// communicators are the same.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05595}05595       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05596}05596         \textcolor{comment}{// Communicator from the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05597}05597         \textcolor{keyword}{const} OomphCommunicator res\_comm =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05598}05598           *(result\_matrix.distribution\_pt()-\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05599}05599 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05600}05600         \textcolor{comment}{// Is the result communicator pointer the same as the others?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05601}05601         \textcolor{comment}{// Since we have already tested the others, we only need to compare}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05602}05602         \textcolor{comment}{// against one of them. Say the first communicator from}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05603}05603         \textcolor{comment}{// row\_distribution\_pt.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05604}05604         \textcolor{keyword}{const} OomphCommunicator first\_comm =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05605}05605           *(row\_distribution\_pt[0]-\/>communicator\_pt());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05606}05606 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05607}05607         \textcolor{keywordflow}{if} (res\_comm != first\_comm)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05608}05608         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05609}05609           std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05610}05610           error\_message << \textcolor{stringliteral}{"{}The OomphCommunicator of the result matrix is not "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05611}05611                            \textcolor{stringliteral}{"{}the same as the "{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05612}05612                         << \textcolor{stringliteral}{"{}others!"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05613}05613           \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05614}05614                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05615}05615                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05616}05616         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05617}05617       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05618}05618 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05619}05619       \textcolor{comment}{// Are all the distributed boolean the same? This only applies if we have}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05620}05620       \textcolor{comment}{// more than one processor. If there is only one processor, then it does}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05621}05621       \textcolor{comment}{// not matter if it is distributed or not -\/ they are conceptually the}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05622}05622       \textcolor{comment}{// same.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05623}05623       \textcolor{keywordflow}{if} (comm\_pt-\/>nproc() != 1)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05624}05624       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05625}05625         \textcolor{comment}{// Compare distributed for sub matrices (against the result matrix).}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05626}05626         \textcolor{keyword}{const} \textcolor{keywordtype}{bool} res\_distributed = result\_matrix.distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05627}05627 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05628}05628         \textcolor{comment}{// Loop over all sub blocks.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05629}05629         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 0; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05630}05630         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05631}05631           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05632}05632                block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05633}05633           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05634}05634             \textcolor{keywordflow}{if} (matrix\_pt(block\_row\_i, block\_col\_i) != 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05635}05635             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05636}05636               \textcolor{keyword}{const} \textcolor{keywordtype}{bool} another\_distributed =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05637}05637                 matrix\_pt(block\_row\_i, block\_col\_i)-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05638}05638 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05639}05639               \textcolor{keywordflow}{if} (res\_distributed != another\_distributed)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05640}05640               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05641}05641                 std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05642}05642                 error\_message << \textcolor{stringliteral}{"{}The distributed boolean of the sub matrix ("{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05643}05643                               << block\_row\_i << \textcolor{stringliteral}{"{},"{}} << block\_col\_i << \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05644}05644                               << \textcolor{stringliteral}{"{}is not the same as the result matrix. \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05645}05645                 \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05646}05646                                     OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05647}05647                                     OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05648}05648               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05649}05649             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05650}05650           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05651}05651         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05652}05652 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05653}05653         \textcolor{comment}{// Do this test for row\_distribution\_pt}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05654}05654         \textcolor{keyword}{const} \textcolor{keywordtype}{bool} first\_row\_distribution\_distributed =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05655}05655           row\_distribution\_pt[0]-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05656}05656 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05657}05657         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_row\_i = 1; block\_row\_i < matrix\_nrow; block\_row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05658}05658         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05659}05659           \textcolor{keyword}{const} \textcolor{keywordtype}{bool} another\_distributed =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05660}05660             row\_distribution\_pt[block\_row\_i]-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05661}05661 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05662}05662           \textcolor{keywordflow}{if} (first\_row\_distribution\_distributed != another\_distributed)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05663}05663           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05664}05664             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05665}05665             error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05666}05666               << \textcolor{stringliteral}{"{}The distributed boolean of row\_distribution\_pt["{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05667}05667               << block\_row\_i << \textcolor{stringliteral}{"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05668}05668               << \textcolor{stringliteral}{"{}is not the same as the one from row\_distribution\_pt[0]. \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05669}05669             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05670}05670                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05671}05671                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05672}05672           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05673}05673         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05674}05674 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05675}05675         \textcolor{comment}{// Repeat for col\_distribution\_pt}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05676}05676         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05677}05677         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05678}05678           \textcolor{keyword}{const} \textcolor{keywordtype}{bool} another\_distributed =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05679}05679             col\_distribution\_pt[block\_col\_i]-\/>distributed();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05680}05680 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05681}05681           \textcolor{keywordflow}{if} (first\_row\_distribution\_distributed != another\_distributed)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05682}05682           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05683}05683             std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05684}05684             error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05685}05685               << \textcolor{stringliteral}{"{}The distributed boolean of col\_distribution\_pt["{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05686}05686               << block\_col\_i << \textcolor{stringliteral}{"{}]\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05687}05687               << \textcolor{stringliteral}{"{}is not the same as the one from row\_distribution\_pt[0]. \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05688}05688             \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05689}05689                                 OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05690}05690                                 OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05691}05691           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05692}05692         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05693}05693       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05694}05694 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05695}05695 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05696}05696 \textcolor{comment}{      /// /////////////// END OF PARANOID TESTS}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05697}05697 \textcolor{comment}{      /// ////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05698}05698 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05699}05699       \textcolor{comment}{// The number of processors.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05700}05700       \textcolor{keywordtype}{unsigned} nproc = comm\_pt-\/>nproc();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05701}05701 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05702}05702       \textcolor{comment}{// Cache the result distribution pointer for convenience.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05703}05703       LinearAlgebraDistribution* res\_distribution\_pt =}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05704}05704         result\_matrix.distribution\_pt();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05705}05705 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05706}05706       \textcolor{comment}{// nrow\_local for the result matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05707}05707       \textcolor{keywordtype}{unsigned} res\_nrow\_local = res\_distribution\_pt-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05708}05708 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05709}05709       \textcolor{comment}{// renamed for readability.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05710}05710       \textcolor{keywordtype}{unsigned} nblock\_col = matrix\_ncol;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05711}05711 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05712}05712       \textcolor{comment}{// construct the block offset}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05713}05713       \textcolor{comment}{//  DenseMatrix<unsigned> col\_offset(nproc,nblock\_col,0);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05714}05714       std::vector<std::vector<unsigned>> col\_offset(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05715}05715         nproc, std::vector<unsigned>(nblock\_col));}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05716}05716       \textcolor{keywordtype}{unsigned} off = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05717}05717       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} proc\_i = 0; proc\_i < nproc; proc\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05718}05718       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05719}05719         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_i = 0; block\_i < nblock\_col; block\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05720}05720         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05721}05721           col\_offset[proc\_i][block\_i] = off;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05722}05722           off += col\_distribution\_pt[block\_i]-\/>nrow\_local(proc\_i);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05723}05723         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05724}05724       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05725}05725 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05726}05726       \textcolor{comment}{// Do some pre-\/processing for the processor number a global row number is}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05727}05727       \textcolor{comment}{// on. This is required when permuting the column entries.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05728}05728       \textcolor{comment}{// We need to do this for each distribution, so we have a vector of}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05729}05729       \textcolor{comment}{// vectors. First index corresponds to the distribution, the second is}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05730}05730       \textcolor{comment}{// the processor number.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05731}05731       std::vector<std::vector<unsigned>> p\_for\_rows(nblock\_col,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05732}05732                                                     std::vector<unsigned>());}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05733}05733       \textcolor{comment}{// initialise 2D vector}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05734}05734       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} blocki = 0; blocki < nblock\_col; blocki++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05735}05735       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05736}05736         \textcolor{keywordtype}{int} blockinrow = col\_distribution\_pt[blocki]-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05737}05737         p\_for\_rows[blocki].resize(blockinrow);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05738}05738         \textcolor{comment}{// FOR each global index in the block, work out the corresponding proc.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05739}05739         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} rowi = 0; rowi < blockinrow; rowi++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05740}05740         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05741}05741           \textcolor{keywordtype}{unsigned} p = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05742}05742           \textcolor{keywordtype}{int} b\_first\_row = col\_distribution\_pt[blocki]-\/>first\_row(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05743}05743           \textcolor{keywordtype}{int} b\_nrow\_local = col\_distribution\_pt[blocki]-\/>nrow\_local(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05744}05744 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05745}05745           \textcolor{keywordflow}{while} (rowi < b\_first\_row || rowi >= b\_nrow\_local + b\_first\_row)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05746}05746           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05747}05747             p++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05748}05748             b\_first\_row = col\_distribution\_pt[blocki]-\/>first\_row(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05749}05749             b\_nrow\_local = col\_distribution\_pt[blocki]-\/>nrow\_local(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05750}05750           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05751}05751           p\_for\_rows[blocki][rowi] = p;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05752}05752         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05753}05753       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05754}05754 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05755}05755       \textcolor{comment}{// determine nnz of all blocks on this processor only.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05756}05756       \textcolor{comment}{// This is used to create storage space.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05757}05757       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} res\_nnz = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05758}05758       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} row\_i = 0; row\_i < nblock\_row; row\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05759}05759       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05760}05760         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} col\_i = 0; col\_i < nblock\_col; col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05761}05761         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05762}05762           \textcolor{keywordflow}{if} (matrix\_pt(row\_i, col\_i) != 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05763}05763           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05764}05764             res\_nnz += matrix\_pt(row\_i, col\_i)-\/>nnz();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05765}05765           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05766}05766         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05767}05767       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05768}05768 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05769}05769       \textcolor{comment}{// My rank}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05770}05770       \textcolor{comment}{//    unsigned my\_rank = comm\_pt-\/>my\_rank();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05771}05771       \textcolor{comment}{//    my\_rank = my\_rank;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05772}05772 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05773}05773       \textcolor{comment}{// Turn the above into a string.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05774}05774       \textcolor{comment}{//      std::ostringstream myrankstream;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05775}05775       \textcolor{comment}{//      myrankstream << "{}THISDOESNOTHINGnp"{} << my\_rank << std::endl;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05776}05776       \textcolor{comment}{//      std::string myrankstring = myrankstream.str();}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05777}05777 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05778}05778 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05779}05779       \textcolor{comment}{// CALLGRIND\_ZERO\_STATS;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05780}05780       \textcolor{comment}{// CALLGRIND\_START\_INSTRUMENTATION;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05781}05781 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05782}05782       \textcolor{comment}{// storage for the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05783}05783       \textcolor{keywordtype}{int}* res\_row\_start = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[res\_nrow\_local + 1];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05784}05784       \textcolor{keywordtype}{int}* res\_column\_index = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[res\_nnz];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05785}05785       \textcolor{keywordtype}{double}* res\_value = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[res\_nnz];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05786}05786 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05787}05787       \textcolor{comment}{// initialise the zero-\/th entry}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05788}05788       res\_row\_start[0] = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05789}05789 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05790}05790       \textcolor{comment}{// loop over the block rows}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05791}05791       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} res\_i = 0; \textcolor{comment}{// index for the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05792}05792       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} res\_row\_i = 0; \textcolor{comment}{// index for the row}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05793}05793       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nblock\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05794}05794       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05795}05795         \textcolor{comment}{// loop over the rows of the current block local rows.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05796}05796         \textcolor{keywordtype}{unsigned} block\_nrow = row\_distribution\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05797}05797         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < block\_nrow; k++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05798}05798         \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05799}05799           \textcolor{comment}{// initialise res\_row\_start}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05800}05800           res\_row\_start[res\_row\_i + 1] = res\_row\_start[res\_row\_i];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05801}05801 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05802}05802           \textcolor{comment}{// Loop over the block columns}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05803}05803           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < nblock\_col; j++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05804}05804           \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05805}05805             \textcolor{comment}{// if block(i,j) pointer is not null then}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05806}05806             \textcolor{keywordflow}{if} (matrix\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) != 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05807}05807             \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05808}05808               \textcolor{comment}{// get pointers for the elements in the current block}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05809}05809               \textcolor{keywordtype}{int}* b\_row\_start = matrix\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j)-\/>row\_start();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05810}05810               \textcolor{keywordtype}{int}* b\_column\_index = matrix\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j)-\/>column\_index();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05811}05811               \textcolor{keywordtype}{double}* b\_value = matrix\_pt(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j)-\/>value();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05812}05812 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05813}05813               \textcolor{comment}{// memcpy( \&dst[dstIdx], \&src[srcIdx], numElementsToCopy * sizeof(}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05814}05814               \textcolor{comment}{// Element ) );}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05815}05815               \textcolor{comment}{// no ele to copy}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05816}05816               \textcolor{keywordtype}{int} numEleToCopy = b\_row\_start[k + 1] -\/ b\_row\_start[k];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05817}05817               memcpy(res\_value + res\_i,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05818}05818                      b\_value + b\_row\_start[k],}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05819}05819                      numEleToCopy * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05820}05820               \textcolor{comment}{// Loop through the current local row.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05821}05821               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} l = b\_row\_start[k]; l < b\_row\_start[k + 1]; l++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05822}05822               \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05823}05823                 \textcolor{comment}{// if b\_column\_index[l] was a row index, what processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05824}05824                 \textcolor{comment}{// would it be on}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05825}05825                 \textcolor{comment}{//            unsigned p = col\_distribution\_pt[j]}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05826}05826                 \textcolor{comment}{//              -\/>rank\_of\_global\_row\_map(b\_column\_index[l]);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05827}05827                 \textcolor{keywordtype}{unsigned} p = p\_for\_rows[j][b\_column\_index[l]];}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05828}05828 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05829}05829                 \textcolor{keywordtype}{int} b\_first\_row = col\_distribution\_pt[j]-\/>first\_row(p);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05830}05830                 \textcolor{comment}{//            int b\_nrow\_local =}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05831}05831                 \textcolor{comment}{//            col\_distribution\_pt[j]-\/>nrow\_local(p);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05832}05832 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05833}05833                 \textcolor{comment}{//            while (b\_column\_index[l] < b\_first\_row ||}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05834}05834                 \textcolor{comment}{//                   b\_column\_index[l] >=}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05835}05835                 \textcolor{comment}{//                   b\_nrow\_local+b\_first\_row)}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05836}05836                 \textcolor{comment}{//             \{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05837}05837                 \textcolor{comment}{//              p++;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05838}05838                 \textcolor{comment}{//              b\_first\_row =}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05839}05839                 \textcolor{comment}{//              col\_distribution\_pt[j]-\/>first\_row(p);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05840}05840                 \textcolor{comment}{//              b\_nrow\_local =}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05841}05841                 \textcolor{comment}{//              col\_distribution\_pt[j]-\/>nrow\_local(p);}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05842}05842                 \textcolor{comment}{//             \}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05843}05843 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05844}05844                 \textcolor{comment}{// determine the local equation number in the block j/processor}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05845}05845                 \textcolor{comment}{// p "{}column block"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05846}05846                 \textcolor{keywordtype}{int} eqn = b\_column\_index[l] -\/ b\_first\_row;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05847}05847 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05848}05848                 \textcolor{comment}{// add to the result matrix}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05849}05849                 \textcolor{comment}{//            res\_value[res\_i] = b\_value[l];}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05850}05850                 res\_column\_index[res\_i] = col\_offset[p][j] + eqn;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05851}05851                 res\_row\_start[res\_row\_i + 1]++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05852}05852                 res\_i++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05853}05853               \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05854}05854             \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05855}05855           \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05856}05856 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05857}05857           \textcolor{comment}{// increment the row pt}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05858}05858           res\_row\_i++;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05859}05859         \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05860}05860       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05861}05861       \textcolor{comment}{// CALLGRIND\_STOP\_INSTRUMENTATION;}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05862}05862       \textcolor{comment}{// CALLGRIND\_DUMP\_STATS\_AT(myrankstring.c\_str());}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05863}05863 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05864}05864 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05865}05865       \textcolor{comment}{// Get the number of columns of the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05866}05866       \textcolor{keywordtype}{unsigned} res\_ncol = 0;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05867}05867       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} block\_col\_i = 0; block\_col\_i < matrix\_ncol; block\_col\_i++)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05868}05868       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05869}05869         res\_ncol += col\_distribution\_pt[block\_col\_i]-\/>nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05870}05870       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05871}05871 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05872}05872       \textcolor{comment}{// Build the result matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05873}05873       result\_matrix.build\_without\_copy(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05874}05874         res\_ncol, res\_nnz, res\_value, res\_column\_index, res\_row\_start);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05875}05875     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05876}05876 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05877}05877 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05878}05878     \textcolor{comment}{//============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05879}05879 \textcolor{comment}{    /// Concatenate CRDoubleMatrix matrices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05880}05880 \textcolor{comment}{    /// This calls the other concatenate\_without\_communication(...) function,}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05881}05881 \textcolor{comment}{    /// passing block\_distribution\_pt as both the row\_distribution\_pt and}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05882}05882 \textcolor{comment}{    /// col\_distribution\_pt. This should only be called for block square}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05883}05883 \textcolor{comment}{    /// matrices.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05884}05884 \textcolor{comment}{}    \textcolor{comment}{//============================================================================}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05885}05885     \textcolor{keywordtype}{void} \mbox{\hyperlink{namespaceoomph_a60abbd397064d971f529752aa9644fc7}{concatenate\_without\_communication}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05886}05886       \textcolor{keyword}{const} Vector<LinearAlgebraDistribution*>\& block\_distribution\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05887}05887       \textcolor{keyword}{const} DenseMatrix<CRDoubleMatrix*>\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05888}05888       CRDoubleMatrix\& result\_matrix)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05889}05889     \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05890}05890 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05891}05891       \textcolor{comment}{// The number of block rows and block columns.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05892}05892       \textcolor{keywordtype}{unsigned} matrix\_nrow = matrix\_pt.nrow();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05893}05893       \textcolor{keywordtype}{unsigned} matrix\_ncol = matrix\_pt.ncol();}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05894}05894 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05895}05895       \textcolor{comment}{// Are there matrices to concatenate?}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05896}05896       \textcolor{keywordflow}{if} (matrix\_nrow == 0)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05897}05897       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05898}05898         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05899}05899         error\_message << \textcolor{stringliteral}{"{}There are no matrices to concatenate.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05900}05900         \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05901}05901                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05902}05902                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05903}05903       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05904}05904 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05905}05905       \textcolor{comment}{// Ensure that the sub matrices is a square block matrix.}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05906}05906       \textcolor{keywordflow}{if} (matrix\_nrow != matrix\_ncol)}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05907}05907       \{}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05908}05908         std::ostringstream error\_message;}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05909}05909         error\_message}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05910}05910           << \textcolor{stringliteral}{"{}The number of block rows and block columns\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05911}05911           << \textcolor{stringliteral}{"{}must be the same. Otherwise, call the other\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05912}05912           << \textcolor{stringliteral}{"{}concatenate\_without\_communication function, passing in\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05913}05913           << \textcolor{stringliteral}{"{}a Vector of distributions describing how to permute the\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05914}05914           << \textcolor{stringliteral}{"{}columns."{}};}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05915}05915         \textcolor{keywordflow}{throw} OomphLibError(error\_message.str(),}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05916}05916                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05917}05917                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05918}05918       \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05919}05919 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05920}05920 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05921}05921       \mbox{\hyperlink{namespaceoomph_a60abbd397064d971f529752aa9644fc7}{concatenate\_without\_communication}}(}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05922}05922         block\_distribution\_pt, block\_distribution\_pt, matrix\_pt, result\_matrix);}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05923}05923     \}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05924}05924 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05925}05925   \} \textcolor{comment}{// namespace CRDoubleMatrixHelpers}}
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05926}05926 }
\DoxyCodeLine{\Hypertarget{matrices_8cc_source_l05927}05927 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
