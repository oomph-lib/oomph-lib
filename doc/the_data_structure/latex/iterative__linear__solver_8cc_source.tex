\hypertarget{iterative__linear__solver_8cc_source}{}\doxysection{iterative\+\_\+linear\+\_\+solver.\+cc}
\label{iterative__linear__solver_8cc_source}\index{iterative\_linear\_solver.cc@{iterative\_linear\_solver.cc}}
\mbox{\hyperlink{iterative__linear__solver_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2021 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00026}00026 \textcolor{comment}{// The actual solve functions for Iterative solvers.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00029}00029 \textcolor{comment}{// Config header generated by autoconfig}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00030}00030 \textcolor{preprocessor}{\#ifdef HAVE\_CONFIG\_H}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00031}00031 \textcolor{preprocessor}{\#include <oomph-\/lib-\/config.h>}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00032}00032 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00034}00034 \textcolor{comment}{// Oomph-\/lib includes}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00035}00035 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{iterative__linear__solver_8h}{iterative\_linear\_solver.h}}"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00037}00037 \textcolor{comment}{// Required to force\_ get templated builds of iterative solvers for}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00038}00038 \textcolor{comment}{// sumofmatrices class.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00039}00039 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{sum__of__matrices_8h}{sum\_of\_matrices.h}}"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00041}00041 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00042}00042 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00043}00043 \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00044}00044   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00045}00045 \textcolor{comment}{  /// Default preconditioner for iterative solvers: The base}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00046}00046 \textcolor{comment}{  /// class for preconditioners is a fully functional (if trivial!)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00047}00047 \textcolor{comment}{  /// preconditioner.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00048}00048 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00049}00049   IdentityPreconditioner \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a8393d99578cbee0fdb937ddec34be74c}{IterativeLinearSolver::Default\_preconditioner}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00051}00051 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00052}00052 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00053}00053 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00054}00054 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00055}00055 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00057}00057   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00058}00058 \textcolor{comment}{  /// Re-\/solve the system defined by the last assembled Jacobian}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00059}00059 \textcolor{comment}{  /// and the rhs vector specified here. Solution is returned in}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00060}00060 \textcolor{comment}{  /// the vector result.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00061}00061 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00062}00062   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00063}\mbox{\hyperlink{classoomph_1_1BiCGStab_a3694a08628f3567caa5f20bb5dcfe677}{00063}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BiCGStab_a3694a08628f3567caa5f20bb5dcfe677}{BiCGStab<MATRIX>::resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00064}00064   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00065}00065     \textcolor{comment}{// We are re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00066}00066     Resolving = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00068}00068 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00069}00069     \textcolor{keywordflow}{if} (Matrix\_pt == 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00070}00070     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00071}00071       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}No matrix was stored -\/-\/ cannot re-\/solve"{}},}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00072}00072                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00073}00073                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00074}00074     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00075}00075 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00076}00076 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00077}00077     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00078}00078     this-\/>solve(Matrix\_pt, rhs, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00080}00080     \textcolor{comment}{// Reset re-\/solving flag}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00081}00081     Resolving = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00082}00082   \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00084}00084   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00085}00085 \textcolor{comment}{  /// Solver: Takes pointer to problem and returns the results vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00086}00086 \textcolor{comment}{  /// which contains the solution of the linear system defined by}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00087}00087 \textcolor{comment}{  /// the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00088}00088 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00089}00089   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00090}\mbox{\hyperlink{classoomph_1_1BiCGStab_a56e2df052fee2e26ffec644ad9161864}{00090}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BiCGStab_a56e2df052fee2e26ffec644ad9161864}{BiCGStab<MATRIX>::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00091}00091   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00092}00092     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00093}00093 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00094}00094     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00095}00095 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00096}00096     clock\_t t\_start = clock();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00097}00097 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00098}00098 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00099}00099     \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00100}00100     Resolving = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00101}00101 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00102}00102     \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00103}00103     \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00104}00104 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00105}00105     \textcolor{comment}{// Get Jacobian matrix in format specified by template parameter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00106}00106     \textcolor{comment}{// and nonlinear residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00107}00107     Matrix\_pt = \textcolor{keyword}{new} MATRIX;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00108}00108     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00109}00109     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *Matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00110}00110 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00112}00112     \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00113}00113     Matrix\_can\_be\_deleted = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00114}00114 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00115}00115     \textcolor{comment}{// Doc time for setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00116}00116 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00117}00117     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00118}00118     Jacobian\_setup\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00119}00119 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00120}00120     clock\_t t\_end = clock();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00121}00121     Jacobian\_setup\_time = double(t\_end -\/ t\_start) / CLOCKS\_PER\_SEC;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00122}00122 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00124}00124     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00125}00125     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00126}00126       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of Jacobian [sec]: "{}} << Jacobian\_setup\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00127}00127                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00128}00128     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00130}00130     \textcolor{comment}{// set the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00131}00131     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(Matrix\_pt))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00132}00132     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00133}00133       \textcolor{comment}{// the solver has the same distribution as the matrix if possible}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00134}00134       this-\/>build\_distribution(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00135}00135         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(Matrix\_pt)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00136}00136           -\/>distribution\_pt());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00137}00137     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00138}00138     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00139}00139     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00140}00140       \textcolor{comment}{// the solver has the same distribution as the RHS}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00141}00141       this-\/>build\_distribution(f.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00142}00142     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00143}00143 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00144}00144     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00145}00145     \textcolor{keywordflow}{if} ((result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}()) \&\&}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00146}00146         (!(*result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *this-\/>distribution\_pt())))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00147}00147     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00148}00148       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} temp\_global\_dist(result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00149}00149       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00150}00150       this-\/>solve\_helper(Matrix\_pt, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00151}00151       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&temp\_global\_dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00152}00152     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00153}00153     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00154}00154     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00155}00155       this-\/>solve\_helper(Matrix\_pt, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00156}00156     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00158}00158     \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00159}00159     \textcolor{keywordflow}{if} (!Enable\_resolve) \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00160}00160   \};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00161}00161 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00162}00162 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00163}00163   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00164}00164 \textcolor{comment}{  /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and rhs vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00165}00165 \textcolor{comment}{  /// and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00166}00166 \textcolor{comment}{  /// Algorithm and variable names based on "{}Numerical Linear Algebra}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00167}00167 \textcolor{comment}{  /// for High-\/Performance Computers"{} by Dongarra, Duff, Sorensen \& van}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00168}00168 \textcolor{comment}{  /// der Vorst. SIAM  (1998), page 185.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00169}00169 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00170}00170   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00171}\mbox{\hyperlink{classoomph_1_1BiCGStab_a6e6e49eb139bbc2aedfcb6cd075de3db}{00171}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BiCGStab_a6e6e49eb139bbc2aedfcb6cd075de3db}{BiCGStab<MATRIX>::solve\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00172}00172                                       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00173}00173                                       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00174}00174   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00175}00175 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00176}00176     \textcolor{comment}{// check that the rhs vector is setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00177}00177     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00178}00178     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00179}00179       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00180}00180       error\_message\_stream << \textcolor{stringliteral}{"{}The vectors rhs must be setup"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00181}00181       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00182}00182                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00183}00183                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00184}00184     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00185}00185 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00186}00186     \textcolor{comment}{// check that the matrix is square}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00187}00187     \textcolor{keywordflow}{if} (matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_acdcd6e1ea2bf2380f1a2fa32c7829cb5}{nrow}}() != matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a253feffbf1db1976cdd86c6134c50abe}{ncol}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00188}00188     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00189}00189       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00190}00190       error\_message\_stream << \textcolor{stringliteral}{"{}The matrix at matrix\_pt must be square."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00191}00191       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00192}00192                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00193}00193                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00194}00194     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00195}00195 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00196}00196     \textcolor{comment}{// check that the matrix and the rhs vector have the same nrow()}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00197}00197     \textcolor{keywordflow}{if} (matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_acdcd6e1ea2bf2380f1a2fa32c7829cb5}{nrow}}() != rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00198}00198     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00199}00199       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00200}00200       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00201}00201         << \textcolor{stringliteral}{"{}The matrix and the rhs vector must have the same number of rows."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00202}00202       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00203}00203                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00204}00204                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00205}00205     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00206}00206 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00207}00207     \textcolor{comment}{// if the matrix is distributable then it too should have the same}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00208}00208     \textcolor{comment}{// communicator as the rhs vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00209}00209     \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}* dist\_matrix\_pt =}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00210}00210       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00211}00211     \textcolor{keywordflow}{if} (dist\_matrix\_pt != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00212}00212     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00213}00213       \textcolor{keywordflow}{if} (!(*dist\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00214}00214       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00215}00215         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00216}00216         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00217}00217           << \textcolor{stringliteral}{"{}The matrix matrix\_pt must have the same communicator as the "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00218}00218              \textcolor{stringliteral}{"{}vectors"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00219}00219           << \textcolor{stringliteral}{"{} rhs and result must have the same communicator"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00220}00220         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00221}00221                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00222}00222                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00223}00223       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00224}00224     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00225}00225     \textcolor{comment}{// if the matrix is not distributable then it the rhs vector should not be}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00226}00226     \textcolor{comment}{// distributed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00227}00227     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00228}00228     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00229}00229       \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00230}00230       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00231}00231         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00232}00232         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00233}00233           << \textcolor{stringliteral}{"{}The matrix (matrix\_pt) is not distributable and therefore the rhs"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00234}00234           << \textcolor{stringliteral}{"{} vector must not be distributed"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00235}00235         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00236}00236                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00237}00237                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00238}00238       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00239}00239     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00240}00240     \textcolor{comment}{// if the result vector is setup then check it has the same distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00241}00241     \textcolor{comment}{// as the rhs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00242}00242     \textcolor{keywordflow}{if} (solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00243}00243     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00244}00244       \textcolor{keywordflow}{if} (!(*solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00245}00245       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00246}00246         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00247}00247         error\_message\_stream << \textcolor{stringliteral}{"{}The solution vector distribution has been "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00248}00248                                 \textcolor{stringliteral}{"{}setup; it must have the "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00249}00249                              << \textcolor{stringliteral}{"{}same distribution as the rhs vector."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00250}00250         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00251}00251                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00252}00252                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00253}00253       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00254}00254     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00255}00255 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00256}00256 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00257}00257     \textcolor{comment}{// setup the solution if it is not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00258}00258     \textcolor{keywordflow}{if} (!solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a92bfff97fd228b9c528922c39ab563b2}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00259}00259     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00260}00260       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00261}00261     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00262}00262     \textcolor{comment}{// zero}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00263}00263     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00264}00264     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00265}00265       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00266}00266     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00267}00267 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00268}00268     \textcolor{comment}{// Get number of dofs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00269}00269     \textcolor{comment}{// unsigned n\_dof=rhs.size();}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00270}00270     \textcolor{keywordtype}{unsigned} nrow\_local = this-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00271}00271 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00272}00272     \textcolor{comment}{// Time solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00273}00273 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00274}00274     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00275}00275 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00276}00276     clock\_t t\_start = clock();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00277}00277 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00278}00278 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00279}00279     \textcolor{comment}{// Initialise: Zero initial guess so the initial residual is}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00280}00280     \textcolor{comment}{// equal to the RHS, i.e. the nonlinear residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00281}00281     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} residual(rhs);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00282}00282     \textcolor{keywordtype}{double} residual\_norm = residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00283}00283     \textcolor{keywordtype}{double} rhs\_norm = residual\_norm;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00284}00284     \textcolor{keywordflow}{if} (rhs\_norm == 0.0) rhs\_norm = 1.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00285}00285     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x(rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00286}00286 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00287}00287     \textcolor{comment}{// Hat residual by copy operation}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00288}00288     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} r\_hat(residual);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00289}00289 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00290}00290     \textcolor{comment}{// Normalised residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00291}00291     \textcolor{keywordtype}{double} normalised\_residual\_norm = residual\_norm / rhs\_norm;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00292}00292 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00293}00293     \textcolor{comment}{// if required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00294}00294     \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00295}00295     \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00296}00296     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00297}00297       \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00298}00298       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00299}00299         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << 0 << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00300}00300       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00301}00301       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00302}00302       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00303}00303         Output\_file\_stream << 0 << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00304}00304       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00305}00305     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00306}00306 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00307}00307     \textcolor{comment}{// Check immediate convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00308}00308     \textcolor{keywordflow}{if} (normalised\_residual\_norm < Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00309}00309     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00310}00310       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00311}00311       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00312}00312         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}BiCGStab converged immediately"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00313}00313       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00314}00314       solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00315}00315 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00316}00316       \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00317}00317       \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00318}00318       Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00319}00319 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00320}00320       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00321}00321       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00322}00322         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with BiCGStab  [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00323}00323                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00324}00324       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00325}00325       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00326}00326     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00327}00327 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00328}00328     \textcolor{comment}{// Setup preconditioner only if we're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00329}00329     \textcolor{keywordflow}{if} (!Resolving)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00330}00330     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00331}00331       \textcolor{comment}{// only setup the preconditioner if required}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00332}00332       \textcolor{keywordflow}{if} (Setup\_preconditioner\_before\_solve)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00333}00333       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00334}00334         \textcolor{comment}{// Setup preconditioner from the Jacobian matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00335}00335         \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00336}00336 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00337}00337         preconditioner\_pt()-\/>setup(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00338}00338 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00339}00339         \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00340}00340         \textcolor{keywordtype}{double} t\_end\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00341}00341         Preconditioner\_setup\_time = t\_end\_prec -\/ t\_start\_prec;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00342}00342 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00343}00343         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00344}00344         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00345}00345           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of preconditioner  [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00346}00346                      << Preconditioner\_setup\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00347}00347         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00348}00348       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00349}00349     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00350}00350     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00351}00351     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00352}00352       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00353}00353       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00354}00354         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Setup of preconditioner is bypassed in resolve mode"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00355}00355                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00356}00356       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00357}00357     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00358}00358 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00359}00359     \textcolor{comment}{// Some auxiliary variables}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00360}00360     \textcolor{keywordtype}{double} rho\_prev = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00361}00361     \textcolor{keywordtype}{double} alpha = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00362}00362     \textcolor{keywordtype}{double} omega = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00363}00363     \textcolor{keywordtype}{double} rho, beta, dot\_prod, dot\_prod\_tt, dot\_prod\_ts;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00364}00364     \textcolor{keywordtype}{double} s\_norm, r\_norm;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00365}00365 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00366}00366     \textcolor{comment}{// Some vectors}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00367}00367     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} p(this-\/>distribution\_pt(), 0.0),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00368}00368       p\_hat(this-\/>distribution\_pt(), 0.0), v(this-\/>distribution\_pt(), 0.0),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00369}00369       z(this-\/>distribution\_pt(), 0.0), \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}(this-\/>distribution\_pt(), 0.0),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00370}00370       \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00371}00371 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00372}00372     \textcolor{comment}{// Loop over max. number of iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00373}00373     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iter = 1; iter <= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}; iter++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00374}00374     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00375}00375       \textcolor{comment}{// Dot product for rho}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00376}00376       rho = r\_hat.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(residual);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00377}00377 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00378}00378       \textcolor{comment}{// Breakdown?}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00379}00379       \textcolor{keywordflow}{if} (rho == 0.0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00380}00380       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00381}00381         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}BiCGStab has broken down after "{}} << iter << \textcolor{stringliteral}{"{} iterations"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00382}00382                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00383}00383         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Returning with current normalised residual of "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00384}00384                    << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00385}00385       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00386}00386 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00387}00387       \textcolor{comment}{// First step is different}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00388}00388       \textcolor{keywordflow}{if} (iter == 1)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00389}00389       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00390}00390         p = residual;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00391}00391       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00392}00392       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00393}00393       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00394}00394         beta = (rho / rho\_prev) * (alpha / omega);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00395}00395         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00396}00396         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00397}00397           p[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = residual[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + beta * (p[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ omega * v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00398}00398         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00399}00399       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00400}00400 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00401}00401       \textcolor{comment}{// Apply precondtitioner: p\_hat=P\string^-\/1*p}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00402}00402       preconditioner\_pt()-\/>preconditioner\_solve(p, p\_hat);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00403}00403 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00404}00404       \textcolor{comment}{// Matrix vector product: v=A*p\_hat}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00405}00405       matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a78204eab557e0dc99618e41a28a5c092}{multiply}}(p\_hat, v);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00406}00406       dot\_prod = r\_hat.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(v);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00407}00407       alpha = rho / dot\_prod;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00408}00408       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00409}00409       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00410}00410         \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = residual[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ alpha * v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00411}00411       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00412}00412       s\_norm = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}.norm();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00413}00413 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00414}00414       \textcolor{comment}{// Normalised residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00415}00415       normalised\_residual\_norm = s\_norm / rhs\_norm;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00416}00416 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00417}00417       \textcolor{comment}{// if required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00418}00418       \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00419}00419       \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00420}00420       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00421}00421         \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00422}00422         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00423}00423           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << double(iter -\/ 0.5) << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00424}00424                      << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00425}00425         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00426}00426         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00427}00427         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00428}00428           Output\_file\_stream << double(iter -\/ 0.5) << \textcolor{stringliteral}{"{} "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00429}00429                              << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00430}00430         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00431}00431       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00432}00432 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00433}00433       \textcolor{comment}{// Converged?}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00434}00434       \textcolor{keywordflow}{if} (normalised\_residual\_norm < Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00435}00435       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00436}00436         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00437}00437         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00438}00438           solution[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = x[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + alpha * p\_hat[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00439}00439         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00440}00440 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00441}00441         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00442}00442         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00443}00443           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00444}00444           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}BiCGStab converged. Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00445}00445                      << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00446}00446           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations to convergence: "{}} << iter}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00447}00447                      << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00448}00448           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00449}00449         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00450}00450 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00451}00451         \textcolor{comment}{// Store number of iterations taken}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00452}00452         Iterations = iter;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00453}00453 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00454}00454         \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00455}00455         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00456}00456         Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00457}00457 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00458}00458         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00459}00459         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00460}00460           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with BiCGStab  [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00461}00461                      << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00462}00462         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00463}00463 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00464}00464         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00465}00465       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00466}00466 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00467}00467       \textcolor{comment}{// Apply precondtitioner: z=P\string^-\/1*s}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00468}00468       preconditioner\_pt()-\/>preconditioner\_solve(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, z);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00469}00469 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00470}00470       \textcolor{comment}{// Matrix vector product: t=A*z}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00471}00471       matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a78204eab557e0dc99618e41a28a5c092}{multiply}}(z, \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00472}00472       dot\_prod\_ts = \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}.dot(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00473}00473       dot\_prod\_tt = \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}.dot(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00474}00474       omega = dot\_prod\_ts / dot\_prod\_tt;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00475}00475       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00476}00476       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00477}00477         x[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += alpha * p\_hat[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + omega * z[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00478}00478         residual[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ omega * \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00479}00479       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00480}00480       r\_norm = residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00481}00481       rho\_prev = rho;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00482}00482 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00483}00483       \textcolor{comment}{// Check convergence again}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00484}00484       normalised\_residual\_norm = r\_norm / rhs\_norm;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00485}00485 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00486}00486       \textcolor{comment}{// if required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00487}00487       \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00488}00488       \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00489}00489       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00490}00490         \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00491}00491         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00492}00492           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << iter << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00493}00493         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00494}00494         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00495}00495         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00496}00496           Output\_file\_stream << iter << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00497}00497                              << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00498}00498         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00499}00499       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00500}00500 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00501}00501 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00502}00502       \textcolor{keywordflow}{if} (normalised\_residual\_norm < Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00503}00503       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00504}00504         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00505}00505         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00506}00506           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00507}00507           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}BiCGStab converged. Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00508}00508                      << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00509}00509           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations to convergence: "{}} << iter}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00510}00510                      << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00511}00511           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00512}00512         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00513}00513         solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00514}00514 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00515}00515         \textcolor{comment}{// Store the number of itertions taken.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00516}00516         Iterations = iter;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00517}00517 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00518}00518         \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00519}00519         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00520}00520         Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00521}00521 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00522}00522         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00523}00523         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00524}00524           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with BiCGStab  [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00525}00525                      << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00526}00526         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00527}00527         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00528}00528       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00529}00529 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00530}00530 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00531}00531       \textcolor{comment}{// Breakdown: Omega has to be >0 for to be able to continue}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00532}00532       \textcolor{keywordflow}{if} (omega == 0.0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00533}00533       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00534}00534         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00535}00535         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}BiCGStab breakdown with omega=0.0. "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00536}00536                    << \textcolor{stringliteral}{"{}Normalised residual norm: "{}} << normalised\_residual\_norm}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00537}00537                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00538}00538         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations so far: "{}} << iter << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00539}00539         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00540}00540         solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00541}00541 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00542}00542         \textcolor{comment}{// Store the number of itertions taken.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00543}00543         Iterations = iter;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00544}00544 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00545}00545         \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00546}00546         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00547}00547         Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00548}00548 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00549}00549         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00550}00550         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00551}00551           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with BiCGStab  [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00552}00552                      << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00553}00553         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00554}00554         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00555}00555       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00556}00556 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00557}00557 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00558}00558     \} \textcolor{comment}{// end of iteration loop}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00559}00559 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00560}00560 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00561}00561     \textcolor{comment}{// No convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00562}00562     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00563}00563     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}BiCGStab did not converge to required tolerance! "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00564}00564                << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00565}00565     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Returning with normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00566}00566                << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00567}00567     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}after "{}} << \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} << \textcolor{stringliteral}{"{} iterations."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00568}00568     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00569}00569 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00570}00570     solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00571}00571 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00572}00572     \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00573}00573     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00574}00574     Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00575}00575 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00576}00576     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00577}00577     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00578}00578       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with BiCGStab  [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00579}00579                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00580}00580     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00581}00581 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00582}00582     \textcolor{keywordflow}{if} (Throw\_error\_after\_max\_iter)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00583}00583     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00584}00584       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Solver failed to converge and you requested an error"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00585}00585       err += \textcolor{stringliteral}{"{} on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00586}00586       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00587}00587         err, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00588}00588     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00589}00589   \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00590}00590 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00591}00591 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00592}00592 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00593}00593 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00594}00594 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00595}00595 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00596}00596 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00597}00597   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00598}00598 \textcolor{comment}{  /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and rhs vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00599}00599 \textcolor{comment}{  /// and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00600}00600 \textcolor{comment}{  /// Algorithm and variable names based on "{}Matrix Computations,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00601}00601 \textcolor{comment}{  /// 2nd Ed."{} Golub \& van Loan, John Hopkins University Press(1989),}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00602}00602 \textcolor{comment}{  /// page 529.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00603}00603 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00604}00604   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00605}\mbox{\hyperlink{classoomph_1_1CG_adbb17880d5464362b9e7a1cfa52dffec}{00605}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CG_adbb17880d5464362b9e7a1cfa52dffec}{CG<MATRIX>::solve\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00606}00606                                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00607}00607                                 \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00608}00608   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00609}00609 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00610}00610     \textcolor{comment}{// check that the rhs vector is setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00611}00611     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00612}00612     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00613}00613       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00614}00614       error\_message\_stream << \textcolor{stringliteral}{"{}The vectors rhs must be setup"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00615}00615       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00616}00616                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00617}00617                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00618}00618     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00619}00619 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00620}00620     \textcolor{comment}{// check that the matrix is square}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00621}00621     \textcolor{keywordflow}{if} (matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_acdcd6e1ea2bf2380f1a2fa32c7829cb5}{nrow}}() != matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a253feffbf1db1976cdd86c6134c50abe}{ncol}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00622}00622     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00623}00623       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00624}00624       error\_message\_stream << \textcolor{stringliteral}{"{}The matrix at matrix\_pt must be square."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00625}00625       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00626}00626                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00627}00627                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00628}00628     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00629}00629 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00630}00630     \textcolor{comment}{// check that the matrix and the rhs vector have the same nrow()}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00631}00631     \textcolor{keywordflow}{if} (matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_acdcd6e1ea2bf2380f1a2fa32c7829cb5}{nrow}}() != rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00632}00632     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00633}00633       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00634}00634       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00635}00635         << \textcolor{stringliteral}{"{}The matrix and the rhs vector must have the same number of rows."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00636}00636       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00637}00637                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00638}00638                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00639}00639     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00640}00640 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00641}00641     \textcolor{comment}{// if the matrix is distributable then it too should have the same}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00642}00642     \textcolor{comment}{// communicator as the rhs vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00643}00643     \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}* dist\_matrix\_pt =}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00644}00644       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00645}00645     \textcolor{keywordflow}{if} (dist\_matrix\_pt != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00646}00646     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00647}00647       \textcolor{keywordflow}{if} (!(*dist\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00648}00648       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00649}00649         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00650}00650         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00651}00651           << \textcolor{stringliteral}{"{}The matrix matrix\_pt must have the same communicator as the "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00652}00652              \textcolor{stringliteral}{"{}vectors"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00653}00653           << \textcolor{stringliteral}{"{} rhs and result must have the same communicator"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00654}00654         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00655}00655                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00656}00656                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00657}00657       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00658}00658     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00659}00659     \textcolor{comment}{// if the matrix is not distributable then it the rhs vector should not be}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00660}00660     \textcolor{comment}{// distributed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00661}00661     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00662}00662     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00663}00663       \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00664}00664       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00665}00665         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00666}00666         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00667}00667           << \textcolor{stringliteral}{"{}The matrix (matrix\_pt) is not distributable and therefore the rhs"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00668}00668           << \textcolor{stringliteral}{"{} vector must not be distributed"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00669}00669         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00670}00670                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00671}00671                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00672}00672       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00673}00673     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00674}00674     \textcolor{comment}{// if the result vector is setup then check it has the same distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00675}00675     \textcolor{comment}{// as the rhs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00676}00676     \textcolor{keywordflow}{if} (solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00677}00677     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00678}00678       \textcolor{keywordflow}{if} (!(*solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00679}00679       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00680}00680         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00681}00681         error\_message\_stream << \textcolor{stringliteral}{"{}The solution vector distribution has been "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00682}00682                                 \textcolor{stringliteral}{"{}setup; it must have the "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00683}00683                              << \textcolor{stringliteral}{"{}same distribution as the rhs vector."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00684}00684         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00685}00685                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00686}00686                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00687}00687       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00688}00688     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00689}00689 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00690}00690 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00691}00691     \textcolor{comment}{// setup the solution if it is not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00692}00692     \textcolor{keywordflow}{if} (!solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a92bfff97fd228b9c528922c39ab563b2}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00693}00693     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00694}00694       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00695}00695     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00696}00696     \textcolor{comment}{// zero}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00697}00697     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00698}00698     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00699}00699       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00700}00700     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00701}00701 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00702}00702     \textcolor{comment}{// Get number of dofs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00703}00703     \textcolor{comment}{// unsigned n\_dof=rhs.size();}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00704}00704     \textcolor{keywordtype}{unsigned} nrow\_local = this-\/>nrow\_local();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00705}00705 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00706}00706     \textcolor{comment}{// Initialise counter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00707}00707     \textcolor{keywordtype}{unsigned} counter = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00708}00708 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00709}00709     \textcolor{comment}{// Time solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00710}00710     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00711}00711 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00712}00712     \textcolor{comment}{// Initialise: Zero initial guess so the initial residual is}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00713}00713     \textcolor{comment}{// equal to the RHS}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00714}00714     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00715}00715     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} residual(rhs);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00716}00716     \textcolor{keywordtype}{double} residual\_norm = residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00717}00717     \textcolor{keywordtype}{double} rhs\_norm = residual\_norm;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00718}00718     \textcolor{keywordflow}{if} (rhs\_norm == 0.0) rhs\_norm = 1.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00719}00719 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00720}00720     \textcolor{comment}{// Normalised residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00721}00721     \textcolor{keywordtype}{double} normalised\_residual\_norm = residual\_norm / rhs\_norm;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00722}00722 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00723}00723     \textcolor{comment}{// if required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00724}00724     \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00725}00725     \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00726}00726     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00727}00727       \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00728}00728       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00729}00729         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << 0 << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00730}00730       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00731}00731       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00732}00732       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00733}00733         Output\_file\_stream << 0 << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00734}00734       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00735}00735     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00736}00736 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00737}00737     \textcolor{comment}{// Check immediate convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00738}00738     \textcolor{keywordflow}{if} (normalised\_residual\_norm < Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00739}00739     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00740}00740       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00741}00741       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00742}00742         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CG converged immediately"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00743}00743       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00744}00744       solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00745}00745 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00746}00746       \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00747}00747       \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00748}00748       Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00749}00749 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00750}00750       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00751}00751       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00752}00752         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with CG  [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00753}00753                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00754}00754       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00755}00755       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00756}00756     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00757}00757 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00758}00758 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00759}00759     \textcolor{comment}{// Setup preconditioner only if we're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00760}00760     \textcolor{keywordflow}{if} (!Resolving)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00761}00761     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00762}00762       \textcolor{comment}{// only setup the preconditioner if required}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00763}00763       \textcolor{keywordflow}{if} (Setup\_preconditioner\_before\_solve)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00764}00764       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00765}00765         \textcolor{comment}{// Setup preconditioner from the Jacobian matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00766}00766         \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00767}00767 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00768}00768         preconditioner\_pt()-\/>setup(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00769}00769 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00770}00770         \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00771}00771         \textcolor{keywordtype}{double} t\_end\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00772}00772         Preconditioner\_setup\_time = t\_end\_prec -\/ t\_start\_prec;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00773}00773 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00774}00774         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00775}00775         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00776}00776           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of preconditioner  [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00777}00777                      << Preconditioner\_setup\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00778}00778         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00779}00779       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00780}00780     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00781}00781     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00782}00782     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00783}00783       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00784}00784       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00785}00785         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Setup of preconditioner is bypassed in resolve mode"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00786}00786                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00787}00787       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00788}00788     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00789}00789 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00790}00790 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00791}00791     \textcolor{comment}{// Auxiliary vectors}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00792}00792     \textcolor{comment}{// Vector<double> z(n\_dof),p(n\_dof),jacobian\_times\_p(n\_dof,0.0);}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00793}00793     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} z(this-\/>distribution\_pt(), 0.0),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00794}00794       p(this-\/>distribution\_pt(), 0.0),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00795}00795       jacobian\_times\_p(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00796}00796 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00797}00797     \textcolor{comment}{// Auxiliary values}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00798}00798     \textcolor{keywordtype}{double} alpha, beta, rz;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00799}00799     \textcolor{keywordtype}{double} prev\_rz = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00800}00800 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00801}00801     \textcolor{comment}{// Main iteration}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00802}00802     \textcolor{keywordflow}{while} ((normalised\_residual\_norm > Tolerance) \&\& (counter != \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00803}00803     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00804}00804       \textcolor{comment}{// Apply precondtitioner: z=P\string^-\/1*r}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00805}00805       preconditioner\_pt()-\/>preconditioner\_solve(residual, z);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00806}00806 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00807}00807       \textcolor{comment}{// P vector is computed differently for first and subsequent steps}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00808}00808       \textcolor{keywordflow}{if} (counter == 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00809}00809       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00810}00810         p = z;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00811}00811         rz = residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(z);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00812}00812       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00813}00813       \textcolor{comment}{// Subsequent steps}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00814}00814       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00815}00815       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00816}00816         rz = residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(z);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00817}00817         beta = rz / prev\_rz;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00818}00818         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00819}00819         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00820}00820           p[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = z[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + beta * p[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00821}00821         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00822}00822       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00823}00823 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00824}00824 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00825}00825       \textcolor{comment}{// Matrix vector product}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00826}00826       matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a78204eab557e0dc99618e41a28a5c092}{multiply}}(p, jacobian\_times\_p);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00827}00827       \textcolor{keywordtype}{double} pq = p.dot(jacobian\_times\_p);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00828}00828       alpha = rz / pq;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00829}00829 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00830}00830       \textcolor{comment}{// Update}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00831}00831       prev\_rz = rz;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00832}00832       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < nrow\_local; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00833}00833       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00834}00834         x[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += alpha * p[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00835}00835         residual[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/= alpha * jacobian\_times\_p[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00836}00836       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00837}00837 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00838}00838 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00839}00839       \textcolor{comment}{// Calculate the 2norm}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00840}00840       residual\_norm = residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00841}00841 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00842}00842       \textcolor{comment}{// Difference between the initial and current 2norm residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00843}00843       normalised\_residual\_norm = residual\_norm / rhs\_norm;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00844}00844 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00845}00845 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00846}00846       \textcolor{comment}{// if required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00847}00847       \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00848}00848       \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00849}00849       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00850}00850         \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00851}00851         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00852}00852           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << counter << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00853}00853         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00854}00854         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00855}00855         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00856}00856           Output\_file\_stream << counter << \textcolor{stringliteral}{"{} "{}} << normalised\_residual\_norm}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00857}00857                              << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00858}00858         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00859}00859       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00860}00860 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00861}00861       counter = counter + 1;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00862}00862 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00863}00863     \} \textcolor{comment}{// end while}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00864}00864 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00865}00865 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00866}00866     \textcolor{keywordflow}{if} (counter >= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00867}00867     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00868}00868       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00869}00869       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CG did not converge to required tolerance! "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00870}00870       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Returning with normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00871}00871                  << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00872}00872       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}after "{}} << counter << \textcolor{stringliteral}{"{} iterations."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00873}00873       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00874}00874     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00875}00875     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00876}00876     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00877}00877       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00878}00878       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00879}00879         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00880}00880         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}CG converged. Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00881}00881                    << normalised\_residual\_norm << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00882}00882         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations to convergence: "{}} << counter}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00883}00883                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00884}00884         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00885}00885       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00886}00886     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00887}00887 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00888}00888 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00889}00889     \textcolor{comment}{// Store number if iterations taken}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00890}00890     Iterations = counter;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00891}00891 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00892}00892     \textcolor{comment}{// Copy result back}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00893}00893     solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00894}00894 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00895}00895     \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00896}00896     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00897}00897     Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00898}00898 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00899}00899     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00900}00900     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00901}00901       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with CG  [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00902}00902                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00903}00903     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00904}00904 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00905}00905     \textcolor{keywordflow}{if} ((counter >= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}) \&\& (Throw\_error\_after\_max\_iter))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00906}00906     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00907}00907       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Solver failed to converge and you requested an error"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00908}00908       err += \textcolor{stringliteral}{"{} on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00909}00909       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00910}00910         err, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00911}00911     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00912}00912 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00913}00913   \} \textcolor{comment}{// end CG}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00914}00914 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00915}00915 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00916}00916   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00917}00917 \textcolor{comment}{  /// Re-\/solve the system defined by the last assembled Jacobian}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00918}00918 \textcolor{comment}{  /// and the rhs vector specified here. Solution is returned in}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00919}00919 \textcolor{comment}{  /// the vector result.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00920}00920 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00921}00921   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00922}\mbox{\hyperlink{classoomph_1_1CG_a147e640c19c2159285da0b3b5c51af63}{00922}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CG_a147e640c19c2159285da0b3b5c51af63}{CG<MATRIX>::resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00923}00923   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00924}00924     \textcolor{comment}{// We are re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00925}00925     Resolving = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00926}00926 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00927}00927 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00928}00928     \textcolor{keywordflow}{if} (Matrix\_pt == 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00929}00929     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00930}00930       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}No matrix was stored -\/-\/ cannot re-\/solve"{}},}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00931}00931                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00932}00932                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00933}00933     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00934}00934 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00935}00935 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00936}00936     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00937}00937     this-\/>solve(Matrix\_pt, rhs, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00938}00938 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00939}00939     \textcolor{comment}{// Reset re-\/solving flag}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00940}00940     Resolving = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00941}00941   \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00942}00942 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00943}00943 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00944}00944   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00945}00945 \textcolor{comment}{  /// Solver: Takes pointer to problem and returns the results vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00946}00946 \textcolor{comment}{  /// which contains the solution of the linear system defined by}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00947}00947 \textcolor{comment}{  /// the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00948}00948 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00949}00949   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00950}\mbox{\hyperlink{classoomph_1_1CG_a3ae0fb5451136aec30defea2758c8c5d}{00950}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1CG_a3ae0fb5451136aec30defea2758c8c5d}{CG<MATRIX>::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00951}00951   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00952}00952     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00953}00953     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00954}00954 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00955}00955     \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00956}00956     Resolving = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00957}00957 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00958}00958     \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00959}00959     \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00960}00960 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00961}00961     \textcolor{comment}{// Get Jacobian matrix in format specified by template parameter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00962}00962     \textcolor{comment}{// and nonlinear residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00963}00963     Matrix\_pt = \textcolor{keyword}{new} MATRIX;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00964}00964     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00965}00965     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *Matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00966}00966 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00967}00967     \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00968}00968     Matrix\_can\_be\_deleted = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00969}00969 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00970}00970     \textcolor{comment}{// Doc time for setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00971}00971     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00972}00972     Jacobian\_setup\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00973}00973 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00974}00974     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00975}00975     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00976}00976       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of Jacobian [sec]: "{}} << Jacobian\_setup\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00977}00977                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00978}00978     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00979}00979 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00980}00980     \textcolor{comment}{// set the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00981}00981     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(Matrix\_pt))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00982}00982     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00983}00983       \textcolor{comment}{// the solver has the same distribution as the matrix if possible}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00984}00984       this-\/>build\_distribution(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00985}00985         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(Matrix\_pt)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00986}00986           -\/>distribution\_pt());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00987}00987     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00988}00988     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00989}00989     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00990}00990       \textcolor{comment}{// the solver has the same distribution as the RHS}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00991}00991       this-\/>build\_distribution(f.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00992}00992     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00993}00993 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00994}00994     \textcolor{comment}{// if the result vector is not setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00995}00995     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a92bfff97fd228b9c528922c39ab563b2}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00996}00996     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00997}00997       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00998}00998     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l00999}00999 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01000}01000     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01001}01001     \textcolor{keywordflow}{if} (!(*result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *this-\/>distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01002}01002     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01003}01003       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} temp\_global\_dist(result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01004}01004       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01005}01005       this-\/>solve\_helper(Matrix\_pt, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01006}01006       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&temp\_global\_dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01007}01007     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01008}01008     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01009}01009     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01010}01010       this-\/>solve\_helper(Matrix\_pt, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01011}01011     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01012}01012 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01013}01013     \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01014}01014     \textcolor{keywordflow}{if} (!Enable\_resolve) \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01015}01015   \};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01016}01016 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01017}01017 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01018}01018 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01019}01019 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01020}01020 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01021}01021 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01022}01022 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01023}01023   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01024}01024 \textcolor{comment}{  /// Self-\/test to be called inside solve\_helper to ensure}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01025}01025 \textcolor{comment}{  /// that all inputs are consistent and everything that needs to}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01026}01026 \textcolor{comment}{  /// be built, is.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01027}01027 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01028}01028   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01029}\mbox{\hyperlink{classoomph_1_1Smoother_a26a3dba61218b77cf65775475dc8751d}{01029}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1Smoother_a26a3dba61218b77cf65775475dc8751d}{Smoother::check\_validity\_of\_solve\_helper\_inputs}}(MATRIX* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01030}01030                                                        \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01031}01031                                                        \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01032}01032                                                        \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& n\_dof)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01033}01033   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01034}01034     \textcolor{comment}{// Check that if the matrix is not distributable then it should not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01035}01035     \textcolor{comment}{// be distributed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01036}01036     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(matrix\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01037}01037     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01038}01038       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(matrix\_pt)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01039}01039             -\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01040}01040       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01041}01041         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01042}01042         error\_message\_stream << \textcolor{stringliteral}{"{}The matrix must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01043}01043         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01044}01044                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01045}01045                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01046}01046       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01047}01047     \} \textcolor{comment}{// if (dynamic\_cast<DistributableLinearAlgebraObject*>(matrix\_pt)!=0)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01048}01048     \textcolor{comment}{// Check that this rhs distribution is setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01049}01049     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01050}01050     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01051}01051       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01052}01052       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector distribution must be setup."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01053}01053       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01054}01054                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01055}01055                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01056}01056     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01057}01057     \textcolor{comment}{// Check that the rhs has the right number of global rows}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01058}01058     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01059}01059     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01060}01060       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01061}01061       error\_message\_stream << \textcolor{stringliteral}{"{}RHS does not have the same dimension as "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01062}01062                            << \textcolor{stringliteral}{"{}the linear system"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01063}01063       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01064}01064                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01065}01065                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01066}01066     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01067}01067     \textcolor{comment}{// Check that the rhs is not distributed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01068}01068     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01069}01069     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01070}01070       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01071}01071       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01072}01072       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01073}01073                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01074}01074                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01075}01075     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01076}01076     \textcolor{comment}{// Check that if the result is setup it matches the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01077}01077     \textcolor{comment}{// of the rhs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01078}01078     \textcolor{keywordflow}{if} (solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01079}01079     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01080}01080       \textcolor{keywordflow}{if} (!(*rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01081}01081       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01082}01082         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01083}01083         error\_message\_stream << \textcolor{stringliteral}{"{}If the result distribution is setup then it "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01084}01084                              << \textcolor{stringliteral}{"{}must be the same as the rhs distribution"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01085}01085         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01086}01086                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01087}01087                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01088}01088       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01089}01089     \} \textcolor{comment}{// if (solution.built())}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01090}01090   \} \textcolor{comment}{// End of check\_validity\_of\_solve\_helper\_inputs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01091}01091 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01092}01092 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01093}01093 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01094}01094 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01095}01095 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01096}01096 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01097}01097 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01098}01098   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01099}01099 \textcolor{comment}{  /// Solver: Takes pointer to problem and returns the results}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01100}01100 \textcolor{comment}{  /// vector which contains the solution of the linear system defined}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01101}01101 \textcolor{comment}{  /// by the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01102}01102 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01103}01103   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01104}\mbox{\hyperlink{classoomph_1_1GS_ad7d1bfb3d25a194d2875e266e104dc9f}{01104}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1GS_ad7d1bfb3d25a194d2875e266e104dc9f}{GS<MATRIX>::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01105}01105   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01106}01106     \textcolor{comment}{// Reset the Use\_as\_smoother\_flag as the solver is not being used}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01107}01107     \textcolor{comment}{// as a smoother}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01108}01108     Use\_as\_smoother = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01109}01109 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01110}01110     \textcolor{comment}{// Find the \# of degrees of freedom (variables)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01111}01111     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01112}01112 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01113}01113     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01114}01114     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01115}01115 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01116}01116     \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01117}01117     Resolving = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01118}01118 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01119}01119     \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01120}01120     \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01121}01121 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01122}01122     \textcolor{comment}{// Set up the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01123}01123     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01124}01124 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01125}01125     \textcolor{comment}{// Assign the distribution to the LinearSolver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01126}01126     this-\/>build\_distribution(dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01127}01127 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01128}01128     \textcolor{comment}{// Allocate space for the Jacobian matrix in format specified}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01129}01129     \textcolor{comment}{// by template parameter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01130}01130     Matrix\_pt = \textcolor{keyword}{new} MATRIX;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01131}01131 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01132}01132     \textcolor{comment}{// Get the nonlinear residuals vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01133}01133     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01134}01134 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01135}01135     \textcolor{comment}{// Assign the Jacobian and the residuals vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01136}01136     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *Matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01137}01137 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01138}01138     \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01139}01139     Matrix\_can\_be\_deleted = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01140}01140 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01141}01141     \textcolor{comment}{// Doc time for setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01142}01142     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01143}01143     Jacobian\_setup\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01144}01144 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01145}01145     \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01146}01146     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01147}01147     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01148}01148       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of Jacobian [sec]: "{}} << Jacobian\_setup\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01149}01149                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01150}01150     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01151}01151 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01152}01152     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01153}01153     this-\/>solve\_helper(Matrix\_pt, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01154}01154 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01155}01155     \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01156}01156     \textcolor{keywordflow}{if} (!Enable\_resolve) \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01157}01157   \} \textcolor{comment}{// End of solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01158}01158 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01159}01159   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01160}01160 \textcolor{comment}{  /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01161}01161 \textcolor{comment}{  /// rhs vector and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01162}01162 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01163}01163   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01164}\mbox{\hyperlink{classoomph_1_1GS_a727ae9502ba5cd458358b5c50a57437e}{01164}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1GS_a727ae9502ba5cd458358b5c50a57437e}{GS<MATRIX>::solve\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01165}01165                                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01166}01166                                 \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01167}01167   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01168}01168     \textcolor{comment}{// Get number of dofs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01169}01169     \textcolor{keywordtype}{unsigned} n\_dof = rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01170}01170 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01171}01171 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01172}01172     \textcolor{comment}{// Upcast the matrix to the appropriate type}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01173}01173     MATRIX* tmp\_matrix\_pt = \textcolor{keyword}{dynamic\_cast<}MATRIX*\textcolor{keyword}{>}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01174}01174 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01175}01175     \textcolor{comment}{// PARANOID Run the self-\/tests to check the inputs are correct}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01176}01176     this-\/>check\_validity\_of\_solve\_helper\_inputs<MATRIX>(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01177}01177       tmp\_matrix\_pt, rhs, solution, n\_dof);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01178}01178 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01179}01179     \textcolor{comment}{// We don't need the pointer any more but we do still need the matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01180}01180     \textcolor{comment}{// so just make tmp\_matrix\_pt a null pointer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01181}01181     tmp\_matrix\_pt = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01182}01182 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01183}01183 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01184}01184     \textcolor{comment}{// Set up the solution if it is not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01185}01185     \textcolor{keywordflow}{if} (!solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a92bfff97fd228b9c528922c39ab563b2}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01186}01186     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01187}01187       \textcolor{comment}{// Build it!}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01188}01188       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01189}01189     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01190}01190     \textcolor{comment}{// If the solution is already set up}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01191}01191     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01192}01192     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01193}01193       \textcolor{comment}{// If we're inside the multigrid solver then as we traverse up the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01194}01194       \textcolor{comment}{// hierarchy we use the smoother on the updated approximate solution.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01195}01195       \textcolor{comment}{// As such, we should ONLY be resetting all the values to zero if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01196}01196       \textcolor{comment}{// we're NOT inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01197}01197       \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01198}01198       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01199}01199         \textcolor{comment}{// Initialise the vector with all entries set to zero}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01200}01200         solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01201}01201       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01202}01202     \} \textcolor{comment}{// if (!solution.distribution\_pt()-\/>built())}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01203}01203 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01204}01204     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01205}01205     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01206}01206 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01207}01207     \textcolor{comment}{// Copy the solution vector into x}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01208}01208     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x(solution);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01209}01209 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01210}01210     \textcolor{comment}{// Create a vector to hold the residual. This will only be built if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01211}01211     \textcolor{comment}{// we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01212}01212     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} current\_residual;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01213}01213 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01214}01214     \textcolor{comment}{// Variable to hold the current residual norm. Only used if we're}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01215}01215     \textcolor{comment}{// not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01216}01216     \textcolor{keywordtype}{double} norm\_res = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01217}01217 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01218}01218     \textcolor{comment}{// Variables to hold the initial residual norm. Only used if we're}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01219}01219     \textcolor{comment}{// not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01220}01220     \textcolor{keywordtype}{double} norm\_f = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01221}01221 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01222}01222     \textcolor{comment}{// Initialise the value of Iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01223}01223     Iterations = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01224}01224 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01225}01225     \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01226}01226     \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01227}01227     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01228}01228       \textcolor{comment}{// Build the residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01229}01229       current\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01230}01230 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01231}01231       \textcolor{comment}{// Calculate the residual r=b-\/Ax}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01232}01232       matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a971bdc2d9297fc582af8467178f4e00e}{residual}}(x, rhs, current\_residual);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01233}01233 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01234}01234       \textcolor{comment}{// Calculate the 2-\/norm of the residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01235}01235       norm\_res = current\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01236}01236 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01237}01237       \textcolor{comment}{// Store the initial norm}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01238}01238       norm\_f = norm\_res;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01239}01239 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01240}01240       \textcolor{comment}{// If required, document the convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01241}01241       \textcolor{comment}{// the output stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01242}01242       \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01243}01243       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01244}01244         \textcolor{comment}{// If the output file stream isn't open}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01245}01245         \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01246}01246         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01247}01247           \textcolor{comment}{// Output the result to screen}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01248}01248           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01249}01249         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01250}01250         \textcolor{comment}{// If the output file stream is open}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01251}01251         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01252}01252         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01253}01253           \textcolor{comment}{// Document the result to file}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01254}01254           Output\_file\_stream << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01255}01255         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01256}01256       \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01257}01257     \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01258}01258 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01259}01259     \textcolor{comment}{// Start of the main GS loop: run up to Max\_iter times}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01260}01260     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iter\_num = 0; iter\_num < \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}; iter\_num++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01261}01261     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01262}01262       \textcolor{comment}{// Loop over rows}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01263}01263       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01264}01264       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01265}01265         \textcolor{keywordtype}{double} dummy = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01266}01266         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}; j++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01267}01267         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01268}01268           dummy -\/= (*(matrix\_pt))(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * x[j];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01269}01269         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01270}01270         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1); j < n\_dof; j++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01271}01271         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01272}01272           dummy -\/= (*(matrix\_pt))(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * x[j];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01273}01273         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01274}01274         x[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = dummy / (*(matrix\_pt))(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01275}01275       \} \textcolor{comment}{// for(unsigned i=0;i<n\_dof;i++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01276}01276 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01277}01277       \textcolor{comment}{// Increment the value of Iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01278}01278       Iterations++;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01279}01279 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01280}01280       \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01281}01281       \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01282}01282       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01283}01283         \textcolor{comment}{// Get residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01284}01284         matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a971bdc2d9297fc582af8467178f4e00e}{residual}}(x, rhs, current\_residual);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01285}01285 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01286}01286         \textcolor{comment}{// Calculate the relative residual norm (i.e.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01287}01287         \textcolor{comment}{// \(\backslash\)frac\{\(\backslash\)|r\_\{i\}\(\backslash\)|\}\{\(\backslash\)|r\_\{0\}\(\backslash\)|\})}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01288}01288         norm\_res = current\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}() / norm\_f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01289}01289 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01290}01290         \textcolor{comment}{// If required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01291}01291         \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01292}01292         \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01293}01293         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01294}01294           \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01295}01295           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01296}01296             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01297}01297           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01298}01298           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01299}01299           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01300}01300             Output\_file\_stream << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01301}01301           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01302}01302         \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01303}01303 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01304}01304         \textcolor{comment}{// Check the tolerance only if the residual norm is being computed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01305}01305         \textcolor{keywordflow}{if} (norm\_res < Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01306}01306         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01307}01307           \textcolor{comment}{// Break out of the for-\/loop}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01308}01308           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01309}01309         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01310}01310       \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01311}01311     \} \textcolor{comment}{// for (unsigned iter\_num=0;iter\_num<Max\_iter;iter\_num++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01312}01312 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01313}01313     \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01314}01314     \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01315}01315     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01316}01316       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01317}01317       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01318}01318       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01319}01319         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nGS converged. Residual norm: "{}} << norm\_res}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01320}01320                    << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of iterations to convergence: "{}} << Iterations}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01321}01321                    << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01322}01322                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01323}01323       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01324}01324     \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01325}01325 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01326}01326     \textcolor{comment}{// Copy result into result}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01327}01327     solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01328}01328 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01329}01329     \textcolor{comment}{// Doc. time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01330}01330     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01331}01331     Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01332}01332     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01333}01333     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01334}01334       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with GS [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01335}01335                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01336}01336     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01337}01337 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01338}01338     \textcolor{comment}{// If the solver failed to converge and the user asked for an error if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01339}01339     \textcolor{comment}{// this happened}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01340}01340     \textcolor{keywordflow}{if} ((Iterations > \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} -\/ 1) \&\& (Throw\_error\_after\_max\_iter))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01341}01341     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01342}01342       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message =}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01343}01343         \textcolor{stringliteral}{"{}Solver failed to converge and you requested "{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01344}01344       error\_message += \textcolor{stringliteral}{"{}an error on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01345}01345       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01346}01346         error\_message, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01347}01347     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01348}01348   \} \textcolor{comment}{// End of solve\_helper}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01349}01349 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01350}01350 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01351}01351 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01352}01352 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01353}01353 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01354}01354 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01355}01355 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01356}01356   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01357}01357 \textcolor{comment}{  /// Explicit template specialisation of the solver for CR}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01358}01358 \textcolor{comment}{  /// matrices: Takes pointer to problem and returns the results}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01359}01359 \textcolor{comment}{  /// vector which contains the solution of the linear system defined}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01360}01360 \textcolor{comment}{  /// by the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01361}01361 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01362}\mbox{\hyperlink{classoomph_1_1GS_3_01CRDoubleMatrix_01_4_a85164d55db2ab10404d5679657e8f6de}{01362}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1GS_ad7d1bfb3d25a194d2875e266e104dc9f}{GS<CRDoubleMatrix>::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01363}01363                                  \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01364}01364   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01365}01365     \textcolor{comment}{// Reset the Use\_as\_smoother\_flag as the solver is not being used}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01366}01366     \textcolor{comment}{// as a smoother}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01367}01367     \mbox{\hyperlink{classoomph_1_1Smoother_aa789c91e11408d9ffd94c237e4a729b7}{Use\_as\_smoother}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01368}01368 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01369}01369     \textcolor{comment}{// Find \# of degrees of freedom (variables)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01370}01370     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01371}01371 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01372}01372     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01373}01373     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01374}01374 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01375}01375     \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01376}01376     \mbox{\hyperlink{classoomph_1_1GS_a8010d1c317927e493c22010623a10c04}{Resolving}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01377}01377 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01378}01378     \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01379}01379     \mbox{\hyperlink{classoomph_1_1GS_a7dcf28fef43088ead0e662a32275b383}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01380}01380 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01381}01381     \textcolor{comment}{// Set up the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01382}01382     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01383}01383 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01384}01384     \textcolor{comment}{// Build the distribution of the LinearSolver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01385}01385     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01386}01386 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01387}01387     \textcolor{comment}{// Allocate space for the Jacobian matrix in CRDoubleMatrix format}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01388}01388     \mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01389}01389 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01390}01390     \textcolor{comment}{// Build the matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01391}01391     \mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}}-\/>build(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01392}01392 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01393}01393     \textcolor{comment}{// Allocate space for the residuals vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01394}01394     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01395}01395 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01396}01396     \textcolor{comment}{// Build it}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01397}01397     f.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01398}01398 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01399}01399     \textcolor{comment}{// Get the global Jacobian and the accompanying residuals vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01400}01400     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *\mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01401}01401 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01402}01402     \textcolor{comment}{// Doc. time for setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01403}01403     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01404}01404     \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a82a12e45c78e910b46e9d0935beb8f0d}{Jacobian\_setup\_time}} = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01405}01405 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01406}01406     \textcolor{comment}{// Run the generic setup function}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01407}01407     setup\_helper(\mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01408}01408 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01409}01409     \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01410}01410     \mbox{\hyperlink{classoomph_1_1GS_a718861f4e791d4db2838dfb08dd846a2}{Matrix\_can\_be\_deleted}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01411}01411 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01412}01412     \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01413}01413     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01414}01414     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01415}01415       \textcolor{comment}{// Output the time for the assembly of the Jacobian to screen}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01416}01416       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of Jacobian [sec]: "{}} << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a82a12e45c78e910b46e9d0935beb8f0d}{Jacobian\_setup\_time}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01417}01417                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01418}01418     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01419}01419 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01420}01420     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01421}01421     \mbox{\hyperlink{classoomph_1_1GS_a727ae9502ba5cd458358b5c50a57437e}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}}, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01422}01422 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01423}01423     \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01424}01424     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}}) \mbox{\hyperlink{classoomph_1_1GS_a7dcf28fef43088ead0e662a32275b383}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01425}01425   \} \textcolor{comment}{// End of solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01426}01426 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01427}01427   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01428}01428 \textcolor{comment}{  /// Explicit template specialisation of the smoother\_setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01429}01429 \textcolor{comment}{  /// function for CR matrices. Set up the smoother for the matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01430}01430 \textcolor{comment}{  /// specified by the pointer. This definition of the smoother\_setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01431}01431 \textcolor{comment}{  /// has the added functionality that it sorts the entries in the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01432}01432 \textcolor{comment}{  /// given matrix so that the CRDoubleMatrix implementation of the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01433}01433 \textcolor{comment}{  /// solver can be used.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01434}01434 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01435}\mbox{\hyperlink{classoomph_1_1GS_3_01CRDoubleMatrix_01_4_af18cc36ee80ca8a7323a89f2f1041a9c}{01435}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1GS}{GS<CRDoubleMatrix>::setup\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* matrix\_pt)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01436}01436   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01437}01437     \textcolor{comment}{// Assume the matrix has been passed in from the outside so we must}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01438}01438     \textcolor{comment}{// not delete it. This is needed to avoid pre-\/ and post-\/smoothers}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01439}01439     \textcolor{comment}{// deleting the same matrix in the MG solver. If this was originally}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01440}01440     \textcolor{comment}{// set to TRUE then this will be sorted out in the other functions}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01441}01441     \textcolor{comment}{// from which this was called}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01442}01442     \mbox{\hyperlink{classoomph_1_1GS_a718861f4e791d4db2838dfb08dd846a2}{Matrix\_can\_be\_deleted}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01443}01443 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01444}01444     \textcolor{comment}{// Upcast the input matrix to system matrix to the type MATRIX}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01445}01445     \mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}} = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01446}01446 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01447}01447     \textcolor{comment}{// The system matrix here is a CRDoubleMatrix. To make use of the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01448}01448     \textcolor{comment}{// specific implementation of the solver for this type of matrix we}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01449}01449     \textcolor{comment}{// need to make sure the entries are arranged correctly}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01450}01450     \mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}}-\/>sort\_entries();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01451}01451 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01452}01452     \textcolor{comment}{// Now get access to the vector Index\_of\_diagonal\_entries}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01453}01453     Index\_of\_diagonal\_entries = \mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}}-\/>get\_index\_of\_diagonal\_entries();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01454}01454 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01455}01455 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01456}01456     \textcolor{comment}{// Create a boolean variable to store the result of whether or not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01457}01457     \textcolor{comment}{// the entries are in the correct order}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01458}01458     \textcolor{keywordtype}{bool} is\_matrix\_sorted = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01459}01459 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01460}01460     \textcolor{comment}{// Check to make sure the entries have been sorted properly}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01461}01461     is\_matrix\_sorted = \mbox{\hyperlink{classoomph_1_1GS_aac984c7e63198b6b6d8b32685f45c592}{Matrix\_pt}}-\/>entries\_are\_sorted();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01462}01462 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01463}01463     \textcolor{comment}{// If the entries are not sorted properly}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01464}01464     \textcolor{keywordflow}{if} (!is\_matrix\_sorted)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01465}01465     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01466}01466       \textcolor{comment}{// Throw an error; the solver won't work unless the matrix is sorted}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01467}01467       \textcolor{comment}{// properly}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01468}01468       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Matrix is not sorted correctly"{}},}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01469}01469                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01470}01470                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01471}01471     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01472}01472 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01473}01473   \} \textcolor{comment}{// End of setup\_helper}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01474}01474 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01475}01475   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01476}01476 \textcolor{comment}{  /// Explicit template specialisation of the solve\_helper}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01477}01477 \textcolor{comment}{  /// function for CR matrices. Exploiting the sparsity of the given}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01478}01478 \textcolor{comment}{  /// matrix allows for a much faster iterative solver.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01479}01479 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01480}\mbox{\hyperlink{classoomph_1_1GS_3_01CRDoubleMatrix_01_4_a12a720316ec6fde47e0fa524bd8728b1}{01480}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1GS_a727ae9502ba5cd458358b5c50a57437e}{GS<CRDoubleMatrix>::solve\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01481}01481                                         \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01482}01482                                         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01483}01483   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01484}01484     \textcolor{comment}{// Get number of dofs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01485}01485     \textcolor{keywordtype}{unsigned} n\_dof = rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01486}01486 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01487}01487 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01488}01488     \textcolor{comment}{// Upcast the matrix to the appropriate type}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01489}01489     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* cr\_matrix\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01490}01490 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01491}01491     \textcolor{comment}{// PARANOID Run the self-\/tests to check the inputs are correct}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01492}01492     this-\/>check\_validity\_of\_solve\_helper\_inputs<CRDoubleMatrix>(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01493}01493       cr\_matrix\_pt, rhs, solution, n\_dof);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01494}01494 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01495}01495     \textcolor{comment}{// We don't need the pointer any more but we do still need the matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01496}01496     \textcolor{comment}{// so just make tmp\_matrix\_pt a null pointer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01497}01497     cr\_matrix\_pt = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01498}01498 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01499}01499 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01500}01500     \textcolor{comment}{// Setup the solution if it is not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01501}01501     \textcolor{keywordflow}{if} (!solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a92bfff97fd228b9c528922c39ab563b2}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01502}01502     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01503}01503       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01504}01504     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01505}01505     \textcolor{comment}{// If the solution is already set up}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01506}01506     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01507}01507     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01508}01508       \textcolor{comment}{// If we're inside the multigrid solver then as we traverse up the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01509}01509       \textcolor{comment}{// hierarchy we use the smoother on the updated approximate solution.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01510}01510       \textcolor{comment}{// As such, we should ONLY be resetting all the values to zero if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01511}01511       \textcolor{comment}{// we're NOT inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01512}01512       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Smoother_aa789c91e11408d9ffd94c237e4a729b7}{Use\_as\_smoother}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01513}01513       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01514}01514         \textcolor{comment}{// Initialise the vector with all entries set to zero}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01515}01515         solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01516}01516       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01517}01517     \} \textcolor{comment}{// if (!solution.distribution\_pt()-\/>built())}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01518}01518 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01519}01519     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01520}01520     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01521}01521 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01522}01522     \textcolor{comment}{// Copy the solution vector into x}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01523}01523     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x(solution);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01524}01524 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01525}01525     \textcolor{comment}{// Create a vector to hold the residual. This will only be built if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01526}01526     \textcolor{comment}{// we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01527}01527     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} current\_residual;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01528}01528 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01529}01529     \textcolor{comment}{// Variable to hold the current residual norm. Only used if we're}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01530}01530     \textcolor{comment}{// not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01531}01531     \textcolor{keywordtype}{double} norm\_res = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01532}01532 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01533}01533     \textcolor{comment}{// Variables to hold the initial residual norm. Only used if we're}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01534}01534     \textcolor{comment}{// not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01535}01535     \textcolor{keywordtype}{double} norm\_f = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01536}01536 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01537}01537     \textcolor{comment}{// Initialise the value of Iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01538}01538     \mbox{\hyperlink{classoomph_1_1GS_a3cef5f6067f391b7db9659d065a27cb5}{Iterations}} = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01539}01539 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01540}01540     \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01541}01541     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Smoother_aa789c91e11408d9ffd94c237e4a729b7}{Use\_as\_smoother}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01542}01542     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01543}01543       \textcolor{comment}{// Build the residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01544}01544       current\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01545}01545 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01546}01546       \textcolor{comment}{// Calculate the residual r=b-\/Ax}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01547}01547       matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a971bdc2d9297fc582af8467178f4e00e}{residual}}(x, rhs, current\_residual);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01548}01548 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01549}01549       \textcolor{comment}{// Calculate the 2-\/norm of the residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01550}01550       norm\_res = current\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01551}01551 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01552}01552       \textcolor{comment}{// Store the initial norm}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01553}01553       norm\_f = norm\_res;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01554}01554 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01555}01555       \textcolor{comment}{// If required will document convergence history to screen}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01556}01556       \textcolor{comment}{// or file (if stream is open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01557}01557       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_aeb0fbe103e721196232260230abb1997}{Doc\_convergence\_history}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01558}01558       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01559}01559         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4d6766bec67399c29392e6540b91dd9}{Output\_file\_stream}}.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01560}01560         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01561}01561           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \mbox{\hyperlink{classoomph_1_1GS_a3cef5f6067f391b7db9659d065a27cb5}{Iterations}} << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01562}01562         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01563}01563         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01564}01564         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01565}01565           \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4d6766bec67399c29392e6540b91dd9}{Output\_file\_stream}} << \mbox{\hyperlink{classoomph_1_1GS_a3cef5f6067f391b7db9659d065a27cb5}{Iterations}} << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01566}01566         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01567}01567       \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01568}01568     \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01569}01569 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01570}01570     \textcolor{comment}{// In each iteration of Gauss-\/Seidel we need to calculate}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01571}01571     \textcolor{comment}{//              x\_new=-\/inv(L+D)*U*x\_old+inv(L+D)*rhs,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01572}01572     \textcolor{comment}{// where L represents the strict lower triangular portion of A,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01573}01573     \textcolor{comment}{// D represents the diagonal of A and U represents the strict upper}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01574}01574     \textcolor{comment}{// triangular portion of A. Since the value of inv(L+D)*rhs remains}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01575}01575     \textcolor{comment}{// constant throughout we shall calculate it now and store it to}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01576}01576     \textcolor{comment}{// avoid calculating it again with each iteration.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01577}01577 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01578}01578     \textcolor{comment}{// Create a temporary matrix pointer to allow for the extraction of the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01579}01579     \textcolor{comment}{// row start, column index and value pointers}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01580}01580     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* tmp\_matrix\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01581}01581 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01582}01582     \textcolor{comment}{// First acquire access to the value, row\_start and column\_index arrays}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01583}01583     \textcolor{comment}{// from the compressed row matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01584}01584     \textcolor{keyword}{const} \textcolor{keywordtype}{double}* value\_pt = tmp\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_aafc5f1896dc3a317cdeddb067290c796}{value}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01585}01585     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* row\_start\_pt = tmp\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a31a5d05c00d653a02e7b07714472d372}{row\_start}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01586}01586     \textcolor{keyword}{const} \textcolor{keywordtype}{int}* column\_index\_pt = tmp\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_a925b465e7e86cf1ec45c1fb70a37c105}{column\_index}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01587}01587 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01588}01588     \textcolor{comment}{// We've finished using the temporary matrix pointer so make it a null}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01589}01589     \textcolor{comment}{// pointer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01590}01590     tmp\_matrix\_pt = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01591}01591 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01592}01592     \textcolor{comment}{// We can only calculate this constant term if the diagonal entries}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01593}01593     \textcolor{comment}{// of the matrix are nonzero so we check this first}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01594}01594     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01595}01595     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01596}01596       \textcolor{comment}{// Get the index of the last entry below or on the diagonal in row i}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01597}01597       \textcolor{keywordtype}{unsigned} diag\_index = Index\_of\_diagonal\_entries[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01598}01598 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01599}01599       \textcolor{keywordflow}{if} (\textcolor{keywordtype}{unsigned}(*(column\_index\_pt + diag\_index)) != \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01600}01600       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01601}01601         \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err\_strng = \textcolor{stringliteral}{"{}Gauss-\/Seidel cannot operate on a matrix with "{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01602}01602         err\_strng += \textcolor{stringliteral}{"{}zero diagonal entries."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01603}01603         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01604}01604           err\_strng, OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01605}01605       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01606}01606     \} \textcolor{comment}{// for (unsigned i=0;i<n\_dof;i++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01607}01607 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01608}01608     \textcolor{comment}{// If there were no zero diagonal entries we can calculate the vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01609}01609     \textcolor{comment}{//                 constant\_term=inv(L+D)*rhs.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01610}01610 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01611}01611     \textcolor{comment}{// Create a vector to hold the constant term in the iteration}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01612}01612     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} constant\_term(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01613}01613 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01614}01614     \textcolor{comment}{// Copy the entries of rhs into the vector, constant\_term}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01615}01615     constant\_term = rhs;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01616}01616 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01617}01617     \textcolor{comment}{// Start by looping over the rows of constant\_term}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01618}01618     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01619}01619     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01620}01620       \textcolor{comment}{// Get the index of the last entry below or on the diagonal in row i}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01621}01621       \textcolor{keywordtype}{unsigned} diag\_index = Index\_of\_diagonal\_entries[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01622}01622 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01623}01623       \textcolor{comment}{// Get the index of the first entry in row i}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01624}01624       \textcolor{keywordtype}{unsigned} row\_i\_start = *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01625}01625 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01626}01626       \textcolor{comment}{// If there are entries strictly below the diagonal then the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01627}01627       \textcolor{comment}{// column index of the first entry in the i-\/th row cannot be}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01628}01628       \textcolor{comment}{// i (since we have ensured that nonzero entries exist on the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01629}01629       \textcolor{comment}{// diagonal so this is the largest the column index of the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01630}01630       \textcolor{comment}{// first entry in this row could be)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01631}01631       \textcolor{keywordflow}{if} (\textcolor{keywordtype}{unsigned}(*(column\_index\_pt + row\_i\_start)) != \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01632}01632       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01633}01633         \textcolor{comment}{// Initialise the column index variable}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01634}01634         \textcolor{keywordtype}{unsigned} column\_index = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01635}01635 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01636}01636         \textcolor{comment}{// Loop over the entries below the diagonal on row i}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01637}01637         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = row\_i\_start; j < diag\_index; j++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01638}01638         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01639}01639           \textcolor{comment}{// Find the column index of this nonzero entry}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01640}01640           column\_index = *(column\_index\_pt + j);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01641}01641 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01642}01642           \textcolor{comment}{// Subtract the value of A(i,j)*constant\_term(j) (where j<i)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01643}01643           constant\_term[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/= (*(value\_pt + j)) * constant\_term[column\_index];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01644}01644         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01645}01645       \} \textcolor{comment}{// if (*(column\_index\_pt+row\_i\_start)!=i)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01646}01646 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01647}01647       \textcolor{comment}{// Finish off by calculating constant\_term(i)/A(i,i)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01648}01648       constant\_term[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] /= *(value\_pt + diag\_index);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01649}01649     \} \textcolor{comment}{// for (unsigned i=0;i<n\_dof;i++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01650}01650 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01651}01651     \textcolor{comment}{// Build a temporary vector to store the value of A*x with each iteration}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01652}01652     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_vec(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01653}01653 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01654}01654     \textcolor{comment}{// Outermost loop: Run max\_iter times (the iteration number)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01655}01655     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iter\_num = 0; iter\_num < \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a9bdc42768d009b093fd7bc23647dc989}{Max\_iter}}; iter\_num++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01656}01656     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01657}01657       \textcolor{comment}{// With each iteration we need to calculate}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01658}01658       \textcolor{comment}{//            x\_new=-\/inv(L+D)*U*x\_old+inv(L+D)*rhs,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01659}01659       \textcolor{comment}{//                 =-\/inv(L+D)*U*x\_old+constant\_term.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01660}01660       \textcolor{comment}{// Since we've already calculated the vector constant\_term, it remains}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01661}01661       \textcolor{comment}{// for us to calculate inv(L+D)*U*x. To do this we break the calculation}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01662}01662       \textcolor{comment}{// into two parts:}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01663}01663       \textcolor{comment}{//        (1) The matrix-\/vector multiplication temp\_vec=U*x, and;}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01664}01664       \textcolor{comment}{//        (2) The matrix-\/vector multiplication inv(L+D)*temp\_vec.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01665}01665 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01666}01666       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01667}01667       \textcolor{comment}{// (1) Calculating temp\_vec=U*x:}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01668}01668       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01669}01669 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01670}01670       \textcolor{comment}{// Auxiliary variable to store the index of the first entry on the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01671}01671       \textcolor{comment}{// upper triangular portion of the matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01672}01672       \textcolor{keywordtype}{unsigned} upper\_tri\_start = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01673}01673 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01674}01674       \textcolor{comment}{// Auxiliary variable to store the index of the first entry in the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01675}01675       \textcolor{comment}{// next row}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01676}01676       \textcolor{keywordtype}{unsigned} next\_row\_start = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01677}01677 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01678}01678       \textcolor{comment}{// Set the temporary vector temp\_vec to be initially be the zero vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01679}01679       temp\_vec.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01680}01680 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01681}01681       \textcolor{comment}{// Loop over the rows of temp\_vec (note: we do not loop over the final}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01682}01682       \textcolor{comment}{// row since all the entries on the last row of a strict upper triangular}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01683}01683       \textcolor{comment}{// matrix are zero)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01684}01684       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof -\/ 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01685}01685       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01686}01686         \textcolor{comment}{// Get the index of the first entry on the upper triangular portion of}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01687}01687         \textcolor{comment}{// the matrix noting that the i-\/th entry in Index\_of\_diagonal\_entries}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01688}01688         \textcolor{comment}{// will store the index of the diagonal entry of the i-\/th row}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01689}01689         upper\_tri\_start = Index\_of\_diagonal\_entries[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] + 1;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01690}01690 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01691}01691         \textcolor{comment}{// Get the index of the first entry in the next row}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01692}01692         next\_row\_start = *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01693}01693 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01694}01694         \textcolor{comment}{// Variable to store the column index of each entry}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01695}01695         \textcolor{keywordtype}{unsigned} column\_index = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01696}01696 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01697}01697         \textcolor{comment}{// Loop over all of the entries above the diagonal}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01698}01698         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = upper\_tri\_start; j < next\_row\_start; j++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01699}01699         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01700}01700           \textcolor{comment}{// Get the column index of this entry}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01701}01701           column\_index = *(column\_index\_pt + j);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01702}01702 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01703}01703           \textcolor{comment}{// Update the value of temp\_vec[i] by adding A(i,j)*x(j) (where j>i)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01704}01704           temp\_vec[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += (*(value\_pt + j)) * x[column\_index];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01705}01705         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01706}01706       \} \textcolor{comment}{// for (unsigned i=0;i<n\_dof;i++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01707}01707 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01708}01708       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01709}01709       \textcolor{comment}{// (2) Calculating inv(L+D)*temp\_vec:}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01710}01710       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01711}01711 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01712}01712       \textcolor{comment}{// Now U*x=temp\_vec has been calculated we need to calculate the vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01713}01713       \textcolor{comment}{//                 y=inv(L+D)*U*x=inv(L+D)*temp\_vec.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01714}01714       \textcolor{comment}{// Note: the i-\/th entry in y is given by}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01715}01715       \textcolor{comment}{//       y(i)=(temp\_vec(i)-\/\(\backslash\)sum\_\{j=0\}\string^\{i-\/1\}A(i,j)*y(j))/A(i,i).}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01716}01716       \textcolor{comment}{// We can see from this that to calculate the current entry in y we}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01717}01717       \textcolor{comment}{// use its previously calculated entries and the current entry in}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01718}01718       \textcolor{comment}{// temp\_vec. As a result, we do not need two separate vectors y and}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01719}01719       \textcolor{comment}{// temp\_vec for this calculation. Instead, we can just update the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01720}01720       \textcolor{comment}{// entries in temp\_vec (carefully!) using:}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01721}01721       \textcolor{comment}{//   temp\_vec(i)=(temp\_vec(i)-\/\(\backslash\)sum\_\{j=0\}\string^\{i-\/1\}A(i,j)*temp\_vec(j))/A(i,i).}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01722}01722 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01723}01723       \textcolor{comment}{// Start by looping over the rows of rhs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01724}01724       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01725}01725       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01726}01726         \textcolor{comment}{// Get the index of the last entry below or on the diagonal in row i}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01727}01727         \textcolor{keywordtype}{unsigned} diag\_index = Index\_of\_diagonal\_entries[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01728}01728 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01729}01729         \textcolor{comment}{// Get the index of the first entry in row i}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01730}01730         \textcolor{keywordtype}{unsigned} row\_i\_start = *(row\_start\_pt + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01731}01731 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01732}01732         \textcolor{comment}{// If there are no entries strictly below the diagonal then the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01733}01733         \textcolor{comment}{// column index of the first entry in the i-\/th row will be greater}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01734}01734         \textcolor{comment}{// than or equal to i}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01735}01735         \textcolor{keywordflow}{if} (\textcolor{keywordtype}{unsigned}(*(column\_index\_pt + row\_i\_start)) != \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01736}01736         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01737}01737           \textcolor{comment}{// Initialise the column index variable}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01738}01738           \textcolor{keywordtype}{unsigned} column\_index = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01739}01739 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01740}01740           \textcolor{comment}{// Loop over the entries below the diagonal}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01741}01741           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = row\_i\_start; j < diag\_index; j++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01742}01742           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01743}01743             \textcolor{comment}{// Find the column index of this nonzero entry}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01744}01744             column\_index = *(column\_index\_pt + j);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01745}01745 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01746}01746             \textcolor{comment}{// Subtract the value of A(i,j)*y(j) (where j<i)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01747}01747             temp\_vec[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/= (*(value\_pt + j)) * temp\_vec[column\_index];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01748}01748           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01749}01749         \} \textcolor{comment}{// if (*(column\_index\_pt+row\_i\_start)!=i)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01750}01750 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01751}01751         \textcolor{comment}{// Finish off by calculating temp\_vec(i)/A(i,i)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01752}01752         temp\_vec[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] /= *(value\_pt + diag\_index);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01753}01753       \} \textcolor{comment}{// for (unsigned i=0;i<n\_dof;i++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01754}01754 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01755}01755       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01756}01756       \textcolor{comment}{// Updating the solution x:}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01757}01757       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01758}01758 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01759}01759       \textcolor{comment}{// The updated solution is given by}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01760}01760       \textcolor{comment}{//            x\_new=-\/inv(L+D)*U*x\_old+inv(L+D)*rhs,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01761}01761       \textcolor{comment}{//                 =-\/temp\_vec+constant\_term,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01762}01762       \textcolor{comment}{// We have calculated both constant\_term and temp\_vec so we simply}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01763}01763       \textcolor{comment}{// need to calculate x now}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01764}01764 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01765}01765       \textcolor{comment}{// Set x to be the vector, constant\_term}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01766}01766       x = constant\_term;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01767}01767 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01768}01768       \textcolor{comment}{// Update x to give the next iterate}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01769}01769       x -\/= temp\_vec;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01770}01770 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01771}01771       \textcolor{comment}{// Increment the value of Iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01772}01772       \mbox{\hyperlink{classoomph_1_1GS_a3cef5f6067f391b7db9659d065a27cb5}{Iterations}}++;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01773}01773 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01774}01774       \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01775}01775       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Smoother_aa789c91e11408d9ffd94c237e4a729b7}{Use\_as\_smoother}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01776}01776       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01777}01777         \textcolor{comment}{// Get residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01778}01778         matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a971bdc2d9297fc582af8467178f4e00e}{residual}}(x, rhs, current\_residual);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01779}01779 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01780}01780         \textcolor{comment}{// Calculate the relative residual norm (i.e.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01781}01781         \textcolor{comment}{// \(\backslash\)frac\{\(\backslash\)|r\_\{i\}\(\backslash\)|\}\{\(\backslash\)|r\_\{0\}\(\backslash\)|\})}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01782}01782         norm\_res = current\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}() / norm\_f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01783}01783 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01784}01784         \textcolor{comment}{// If required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01785}01785         \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01786}01786         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_aeb0fbe103e721196232260230abb1997}{Doc\_convergence\_history}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01787}01787         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01788}01788           \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4d6766bec67399c29392e6540b91dd9}{Output\_file\_stream}}.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01789}01789           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01790}01790             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << iter\_num << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01791}01791           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01792}01792           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01793}01793           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01794}01794             \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4d6766bec67399c29392e6540b91dd9}{Output\_file\_stream}} << iter\_num << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01795}01795           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01796}01796         \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01797}01797 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01798}01798         \textcolor{comment}{// Check the tolerance only if the residual norm is being computed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01799}01799         \textcolor{keywordflow}{if} (norm\_res < \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a46dd6b0243c734a77afce3c44cf4597d}{Tolerance}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01800}01800         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01801}01801           \textcolor{comment}{// Break out of the for-\/loop}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01802}01802           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01803}01803         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01804}01804       \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01805}01805     \} \textcolor{comment}{// for (unsigned iter\_num=0;iter\_num<max\_iter;iter\_num++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01806}01806 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01807}01807     \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01808}01808     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1Smoother_aa789c91e11408d9ffd94c237e4a729b7}{Use\_as\_smoother}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01809}01809     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01810}01810       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01811}01811       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01812}01812       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01813}01813         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nGS converged. Residual norm: "{}} << norm\_res}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01814}01814                    << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of iterations to convergence: "{}} << \mbox{\hyperlink{classoomph_1_1GS_a3cef5f6067f391b7db9659d065a27cb5}{Iterations}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01815}01815                    << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01816}01816                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01817}01817       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01818}01818     \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01819}01819 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01820}01820     \textcolor{comment}{// Copy the solution into the solution vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01821}01821     solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01822}01822 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01823}01823     \textcolor{comment}{// Document the time for the solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01824}01824     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01825}01825     \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ab90d7e7780e709946dd0540a146186b5}{Solution\_time}} = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01826}01826 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01827}01827     \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01828}01828     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01829}01829     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01830}01830       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with Gauss-\/Seidel [sec]: "{}} << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ab90d7e7780e709946dd0540a146186b5}{Solution\_time}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01831}01831                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01832}01832     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01833}01833 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01834}01834     \textcolor{comment}{// If the solver failed to converge and the user asked for an error if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01835}01835     \textcolor{comment}{// this happened}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01836}01836     \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1GS_a3cef5f6067f391b7db9659d065a27cb5}{Iterations}} > \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a9bdc42768d009b093fd7bc23647dc989}{Max\_iter}} -\/ 1) \&\& (\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a76284ada37aafb9ab39836907569c7b2}{Throw\_error\_after\_max\_iter}}))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01837}01837     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01838}01838       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message =}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01839}01839         \textcolor{stringliteral}{"{}Solver failed to converge and you requested "{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01840}01840       error\_message += \textcolor{stringliteral}{"{}an error on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01841}01841       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01842}01842         error\_message, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01843}01843     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01844}01844   \} \textcolor{comment}{// End of solve\_helper}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01845}01845 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01846}01846 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01847}01847 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01848}01848 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01849}01849 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01850}01850 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01851}01851 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01852}01852   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01853}01853 \textcolor{comment}{  /// Solver: Takes pointer to problem and returns the results}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01854}01854 \textcolor{comment}{  /// vector which contains the solution of the linear system defined}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01855}01855 \textcolor{comment}{  /// by the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01856}01856 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01857}01857   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01858}\mbox{\hyperlink{classoomph_1_1DampedJacobi_ace422835d94b7d465d08cc1f4df192ea}{01858}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DampedJacobi_ace422835d94b7d465d08cc1f4df192ea}{DampedJacobi<MATRIX>::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01859}01859                                    \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01860}01860   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01861}01861     \textcolor{comment}{// Reset the Use\_as\_smoother\_flag as the solver is not being used}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01862}01862     \textcolor{comment}{// as a smoother}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01863}01863     Use\_as\_smoother = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01864}01864 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01865}01865     \textcolor{comment}{// Find the \# of degrees of freedom (variables)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01866}01866     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01867}01867 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01868}01868     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01869}01869     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01870}01870 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01871}01871     \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01872}01872     Resolving = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01873}01873 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01874}01874     \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01875}01875     \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01876}01876 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01877}01877     \textcolor{comment}{// Set up the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01878}01878     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01879}01879 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01880}01880     \textcolor{comment}{// Assign the distribution to the LinearSolver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01881}01881     this-\/>build\_distribution(dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01882}01882 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01883}01883     \textcolor{comment}{// Allocate space for the Jacobian matrix in format specified}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01884}01884     \textcolor{comment}{// by template parameter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01885}01885     Matrix\_pt = \textcolor{keyword}{new} MATRIX;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01886}01886 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01887}01887     \textcolor{comment}{// Get the nonlinear residuals vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01888}01888     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01889}01889 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01890}01890     \textcolor{comment}{// Assign the Jacobian and the residuals vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01891}01891     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *Matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01892}01892 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01893}01893     \textcolor{comment}{// Extract the diagonal entries of the matrix and store them}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01894}01894     extract\_diagonal\_entries(Matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01895}01895 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01896}01896     \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01897}01897     Matrix\_can\_be\_deleted = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01898}01898 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01899}01899     \textcolor{comment}{// Doc time for setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01900}01900     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01901}01901     Jacobian\_setup\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01902}01902 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01903}01903     \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01904}01904     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01905}01905     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01906}01906       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of Jacobian [sec]: "{}} << Jacobian\_setup\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01907}01907                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01908}01908     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01909}01909 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01910}01910     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01911}01911     solve\_helper(Matrix\_pt, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01912}01912 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01913}01913     \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01914}01914     \textcolor{keywordflow}{if} (!Enable\_resolve) \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01915}01915   \} \textcolor{comment}{// End of solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01916}01916 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01917}01917   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01918}01918 \textcolor{comment}{  /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01919}01919 \textcolor{comment}{  /// rhs vector and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01920}01920 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01921}01921   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01922}\mbox{\hyperlink{classoomph_1_1DampedJacobi_a8293439927a99030a1508f268be8a876}{01922}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1DampedJacobi_a8293439927a99030a1508f268be8a876}{DampedJacobi<MATRIX>::solve\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01923}01923                                           \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01924}01924                                           \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01925}01925   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01926}01926     \textcolor{comment}{// Get number of dofs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01927}01927     \textcolor{keywordtype}{unsigned} n\_dof = rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01928}01928 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01929}01929 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01930}01930     \textcolor{comment}{// Upcast the matrix to the appropriate type}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01931}01931     MATRIX* tmp\_matrix\_pt = \textcolor{keyword}{dynamic\_cast<}MATRIX*\textcolor{keyword}{>}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01932}01932 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01933}01933     \textcolor{comment}{// PARANOID Run the self-\/tests to check the inputs are correct}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01934}01934     this-\/>check\_validity\_of\_solve\_helper\_inputs<MATRIX>(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01935}01935       tmp\_matrix\_pt, rhs, solution, n\_dof);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01936}01936 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01937}01937     \textcolor{comment}{// We don't need the pointer any more but we do still need the matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01938}01938     \textcolor{comment}{// so just make tmp\_matrix\_pt a null pointer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01939}01939     tmp\_matrix\_pt = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01940}01940 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01941}01941 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01942}01942     \textcolor{comment}{// Setup the solution if it is not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01943}01943     \textcolor{keywordflow}{if} (!solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a92bfff97fd228b9c528922c39ab563b2}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01944}01944     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01945}01945       \textcolor{comment}{// Build the distribution of the solution vector if it hasn't been done}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01946}01946       \textcolor{comment}{// yet}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01947}01947       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01948}01948     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01949}01949     \textcolor{comment}{// If the solution has already been set up}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01950}01950     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01951}01951     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01952}01952       \textcolor{comment}{// If we're inside the multigrid solver then as we traverse up the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01953}01953       \textcolor{comment}{// hierarchy we use the smoother on the updated approximate solution.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01954}01954       \textcolor{comment}{// As such, we should ONLY be resetting all the values to zero if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01955}01955       \textcolor{comment}{// we're NOT inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01956}01956       \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01957}01957       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01958}01958         \textcolor{comment}{// Initialise the vector with all entries set to zero}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01959}01959         solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01960}01960       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01961}01961     \} \textcolor{comment}{// if (!solution.distribution\_pt()-\/>built())}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01962}01962 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01963}01963     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01964}01964     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01965}01965 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01966}01966     \textcolor{comment}{// Initial guess isn't necessarily zero (restricted solution from finer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01967}01967     \textcolor{comment}{// grids) therefore x needs to be assigned values from the input.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01968}01968     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x(solution);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01969}01969 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01970}01970     \textcolor{comment}{// Create a vector to store the value of the constant term, omega*inv(D)*r}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01971}01971     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} constant\_term(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01972}01972 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01973}01973     \textcolor{comment}{// Calculate the constant term vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01974}01974     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01975}01975     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01976}01976       \textcolor{comment}{// Assign the i-\/th entry of constant\_term}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01977}01977       constant\_term[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = Omega * Matrix\_diagonal[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01978}01978     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01979}01979 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01980}01980     \textcolor{comment}{// Create a vector to hold the residual. This will only be built if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01981}01981     \textcolor{comment}{// we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01982}01982     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} local\_residual;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01983}01983 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01984}01984     \textcolor{comment}{// Variable to store the 2-\/norm of the residual vector. Only used}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01985}01985     \textcolor{comment}{// if we are not working inside the MG solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01986}01986     \textcolor{keywordtype}{double} norm\_res = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01987}01987 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01988}01988     \textcolor{comment}{// Variables to hold the initial residual norm. Only used if we're}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01989}01989     \textcolor{comment}{// not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01990}01990     \textcolor{keywordtype}{double} norm\_f = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01991}01991 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01992}01992     \textcolor{comment}{// Initialise the value of Iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01993}01993     Iterations = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01994}01994 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01995}01995     \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01996}01996     \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01997}01997     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01998}01998       \textcolor{comment}{// Build the local residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l01999}01999       local\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02000}02000 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02001}02001       \textcolor{comment}{// Calculate the residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02002}02002       matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a971bdc2d9297fc582af8467178f4e00e}{residual}}(x, rhs, local\_residual);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02003}02003 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02004}02004       \textcolor{comment}{// Calculate the 2-\/norm}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02005}02005       norm\_res = local\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02006}02006 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02007}02007       \textcolor{comment}{// Store the initial norm}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02008}02008       norm\_f = norm\_res;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02009}02009 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02010}02010       \textcolor{comment}{// If required will document convergence history to screen}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02011}02011       \textcolor{comment}{// or file (if stream is open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02012}02012       \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02013}02013       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02014}02014         \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02015}02015         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02016}02016           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02017}02017         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02018}02018         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02019}02019         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02020}02020           Output\_file\_stream << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02021}02021         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02022}02022       \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02023}02023     \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02024}02024 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02025}02025     \textcolor{comment}{// Create a temporary vector to store the value of A*e}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02026}02026     \textcolor{comment}{// on each iteration and another to store the residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02027}02027     \textcolor{comment}{// at the end of each iteration}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02028}02028     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_vec(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02029}02029 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02030}02030     \textcolor{comment}{// Outermost loop: Run up to Max\_iter times (the iteration number)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02031}02031     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iter\_num = 0; iter\_num < \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}; iter\_num++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02032}02032     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02033}02033       \textcolor{comment}{// Calculate A*e}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02034}02034       matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a78204eab557e0dc99618e41a28a5c092}{multiply}}(x, temp\_vec);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02035}02035 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02036}02036       \textcolor{comment}{// Loop over each degree of freedom and update}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02037}02037       \textcolor{comment}{// the current approximation}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02038}02038       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} idof = 0; idof < n\_dof; idof++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02039}02039       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02040}02040         \textcolor{comment}{// Scale the idof'th entry of temp\_vec}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02041}02041         \textcolor{comment}{// by omega/A(i,i)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02042}02042         temp\_vec[idof] *= Omega * Matrix\_diagonal[idof];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02043}02043       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02044}02044 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02045}02045       \textcolor{comment}{// Update the value of e (in the system Ae=r)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02046}02046       x += constant\_term;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02047}02047       x -\/= temp\_vec;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02048}02048 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02049}02049       \textcolor{comment}{// Increment the value of Iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02050}02050       Iterations++;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02051}02051 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02052}02052       \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02053}02053       \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02054}02054       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02055}02055         \textcolor{comment}{// Get residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02056}02056         matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a971bdc2d9297fc582af8467178f4e00e}{residual}}(x, rhs, local\_residual);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02057}02057 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02058}02058         \textcolor{comment}{// Calculate the 2-\/norm of the residual r=b-\/Ax}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02059}02059         norm\_res = local\_residual.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}() / norm\_f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02060}02060 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02061}02061         \textcolor{comment}{// If required, this will document convergence history to}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02062}02062         \textcolor{comment}{// screen or file (if the stream is open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02063}02063         \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02064}02064         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02065}02065           \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02066}02066           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02067}02067             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02068}02068           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02069}02069           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02070}02070           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02071}02071             Output\_file\_stream << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02072}02072           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02073}02073         \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02074}02074 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02075}02075         \textcolor{comment}{// Check the tolerance only if the residual norm is being computed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02076}02076         \textcolor{keywordflow}{if} (norm\_res < Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02077}02077         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02078}02078           \textcolor{comment}{// Break out of the for-\/loop}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02079}02079           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02080}02080         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02081}02081       \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02082}02082     \} \textcolor{comment}{// for (unsigned iter\_num=0;iter\_num<Max\_iter;iter\_num++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02083}02083 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02084}02084     \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02085}02085     \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02086}02086     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02087}02087       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02088}02088       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02089}02089       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02090}02090         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nDamped Jacobi converged. Residual norm: "{}} << norm\_res}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02091}02091                    << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of iterations to convergence: "{}} << Iterations}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02092}02092                    << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02093}02093                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02094}02094       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02095}02095     \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02096}02096 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02097}02097     \textcolor{comment}{// Copy the solution into the solution vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02098}02098     solution = x;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02099}02099 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02100}02100     \textcolor{comment}{// Doc. time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02101}02101     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02102}02102     Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02103}02103     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02104}02104     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02105}02105       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with damped Jacobi [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02106}02106                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02107}02107     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02108}02108 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02109}02109     \textcolor{comment}{// If the solver failed to converge and the user asked for an error if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02110}02110     \textcolor{comment}{// this happened}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02111}02111     \textcolor{keywordflow}{if} ((Iterations > \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} -\/ 1) \&\& (Throw\_error\_after\_max\_iter))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02112}02112     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02113}02113       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message =}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02114}02114         \textcolor{stringliteral}{"{}Solver failed to converge and you requested "{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02115}02115       error\_message += \textcolor{stringliteral}{"{}an error on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02116}02116       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02117}02117         error\_message, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02118}02118     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02119}02119   \} \textcolor{comment}{// End of solve\_helper}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02120}02120 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02121}02121 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02122}02122 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02123}02123 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02124}02124 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02125}02125 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02126}02126 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02127}02127   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02128}02128 \textcolor{comment}{  /// \(\backslash\)Short Re-\/solve the system defined by the last assembled Jacobian}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02129}02129 \textcolor{comment}{  /// and the rhs vector specified here. Solution is returned in}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02130}02130 \textcolor{comment}{  /// the vector result.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02131}02131 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02132}02132   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02133}\mbox{\hyperlink{classoomph_1_1GMRES_a18e32688dcbd8806f1f23d754fc712a3}{02133}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1GMRES_a18e32688dcbd8806f1f23d754fc712a3}{GMRES<MATRIX>::resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02134}02134   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02135}02135     \textcolor{comment}{// We are re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02136}02136     Resolving = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02137}02137 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02138}02138 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02139}02139     \textcolor{keywordflow}{if} (Matrix\_pt == 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02140}02140     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02141}02141       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}No matrix was stored -\/-\/ cannot re-\/solve"{}},}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02142}02142                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02143}02143                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02144}02144     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02145}02145 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02146}02146 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02147}02147     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02148}02148     this-\/>solve(Matrix\_pt, rhs, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02149}02149 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02150}02150     \textcolor{comment}{// Reset re-\/solving flag}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02151}02151     Resolving = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02152}02152   \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02153}02153 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02154}02154 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02155}02155   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02156}02156 \textcolor{comment}{  /// Solver: Takes pointer to problem and returns the results vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02157}02157 \textcolor{comment}{  /// which contains the solution of the linear system defined by}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02158}02158 \textcolor{comment}{  /// the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02159}02159 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02160}02160   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02161}\mbox{\hyperlink{classoomph_1_1GMRES_ade0f569ecda6b63d3e77dfe07a19cb13}{02161}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1GMRES_ade0f569ecda6b63d3e77dfe07a19cb13}{GMRES<MATRIX>::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02162}02162   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02163}02163     \textcolor{comment}{// Find \# of degrees of freedom (variables)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02164}02164     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02165}02165 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02166}02166     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02167}02167     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02168}02168 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02169}02169     \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02170}02170     Resolving = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02171}02171 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02172}02172     \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02173}02173     \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02174}02174 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02175}02175     \textcolor{comment}{// setup the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02176}02176     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02177}02177     this-\/>build\_distribution(dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02178}02178 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02179}02179     \textcolor{comment}{// Get Jacobian matrix in format specified by template parameter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02180}02180     \textcolor{comment}{// and nonlinear residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02181}02181     Matrix\_pt = \textcolor{keyword}{new} MATRIX;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02182}02182     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02183}02183     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(Matrix\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02184}02184     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02185}02185       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(Matrix\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02186}02186       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02187}02187         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(Matrix\_pt)-\/>build(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02188}02188           this-\/>distribution\_pt());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02189}02189         f.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02190}02190       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02191}02191     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02192}02192     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *Matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02193}02193 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02194}02194     \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02195}02195     Matrix\_can\_be\_deleted = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02196}02196 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02197}02197     \textcolor{comment}{// Doc time for setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02198}02198     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02199}02199     Jacobian\_setup\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02200}02200 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02201}02201     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02202}02202     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02203}02203       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of Jacobian [sec]: "{}} << Jacobian\_setup\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02204}02204                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02205}02205     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02206}02206 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02207}02207     \textcolor{comment}{// If we want to compute the gradient for the globally convergent}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02208}02208     \textcolor{comment}{// Newton method, then do it here}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02209}02209     \textcolor{keywordflow}{if} (Compute\_gradient)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02210}02210     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02211}02211       \textcolor{comment}{// Compute it}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02212}02212       Matrix\_pt-\/>multiply\_transpose(f, Gradient\_for\_glob\_conv\_newton\_solve);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02213}02213       \textcolor{comment}{// Set the flag}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02214}02214       Gradient\_has\_been\_computed = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02215}02215     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02216}02216 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02217}02217     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02218}02218     \textcolor{comment}{// If the result distribution is wrong, then redistribute}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02219}02219     \textcolor{comment}{// before the solve and return to original distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02220}02220     \textcolor{comment}{// afterwards}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02221}02221     \textcolor{keywordflow}{if} ((result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}()) \&\&}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02222}02222         (!(*result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *this-\/>distribution\_pt())))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02223}02223     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02224}02224       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} temp\_global\_dist(result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02225}02225       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02226}02226       this-\/>solve\_helper(Matrix\_pt, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02227}02227       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&temp\_global\_dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02228}02228     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02229}02229     \textcolor{comment}{// Otherwise just solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02230}02230     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02231}02231     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02232}02232       this-\/>solve\_helper(Matrix\_pt, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02233}02233     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02234}02234 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02235}02235     \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02236}02236     \textcolor{keywordflow}{if} (!Enable\_resolve) \mbox{\hyperlink{namespaceoomph_1_1TerminateHelper_a20615123e22554c3c485484f4c23bfb5}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02237}02237   \};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02238}02238 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02239}02239 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02240}02240   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02241}02241 \textcolor{comment}{  /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and rhs vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02242}02242 \textcolor{comment}{  /// and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02243}02243 \textcolor{comment}{  /// based on the algorithm presented in Templates for the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02244}02244 \textcolor{comment}{  /// Solution of Linear Systems: Building Blocks for Iterative}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02245}02245 \textcolor{comment}{  /// Methods, Barrett,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02246}02246 \textcolor{comment}{  /// Berry et al, SIAM, 2006 and the implementation in the IML++ library :}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02247}02247 \textcolor{comment}{  /// http://math.nist.gov/iml++/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02248}02248 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02249}02249   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02250}\mbox{\hyperlink{classoomph_1_1GMRES_a29da2c2303b12f3f9fa72423f3daf399}{02250}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1GMRES_a29da2c2303b12f3f9fa72423f3daf399}{GMRES<MATRIX>::solve\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02251}02251                                    \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02252}02252                                    \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02253}02253   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02254}02254     \textcolor{comment}{// Get number of dofs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02255}02255     \textcolor{keywordtype}{unsigned} n\_dof = rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02256}02256 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02257}02257 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02258}02258     \textcolor{comment}{// PARANOID check that if the matrix is distributable then it should not be}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02259}02259     \textcolor{comment}{// then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02260}02260     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(matrix\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02261}02261     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02262}02262       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(matrix\_pt)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02263}02263             -\/>distributed())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02264}02264       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02265}02265         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02266}02266         error\_message\_stream << \textcolor{stringliteral}{"{}The matrix must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02267}02267         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02268}02268                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02269}02269                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02270}02270       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02271}02271     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02272}02272     \textcolor{comment}{// PARANOID check that this rhs distribution is setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02273}02273     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02274}02274     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02275}02275       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02276}02276       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector distribution must be setup."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02277}02277       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02278}02278                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02279}02279                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02280}02280     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02281}02281     \textcolor{comment}{// PARANOID check that the rhs has the right number of global rows}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02282}02282     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02283}02283     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02284}02284       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02285}02285         \textcolor{stringliteral}{"{}RHS does not have the same dimension as the linear system"{}},}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02286}02286         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02287}02287         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02288}02288     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02289}02289     \textcolor{comment}{// PARANOID check that the rhs is not distributed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02290}02290     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02291}02291     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02292}02292       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02293}02293       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02294}02294       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02295}02295                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02296}02296                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02297}02297     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02298}02298     \textcolor{comment}{// PARANOID check that if the result is setup it matches the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02299}02299     \textcolor{comment}{// of the rhs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02300}02300     \textcolor{keywordflow}{if} (solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02301}02301     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02302}02302       \textcolor{keywordflow}{if} (!(*rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02303}02303       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02304}02304         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02305}02305         error\_message\_stream << \textcolor{stringliteral}{"{}If the result distribution is setup then it "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02306}02306                                 \textcolor{stringliteral}{"{}must be the same as the "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02307}02307                              << \textcolor{stringliteral}{"{}rhs distribution"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02308}02308         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02309}02309                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02310}02310                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02311}02311       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02312}02312     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02313}02313 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02314}02314 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02315}02315     \textcolor{comment}{// Reset the time spent applying the preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02316}02316     Preconditioner\_application\_time = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02317}02317 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02318}02318     \textcolor{comment}{// Set up the solution if it is not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02319}02319     \textcolor{keywordflow}{if} (!solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02320}02320     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02321}02321       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02322}02322     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02323}02323     \textcolor{comment}{// Otherwise initialise to zero}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02324}02324     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02325}02325     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02326}02326       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02327}02327     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02328}02328 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02329}02329     \textcolor{comment}{// Time solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02330}02330     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02331}02331 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02332}02332     \textcolor{comment}{// Relative residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02333}02333     \textcolor{keywordtype}{double} resid;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02334}02334 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02335}02335     \textcolor{comment}{// iteration counter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02336}02336     \textcolor{keywordtype}{unsigned} iter = 1;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02337}02337 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02338}02338     \textcolor{comment}{// if not using iteration restart set Restart to n\_dof}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02339}02339     \textcolor{keywordflow}{if} (!Iteration\_restart)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02340}02340     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02341}02341       Restart = n\_dof;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02342}02342     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02343}02343 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02344}02344     \textcolor{comment}{// initialise vectors}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02345}02345     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(Restart + 1, 0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02346}02346     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} cs(Restart + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02347}02347     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} sn(Restart + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02348}02348     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} w(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02349}02349 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02350}02350     \textcolor{comment}{// Setup preconditioner only if we're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02351}02351     \textcolor{keywordflow}{if} (!Resolving)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02352}02352     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02353}02353       \textcolor{comment}{// only setup the preconditioner before solve if require}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02354}02354       \textcolor{keywordflow}{if} (Setup\_preconditioner\_before\_solve)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02355}02355       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02356}02356         \textcolor{comment}{// Setup preconditioner from the Jacobian matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02357}02357         \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02358}02358 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02359}02359         \textcolor{comment}{// do not setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02360}02360         preconditioner\_pt()-\/>setup(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02361}02361 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02362}02362         \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02363}02363         \textcolor{keywordtype}{double} t\_end\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02364}02364         Preconditioner\_setup\_time = t\_end\_prec -\/ t\_start\_prec;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02365}02365 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02366}02366         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02367}02367         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02368}02368           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of preconditioner  [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02369}02369                      << Preconditioner\_setup\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02370}02370         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02371}02371       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02372}02372     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02373}02373     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02374}02374     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02375}02375       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02376}02376       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02377}02377         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Setup of preconditioner is bypassed in resolve mode"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02378}02378                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02379}02379       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02380}02380     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02381}02381 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02382}02382     \textcolor{comment}{// solve b-\/Jx = Mr for r (assumes x = 0);}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02383}02383     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} r(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02384}02384     \textcolor{keywordflow}{if} (Preconditioner\_LHS)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02385}02385     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02386}02386       \textcolor{comment}{// Start the timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02387}02387       \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02388}02388 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02389}02389       \textcolor{comment}{// Apply the preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02390}02390       preconditioner\_pt()-\/>preconditioner\_solve(rhs, r);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02391}02391 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02392}02392       \textcolor{comment}{// Calculate the time taken for the preconditioner solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02393}02393       Preconditioner\_application\_time +=}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02394}02394         (\mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_start\_prec);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02395}02395     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02396}02396     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02397}02397     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02398}02398       r = rhs;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02399}02399     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02400}02400     \textcolor{keywordtype}{double} normb = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02401}02401 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02402}02402     \textcolor{comment}{// compute norm(r)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02403}02403     \textcolor{keywordtype}{double}* r\_pt = r.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02404}02404     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02405}02405     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02406}02406       normb += r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02407}02407     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02408}02408     normb = sqrt(normb);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02409}02409 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02410}02410     \textcolor{comment}{// set beta (the initial residual)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02411}02411     \textcolor{keywordtype}{double} beta = normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02412}02412 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02413}02413     \textcolor{comment}{// compute initial relative residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02414}02414     \textcolor{keywordflow}{if} (normb == 0.0) normb = 1;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02415}02415     resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02416}02416 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02417}02417     \textcolor{comment}{// if required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02418}02418     \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02419}02419     \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02420}02420     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02421}02421       \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02422}02422       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02423}02423         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02424}02424       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02425}02425       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02426}02426       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02427}02427         Output\_file\_stream << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02428}02428       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02429}02429     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02430}02430 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02431}02431     \textcolor{comment}{// if GMRES converges immediately}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02432}02432     \textcolor{keywordflow}{if} (resid <= Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02433}02433     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02434}02434       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02435}02435       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02436}02436         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}GMRES converged immediately. Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02437}02437                    << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02438}02438       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02439}02439       \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02440}02440       \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02441}02441       Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02442}02442 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02443}02443       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02444}02444       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02445}02445         \textcolor{comment}{// Doc the time taken for the preconditioner applications}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02446}02446         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for all preconditioner applications [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02447}02447                    << Preconditioner\_application\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02448}02448                    << \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nTime for solve with GMRES  [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02449}02449                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02450}02450       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02451}02451       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02452}02452     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02453}02453 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02454}02454 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02455}02455     \textcolor{comment}{// initialise vector of orthogonal basis vectors (v) and upper hessenberg}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02456}02456     \textcolor{comment}{// matrix H}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02457}02457     \textcolor{comment}{// NOTE: for implementation purpose the upper hessenberg matrix indexes are}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02458}02458     \textcolor{comment}{// are swapped so the matrix is effectively transposed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02459}02459     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} v;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02460}02460     v.resize(Restart + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02461}02461     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> H(Restart + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02462}02462 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02463}02463     \textcolor{comment}{// while...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02464}02464     \textcolor{keywordflow}{while} (iter <= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02465}02465     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02466}02466       \textcolor{comment}{// set zeroth basis vector v[0] to r/beta}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02467}02467       v[0].build(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02468}02468       \textcolor{keywordtype}{double}* v0\_pt = v[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02469}02469       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02470}02470       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02471}02471         v0\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] / beta;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02472}02472       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02473}02473 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02474}02474       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02475}02475       \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0] = beta;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02476}02476 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02477}02477       \textcolor{comment}{// inner iteration counter for restarted version}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02478}02478       \textcolor{keywordtype}{unsigned} iter\_restart;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02479}02479 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02480}02480       \textcolor{comment}{// perform iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02481}02481       \textcolor{keywordflow}{for} (iter\_restart = 0; iter\_restart < Restart \&\& iter <= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02482}02482            iter\_restart++, iter++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02483}02483       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02484}02484         \textcolor{comment}{// resize next column of upper hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02485}02485         H[iter\_restart].resize(iter\_restart + 2);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02486}02486 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02487}02487         \textcolor{comment}{// solve Jv[i] = Mw for w}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02488}02488         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02489}02489           \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02490}02490           \textcolor{keywordflow}{if} (Preconditioner\_LHS)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02491}02491           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02492}02492             \textcolor{comment}{// solve Jv[i] = Mw for w}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02493}02493             matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a78204eab557e0dc99618e41a28a5c092}{multiply}}(v[iter\_restart], temp);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02494}02494 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02495}02495             \textcolor{comment}{// Start the timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02496}02496             \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02497}02497 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02498}02498             \textcolor{comment}{// Apply the preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02499}02499             preconditioner\_pt()-\/>preconditioner\_solve(temp, w);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02500}02500 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02501}02501             \textcolor{comment}{// Calculate the time taken for the preconditioner solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02502}02502             Preconditioner\_application\_time +=}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02503}02503               (\mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_start\_prec);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02504}02504           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02505}02505           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02506}02506           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02507}02507             \textcolor{comment}{// Start the timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02508}02508             \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02509}02509 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02510}02510             \textcolor{comment}{// w=JM\string^\{-\/1\}v by saad p270}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02511}02511             preconditioner\_pt()-\/>preconditioner\_solve(v[iter\_restart], temp);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02512}02512 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02513}02513             \textcolor{comment}{// Calculate the time taken for the preconditioner solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02514}02514             Preconditioner\_application\_time +=}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02515}02515               (\mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_start\_prec);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02516}02516 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02517}02517             \textcolor{comment}{// Do a matrix multiplication}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02518}02518             matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a78204eab557e0dc99618e41a28a5c092}{multiply}}(temp, w);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02519}02519           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02520}02520         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02521}02521 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02522}02522         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02523}02523         \textcolor{keywordtype}{double}* w\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02524}02524         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= iter\_restart; k++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02525}02525         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02526}02526           \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02527}02527           H[iter\_restart][k] = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02528}02528           \textcolor{keywordtype}{double}* vk\_pt = v[k].values\_pt();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02529}02529           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02530}02530           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02531}02531             H[iter\_restart][k] += w\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * vk\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02532}02532           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02533}02533 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02534}02534           \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02535}02535           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02536}02536           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02537}02537             w\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/= H[iter\_restart][k] * vk\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02538}02538           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02539}02539         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02540}02540 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02541}02541         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02542}02542         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02543}02543           \textcolor{keywordtype}{double} temp\_norm\_w = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02544}02544           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02545}02545           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02546}02546             temp\_norm\_w += w\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * w\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02547}02547           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02548}02548           temp\_norm\_w = sqrt(temp\_norm\_w);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02549}02549           H[iter\_restart][iter\_restart + 1] = temp\_norm\_w;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02550}02550         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02551}02551 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02552}02552         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02553}02553         v[iter\_restart + 1].build(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02554}02554         \textcolor{keywordtype}{double}* v\_pt = v[iter\_restart + 1].values\_pt();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02555}02555         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02556}02556         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02557}02557           v\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = w\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] / H[iter\_restart][iter\_restart + 1];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02558}02558         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02559}02559 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02560}02560         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02561}02561         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < iter\_restart; k++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02562}02562         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02563}02563           apply\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02564}02564             H[iter\_restart][k], H[iter\_restart][k + 1], cs[k], sn[k]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02565}02565         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02566}02566         generate\_plane\_rotation(H[iter\_restart][iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02567}02567                                 H[iter\_restart][iter\_restart + 1],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02568}02568                                 cs[iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02569}02569                                 sn[iter\_restart]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02570}02570         apply\_plane\_rotation(H[iter\_restart][iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02571}02571                              H[iter\_restart][iter\_restart + 1],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02572}02572                              cs[iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02573}02573                              sn[iter\_restart]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02574}02574         apply\_plane\_rotation(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02575}02575                              \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[iter\_restart + 1],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02576}02576                              cs[iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02577}02577                              sn[iter\_restart]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02578}02578 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02579}02579         \textcolor{comment}{// compute current residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02580}02580         beta = std::fabs(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[iter\_restart + 1]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02581}02581 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02582}02582         \textcolor{comment}{// compute relative residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02583}02583         resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02584}02584 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02585}02585         \textcolor{comment}{// if required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02586}02586         \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02587}02587         \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02588}02588         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02589}02589           \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02590}02590           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02591}02591             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << iter << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02592}02592           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02593}02593           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02594}02594           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02595}02595             Output\_file\_stream << iter << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02596}02596           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02597}02597         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02598}02598 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02599}02599         \textcolor{comment}{// if required tolerance found}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02600}02600         \textcolor{keywordflow}{if} (resid < Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02601}02601         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02602}02602           \textcolor{comment}{// update result vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02603}02603           update(iter\_restart, H, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, v, solution);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02604}02604 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02605}02605           \textcolor{comment}{// document convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02606}02606           \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02607}02607           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02608}02608             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02609}02609             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}GMRES converged (1). Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02610}02610                        << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02611}02611             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations to convergence: "{}} << iter}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02612}02612                        << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02613}02613             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02614}02614           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02615}02615 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02616}02616           \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02617}02617           \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02618}02618           Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02619}02619 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02620}02620           Iterations = iter;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02621}02621 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02622}02622           \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02623}02623           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02624}02624             \textcolor{comment}{// Doc the time taken for the preconditioner applications}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02625}02625             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for all preconditioner applications [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02626}02626                        << Preconditioner\_application\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02627}02627                        << \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nTime for solve with GMRES  [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02628}02628                        << Solution\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02629}02629           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02630}02630           \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02631}02631         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02632}02632       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02633}02633 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02634}02634       \textcolor{comment}{// update}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02635}02635       \textcolor{keywordflow}{if} (iter\_restart > 0) update((iter\_restart -\/ 1), H, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, v, solution);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02636}02636 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02637}02637       \textcolor{comment}{// solve Mr = (b-\/Jx) for r}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02638}02638       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02639}02639         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02640}02640         matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a78204eab557e0dc99618e41a28a5c092}{multiply}}(solution, temp);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02641}02641         \textcolor{keywordtype}{double}* temp\_pt = temp.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02642}02642         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* rhs\_pt = rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02643}02643         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02644}02644         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02645}02645           temp\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ temp\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02646}02646         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02647}02647 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02648}02648         \textcolor{keywordflow}{if} (Preconditioner\_LHS)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02649}02649         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02650}02650           \textcolor{comment}{// Start the timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02651}02651           \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02652}02652 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02653}02653           preconditioner\_pt()-\/>preconditioner\_solve(temp, r);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02654}02654 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02655}02655           \textcolor{comment}{// Calculate the time taken for the preconditioner solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02656}02656           Preconditioner\_application\_time +=}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02657}02657             (\mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}() -\/ t\_start\_prec);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02658}02658         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02659}02659       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02660}02660 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02661}02661       \textcolor{comment}{// compute current residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02662}02662       beta = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02663}02663       r\_pt = r.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02664}02664       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02665}02665       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02666}02666         beta += r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02667}02667       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02668}02668       beta = sqrt(beta);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02669}02669 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02670}02670       \textcolor{comment}{// if relative residual within tolerance}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02671}02671       resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02672}02672       \textcolor{keywordflow}{if} (resid < Tolerance)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02673}02673       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02674}02674         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02675}02675         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02676}02676           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02677}02677           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}GMRES converged (2). Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02678}02678                      << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02679}02679           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations to convergence: "{}} << iter}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02680}02680                      << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02681}02681           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02682}02682         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02683}02683 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02684}02684         \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02685}02685         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02686}02686         Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02687}02687 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02688}02688         Iterations = iter;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02689}02689 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02690}02690         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02691}02691         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02692}02692           \textcolor{comment}{// Doc the time taken for the preconditioner applications}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02693}02693           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for all preconditioner applications [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02694}02694                      << Preconditioner\_application\_time}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02695}02695                      << \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nTime for solve with GMRES  [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02696}02696                      << Solution\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02697}02697         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02698}02698         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02699}02699       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02700}02700     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02701}02701 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02702}02702     \textcolor{comment}{// DRAIG: I want to delete this but GMRES doesn't compute the residuals}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02703}02703     \textcolor{comment}{// properly after this scope when it doesn't converge within the specified}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02704}02704     \textcolor{comment}{// number of iterations. Not sure why. If you're bored, try to figure}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02705}02705     \textcolor{comment}{// out why.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02706}02706     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02707}02707       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02708}02708       matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_a78204eab557e0dc99618e41a28a5c092}{multiply}}(solution, temp);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02709}02709       temp *= -\/1.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02710}02710       temp += rhs;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02711}02711       resid = temp.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}() / normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02712}02712     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02713}02713 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02714}02714     \textcolor{comment}{// otherwise GMRES failed convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02715}02715     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02716}02716     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}GMRES did not converge to required tolerance! "{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02717}02717     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Returning with normalised residual norm: "{}} << resid}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02718}02718                << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02719}02719     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}after "{}} << \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} << \textcolor{stringliteral}{"{} iterations."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02720}02720     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02721}02721 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02722}02722 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02723}02723     \textcolor{keywordflow}{if} (Throw\_error\_after\_max\_iter)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02724}02724     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02725}02725       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Solver failed to converge and you requested an error"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02726}02726       err += \textcolor{stringliteral}{"{} on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02727}02727       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02728}02728         err, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02729}02729     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02730}02730 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02731}02731     \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02732}02732 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02733}02733   \} \textcolor{comment}{// End GMRES}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02734}02734 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02735}02735 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02736}02736 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02737}02737 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02738}02738 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02739}02739 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02740}02740 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02741}02741   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02742}02742 \textcolor{comment}{  /// Solver: Takes pointer to problem and returns the results vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02743}02743 \textcolor{comment}{  /// which contains the solution of the linear system defined by}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02744}02744 \textcolor{comment}{  /// the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02745}02745 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02746}\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a73d8d3d8b161084e6291560cdd7984dc}{02746}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a73d8d3d8b161084e6291560cdd7984dc}{AugmentedProblemGMRES::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02747}02747                                     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02748}02748   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02749}02749     \textcolor{comment}{// Find \# of degrees of freedom (in the non-\/augmented problem)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02750}02750     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02751}02751 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02752}02752     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02753}02753     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02754}02754 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02755}02755     \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02756}02756     \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1c8bdfdfbba0518cf24ad56970186714}{Resolving}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02757}02757 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02758}02758     \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02759}02759     \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_aa4fbf2fd3d7ce466e7ea74620c4bdcea}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02760}02760 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02761}02761     \textcolor{comment}{// Create a distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02762}02762     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02763}02763 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02764}02764     \textcolor{comment}{// ...now build it}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02765}02765     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02766}02766 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02767}02767     \textcolor{comment}{// Get the Jacobian matrix and the nonlinear residual vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02768}02768     \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02769}02769     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02770}02770     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02771}02771     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02772}02772       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02773}02773       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02774}02774         \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}})-\/>build(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02775}02775           this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02776}02776         f.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02777}02777       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02778}02778     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02779}02779     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02780}02780 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02781}02781     \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02782}02782     \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a9e906e80cad4f9261729e75f2448fc63}{Matrix\_can\_be\_deleted}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02783}02783 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02784}02784     \textcolor{comment}{// Doc time for setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02785}02785     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02786}02786     \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a82a12e45c78e910b46e9d0935beb8f0d}{Jacobian\_setup\_time}} = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02787}02787 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02788}02788     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02789}02789     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02790}02790       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of Jacobian [sec]: "{}} << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a82a12e45c78e910b46e9d0935beb8f0d}{Jacobian\_setup\_time}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02791}02791                  << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02792}02792     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02793}02793 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02794}02794     \textcolor{comment}{// Reset the Schur complement scalar entry value}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02795}02795     \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a837e46fe93f07fa0740b5a7a9f40ebcb}{Schur\_complement\_scalar}} = 1.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02796}02796 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02797}02797     \textcolor{comment}{// Call linear algebra-\/style solver. If the result distribution is wrong,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02798}02798     \textcolor{comment}{// then redistribute before the solve and return to original distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02799}02799     \textcolor{comment}{// afterwards}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02800}02800     \textcolor{keywordflow}{if} ((!(*result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *this-\/>distribution\_pt())) \&\&}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02801}02801         result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02802}02802     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02803}02803       \textcolor{comment}{// Create a temporary copy of the current result distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02804}02804       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} temp\_global\_dist(result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02805}02805 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02806}02806       \textcolor{comment}{// Re-\/build the result vector as an augmented vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02807}02807       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02808}02808 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02809}02809       \textcolor{comment}{// Call the auxilliary helper function to do the actual solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02810}02810       this-\/>\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1ff5a4b43235b43d2254af0db6195dc7}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}}, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02811}02811 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02812}02812       \textcolor{comment}{// Re-\/distribute result vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02813}02813       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&temp\_global\_dist);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02814}02814     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02815}02815     \textcolor{comment}{// Otherwise just solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02816}02816     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02817}02817     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02818}02818       \textcolor{comment}{// Call the auxilliary helper function to do the actual solve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02819}02819       this-\/>\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1ff5a4b43235b43d2254af0db6195dc7}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}}, f, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02820}02820     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02821}02821 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02822}02822     \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02823}02823     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}}) \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_aa4fbf2fd3d7ce466e7ea74620c4bdcea}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02824}02824   \};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02825}02825 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02826}02826   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02827}02827 \textcolor{comment}{  /// \(\backslash\)Short Re-\/solve the system defined by the last assembled Jacobian}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02828}02828 \textcolor{comment}{  /// and the rhs vector specified here. Solution is returned in}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02829}02829 \textcolor{comment}{  /// the vector result.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02830}02830 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02831}\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2a452417f612f30e3ae2a2701fa1e6de}{02831}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2a452417f612f30e3ae2a2701fa1e6de}{AugmentedProblemGMRES::resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02832}02832                                       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02833}02833   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02834}02834     \textcolor{comment}{// We are re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02835}02835     \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1c8bdfdfbba0518cf24ad56970186714}{Resolving}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02836}02836 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02837}02837 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02838}02838     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02839}02839     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02840}02840       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}No matrix was stored -\/-\/ cannot re-\/solve"{}},}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02841}02841                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02842}02842                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02843}02843     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02844}02844 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02845}02845 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02846}02846     \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02847}02847     this-\/>\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a73d8d3d8b161084e6291560cdd7984dc}{solve}}(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a2dd7330c78b780ccc87c0922656a72b2}{Matrix\_pt}}, rhs, result);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02848}02848 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02849}02849     \textcolor{comment}{// Reset re-\/solving flag}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02850}02850     \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1c8bdfdfbba0518cf24ad56970186714}{Resolving}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02851}02851   \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02852}02852 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02853}02853 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02854}02854   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02855}02855 \textcolor{comment}{  /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and rhs vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02856}02856 \textcolor{comment}{  /// and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02857}02857 \textcolor{comment}{  /// based on the algorithm presented in Templates for the}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02858}02858 \textcolor{comment}{  /// Solution of Linear Systems: Building Blocks for Iterative Methods,}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02859}02859 \textcolor{comment}{  /// Barrett, Berry et al, SIAM, 2006 and the implementation in the IML++}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02860}02860 \textcolor{comment}{  /// library : http://math.nist.gov/iml++/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02861}02861 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02862}\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1ff5a4b43235b43d2254af0db6195dc7}{02862}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1ff5a4b43235b43d2254af0db6195dc7}{AugmentedProblemGMRES::solve\_helper}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02863}02863     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& input\_matrix\_pt,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02864}02864     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02865}02865     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& lhs)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02866}02866   \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02867}02867     \textcolor{comment}{// Get number of dofs (in the non-\/augmented problem)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02868}02868     \textcolor{keywordtype}{unsigned} n\_dof = input\_matrix\_pt-\/>\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase_acdcd6e1ea2bf2380f1a2fa32c7829cb5}{nrow}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02869}02869 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02870}02870     \textcolor{comment}{// How many dofs in the augmented problem?}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02871}02871     \textcolor{keywordtype}{unsigned} n\_aug\_dof = n\_dof + 1;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02872}02872 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02873}02873     \textcolor{comment}{// Get a handle to this Problems communicator}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02874}02874     \mbox{\hyperlink{classoomph_1_1OomphCommunicator}{OomphCommunicator}}* comm\_pt = this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2760847d45ab334f6d902efc2620b615}{communicator\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02875}02875 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02876}02876     \textcolor{comment}{// Set up the (non-\/augmented) distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02877}02877     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(comm\_pt, n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02878}02878 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02879}02879     \textcolor{comment}{// Set up the (augmented) distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02880}02880     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} aug\_dist(comm\_pt, n\_aug\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02881}02881 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02882}02882     \textcolor{comment}{// If the input vector doesn't have size N+1 then something has gone wrong}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02883}02883     \textcolor{keywordflow}{if} ((rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof) || (lhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02884}02884     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02885}02885       \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02886}02886       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02887}02887 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02888}02888       \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02889}02889       error\_message\_stream << \textcolor{stringliteral}{"{}RHS vector has "{}} << rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}()}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02890}02890                            << \textcolor{stringliteral}{"{} rows and the "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02891}02891                            << \textcolor{stringliteral}{"{}LHS vector has "{}} << rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}()}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02892}02892                            << \textcolor{stringliteral}{"{} rows but\(\backslash\)nthey "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02893}02893                            << \textcolor{stringliteral}{"{}should both have "{}} << n\_dof << \textcolor{stringliteral}{"{} rows!"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02894}02894                            << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02895}02895 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02896}02896       \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02897}02897       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02898}02898                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02899}02899                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02900}02900     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02901}02901 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02902}02902 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02903}02903     \textcolor{comment}{// PARANOID check that if the matrix is distributable then it should not be}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02904}02904     \textcolor{comment}{// then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02905}02905     \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(input\_matrix\_pt) != 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02906}02906     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02907}02907       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(input\_matrix\_pt)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02908}02908             -\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02909}02909       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02910}02910         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02911}02911         error\_message\_stream << \textcolor{stringliteral}{"{}The matrix must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02912}02912         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02913}02913                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02914}02914                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02915}02915       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02916}02916     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02917}02917     \textcolor{comment}{// PARANOID check that this rhs distribution is setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02918}02918     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02919}02919     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02920}02920       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02921}02921       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector distribution must be setup."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02922}02922       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02923}02923                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02924}02924                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02925}02925     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02926}02926     \textcolor{comment}{// PARANOID check that the rhs is not distributed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02927}02927     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02928}02928     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02929}02929       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02930}02930       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02931}02931       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02932}02932                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02933}02933                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02934}02934     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02935}02935     \textcolor{comment}{// PARANOID check that if the result is setup it matches the distribution}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02936}02936     \textcolor{comment}{// of the rhs}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02937}02937     \textcolor{keywordflow}{if} (lhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02938}02938     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02939}02939       \textcolor{keywordflow}{if} (!(*rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *lhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02940}02940       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02941}02941         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02942}02942         error\_message\_stream << \textcolor{stringliteral}{"{}If the result distribution is setup then it "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02943}02943                                 \textcolor{stringliteral}{"{}must be the same as the "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02944}02944                              << \textcolor{stringliteral}{"{}rhs distribution"{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02945}02945         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02946}02946                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02947}02947                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02948}02948       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02949}02949     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02950}02950 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02951}02951 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02952}02952     \textcolor{comment}{// Set up the solution if it is not}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02953}02953     \textcolor{keywordflow}{if} (!lhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02954}02954     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02955}02955       \textcolor{comment}{// Use the augmented distribution which has size N+1 (not the solvers}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02956}02956       \textcolor{comment}{// distribution which has size N)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02957}02957       lhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02958}02958     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02959}02959     \textcolor{comment}{// Otherwise initialise to zero}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02960}02960     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02961}02961     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02962}02962       lhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02963}02963     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02964}02964 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02965}02965     \textcolor{comment}{// Create a vector to store the augmented LHS vector entries}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02966}02966     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} solution(aug\_dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02967}02967 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02968}02968     \textcolor{comment}{// Time solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02969}02969     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02970}02970 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02971}02971     \textcolor{comment}{// Relative residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02972}02972     \textcolor{keywordtype}{double} resid;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02973}02973 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02974}02974     \textcolor{comment}{// Iteration counter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02975}02975     \textcolor{keywordtype}{unsigned} iter = 1;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02976}02976 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02977}02977     \textcolor{comment}{// if not using iteration restart set Restart to n\_aug\_dof}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02978}02978     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a447c3077e0763deb70e7e9ac34748d74}{Iteration\_restart}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02979}02979     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02980}02980       \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a472af506241c412c2a6fe4c53529118e}{Restart}} = n\_aug\_dof;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02981}02981     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02982}02982 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02983}02983     \textcolor{comment}{// initialise vectors}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02984}02984     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a472af506241c412c2a6fe4c53529118e}{Restart}} + 1, 0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02985}02985     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} cs(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a472af506241c412c2a6fe4c53529118e}{Restart}} + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02986}02986     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} sn(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a472af506241c412c2a6fe4c53529118e}{Restart}} + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02987}02987     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} w(aug\_dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02988}02988 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02989}02989     \textcolor{comment}{// Set up the preconditioner only if we're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02990}02990     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1c8bdfdfbba0518cf24ad56970186714}{Resolving}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02991}02991     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02992}02992       \textcolor{comment}{// Only setup the preconditioner before solve if require}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02993}02993       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_af0344cc8a3a850f160973f1d44bf20f2}{Setup\_preconditioner\_before\_solve}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02994}02994       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02995}02995         \textcolor{comment}{// Setup preconditioner from the Jacobian matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02996}02996         \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02997}02997 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02998}02998         \textcolor{comment}{// Do not setup}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l02999}02999         \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4ae617ce8304f17bd42f4dc39813e22}{preconditioner\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Preconditioner_a0b95e7159585b5151f9e5dc1d1713655}{setup}}(input\_matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03000}03000 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03001}03001         \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03002}03002         \textcolor{keywordtype}{double} t\_end\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03003}03003         \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a8022e90c9c7c720a0bacf9d090c81a10}{Preconditioner\_setup\_time}} = t\_end\_prec -\/ t\_start\_prec;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03004}03004 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03005}03005         \textcolor{comment}{// If we're meant to document timings}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03006}03006         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03007}03007         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03008}03008           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of preconditioner [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03009}03009                      << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a8022e90c9c7c720a0bacf9d090c81a10}{Preconditioner\_setup\_time}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03010}03010         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03011}03011       \} \textcolor{comment}{// if (Setup\_preconditioner\_before\_solve)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03012}03012     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03013}03013     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03014}03014     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03015}03015       \textcolor{comment}{// If we're meant to document timings}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03016}03016       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03017}03017       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03018}03018         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Setup of preconditioner is bypassed in resolve mode"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03019}03019                    << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03020}03020       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03021}03021     \} \textcolor{comment}{// if (!Resolving)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03022}03022 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03023}03023     \textcolor{comment}{// The default system matrix is simply the one that was passed in}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03024}03024     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* matrix\_pt = \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(input\_matrix\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03025}03025 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03026}03026     \textcolor{comment}{// Storage for the time taken for all preconditioner applications}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03027}03027     \textcolor{keywordtype}{double} t\_prec\_application\_total = 0.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03028}03028 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03029}03029     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03030}03030     \textcolor{comment}{// Compute the scalar component of the diagonal Schur complement}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03031}03031     \textcolor{comment}{// preconditioner. NOTE: Only compute it if it is currently set}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03032}03032     \textcolor{comment}{// to the default value of unity. It's quite unlikely that it}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03033}03033     \textcolor{comment}{// will actually have value one (up to machine precision) in}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03034}03034     \textcolor{comment}{// practice. This check ensures that we only compute the value}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03035}03035     \textcolor{comment}{// during the solve function and not during the resolve.}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03036}03036     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03037}03037     \textcolor{comment}{// If the Schur complement value has its default value of one}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03038}03038     \textcolor{keywordflow}{if} (std::fabs(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a837e46fe93f07fa0740b5a7a9f40ebcb}{Schur\_complement\_scalar}} -\/ 1.0) < 1.0e-\/14)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03039}03039     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03040}03040       \textcolor{comment}{// If the bordering vectors haven't actually been properly created}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03041}03041       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_aaab9daf6e2eb2bae858f48027754a93e}{B\_pt}} == 0) || (\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1f483fcae38f24ceda96c111333ebd2b}{C\_pt}} == 0))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03042}03042       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03043}03043         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03044}03044         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Bordering vectors have not been created!"{}},}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03045}03045                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03046}03046                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03047}03047       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03048}03048       \textcolor{comment}{// Make sure the bordering vectors have the right size}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03049}03049       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_aaab9daf6e2eb2bae858f48027754a93e}{B\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof) || (\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1f483fcae38f24ceda96c111333ebd2b}{C\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03050}03050       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03051}03051         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03052}03052         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Bordering vectors do not have the right size!"{}},}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03053}03053                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03054}03054                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03055}03055       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03056}03056 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03057}03057       \textcolor{comment}{// Allocate storage for A\string^\{-\/1\}b}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03058}03058       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} a\_inv\_b(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03059}03059 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03060}03060       \textcolor{comment}{// Compute A\string^\{-\/1\}b with the preconditioner approximation to A\string^\{-\/1\}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03061}03061       \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4ae617ce8304f17bd42f4dc39813e22}{preconditioner\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Preconditioner_ace1199369e4465cd2b9a34884bb64ec8}{preconditioner\_solve}}(*\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_aaab9daf6e2eb2bae858f48027754a93e}{B\_pt}}, a\_inv\_b);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03062}03062 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03063}03063       \textcolor{comment}{// Now compute the scalar component of the Schur complement preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03064}03064       \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a837e46fe93f07fa0740b5a7a9f40ebcb}{Schur\_complement\_scalar}} = \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a1f483fcae38f24ceda96c111333ebd2b}{C\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(a\_inv\_b);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03065}03065 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03066}03066       \textcolor{comment}{// If the Schur complement scalar value is pratically zero or is NaN}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03067}03067       \textcolor{keywordflow}{if} ((std::fabs(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a837e46fe93f07fa0740b5a7a9f40ebcb}{Schur\_complement\_scalar}}) < 1.0e-\/14) ||}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03068}03068           std::isnan(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a837e46fe93f07fa0740b5a7a9f40ebcb}{Schur\_complement\_scalar}}))}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03069}03069       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03070}03070         \textcolor{comment}{// Reset it to have value 2.0 (not 1.0 otherwise we would end up}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03071}03071         \textcolor{comment}{// recomputing it every resolve) as we "{}should"{} be able to use}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03072}03072         \textcolor{comment}{// any scalar value and end up with the same number of distinct}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03073}03073         \textcolor{comment}{// eigenvalues for the preconditioned system).}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03074}03074         \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a837e46fe93f07fa0740b5a7a9f40ebcb}{Schur\_complement\_scalar}} = 2.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03075}03075       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03076}03076     \} \textcolor{comment}{// if (std::fabs(Schur\_complement\_scalar-\/1.0)<1.0e-\/14)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03077}03077 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03078}03078     \textcolor{comment}{// Storage for the augmented RHS vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03079}03079     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} rhs\_aug(aug\_dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03080}03080 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03081}03081     \textcolor{comment}{// Loop over the first n\_dof entries of the RHS vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03082}03082     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03083}03083     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03084}03084       \textcolor{comment}{// Copy the i-\/th entry over}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03085}03085       rhs\_aug[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03086}03086     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03087}03087 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03088}03088     \textcolor{comment}{// Update the RHS entry associated with the augmented equation}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03089}03089     rhs\_aug[n\_dof] = (*Rhs\_pt);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03090}03090 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03091}03091     \textcolor{comment}{// Storage for b-\/Jx=Mr for r (assumes x = 0);}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03092}03092     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} r(aug\_dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03093}03093 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03094}03094     \textcolor{comment}{// If we're using LHS preconditioning}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03095}03095     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_ab32f761ac00fb98acfc66f07a62932c9}{Preconditioner\_LHS}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03096}03096     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03097}03097       \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03098}03098       \textcolor{keywordtype}{double} t\_prec\_application\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03099}03099 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03100}03100       \textcolor{comment}{// Use the helper function to apply the Schur complement preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03101}03101       \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a71199dc59da3f5077803829e36ad4aec}{apply\_schur\_complement\_preconditioner}}(rhs\_aug, r);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03102}03102 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03103}03103       \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03104}03104       \textcolor{keywordtype}{double} t\_prec\_application\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03105}03105 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03106}03106       \textcolor{comment}{// Update the preconditioner application time total}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03107}03107       t\_prec\_application\_total +=}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03108}03108         (t\_prec\_application\_end -\/ t\_prec\_application\_start);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03109}03109     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03110}03110     \textcolor{comment}{// If we're using RHS preconditioning}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03111}03111     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03112}03112     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03113}03113       \textcolor{comment}{// We don't need to do any preconditioning here; just copy the vector over}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03114}03114       r = rhs\_aug;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03115}03115     \} \textcolor{comment}{// if (Preconditioner\_LHS)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03116}03116 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03117}03117     \textcolor{comment}{// Compute the norm of the RHS vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03118}03118     \textcolor{keywordtype}{double} normb = r.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03119}03119 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03120}03120     \textcolor{comment}{// Set beta (the initial residual)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03121}03121     \textcolor{keywordtype}{double} beta = normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03122}03122 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03123}03123     \textcolor{comment}{// If the RHS vector is (numerically equivalent to) the zero vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03124}03124     \textcolor{keywordflow}{if} (normb == 0.0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03125}03125     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03126}03126       \textcolor{comment}{// Initialise the norm of b as unity}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03127}03127       normb = 1.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03128}03128     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03129}03129 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03130}03130     \textcolor{comment}{// Compute the relative residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03131}03131     resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03132}03132 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03133}03133     \textcolor{comment}{// If required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03134}03134     \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03135}03135     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_aeb0fbe103e721196232260230abb1997}{Doc\_convergence\_history}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03136}03136     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03137}03137       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4d6766bec67399c29392e6540b91dd9}{Output\_file\_stream}}.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03138}03138       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03139}03139         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03140}03140       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03141}03141       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03142}03142       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03143}03143         \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4d6766bec67399c29392e6540b91dd9}{Output\_file\_stream}} << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03144}03144       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03145}03145     \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03146}03146 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03147}03147     \textcolor{comment}{// If GMRES converges immediately}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03148}03148     \textcolor{keywordflow}{if} (resid <= \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a46dd6b0243c734a77afce3c44cf4597d}{Tolerance}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03149}03149     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03150}03150       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03151}03151       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03152}03152         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}AugmentedProblemGMRES converged immediately. Normalised "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03153}03153                    << \textcolor{stringliteral}{"{}residual norm: "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03154}03154       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03155}03155 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03156}03156       \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03157}03157       \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03158}03158       \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ab90d7e7780e709946dd0540a146186b5}{Solution\_time}} = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03159}03159 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03160}03160       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03161}03161       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03162}03162         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03163}03163           << \textcolor{stringliteral}{"{}Time for all preconditioner applications [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03164}03164           << t\_prec\_application\_total}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03165}03165           << \textcolor{stringliteral}{"{}\(\backslash\)nTotal time for solve with AugmentedProblemGMRES [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03166}03166           << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ab90d7e7780e709946dd0540a146186b5}{Solution\_time}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03167}03167       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03168}03168 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03169}03169       \textcolor{comment}{// We're done so finish here}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03170}03170       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03171}03171     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03172}03172 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03173}03173     \textcolor{comment}{// initialise vector of orthogonal basis vectors (v) and upper hessenberg}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03174}03174     \textcolor{comment}{// matrix H}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03175}03175     \textcolor{comment}{// NOTE: for implementation purpose the upper hessenberg matrix indexes are}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03176}03176     \textcolor{comment}{// are swapped so the matrix is effectively transposed}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03177}03177     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} v;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03178}03178     v.resize(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a472af506241c412c2a6fe4c53529118e}{Restart}} + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03179}03179     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<double>}}> H(\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a472af506241c412c2a6fe4c53529118e}{Restart}} + 1);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03180}03180 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03181}03181     \textcolor{comment}{// while...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03182}03182     \textcolor{keywordflow}{while} (iter <= \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a9bdc42768d009b093fd7bc23647dc989}{Max\_iter}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03183}03183     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03184}03184       \textcolor{comment}{// Copy the values of r into the zeroth basis vector v[0]}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03185}03185       v[0] = r;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03186}03186 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03187}03187       \textcolor{comment}{// Now scale it so the zeroth basis vector v[0] is r/beta}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03188}03188       v[0] /= beta;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03189}03189 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03190}03190       \textcolor{comment}{// Set the first entry of s}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03191}03191       \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0] = beta;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03192}03192 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03193}03193       \textcolor{comment}{// Counter for the inner iteration counter (restarted version)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03194}03194       \textcolor{keywordtype}{unsigned} iter\_restart = 0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03195}03195 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03196}03196       \textcolor{comment}{// Start performing iterations}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03197}03197       \textcolor{keywordflow}{for} (iter\_restart = 0; iter\_restart < \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a472af506241c412c2a6fe4c53529118e}{Restart}} \&\& iter <= \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a9bdc42768d009b093fd7bc23647dc989}{Max\_iter}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03198}03198            iter\_restart++, iter++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03199}03199       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03200}03200         \textcolor{comment}{// Resize next column of upper hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03201}03201         H[iter\_restart].resize(iter\_restart + 2);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03202}03202 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03203}03203         \textcolor{comment}{// solve Jv[i] = Mw for w}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03204}03204         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03205}03205           \textcolor{comment}{// Allocate space for the product J*v[i]}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03206}03206           \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(aug\_dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03207}03207 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03208}03208           \textcolor{comment}{// If we're using LHS preconditioning}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03209}03209           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_ab32f761ac00fb98acfc66f07a62932c9}{Preconditioner\_LHS}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03210}03210           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03211}03211             \textcolor{comment}{// Compute J*v[i] where J is now the augmented system matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03212}03212             \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a98bde93ede0909eb0170ef490c6d184d}{augmented\_matrix\_multiply}}(matrix\_pt, v[iter\_restart], temp);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03213}03213 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03214}03214             \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03215}03215             \textcolor{keywordtype}{double} t\_prec\_application\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03216}03216 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03217}03217             \textcolor{comment}{// Use the helper function to apply the Schur complement}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03218}03218             \textcolor{comment}{// preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03219}03219             \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a71199dc59da3f5077803829e36ad4aec}{apply\_schur\_complement\_preconditioner}}(temp, w);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03220}03220 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03221}03221             \textcolor{comment}{// End timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03222}03222             \textcolor{keywordtype}{double} t\_prec\_application\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03223}03223 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03224}03224             \textcolor{comment}{// Update the preconditioner application time total}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03225}03225             t\_prec\_application\_total +=}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03226}03226               (t\_prec\_application\_end -\/ t\_prec\_application\_start);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03227}03227           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03228}03228           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03229}03229           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03230}03230             \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03231}03231             \textcolor{keywordtype}{double} t\_prec\_application\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03232}03232 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03233}03233             \textcolor{comment}{// Compute w=JM\string^\{-\/1\}v by saad p270}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03234}03234             \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a71199dc59da3f5077803829e36ad4aec}{apply\_schur\_complement\_preconditioner}}(v[iter\_restart], temp);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03235}03235 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03236}03236             \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03237}03237             \textcolor{keywordtype}{double} t\_prec\_application\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03238}03238 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03239}03239             \textcolor{comment}{// Update the preconditioner application time total}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03240}03240             t\_prec\_application\_total +=}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03241}03241               (t\_prec\_application\_end -\/ t\_prec\_application\_start);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03242}03242 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03243}03243             \textcolor{comment}{// Calculate w=Jv\_m where v\_m=M\string^\{-\/1\}v}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03244}03244             \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a98bde93ede0909eb0170ef490c6d184d}{augmented\_matrix\_multiply}}(matrix\_pt, temp, w);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03245}03245           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03246}03246         \} \textcolor{comment}{// Solve Jv[i]=Mw for w}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03247}03247 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03248}03248         \textcolor{comment}{// Get a pointer to the entries of w}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03249}03249         \textcolor{keywordtype}{double}* w\_pt = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03250}03250 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03251}03251         \textcolor{comment}{// Loop over the rows of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03252}03252         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k <= iter\_restart; k++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03253}03253         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03254}03254           \textcolor{comment}{// Compute the (k,iter\_restart)-\/th entry of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03255}03255           \textcolor{comment}{// (which is stored in its transposed form)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03256}03256           H[iter\_restart][k] = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(v[k]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03257}03257 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03258}03258           \textcolor{comment}{// Get a pointer to the entries of the k-\/th basis vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03259}03259           \textcolor{keywordtype}{double}* vk\_pt = v[k].values\_pt();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03260}03260 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03261}03261           \textcolor{comment}{// Loop over the entries of w}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03262}03262           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_aug\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03263}03263           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03264}03264             \textcolor{comment}{// Update the i-\/th entry of w}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03265}03265             w\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/= H[iter\_restart][k] * vk\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03266}03266           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03267}03267         \} \textcolor{comment}{// for (unsigned k=0;k<=iter\_restart;k++)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03268}03268 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03269}03269         \textcolor{comment}{// Calculate the subdiagonal Hessenberg entry}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03270}03270         H[iter\_restart][iter\_restart + 1] = w.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03271}03271 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03272}03272         \textcolor{comment}{// Copy the entries of w into the next basis vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03273}03273         v[iter\_restart + 1] = w;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03274}03274 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03275}03275         \textcolor{comment}{// Now normalise the basis vector with the appropriate Hessenberg entry}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03276}03276         v[iter\_restart + 1] /= H[iter\_restart][iter\_restart + 1];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03277}03277 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03278}03278         \textcolor{comment}{// Loop over the rows of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03279}03279         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < iter\_restart; k++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03280}03280         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03281}03281           \textcolor{comment}{// Apply a Givens rotation to the appropriate entries of H}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03282}03282           \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a175361cb4600f20511213636f2e645ce}{apply\_plane\_rotation}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03283}03283             H[iter\_restart][k], H[iter\_restart][k + 1], cs[k], sn[k]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03284}03284         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03285}03285 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03286}03286         \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a74bb2d9ceab6473c1922b166ebf48681}{generate\_plane\_rotation}}(H[iter\_restart][iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03287}03287                                 H[iter\_restart][iter\_restart + 1],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03288}03288                                 cs[iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03289}03289                                 sn[iter\_restart]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03290}03290         \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a175361cb4600f20511213636f2e645ce}{apply\_plane\_rotation}}(H[iter\_restart][iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03291}03291                              H[iter\_restart][iter\_restart + 1],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03292}03292                              cs[iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03293}03293                              sn[iter\_restart]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03294}03294         \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a175361cb4600f20511213636f2e645ce}{apply\_plane\_rotation}}(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03295}03295                              \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[iter\_restart + 1],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03296}03296                              cs[iter\_restart],}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03297}03297                              sn[iter\_restart]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03298}03298 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03299}03299         \textcolor{comment}{// Compute the current residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03300}03300         beta = std::fabs(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[iter\_restart + 1]);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03301}03301 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03302}03302         \textcolor{comment}{// compute relative residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03303}03303         resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03304}03304 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03305}03305         \textcolor{comment}{// DRAIG: Delete...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03306}03306         \textcolor{comment}{// oomph\_info << "{}Residual at iteration "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03307}03307         \textcolor{comment}{//       << iter << "{}: "{} << resid << std::endl;}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03308}03308 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03309}03309         \textcolor{comment}{// if required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03310}03310         \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03311}03311         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_aeb0fbe103e721196232260230abb1997}{Doc\_convergence\_history}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03312}03312         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03313}03313           \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4d6766bec67399c29392e6540b91dd9}{Output\_file\_stream}}.is\_open())}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03314}03314           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03315}03315             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << iter << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03316}03316           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03317}03317           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03318}03318           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03319}03319             \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4d6766bec67399c29392e6540b91dd9}{Output\_file\_stream}} << iter << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03320}03320           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03321}03321         \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03322}03322 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03323}03323         \textcolor{comment}{// If required tolerance found}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03324}03324         \textcolor{keywordflow}{if} (resid < \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a46dd6b0243c734a77afce3c44cf4597d}{Tolerance}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03325}03325         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03326}03326           \textcolor{comment}{// update result vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03327}03327           \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_ab7513cfa22054fa1bff319c72aac8313}{update}}(iter\_restart, H, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, v, solution);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03328}03328 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03329}03329           \textcolor{comment}{// Loop over the first n\_dof entries of the RHS vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03330}03330           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03331}03331           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03332}03332             \textcolor{comment}{// Copy the i-\/th entry over}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03333}03333             lhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = solution[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03334}03334           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03335}03335 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03336}03336           \textcolor{comment}{// Update the bifurcation parameter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03337}03337           (*X\_pt) -\/= solution[n\_dof];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03338}03338 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03339}03339           \textcolor{comment}{// If we're meant to document convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03340}03340           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03341}03341           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03342}03342             \textcolor{comment}{// Output the convergence to screen}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03343}03343             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nAugmentedProblemGMRES converged (1). Normalised "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03344}03344                        << \textcolor{stringliteral}{"{}residual norm: "{}} << resid}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03345}03345                        << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of iterations "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03346}03346                        << \textcolor{stringliteral}{"{}to convergence: "{}} << iter << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03347}03347                        << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03348}03348           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03349}03349 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03350}03350           \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03351}03351           \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03352}03352           \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ab90d7e7780e709946dd0540a146186b5}{Solution\_time}} = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03353}03353 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03354}03354           \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a9be7f8a66aefc1352e95741c5f265443}{Iterations}} = iter;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03355}03355 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03356}03356           \textcolor{comment}{// If we're meant to document convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03357}03357           \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03358}03358           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03359}03359             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03360}03360               << \textcolor{stringliteral}{"{}Time for all preconditioner applications [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03361}03361               << t\_prec\_application\_total}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03362}03362               << \textcolor{stringliteral}{"{}\(\backslash\)nTotal time for solve with AugmentedProblemGMRES  [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03363}03363               << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ab90d7e7780e709946dd0540a146186b5}{Solution\_time}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03364}03364           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03365}03365 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03366}03366           \textcolor{comment}{// We're done now so jump out here}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03367}03367           \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03368}03368         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03369}03369 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03370}03370         \textcolor{comment}{// If the tolerance wasn't met}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03371}03371         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03372}03372         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03373}03373           \textcolor{comment}{// Warn the user if the sub-\/diagonal Hessenberg entry was almost}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03374}03374           \textcolor{comment}{// zero...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03375}03375           \textcolor{keywordflow}{if} (std::fabs(H[iter\_restart][iter\_restart + 1]) < 1.0e-\/12)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03376}03376           \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03377}03377             \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03378}03378             std::ostringstream warning\_message\_stream;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03379}03379 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03380}03380             \textcolor{comment}{// Create the warning message}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03381}03381             warning\_message\_stream << \textcolor{stringliteral}{"{}Hessenberg subdiagonal entry (="{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03382}03382                                    << H[iter\_restart][iter\_restart + 1]}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03383}03383                                    << \textcolor{stringliteral}{"{}) almost zero at iteration "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03384}03384                                    << iter\_restart << \textcolor{stringliteral}{"{}\(\backslash\)nbut residual "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03385}03385                                    << \textcolor{stringliteral}{"{}is only "{}} << resid << \textcolor{stringliteral}{"{} which does "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03386}03386                                    << \textcolor{stringliteral}{"{}not meet the tolerance ("{}} << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a46dd6b0243c734a77afce3c44cf4597d}{Tolerance}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03387}03387                                    << \textcolor{stringliteral}{"{})!"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03388}03388 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03389}03389             \textcolor{comment}{// Warn the user}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03390}03390             \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(warning\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03391}03391                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03392}03392                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03393}03393           \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03394}03394         \} \textcolor{comment}{// if (resid<Tolerance)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03395}03395 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03396}03396       \} \textcolor{comment}{// for (iter\_restart=0;iter\_restart<Restart\&\&iter<=Max\_iter;...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03397}03397 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03398}03398       \textcolor{comment}{// If we're not on the first iteration}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03399}03399       \textcolor{keywordflow}{if} (iter\_restart > 0)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03400}03400       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03401}03401         \textcolor{comment}{// Do an update}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03402}03402         \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_ab7513cfa22054fa1bff319c72aac8313}{update}}((iter\_restart -\/ 1), H, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, v, solution);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03403}03403       \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03404}03404 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03405}03405       \textcolor{comment}{// Solve Mr = (b-\/Jx) for r}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03406}03406       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03407}03407         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(aug\_dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03408}03408         \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a98bde93ede0909eb0170ef490c6d184d}{augmented\_matrix\_multiply}}(matrix\_pt, solution, temp);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03409}03409         \textcolor{keywordtype}{double}* temp\_pt = temp.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03410}03410         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* rhs\_pt = rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_ae3484a5eb4cb663e09640806ef1bf05a}{values\_pt}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03411}03411         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03412}03412         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03413}03413           \textcolor{comment}{// Update the i-\/th entry of temp to be b-\/Jx}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03414}03414           temp\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ temp\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03415}03415         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03416}03416 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03417}03417         \textcolor{comment}{// If we're using LHS preconditioning}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03418}03418         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_ab32f761ac00fb98acfc66f07a62932c9}{Preconditioner\_LHS}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03419}03419         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03420}03420           \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03421}03421           \textcolor{keywordtype}{double} t\_prec\_application\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03422}03422 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03423}03423           \textcolor{comment}{// Use the helper function to apply the Schur complement}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03424}03424           \textcolor{comment}{// preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03425}03425           \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a71199dc59da3f5077803829e36ad4aec}{apply\_schur\_complement\_preconditioner}}(temp, r);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03426}03426 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03427}03427           \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03428}03428           \textcolor{keywordtype}{double} t\_prec\_application\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03429}03429 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03430}03430           \textcolor{comment}{// Update the preconditioner application time total}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03431}03431           t\_prec\_application\_total +=}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03432}03432             (t\_prec\_application\_end -\/ t\_prec\_application\_start);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03433}03433         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03434}03434       \} \textcolor{comment}{// Solve Mr = (b-\/Jx) for r}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03435}03435 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03436}03436       \textcolor{comment}{// Compute the current residual}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03437}03437       beta = r.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03438}03438 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03439}03439       \textcolor{comment}{// if relative residual within tolerance}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03440}03440       resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03441}03441       \textcolor{keywordflow}{if} (resid < \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a46dd6b0243c734a77afce3c44cf4597d}{Tolerance}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03442}03442       \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03443}03443         \textcolor{comment}{// If we're meant to document convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03444}03444         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03445}03445         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03446}03446           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nAugmentedProblemGMRES converged (2). Normalised "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03447}03447                      << \textcolor{stringliteral}{"{}residual norm: "{}} << resid << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of iterations "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03448}03448                      << \textcolor{stringliteral}{"{}to convergence: "{}} << iter << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03449}03449                      << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03450}03450         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03451}03451 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03452}03452         \textcolor{comment}{// Loop over the first n\_dof entries of the RHS vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03453}03453         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03454}03454         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03455}03455           \textcolor{comment}{// Copy the i-\/th entry over}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03456}03456           lhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = solution[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03457}03457         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03458}03458 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03459}03459         \textcolor{comment}{// Update the bifurcation parameter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03460}03460         (*X\_pt) -\/= solution[n\_dof];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03461}03461 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03462}03462         \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03463}03463         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03464}03464         \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ab90d7e7780e709946dd0540a146186b5}{Solution\_time}} = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03465}03465 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03466}03466         \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a9be7f8a66aefc1352e95741c5f265443}{Iterations}} = iter;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03467}03467 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03468}03468         \textcolor{comment}{// If we're meant to document convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03469}03469         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03470}03470         \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03471}03471           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03472}03472             << \textcolor{stringliteral}{"{}Time for all preconditioner applications [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03473}03473             << t\_prec\_application\_total}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03474}03474             << \textcolor{stringliteral}{"{}\(\backslash\)nTotal time for solve with AugmentedProblemGMRES [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03475}03475             << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ab90d7e7780e709946dd0540a146186b5}{Solution\_time}} << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03476}03476         \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03477}03477 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03478}03478         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03479}03479       \} \textcolor{comment}{// if (resid<Tolerance)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03480}03480     \} \textcolor{comment}{// while (iter<=Max\_iter)}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03481}03481 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03482}03482     \textcolor{comment}{// DRAIG: Delete...}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03483}03483     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03484}03484       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(aug\_dist, 0.0);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03485}03485       \mbox{\hyperlink{classoomph_1_1AugmentedProblemGMRES_a98bde93ede0909eb0170ef490c6d184d}{augmented\_matrix\_multiply}}(matrix\_pt, solution, temp);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03486}03486       temp *= -\/1.0;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03487}03487       temp += rhs;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03488}03488       resid = temp.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}() / normb;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03489}03489     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03490}03490 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03491}03491     \textcolor{comment}{// Loop over the first n\_dof entries of the RHS vector}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03492}03492     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03493}03493     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03494}03494       \textcolor{comment}{// Copy the i-\/th entry over}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03495}03495       lhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = solution[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03496}03496     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03497}03497 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03498}03498     \textcolor{comment}{// Update the bifurcation parameter}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03499}03499     (*X\_pt) -\/= solution[n\_dof];}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03500}03500 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03501}03501     \textcolor{comment}{// Otherwise AugmentedProblemGMRES failed convergence}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03502}03502     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nAugmentedProblemGMRES did not converge to required "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03503}03503                << \textcolor{stringliteral}{"{}tolerance!\(\backslash\)nReturning with normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03504}03504                << resid << \textcolor{stringliteral}{"{}\(\backslash\)nafter "{}} << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a9bdc42768d009b093fd7bc23647dc989}{Max\_iter}} << \textcolor{stringliteral}{"{} iterations.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03505}03505                << std::endl;}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03506}03506 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03507}03507     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a76284ada37aafb9ab39836907569c7b2}{Throw\_error\_after\_max\_iter}})}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03508}03508     \{}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03509}03509       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message\_string = \textcolor{stringliteral}{"{}Solver failed to converge and you "{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03510}03510       error\_message\_string += \textcolor{stringliteral}{"{}requested an error on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03511}03511       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03512}03512         error\_message\_string, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03513}03513     \}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03514}03514 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03515}03515     \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03516}03516   \} \textcolor{comment}{// End AugmentedProblemGMRES}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03517}03517 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03518}03518 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03519}03519   \textcolor{comment}{// Ensure build of required objects}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03520}03520   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1BiCGStab}{BiCGStab<CCDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03521}03521   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1BiCGStab}{BiCGStab<CRDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03522}03522   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1BiCGStab}{BiCGStab<DenseDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03523}03523 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03524}03524   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1CG}{CG<CCDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03525}03525   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1CG}{CG<CRDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03526}03526   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1CG}{CG<DenseDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03527}03527 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03528}03528   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1GS}{GS<CCDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03529}03529   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1GS_3_01CRDoubleMatrix_01_4}{GS<CRDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03530}03530   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1GS}{GS<DenseDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03531}03531 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03532}03532   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1DampedJacobi}{DampedJacobi<CCDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03533}03533   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1DampedJacobi}{DampedJacobi<CRDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03534}03534   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1DampedJacobi}{DampedJacobi<DenseDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03535}03535 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03536}03536   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1GMRES}{GMRES<CCDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03537}03537   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1GMRES}{GMRES<CRDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03538}03538   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1GMRES}{GMRES<DenseDoubleMatrix>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03539}03539 }
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03540}03540   \textcolor{comment}{// Solvers for SumOfMatrices class}}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03541}03541   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1BiCGStab}{BiCGStab<SumOfMatrices>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03542}03542   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1CG}{CG<SumOfMatrices>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03543}03543   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1GS}{GS<SumOfMatrices>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03544}03544   \textcolor{keyword}{template} \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1GMRES}{GMRES<SumOfMatrices>}};}
\DoxyCodeLine{\Hypertarget{iterative__linear__solver_8cc_source_l03545}03545 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
