\hypertarget{assembly__handler_8cc_source}{}\doxysection{assembly\+\_\+handler.\+cc}
\label{assembly__handler_8cc_source}\index{assembly\_handler.cc@{assembly\_handler.cc}}
\mbox{\hyperlink{assembly__handler_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2022 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00026}00026 \textcolor{comment}{// OOOMPH-\/LIB includes}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00027}00027 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{assembly__handler_8h}{assembly\_handler.h}}"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00028}00028 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{elements_8h}{elements.h}}"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00029}00029 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{problem_8h}{problem.h}}"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00030}00030 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{mesh_8h}{mesh.h}}"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00032}00032 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00033}00033 \{\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00034}00034 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00035}00035 \textcolor{comment}{}  \textcolor{comment}{// Non-\/inline functions for the AssemblyHandler class}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00036}00036 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00037}00037 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00038}00038   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00039}00039 \textcolor{comment}{  /// Get the number of elemental degrees of freedom. Direct call}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00040}00040 \textcolor{comment}{  /// to the function in the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00041}00041 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00042}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{00042}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{AssemblyHandler::ndof}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00043}00043   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00044}00044     \textcolor{keywordflow}{return} elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00045}00045   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00047}00047   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00048}00048 \textcolor{comment}{  /// Get the vector of dofs in the element elem\_pt at time level t}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00049}00049 \textcolor{comment}{  /// Direct call to the function in the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00050}00050 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00051}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_abfd15243fce76ce8f1ea0248c700a3f4}{00051}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_abfd15243fce76ce8f1ea0248c700a3f4}{AssemblyHandler::dof\_vector}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00052}00052                                    \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00053}00053                                    \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00054}00054   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00055}00055     \textcolor{keywordflow}{return} elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a14f3cf0fbf4f2f7ae45cac6beef398c7}{dof\_vector}}(\mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}}, dof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00056}00056   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00058}00058   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00059}00059 \textcolor{comment}{  /// Get the vector of pointers to dofs in the element elem\_pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00060}00060 \textcolor{comment}{  /// Direct call to the function in the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00061}00061 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00062}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_afe6002d5703a93b3b147de79508c5719}{00062}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_afe6002d5703a93b3b147de79508c5719}{AssemblyHandler::dof\_pt\_vector}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00063}00063                                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double*>}}\& dof\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00064}00064   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00065}00065     \textcolor{keywordflow}{return} elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a773a27189615056c958e8d71f0b5d944}{dof\_pt\_vector}}(dof\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00066}00066   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00067}00067 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00068}00068 \textcolor{comment}{  /// Return the t-\/th level of storage associated with the i-\/th}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00069}00069 \textcolor{comment}{  /// (local) dof stored in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00070}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab61559fc5df46871c1eebd103f7bf08b}{00070}} \textcolor{comment}{}  \textcolor{keywordtype}{double}\& \mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab61559fc5df46871c1eebd103f7bf08b}{AssemblyHandler::local\_problem\_dof}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00071}00071                                              \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00072}00072                                              \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00073}00073   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00074}00074     \textcolor{keywordflow}{return} *(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a8f48134fe83371d3cc3605772e76d043}{dof\_pt}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) + \mbox{\hyperlink{cfortran_8h_af6f0bd3dc13317f895c91323c25c2b8f}{t}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00075}00075   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00076}00076 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00077}00077 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00078}00078   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00079}00079 \textcolor{comment}{  /// Get the global equation number of the local unknown. Direct call}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00080}00080 \textcolor{comment}{  /// to the function in the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00081}00081 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00082}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{00082}}   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{AssemblyHandler::eqn\_number}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00083}00083                                             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ieqn\_local)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00084}00084   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00085}00085     \textcolor{keywordflow}{return} elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00086}00086   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00088}00088   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00089}00089 \textcolor{comment}{  /// Get the residuals by calling the underlying element's residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00090}00090 \textcolor{comment}{  /// directly.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00091}00091 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00092}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a7a6203b0ab90da62b4da2af8a26d08b3}{00092}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a7a6203b0ab90da62b4da2af8a26d08b3}{AssemblyHandler::get\_residuals}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00093}00093                                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00094}00094   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00095}00095     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a53d348ab71c86b53619129a1dd411d30}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00096}00096   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00097}00097 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00098}00098   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00099}00099 \textcolor{comment}{  /// Calculate the elemental Jacobian matrix "{}d equation / d variable"{} by}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00100}00100 \textcolor{comment}{  /// calling the element's get\_jacobian function.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00101}00101 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00102}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ad43c3d8760be0ba6ebee8d82509458e5}{00102}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_ad43c3d8760be0ba6ebee8d82509458e5}{AssemblyHandler::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00103}00103                                      \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00104}00104                                      \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00105}00105   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00106}00106     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(residuals, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00107}00107   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00108}00108 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00109}00109   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00110}00110 \textcolor{comment}{  /// Calculate all desired vectors and matrices that are required by}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00111}00111 \textcolor{comment}{  /// the element by calling the get\_jacobian function}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00112}00112 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00113}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab2e4ee4623116b18245ca90cfe9ba144}{00113}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_ab2e4ee4623116b18245ca90cfe9ba144}{AssemblyHandler::get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00114}00114     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00115}00115     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}>\& vec,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00116}00116     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}>\& matrix)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00117}00117   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00118}00118     \mbox{\hyperlink{classoomph_1_1AssemblyHandler_ad43c3d8760be0ba6ebee8d82509458e5}{get\_jacobian}}(elem\_pt, vec[0], matrix[0]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00119}00119   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00120}00120 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00121}00121   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00122}00122 \textcolor{comment}{  /// Calculate the derivative of the residuals with respect to}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00123}00123 \textcolor{comment}{  /// a parameter, by calling the elemental function}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00124}00124 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00125}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a2ee980ccabe0ad82f98e694eecf270bb}{00125}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a2ee980ccabe0ad82f98e694eecf270bb}{AssemblyHandler::get\_dresiduals\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00126}00126     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00127}00127     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00128}00128     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dres\_dparam)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00129}00129   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00130}00130     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a63bf8f3db94fdb4098ff61fa930a6d40}{get\_dresiduals\_dparameter}}(parameter\_pt, dres\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00131}00131   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00132}00132 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00133}00133 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00134}00134   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00135}00135 \textcolor{comment}{  /// Calculate the derivative of the residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00136}00136 \textcolor{comment}{  /// with respect to a parameter by calling the elemental function}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00137}00137 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00138}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_aefc0c13a65342806c167c5d53f014803}{00138}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_aefc0c13a65342806c167c5d53f014803}{AssemblyHandler::get\_djacobian\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00139}00139     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00140}00140     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00141}00141     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dres\_dparam,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00142}00142     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& djac\_dparam)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00143}00143   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00144}00144     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab92de6f9c750735bc660f0a10f0df44c}{get\_djacobian\_dparameter}}(parameter\_pt, dres\_dparam, djac\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00145}00145   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00146}00146 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00147}00147 \textcolor{comment}{  /// Calculate the product of the Hessian (derivative of Jacobian with}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00148}00148 \textcolor{comment}{  /// respect to all variables) an eigenvector, Y, and}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00149}00149 \textcolor{comment}{  /// other specified vectors, C}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00150}00150 \textcolor{comment}{  /// (d(J\_\{ij\})/d u\_\{k\}) Y\_\{j\} C\_\{k\}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00151}00151 \textcolor{comment}{  /// At the moment the dof pointer is passed in to enable}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00152}00152 \textcolor{comment}{  /// easy calculation of finite difference default}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00153}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a296bef49838d23522bb660c4c5207f03}{00153}} \textcolor{comment}{}  \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a296bef49838d23522bb660c4c5207f03}{AssemblyHandler::get\_hessian\_vector\_products}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00154}00154     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00155}00155     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \textcolor{keyword}{const}\& Y,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00156}00156     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} \textcolor{keyword}{const}\& C,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00157}00157     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& product)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00158}00158   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00159}00159     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a1fbe77c663eefdf38a0c95f62f6e51bb}{get\_hessian\_vector\_products}}(Y, C, product);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00160}00160   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00161}00161 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00162}00162 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00163}00163   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00164}00164 \textcolor{comment}{  /// Return the eigenfunction(s) associated with the bifurcation that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00165}00165 \textcolor{comment}{  /// has been detected in bifurcation tracking problems. Default}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00166}00166 \textcolor{comment}{  /// Broken implementation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00167}00167 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00168}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a3e369ec692c3d36a4a2a8a64dab7fe2b}{00168}}   \textcolor{keywordtype}{double}* \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a3e369ec692c3d36a4a2a8a64dab7fe2b}{AssemblyHandler::bifurcation\_parameter\_pt}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00169}00169 \textcolor{keyword}{  }\{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00170}00170     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00171}00171     error\_stream << \textcolor{stringliteral}{"{}There is no bifurcation parameter associated with the "{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00172}00172                     \textcolor{stringliteral}{"{}current assembly handler.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00173}00173                  << \textcolor{stringliteral}{"{}Eigenfunction are only calculated by the Fold, PitchFork "{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00174}00174                     \textcolor{stringliteral}{"{}and Hopf Handlers"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00175}00175                  << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00176}00176 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00177}00177     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00178}00178       error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00179}00179     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00180}00180   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00181}00181 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00182}00182 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00183}00183   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00184}00184 \textcolor{comment}{  /// Return the eigenfunction(s) associated with the bifurcation that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00185}00185 \textcolor{comment}{  /// has been detected in bifurcation tracking problems. Default}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00186}00186 \textcolor{comment}{  /// Broken implementation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00187}00187 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00188}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a6d614b1b3809d0eb7ceb393e3ae9594f}{00188}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a6d614b1b3809d0eb7ceb393e3ae9594f}{AssemblyHandler::get\_eigenfunction}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& eigenfunction)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00189}00189   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00190}00190     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00191}00191     error\_stream << \textcolor{stringliteral}{"{}There is no eigenfunction associated with the current "{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00192}00192                     \textcolor{stringliteral}{"{}assembly handler.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00193}00193                  << \textcolor{stringliteral}{"{}Eigenfunction are only calculated by the Fold, PitchFork "{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00194}00194                     \textcolor{stringliteral}{"{}and Hopf Handlers"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00195}00195                  << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00196}00196 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00197}00197     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00198}00198       error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00199}00199   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00200}00200 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00201}00201 \textcolor{comment}{  /// ==========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00202}00202 \textcolor{comment}{  /// Compute the inner products of the given vector of pairs of}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00203}00203 \textcolor{comment}{  /// history values over the element. The values of the index in the pair}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00204}00204 \textcolor{comment}{  /// may be the same.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00205}00205 \textcolor{comment}{}  \textcolor{comment}{//===========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00206}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a60c8efc6756825df9cd41389cdeac6cc}{00206}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a60c8efc6756825df9cd41389cdeac6cc}{AssemblyHandler::get\_inner\_products}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00207}00207     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00208}00208     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::pair<unsigned, unsigned>> \textcolor{keyword}{const}\& history\_index,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00209}00209     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& inner\_product)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00210}00210   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00211}00211     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a50091d9dad94bd60d5b6fa6c6e9a6fbc}{get\_inner\_products}}(history\_index, inner\_product);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00212}00212   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00213}00213 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00214}00214   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00215}00215 \textcolor{comment}{  /// Compute the vectors that when taken as a dot product with}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00216}00216 \textcolor{comment}{  /// other history values give the inner product over the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00217}00217 \textcolor{comment}{  /// In other words if we call get\_inner\_product\_vectors(\{0,1\},output)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00218}00218 \textcolor{comment}{  /// output[0] will be a vector such that dofs.output[0] gives the inner}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00219}00219 \textcolor{comment}{  /// product of current dofs with themselves.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00220}00220 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00221}\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a2300910f43476551318d74e3a90e7713}{00221}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AssemblyHandler_a2300910f43476551318d74e3a90e7713}{AssemblyHandler::get\_inner\_product\_vectors}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00222}00222     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00223}00223     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<unsigned>}} \textcolor{keyword}{const}\& history\_index,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00224}00224     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}>\& inner\_product\_vector)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00225}00225   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00226}00226     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a464659c067a0bdd21f3314491a429381}{get\_inner\_product\_vectors}}(history\_index, inner\_product\_vector);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00227}00227   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00228}00228 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00229}00229 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00230}00230 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00231}00231 \textcolor{comment}{}  \textcolor{comment}{// Non-\/inline functions for the ExplicitTimeStepHandler class}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00232}00232 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00233}00233 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00235}00235   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00236}00236 \textcolor{comment}{  /// Get the number of elemental degrees of freedom. Direct call}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00237}00237 \textcolor{comment}{  /// to the function in the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00238}00238 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00239}\mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_a723bec764e9e59025f052f6ca0135181}{00239}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_a723bec764e9e59025f052f6ca0135181}{ExplicitTimeStepHandler::ndof}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00240}00240   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00241}00241     \textcolor{keywordflow}{return} elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00242}00242   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00243}00243 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00244}00244   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00245}00245 \textcolor{comment}{  /// Get the global equation number of the local unknown. Direct call}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00246}00246 \textcolor{comment}{  /// to the function in the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00247}00247 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00248}\mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_a491d39988264739332c3e9c7dbb38344}{00248}}   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_a491d39988264739332c3e9c7dbb38344}{ExplicitTimeStepHandler::eqn\_number}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00249}00249     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ieqn\_local)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00250}00250   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00251}00251     \textcolor{keywordflow}{return} elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00252}00252   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00253}00253 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00254}00254   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00255}00255 \textcolor{comment}{  /// Call the element's residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00256}00256 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00257}\mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_aef8ab1b61aef072b2bcb061dd287a00f}{00257}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_aef8ab1b61aef072b2bcb061dd287a00f}{ExplicitTimeStepHandler::get\_residuals}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00258}00258     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00259}00259   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00260}00260     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a53d348ab71c86b53619129a1dd411d30}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00261}00261   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00262}00262 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00263}00263   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00264}00264 \textcolor{comment}{  /// Replace get jacobian with the call to get the mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00265}00265 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00266}\mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_ad2c849833e4b35199a79d9d9965af32f}{00266}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_ad2c849833e4b35199a79d9d9965af32f}{ExplicitTimeStepHandler::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00267}00267                                              \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00268}00268                                              \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00269}00269   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00270}00270     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a5be9add27c9e4a6bd05e6ccaec6263aa}{get\_mass\_matrix}}(residuals, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00271}00271   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00272}00272 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00273}00273 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00274}00274   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00275}00275 \textcolor{comment}{  /// Calculate all desired vectors and matrices that are required by}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00276}00276 \textcolor{comment}{  /// the problem  by calling those of the underlying element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00277}00277 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00278}\mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_a842529121fbe177ea6900d668d8b2a65}{00278}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ExplicitTimeStepHandler_a842529121fbe177ea6900d668d8b2a65}{ExplicitTimeStepHandler::get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00279}00279     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00280}00280     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}>\& vec,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00281}00281     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}>\& matrix)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00282}00282   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00283}00283 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00284}00284     \textcolor{comment}{// Check dimension}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00285}00285     \textcolor{keywordflow}{if} (matrix.size() != 1)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00286}00286     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00287}00287       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}ExplicitTimeSteps should return one matrix"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00288}00288                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00289}00289                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00290}00290     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00291}00291 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00292}00292     \textcolor{comment}{// Get the residuals and <mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00293}00293     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a5be9add27c9e4a6bd05e6ccaec6263aa}{get\_mass\_matrix}}(vec[0], matrix[0]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00294}00294   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00295}00295 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00296}00296 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00297}00297 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00298}00298 \textcolor{comment}{}  \textcolor{comment}{// Non-\/inline functions for the EigenProblemHandler class}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00299}00299 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00300}00300 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00301}00301 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00302}00302   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00303}00303 \textcolor{comment}{  /// Get the number of elemental degrees of freedom. Direct call}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00304}00304 \textcolor{comment}{  /// to the function in the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00305}00305 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00306}\mbox{\hyperlink{classoomph_1_1EigenProblemHandler_ae9e44eeceee6e19c60c51b08195730eb}{00306}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1EigenProblemHandler_ae9e44eeceee6e19c60c51b08195730eb}{EigenProblemHandler::ndof}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00307}00307   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00308}00308     \textcolor{keywordflow}{return} elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00309}00309   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00310}00310 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00311}00311   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00312}00312 \textcolor{comment}{  /// Get the global equation number of the local unknown. Direct call}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00313}00313 \textcolor{comment}{  /// to the function in the element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00314}00314 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00315}\mbox{\hyperlink{classoomph_1_1EigenProblemHandler_ab94bef9c8135c9d2701e96d8205c797d}{00315}}   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1EigenProblemHandler_ab94bef9c8135c9d2701e96d8205c797d}{EigenProblemHandler::eqn\_number}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00316}00316     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ieqn\_local)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00317}00317   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00318}00318     \textcolor{keywordflow}{return} elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00319}00319   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00320}00320 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00321}00321   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00322}00322 \textcolor{comment}{  /// Cannot call get\_residuals for an eigenproblem, so throw an error}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00323}00323 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00324}\mbox{\hyperlink{classoomph_1_1EigenProblemHandler_a0dc97e08638986970c7ca5f3903c8b6d}{00324}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1EigenProblemHandler_a0dc97e08638986970c7ca5f3903c8b6d}{EigenProblemHandler::get\_residuals}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00325}00325                                           \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00326}00326   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00327}00327     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00328}00328       \textcolor{stringliteral}{"{}An eigenproblem does not have a get\_residuals function"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00329}00329       OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00330}00330       OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00331}00331   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00332}00332 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00333}00333   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00334}00334 \textcolor{comment}{  /// Cannot call get\_jacobian for an eigenproblem, so throw an error}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00335}00335 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00336}\mbox{\hyperlink{classoomph_1_1EigenProblemHandler_aaaf7c3aa3713030ff4859117941b3a39}{00336}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1EigenProblemHandler_aaaf7c3aa3713030ff4859117941b3a39}{EigenProblemHandler::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00337}00337                                          \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00338}00338                                          \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00339}00339   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00340}00340     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}An eigenproblem does not have a get\_jacobian function"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00341}00341                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00342}00342                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00343}00343   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00344}00344 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00345}00345 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00346}00346   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00347}00347 \textcolor{comment}{  /// Calculate all desired vectors and matrices that are required by}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00348}00348 \textcolor{comment}{  /// the problem  by calling those of the underlying element.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00349}00349 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00350}\mbox{\hyperlink{classoomph_1_1EigenProblemHandler_aa88f56b5c724c41e0c2926434ae920da}{00350}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1EigenProblemHandler_aa88f56b5c724c41e0c2926434ae920da}{EigenProblemHandler::get\_all\_vectors\_and\_matrices}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00351}00351     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00352}00352     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}>\& vec,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00353}00353     \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}>\& matrix)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00354}00354   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00355}00355 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00356}00356     \textcolor{comment}{// Check dimension}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00357}00357     \textcolor{keywordflow}{if} (matrix.size() != 2)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00358}00358     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00359}00359       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}EigenProblems should return two matrices"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00360}00360                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00361}00361                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00362}00362     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00363}00363 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00364}00364     \textcolor{comment}{// Find the number of variables}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00365}00365     \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00366}00366     \textcolor{comment}{// Assign a dummy residuals vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00367}00367     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dummy(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00368}00368     \textcolor{comment}{// Get the jacobian and mass matrices}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00369}00369     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(dummy, matrix[0], matrix[1]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00370}00370 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00371}00371     \textcolor{comment}{// If we have a non-\/zero shift, then shift the A matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00372}00372     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1EigenProblemHandler_a1fc4ffdc95087fae83ddfd61004f6c83}{Sigma\_real}} != 0.0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00373}00373     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00374}00374       \textcolor{comment}{// Set the shifted matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00375}00375       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_var; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00376}00376       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00377}00377         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < n\_var; j++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00378}00378         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00379}00379           matrix[0](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) -\/= \mbox{\hyperlink{classoomph_1_1EigenProblemHandler_a1fc4ffdc95087fae83ddfd61004f6c83}{Sigma\_real}} * matrix[1](\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00380}00380         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00381}00381       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00382}00382     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00383}00383   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00384}00384 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00385}00385 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00386}00386   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00387}00387 \textcolor{comment}{  /// Clean up the memory that may have been allocated by the solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00388}00388 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00389}\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_adae26b8b348384e909bee9e57da6301d}{00389}}   \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_adae26b8b348384e909bee9e57da6301d}{AugmentedBlockFoldLinearSolver::\string~AugmentedBlockFoldLinearSolver}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00390}00390   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00391}00391     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00392}00392     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00393}00393       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00394}00394     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00395}00395     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a6793e6c00a07d6a037f12b78c7d32182}{E\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00396}00396     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00397}00397       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a6793e6c00a07d6a037f12b78c7d32182}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00398}00398     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00399}00399   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00400}00400 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00401}00401   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00402}00402 \textcolor{comment}{  /// Use a block factorisation to solve the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00403}00403 \textcolor{comment}{  /// associated with a PitchFork bifurcation.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00404}00404 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00405}\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a11690b33089e999d0c894b4e4b0646d9}{00405}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a11690b33089e999d0c894b4e4b0646d9}{AugmentedBlockFoldLinearSolver::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00406}00406                                              \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00407}00407   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00408}00408     \textcolor{comment}{// if the result is setup then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00409}00409 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00410}00410     \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00411}00411     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00412}00412       \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00413}00413       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00414}00414         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The result vector must not be distributed"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00415}00415                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00416}00416                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00417}00417       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00418}00418     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00419}00419 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00420}00420 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00421}00421     \textcolor{comment}{// Locally cache the pointer to the handler.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00422}00422     \mbox{\hyperlink{classoomph_1_1FoldHandler}{FoldHandler}}* handler\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00423}00423       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1FoldHandler}{FoldHandler}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00424}00424 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00425}00425     \textcolor{comment}{// Switch the handler to "{}block solver"{} mode}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00426}00426     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a7718a18444f6e328953dd5d5e73802f8}{solve\_augmented\_block\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00427}00427 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00428}00428     \textcolor{comment}{// We need to find out the number of dofs in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00429}00429     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00430}00430 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00431}00431     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00432}00432     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00433}00433     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00434}00434     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00435}00435 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00436}00436     \textcolor{comment}{// if the result vector is not setup then rebuild with distribution = global}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00437}00437     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00438}00438     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00439}00439       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00440}00440     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00441}00441 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00442}00442     \textcolor{comment}{// Setup storage for temporary vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00443}00443     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} a(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00444}00444       b(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00445}00445 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00446}00446     \textcolor{comment}{// Allocate storage for Alpha which can be used in the resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00447}00447     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00448}00448     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00449}00449       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00450}00450     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00451}00451     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00452}00452 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00453}00453     \textcolor{comment}{// We are going to do resolves using the underlying linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00454}00454     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00455}00455 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00456}00456     \textcolor{comment}{// Solve the first system Aa = R}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00457}00457     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00458}00458 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00459}00459     \textcolor{comment}{// The vector in the top right-\/hand block is the jacobian multiplied}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00460}00460     \textcolor{comment}{// by the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00461}00461 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00462}00462     \textcolor{comment}{// Get the present null vector from the handler}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00463}00463     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} y(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00464}00464     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < (n\_dof -\/ 1); ++n)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00465}00465     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00466}00466       y[n] = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00467}00467     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00468}00468     \textcolor{comment}{// For simplicity later, add a zero at the end}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00469}00469     y[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00470}00470 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00471}00471     \textcolor{comment}{// Loop over the elements and assemble the product}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00472}00472     \textcolor{comment}{// Local storage for the product terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00473}00473     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} Jy(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00474}00474 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00475}00475     \textcolor{comment}{// Calculate the product of the jacobian matrices, etc}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00476}00476     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00477}00477     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00478}00478     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00479}00479       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00480}00480       \textcolor{comment}{// Loop over the ndofs in each element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00481}00481       \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00482}00482       \textcolor{comment}{// Get the jacobian matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00483}00483       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00484}00484       \textcolor{comment}{// storage for the residual}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00485}00485       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} res(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00486}00486       \textcolor{comment}{// Get unperturbed raw jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00487}00487       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(res, jac);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00488}00488 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00489}00489       \textcolor{comment}{// Multiply the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00490}00490       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00491}00491       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00492}00492         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00493}00493         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_var; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00494}00494         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00495}00495           \textcolor{keywordtype}{unsigned} unknown = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00496}00496           Jy[eqn\_number] += jac(n, m) * y[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00497}00497         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00498}00498       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00499}00499     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00500}00500     \textcolor{comment}{// The final entry of the vector will be zero}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00501}00501 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00502}00502     \textcolor{comment}{// Now resolve to find alpha}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00503}00503     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(Jy, *\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00504}00504 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00505}00505     \textcolor{comment}{// The vector that multiplie the product matrix is actually y -\/ alpha}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00506}00506     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} y\_minus\_alpha(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00507}00507     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00508}00508     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00509}00509       y\_minus\_alpha[n] = y[n] -\/ (*Alpha\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00510}00510     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00511}00511 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00512}00512     \textcolor{comment}{// We can now construct our multipliers}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00513}00513     \textcolor{comment}{// Prepare to scale}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00514}00514     \textcolor{keywordtype}{double} dof\_length = 0.0, a\_length = 0.0, alpha\_length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00515}00515     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00516}00516     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00517}00517       \textcolor{keywordflow}{if} (std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n)) > dof\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00518}00518       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00519}00519         dof\_length = std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00520}00520       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00521}00521       \textcolor{keywordflow}{if} (std::fabs(a[n]) > a\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00522}00522       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00523}00523         a\_length = std::fabs(a[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00524}00524       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00525}00525       \textcolor{keywordflow}{if} (std::fabs(y\_minus\_alpha[n]) > alpha\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00526}00526       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00527}00527         alpha\_length = std::fabs(y\_minus\_alpha[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00528}00528       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00529}00529     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00530}00530 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00531}00531     \textcolor{keywordtype}{double} a\_mult = dof\_length / a\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00532}00532     \textcolor{keywordtype}{double} alpha\_mult = dof\_length / alpha\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00533}00533     \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00534}00534     a\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00535}00535     alpha\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00536}00536     a\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00537}00537     alpha\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00538}00538 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00539}00539     \textcolor{comment}{// Local storage for the product terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00540}00540     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} Jprod\_a(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00541}00541       Jprod\_alpha(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00542}00542 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00543}00543     \textcolor{comment}{// Calculate the product of the jacobian matrices, etc}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00544}00544     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00545}00545     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00546}00546       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00547}00547       \textcolor{comment}{// Loop over the ndofs in each element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00548}00548       \textcolor{keywordtype}{unsigned} n\_var = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_af8e766d1faa7867a0161329566865867}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00549}00549       \textcolor{comment}{// Get the jacobian matrices}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00550}00550       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac(n\_var), jac\_a(n\_var), jac\_alpha(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00551}00551       \textcolor{comment}{// elemental residual storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00552}00552       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} res\_elemental(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00553}00553       \textcolor{comment}{// Get unperturbed jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00554}00554       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_ad1bec54a2e0c5bd483ff0bf633bd6542}{get\_jacobian}}(elem\_pt, res\_elemental, jac);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00555}00555 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00556}00556       \textcolor{comment}{// Backup the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00557}00557       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dof\_bac(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00558}00558       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00559}00559       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00560}00560       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00561}00561         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00562}00562         dof\_bac[n] = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00563}00563         \textcolor{comment}{// Pertub by vector a}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00564}00564         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += a\_mult * a[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00565}00565       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00566}00566 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00567}00567       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00568}00568 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00569}00569       \textcolor{comment}{// Now get the new jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00570}00570       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_ad1bec54a2e0c5bd483ff0bf633bd6542}{get\_jacobian}}(elem\_pt, res\_elemental, jac\_a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00571}00571 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00572}00572       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00573}00573       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00574}00574       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00575}00575         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00576}00576         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00577}00577         \textcolor{comment}{// Pertub by vector a}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00578}00578         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += alpha\_mult * y\_minus\_alpha[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00579}00579       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00580}00580 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00581}00581       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00582}00582 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00583}00583       \textcolor{comment}{// Now get the new jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00584}00584       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_ad1bec54a2e0c5bd483ff0bf633bd6542}{get\_jacobian}}(elem\_pt, res\_elemental, jac\_alpha);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00585}00585 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00586}00586       \textcolor{comment}{// Reset the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00587}00587       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00588}00588       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00589}00589         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00590}00590         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00591}00591       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00592}00592 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00593}00593       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00594}00594 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00595}00595       \textcolor{comment}{// OK, now work out the products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00596}00596       \textcolor{comment}{// Note the (n\_var-\/1), we are only interested in the non-\/augmented}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00597}00597       \textcolor{comment}{// jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00598}00598       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < (n\_var -\/ 1); n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00599}00599       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00600}00600         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00601}00601         \textcolor{keywordtype}{double} prod\_a = 0.0, prod\_alpha = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00602}00602         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < (n\_var -\/ 1); m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00603}00603         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00604}00604           \textcolor{keywordtype}{unsigned} unknown = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00605}00605           prod\_a += (jac\_a(n, m) -\/ jac(n, m)) * y[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00606}00606           prod\_alpha += (jac\_alpha(n, m) -\/ jac(n, m)) * y[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00607}00607         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00608}00608         Jprod\_a[eqn\_number] += prod\_a / a\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00609}00609         Jprod\_alpha[eqn\_number] += prod\_alpha / alpha\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00610}00610       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00611}00611     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00612}00612 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00613}00613     Jprod\_alpha[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00614}00614     Jprod\_a[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00615}00615 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00616}00616     \textcolor{comment}{// OK, now we can formulate the next vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00617}00617     \textcolor{comment}{// The assumption here is that the result has been set to the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00618}00618     \textcolor{comment}{// residuals.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00619}00619     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof -\/ 1; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00620}00620     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00621}00621       b[n] = result[n\_dof + n] -\/ Jprod\_a[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00622}00622     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00623}00623     \textcolor{comment}{// The final residual is the entry corresponding to the original parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00624}00624     b[n\_dof -\/ 1] = result[n\_dof -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00625}00625 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00626}00626     \textcolor{comment}{// Allocate storage for E which can be used in the resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00627}00627     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a6793e6c00a07d6a037f12b78c7d32182}{E\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00628}00628     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00629}00629       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a6793e6c00a07d6a037f12b78c7d32182}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00630}00630     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00631}00631     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a6793e6c00a07d6a037f12b78c7d32182}{E\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00632}00632     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00633}00633     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(b, f);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00634}00634     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(Jprod\_alpha, *\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a6793e6c00a07d6a037f12b78c7d32182}{E\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00635}00635 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00636}00636     \textcolor{comment}{// Calculate the final entry in the vector e}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00637}00637     \textcolor{keyword}{const} \textcolor{keywordtype}{double} e\_final = (*E\_pt)[n\_dof -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00638}00638     \textcolor{comment}{// Calculate the final entry in the vector d}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00639}00639     \textcolor{keyword}{const} \textcolor{keywordtype}{double} d\_final = f[n\_dof -\/ 1] / e\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00640}00640     \textcolor{comment}{// Assemble the final corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00641}00641     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof -\/ 1; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00642}00642     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00643}00643       result[n] = a[n] -\/ (*Alpha\_pt)[n] * d\_final + d\_final * y[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00644}00644       result[n\_dof + n] = f[n] -\/ (*E\_pt)[n] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00645}00645     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00646}00646     \textcolor{comment}{// The result corresponding to the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00647}00647     result[n\_dof -\/ 1] = a[n\_dof -\/ 1] -\/ (*Alpha\_pt)[n\_dof -\/ 1] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00648}00648 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00649}00649     \textcolor{comment}{// The sign of the jacobian is the sign of the final entry in e}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00650}00650     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}() =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00651}00651       \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(std::fabs(e\_final) / e\_final);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00652}00652 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00653}00653     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00654}00654     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a506c9a7bb372c6d8799c6dabc9448f46}{solve\_full\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00655}00655 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00656}00656     \textcolor{comment}{// If we are not storing things, clear the results}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00657}00657     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00658}00658     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00659}00659       \textcolor{comment}{// We no longer need to store the matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00660}00660       \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00661}00661       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00662}00662       \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00663}00663       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a6793e6c00a07d6a037f12b78c7d32182}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00664}00664       \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a6793e6c00a07d6a037f12b78c7d32182}{E\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00665}00665     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00666}00666     \textcolor{comment}{// Otherwise, also store the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00667}00667     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00668}00668     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00669}00669       \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a65a5a2a87943d506cf4afc5cdbcfc06f}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00670}00670     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00671}00671   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00672}00672 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00673}00673 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00674}00674   \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00675}00675   \textcolor{comment}{// Hack the re-\/solve to use the block factorisation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00676}00676   \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00677}\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a7728fc74802b6802ed966765bc1e62d9}{00677}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a7728fc74802b6802ed966765bc1e62d9}{AugmentedBlockFoldLinearSolver::resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00678}00678                                                \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00679}00679   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00680}00680     \textcolor{comment}{// Check that the factors have been stored}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00681}00681     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_ae4f2e27925a6ceef247bac84f49fdb90}{Alpha\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00682}00682     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00683}00683       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The required vectors have not been stored"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00684}00684                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00685}00685                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00686}00686     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00687}00687 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00688}00688     \textcolor{comment}{// Get the pointer to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00689}00689     \mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const} problem\_pt = \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a65a5a2a87943d506cf4afc5cdbcfc06f}{Problem\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00690}00690 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00691}00691     \mbox{\hyperlink{classoomph_1_1FoldHandler}{FoldHandler}}* handler\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00692}00692       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1FoldHandler}{FoldHandler}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00693}00693 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00694}00694     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00695}00695     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a7718a18444f6e328953dd5d5e73802f8}{solve\_augmented\_block\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00696}00696 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00697}00697     \textcolor{comment}{// We need to find out the number of dofs in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00698}00698     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00699}00699 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00700}00700 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00701}00701     \textcolor{comment}{// if the result is setup then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00702}00702     \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00703}00703     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00704}00704       \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00705}00705       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00706}00706         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The result vector must not be distributed"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00707}00707                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00708}00708                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00709}00709       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00710}00710     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00711}00711     \textcolor{comment}{// the rhs must be setup}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00712}00712     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00713}00713     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00714}00714       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The rhs vector must be setup"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00715}00715                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00716}00716                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00717}00717     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00718}00718 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00719}00719 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00720}00720     \textcolor{comment}{// if the result vector is not setup then rebuild with distribution = global}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00721}00721     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00722}00722     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00723}00723       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00724}00724     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00725}00725 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00726}00726     \textcolor{comment}{// Setup storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00727}00727     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} a(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00728}00728       b(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00729}00729 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00730}00730     \textcolor{comment}{// Set the values of the a vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00731}00731     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < (n\_dof -\/ 1); n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00732}00732     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00733}00733       a[n] = rhs[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00734}00734     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00735}00735     \textcolor{comment}{// The entry associated with the additional parameter is zero}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00736}00736     a[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00737}00737 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00738}00738     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00739}00739 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00740}00740     \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00741}00741     \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00742}00742     \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00743}00743     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} input\_a(a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00744}00744 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00745}00745     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(input\_a, a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00746}00746 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00747}00747     \textcolor{comment}{// We can now construct our multipliers}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00748}00748     \textcolor{comment}{// Prepare to scale}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00749}00749     \textcolor{keywordtype}{double} dof\_length = 0.0, a\_length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00750}00750     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00751}00751     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00752}00752       \textcolor{keywordflow}{if} (std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n)) > dof\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00753}00753       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00754}00754         dof\_length = std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00755}00755       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00756}00756 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00757}00757       \textcolor{keywordflow}{if} (std::fabs(a[n]) > a\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00758}00758       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00759}00759         a\_length = std::fabs(a[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00760}00760       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00761}00761     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00762}00762     \textcolor{keywordtype}{double} a\_mult = dof\_length / a\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00763}00763     \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00764}00764     a\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00765}00765     a\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00766}00766 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00767}00767     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} Jprod\_a(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00768}00768 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00769}00769     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00770}00770     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00771}00771     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00772}00772       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00773}00773       \textcolor{comment}{// Loop over the ndofs in each element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00774}00774       \textcolor{keywordtype}{unsigned} n\_var = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_af8e766d1faa7867a0161329566865867}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00775}00775       \textcolor{comment}{// Get some jacobian matrices}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00776}00776       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac(n\_var), jac\_a(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00777}00777       \textcolor{comment}{// the elemental residual}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00778}00778       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} res\_elemental(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00779}00779       \textcolor{comment}{// Get unperturbed jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00780}00780       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_ad1bec54a2e0c5bd483ff0bf633bd6542}{get\_jacobian}}(elem\_pt, res\_elemental, jac);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00781}00781 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00782}00782       \textcolor{comment}{// Backup the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00783}00783       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dof\_bac(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00784}00784       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00785}00785       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00786}00786       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00787}00787         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00788}00788         dof\_bac[n] = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00789}00789         \textcolor{comment}{// Pertub by vector a}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00790}00790         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += a\_mult * a[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00791}00791       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00792}00792 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00793}00793       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00794}00794 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00795}00795       \textcolor{comment}{// Now get the new jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00796}00796       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_ad1bec54a2e0c5bd483ff0bf633bd6542}{get\_jacobian}}(elem\_pt, res\_elemental, jac\_a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00797}00797 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00798}00798       \textcolor{comment}{// Reset the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00799}00799       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00800}00800       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00801}00801         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00802}00802         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00803}00803       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00804}00804 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00805}00805       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00806}00806 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00807}00807       \textcolor{comment}{// OK, now work out the products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00808}00808       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < (n\_var -\/ 1); n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00809}00809       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00810}00810         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00811}00811         \textcolor{keywordtype}{double} prod\_a = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00812}00812         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < (n\_var -\/ 1); m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00813}00813         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00814}00814           \textcolor{keywordtype}{unsigned} unknown = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00815}00815           prod\_a += (jac\_a(n, m) -\/ jac(n, m)) * handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00816}00816         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00817}00817         Jprod\_a[eqn\_number] += prod\_a / a\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00818}00818       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00819}00819     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00820}00820 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00821}00821     Jprod\_a[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00822}00822 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00823}00823     \textcolor{comment}{// OK, now we can formulate the next vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00824}00824     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof -\/ 1; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00825}00825     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00826}00826       b[n] = rhs[n\_dof + n] -\/ Jprod\_a[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00827}00827     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00828}00828     \textcolor{comment}{// The residuals for the final entry should be those associated}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00829}00829     \textcolor{comment}{// with the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00830}00830     b[n\_dof -\/ 1] = rhs[n\_dof -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00831}00831 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00832}00832     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00833}00833 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00834}00834     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(b, f);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00835}00835 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00836}00836     \textcolor{comment}{// Calculate the final entry in the vector d}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00837}00837     \textcolor{keyword}{const} \textcolor{keywordtype}{double} d\_final = f[n\_dof -\/ 1] / (*E\_pt)[n\_dof -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00838}00838     \textcolor{comment}{// Assemble the final corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00839}00839     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof -\/ 1; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00840}00840     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00841}00841       result[n] = a[n] -\/ (*Alpha\_pt)[n] * d\_final + d\_final * handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00842}00842       result[n\_dof + n] = f[n] -\/ (*E\_pt)[n] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00843}00843     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00844}00844     \textcolor{comment}{// The result corresponding to the paramater}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00845}00845     result[n\_dof -\/ 1] = a[n\_dof -\/ 1] -\/ (*Alpha\_pt)[n\_dof -\/ 1] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00846}00846 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00847}00847     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a1e8706ee6a97424bcbaf1992a09549ee}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00848}00848 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00849}00849     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00850}00850     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1FoldHandler_a506c9a7bb372c6d8799c6dabc9448f46}{solve\_full\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00851}00851   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00852}00852 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00853}00853 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00854}00854 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00855}00855 \textcolor{comment}{}  \textcolor{comment}{// Non-\/inline functions for the FoldHandler class}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00856}00856 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00857}00857 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00858}00858 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00859}00859   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00860}00860 \textcolor{comment}{  /// Constructor: Initialise the fold handler,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00861}00861 \textcolor{comment}{  /// by setting initial guesses for Y, Phi and calculating Count.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00862}00862 \textcolor{comment}{  /// If the system changes, a new  handler must be constructed.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00863}00863 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00864}\mbox{\hyperlink{classoomph_1_1FoldHandler_add39896d007559f4fb801f1c95e4ab16}{00864}}   \mbox{\hyperlink{classoomph_1_1FoldHandler_add39896d007559f4fb801f1c95e4ab16}{FoldHandler::FoldHandler}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00865}00865                            \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00866}00866     : Solve\_which\_system(Full\_augmented), Parameter\_pt(parameter\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00867}00867   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00868}00868     \textcolor{comment}{// Set the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00869}00869     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00870}00870     \textcolor{comment}{// Set the number of degrees of freedom}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00871}00871     \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00872}00872 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00873}00873     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00874}00874     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00875}00875     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00876}00876       \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00877}00877 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00878}00878     \textcolor{comment}{// Resize the vectors of additional dofs and constants}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00879}00879     \mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00880}00880     \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00881}00881     \mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, 0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00882}00882 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00883}00883     \textcolor{comment}{// Loop over all the elements in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00884}00884     \textcolor{keywordtype}{unsigned} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00885}00885     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00886}00886     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00887}00887       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00888}00888       \textcolor{comment}{// Loop over the local freedoms in the element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00889}00889       \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00890}00890       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00891}00891       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00892}00892         \textcolor{comment}{// Increase the associated global equation number counter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00893}00893         ++\mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n)];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00894}00894       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00895}00895     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00896}00896 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00897}00897     \textcolor{comment}{// Calculate the value Phi by}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00898}00898     \textcolor{comment}{// solving the system JPhi = dF/dlambda}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00899}00899 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00900}00900     \textcolor{comment}{// Locally cache the linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00901}00901     \mbox{\hyperlink{classoomph_1_1LinearSolver}{LinearSolver}}* \textcolor{keyword}{const} linear\_solver\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00902}00902 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00903}00903     \textcolor{comment}{// Save the status before entry to this routine}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00904}00904     \textcolor{keywordtype}{bool} enable\_resolve = linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ae1e4d34a7e2b1537d36153f87e8a62a6}{is\_resolve\_enabled}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00905}00905 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00906}00906     \textcolor{comment}{// We need to do a resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00907}00907     linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00908}00908 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00909}00909     \textcolor{comment}{// Storage for the solution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00910}00910     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00911}00911 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00912}00912     \textcolor{comment}{// Solve the standard problem, we only want to make sure that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00913}00913     \textcolor{comment}{// we factorise the matrix, if it has not been factorised. We shall}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00914}00914     \textcolor{comment}{// ignore the return value of x.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00915}00915     linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, x);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00916}00916 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00917}00917     \textcolor{comment}{// Get the vector dresiduals/dparameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00918}00918     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{get\_derivative\_wrt\_global\_parameter}}(parameter\_pt, x);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00919}00919 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00920}00920     \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00921}00921     \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00922}00922     \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00923}00923     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} input\_x(x);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00924}00924 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00925}00925     \textcolor{comment}{// Now resolve the system with the new RHS and overwrite the solution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00926}00926     linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(input\_x, x);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00927}00927 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00928}00928     \textcolor{comment}{// Restore the storage status of the linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00929}00929     \textcolor{keywordflow}{if} (enable\_resolve)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00930}00930     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00931}00931       linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00932}00932     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00933}00933     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00934}00934     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00935}00935       linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00936}00936     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00937}00937 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00938}00938     \textcolor{comment}{// Add the global parameter as an unknown to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00939}00939     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00940}00940 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00941}00941 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00942}00942     \textcolor{comment}{// Normalise the initial guesses for phi}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00943}00943     \textcolor{keywordtype}{double} length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00944}00944     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00945}00945     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00946}00946       length += x[n] * x[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00947}00947     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00948}00948     length = sqrt(length);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00949}00949 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00950}00950     \textcolor{comment}{// Now add the null space components to the problem unknowns}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00951}00951     \textcolor{comment}{// and initialise them and Phi to the same normalised values}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00952}00952     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00953}00953     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00954}00954       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00955}00955       \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n] = \mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}[n] = -\/x[n] / length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00956}00956     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00957}00957 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00958}00958     \textcolor{comment}{// delete the dist\_pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00959}00959     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00960}00960       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} * 2 + 1, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00961}00961     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00962}00962     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00963}00963 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00964}00964     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00965}00965   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00966}00966 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00967}00967 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00968}00968 \textcolor{comment}{  /// Constructor in which the eigenvector is passed as an initial}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00969}00969 \textcolor{comment}{  /// guess}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00970}\mbox{\hyperlink{classoomph_1_1FoldHandler_ac50106424b3fa4e3346231ec41b7a89f}{00970}} \textcolor{comment}{}  \mbox{\hyperlink{classoomph_1_1FoldHandler_add39896d007559f4fb801f1c95e4ab16}{FoldHandler::FoldHandler}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00971}00971                            \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00972}00972                            \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& eigenvector)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00973}00973     : Solve\_which\_system(Full\_augmented), Parameter\_pt(parameter\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00974}00974   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00975}00975     \textcolor{comment}{// Set the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00976}00976     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00977}00977     \textcolor{comment}{// Set the number of degrees of freedom}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00978}00978     \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00979}00979 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00980}00980     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00981}00981     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00982}00982     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00983}00983       \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00984}00984 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00985}00985     \textcolor{comment}{// Resize the vectors of additional dofs and constants}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00986}00986     \mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00987}00987     \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00988}00988     \mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, 0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00989}00989 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00990}00990     \textcolor{comment}{// Loop over all the elements in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00991}00991     \textcolor{keywordtype}{unsigned} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00992}00992     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00993}00993     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00994}00994       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00995}00995       \textcolor{comment}{// Loop over the local freedoms in the element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00996}00996       \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00997}00997       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00998}00998       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l00999}00999         \textcolor{comment}{// Increase the associated global equation number counter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01000}01000         ++\mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n)];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01001}01001       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01002}01002     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01003}01003 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01004}01004     \textcolor{comment}{// Add the global parameter as an unknown to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01005}01005     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01006}01006 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01007}01007 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01008}01008     \textcolor{comment}{// Normalise the initial guesses for the eigenvecor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01009}01009     \textcolor{keywordtype}{double} length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01010}01010     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01011}01011     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01012}01012       length += eigenvector[n] * eigenvector[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01013}01013     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01014}01014     length = sqrt(length);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01015}01015 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01016}01016     \textcolor{comment}{// Now add the null space components to the problem unknowns}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01017}01017     \textcolor{comment}{// and initialise them and Phi to the same normalised values}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01018}01018     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01019}01019     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01020}01020       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01021}01021       \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n] = \mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}[n] = eigenvector[n] / length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01022}01022     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01023}01023 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01024}01024     \textcolor{comment}{// delete the dist\_pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01025}01025     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01026}01026       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} * 2 + 1, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01027}01027     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01028}01028     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01029}01029 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01030}01030     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01031}01031   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01032}01032 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01033}01033 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01034}01034 \textcolor{comment}{  /// Constructor in which the eigenvector and normalisation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01035}01035 \textcolor{comment}{  /// vector are  passed as an initial guess}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01036}\mbox{\hyperlink{classoomph_1_1FoldHandler_a0e39e588b48269e4f7272b78fa4b99a7}{01036}} \textcolor{comment}{}  \mbox{\hyperlink{classoomph_1_1FoldHandler_add39896d007559f4fb801f1c95e4ab16}{FoldHandler::FoldHandler}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01037}01037                            \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01038}01038                            \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& eigenvector,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01039}01039                            \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& normalisation)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01040}01040     : Solve\_which\_system(Full\_augmented), Parameter\_pt(parameter\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01041}01041   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01042}01042     \textcolor{comment}{// Set the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01043}01043     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01044}01044     \textcolor{comment}{// Set the number of degrees of freedom}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01045}01045     \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01046}01046 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01047}01047     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01048}01048     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01049}01049     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01050}01050       \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01051}01051 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01052}01052     \textcolor{comment}{// Resize the vectors of additional dofs and constants}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01053}01053     \mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01054}01054     \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01055}01055     \mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, 0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01056}01056 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01057}01057     \textcolor{comment}{// Loop over all the elements in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01058}01058     \textcolor{keywordtype}{unsigned} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01059}01059     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01060}01060     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01061}01061       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01062}01062       \textcolor{comment}{// Loop over the local freedoms in the element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01063}01063       \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01064}01064       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01065}01065       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01066}01066         \textcolor{comment}{// Increase the associated global equation number counter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01067}01067         ++\mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n)];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01068}01068       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01069}01069     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01070}01070 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01071}01071     \textcolor{comment}{// Add the global parameter as an unknown to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01072}01072     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01073}01073 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01074}01074 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01075}01075     \textcolor{comment}{// Normalise the initial guesses for the eigenvecor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01076}01076     \textcolor{keywordtype}{double} length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01077}01077     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01078}01078     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01079}01079       length += eigenvector[n] * normalisation[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01080}01080     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01081}01081     length = sqrt(length);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01082}01082 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01083}01083     \textcolor{comment}{// Now add the null space components to the problem unknowns}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01084}01084     \textcolor{comment}{// and initialise them and Phi to the same normalised values}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01085}01085     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01086}01086     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01087}01087       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01088}01088       \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n] = eigenvector[n] / length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01089}01089       \mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}[n] = normalisation[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01090}01090     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01091}01091 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01092}01092     \textcolor{comment}{// delete the dist\_pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01093}01093     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01094}01094       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} * 2 + 1, \textcolor{keyword}{true});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01095}01095     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01096}01096     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01097}01097 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01098}01098     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01099}01099   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01100}01100 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01101}01101 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01102}01102   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01103}01103 \textcolor{comment}{  /// The number of unknowns is 2n+1}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01104}01104 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01105}\mbox{\hyperlink{classoomph_1_1FoldHandler_af8e766d1faa7867a0161329566865867}{01105}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1FoldHandler_af8e766d1faa7867a0161329566865867}{FoldHandler::ndof}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01106}01106   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01107}01107     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01108}01108     \textcolor{comment}{// Return different values depending on the type of block decomposition}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01109}01109     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01110}01110     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01111}01111       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eab20273d36c24fa39780d04503ff186c5}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01112}01112         \textcolor{keywordflow}{return} (2 * raw\_ndof + 1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01113}01113         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01114}01114 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01115}01115       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eaf82a4e892f7e8ed53e41dc82acbc92cd}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01116}01116         \textcolor{keywordflow}{return} (raw\_ndof + 1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01117}01117         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01118}01118 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01119}01119       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3ea28dfb90a98027e2204ea1872c498454c}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01120}01120         \textcolor{keywordflow}{return} raw\_ndof;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01121}01121         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01122}01122 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01123}01123       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01124}01124         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01125}01125         error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01126}01126           << \textcolor{stringliteral}{"{}The Solve\_which\_system flag can only take values 0, 1, 2"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01127}01127           << \textcolor{stringliteral}{"{} not "{}} << \mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01128}01128         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01129}01129           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01130}01130     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01131}01131   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01132}01132 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01133}01133   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01134}01134 \textcolor{comment}{  /// Return the global equation number associated with local equation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01135}01135 \textcolor{comment}{  /// number ieqn\_local. We choose to number the unknowns according}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01136}01136 \textcolor{comment}{  /// to the augmented system.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01137}01137 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01138}\mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{01138}}   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{FoldHandler::eqn\_number}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01139}01139                                         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ieqn\_local)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01140}01140   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01141}01141     \textcolor{comment}{// Find the number of non-\/augmented dofs in the element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01142}01142     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01143}01143     \textcolor{comment}{// Storage for the global eqn number}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01144}01144     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} global\_eqn = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01145}01145     \textcolor{comment}{// If we are a "{}standard"{} unknown, just return the standard equation number}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01146}01146     \textcolor{keywordflow}{if} (ieqn\_local < raw\_ndof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01147}01147     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01148}01148       global\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01149}01149     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01150}01150     \textcolor{comment}{// Otherwise if we are at an unknown corresponding to the bifurcation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01151}01151     \textcolor{comment}{// parameter return the global equation number of the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01152}01152     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ieqn\_local == raw\_ndof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01153}01153     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01154}01154       global\_eqn = \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01155}01155     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01156}01156     \textcolor{comment}{// Otherwise we are in the unknown corresponding to a null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01157}01157     \textcolor{comment}{// return the global unknown Ndof + 1 + global unknown of "{}standard"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01158}01158     \textcolor{comment}{// unknown.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01159}01159     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01160}01160     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01161}01161       global\_eqn = \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} + 1 + elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local -\/ 1 -\/ raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01162}01162     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01163}01163 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01164}01164     \textcolor{comment}{// Return the global equation number}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01165}01165     \textcolor{keywordflow}{return} global\_eqn;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01166}01166   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01167}01167 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01168}01168   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01169}01169 \textcolor{comment}{  /// Formulate the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01170}01170 \textcolor{comment}{}  \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01171}\mbox{\hyperlink{classoomph_1_1FoldHandler_abfbec6da3dffeaf3b4df0ee4955101fd}{01171}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_abfbec6da3dffeaf3b4df0ee4955101fd}{FoldHandler::get\_residuals}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01172}01172                                   \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01173}01173   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01174}01174     \textcolor{comment}{// Need to get raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01175}01175     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01176}01176 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01177}01177     \textcolor{comment}{// Find out which system we are solving}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01178}01178     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01179}01179     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01180}01180         \textcolor{comment}{// If we are solving the standard system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01181}01181       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3ea28dfb90a98027e2204ea1872c498454c}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01182}01182       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01183}01183         \textcolor{comment}{// Get the basic residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01184}01184         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a53d348ab71c86b53619129a1dd411d30}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01185}01185       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01186}01186       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01187}01187 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01188}01188       \textcolor{comment}{// If we are solving the augmented-\/by-\/one system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01189}01189       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eaf82a4e892f7e8ed53e41dc82acbc92cd}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01190}01190       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01191}01191         \textcolor{comment}{// Get the basic residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01192}01192         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a53d348ab71c86b53619129a1dd411d30}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01193}01193 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01194}01194         \textcolor{comment}{// Zero the final residual}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01195}01195         residuals[raw\_ndof] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01196}01196       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01197}01197       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01198}01198 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01199}01199       \textcolor{comment}{// If we are solving the full augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01200}01200       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eab20273d36c24fa39780d04503ff186c5}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01201}01201       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01202}01202         \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jacobian(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01203}01203         \textcolor{comment}{// Get the basic residuals and jacobian initially}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01204}01204         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(residuals, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01205}01205 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01206}01206         \textcolor{comment}{// The normalisation equation must be initialised to -\/1.0/number of}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01207}01207         \textcolor{comment}{// elements}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01208}01208         residuals[raw\_ndof] = -\/1.0 / \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01209}01209 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01210}01210         \textcolor{comment}{// Now assemble the equations Jy = 0}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01211}01211         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01212}01212         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01213}01213           residuals[raw\_ndof + 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01214}01214           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < raw\_ndof; j++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01215}01215           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01216}01216             residuals[raw\_ndof + 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01217}01217               jacobian(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(j)];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01218}01218           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01219}01219           \textcolor{comment}{// Add the contribution to phi.y=1}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01220}01220           \textcolor{comment}{// Need to divide by the number of elements that contribute to this}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01221}01221           \textcolor{comment}{// unknown so that we do get phi.y exactly.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01222}01222           \textcolor{keywordtype}{unsigned} global\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01223}01223           residuals[raw\_ndof] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01224}01224             (\mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}[global\_eqn] * \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[global\_eqn]) / \mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}[global\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01225}01225         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01226}01226       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01227}01227       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01228}01228 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01229}01229       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01230}01230         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01231}01231         error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01232}01232           << \textcolor{stringliteral}{"{}The Solve\_which\_system flag can only take values 0, 1, 2"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01233}01233           << \textcolor{stringliteral}{"{} not "{}} << \mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01234}01234         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01235}01235           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01236}01236     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01237}01237   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01238}01238 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01239}01239 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01240}01240   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01241}01241 \textcolor{comment}{  /// Calculate the elemental Jacobian matrix "{}d equation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01242}01242 \textcolor{comment}{  /// / d variable"{} for the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01243}01243 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01244}\mbox{\hyperlink{classoomph_1_1FoldHandler_ad1bec54a2e0c5bd483ff0bf633bd6542}{01244}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_ad1bec54a2e0c5bd483ff0bf633bd6542}{FoldHandler::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01245}01245                                  \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01246}01246                                  \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01247}01247   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01248}01248     \textcolor{comment}{// Find the number of augmented dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01249}01249     \textcolor{keywordtype}{unsigned} augmented\_ndof = \mbox{\hyperlink{classoomph_1_1FoldHandler_af8e766d1faa7867a0161329566865867}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01250}01250     \textcolor{comment}{// Find the non-\/augmented dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01251}01251     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01252}01252 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01253}01253     \textcolor{comment}{// Which system are we solving}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01254}01254     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01255}01255     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01256}01256         \textcolor{comment}{// If we are solving the original system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01257}01257       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3ea28dfb90a98027e2204ea1872c498454c}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01258}01258       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01259}01259         \textcolor{comment}{// Just get the raw jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01260}01260         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(residuals, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01261}01261       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01262}01262       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01263}01263 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01264}01264       \textcolor{comment}{// If we are solving the augmented-\/by-\/one system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01265}01265       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eaf82a4e892f7e8ed53e41dc82acbc92cd}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01266}01266       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01267}01267         \textcolor{comment}{// Get the full residuals, we need them}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01268}01268         \mbox{\hyperlink{classoomph_1_1FoldHandler_abfbec6da3dffeaf3b4df0ee4955101fd}{get\_residuals}}(elem\_pt, residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01269}01269 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01270}01270         \textcolor{comment}{// Need to get the raw jacobian (and raw residuals)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01271}01271         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} newres(augmented\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01272}01272         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(newres, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01273}01273 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01274}01274         \textcolor{comment}{// Now do finite differencing stuff}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01275}01275         \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01276}01276         \textcolor{comment}{// Fill in the first lot of finite differences}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01277}01277         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01278}01278           \textcolor{comment}{// increase the global parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01279}01279           \textcolor{keywordtype}{double}* unknown\_pt = \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01280}01280           \textcolor{keywordtype}{double} init = *unknown\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01281}01281           *unknown\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01282}01282 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01283}01283           \textcolor{comment}{// Now do any possible updates}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01284}01284           \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01285}01285 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01286}01286           \textcolor{comment}{// Get the new (modified) residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01287}01287           \mbox{\hyperlink{classoomph_1_1FoldHandler_abfbec6da3dffeaf3b4df0ee4955101fd}{get\_residuals}}(elem\_pt, newres);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01288}01288 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01289}01289           \textcolor{comment}{// The final column  is given by the difference}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01290}01290           \textcolor{comment}{// between the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01291}01291           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01292}01292           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01293}01293             jacobian(n, augmented\_ndof -\/ 1) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01294}01294               (newres[n] -\/ residuals[n]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01295}01295           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01296}01296           \textcolor{comment}{// Reset the global parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01297}01297           *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01298}01298 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01299}01299           \textcolor{comment}{// Now do any possible updates}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01300}01300           \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01301}01301         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01302}01302 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01303}01303         \textcolor{comment}{// Fill in the bottom row}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01304}01304         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01305}01305         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01306}01306           \textcolor{keywordtype}{unsigned} local\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01307}01307           jacobian(augmented\_ndof -\/ 1, n) = \mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}[local\_eqn] / \mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}[local\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01308}01308         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01309}01309       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01310}01310       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01311}01311 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01312}01312         \textcolor{comment}{// Otherwise solving the full system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01313}01313       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eab20273d36c24fa39780d04503ff186c5}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01314}01314       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01315}01315         \textcolor{comment}{// Get the residuals for the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01316}01316         \mbox{\hyperlink{classoomph_1_1FoldHandler_abfbec6da3dffeaf3b4df0ee4955101fd}{get\_residuals}}(elem\_pt, residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01317}01317 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01318}01318         \textcolor{comment}{// Need to get the raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01319}01319         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} newres(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01320}01320         \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} newjac(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01321}01321         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(newres, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01322}01322 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01323}01323         \textcolor{comment}{// Fill in the jacobian on the diagonal sub-\/block of}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01324}01324         \textcolor{comment}{// the null-\/space equations}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01325}01325         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01326}01326         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01327}01327           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < raw\_ndof; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01328}01328           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01329}01329             jacobian(raw\_ndof + 1 + n, raw\_ndof + 1 + m) = jacobian(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01330}01330           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01331}01331         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01332}01332 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01333}01333         \textcolor{comment}{// Now finite difference wrt the global unknown}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01334}01334         \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01335}01335         \textcolor{comment}{// Fill in the first lot of finite differences}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01336}01336         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01337}01337           \textcolor{comment}{// increase the global parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01338}01338           \textcolor{keywordtype}{double}* unknown\_pt = \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01339}01339           \textcolor{keywordtype}{double} init = *unknown\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01340}01340           *unknown\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01341}01341           \textcolor{comment}{// Need to update the function}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01342}01342           \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01343}01343 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01344}01344           \textcolor{comment}{// Get the new raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01345}01345           elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(newres, newjac);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01346}01346 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01347}01347           \textcolor{comment}{// The end of the first row is given by the difference}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01348}01348           \textcolor{comment}{// between the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01349}01349           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01350}01350           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01351}01351             jacobian(n, raw\_ndof) = (newres[n] -\/ residuals[n]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01352}01352             \textcolor{comment}{// The end of the second row is given by the difference multiplied}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01353}01353             \textcolor{comment}{// by the product}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01354}01354             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < raw\_ndof; l++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01355}01355             \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01356}01356               jacobian(raw\_ndof + 1 + n, raw\_ndof) +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01357}01357                 (newjac(n, l) -\/ jacobian(n, l)) * \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(l)] /}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01358}01358                 \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01359}01359             \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01360}01360           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01361}01361           \textcolor{comment}{// Reset the global parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01362}01362           *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01363}01363 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01364}01364           \textcolor{comment}{// Need to update the function}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01365}01365           \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01366}01366         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01367}01367 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01368}01368         \textcolor{comment}{// Now fill in the first column of the second rows}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01369}01369         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01370}01370           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01371}01371           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01372}01372             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} global\_eqn = \mbox{\hyperlink{classoomph_1_1FoldHandler_a30f2973860c13a183d5647a63b0c2ead}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01373}01373             \textcolor{comment}{// Increase the first lot}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01374}01374             \textcolor{keywordtype}{double}* unknown\_pt = \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[global\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01375}01375             \textcolor{keywordtype}{double} init = *unknown\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01376}01376             *unknown\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01377}01377             \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}(); \textcolor{comment}{/// ALICE}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01378}01378 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01379}01379             \textcolor{comment}{// Get the new jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01380}01380             elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(newres, newjac);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01381}01381 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01382}01382             \textcolor{comment}{// Work out the differences}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01383}01383             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < raw\_ndof; k++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01384}01384             \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01385}01385               \textcolor{comment}{// jacobian(raw\_ndof+k,n) = 0.0;}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01386}01386               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < raw\_ndof; l++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01387}01387               \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01388}01388                 jacobian(raw\_ndof + 1 + k, n) +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01389}01389                   (newjac(k, l) -\/ jacobian(k, l)) * \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(l)] /}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01390}01390                   \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01391}01391               \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01392}01392             \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01393}01393             *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01394}01394             \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}(); \textcolor{comment}{/// ALICE}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01395}01395           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01396}01396         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01397}01397 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01398}01398         \textcolor{comment}{// Fill in the row corresponding to the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01399}01399         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01400}01400         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01401}01401           \textcolor{keywordtype}{unsigned} global\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01402}01402           jacobian(raw\_ndof, raw\_ndof + 1 + n) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01403}01403             \mbox{\hyperlink{classoomph_1_1FoldHandler_a7b6ebf95bb87aab0c3df7daf841af3a8}{Phi}}[global\_eqn] / \mbox{\hyperlink{classoomph_1_1FoldHandler_a302fed88ed8dad865616a3d050d385ad}{Count}}[global\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01404}01404         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01405}01405 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01406}01406         \textcolor{comment}{//   //Loop over the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01407}01407         \textcolor{comment}{//     for(unsigned n=0;n<augmented\_ndof;n++)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01408}01408         \textcolor{comment}{//      \{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01409}01409         \textcolor{comment}{//       unsigned long global\_eqn = eqn\_number(elem\_pt,n);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01410}01410         \textcolor{comment}{//       double* unknown\_pt = Problem\_pt-\/>Dof\_pt[global\_eqn];}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01411}01411         \textcolor{comment}{//       double init = *unknown\_pt;}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01412}01412         \textcolor{comment}{//       *unknown\_pt += FD\_step;}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01413}01413 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01414}01414         \textcolor{comment}{//       //Get the new residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01415}01415         \textcolor{comment}{//       get\_residuals(elem\_pt,newres);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01416}01416 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01417}01417         \textcolor{comment}{//       for(unsigned m=0;m<augmented\_ndof;m++)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01418}01418         \textcolor{comment}{//        \{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01419}01419         \textcolor{comment}{//         jacobian(m,n) = (newres[m] -\/ residuals[m])/FD\_step;}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01420}01420         \textcolor{comment}{//        \}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01421}01421         \textcolor{comment}{//       //Reset the unknown}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01422}01422         \textcolor{comment}{//       *unknown\_pt = init;}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01423}01423         \textcolor{comment}{//      \}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01424}01424       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01425}01425       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01426}01426 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01427}01427       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01428}01428         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01429}01429         error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01430}01430           << \textcolor{stringliteral}{"{}The Solve\_which\_system flag can only take values 0, 1, 2"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01431}01431           << \textcolor{stringliteral}{"{} not "{}} << \mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01432}01432         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01433}01433           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01434}01434     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01435}01435   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01436}01436 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01437}01437 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01438}01438   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01439}01439 \textcolor{comment}{  /// Formulate the derivatives of the augmented system with respect}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01440}01440 \textcolor{comment}{  /// to a parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01441}01441 \textcolor{comment}{}  \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01442}\mbox{\hyperlink{classoomph_1_1FoldHandler_ad98b98488b683fa3ad9497b662e6e5b6}{01442}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_ad98b98488b683fa3ad9497b662e6e5b6}{FoldHandler::get\_dresiduals\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01443}01443     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01444}01444     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01445}01445     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dres\_dparam)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01446}01446   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01447}01447     \textcolor{comment}{// Need to get raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01448}01448     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01449}01449 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01450}01450     \textcolor{comment}{// Find out which system we are solving}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01451}01451     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01452}01452     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01453}01453         \textcolor{comment}{// If we are solving the standard system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01454}01454       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3ea28dfb90a98027e2204ea1872c498454c}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01455}01455       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01456}01456         \textcolor{comment}{// Get the basic residual derivatives}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01457}01457         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a63bf8f3db94fdb4098ff61fa930a6d40}{get\_dresiduals\_dparameter}}(parameter\_pt, dres\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01458}01458       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01459}01459       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01460}01460 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01461}01461       \textcolor{comment}{// If we are solving the augmented-\/by-\/one system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01462}01462       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eaf82a4e892f7e8ed53e41dc82acbc92cd}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01463}01463       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01464}01464         \textcolor{comment}{// Get the basic residual derivatives}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01465}01465         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a63bf8f3db94fdb4098ff61fa930a6d40}{get\_dresiduals\_dparameter}}(parameter\_pt, dres\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01466}01466 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01467}01467         \textcolor{comment}{// Zero the final derivative}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01468}01468         dres\_dparam[raw\_ndof] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01469}01469       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01470}01470       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01471}01471 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01472}01472       \textcolor{comment}{// If we are solving the full augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01473}01473       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eab20273d36c24fa39780d04503ff186c5}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01474}01474       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01475}01475         \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} djac\_dparam(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01476}01476         \textcolor{comment}{// Get the basic residuals and jacobian derivatives initially}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01477}01477         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab92de6f9c750735bc660f0a10f0df44c}{get\_djacobian\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01478}01478           parameter\_pt, dres\_dparam, djac\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01479}01479 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01480}01480         \textcolor{comment}{// The normalisation equation does not depend on the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01481}01481         dres\_dparam[raw\_ndof] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01482}01482 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01483}01483         \textcolor{comment}{// Now assemble the equations dJy/dparameter = 0}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01484}01484         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01485}01485         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01486}01486           dres\_dparam[raw\_ndof + 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01487}01487           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < raw\_ndof; j++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01488}01488           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01489}01489             dres\_dparam[raw\_ndof + 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01490}01490               djac\_dparam(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(j)];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01491}01491           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01492}01492         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01493}01493       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01494}01494       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01495}01495 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01496}01496       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01497}01497         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01498}01498         error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01499}01499           << \textcolor{stringliteral}{"{}The Solve\_which\_system flag can only take values 0, 1, 2"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01500}01500           << \textcolor{stringliteral}{"{} not "{}} << \mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01501}01501         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01502}01502           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01503}01503     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01504}01504   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01505}01505 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01506}01506 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01507}01507   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01508}01508 \textcolor{comment}{  /// Overload the derivative of the residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01509}01509 \textcolor{comment}{  /// with respect to a parameter so that it breaks because it should not}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01510}01510 \textcolor{comment}{  /// be required}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01511}01511 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01512}\mbox{\hyperlink{classoomph_1_1FoldHandler_a674cf9fe7c065e54c95813c2baeea84c}{01512}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_a674cf9fe7c065e54c95813c2baeea84c}{FoldHandler::get\_djacobian\_dparameter}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01513}01513                                              \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01514}01514                                              \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dres\_dparam,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01515}01515                                              \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& djac\_dparam)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01516}01516   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01517}01517     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01518}01518     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01519}01519       << \textcolor{stringliteral}{"{}This function has not been implemented because it is not required\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01520}01520     error\_stream << \textcolor{stringliteral}{"{}in standard problems.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01521}01521     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01522}01522       << \textcolor{stringliteral}{"{}If you find that you need it, you will have to implement it!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01523}01523 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01524}01524     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01525}01525       error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01526}01526   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01527}01527 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01528}01528 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01529}01529   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01530}01530 \textcolor{comment}{  /// Overload the hessian vector product function so that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01531}01531 \textcolor{comment}{  /// it breaks because it should not be required}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01532}01532 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01533}\mbox{\hyperlink{classoomph_1_1FoldHandler_aa633b80f1ebdb322350c6832fe6c2b6c}{01533}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_aa633b80f1ebdb322350c6832fe6c2b6c}{FoldHandler::get\_hessian\_vector\_products}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01534}01534     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01535}01535     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \textcolor{keyword}{const}\& Y,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01536}01536     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} \textcolor{keyword}{const}\& C,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01537}01537     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& product)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01538}01538   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01539}01539     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01540}01540     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01541}01541       << \textcolor{stringliteral}{"{}This function has not been implemented because it is not required\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01542}01542     error\_stream << \textcolor{stringliteral}{"{}in standard problems.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01543}01543     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01544}01544       << \textcolor{stringliteral}{"{}If you find that you need it, you will have to implement it!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01545}01545 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01546}01546     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01547}01547       error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01548}01548   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01549}01549 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01550}01550 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01551}01551   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01552}01552 \textcolor{comment}{  /// Return the eigenfunction(s) associated with the bifurcation that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01553}01553 \textcolor{comment}{  /// has been detected in bifurcation tracking problems}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01554}01554 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01555}\mbox{\hyperlink{classoomph_1_1FoldHandler_aca97058722ccc1482ae8180ea8dde74c}{01555}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_aca97058722ccc1482ae8180ea8dde74c}{FoldHandler::get\_eigenfunction}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& eigenfunction)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01556}01556   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01557}01557     \textcolor{comment}{// There is only one (real) null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01558}01558     eigenfunction.resize(1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01559}01559     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(\mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01560}01560     \textcolor{comment}{// Rebuild the vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01561}01561     eigenfunction[0].build(\&dist, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01562}01562     \textcolor{comment}{// Set the value to be the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01563}01563     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01564}01564     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01565}01565       eigenfunction[0][n] = \mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01566}01566     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01567}01567   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01568}01568 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01569}01569 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01570}01570   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01571}01571 \textcolor{comment}{  /// Destructor return the problem to its original (non-\/augmented) state}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01572}01572 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01573}\mbox{\hyperlink{classoomph_1_1FoldHandler_ab582d9ac969e0f7779a285d21a6d8e45}{01573}}   \mbox{\hyperlink{classoomph_1_1FoldHandler_ab582d9ac969e0f7779a285d21a6d8e45}{FoldHandler::\string~FoldHandler}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01574}01574   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01575}01575     \textcolor{comment}{// If we are using the block solver reset the problem's linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01576}01576     \textcolor{comment}{// to the original one}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01577}01577     \mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver}{AugmentedBlockFoldLinearSolver}}* block\_fold\_solver\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01578}01578       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver}{AugmentedBlockFoldLinearSolver}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01579}01579         \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01580}01580 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01581}01581     \textcolor{keywordflow}{if} (block\_fold\_solver\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01582}01582     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01583}01583       \textcolor{comment}{// Reset the problem's linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01584}01584       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}() = block\_fold\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1AugmentedBlockFoldLinearSolver_a5d7f8e5aa6f72e5113bd02b1a211d74e}{linear\_solver\_pt}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01585}01585       \textcolor{comment}{// Delete the block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01586}01586       \textcolor{keyword}{delete} block\_fold\_solver\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01587}01587     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01588}01588 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01589}01589     \textcolor{comment}{// Resize the number of dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01590}01590     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01591}01591     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01592}01592       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01593}01593     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01594}01594     \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01595}01595   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01596}01596 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01597}01597   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01598}01598 \textcolor{comment}{  /// Set to solve the augmented-\/by-\/one block system.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01599}01599 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01600}\mbox{\hyperlink{classoomph_1_1FoldHandler_a7718a18444f6e328953dd5d5e73802f8}{01600}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_a7718a18444f6e328953dd5d5e73802f8}{FoldHandler::solve\_augmented\_block\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01601}01601   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01602}01602     \textcolor{comment}{// Only bother to do anything if we haven't already set the flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01603}01603     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} != \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eaf82a4e892f7e8ed53e41dc82acbc92cd}{Block\_augmented\_J}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01604}01604     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01605}01605       \textcolor{comment}{// If we were solving the system with the original jacobian add the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01606}01606       \textcolor{comment}{// parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01607}01607       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} == \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3ea28dfb90a98027e2204ea1872c498454c}{Block\_J}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01608}01608       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01609}01609         \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\mbox{\hyperlink{classoomph_1_1FoldHandler_ae32fb6242e77a273f82de2c491d36314}{Parameter\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01610}01610       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01611}01611 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01612}01612       \textcolor{comment}{// Restrict the problem to the standard variables and}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01613}01613       \textcolor{comment}{// the bifurcation parameter only}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01614}01614       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} + 1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01615}01615       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01616}01616         \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} + 1, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01617}01617       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01618}01618       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01619}01619       \textcolor{comment}{// Set the solve flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01620}01620       \mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} = \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eaf82a4e892f7e8ed53e41dc82acbc92cd}{Block\_augmented\_J}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01621}01621     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01622}01622   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01623}01623 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01624}01624 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01625}01625   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01626}01626 \textcolor{comment}{  /// Set to solve the block system. The boolean flag specifies}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01627}01627 \textcolor{comment}{  /// whether the block decomposition should use exactly the same jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01628}01628 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01629}\mbox{\hyperlink{classoomph_1_1FoldHandler_abf0c7293014112731f0482e464f4daa3}{01629}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_abf0c7293014112731f0482e464f4daa3}{FoldHandler::solve\_block\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01630}01630   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01631}01631     \textcolor{comment}{// Only bother to do anything if we haven't already set the flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01632}01632     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} != \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3ea28dfb90a98027e2204ea1872c498454c}{Block\_J}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01633}01633     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01634}01634       \textcolor{comment}{// Restrict the problem to the standard variables}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01635}01635       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(\mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01636}01636       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01637}01637         \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01638}01638       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01639}01639       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01640}01640 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01641}01641       \textcolor{comment}{// Set the solve flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01642}01642       \mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} = \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3ea28dfb90a98027e2204ea1872c498454c}{Block\_J}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01643}01643     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01644}01644   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01645}01645 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01646}01646   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01647}01647 \textcolor{comment}{  /// Set to Solve non-\/block system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01648}01648 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01649}\mbox{\hyperlink{classoomph_1_1FoldHandler_a506c9a7bb372c6d8799c6dabc9448f46}{01649}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1FoldHandler_a506c9a7bb372c6d8799c6dabc9448f46}{FoldHandler::solve\_full\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01650}01650   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01651}01651     \textcolor{comment}{// Only do something if we are not solving the full system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01652}01652     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} != \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eab20273d36c24fa39780d04503ff186c5}{Full\_augmented}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01653}01653     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01654}01654       \textcolor{comment}{// If we were solving the problem without any augmentation,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01655}01655       \textcolor{comment}{// add the parameter again}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01656}01656       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} == \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3ea28dfb90a98027e2204ea1872c498454c}{Block\_J}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01657}01657       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01658}01658         \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\mbox{\hyperlink{classoomph_1_1FoldHandler_ae32fb6242e77a273f82de2c491d36314}{Parameter\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01659}01659       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01660}01660 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01661}01661       \textcolor{comment}{// Always add the additional unknowns back into the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01662}01662       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01663}01663       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01664}01664         \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1FoldHandler_ac8697e5d9484fc0488d4c16b822c792e}{Y}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01665}01665       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01666}01666 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01667}01667       \textcolor{comment}{// update the Dof distribution pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01668}01668       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01669}01669         \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1FoldHandler_aa3f143846245ecea5967ba7c79bedf56}{Ndof}} * 2 + 1, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01670}01670       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01671}01671       \mbox{\hyperlink{classoomph_1_1FoldHandler_a2bd14323ca059b1aaef045cb9cc4013b}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01672}01672 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01673}01673       \mbox{\hyperlink{classoomph_1_1FoldHandler_a76ecb78ebc1d48e5511b70660953f02d}{Solve\_which\_system}} = \mbox{\hyperlink{classoomph_1_1FoldHandler_a860a661fa02e4f000292fa19ea94df3eab20273d36c24fa39780d04503ff186c5}{Full\_augmented}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01674}01674     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01675}01675   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01676}01676 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01677}01677 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01678}01678   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01679}01679 \textcolor{comment}{  /// Clean up the memory that may have been allocated by the solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01680}01680 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01681}\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3fa97815fefc83c678341222847797ea}{01681}}   \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3fa97815fefc83c678341222847797ea}{BlockPitchForkLinearSolver::\string~BlockPitchForkLinearSolver}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01682}01682   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01683}01683     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01684}01684     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01685}01685       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01686}01686     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01687}01687     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01688}01688     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01689}01689       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01690}01690     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01691}01691     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01692}01692     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01693}01693       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01694}01694     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01695}01695     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3ceff96adc374fb588f106cc3cc9b435}{dJy\_dparam\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01696}01696     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01697}01697       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3ceff96adc374fb588f106cc3cc9b435}{dJy\_dparam\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01698}01698     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01699}01699   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01700}01700 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01701}01701   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01702}01702 \textcolor{comment}{  /// Use a block factorisation to solve the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01703}01703 \textcolor{comment}{  /// associated with a PitchFork bifurcation.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01704}01704 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01705}\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ad196867613954a8fabd318b50e2aadc6}{01705}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ad196867613954a8fabd318b50e2aadc6}{BlockPitchForkLinearSolver::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01706}01706                                          \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01707}01707   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01708}01708     std::cout << \textcolor{stringliteral}{"{}Block pitchfork solve"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01709}01709     \textcolor{comment}{// Locally cache the pointer to the handler.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01710}01710     \mbox{\hyperlink{classoomph_1_1PitchForkHandler}{PitchForkHandler}}* handler\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01711}01711       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1PitchForkHandler}{PitchForkHandler}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01712}01712 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01713}01713     \textcolor{comment}{// Get the augmented distribution from the handler and use it as}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01714}01714     \textcolor{comment}{// the distribution of the linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01715}01715     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} aug\_dist =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01716}01716       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_af6346c1dc77f3d4fb3dc8950afd91e0f}{Augmented\_dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01717}01717     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(aug\_dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01718}01718 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01719}01719     \textcolor{comment}{// If the result vector is not setup then die}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01720}01720     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01721}01721     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01722}01722       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Result vector must be built\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01723}01723                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01724}01724                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01725}01725     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01726}01726 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01727}01727     \textcolor{comment}{// Store the distribution of the result, which is probably not in}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01728}01728     \textcolor{comment}{// the natural distribution of the augmented solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01729}01729     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} result\_dist(result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01730}01730 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01731}01731     \textcolor{comment}{// Locally cache a pointer to the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01732}01732     \textcolor{keywordtype}{double}* \textcolor{keyword}{const} parameter\_pt = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa0e8800d56e68fcb63ec2315f503cab2}{Parameter\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01733}01733 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01734}01734     \textcolor{comment}{// Firstly get the derivatives of the full augmented system with}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01735}01735     \textcolor{comment}{// respect to the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01736}01736 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01737}01737     \textcolor{comment}{// Allocate storage for the derivatives of the residuals with respect}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01738}01738     \textcolor{comment}{// to the global parameter using the augmented distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01739}01739     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} dRdparam;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01740}01740     \textcolor{comment}{// Then get the appropriate derivatives which will come back in}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01741}01741     \textcolor{comment}{// some distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01742}01742     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{get\_derivative\_wrt\_global\_parameter}}(parameter\_pt, dRdparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01743}01743     \textcolor{comment}{// Redistribute into the augmented distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01744}01744     dRdparam.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&aug\_dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01745}01745 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01746}01746     \textcolor{comment}{// Switch the handler to "{}block solver"{} mode (sort out distribution)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01747}01747     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad193c3d67741edd60b023c94e42c8802}{solve\_block\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01748}01748 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01749}01749     \textcolor{comment}{// Temporary vector for the result (I shouldn't have to set this up)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01750}01750     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x1;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01751}01751 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01752}01752     \textcolor{comment}{// We are going to do resolves using the underlying linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01753}01753     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01754}01754     \textcolor{comment}{// Solve the first (standard) system Jx1 = R}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01755}01755     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, x1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01756}01756 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01757}01757     \textcolor{comment}{// Allocate storage for B, C and D which can be used in the resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01758}01758     \textcolor{comment}{// and the derivatives of the jacobian/eigenvector product with}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01759}01759     \textcolor{comment}{// respect to the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01760}01760     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01761}01761     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01762}01762       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01763}01763     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01764}01764     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01765}01765     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01766}01766     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01767}01767       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01768}01768     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01769}01769     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01770}01770     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01771}01771     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01772}01772       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01773}01773     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01774}01774     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01775}01775     \textcolor{comment}{// Need this to be in the distribution of the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01776}01776     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3ceff96adc374fb588f106cc3cc9b435}{dJy\_dparam\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01777}01777     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01778}01778       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3ceff96adc374fb588f106cc3cc9b435}{dJy\_dparam\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01779}01779     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01780}01780     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3ceff96adc374fb588f106cc3cc9b435}{dJy\_dparam\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01781}01781 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01782}01782     \textcolor{comment}{// Get the symmetry vector from the handler should have the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01783}01783     \textcolor{comment}{// Dof distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01784}01784     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} psi = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01785}01785 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01786}01786     \textcolor{comment}{// Temporary vector for the rhs that is dR/dparam (augmented distribution)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01787}01787     \textcolor{comment}{// DoubleVector F(Linear\_solver\_pt-\/>distribution\_pt(),0.0);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01788}01788     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} \mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927}{F}}(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01789}01789     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_local = \mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927}{F}}.nrow\_local();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01790}01790 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01791}01791     \textcolor{comment}{// f.nrow local copied from dRdparam}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01792}01792     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01793}01793     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01794}01794       \mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927}{F}}[n] = dRdparam[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01795}01795     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01796}01796     \textcolor{comment}{// Fill in the rhs that is dJy/dparam  //dJy\_dparam nrow local}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01797}01797 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01798}01798     \textcolor{comment}{// In standard cases the offset here will be one}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01799}01799     \textcolor{keywordtype}{unsigned} offset = 1;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01800}01800 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01801}01801     \textcolor{comment}{// If we are distributed and not on the first processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01802}01802     \textcolor{comment}{// then there is no offset and the eigenfunction is}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01803}01803     \textcolor{comment}{// directly after the standard dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01804}01804     \textcolor{keywordtype}{int} my\_rank = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01805}01805     \textcolor{keywordflow}{if} ((problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}()) \&\& (my\_rank != 0))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01806}01806     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01807}01807       offset = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01808}01808     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01809}01809 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01810}01810     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01811}01811     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01812}01812       (*dJy\_dparam\_pt)[n] = dRdparam[n\_dof\_local + offset + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01813}01813     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01814}01814 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01815}01815     \textcolor{comment}{// Now resolve to find c and d}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01816}01816     \textcolor{comment}{// First, redistribute F and psi into the linear algebra distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01817}01817     \mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927}{F}}.redistribute(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01818}01818     psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01819}01819 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01820}01820     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(\mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927}{F}}, *\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01821}01821     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(psi, *\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01822}01822 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01823}01823     \textcolor{comment}{// We can now construct various dot products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01824}01824     \textcolor{keywordtype}{double} psi\_d = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(*\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01825}01825     \textcolor{keywordtype}{double} psi\_c = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(*\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01826}01826     \textcolor{keywordtype}{double} psi\_x1 = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(x1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01827}01827 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01828}01828     \textcolor{comment}{// Calculate another intermediate constant}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01829}01829     \textcolor{keyword}{const} \textcolor{keywordtype}{double} Psi = psi\_d / psi\_c;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01830}01830 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01831}01831     \textcolor{comment}{// Construct the second intermediate value,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01832}01832     \textcolor{comment}{// assumption is that result has been}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01833}01833     \textcolor{comment}{// set to the current value of the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01834}01834     \textcolor{comment}{// First, redistribute into the Natural distribution of the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01835}01835     result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&aug\_dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01836}01836     \textcolor{comment}{// The required parameter is that corresponding to the dof, which}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01837}01837     \textcolor{comment}{// is only stored on the root processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01838}01838     \textcolor{keywordtype}{double} parameter\_residual = result[n\_dof\_local];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01839}01839 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01840}01840     \textcolor{comment}{// Broadcast to all others, if we have a distributed problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01841}01841     \textcolor{keywordflow}{if} (problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01842}01842     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01843}01843       MPI\_Bcast(\&parameter\_residual,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01844}01844                 1,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01845}01845                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01846}01846                 0,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01847}01847                 problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01848}01848     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01849}01849 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01850}01850     \textcolor{comment}{// Now construct the value}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01851}01851     \textcolor{keywordtype}{double} x2 = (psi\_x1 -\/ parameter\_residual) / psi\_c;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01852}01852 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01853}01853     \textcolor{comment}{// Now construct the vectors that multiply the jacobian terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01854}01854     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVectorWithHaloEntries>}} D\_and\_X1(2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01855}01855     D\_and\_X1[0].build(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01856}01856     D\_and\_X1[1].build(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01857}01857     \textcolor{comment}{// Fill in the appropriate terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01858}01858     \textcolor{comment}{// Get the number of local dofs from the Linear\_solver\_pt distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01859}01859     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_local\_linear\_solver =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01860}01860       \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01861}01861     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local\_linear\_solver; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01862}01862     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01863}01863       \textcolor{keyword}{const} \textcolor{keywordtype}{double} C\_ = (*C\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01864}01864       D\_and\_X1[0][n] = (*D\_pt)[n] -\/ Psi * C\_;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01865}01865       D\_and\_X1[1][n] = x1[n] -\/ x2 * C\_;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01866}01866     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01867}01867 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01868}01868     \textcolor{comment}{// Local storage for the result of the product terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01869}01869     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVectorWithHaloEntries>}} Jprod\_D\_and\_X1(2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01870}01870 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01871}01871     \textcolor{comment}{// Redistribute the inputs to have the Dof distribution pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01872}01872     D\_and\_X1[0].redistribute(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01873}01873     D\_and\_X1[1].redistribute(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01874}01874 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01875}01875     \textcolor{comment}{// Set up the halo scheme}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01876}01876 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01877}01877     D\_and\_X1[0].build\_halo\_scheme(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01878}01878     D\_and\_X1[1].build\_halo\_scheme(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01879}01879 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01880}01880 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01881}01881     \textcolor{comment}{// Get the products from the new problem function}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01882}01882     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac65cbe00a72cfc91ccaea10818f1a507}{get\_hessian\_vector\_products}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01883}01883       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}, D\_and\_X1, Jprod\_D\_and\_X1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01884}01884 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01885}01885     \textcolor{comment}{// OK, now we can formulate the next vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01886}01886     \textcolor{comment}{//(again assuming result contains residuals)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01887}01887     \textcolor{comment}{// Need to redistribute F to the dof distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01888}01888     \textcolor{comment}{// F.redistribute(handler\_pt-\/>Dof\_distribution\_pt);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01889}01889     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} G(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01890}01890 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01891}01891     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01892}01892     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01893}01893       G[n] = result[n\_dof\_local + offset + n] -\/ Jprod\_D\_and\_X1[1][n] -\/}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01894}01894              x2 * dRdparam[n\_dof\_local + offset + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01895}01895       Jprod\_D\_and\_X1[0][n] *= -\/1.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01896}01896       Jprod\_D\_and\_X1[0][n] -\/= Psi * dRdparam[n\_dof\_local + offset + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01897}01897     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01898}01898 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01899}01899 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01900}01900     \textcolor{comment}{// Then redistribute back to the linear solver distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01901}01901     G.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01902}01902     Jprod\_D\_and\_X1[0].redistribute(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01903}01903     Jprod\_D\_and\_X1[1].redistribute(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01904}01904 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01905}01905     \textcolor{comment}{// Linear solve to get B}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01906}01906     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(Jprod\_D\_and\_X1[0], *\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01907}01907     \textcolor{comment}{// Liner solve to get x3}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01908}01908     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x3(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01909}01909     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(G, x3);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01910}01910 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01911}01911     \textcolor{comment}{// Construst a couple of additional products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01912}01912     \textcolor{keywordtype}{double} l\_x3 = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(x3);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01913}01913     \textcolor{keywordtype}{double} l\_b = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(*\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01914}01914 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01915}01915     \textcolor{comment}{// get the last intermediate variable}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01916}01916     \textcolor{comment}{// The required parameter is that corresponding to the dof, which}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01917}01917     \textcolor{comment}{// is only stored on the root processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01918}01918     \textcolor{keywordtype}{double} sigma\_residual = result[2 * (n\_dof\_local + offset) -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01919}01919 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01920}01920     \textcolor{comment}{// Broadcast to all others, if we have a distributed problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01921}01921     \textcolor{keywordflow}{if} (problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01922}01922     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01923}01923       MPI\_Bcast(\&sigma\_residual,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01924}01924                 1,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01925}01925                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01926}01926                 0,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01927}01927                 problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01928}01928     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01929}01929 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01930}01930 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01931}01931 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01932}01932     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_sigma = (l\_x3 -\/ sigma\_residual) / l\_b;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01933}01933     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_lambda = x2 -\/ delta\_sigma * Psi;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01934}01934 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01935}01935     \textcolor{comment}{// Need to do some more rearrangements here because result is global}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01936}01936     \textcolor{comment}{// but the other vectors are not!}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01937}01937 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01938}01938     \textcolor{comment}{// Create temporary DoubleVectors to hold the results}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01939}01939     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} res1(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01940}01940     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} res2(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01941}01941 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01942}01942     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local\_linear\_solver; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01943}01943     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01944}01944       res1[n] = x1[n] -\/ delta\_lambda * (*C\_pt)[n] -\/ delta\_sigma * (*D\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01945}01945       res2[n] = x3[n] -\/ delta\_sigma * (*B\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01946}01946     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01947}01947 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01948}01948     \textcolor{comment}{// Now redistribute these into the Dof distribution pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01949}01949     res1.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01950}01950     res2.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01951}01951 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01952}01952     \textcolor{comment}{// Now can copy over into results into the result vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01953}01953     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01954}01954     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01955}01955       result[n] = res1[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01956}01956       result[n\_dof\_local + offset + n] = res2[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01957}01957     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01958}01958 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01959}01959     \textcolor{comment}{// Add the final contributions to the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01960}01960     \textcolor{comment}{// only on the root processor if we have a distributed problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01961}01961 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01962}01962     \textcolor{keywordflow}{if} ((!problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}()) || (my\_rank == 0))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01963}01963 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01964}01964     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01965}01965       result[n\_dof\_local] = delta\_lambda;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01966}01966       result[2 * n\_dof\_local + 1] = delta\_sigma;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01967}01967     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01968}01968 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01969}01969 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01970}01970     \textcolor{comment}{// The sign of the determinant is given by the sign of}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01971}01971     \textcolor{comment}{// the product psi\_c and l\_b}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01972}01972     \textcolor{comment}{// NOT CHECKED YET!}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01973}01973     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}() =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01974}01974       \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(std::fabs(psi\_c * l\_b) / (psi\_c * l\_b));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01975}01975 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01976}01976     \textcolor{comment}{// Redistribute the result into its incoming distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01977}01977     result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&result\_dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01978}01978 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01979}01979     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01980}01980     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a27325616f4342d159f6f5e7c82ccdf98}{solve\_full\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01981}01981 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01982}01982     \textcolor{comment}{// If we are not storing things, clear the results}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01983}01983     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01984}01984     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01985}01985       \textcolor{comment}{// We no longer need to store the matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01986}01986       \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01987}01987       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01988}01988       \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01989}01989       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01990}01990       \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01991}01991       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01992}01992       \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01993}01993       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3ceff96adc374fb588f106cc3cc9b435}{dJy\_dparam\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01994}01994       \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3ceff96adc374fb588f106cc3cc9b435}{dJy\_dparam\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01995}01995     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01996}01996     \textcolor{comment}{// Otherwise also store the pointer to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01997}01997     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01998}01998     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l01999}01999       \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a5819a48984aa1a9a68c28e106bc22f90}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02000}02000     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02001}02001   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02002}02002 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02003}02003 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02004}02004   \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02005}02005   \textcolor{comment}{// Hack the re-\/solve to use the block factorisation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02006}02006   \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02007}\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a9a424fd2ae0b67ef8c3ff59f16030786}{02007}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a9a424fd2ae0b67ef8c3ff59f16030786}{BlockPitchForkLinearSolver::resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02008}02008                                            \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02009}02009   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02010}02010     std::cout << \textcolor{stringliteral}{"{}Block pitchfork resolve"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02011}02011     \textcolor{comment}{// Check that the factors have been stored}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02012}02012     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02013}02013     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02014}02014       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The required vectors have not been stored"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02015}02015                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02016}02016                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02017}02017     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02018}02018 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02019}02019 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02020}02020     \textcolor{comment}{// Cache pointer to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02021}02021     \mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const} problem\_pt = \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a5819a48984aa1a9a68c28e106bc22f90}{Problem\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02022}02022 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02023}02023     \textcolor{comment}{// Locally cache pointer to the handler}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02024}02024     \mbox{\hyperlink{classoomph_1_1PitchForkHandler}{PitchForkHandler}}* handler\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02025}02025       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1PitchForkHandler}{PitchForkHandler}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02026}02026 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02027}02027     \textcolor{comment}{// Get the augmented distribution from the handler}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02028}02028     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} aug\_dist =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02029}02029       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_af6346c1dc77f3d4fb3dc8950afd91e0f}{Augmented\_dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02030}02030     \textcolor{comment}{// this-\/>build\_distribution(aug\_dist);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02031}02031 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02032}02032     \textcolor{comment}{// Find the number of dofs of the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02033}02033     \textcolor{comment}{// const unsigned n\_aug\_dof = problem\_pt-\/>ndof();}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02034}02034 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02035}02035     \textcolor{comment}{// Storage for the result distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02036}02036     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} result\_dist;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02037}02037 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02038}02038     \textcolor{comment}{// if the result vector is not setup then rebuild with distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02039}02039     \textcolor{comment}{// = natural distribution of augmented solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02040}02040     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02041}02041     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02042}02042       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\&aug\_dist, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02043}02043     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02044}02044     \textcolor{comment}{// Otherwise store the incoming distribution and redistribute}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02045}02045     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02046}02046     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02047}02047       result\_dist.\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02048}02048       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&aug\_dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02049}02049     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02050}02050 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02051}02051 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02052}02052     \textcolor{comment}{// Locally cache a pointer to the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02053}02053     \textcolor{comment}{// double* const parameter\_pt = handler\_pt-\/>Parameter\_pt;}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02054}02054 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02055}02055     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02056}02056     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad193c3d67741edd60b023c94e42c8802}{solve\_block\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02057}02057     \textcolor{comment}{// We need to find out the number of dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02058}02058     \textcolor{comment}{// unsigned n\_dof = problem\_pt-\/>ndof();}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02059}02059 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02060}02060     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02061}02061     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02062}02062     \textcolor{comment}{// LinearAlgebraDistribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02063}02063     \textcolor{comment}{// dist(problem\_pt-\/>communicator\_pt(),n\_dof,false);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02064}02064     \textcolor{comment}{// this-\/>build\_distribution(dist);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02065}02065 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02066}02066     \textcolor{comment}{// if the result vector is not setup then rebuild with distribution = global}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02067}02067     \textcolor{comment}{// if (!result.built())}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02068}02068     \textcolor{comment}{// \{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02069}02069     \textcolor{comment}{//  result.build(this-\/>distribution\_pt(),0.0);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02070}02070     \textcolor{comment}{// \}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02071}02071 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02072}02072 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02073}02073     \textcolor{comment}{// Copy the rhs into local storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02074}02074     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} rhs\_local = rhs;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02075}02075     \textcolor{comment}{// and redistribute into the augmented distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02076}02076     rhs\_local.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&aug\_dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02077}02077 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02078}02078     \textcolor{comment}{// Setup storage for output}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02079}02079     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x1(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02080}02080     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x3(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02081}02081 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02082}02082     \textcolor{comment}{// Create input for RHS with the natural distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02083}02083     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} input\_x1(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02084}02084     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_local = input\_x1.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a9bd7e1d242c69a28da85a804a7717fce}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02085}02085 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02086}02086     \textcolor{comment}{// Set the values of the a vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02087}02087     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02088}02088     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02089}02089       input\_x1[n] = rhs\_local[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02090}02090     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02091}02091     \textcolor{comment}{// Need to redistribute into the linear algebra distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02092}02092     input\_x1.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02093}02093 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02094}02094     \textcolor{comment}{// We want to resolve, of course}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02095}02095     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02096}02096     \textcolor{comment}{// Now solve for the first vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02097}02097     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(input\_x1, x1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02098}02098 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02099}02099     \textcolor{comment}{// Get the symmetry vector from the handler}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02100}02100     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} psi = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02101}02101     \textcolor{comment}{// redistribute local copy}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02102}02102     psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02103}02103 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02104}02104     \textcolor{comment}{// We can now construct various dot products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02105}02105     \textcolor{keywordtype}{double} psi\_d = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(*\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a3178ff5ce055b76423b30357022f9e58}{D\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02106}02106     \textcolor{keywordtype}{double} psi\_c = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(*\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_ac9f8e9f84f79437b43e35ae2850ec335}{C\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02107}02107     \textcolor{keywordtype}{double} psi\_x1 = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(x1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02108}02108 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02109}02109     \textcolor{comment}{// Calculate another intermediate constant}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02110}02110     \textcolor{keyword}{const} \textcolor{keywordtype}{double} Psi = psi\_d / psi\_c;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02111}02111 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02112}02112     \textcolor{comment}{// Construct the second intermediate value,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02113}02113     \textcolor{comment}{// assumption is that rhs has been set to the current value of the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02114}02114     \textcolor{keywordtype}{double} parameter\_residual = rhs\_local[n\_dof\_local];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02115}02115 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02116}02116     \textcolor{comment}{// Broadcast to all others, if we have a distributed problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02117}02117     \textcolor{keywordflow}{if} (problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02118}02118     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02119}02119       MPI\_Bcast(\&parameter\_residual,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02120}02120                 1,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02121}02121                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02122}02122                 0,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02123}02123                 problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02124}02124     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02125}02125 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02126}02126 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02127}02127     \textcolor{keywordtype}{double} x2 = (psi\_x1 -\/ parameter\_residual) / psi\_c;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02128}02128 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02129}02129     \textcolor{comment}{// Now construct the vectors that multiply the jacobian terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02130}02130     \textcolor{comment}{// Vector<double> X1(n\_dof/*+1*/);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02131}02131     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVectorWithHaloEntries>}} X1(1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02132}02132     X1[0].build(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02133}02133 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02134}02134     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_local\_linear\_solver =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02135}02135       \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02136}02136     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local\_linear\_solver; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02137}02137     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02138}02138       X1[0][n] = x1[n] -\/ x2 * (*C\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02139}02139     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02140}02140 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02141}02141     \textcolor{comment}{// Local storage for the product term}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02142}02142     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVectorWithHaloEntries>}} Jprod\_X1(1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02143}02143 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02144}02144     \textcolor{comment}{// Redistribute the inputs to have the Dof distribution pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02145}02145     X1[0].redistribute(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02146}02146 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02147}02147     \textcolor{comment}{// Set up the halo scheme}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02148}02148 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02149}02149     X1[0].build\_halo\_scheme(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02150}02150 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02151}02151 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02152}02152     \textcolor{comment}{// Get the product from the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02153}02153     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac65cbe00a72cfc91ccaea10818f1a507}{get\_hessian\_vector\_products}}(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}, X1, Jprod\_X1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02154}02154 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02155}02155     \textcolor{comment}{// In standard cases the offset here will be one}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02156}02156     \textcolor{keywordtype}{unsigned} offset = 1;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02157}02157 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02158}02158     \textcolor{comment}{// If we are distributed and not on the first processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02159}02159     \textcolor{comment}{// then there is no offset and the eigenfunction is}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02160}02160     \textcolor{comment}{// directly after the standard dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02161}02161     \textcolor{keywordtype}{int} my\_rank = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02162}02162     \textcolor{keywordflow}{if} ((problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}()) \&\& (my\_rank != 0))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02163}02163     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02164}02164       offset = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02165}02165     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02166}02166 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02167}02167 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02168}02168     \textcolor{comment}{// OK, now we can formulate the next vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02169}02169     \textcolor{comment}{//(again assuming result contains residuals)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02170}02170     \textcolor{comment}{// Local storage for the product terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02171}02171     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} Mod\_Jprod\_X1(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02172}02172 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02173}02173     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02174}02174     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02175}02175       Mod\_Jprod\_X1[n] = rhs\_local[n\_dof\_local + offset + n] -\/ Jprod\_X1[0][n] -\/}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02176}02176                         x2 * (*dJy\_dparam\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02177}02177     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02178}02178 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02179}02179     \textcolor{comment}{// Redistribute back to the linear solver distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02180}02180     Mod\_Jprod\_X1.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02181}02181 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02182}02182     \textcolor{comment}{// Liner solve to get x3}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02183}02183     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(Mod\_Jprod\_X1, x3);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02184}02184 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02185}02185     \textcolor{comment}{// Construst a couple of additional products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02186}02186     \textcolor{keywordtype}{double} l\_x3 = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(x3);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02187}02187     \textcolor{keywordtype}{double} l\_b = psi.\mbox{\hyperlink{classoomph_1_1DoubleVector_abd20e2e394c8e08749ed34c7228c8506}{dot}}(*\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a4e88432fbf8e7cdefbfbd2c67860505e}{B\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02188}02188 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02189}02189     \textcolor{comment}{// get the last intermediate variable}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02190}02190     \textcolor{comment}{// The required parameter is that corresponding to the dof, which}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02191}02191     \textcolor{comment}{// is only stored on the root processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02192}02192     \textcolor{keywordtype}{double} sigma\_residual = rhs\_local[2 * (n\_dof\_local + offset) -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02193}02193 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02194}02194     \textcolor{comment}{// Broadcast to all others, if we have a distributed problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02195}02195     \textcolor{keywordflow}{if} (problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02196}02196     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02197}02197       MPI\_Bcast(\&sigma\_residual,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02198}02198                 1,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02199}02199                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02200}02200                 0,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02201}02201                 problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02202}02202     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02203}02203 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02204}02204 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02205}02205     \textcolor{comment}{// get the last intermediate variable}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02206}02206     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_sigma = (l\_x3 -\/ sigma\_residual) / l\_b;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02207}02207     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_lambda = x2 -\/ delta\_sigma * Psi;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02208}02208 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02209}02209     \textcolor{comment}{// Create temporary DoubleVectors to hold the results}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02210}02210     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} res1(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02211}02211     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} res2(\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02212}02212 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02213}02213     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local\_linear\_solver; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02214}02214     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02215}02215       res1[n] = x1[n] -\/ delta\_lambda * (*C\_pt)[n] -\/ delta\_sigma * (*D\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02216}02216       res2[n] = x3[n] -\/ delta\_sigma * (*B\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02217}02217     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02218}02218 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02219}02219     \textcolor{comment}{// Now redistribute these into the Dof distribution pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02220}02220     res1.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02221}02221     res2.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02222}02222 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02223}02223     \textcolor{comment}{// Now can copy over into results into the result vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02224}02224     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02225}02225     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02226}02226       result[n] = res1[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02227}02227       result[n\_dof\_local + offset + n] = res2[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02228}02228     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02229}02229 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02230}02230     \textcolor{comment}{// Add the final contributions to the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02231}02231     \textcolor{comment}{// only on the root processor if we have a distributed problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02232}02232 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02233}02233     \textcolor{keywordflow}{if} ((!problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}()) || (my\_rank == 0))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02234}02234 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02235}02235     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02236}02236       result[n\_dof\_local] = delta\_lambda;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02237}02237       result[2 * n\_dof\_local + 1] = delta\_sigma;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02238}02238     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02239}02239 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02240}02240     \textcolor{comment}{// Redistribute the result into its incoming distribution (if it had one)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02241}02241     \textcolor{keywordflow}{if} (result\_dist.\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a92bfff97fd228b9c528922c39ab563b2}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02242}02242     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02243}02243       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&result\_dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02244}02244     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02245}02245 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02246}02246     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_afcf84124d724d6bd961870fbcdc7b9e4}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02247}02247 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02248}02248     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02249}02249     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a27325616f4342d159f6f5e7c82ccdf98}{solve\_full\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02250}02250   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02251}02251 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02252}02252 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02253}02253   \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02254}02254 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02255}02255 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02256}02256   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02257}02257 \textcolor{comment}{  /// Clean up the memory that may have been allocated by the solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02258}02258 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02259}\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_ab2d75883791a469b2ce32295ed39ab7d}{02259}}   \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_ab2d75883791a469b2ce32295ed39ab7d}{AugmentedBlockPitchForkLinearSolver::\string~AugmentedBlockPitchForkLinearSolver}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02260}02260   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02261}02261     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02262}02262     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02263}02263       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02264}02264     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02265}02265     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a478bca515ee961576f523b1b5152651f}{E\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02266}02266     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02267}02267       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a478bca515ee961576f523b1b5152651f}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02268}02268     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02269}02269   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02270}02270 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02271}02271   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02272}02272 \textcolor{comment}{  /// Use a block factorisation to solve the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02273}02273 \textcolor{comment}{  /// associated with a PitchFork bifurcation.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02274}02274 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02275}\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a0cbeb150ac83d5be1a1e30c0f728a70b}{02275}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a0cbeb150ac83d5be1a1e30c0f728a70b}{AugmentedBlockPitchForkLinearSolver::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02276}02276                                                   \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02277}02277   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02278}02278     std::cout << \textcolor{stringliteral}{"{}Augmented pitchfork solve"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02279}02279     \textcolor{comment}{// if the result is setup then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02280}02280 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02281}02281     \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02282}02282     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02283}02283       \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02284}02284       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02285}02285         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The result vector must not be distributed"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02286}02286                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02287}02287                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02288}02288       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02289}02289     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02290}02290 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02291}02291 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02292}02292 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02293}02293     \textcolor{comment}{// Locally cache the pointer to the handler.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02294}02294     \mbox{\hyperlink{classoomph_1_1PitchForkHandler}{PitchForkHandler}}* handler\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02295}02295       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1PitchForkHandler}{PitchForkHandler}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02296}02296 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02297}02297     \textcolor{comment}{// Switch the handler to "{}block solver"{} mode}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02298}02298     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad0b0920383bcbdab5df1f43db5affa47}{solve\_augmented\_block\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02299}02299 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02300}02300     \textcolor{comment}{// We need to find out the number of dofs in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02301}02301     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02302}02302 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02303}02303     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02304}02304     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02305}02305     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02306}02306     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02307}02307 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02308}02308     \textcolor{comment}{// if the result vector is not setup then rebuild with distribution = global}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02309}02309     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02310}02310     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02311}02311       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02312}02312     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02313}02313 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02314}02314     \textcolor{comment}{// Setup storage for temporary vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02315}02315     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} a(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02316}02316       b(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02317}02317 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02318}02318     \textcolor{comment}{// Allocate storage for Alpha which can be used in the resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02319}02319     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02320}02320     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02321}02321       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02322}02322     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02323}02323     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02324}02324 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02325}02325     \textcolor{comment}{// We are going to do resolves using the underlying linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02326}02326     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02327}02327     \textcolor{comment}{// Solve the first system Aa = R}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02328}02328     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02329}02329 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02330}02330     \textcolor{comment}{// Get the symmetry vector from the handler}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02331}02331     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} psi(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02332}02332     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < (n\_dof -\/ 1); ++n)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02333}02333     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02334}02334       psi[n] = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02335}02335     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02336}02336     \textcolor{comment}{// Set the final entry to zero}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02337}02337     psi[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02338}02338 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02339}02339     \textcolor{comment}{// Now resolve to find alpha}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02340}02340     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(psi, *\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02341}02341 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02342}02342     \textcolor{comment}{// We can now construct our multipliers}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02343}02343     \textcolor{comment}{// Prepare to scale}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02344}02344     \textcolor{keywordtype}{double} dof\_length = 0.0, a\_length = 0.0, alpha\_length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02345}02345     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02346}02346     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02347}02347       \textcolor{keywordflow}{if} (std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n)) > dof\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02348}02348       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02349}02349         dof\_length = std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02350}02350       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02351}02351       \textcolor{keywordflow}{if} (std::fabs(a[n]) > a\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02352}02352       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02353}02353         a\_length = std::fabs(a[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02354}02354       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02355}02355       \textcolor{keywordflow}{if} (std::fabs((*\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}})[n]) > alpha\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02356}02356       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02357}02357         alpha\_length = std::fabs((*\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}})[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02358}02358       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02359}02359     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02360}02360 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02361}02361     \textcolor{keywordtype}{double} a\_mult = dof\_length / a\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02362}02362     \textcolor{keywordtype}{double} alpha\_mult = dof\_length / alpha\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02363}02363     \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02364}02364     a\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02365}02365     alpha\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02366}02366     a\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02367}02367     alpha\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02368}02368 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02369}02369     \textcolor{comment}{// Local storage for the product terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02370}02370     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} Jprod\_a(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02371}02371       Jprod\_alpha(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02372}02372 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02373}02373     \textcolor{comment}{// Calculate the product of the jacobian matrices, etc}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02374}02374     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02375}02375     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02376}02376     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02377}02377       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02378}02378       \textcolor{comment}{// Loop over the ndofs in each element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02379}02379       \textcolor{keywordtype}{unsigned} n\_var = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ae066fa45e9f1bf10601286ca2d083a42}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02380}02380       \textcolor{comment}{// Get the jacobian matrices}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02381}02381       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac(n\_var), jac\_a(n\_var), jac\_alpha(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02382}02382       \textcolor{comment}{// the elemental residual}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02383}02383       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} res\_elemental(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02384}02384       \textcolor{comment}{// Get unperturbed jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02385}02385       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa6728813a099111bee2b6c79dec20fc4}{get\_jacobian}}(elem\_pt, res\_elemental, jac);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02386}02386 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02387}02387       \textcolor{comment}{// Backup the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02388}02388       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dof\_bac(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02389}02389       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02390}02390       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02391}02391       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02392}02392         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02393}02393         dof\_bac[n] = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02394}02394         \textcolor{comment}{// Pertub by vector a}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02395}02395         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += a\_mult * a[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02396}02396       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02397}02397 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02398}02398       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02399}02399 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02400}02400       \textcolor{comment}{// Now get the new jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02401}02401       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa6728813a099111bee2b6c79dec20fc4}{get\_jacobian}}(elem\_pt, res\_elemental, jac\_a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02402}02402 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02403}02403       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02404}02404       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02405}02405       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02406}02406         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02407}02407         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02408}02408         \textcolor{comment}{// Pertub by vector a}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02409}02409         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += alpha\_mult * (*Alpha\_pt)[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02410}02410       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02411}02411 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02412}02412       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02413}02413 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02414}02414       \textcolor{comment}{// Now get the new jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02415}02415       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa6728813a099111bee2b6c79dec20fc4}{get\_jacobian}}(elem\_pt, res\_elemental, jac\_alpha);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02416}02416 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02417}02417       \textcolor{comment}{// Reset the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02418}02418       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02419}02419       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02420}02420         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02421}02421         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02422}02422       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02423}02423 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02424}02424       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02425}02425 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02426}02426       \textcolor{comment}{// OK, now work out the products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02427}02427       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < (n\_var -\/ 1); n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02428}02428       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02429}02429         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02430}02430         \textcolor{keywordtype}{double} prod\_a = 0.0, prod\_alpha = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02431}02431         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < (n\_var -\/ 1); m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02432}02432         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02433}02433           \textcolor{keywordtype}{unsigned} unknown = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02434}02434           prod\_a += (jac\_a(n, m) -\/ jac(n, m)) * handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02435}02435           prod\_alpha += (jac\_alpha(n, m) -\/ jac(n, m)) * handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02436}02436         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02437}02437         Jprod\_a[eqn\_number] += prod\_a / a\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02438}02438         Jprod\_alpha[eqn\_number] += prod\_alpha / alpha\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02439}02439       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02440}02440     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02441}02441 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02442}02442     Jprod\_alpha[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02443}02443     Jprod\_a[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02444}02444 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02445}02445     \textcolor{comment}{// OK, now we can formulate the next vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02446}02446     \textcolor{comment}{// The assumption here is that the result has been set to the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02447}02447     \textcolor{comment}{// residuals.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02448}02448     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof -\/ 1; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02449}02449     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02450}02450       b[n] = result[n\_dof + n] -\/ Jprod\_a[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02451}02451     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02452}02452     b[n\_dof -\/ 1] = result[2 * n\_dof -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02453}02453 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02454}02454 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02455}02455     \textcolor{comment}{// Allocate storage for E which can be used in the resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02456}02456     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a478bca515ee961576f523b1b5152651f}{E\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02457}02457     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02458}02458       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a478bca515ee961576f523b1b5152651f}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02459}02459     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02460}02460     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a478bca515ee961576f523b1b5152651f}{E\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02461}02461 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02462}02462     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02463}02463 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02464}02464     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(b, f);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02465}02465     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(Jprod\_alpha, *\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a478bca515ee961576f523b1b5152651f}{E\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02466}02466 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02467}02467     \textcolor{comment}{// Calculate the final entry in the vector e}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02468}02468     \textcolor{keyword}{const} \textcolor{keywordtype}{double} e\_final = (*E\_pt)[n\_dof -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02469}02469     \textcolor{comment}{// Calculate the final entry in the vector d}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02470}02470     \textcolor{keyword}{const} \textcolor{keywordtype}{double} d\_final = -\/f[n\_dof -\/ 1] / e\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02471}02471     \textcolor{comment}{// Assemble the final corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02472}02472     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof -\/ 1; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02473}02473     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02474}02474       result[n] = a[n] -\/ (*Alpha\_pt)[n] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02475}02475       result[n\_dof + n] = f[n] + (*E\_pt)[n] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02476}02476     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02477}02477 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02478}02478     result[n\_dof -\/ 1] = a[n\_dof -\/ 1] -\/ (*Alpha\_pt)[n\_dof -\/ 1] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02479}02479     result[2 * n\_dof -\/ 1] = d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02480}02480 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02481}02481     \textcolor{comment}{// The sign of the jacobian is the sign of the final entry in e}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02482}02482     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}() =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02483}02483       \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(std::fabs(e\_final) / e\_final);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02484}02484 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02485}02485 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02486}02486     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02487}02487     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a27325616f4342d159f6f5e7c82ccdf98}{solve\_full\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02488}02488 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02489}02489     \textcolor{comment}{// If we are not storing things, clear the results}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02490}02490     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02491}02491     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02492}02492       \textcolor{comment}{// We no longer need to store the matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02493}02493       \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02494}02494       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02495}02495       \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02496}02496       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a478bca515ee961576f523b1b5152651f}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02497}02497       \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a478bca515ee961576f523b1b5152651f}{E\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02498}02498     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02499}02499     \textcolor{comment}{// Otherwise also store the pointer to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02500}02500     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02501}02501     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02502}02502       \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_ad9e72a0a848aebe2b107a56b45aa4552}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02503}02503     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02504}02504   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02505}02505 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02506}02506 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02507}02507   \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02508}02508   \textcolor{comment}{// Hack the re-\/solve to use the block factorisation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02509}02509   \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02510}\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1d617896a3f1c1b1236ff18dc87ed8d7}{02510}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1d617896a3f1c1b1236ff18dc87ed8d7}{AugmentedBlockPitchForkLinearSolver::resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02511}02511                                                     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02512}02512   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02513}02513     std::cout << \textcolor{stringliteral}{"{}Augmented pitchfork resolve"{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02514}02514     \textcolor{comment}{// Check that the factors have been stored}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02515}02515     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a37d6d7eb053d062cabc6688f7c8fe240}{Alpha\_pt}} == 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02516}02516     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02517}02517       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The required vectors have not been stored"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02518}02518                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02519}02519                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02520}02520     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02521}02521 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02522}02522     \textcolor{comment}{// Get the pointer to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02523}02523     \mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const} problem\_pt = \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_ad9e72a0a848aebe2b107a56b45aa4552}{Problem\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02524}02524 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02525}02525     \mbox{\hyperlink{classoomph_1_1PitchForkHandler}{PitchForkHandler}}* handler\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02526}02526       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1PitchForkHandler}{PitchForkHandler}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02527}02527 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02528}02528     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02529}02529     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad0b0920383bcbdab5df1f43db5affa47}{solve\_augmented\_block\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02530}02530     \textcolor{comment}{// We need to find out the number of dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02531}02531     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02532}02532 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02533}02533     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02534}02534     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02535}02535     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02536}02536     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02537}02537 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02538}02538     \textcolor{comment}{// if the result vector is not setup then rebuild with distribution = global}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02539}02539     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02540}02540     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02541}02541       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02542}02542     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02543}02543 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02544}02544 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02545}02545     \textcolor{comment}{// Setup storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02546}02546     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} a(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02547}02547       b(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02548}02548 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02549}02549     \textcolor{comment}{// Set the values of the a vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02550}02550     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02551}02551     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02552}02552       a[n] = rhs[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02553}02553     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02554}02554 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02555}02555     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02556}02556 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02557}02557     \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02558}02558     \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02559}02559     \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02560}02560     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} input\_a(a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02561}02561 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02562}02562     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(input\_a, a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02563}02563 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02564}02564     \textcolor{comment}{// We can now construct our multipliers}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02565}02565     \textcolor{comment}{// Prepare to scale}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02566}02566     \textcolor{keywordtype}{double} dof\_length = 0.0, a\_length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02567}02567     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02568}02568     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02569}02569       \textcolor{keywordflow}{if} (std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n)) > dof\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02570}02570       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02571}02571         dof\_length = std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02572}02572       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02573}02573 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02574}02574       \textcolor{keywordflow}{if} (std::fabs(a[n]) > a\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02575}02575       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02576}02576         a\_length = std::fabs(a[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02577}02577       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02578}02578     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02579}02579     \textcolor{keywordtype}{double} a\_mult = dof\_length / a\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02580}02580     \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02581}02581     a\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02582}02582     a\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02583}02583 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02584}02584     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} Jprod\_a(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02585}02585 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02586}02586     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02587}02587     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02588}02588     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02589}02589       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02590}02590       \textcolor{comment}{// Loop over the ndofs in each element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02591}02591       \textcolor{keywordtype}{unsigned} n\_var = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ae066fa45e9f1bf10601286ca2d083a42}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02592}02592       \textcolor{comment}{// Get some jacobian matrices}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02593}02593       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac(n\_var), jac\_a(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02594}02594       \textcolor{comment}{// the elemental residual}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02595}02595       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} res\_elemental(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02596}02596       \textcolor{comment}{// Get unperturbed jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02597}02597       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa6728813a099111bee2b6c79dec20fc4}{get\_jacobian}}(elem\_pt, res\_elemental, jac);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02598}02598 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02599}02599       \textcolor{comment}{// Backup the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02600}02600       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} dof\_bac(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02601}02601       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02602}02602       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02603}02603       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02604}02604         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02605}02605         dof\_bac[n] = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02606}02606         \textcolor{comment}{// Pertub by vector a}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02607}02607         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += a\_mult * a[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02608}02608       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02609}02609 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02610}02610       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02611}02611 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02612}02612       \textcolor{comment}{// Now get the new jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02613}02613       handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa6728813a099111bee2b6c79dec20fc4}{get\_jacobian}}(elem\_pt, res\_elemental, jac\_a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02614}02614 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02615}02615       \textcolor{comment}{// Reset the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02616}02616       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02617}02617       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02618}02618         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02619}02619         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02620}02620       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02621}02621 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02622}02622       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02623}02623 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02624}02624       \textcolor{comment}{// OK, now work out the products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02625}02625       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < (n\_var -\/ 1); n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02626}02626       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02627}02627         \textcolor{keywordtype}{unsigned} eqn\_number = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02628}02628         \textcolor{keywordtype}{double} prod\_a = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02629}02629         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < (n\_var -\/ 1); m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02630}02630         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02631}02631           \textcolor{keywordtype}{unsigned} unknown = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{eqn\_number}}(elem\_pt, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02632}02632           prod\_a += (jac\_a(n, m) -\/ jac(n, m)) * handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02633}02633         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02634}02634         Jprod\_a[eqn\_number] += prod\_a / a\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02635}02635       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02636}02636     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02637}02637 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02638}02638     Jprod\_a[n\_dof -\/ 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02639}02639 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02640}02640     \textcolor{comment}{// OK, now we can formulate the next vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02641}02641     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof -\/ 1; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02642}02642     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02643}02643       b[n] = rhs[n\_dof + n] -\/ Jprod\_a[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02644}02644     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02645}02645     b[n\_dof -\/ 1] = rhs[2 * n\_dof -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02646}02646 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02647}02647     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02648}02648 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02649}02649     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(b, f);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02650}02650 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02651}02651     \textcolor{comment}{// Calculate the final entry in the vector d}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02652}02652     \textcolor{keyword}{const} \textcolor{keywordtype}{double} d\_final = -\/f[n\_dof -\/ 1] / (*E\_pt)[n\_dof -\/ 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02653}02653     \textcolor{comment}{// Assemble the final corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02654}02654     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof -\/ 1; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02655}02655     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02656}02656       result[n] = a[n] -\/ (*Alpha\_pt)[n] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02657}02657       result[n\_dof + n] = f[n] + (*E\_pt)[n] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02658}02658     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02659}02659 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02660}02660     result[n\_dof -\/ 1] = a[n\_dof -\/ 1] -\/ (*Alpha\_pt)[n\_dof -\/ 1] * d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02661}02661     result[2 * n\_dof -\/ 1] = d\_final;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02662}02662 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02663}02663     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_a1a3e1949c94c04c3b4ec19f0b895f97c}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02664}02664 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02665}02665     \textcolor{comment}{// Switch things to our block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02666}02666     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a27325616f4342d159f6f5e7c82ccdf98}{solve\_full\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02667}02667   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02668}02668 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02669}02669 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02670}02670 \textcolor{comment}{}  \textcolor{comment}{// Non-\/inline functions for the PitchForkHandler class}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02671}02671 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02672}02672 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02673}02673   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02674}02674 \textcolor{comment}{  /// Constructor: Initialise the PitchForkHandler by setting intial}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02675}02675 \textcolor{comment}{  /// guesses for Sigma, Y, specifying C and Psi and calculating count.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02676}02676 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02677}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a96e0343c261d087f5d67a49f68561d96}{02677}}   \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a96e0343c261d087f5d67a49f68561d96}{PitchForkHandler::PitchForkHandler}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02678}02678     \mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02679}02679     \mbox{\hyperlink{classoomph_1_1AssemblyHandler}{AssemblyHandler}}* \textcolor{keyword}{const}\& assembly\_handler\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02680}02680     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02681}02681     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& symmetry\_vector)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02682}02682     : Solve\_which\_system(Full\_augmented), Sigma(0.0), Parameter\_pt(parameter\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02683}02683   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02684}02684     \textcolor{comment}{// Set the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02685}02685     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02686}02686     \textcolor{comment}{// Set the assembly handler}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02687}02687     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a40358960131e00efd6bd0febd397a3ef}{Assembly\_handler\_pt}} = assembly\_handler\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02688}02688     \textcolor{comment}{// Set the number of degrees of freedom}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02689}02689     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02690}02690     \textcolor{comment}{// Backup the distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02691}02691     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}} = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02692}02692 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02693}02693     \textcolor{comment}{// Set the distribution flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02694}02694     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}} = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_af5e9f1623cad361048856a4c0463ea23}{distributed}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02695}02695 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02696}02696 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02697}02697     \textcolor{comment}{// Find the elements in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02698}02698     \textcolor{keywordtype}{unsigned} n\_element = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02699}02699 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02700}02700 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02701}02701 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02702}02702     \textcolor{comment}{// Work out all the global equations to which this processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02703}02703     \textcolor{comment}{// contributes and store the halo data in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02704}02704     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a216679e2a976e0205165bbe7ab558579}{setup\_dof\_halo\_scheme}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02705}02705 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02706}02706 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02707}02707 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02708}02708 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02709}02709     \textcolor{comment}{// Now use the dof distribution for all double vectors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02710}02710     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02711}02711     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02712}02712     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a88f5df169c44b02f4ba563cf42241599}{C}}.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02713}02713     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02714}02714 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02715}02715     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_a1aab1a84c6a82a755fdc3c6b27ce49d7}{build\_halo\_scheme}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02716}02716 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02717}02717 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02718}02718     \textcolor{comment}{// Loop over the elements and count the entries}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02719}02719     \textcolor{comment}{// and number of (non-\/halo) elements}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02720}02720     \textcolor{keywordtype}{unsigned} n\_non\_halo\_element\_local = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02721}02721     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02722}02722     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02723}02723       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02724}02724 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02725}02725       \textcolor{comment}{// Ignore halo elements}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02726}02726       \textcolor{keywordflow}{if} (!elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a0d9869eaf7d6e104c1e465b0d3cd6a9b}{is\_halo}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02727}02727       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02728}02728 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02729}02729         \textcolor{comment}{// Increment the number of non halo elements}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02730}02730         ++n\_non\_halo\_element\_local;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02731}02731         \textcolor{comment}{// Now count the number of times the element contributes to a value}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02732}02732         \textcolor{keywordtype}{unsigned} n\_var = assembly\_handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a09213be8f4aa009e0366460a7ed78e68}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02733}02733         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02734}02734         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02735}02735           ++\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(assembly\_handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, n));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02736}02736         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02737}02737 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02738}02738       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02739}02739 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02740}02740     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02741}02741 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02742}02742     \textcolor{comment}{// Add together all the counts}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02743}02743 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02744}02744     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_a7165745d3397b6ea9d87f123cc97e5c9}{sum\_all\_halo\_and\_haloed\_values}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02745}02745 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02746}02746     \textcolor{comment}{// If distributed, find the total number of elements in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02747}02747     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02748}02748     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02749}02749       \textcolor{comment}{// Need to gather the total number of non halo elements}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02750}02750       MPI\_Allreduce(\&n\_non\_halo\_element\_local,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02751}02751                     \&\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac85263fcd40fa913e4bc12c07f6b7343}{Nelement}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02752}02752                     1,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02753}02753                     MPI\_UNSIGNED,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02754}02754                     MPI\_SUM,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02755}02755                     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02756}02756     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02757}02757     \textcolor{comment}{// Otherwise the total number is the same on each processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02758}02758     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02759}02759 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02760}02760     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02761}02761       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac85263fcd40fa913e4bc12c07f6b7343}{Nelement}} = n\_non\_halo\_element\_local;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02762}02762     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02763}02763 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02764}02764 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02765}02765     \textcolor{comment}{// Only add the parameter to the first processor, if distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02766}02766     \textcolor{keywordtype}{int} my\_rank = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02767}02767     \textcolor{keywordflow}{if} ((!\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}}) || (my\_rank == 0))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02768}02768 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02769}02769     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02770}02770       \textcolor{comment}{// Add the parameter to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02771}02771       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02772}02772     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02773}02773 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02774}02774     \textcolor{comment}{// Find length of the symmetry vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02775}02775     \textcolor{keywordtype}{double} length = symmetry\_vector.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02776}02776 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02777}02777     \textcolor{comment}{// Add the unknowns for the null vector to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02778}02778     \textcolor{comment}{// Normalise the symmetry vector and initialise the null vector to the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02779}02779     \textcolor{comment}{// symmetry vector and set the constant vector, c, to the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02780}02780     \textcolor{comment}{// normalised symmetry vector.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02781}02781 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02782}02782     \textcolor{comment}{// Need to redistribute the symmetry vector into the (natural)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02783}02783     \textcolor{comment}{// distribution of the Dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02784}02784 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02785}02785     \textcolor{comment}{// Check that the symmetry vector has the correct distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02786}02786     \textcolor{keywordflow}{if} (!(*symmetry\_vector.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02787}02787     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02788}02788       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02789}02789         \textcolor{stringliteral}{"{}The symmetry vector must have the same distribution as the dofs\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02790}02790         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02791}02791         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02792}02792     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02793}02793 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02794}02794 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02795}02795     \textcolor{comment}{// Only loop over the local unknowns}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02796}02796     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_local = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02797}02797     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02798}02798     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02799}02799       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02800}02800       \textcolor{comment}{// Psi[n] = symmetry\_vector[n];}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02801}02801       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}[n] = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}[n] = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a88f5df169c44b02f4ba563cf42241599}{C}}[n] = symmetry\_vector[n] / length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02802}02802     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02803}02803 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02804}02804 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02805}02805 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02806}02806     \textcolor{comment}{// Set up the required halo schemes (which also synchronises)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02807}02807     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_a1aab1a84c6a82a755fdc3c6b27ce49d7}{build\_halo\_scheme}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02808}02808     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_a1aab1a84c6a82a755fdc3c6b27ce49d7}{build\_halo\_scheme}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02809}02809     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a88f5df169c44b02f4ba563cf42241599}{C}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_a1aab1a84c6a82a755fdc3c6b27ce49d7}{build\_halo\_scheme}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a1dcaa04975d69c616ab294cbfaf53d55}{Halo\_scheme\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02810}02810 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02811}02811 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02812}02812     \textcolor{keywordflow}{if} ((!\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}}) || (my\_rank == 0))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02813}02813 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02814}02814     \textcolor{comment}{// Add the slack parameter to the problem on the first processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02815}02815     \textcolor{comment}{// if distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02816}02816     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02817}02817       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a56a173cbdf59e73728c9c1b8c5221817}{Sigma}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02818}02818     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02819}02819 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02820}02820 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02821}02821     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02822}02822     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02823}02823       \textcolor{keywordtype}{unsigned} augmented\_first\_row = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02824}02824       \textcolor{keywordtype}{unsigned} augmented\_n\_row\_local = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02825}02825 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02826}02826       \textcolor{comment}{// Set up the translation scheme on every processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02827}02827       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac7010a8c64237d76cb0f23bfad126e07}{Global\_eqn\_number}}.resize(2 * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} + 2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02828}02828       \textcolor{keywordtype}{int} n\_proc = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>nproc();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02829}02829       \textcolor{keywordtype}{unsigned} global\_eqn\_count = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02830}02830       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} d = 0; d < n\_proc; d++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02831}02831       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02832}02832         \textcolor{comment}{// Find out the first row of the current processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02833}02833         \textcolor{keywordflow}{if} (my\_rank == d)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02834}02834         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02835}02835           augmented\_first\_row = global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02836}02836         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02837}02837 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02838}02838         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_row\_local = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}(d);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02839}02839         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} first\_row = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a2634e540a78fe1ee3f5c907aff500b58}{first\_row}}(d);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02840}02840         \textcolor{comment}{// Add the basic equations}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02841}02841         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_row\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02842}02842         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02843}02843           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac7010a8c64237d76cb0f23bfad126e07}{Global\_eqn\_number}}[first\_row + n] = global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02844}02844           ++global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02845}02845         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02846}02846         \textcolor{comment}{// If on the first processor add the pointer to the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02847}02847         \textcolor{keywordflow}{if} (d == 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02848}02848         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02849}02849           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac7010a8c64237d76cb0f23bfad126e07}{Global\_eqn\_number}}[\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}}] = global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02850}02850           ++global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02851}02851         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02852}02852         \textcolor{comment}{// Add the eigenfunction}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02853}02853         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_row\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02854}02854         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02855}02855           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac7010a8c64237d76cb0f23bfad126e07}{Global\_eqn\_number}}[\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} + 1 + first\_row + n] = global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02856}02856           ++global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02857}02857         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02858}02858         \textcolor{comment}{// Finally add the slack parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02859}02859         \textcolor{keywordflow}{if} (d == 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02860}02860         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02861}02861           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac7010a8c64237d76cb0f23bfad126e07}{Global\_eqn\_number}}[2 * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} + 1] = global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02862}02862           ++global\_eqn\_count;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02863}02863         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02864}02864         \textcolor{comment}{// Find out the number of rows of the current processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02865}02865         \textcolor{keywordflow}{if} (my\_rank == d)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02866}02866         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02867}02867           augmented\_n\_row\_local = global\_eqn\_count -\/ augmented\_first\_row;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02868}02868         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02869}02869       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02870}02870 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02871}02871       \textcolor{comment}{// Make a new linear algebra distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02872}02872       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_af6346c1dc77f3d4fb3dc8950afd91e0f}{Augmented\_dof\_distribution\_pt}} =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02873}02873         \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02874}02874                                       augmented\_first\_row,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02875}02875                                       augmented\_n\_row\_local);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02876}02876     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02877}02877     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02878}02878 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02879}02879     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02880}02880       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_af6346c1dc77f3d4fb3dc8950afd91e0f}{Augmented\_dof\_distribution\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02881}02881         \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), 2 * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} + 2, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02882}02882     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02883}02883 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02884}02884     \textcolor{comment}{// resize}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02885}02885     \textcolor{comment}{// Problem\_pt-\/>Dof\_distribution\_pt-\/>build(Problem\_pt-\/>communicator\_pt(),}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02886}02886     \textcolor{comment}{//                                       2*Ndof+2,false);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02887}02887 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02888}02888     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}} = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_af6346c1dc77f3d4fb3dc8950afd91e0f}{Augmented\_dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02889}02889 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02890}02890     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02891}02891     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02892}02892   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02893}02893 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02894}02894   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02895}02895 \textcolor{comment}{  /// Destructor return the problem to its original (non-\/augmented) state}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02896}02896 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02897}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a69c6b0b6aedd03d828d295531fd61820}{02897}}   \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a69c6b0b6aedd03d828d295531fd61820}{PitchForkHandler::\string~PitchForkHandler}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02898}02898   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02899}02899     \textcolor{comment}{// If we are using the block solver reset the problem's linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02900}02900     \textcolor{comment}{// to the original one}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02901}02901     \mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver}{BlockPitchForkLinearSolver}}* block\_pitchfork\_solver\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02902}02902       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver}{BlockPitchForkLinearSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02903}02903 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02904}02904     \textcolor{keywordflow}{if} (block\_pitchfork\_solver\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02905}02905     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02906}02906       \textcolor{comment}{// Reset the problem's linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02907}02907       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}() =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02908}02908         block\_pitchfork\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1BlockPitchForkLinearSolver_a35c2658ddd0fb46125cd458e316e9c8d}{linear\_solver\_pt}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02909}02909       \textcolor{comment}{// Delete the block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02910}02910       \textcolor{keyword}{delete} block\_pitchfork\_solver\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02911}02911     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02912}02912 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02913}02913     \textcolor{comment}{// If we are using the augmented}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02914}02914     \textcolor{comment}{// block solver reset the problem's linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02915}02915     \textcolor{comment}{// to the original one}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02916}02916     \mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver}{AugmentedBlockPitchForkLinearSolver}}* augmented\_block\_pitchfork\_solver\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02917}02917       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver}{AugmentedBlockPitchForkLinearSolver}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02918}02918         \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02919}02919 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02920}02920     \textcolor{keywordflow}{if} (augmented\_block\_pitchfork\_solver\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02921}02921     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02922}02922       \textcolor{comment}{// Reset the problem's linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02923}02923       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}() =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02924}02924         augmented\_block\_pitchfork\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1AugmentedBlockPitchForkLinearSolver_ae1bc87c46119818bb8287273ba7c336b}{linear\_solver\_pt}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02925}02925       \textcolor{comment}{// Delete the block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02926}02926       \textcolor{keyword}{delete} augmented\_block\_pitchfork\_solver\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02927}02927     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02928}02928 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02929}02929     \textcolor{comment}{// Now return the problem to its original size}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02930}02930     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02931}02931 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02932}02932     \textcolor{comment}{// Problem\_pt-\/>Dof\_pt.resize(Ndof);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02933}02933     \textcolor{comment}{// Problem\_pt-\/>Dof\_distribution\_pt-\/>build(Problem\_pt-\/>communicator\_pt(),}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02934}02934     \textcolor{comment}{//                                       Ndof,false);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02935}02935 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02936}02936     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}} = this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02937}02937     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02938}02938     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02939}02939   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02940}02940 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02941}02941   \textcolor{comment}{//================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02942}02942 \textcolor{comment}{  /// Get the number of elemental degrees of freedom}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02943}02943 \textcolor{comment}{}  \textcolor{comment}{//================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02944}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ae066fa45e9f1bf10601286ca2d083a42}{02944}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ae066fa45e9f1bf10601286ca2d083a42}{PitchForkHandler::ndof}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02945}02945   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02946}02946     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02947}02947 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02948}02948     \textcolor{comment}{// Return different values depending on the type of block decomposition}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02949}02949     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02950}02950     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02951}02951       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacba0e7d0b0eb06a1f2d90a3ab2831bec36d}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02952}02952         \textcolor{keywordflow}{return} (2 * raw\_ndof + 2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02953}02953         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02954}02954 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02955}02955       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbac8e196e66210e158988de0bfebcdf6a5}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02956}02956         \textcolor{keywordflow}{return} (raw\_ndof + 1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02957}02957         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02958}02958 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02959}02959       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02960}02960         \textcolor{keywordflow}{return} raw\_ndof;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02961}02961         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02962}02962 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02963}02963       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02964}02964         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02965}02965         error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02966}02966           << \textcolor{stringliteral}{"{}The Solve\_which\_system flag can only take values 0, 1, 2"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02967}02967           << \textcolor{stringliteral}{"{} not "{}} << \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02968}02968         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02969}02969           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02970}02970     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02971}02971   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02972}02972 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02973}02973 \textcolor{comment}{  /// Get the global equation number of the local unknown}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02974}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{02974}} \textcolor{comment}{}  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab29e58e25bd5bebd836e30015f01ac8d}{PitchForkHandler::eqn\_number}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02975}02975                                              \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ieqn\_local)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02976}02976   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02977}02977     \textcolor{comment}{// Get the raw value}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02978}02978     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02979}02979     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} global\_eqn = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02980}02980 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02981}02981     \textcolor{comment}{// Which system are we solving}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02982}02982     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02983}02983     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02984}02984         \textcolor{comment}{// In the block case, it's just the standard numbering}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02985}02985       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02986}02986         global\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02987}02987         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02988}02988 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02989}02989         \textcolor{comment}{// Block augmented not done properly yet}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02990}02990       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbac8e196e66210e158988de0bfebcdf6a5}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02991}02991         \textcolor{comment}{// Not done the distributed case}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02992}02992 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02993}02993         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02994}02994         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02995}02995           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02996}02996             \textcolor{stringliteral}{"{}Block Augmented solver not implemented for distributed case\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02997}02997             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02998}02998             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l02999}02999         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03000}03000 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03001}03001 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03002}03002         \textcolor{comment}{// Full case}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03003}03003       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacba0e7d0b0eb06a1f2d90a3ab2831bec36d}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03004}03004         \textcolor{comment}{// The usual equations}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03005}03005         \textcolor{keywordflow}{if} (ieqn\_local < raw\_ndof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03006}03006         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03007}03007           global\_eqn = this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac1a4bbb1415a009e9f176f16263fcb3e}{global\_eqn\_number}}(elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03008}03008         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03009}03009         \textcolor{comment}{// The bifurcation parameter equation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03010}03010         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ieqn\_local == raw\_ndof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03011}03011         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03012}03012           global\_eqn = this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac1a4bbb1415a009e9f176f16263fcb3e}{global\_eqn\_number}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03013}03013         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03014}03014         \textcolor{comment}{// If we are assembling the full system we also have}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03015}03015         \textcolor{comment}{// The components of the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03016}03016         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ieqn\_local < (2 * raw\_ndof + 1))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03017}03017         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03018}03018           global\_eqn = this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac1a4bbb1415a009e9f176f16263fcb3e}{global\_eqn\_number}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03019}03019             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} + 1 + elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local -\/ 1 -\/ raw\_ndof));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03020}03020         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03021}03021         \textcolor{comment}{// The slack parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03022}03022         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03023}03023         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03024}03024           global\_eqn = this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac1a4bbb1415a009e9f176f16263fcb3e}{global\_eqn\_number}}(2 * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} + 1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03025}03025         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03026}03026         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03027}03027     \} \textcolor{comment}{// End of switch}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03028}03028     \textcolor{keywordflow}{return} global\_eqn;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03029}03029   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03030}03030 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03031}03031   \textcolor{comment}{//==============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03032}03032 \textcolor{comment}{  /// Get the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03033}03033 \textcolor{comment}{}  \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03034}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a461b24284da88b9489d720e484a6925c}{03034}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a461b24284da88b9489d720e484a6925c}{PitchForkHandler::get\_residuals}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03035}03035                                        \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03036}03036   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03037}03037     \textcolor{comment}{// Need to get raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03038}03038     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03039}03039 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03040}03040     \textcolor{comment}{// Find out which system we are solving}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03041}03041     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03042}03042     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03043}03043         \textcolor{comment}{// If we are solving the original system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03044}03044       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03045}03045       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03046}03046         \textcolor{comment}{// get the basic residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03047}03047         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a53d348ab71c86b53619129a1dd411d30}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03048}03048         \textcolor{comment}{// Now multiply to fill in the residuals for the final term}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03049}03049         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03050}03050         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03051}03051           \textcolor{keywordtype}{unsigned} local\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03052}03052           \textcolor{comment}{// Add the slack parameter to the final residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03053}03053           residuals[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03054}03054             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a56a173cbdf59e73728c9c1b8c5221817}{Sigma}} * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03055}03055         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03056}03056       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03057}03057       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03058}03058 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03059}03059       \textcolor{comment}{// If we are solving the augmented-\/by-\/one system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03060}03060       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbac8e196e66210e158988de0bfebcdf6a5}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03061}03061       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03062}03062         \textcolor{comment}{// Get the basic residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03063}03063         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a53d348ab71c86b53619129a1dd411d30}{get\_residuals}}(residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03064}03064 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03065}03065         \textcolor{comment}{// Zero the final residual}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03066}03066         residuals[raw\_ndof] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03067}03067         \textcolor{comment}{// Now multiply to fill in the residuals for the final term}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03068}03068         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03069}03069         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03070}03070           \textcolor{keywordtype}{unsigned} local\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03071}03071           \textcolor{comment}{// Add the slack parameter to the final residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03072}03072           residuals[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03073}03073             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a56a173cbdf59e73728c9c1b8c5221817}{Sigma}} * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03074}03074           \textcolor{comment}{// Final term that specifies the symmetry}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03075}03075           residuals[raw\_ndof] += ((*\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a07460d9854a692ffda3d6e318e5ad395}{global\_dof\_pt}}(local\_eqn)) *}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03076}03076                                   \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn)) /}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03077}03077                                  \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03078}03078         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03079}03079       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03080}03080       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03081}03081 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03082}03082       \textcolor{comment}{// Otherwise we are solving the fully augemented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03083}03083       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacba0e7d0b0eb06a1f2d90a3ab2831bec36d}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03084}03084       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03085}03085         \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jacobian(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03086}03086 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03087}03087         \textcolor{comment}{// Get the basic residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03088}03088         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(residuals, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03089}03089 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03090}03090         \textcolor{comment}{// Initialise the final residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03091}03091         residuals[raw\_ndof] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03092}03092         residuals[2 * raw\_ndof + 1] = -\/1.0 / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ac85263fcd40fa913e4bc12c07f6b7343}{Nelement}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03093}03093 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03094}03094         \textcolor{comment}{// Now multiply to fill in the residuals associated}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03095}03095         \textcolor{comment}{// with the null vector condition}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03096}03096         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03097}03097         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03098}03098           \textcolor{keywordtype}{unsigned} local\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03099}03099           residuals[raw\_ndof + 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03100}03100           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < raw\_ndof; j++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03101}03101           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03102}03102             \textcolor{keywordtype}{unsigned} local\_unknown = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03103}03103             residuals[raw\_ndof + 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03104}03104               jacobian(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_unknown);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03105}03105           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03106}03106 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03107}03107           \textcolor{comment}{// Add the slack parameter to the governing equations}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03108}03108           residuals[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03109}03109             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a56a173cbdf59e73728c9c1b8c5221817}{Sigma}} * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03110}03110 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03111}03111           \textcolor{comment}{// Specify the symmetry}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03112}03112           residuals[raw\_ndof] += ((*\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a07460d9854a692ffda3d6e318e5ad395}{global\_dof\_pt}}(local\_eqn)) *}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03113}03113                                   \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn)) /}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03114}03114                                  \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03115}03115           \textcolor{comment}{// Specify the normalisation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03116}03116           residuals[2 * raw\_ndof + 1] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03117}03117             (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a88f5df169c44b02f4ba563cf42241599}{C}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn)) /}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03118}03118             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03119}03119         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03120}03120       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03121}03121       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03122}03122 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03123}03123       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03124}03124         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03125}03125         error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03126}03126           << \textcolor{stringliteral}{"{}The Solve\_which\_system flag can only take values 0, 1, 2"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03127}03127           << \textcolor{stringliteral}{"{} not "{}} << \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03128}03128         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03129}03129           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03130}03130     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03131}03131   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03132}03132 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03133}03133   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03134}03134 \textcolor{comment}{  /// Calculate the elemental Jacobian matrix "{}d equation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03135}03135 \textcolor{comment}{  /// / d variable"{}.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03136}03136 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03137}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa6728813a099111bee2b6c79dec20fc4}{03137}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa6728813a099111bee2b6c79dec20fc4}{PitchForkHandler::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03138}03138                                       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03139}03139                                       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03140}03140   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03141}03141     \textcolor{keywordtype}{unsigned} augmented\_ndof = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ae066fa45e9f1bf10601286ca2d083a42}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03142}03142     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03143}03143 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03144}03144     \textcolor{comment}{// Which system are we solving}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03145}03145     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03146}03146     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03147}03147         \textcolor{comment}{// If we are solving the original system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03148}03148       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03149}03149       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03150}03150         \textcolor{comment}{// get the raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03151}03151         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(residuals, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03152}03152 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03153}03153         \textcolor{comment}{// Now multiply to fill in the residuals for the final term}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03154}03154         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03155}03155         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03156}03156           \textcolor{keywordtype}{unsigned} local\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03157}03157           \textcolor{comment}{// Add the slack parameter to the final residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03158}03158           residuals[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03159}03159             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a56a173cbdf59e73728c9c1b8c5221817}{Sigma}} * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03160}03160         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03161}03161       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03162}03162       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03163}03163 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03164}03164       \textcolor{comment}{// If we are solving the augmented-\/by-\/one system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03165}03165       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbac8e196e66210e158988de0bfebcdf6a5}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03166}03166       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03167}03167         \textcolor{comment}{// Get the full residuals, we need them}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03168}03168         \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a461b24284da88b9489d720e484a6925c}{get\_residuals}}(elem\_pt, residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03169}03169 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03170}03170         \textcolor{comment}{// Need to get the raw jacobian (and raw residuals)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03171}03171         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} newres(augmented\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03172}03172         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(newres, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03173}03173 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03174}03174         \textcolor{comment}{// Now do finite differencing stuff}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03175}03175         \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03176}03176         \textcolor{comment}{// Fill in the first lot of finite differences}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03177}03177         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03178}03178           \textcolor{comment}{// increase the global parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03179}03179           \textcolor{keywordtype}{double}* unknown\_pt = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa0e8800d56e68fcb63ec2315f503cab2}{Parameter\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03180}03180           \textcolor{keywordtype}{double} init = *unknown\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03181}03181           *unknown\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03182}03182 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03183}03183           \textcolor{comment}{// Not do any possible updates}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03184}03184           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03185}03185 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03186}03186           \textcolor{comment}{// Get the new (modified) residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03187}03187           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a461b24284da88b9489d720e484a6925c}{get\_residuals}}(elem\_pt, newres);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03188}03188 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03189}03189           \textcolor{comment}{// The final column  is given by the difference}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03190}03190           \textcolor{comment}{// between the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03191}03191           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03192}03192           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03193}03193             jacobian(n, augmented\_ndof -\/ 1) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03194}03194               (newres[n] -\/ residuals[n]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03195}03195           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03196}03196           \textcolor{comment}{// Reset the global parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03197}03197           *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03198}03198 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03199}03199           \textcolor{comment}{// Now do any possible updates}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03200}03200           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03201}03201         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03202}03202 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03203}03203         \textcolor{comment}{// Fill in the bottom row}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03204}03204         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03205}03205         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03206}03206           \textcolor{keywordtype}{unsigned} local\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03207}03207           jacobian(augmented\_ndof -\/ 1, n) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03208}03208             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03209}03209         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03210}03210       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03211}03211       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03212}03212 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03213}03213       \textcolor{comment}{// Otherwise solving the full system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03214}03214       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacba0e7d0b0eb06a1f2d90a3ab2831bec36d}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03215}03215       \{\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03216}03216 \textcolor{comment}{        /// ALICE:}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03217}03217 \textcolor{comment}{}        \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03218}03218         \textcolor{comment}{// Get the basic jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03219}03219         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(residuals, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03220}03220         \textcolor{comment}{// get the proper residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03221}03221         \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a461b24284da88b9489d720e484a6925c}{get\_residuals}}(elem\_pt, residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03222}03222 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03223}03223         \textcolor{comment}{// Now fill in the next diagonal jacobian entry}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03224}03224         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03225}03225         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03226}03226           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < raw\_ndof; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03227}03227           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03228}03228             jacobian(raw\_ndof + 1 + n, raw\_ndof + 1 + m) = jacobian(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03229}03229           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03230}03230           \textcolor{keywordtype}{unsigned} local\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03231}03231           \textcolor{comment}{// Add in the sigma contribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03232}03232           jacobian(n, 2 * raw\_ndof + 1) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03233}03233             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03234}03234           \textcolor{comment}{// Symmetry constraint}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03235}03235           jacobian(raw\_ndof, n) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03236}03236             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa04d0f340d919d4da3f9199eb76649b1}{Psi}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03237}03237           \textcolor{comment}{// Non-\/zero constraint}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03238}03238           jacobian(2 * raw\_ndof + 1, raw\_ndof + 1 + n) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03239}03239             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a88f5df169c44b02f4ba563cf42241599}{C}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn) / \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad3f5fc1d7ee4918c9734e59e0611a62c}{Count}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03240}03240         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03241}03241 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03242}03242         \textcolor{comment}{// Finite difference the remaining blocks}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03243}03243         \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03244}03244 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03245}03245         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} newres\_p(augmented\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03246}03246 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03247}03247         \textcolor{comment}{// Loop over the ndofs only}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03248}03248         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; ++n)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03249}03249         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03250}03250           \textcolor{comment}{// Get the original (unaugmented) global equation number}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03251}03251           \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} global\_eqn =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03252}03252             \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a40358960131e00efd6bd0febd397a3ef}{Assembly\_handler\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1AssemblyHandler_a94d28e2de2559cde803d1ba2195b5290}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03253}03253           \textcolor{keywordtype}{double}* unknown\_pt = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a07460d9854a692ffda3d6e318e5ad395}{global\_dof\_pt}}(global\_eqn);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03254}03254           \textcolor{keywordtype}{double} init = *unknown\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03255}03255           *unknown\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03256}03256           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03257}03257           \textcolor{comment}{// Get the new residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03258}03258           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a461b24284da88b9489d720e484a6925c}{get\_residuals}}(elem\_pt, newres\_p);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03259}03259           \textcolor{comment}{// Fill in the entries in the block d(Jy)/dx}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03260}03260           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < raw\_ndof; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03261}03261           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03262}03262             jacobian(raw\_ndof + 1 + m, n) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03263}03263               (newres\_p[raw\_ndof + 1 + m] -\/ residuals[raw\_ndof + 1 + m]) /}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03264}03264               (\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03265}03265           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03266}03266 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03267}03267           \textcolor{comment}{// Reset the unknown}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03268}03268           *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03269}03269           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03270}03270         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03271}03271 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03272}03272         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03273}03273           \textcolor{comment}{// Now increase the global parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03274}03274           \textcolor{keywordtype}{double}* unknown\_pt = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa0e8800d56e68fcb63ec2315f503cab2}{Parameter\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03275}03275           \textcolor{keywordtype}{double} init = *unknown\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03276}03276           *unknown\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03277}03277 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03278}03278           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03279}03279           \textcolor{comment}{// Get the new residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03280}03280           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a461b24284da88b9489d720e484a6925c}{get\_residuals}}(elem\_pt, newres\_p);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03281}03281 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03282}03282           \textcolor{comment}{// Add in the first block d/dx}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03283}03283           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < raw\_ndof; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03284}03284           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03285}03285             jacobian(m, raw\_ndof) = (newres\_p[m] -\/ residuals[m]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03286}03286           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03287}03287           \textcolor{comment}{// Add in the second block d/dy}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03288}03288           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = raw\_ndof + 1; m < augmented\_ndof -\/ 1; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03289}03289           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03290}03290             jacobian(m, raw\_ndof) = (newres\_p[m] -\/ residuals[m]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03291}03291           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03292}03292 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03293}03293           \textcolor{comment}{// Reset the unknown}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03294}03294           *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03295}03295           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03296}03296         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03297}03297       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03298}03298       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03299}03299 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03300}03300       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03301}03301         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03302}03302         error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03303}03303           << \textcolor{stringliteral}{"{}The Solve\_which\_system flag can only take values 0, 1, 2"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03304}03304           << \textcolor{stringliteral}{"{} not "{}} << \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03305}03305         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03306}03306           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03307}03307     \}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03308}03308 \textcolor{comment}{    /// ALICE}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03309}03309 \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03310}03310   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03311}03311 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03312}03312 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03313}03313   \textcolor{comment}{//==============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03314}03314 \textcolor{comment}{  /// Get the derivatives of the residuals with respect to a parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03315}03315 \textcolor{comment}{}  \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03316}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a6510803afcbcfce1ae5b1c1c5d82a541}{03316}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a6510803afcbcfce1ae5b1c1c5d82a541}{PitchForkHandler::get\_dresiduals\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03317}03317     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03318}03318     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03319}03319     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dres\_dparam)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03320}03320   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03321}03321     \textcolor{comment}{// Need to get raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03322}03322     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03323}03323     \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae6ad96ddf5d48b517b89c9a9b879bc4b}{actions\_before\_newton\_convergence\_check}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03324}03324     \textcolor{comment}{// Find out which system we are solving}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03325}03325     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03326}03326     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03327}03327         \textcolor{comment}{// If we are solving the original system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03328}03328       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03329}03329       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03330}03330         \textcolor{comment}{// get the basic residual derivatives}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03331}03331         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a63bf8f3db94fdb4098ff61fa930a6d40}{get\_dresiduals\_dparameter}}(parameter\_pt, dres\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03332}03332         \textcolor{comment}{// Slack parameter term does not depened explicitly on the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03333}03333         \textcolor{comment}{// so is not added}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03334}03334       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03335}03335       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03336}03336 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03337}03337       \textcolor{comment}{// If we are solving the augmented-\/by-\/one system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03338}03338       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbac8e196e66210e158988de0bfebcdf6a5}{Block\_augmented\_J}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03339}03339       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03340}03340         \textcolor{comment}{// Get the basic residual derivatives}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03341}03341         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a63bf8f3db94fdb4098ff61fa930a6d40}{get\_dresiduals\_dparameter}}(parameter\_pt, dres\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03342}03342 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03343}03343         \textcolor{comment}{// Zero the final residuals derivative}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03344}03344         dres\_dparam[raw\_ndof] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03345}03345 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03346}03346         \textcolor{comment}{// Other terms must not depend on the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03347}03347       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03348}03348       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03349}03349 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03350}03350       \textcolor{comment}{// Otherwise we are solving the fully augemented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03351}03351       \textcolor{keywordflow}{case} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacba0e7d0b0eb06a1f2d90a3ab2831bec36d}{Full\_augmented}}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03352}03352       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03353}03353         \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} djac\_dparam(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03354}03354 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03355}03355         \textcolor{comment}{// Get the basic residuals and jacobian derivatives}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03356}03356         elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab92de6f9c750735bc660f0a10f0df44c}{get\_djacobian\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03357}03357           parameter\_pt, dres\_dparam, djac\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03358}03358 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03359}03359         \textcolor{comment}{// The "{}final"{} residual derivatives do not depend on the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03360}03360         dres\_dparam[raw\_ndof] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03361}03361         dres\_dparam[2 * raw\_ndof + 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03362}03362 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03363}03363         \textcolor{comment}{// Now multiply to fill in the residuals associated}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03364}03364         \textcolor{comment}{// with the null vector condition}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03365}03365         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03366}03366         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03367}03367           dres\_dparam[raw\_ndof + 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03368}03368           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < raw\_ndof; j++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03369}03369           \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03370}03370             \textcolor{keywordtype}{unsigned} local\_unknown = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03371}03371             dres\_dparam[raw\_ndof + 1 + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03372}03372               djac\_dparam(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_ad7e911b1a0cf1ffd163d75f0777f5100}{global\_value}}(local\_unknown);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03373}03373           \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03374}03374         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03375}03375       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03376}03376       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03377}03377 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03378}03378       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03379}03379         std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03380}03380         error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03381}03381           << \textcolor{stringliteral}{"{}The Solve\_which\_system flag can only take values 0, 1, 2"{}}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03382}03382           << \textcolor{stringliteral}{"{} not "{}} << \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03383}03383         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03384}03384           error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03385}03385     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03386}03386   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03387}03387 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03388}03388 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03389}03389   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03390}03390 \textcolor{comment}{  /// Overload the derivative of the residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03391}03391 \textcolor{comment}{  /// with respect to a parameter so that it breaks because it should not}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03392}03392 \textcolor{comment}{  /// be required}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03393}03393 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03394}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa16d6770f6d46b7db4101f417373b191}{03394}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa16d6770f6d46b7db4101f417373b191}{PitchForkHandler::get\_djacobian\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03395}03395     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03396}03396     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03397}03397     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dres\_dparam,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03398}03398     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& djac\_dparam)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03399}03399   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03400}03400     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03401}03401     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03402}03402       << \textcolor{stringliteral}{"{}This function has not been implemented because it is not required\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03403}03403     error\_stream << \textcolor{stringliteral}{"{}in standard problems.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03404}03404     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03405}03405       << \textcolor{stringliteral}{"{}If you find that you need it, you will have to implement it!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03406}03406 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03407}03407     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03408}03408       error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03409}03409   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03410}03410 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03411}03411 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03412}03412   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03413}03413 \textcolor{comment}{  /// Overload the hessian vector product function so that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03414}03414 \textcolor{comment}{  /// it calls the underlying element's hessian function.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03415}03415 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03416}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a85e7dba2d21c9fe95a575a115cf3ee9f}{03416}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a85e7dba2d21c9fe95a575a115cf3ee9f}{PitchForkHandler::get\_hessian\_vector\_products}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03417}03417     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03418}03418     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \textcolor{keyword}{const}\& Y,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03419}03419     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} \textcolor{keyword}{const}\& C,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03420}03420     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& product)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03421}03421   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03422}03422     elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a1fbe77c663eefdf38a0c95f62f6e51bb}{get\_hessian\_vector\_products}}(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}, \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a88f5df169c44b02f4ba563cf42241599}{C}}, product);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03423}03423   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03424}03424 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03425}03425 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03426}03426   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03427}03427 \textcolor{comment}{  /// Return the eigenfunction(s) associated with the bifurcation that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03428}03428 \textcolor{comment}{  /// has been detected in bifurcation tracking problems}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03429}03429 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03430}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9d5e1388fe0ede6834a249b98168b71a}{03430}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9d5e1388fe0ede6834a249b98168b71a}{PitchForkHandler::get\_eigenfunction}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& eigenfunction)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03431}03431   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03432}03432     \textcolor{comment}{// There is only one (real) null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03433}03433     eigenfunction.resize(1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03434}03434     \textcolor{comment}{// Rebuild the vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03435}03435     eigenfunction[0].build(this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03436}03436     \textcolor{comment}{// Set the value to be the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03437}03437     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_row\_local = eigenfunction[0].nrow\_local();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03438}03438     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_row\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03439}03439     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03440}03440       eigenfunction[0][n] = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03441}03441     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03442}03442   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03443}03443 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03444}03444 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03445}03445   \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03446}03446   \textcolor{comment}{// Synchronise the required data}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03447}03447   \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03448}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a23a67d7212e25108e40cf9b4606f4478}{03448}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a23a67d7212e25108e40cf9b4606f4478}{PitchForkHandler::synchronise}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03449}03449   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03450}03450     \textcolor{comment}{// Only need to bother if the problem is distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03451}03451     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03452}03452     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03453}03453       \textcolor{comment}{// Need only to synchronise the eigenfunction}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03454}03454       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}.\mbox{\hyperlink{classoomph_1_1DoubleVectorWithHaloEntries_a6d5b6e2c1c80d4fb468c851030d62492}{synchronise}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03455}03455       \textcolor{comment}{// Also need to synchronise the parameter and the slack parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03456}03456       \textcolor{keywordtype}{double} broadcast\_data[2];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03457}03457       broadcast\_data[0] = *\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa0e8800d56e68fcb63ec2315f503cab2}{Parameter\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03458}03458       broadcast\_data[1] = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a56a173cbdf59e73728c9c1b8c5221817}{Sigma}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03459}03459       \textcolor{comment}{// Broadcast from the root to all processors}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03460}03460       MPI\_Bcast(broadcast\_data,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03461}03461                 2,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03462}03462                 MPI\_DOUBLE,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03463}03463                 0,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03464}03464                 \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>mpi\_comm());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03465}03465 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03466}03466       \textcolor{comment}{// Now copy received the values back}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03467}03467       *\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa0e8800d56e68fcb63ec2315f503cab2}{Parameter\_pt}} = broadcast\_data[0];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03468}03468       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a56a173cbdf59e73728c9c1b8c5221817}{Sigma}} = broadcast\_data[1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03469}03469     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03470}03470   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03471}03471 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03472}03472 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03473}03473   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03474}03474 \textcolor{comment}{  /// Set to solve the augmented-\/by-\/one block system.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03475}03475 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03476}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad0b0920383bcbdab5df1f43db5affa47}{03476}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad0b0920383bcbdab5df1f43db5affa47}{PitchForkHandler::solve\_augmented\_block\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03477}03477   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03478}03478     \textcolor{comment}{// Only bother to do anything if we haven't already set the flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03479}03479     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} != \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbac8e196e66210e158988de0bfebcdf6a5}{Block\_augmented\_J}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03480}03480     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03481}03481       \textcolor{comment}{// If we were solving the system with the original jacobian add the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03482}03482       \textcolor{comment}{// parameter back}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03483}03483       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} == \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03484}03484       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03485}03485         \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa0e8800d56e68fcb63ec2315f503cab2}{Parameter\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03486}03486       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03487}03487 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03488}03488       \textcolor{comment}{// Restrict the problem to the standard variables and}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03489}03489       \textcolor{comment}{// the bifurcation parameter only}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03490}03490       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03491}03491         \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} + 1, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03492}03492       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a9314a176be55e7e9c5a359accfbec751}{Ndof}} + 1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03493}03493 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03494}03494       \textcolor{comment}{// Problem\_pt-\/>Dof\_pt.resize(Ndof+1);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03495}03495       \textcolor{comment}{//    Problem\_pt-\/>Dof\_distribution\_pt-\/>build(Problem\_pt-\/>communicator\_pt(),}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03496}03496       \textcolor{comment}{//                                         Ndof+1,false);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03497}03497 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03498}03498       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03499}03499       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03500}03500 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03501}03501       \textcolor{comment}{// Set the solve flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03502}03502       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbac8e196e66210e158988de0bfebcdf6a5}{Block\_augmented\_J}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03503}03503     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03504}03504   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03505}03505 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03506}03506 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03507}03507   \textcolor{comment}{//==============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03508}03508 \textcolor{comment}{  /// Set to solve the block system. The boolean flag is used}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03509}03509 \textcolor{comment}{  /// to specify whether the block decomposition should use exactly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03510}03510 \textcolor{comment}{  /// the same jacobian as the original system.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03511}03511 \textcolor{comment}{}  \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03512}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad193c3d67741edd60b023c94e42c8802}{03512}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_ad193c3d67741edd60b023c94e42c8802}{PitchForkHandler::solve\_block\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03513}03513   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03514}03514     \textcolor{comment}{// Only bother to do anything if we haven't already set the flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03515}03515     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} != \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03516}03516     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03517}03517       \textcolor{comment}{// Restrict the problem to the standard variables}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03518}03518       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03519}03519       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}} = this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03520}03520 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03521}03521       \textcolor{comment}{// Problem\_pt-\/>Dof\_distribution\_pt-\/>build(Problem\_pt-\/>communicator\_pt(),}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03522}03522       \textcolor{comment}{// Ndof,false);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03523}03523 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03524}03524       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03525}03525       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03526}03526 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03527}03527       \textcolor{comment}{// Set the solve flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03528}03528       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03529}03529     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03530}03530   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03531}03531 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03532}03532   \textcolor{comment}{//==============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03533}03533 \textcolor{comment}{  /// Solve non-\/block system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03534}03534 \textcolor{comment}{}  \textcolor{comment}{//==============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03535}\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a27325616f4342d159f6f5e7c82ccdf98}{03535}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a27325616f4342d159f6f5e7c82ccdf98}{PitchForkHandler::solve\_full\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03536}03536   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03537}03537     \textcolor{comment}{// Only do something if we are not solving the full system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03538}03538     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} != \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacba0e7d0b0eb06a1f2d90a3ab2831bec36d}{Full\_augmented}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03539}03539     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03540}03540 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03541}03541       \textcolor{keywordtype}{int} my\_rank = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}()-\/>my\_rank();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03542}03542 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03543}03543       \textcolor{comment}{// If we were solving the problem without any augementation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03544}03544       \textcolor{comment}{// add the parameter again}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03545}03545       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} == \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacbae729c94eb567cd88e0b33dc29d9f8d5d}{Block\_J}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03546}03546       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03547}03547 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03548}03548 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03549}03549         \textcolor{keywordflow}{if} ((!\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}}) || (my\_rank == 0))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03550}03550 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03551}03551         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03552}03552           \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\mbox{\hyperlink{classoomph_1_1PitchForkHandler_aa0e8800d56e68fcb63ec2315f503cab2}{Parameter\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03553}03553         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03554}03554       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03555}03555 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03556}03556       \textcolor{comment}{// Always add the additional unknowns back into the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03557}03557       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_dof\_local = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a075f47b5f8941d25796f96d258a1752e}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_ac9310de740f9c3a61f8d5dab9bef88ca}{nrow\_local}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03558}03558       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof\_local; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03559}03559       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03560}03560         \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a289ce15584734b8ea50cd9a7f7f430ed}{Y}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03561}03561       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03562}03562 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03563}03563 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03564}03564 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03565}03565       \textcolor{keywordflow}{if} ((!\mbox{\hyperlink{classoomph_1_1PitchForkHandler_ab948b0ac9640e85e8a17f993a764e000}{Distributed}}) || (my\_rank == 0))}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03566}03566 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03567}03567       \textcolor{comment}{// Add the slack parameter to the problem on the first processor}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03568}03568       \textcolor{comment}{// if distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03569}03569       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03570}03570         \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a56a173cbdf59e73728c9c1b8c5221817}{Sigma}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03571}03571       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03572}03572 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03573}03573 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03574}03574       \textcolor{comment}{// Delete the distribtion created in the augmented block solve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03575}03575       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}} != this-\/>Dof\_distribution\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03576}03576       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03577}03577         \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03578}03578       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03579}03579 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03580}03580       \textcolor{comment}{// update the Dof distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03581}03581       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}} = this-\/>\mbox{\hyperlink{classoomph_1_1PitchForkHandler_af6346c1dc77f3d4fb3dc8950afd91e0f}{Augmented\_dof\_distribution\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03582}03582       \textcolor{comment}{// Problem\_pt-\/>Dof\_distribution\_pt-\/>build(Problem\_pt-\/>communicator\_pt(),}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03583}03583       \textcolor{comment}{//                                       Ndof*2+2,false);}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03584}03584       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03585}03585       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a196adc8e79a66292d2df9bd9093f8f73}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03586}03586 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03587}03587       \textcolor{comment}{// Set the solve flag}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03588}03588       \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a614de1eea213de58687ed161fc7c53ae}{Solve\_which\_system}} = \mbox{\hyperlink{classoomph_1_1PitchForkHandler_a51e85b70ec1c902015024b18bdb3dacba0e7d0b0eb06a1f2d90a3ab2831bec36d}{Full\_augmented}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03589}03589     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03590}03590   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03591}03591 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03592}03592 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03593}03593 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03594}03594 \textcolor{comment}{}  \textcolor{comment}{// Non-\/inline functions for the BlockHopfLinearSolver class}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03595}03595 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03596}03596 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03597}03597 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03598}03598   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03599}03599 \textcolor{comment}{  /// Clean up the memory that may have been allocated by the solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03600}03600 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03601}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a7a77bcca3b3018995f644fff39c7a957}{03601}}   \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a7a77bcca3b3018995f644fff39c7a957}{BlockHopfLinearSolver::\string~BlockHopfLinearSolver}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03602}03602   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03603}03603     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03604}03604     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03605}03605       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03606}03606     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03607}03607     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03608}03608     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03609}03609       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03610}03610     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03611}03611     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03612}03612     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03613}03613       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03614}03614     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03615}03615   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03616}03616 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03617}03617   \textcolor{comment}{//===================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03618}03618 \textcolor{comment}{  /// Use a block factorisation to solve the augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03619}03619 \textcolor{comment}{  /// associated with a Hopf bifurcation.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03620}03620 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03621}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a5e9ff24466ec138cca8264e5befc31fe}{03621}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a5e9ff24466ec138cca8264e5befc31fe}{BlockHopfLinearSolver::solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03622}03622                                     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03623}03623   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03624}03624     \textcolor{comment}{// if the result is setup then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03625}03625 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03626}03626     \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03627}03627     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03628}03628       \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03629}03629       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03630}03630         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The result vector must not be distributed"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03631}03631                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03632}03632                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03633}03633       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03634}03634     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03635}03635 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03636}03636 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03637}03637     \textcolor{comment}{// Locally cache the pointer to the handler.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03638}03638     \mbox{\hyperlink{classoomph_1_1HopfHandler}{HopfHandler}}* handler\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03639}03639       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1HopfHandler}{HopfHandler}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03640}03640 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03641}03641     \textcolor{comment}{// Find the number of dofs in the augmented problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03642}03642     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03643}03643 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03644}03644     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03645}03645     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03646}03646     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03647}03647     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03648}03648 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03649}03649     \textcolor{comment}{// Firstly, let's calculate the derivative of the residuals wrt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03650}03650     \textcolor{comment}{// the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03651}03651     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} dRdparam(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03652}03652 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03653}03653     \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03654}03654     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03655}03655       \textcolor{comment}{// Cache pointer to the parameter (second last entry in the vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03656}03656       \textcolor{keywordtype}{double}* param\_pt = \&problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n\_dof -\/ 2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03657}03657       \textcolor{comment}{// Backup the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03658}03658       \textcolor{keywordtype}{double} old\_var = *param\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03659}03659       ;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03660}03660       \textcolor{comment}{// Increment the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03661}03661       *param\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03662}03662       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03663}03663 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03664}03664       \textcolor{comment}{// Now calculate the new residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03665}03665       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(dRdparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03666}03666 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03667}03667       \textcolor{comment}{// Now calculate the difference assume original residuals in resul}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03668}03668       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03669}03669       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03670}03670         dRdparam[n] = (dRdparam[n] -\/ result[n]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03671}03671       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03672}03672 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03673}03673       \textcolor{comment}{// Reset the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03674}03674       *param\_pt = old\_var;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03675}03675       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03676}03676     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03677}03677 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03678}03678     \textcolor{comment}{// Switch the handler to "{}standard"{} mode}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03679}03679     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_acd2149152659deef1d938739222dbcf2}{solve\_standard\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03680}03680 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03681}03681     \textcolor{comment}{// Find out the number of dofs in the non-\/standard problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03682}03682     n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03683}03683 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03684}03684     \textcolor{comment}{// update the distribution pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03685}03685     dist.\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03686}03686     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03687}03687 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03688}03688     \textcolor{comment}{// Setup storage for temporary vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03689}03689     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} y1(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03690}03690       alpha(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03691}03691 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03692}03692     \textcolor{comment}{// Allocate storage for A which can be used in the resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03693}03693     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03694}03694     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03695}03695       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03696}03696     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03697}03697     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03698}03698 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03699}03699     \textcolor{comment}{// We are going to do resolves using the underlying linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03700}03700     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03701}03701 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03702}03702     \textcolor{comment}{// Solve the first system Jy1 = R}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03703}03703     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, y1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03704}03704 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03705}03705     \textcolor{comment}{// This should have set the sign of the jacobian, store it}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03706}03706     \textcolor{keywordtype}{int} sign\_of\_jacobian = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03707}03707 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03708}03708     \textcolor{comment}{// Now let's get the appropriate bit of alpha}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03709}03709     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03710}03710     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03711}03711       alpha[n] = dRdparam[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03712}03712     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03713}03713 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03714}03714     \textcolor{comment}{// Resolve to find A}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03715}03715     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(alpha, *\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03716}03716 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03717}03717     \textcolor{comment}{// Now set to the complex system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03718}03718     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_ac7feecfa644ae33b4a4a9fa8d1d993af}{solve\_complex\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03719}03719 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03720}03720     \textcolor{comment}{// update the distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03721}03721     dist.\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof * 2, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03722}03722     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03723}03723 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03724}03724     \textcolor{comment}{// Resize the stored vector G}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03725}03725     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03726}03726     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03727}03727       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03728}03728     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03729}03729     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03730}03730 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03731}03731     \textcolor{comment}{// Solve the first Zg = (Mz -\/My)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03732}03732     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, *\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03733}03733 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03734}03734     \textcolor{comment}{// This should have set the sign of the complex matrix's determinant,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03735}03735     \textcolor{comment}{// multiply}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03736}03736     sign\_of\_jacobian *= problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03737}03737 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03738}03738     \textcolor{comment}{// We can now construct our multipliers}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03739}03739     \textcolor{comment}{// Prepare to scale}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03740}03740     \textcolor{keywordtype}{double} dof\_length = 0.0, a\_length = 0.0, y1\_length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03741}03741     \textcolor{comment}{// Loop over the standard number of dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03742}03742     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03743}03743     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03744}03744       \textcolor{keywordflow}{if} (std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n)) > dof\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03745}03745       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03746}03746         dof\_length = std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03747}03747       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03748}03748       \textcolor{keywordflow}{if} (std::fabs((*\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}})[n]) > a\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03749}03749       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03750}03750         a\_length = std::fabs((*\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}})[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03751}03751       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03752}03752       \textcolor{keywordflow}{if} (std::fabs(y1[n]) > y1\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03753}03753       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03754}03754         y1\_length = std::fabs(y1[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03755}03755       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03756}03756     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03757}03757 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03758}03758     \textcolor{keywordtype}{double} a\_mult = dof\_length / a\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03759}03759     \textcolor{keywordtype}{double} y1\_mult = dof\_length / y1\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03760}03760     a\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03761}03761     y1\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03762}03762     a\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03763}03763     y1\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03764}03764 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03765}03765     \textcolor{comment}{// Local storage for the product terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03766}03766     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} Jprod\_a(2 * n\_dof, 0.0), Jprod\_y1(2 * n\_dof, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03767}03767 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03768}03768     \textcolor{comment}{// Temporary storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03769}03769     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} rhs(2 * n\_dof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03770}03770 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03771}03771     \textcolor{comment}{// find the number of elements}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03772}03772     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03773}03773 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03774}03774     \textcolor{comment}{// Calculate the product of the jacobian matrices, etc}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03775}03775     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03776}03776     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03777}03777       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03778}03778       \textcolor{comment}{// Loop over the ndofs in each element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03779}03779       \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03780}03780       \textcolor{comment}{// Get the jacobian matrices}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03781}03781       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac(n\_var), jac\_a(n\_var), jac\_y1(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03782}03782       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} M(n\_var), M\_a(n\_var), M\_y1(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03783}03783       \textcolor{comment}{// Get unperturbed jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03784}03784       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(rhs, jac, M);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03785}03785 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03786}03786       \textcolor{comment}{// Backup the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03787}03787       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dof\_bac(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03788}03788       \textcolor{comment}{// Perturb the original dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03789}03789       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03790}03790       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03791}03791         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03792}03792         dof\_bac[n] = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03793}03793         \textcolor{comment}{// Pertub by vector A}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03794}03794         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += a\_mult * (*A\_pt)[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03795}03795       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03796}03796 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03797}03797       \textcolor{comment}{// Now get the new jacobian and mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03798}03798       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(rhs, jac\_a, M\_a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03799}03799 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03800}03800       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03801}03801       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03802}03802       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03803}03803         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03804}03804         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03805}03805         \textcolor{comment}{// Pertub by vector y1}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03806}03806         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += y1\_mult * y1[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03807}03807       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03808}03808 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03809}03809       \textcolor{comment}{// Now get the new jacobian and mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03810}03810       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(rhs, jac\_y1, M\_y1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03811}03811 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03812}03812       \textcolor{comment}{// Reset the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03813}03813       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03814}03814       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03815}03815         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03816}03816         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03817}03817       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03818}03818 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03819}03819       \textcolor{comment}{// OK, now work out the products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03820}03820       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03821}03821       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03822}03822         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03823}03823         \textcolor{keywordtype}{double} prod\_a1 = 0.0, prod\_y11 = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03824}03824         \textcolor{keywordtype}{double} prod\_a2 = 0.0, prod\_y12 = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03825}03825         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_var; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03826}03826         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03827}03827           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} unknown = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03828}03828           \textcolor{keyword}{const} \textcolor{keywordtype}{double} y = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03829}03829           \textcolor{keyword}{const} \textcolor{keywordtype}{double} z = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03830}03830           \textcolor{keyword}{const} \textcolor{keywordtype}{double} omega = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03831}03831           \textcolor{comment}{// Real part (first line)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03832}03832           prod\_a1 +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03833}03833             (jac\_a(n, m) -\/ jac(n, m)) * y + omega * (M\_a(n, m) -\/ M(n, m)) * z;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03834}03834           prod\_y11 +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03835}03835             (jac\_y1(n, m) -\/ jac(n, m)) * y + omega * (M\_y1(n, m) -\/ M(n, m)) * z;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03836}03836           \textcolor{comment}{// Imag par (second line)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03837}03837           prod\_a2 +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03838}03838             (jac\_a(n, m) -\/ jac(n, m)) * z -\/ omega * (M\_a(n, m) -\/ M(n, m)) * y;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03839}03839           prod\_y12 +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03840}03840             (jac\_y1(n, m) -\/ jac(n, m)) * z -\/ omega * (M\_y1(n, m) -\/ M(n, m)) * y;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03841}03841         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03842}03842         Jprod\_a[eqn\_number] += prod\_a1 / a\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03843}03843         Jprod\_y1[eqn\_number] += prod\_y11 / y1\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03844}03844         Jprod\_a[n\_dof + eqn\_number] += prod\_a2 / a\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03845}03845         Jprod\_y1[n\_dof + eqn\_number] += prod\_y12 / y1\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03846}03846       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03847}03847     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03848}03848 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03849}03849     \textcolor{comment}{// The assumption here is still that the result has been set to the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03850}03850     \textcolor{comment}{// residuals.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03851}03851     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < 2 * n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03852}03852     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03853}03853       rhs[n] = result[n\_dof + n] -\/ Jprod\_y1[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03854}03854     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03855}03855 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03856}03856     \textcolor{comment}{// Temporary storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03857}03857     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} y2(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03858}03858 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03859}03859     \textcolor{comment}{// DoubleVector for rhs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03860}03860     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} rhs2(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03861}03861     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2 * n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03862}03862     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03863}03863       rhs2[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03864}03864     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03865}03865 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03866}03866     \textcolor{comment}{// Solve it}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03867}03867     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(rhs2, y2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03868}03868 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03869}03869     \textcolor{comment}{// Assemble the next RHS}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03870}03870     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < 2 * n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03871}03871     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03872}03872       rhs[n] = dRdparam[n\_dof + n] -\/ Jprod\_a[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03873}03873     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03874}03874 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03875}03875     \textcolor{comment}{// Resive the storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03876}03876     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03877}03877     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03878}03878       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03879}03879     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03880}03880     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03881}03881 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03882}03882     \textcolor{comment}{// Solve for the next RHS}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03883}03883     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2 * n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03884}03884     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03885}03885       rhs2[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03886}03886     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03887}03887     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(rhs2, *\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03888}03888 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03889}03889     \textcolor{comment}{// We can now calculate the final corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03890}03890     \textcolor{comment}{// We need to work out a large number of dot products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03891}03891     \textcolor{keywordtype}{double} dot\_c = 0.0, dot\_d = 0.0, dot\_e = 0.0, dot\_f = 0.0, dot\_g = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03892}03892     \textcolor{keywordtype}{double} dot\_h = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03893}03893 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03894}03894     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03895}03895     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03896}03896       \textcolor{comment}{// Get the appopriate entry}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03897}03897       \textcolor{keyword}{const} \textcolor{keywordtype}{double} Cn = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03898}03898       dot\_c += Cn * y2[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03899}03899       dot\_d += Cn * y2[n\_dof + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03900}03900       dot\_e += Cn * (*E\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03901}03901       dot\_f += Cn * (*E\_pt)[n\_dof + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03902}03902       dot\_g += Cn * (*G\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03903}03903       dot\_h += Cn * (*G\_pt)[n\_dof + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03904}03904     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03905}03905 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03906}03906     \textcolor{comment}{// Now we should be able to work out the corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03907}03907     \textcolor{keywordtype}{double} denom = dot\_e * dot\_h -\/ dot\_g * dot\_f;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03908}03908 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03909}03909     \textcolor{comment}{// Copy the previous residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03910}03910     \textcolor{keywordtype}{double} R31 = result[3 * n\_dof], R32 = result[3 * n\_dof + 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03911}03911     \textcolor{comment}{// Delta parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03912}03912     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_param =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03913}03913       ((R32 -\/ dot\_d) * dot\_g -\/ (R31 -\/ dot\_c) * dot\_h) / denom;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03914}03914     \textcolor{comment}{// Delta frequency}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03915}03915     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_w = -\/((R32 -\/ dot\_d) + dot\_f * delta\_param) / (dot\_h);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03916}03916 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03917}03917     \textcolor{comment}{// Load into the result vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03918}03918     result[3 * n\_dof] = delta\_param;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03919}03919     result[3 * n\_dof + 1] = delta\_w;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03920}03920 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03921}03921     \textcolor{comment}{// The corrections to the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03922}03922     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < 2 * n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03923}03923     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03924}03924       result[n\_dof + n] =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03925}03925         y2[n] -\/ (*E\_pt)[n] * delta\_param -\/ (*G\_pt)[n] * delta\_w;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03926}03926     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03927}03927 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03928}03928     \textcolor{comment}{// Finally add the corrections to the unknowns}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03929}03929     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03930}03930     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03931}03931       result[n] = y1[n] -\/ (*A\_pt)[n] * delta\_param;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03932}03932     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03933}03933 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03934}03934     \textcolor{comment}{// The sign of the jacobian is the previous signs multiplied by the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03935}03935     \textcolor{comment}{// sign of the denominator}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03936}03936     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}() =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03937}03937       sign\_of\_jacobian * \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(std::fabs(denom) / denom);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03938}03938 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03939}03939     \textcolor{comment}{// Switch things to our full solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03940}03940     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a507681043126f6bea58cc90deed16d1d}{solve\_full\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03941}03941 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03942}03942     \textcolor{comment}{// If we are not storing things, clear the results}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03943}03943     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03944}03944     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03945}03945       \textcolor{comment}{// We no longer need to store the matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03946}03946       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03947}03947       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03948}03948       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03949}03949       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03950}03950       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03951}03951       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03952}03952       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03953}03953     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03954}03954     \textcolor{comment}{// Otherwise, also store the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03955}03955     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03956}03956     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03957}03957       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a669990e3fce8c84545e112c4f5f3ffd0}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03958}03958     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03959}03959   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03960}03960 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03961}03961   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03962}03962 \textcolor{comment}{  /// Solve for two right hand sides, required for (efficient) continuation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03963}03963 \textcolor{comment}{  /// because otherwise we have to store the inverse of the jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03964}03964 \textcolor{comment}{  /// and the complex equivalent ... nasty.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03965}03965 \textcolor{comment}{}  \textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03966}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9a7cc6bda9ab1a8baf83d5d8e1fe5eea}{03966}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9a7cc6bda9ab1a8baf83d5d8e1fe5eea}{BlockHopfLinearSolver::solve\_for\_two\_rhs}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03967}03967                                                 \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03968}03968                                                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs2,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03969}03969                                                 \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result2)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03970}03970   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03971}03971     \textcolor{comment}{// if the result is setup then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03972}03972 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03973}03973     \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03974}03974     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03975}03975       \textcolor{keywordflow}{if} (result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03976}03976       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03977}03977         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The result vector must not be distributed"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03978}03978                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03979}03979                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03980}03980       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03981}03981     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03982}03982     \textcolor{keywordflow}{if} (result2.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03983}03983     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03984}03984       \textcolor{keywordflow}{if} (result2.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03985}03985       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03986}03986         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}The result2 vector must not be distributed"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03987}03987                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03988}03988                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03989}03989       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03990}03990     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03991}03991 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03992}03992 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03993}03993     \textcolor{comment}{// Locally cache the pointer to the handler.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03994}03994     \mbox{\hyperlink{classoomph_1_1HopfHandler}{HopfHandler}}* handler\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03995}03995       \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classoomph_1_1HopfHandler}{HopfHandler}}*\textcolor{keyword}{>}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae9bdfd163f7e94e89bfcdc1f229e3743}{assembly\_handler\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03996}03996 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03997}03997     \textcolor{comment}{// Find the number of dofs in the augmented problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03998}03998     \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l03999}03999 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04000}04000     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04001}04001     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04002}04002     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04003}04003     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04004}04004 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04005}04005     \textcolor{comment}{// if the result vector is not setup then rebuild with distribution = global}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04006}04006     \textcolor{keywordflow}{if} (!result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04007}04007     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04008}04008       result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04009}04009     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04010}04010     \textcolor{keywordflow}{if} (!result2.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04011}04011     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04012}04012       result2.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04013}04013     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04014}04014 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04015}04015     \textcolor{comment}{// Firstly, let's calculate the derivative of the residuals wrt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04016}04016     \textcolor{comment}{// the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04017}04017     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} dRdparam(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04018}04018 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04019}04019     \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04020}04020     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04021}04021       \textcolor{comment}{// Cache pointer to the parameter (second last entry in the vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04022}04022       \textcolor{keywordtype}{double}* param\_pt = \&problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n\_dof -\/ 2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04023}04023       \textcolor{comment}{// Backup the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04024}04024       \textcolor{keywordtype}{double} old\_var = *param\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04025}04025       ;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04026}04026       \textcolor{comment}{// Increment the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04027}04027       *param\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04028}04028       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04029}04029 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04030}04030       \textcolor{comment}{// Now calculate the new residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04031}04031       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a7300386d91390e3e5be993aca7459498}{get\_residuals}}(dRdparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04032}04032 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04033}04033       \textcolor{comment}{// Now calculate the difference assume original residuals in resul}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04034}04034       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04035}04035       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04036}04036         dRdparam[n] = (dRdparam[n] -\/ result[n]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04037}04037       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04038}04038 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04039}04039       \textcolor{comment}{// Reset the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04040}04040       *param\_pt = old\_var;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04041}04041       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04042}04042     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04043}04043 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04044}04044     \textcolor{comment}{// Switch the handler to "{}standard"{} mode}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04045}04045     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_acd2149152659deef1d938739222dbcf2}{solve\_standard\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04046}04046 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04047}04047     \textcolor{comment}{// Find out the number of dofs in the non-\/standard problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04048}04048     n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04049}04049 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04050}04050     \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04051}04051     dist.\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04052}04052     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04053}04053 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04054}04054     \textcolor{comment}{// Setup storage for temporary vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04055}04055     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} y1(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04056}04056       alpha(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04057}04057       y1\_resolve(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04058}04058 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04059}04059     \textcolor{comment}{// Allocate storage for A which can be used in the resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04060}04060     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04061}04061     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04062}04062       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04063}04063     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04064}04064     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04065}04065 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04066}04066     \textcolor{comment}{// We are going to do resolves using the underlying linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04067}04067     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04068}04068 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04069}04069     \textcolor{comment}{// Solve the first system Jy1 =}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04070}04070     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, y1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04071}04071 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04072}04072     \textcolor{comment}{// This should have set the sign of the jacobian, store it}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04073}04073     \textcolor{keywordtype}{int} sign\_of\_jacobian = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04074}04074 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04075}04075     \textcolor{comment}{// Now let's get the appropriate bit of alpha}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04076}04076     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04077}04077     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04078}04078       alpha[n] = dRdparam[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04079}04079     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04080}04080 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04081}04081     \textcolor{comment}{// Resolve to find A}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04082}04082     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(alpha, *\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04083}04083 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04084}04084     \textcolor{comment}{// Get the solution for the second rhs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04085}04085     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04086}04086     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04087}04087       alpha[n] = rhs2[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04088}04088     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04089}04089 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04090}04090     \textcolor{comment}{// Resolve to find y1\_resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04091}04091     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(alpha, y1\_resolve);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04092}04092 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04093}04093     \textcolor{comment}{// Now set to the complex system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04094}04094     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_ac7feecfa644ae33b4a4a9fa8d1d993af}{solve\_complex\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04095}04095 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04096}04096     \textcolor{comment}{// rebuild the Distribution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04097}04097     dist.\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof * 2, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04098}04098     this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04099}04099 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04100}04100     \textcolor{comment}{// Resize the stored vector G}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04101}04101     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04102}04102     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04103}04103       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04104}04104     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04105}04105     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04106}04106 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04107}04107     \textcolor{comment}{// Solve the first Zg = (Mz -\/My)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04108}04108     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, *\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04109}04109 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04110}04110     \textcolor{comment}{// This should have set the sign of the complex matrix's determinant,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04111}04111     \textcolor{comment}{// multiply}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04112}04112     sign\_of\_jacobian *= problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04113}04113 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04114}04114     \textcolor{comment}{// We can now construct our multipliers}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04115}04115     \textcolor{comment}{// Prepare to scale}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04116}04116     \textcolor{keywordtype}{double} dof\_length = 0.0, a\_length = 0.0, y1\_length = 0.0,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04117}04117            y1\_resolve\_length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04118}04118     \textcolor{comment}{// Loop over the standard number of dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04119}04119     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04120}04120     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04121}04121       \textcolor{keywordflow}{if} (std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n)) > dof\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04122}04122       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04123}04123         dof\_length = std::fabs(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(n));}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04124}04124       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04125}04125       \textcolor{keywordflow}{if} (std::fabs((*\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}})[n]) > a\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04126}04126       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04127}04127         a\_length = std::fabs((*\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}})[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04128}04128       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04129}04129       \textcolor{keywordflow}{if} (std::fabs(y1[n]) > y1\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04130}04130       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04131}04131         y1\_length = std::fabs(y1[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04132}04132       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04133}04133       \textcolor{keywordflow}{if} (std::fabs(y1\_resolve[n]) > y1\_resolve\_length)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04134}04134       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04135}04135         y1\_resolve\_length = std::fabs(y1[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04136}04136       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04137}04137     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04138}04138 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04139}04139 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04140}04140     \textcolor{keywordtype}{double} a\_mult = dof\_length / a\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04141}04141     \textcolor{keywordtype}{double} y1\_mult = dof\_length / y1\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04142}04142     \textcolor{keywordtype}{double} y1\_resolve\_mult = dof\_length / y1\_resolve\_length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04143}04143     a\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04144}04144     y1\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04145}04145     y1\_resolve\_mult += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04146}04146     a\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04147}04147     y1\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04148}04148     y1\_resolve\_mult *= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04149}04149 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04150}04150     \textcolor{comment}{// Local storage for the product terms}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04151}04151     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} Jprod\_a(2 * n\_dof, 0.0), Jprod\_y1(2 * n\_dof, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04152}04152     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} Jprod\_y1\_resolve(2 * n\_dof, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04153}04153 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04154}04154     \textcolor{comment}{// Temporary storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04155}04155     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} rhs(2 * n\_dof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04156}04156 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04157}04157     \textcolor{comment}{// find the number of elements}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04158}04158     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04159}04159 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04160}04160     \textcolor{comment}{// Calculate the product of the jacobian matrices, etc}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04161}04161     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04162}04162     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04163}04163       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04164}04164       \textcolor{comment}{// Loop over the ndofs in each element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04165}04165       \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04166}04166       \textcolor{comment}{// Get the jacobian matrices}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04167}04167       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jac(n\_var), jac\_a(n\_var), jac\_y1(n\_var),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04168}04168         jac\_y1\_resolve(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04169}04169       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} M(n\_var), M\_a(n\_var), M\_y1(n\_var),}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04170}04170         M\_y1\_resolve(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04171}04171       \textcolor{comment}{// Get unperturbed jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04172}04172       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(rhs, jac, M);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04173}04173 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04174}04174       \textcolor{comment}{// Backup the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04175}04175       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dof\_bac(n\_var);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04176}04176       \textcolor{comment}{// Perturb the original dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04177}04177       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04178}04178       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04179}04179         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04180}04180         dof\_bac[n] = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04181}04181         \textcolor{comment}{// Pertub by vector A}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04182}04182         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += a\_mult * (*A\_pt)[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04183}04183       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04184}04184 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04185}04185       \textcolor{comment}{// Now get the new jacobian and mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04186}04186       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(rhs, jac\_a, M\_a);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04187}04187 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04188}04188       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04189}04189       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04190}04190       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04191}04191         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04192}04192         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04193}04193         \textcolor{comment}{// Pertub by vector y1}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04194}04194         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += y1\_mult * y1[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04195}04195       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04196}04196 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04197}04197       \textcolor{comment}{// Now get the new jacobian and mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04198}04198       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(rhs, jac\_y1, M\_y1);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04199}04199 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04200}04200       \textcolor{comment}{// Perturb the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04201}04201       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04202}04202       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04203}04203         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04204}04204         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04205}04205         \textcolor{comment}{// Pertub by vector y1}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04206}04206         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) += y1\_resolve\_mult * y1\_resolve[eqn\_number];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04207}04207       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04208}04208 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04209}04209       \textcolor{comment}{// Now get the new jacobian and mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04210}04210       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(rhs, jac\_y1\_resolve, M\_y1\_resolve);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04211}04211 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04212}04212       \textcolor{comment}{// Reset the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04213}04213       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04214}04214       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04215}04215         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04216}04216         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a2c025f1ba8a9f67bd7ee2dc70462b49a}{dof}}(eqn\_number) = dof\_bac[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04217}04217       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04218}04218 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04219}04219       \textcolor{comment}{// OK, now work out the products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04220}04220       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04221}04221       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04222}04222         \textcolor{keywordtype}{unsigned} eqn\_number = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04223}04223         \textcolor{keywordtype}{double} prod\_a1 = 0.0, prod\_y11 = 0.0, prod\_y1\_resolve1 = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04224}04224         \textcolor{keywordtype}{double} prod\_a2 = 0.0, prod\_y12 = 0.0, prod\_y1\_resolve2 = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04225}04225         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_var; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04226}04226         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04227}04227           \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} unknown = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04228}04228           \textcolor{keyword}{const} \textcolor{keywordtype}{double} y = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04229}04229           \textcolor{keyword}{const} \textcolor{keywordtype}{double} z = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04230}04230           \textcolor{keyword}{const} \textcolor{keywordtype}{double} omega = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04231}04231           \textcolor{comment}{// Real part (first line)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04232}04232           prod\_a1 +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04233}04233             (jac\_a(n, m) -\/ jac(n, m)) * y + omega * (M\_a(n, m) -\/ M(n, m)) * z;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04234}04234           prod\_y11 +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04235}04235             (jac\_y1(n, m) -\/ jac(n, m)) * y + omega * (M\_y1(n, m) -\/ M(n, m)) * z;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04236}04236           prod\_y1\_resolve1 += (jac\_y1\_resolve(n, m) -\/ jac(n, m)) * y +}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04237}04237                               omega * (M\_y1\_resolve(n, m) -\/ M(n, m)) * z;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04238}04238           \textcolor{comment}{// Imag par (second line)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04239}04239           prod\_a2 +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04240}04240             (jac\_a(n, m) -\/ jac(n, m)) * z -\/ omega * (M\_a(n, m) -\/ M(n, m)) * y;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04241}04241           prod\_y12 +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04242}04242             (jac\_y1(n, m) -\/ jac(n, m)) * z -\/ omega * (M\_y1(n, m) -\/ M(n, m)) * y;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04243}04243           prod\_y1\_resolve2 += (jac\_y1\_resolve(n, m) -\/ jac(n, m)) * z -\/}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04244}04244                               omega * (M\_y1\_resolve(n, m) -\/ M(n, m)) * y;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04245}04245         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04246}04246         Jprod\_a[eqn\_number] += prod\_a1 / a\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04247}04247         Jprod\_y1[eqn\_number] += prod\_y11 / y1\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04248}04248         Jprod\_y1\_resolve[eqn\_number] += prod\_y1\_resolve1 / y1\_resolve\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04249}04249         Jprod\_a[n\_dof + eqn\_number] += prod\_a2 / a\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04250}04250         Jprod\_y1[n\_dof + eqn\_number] += prod\_y12 / y1\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04251}04251         Jprod\_y1\_resolve[n\_dof + eqn\_number] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04252}04252           prod\_y1\_resolve2 / y1\_resolve\_mult;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04253}04253       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04254}04254     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04255}04255 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04256}04256     \textcolor{comment}{// The assumption here is still that the result has been set to the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04257}04257     \textcolor{comment}{// residuals.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04258}04258     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < 2 * n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04259}04259     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04260}04260       rhs[n] = result[n\_dof + n] -\/ Jprod\_y1[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04261}04261     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04262}04262 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04263}04263     \textcolor{comment}{// Temporary storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04264}04264     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} y2(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04265}04265 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04266}04266     \textcolor{comment}{// Solve it}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04267}04267     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_rhs(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04268}04268     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2 * n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04269}04269     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04270}04270       temp\_rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04271}04271     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04272}04272     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(temp\_rhs, y2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04273}04273 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04274}04274     \textcolor{comment}{// Assemble the next RHS}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04275}04275     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < 2 * n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04276}04276     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04277}04277       rhs[n] = dRdparam[n\_dof + n] -\/ Jprod\_a[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04278}04278     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04279}04279 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04280}04280     \textcolor{comment}{// Resive the storage}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04281}04281     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}} != 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04282}04282     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04283}04283       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04284}04284     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04285}04285     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04286}04286 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04287}04287     \textcolor{comment}{// Solve for the next RHS}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04288}04288     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2 * n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04289}04289     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04290}04290       temp\_rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04291}04291     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04292}04292     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(temp\_rhs, *\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04293}04293 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04294}04294     \textcolor{comment}{// Assemble the next RHS}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04295}04295     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < 2 * n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04296}04296     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04297}04297       rhs[n] = rhs2[n\_dof + n] -\/ Jprod\_y1\_resolve[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04298}04298     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04299}04299 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04300}04300     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} y2\_resolve(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04301}04301     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2 * n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04302}04302     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04303}04303       temp\_rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = rhs[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04304}04304     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04305}04305     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(temp\_rhs, y2\_resolve);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04306}04306 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04307}04307 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04308}04308     \textcolor{comment}{// We can now calculate the final corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04309}04309     \textcolor{comment}{// We need to work out a large number of dot products}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04310}04310     \textcolor{keywordtype}{double} dot\_c = 0.0, dot\_d = 0.0, dot\_e = 0.0, dot\_f = 0.0, dot\_g = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04311}04311     \textcolor{keywordtype}{double} dot\_h = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04312}04312 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04313}04313     \textcolor{keywordtype}{double} dot\_c\_resolve = 0.0, dot\_d\_resolve = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04314}04314 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04315}04315     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04316}04316     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04317}04317       \textcolor{comment}{// Get the appopriate entry}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04318}04318       \textcolor{keyword}{const} \textcolor{keywordtype}{double} Cn = handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04319}04319       dot\_c += Cn * y2[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04320}04320       dot\_d += Cn * y2[n\_dof + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04321}04321       dot\_c\_resolve += Cn * y2\_resolve[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04322}04322       dot\_d\_resolve += Cn * y2\_resolve[n\_dof + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04323}04323       dot\_e += Cn * (*E\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04324}04324       dot\_f += Cn * (*E\_pt)[n\_dof + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04325}04325       dot\_g += Cn * (*G\_pt)[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04326}04326       dot\_h += Cn * (*G\_pt)[n\_dof + n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04327}04327     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04328}04328 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04329}04329     \textcolor{comment}{// Now we should be able to work out the corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04330}04330     \textcolor{keywordtype}{double} denom = dot\_e * dot\_h -\/ dot\_g * dot\_f;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04331}04331 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04332}04332     \textcolor{comment}{// Copy the previous residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04333}04333     \textcolor{keywordtype}{double} R31 = result[3 * n\_dof], R32 = result[3 * n\_dof + 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04334}04334     \textcolor{comment}{// Delta parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04335}04335     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_param =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04336}04336       ((R32 -\/ dot\_d) * dot\_g -\/ (R31 -\/ dot\_c) * dot\_h) / denom;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04337}04337     \textcolor{comment}{// Delta frequency}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04338}04338     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_w = -\/((R32 -\/ dot\_d) + dot\_f * delta\_param) / (dot\_h);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04339}04339 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04340}04340     \textcolor{comment}{// Corrections}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04341}04341     \textcolor{keywordtype}{double} R31\_resolve = rhs2[3 * n\_dof], R32\_resolve = rhs2[3 * n\_dof + 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04342}04342     \textcolor{comment}{// Delta parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04343}04343     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_param\_resolve = ((R32\_resolve -\/ dot\_d\_resolve) * dot\_g -\/}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04344}04344                                         (R31\_resolve -\/ dot\_c\_resolve) * dot\_h) /}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04345}04345                                        denom;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04346}04346     \textcolor{comment}{// Delta frequency}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04347}04347     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta\_w\_resolve =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04348}04348       -\/((R32\_resolve -\/ dot\_d\_resolve) + dot\_f * delta\_param\_resolve) / (dot\_h);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04349}04349 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04350}04350 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04351}04351     \textcolor{comment}{// Load into the result vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04352}04352     result[3 * n\_dof] = delta\_param;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04353}04353     result[3 * n\_dof + 1] = delta\_w;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04354}04354 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04355}04355     \textcolor{comment}{// The corrections to the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04356}04356     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < 2 * n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04357}04357     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04358}04358       result[n\_dof + n] =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04359}04359         y2[n] -\/ (*E\_pt)[n] * delta\_param -\/ (*G\_pt)[n] * delta\_w;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04360}04360     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04361}04361 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04362}04362     \textcolor{comment}{// Finally add the corrections to the unknowns}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04363}04363     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04364}04364     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04365}04365       result[n] = y1[n] -\/ (*A\_pt)[n] * delta\_param;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04366}04366     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04367}04367 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04368}04368     \textcolor{comment}{// Load into the result vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04369}04369     result2[3 * n\_dof] = delta\_param\_resolve;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04370}04370     result2[3 * n\_dof + 1] = delta\_w\_resolve;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04371}04371 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04372}04372     \textcolor{comment}{// The corrections to the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04373}04373     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < 2 * n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04374}04374     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04375}04375       result2[n\_dof + n] = y2\_resolve[n] -\/ (*E\_pt)[n] * delta\_param\_resolve -\/}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04376}04376                            (*G\_pt)[n] * delta\_w\_resolve;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04377}04377     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04378}04378 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04379}04379     \textcolor{comment}{// Finally add the corrections to the unknowns}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04380}04380     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_dof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04381}04381     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04382}04382       result2[n] = y1\_resolve[n] -\/ (*A\_pt)[n] * delta\_param\_resolve;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04383}04383     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04384}04384 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04385}04385 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04386}04386     \textcolor{comment}{// The sign of the jacobian is the previous signs multiplied by the}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04387}04387     \textcolor{comment}{// sign of the denominator}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04388}04388     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af45e04e4e24b02e92eb16b911cdc2466}{sign\_of\_jacobian}}() =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04389}04389       sign\_of\_jacobian * \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(std::fabs(denom) / denom);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04390}04390 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04391}04391     \textcolor{comment}{// Switch things to our full solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04392}04392     handler\_pt-\/>\mbox{\hyperlink{classoomph_1_1HopfHandler_a507681043126f6bea58cc90deed16d1d}{solve\_full\_system}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04393}04393 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04394}04394     \textcolor{comment}{// If we are not storing things, clear the results}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04395}04395     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04396}04396     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04397}04397       \textcolor{comment}{// We no longer need to store the matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04398}04398       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2526b2121ee73c372a4f3880e174f731}{Linear\_solver\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04399}04399       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04400}04400       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a431b373890e0a97bf46d3f601e4df64d}{A\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04401}04401       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04402}04402       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a9f3aabed3c101b9a9a9fb1cdce4bbbbf}{E\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04403}04403       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04404}04404       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_ad6a5a8e115e10632da3815aeaff6c1d0}{G\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04405}04405     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04406}04406     \textcolor{comment}{// Otherwise, also store the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04407}04407     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04408}04408     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04409}04409       \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a669990e3fce8c84545e112c4f5f3ffd0}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04410}04410     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04411}04411   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04412}04412 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04413}04413 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04414}04414   \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04415}04415   \textcolor{comment}{// Hack the re-\/solve to use the block factorisation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04416}04416   \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04417}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2c0e342f253917e987f8504b16862b2c}{04417}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a2c0e342f253917e987f8504b16862b2c}{BlockHopfLinearSolver::resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04418}04418                                       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04419}04419   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04420}04420     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}resolve() is not implemented for this solver"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04421}04421                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04422}04422                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04423}04423   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04424}04424 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04425}04425 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04426}04426 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04427}04427 \textcolor{comment}{}  \textcolor{comment}{// Non-\/inline functions for the HopfHandler class}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04428}04428 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04429}04429 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04430}04430   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04431}04431 \textcolor{comment}{  /// Constructor: Initialise the hopf handler,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04432}04432 \textcolor{comment}{  /// by setting initial guesses for Phi, Psi  and calculating Count.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04433}04433 \textcolor{comment}{  /// If the system changes, a new  handler must be constructed.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04434}04434 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04435}\mbox{\hyperlink{classoomph_1_1HopfHandler_ac219516b8263300eb5102d38baab05d7}{04435}}   \mbox{\hyperlink{classoomph_1_1HopfHandler_ac219516b8263300eb5102d38baab05d7}{HopfHandler::HopfHandler}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04436}04436                            \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04437}04437     : Solve\_which\_system(0), Parameter\_pt(parameter\_pt), Omega(0.0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04438}04438   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04439}04439     \textcolor{comment}{// Set the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04440}04440     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04441}04441     \textcolor{comment}{// Set the number of non-\/augmented degrees of freedom}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04442}04442     \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04443}04443 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04444}04444     \textcolor{comment}{// create the linear algebra distribution for this solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04445}04445     \textcolor{comment}{// currently only global (non-\/distributed) distributions are allowed}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04446}04446     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}* dist\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04447}04447       \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04448}04448 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04449}04449     \textcolor{comment}{// Resize the vectors of additional dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04450}04450     \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04451}04451     \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04452}04452     \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04453}04453     \mbox{\hyperlink{classoomph_1_1HopfHandler_a1b429a8220b316a487998cae04f46ec7}{Count}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}, 0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04454}04454 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04455}04455     \textcolor{comment}{// Loop over all the elements in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04456}04456     \textcolor{keywordtype}{unsigned} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04457}04457     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04458}04458     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04459}04459       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04460}04460       \textcolor{comment}{// Loop over the local freedoms in an element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04461}04461       \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04462}04462       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04463}04463       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04464}04464         \textcolor{comment}{// Increase the associated global equation number counter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04465}04465         ++\mbox{\hyperlink{classoomph_1_1HopfHandler_a1b429a8220b316a487998cae04f46ec7}{Count}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n)];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04466}04466       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04467}04467     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04468}04468 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04469}04469     \textcolor{comment}{// Calculate the value Phi by}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04470}04470     \textcolor{comment}{// solving the system JPhi = dF/dlambda}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04471}04471 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04472}04472     \textcolor{comment}{// Locally cache the linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04473}04473     \mbox{\hyperlink{classoomph_1_1LinearSolver}{LinearSolver}}* \textcolor{keyword}{const} linear\_solver\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04474}04474 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04475}04475     \textcolor{comment}{// Save the status before entry to this routine}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04476}04476     \textcolor{keywordtype}{bool} enable\_resolve = linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ae1e4d34a7e2b1537d36153f87e8a62a6}{is\_resolve\_enabled}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04477}04477 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04478}04478     \textcolor{comment}{// We need to do a resolve}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04479}04479     linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04480}04480 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04481}04481     \textcolor{comment}{// Storage for the solution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04482}04482     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x(dist\_pt, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04483}04483 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04484}04484     \textcolor{comment}{// Solve the standard problem, we only want to make sure that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04485}04485     \textcolor{comment}{// we factorise the matrix, if it has not been factorised. We shall}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04486}04486     \textcolor{comment}{// ignore the return value of x.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04487}04487     linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{solve}}(problem\_pt, x);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04488}04488 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04489}04489     \textcolor{comment}{// Get the vector dresiduals/dparameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04490}04490     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_af4d959a47ef6a8d50b394a6761dfab5a}{get\_derivative\_wrt\_global\_parameter}}(parameter\_pt, x);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04491}04491 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04492}04492     \textcolor{comment}{// Copy rhs vector into local storage so it doesn't get overwritten}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04493}04493     \textcolor{comment}{// if the linear solver decides to initialise the solution vector, say,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04494}04494     \textcolor{comment}{// which it's quite entitled to do!}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04495}04495     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} input\_x(x);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04496}04496 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04497}04497     \textcolor{comment}{// Now resolve the system with the new RHS and overwrite the solution}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04498}04498     linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3b310d08333033edc119b2a5bd7dcbfb}{resolve}}(input\_x, x);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04499}04499 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04500}04500     \textcolor{comment}{// Restore the storage status of the linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04501}04501     \textcolor{keywordflow}{if} (enable\_resolve)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04502}04502     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04503}04503       linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a3000ebd9becb3468d8a6a821a9cc0cd9}{enable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04504}04504     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04505}04505     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04506}04506     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04507}04507       linear\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04508}04508     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04509}04509 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04510}04510     \textcolor{comment}{// Normalise the solution x}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04511}04511     \textcolor{keywordtype}{double} length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04512}04512     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04513}04513     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04514}04514       length += x[n] * x[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04515}04515     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04516}04516     length = sqrt(length);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04517}04517 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04518}04518     \textcolor{comment}{// Now add the real part of the null space components to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04519}04519     \textcolor{comment}{// unknowns and initialise it all}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04520}04520     \textcolor{comment}{// This is dumb at the moment ... fix with eigensolver?}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04521}04521     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04522}04522     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04523}04523       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04524}04524       \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[n] = \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[n] = -\/x[n] / length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04525}04525     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04526}04526 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04527}04527     \textcolor{comment}{// Set the imaginary part so that the appropriate residual is}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04528}04528     \textcolor{comment}{// zero initially (eigensolvers)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04529}04529     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n += 2)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04530}04530     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04531}04531       \textcolor{comment}{// Make sure that we are not at the end of an array of odd length}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04532}04532       \textcolor{keywordflow}{if} (n != \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} -\/ 1)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04533}04533       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04534}04534         \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[n] = \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[n + 1];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04535}04535         \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[n + 1] = -\/\mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04536}04536       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04537}04537       \textcolor{comment}{// If it's odd set the final entry to zero}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04538}04538       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04539}04539       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04540}04540         \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[n] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04541}04541       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04542}04542     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04543}04543 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04544}04544     \textcolor{comment}{// Next add the imaginary parts of the null space components to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04545}04545     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04546}04546     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04547}04547       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04548}04548     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04549}04549     \textcolor{comment}{// Now add the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04550}04550     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04551}04551     \textcolor{comment}{// Finally add the frequency}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04552}04552     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04553}04553 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04554}04554     \textcolor{comment}{// rebuild the dof dist}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04555}04555     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04556}04556       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} * 3 + 2, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04557}04557     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04558}04558     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04559}04559 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04560}04560     \textcolor{comment}{// delete the dist\_pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04561}04561     \textcolor{keyword}{delete} dist\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04562}04562   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04563}04563 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04564}04564   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04565}04565 \textcolor{comment}{  /// Constructor: Initialise the hopf handler,}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04566}04566 \textcolor{comment}{  /// by setting initial guesses for Phi, Psi, Omega  and calculating Count.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04567}04567 \textcolor{comment}{  /// If the system changes, a new  handler must be constructed.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04568}04568 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04569}\mbox{\hyperlink{classoomph_1_1HopfHandler_a5799482b1a7d06cbefcbcc862d33b41a}{04569}}   \mbox{\hyperlink{classoomph_1_1HopfHandler_ac219516b8263300eb5102d38baab05d7}{HopfHandler::HopfHandler}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04570}04570                            \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04571}04571                            \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& omega,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04572}04572                            \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& phi,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04573}04573                            \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& psi)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04574}04574     : Solve\_which\_system(0), Parameter\_pt(parameter\_pt), Omega(omega)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04575}04575   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04576}04576     \textcolor{comment}{// Set the problem pointer}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04577}04577     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}} = problem\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04578}04578     \textcolor{comment}{// Set the number of non-\/augmented degrees of freedom}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04579}04579     \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04580}04580 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04581}04581     \textcolor{comment}{// Resize the vectors of additional dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04582}04582     \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04583}04583     \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04584}04584     \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04585}04585     \mbox{\hyperlink{classoomph_1_1HopfHandler_a1b429a8220b316a487998cae04f46ec7}{Count}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}, 0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04586}04586 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04587}04587     \textcolor{comment}{// Loop over all the elements in the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04588}04588     \textcolor{keywordtype}{unsigned} n\_element = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04589}04589     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} = 0; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}} < n\_element; \mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04590}04590     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04591}04591       \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* elem\_pt = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_a9a5d03afb8730e9459ecbc67c6439143}{element\_pt}}(\mbox{\hyperlink{cfortran_8h_a37cd013acc76697829c324bdd8562d82}{e}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04592}04592       \textcolor{comment}{// Loop over the local freedoms in an element}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04593}04593       \textcolor{keywordtype}{unsigned} n\_var = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04594}04594       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < n\_var; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04595}04595       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04596}04596         \textcolor{comment}{// Increase the associated global equation number counter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04597}04597         ++\mbox{\hyperlink{classoomph_1_1HopfHandler_a1b429a8220b316a487998cae04f46ec7}{Count}}[elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n)];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04598}04598       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04599}04599     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04600}04600 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04601}04601     \textcolor{comment}{// Normalise the guess for phi}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04602}04602     \textcolor{keywordtype}{double} length = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04603}04603     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04604}04604     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04605}04605       length += phi[n] * phi[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04606}04606     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04607}04607     length = sqrt(length);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04608}04608 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04609}04609     \textcolor{comment}{// Now add the real part of the null space components to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04610}04610     \textcolor{comment}{// unknowns and initialise it all}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04611}04611     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04612}04612     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04613}04613       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04614}04614       \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[n] = \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[n] = phi[n] / length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04615}04615       \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[n] = psi[n] / length;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04616}04616     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04617}04617 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04618}04618     \textcolor{comment}{// Next add the imaginary parts of the null space components to the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04619}04619     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04620}04620     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04621}04621       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04622}04622     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04623}04623 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04624}04624     \textcolor{comment}{// Now add the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04625}04625     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(parameter\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04626}04626     \textcolor{comment}{// Finally add the frequency}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04627}04627     problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04628}04628 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04629}04629     \textcolor{comment}{// rebuild the Dof\_distribution\_pt}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04630}04630     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04631}04631       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} * 3 + 2, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04632}04632     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04633}04633     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04634}04634   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04635}04635 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04636}04636 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04637}04637   \textcolor{comment}{//=======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04638}04638 \textcolor{comment}{  /// Destructor return the problem to its original (non-\/augmented) state}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04639}04639 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04640}\mbox{\hyperlink{classoomph_1_1HopfHandler_a2b2822861fc417fea32cbba38f9dd650}{04640}}   \mbox{\hyperlink{classoomph_1_1HopfHandler_a2b2822861fc417fea32cbba38f9dd650}{HopfHandler::\string~HopfHandler}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04641}04641   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04642}04642     \textcolor{comment}{// If we are using the block solver reset the problem's linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04643}04643     \textcolor{comment}{// to the original one}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04644}04644     \mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver}{BlockHopfLinearSolver}}* block\_hopf\_solver\_pt =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04645}04645       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver}{BlockHopfLinearSolver}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04646}04646     \textcolor{keywordflow}{if} (block\_hopf\_solver\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04647}04647     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04648}04648       \textcolor{comment}{// Reset the problem's linear solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04649}04649       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ac7276ac27f16ea9b90cd6008b365c85a}{linear\_solver\_pt}}() = block\_hopf\_solver\_pt-\/>\mbox{\hyperlink{classoomph_1_1BlockHopfLinearSolver_a40ec63718aa9f3b8709b0d7745643347}{linear\_solver\_pt}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04650}04650       \textcolor{comment}{// Delete the block solver}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04651}04651       \textcolor{keyword}{delete} block\_hopf\_solver\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04652}04652     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04653}04653     \textcolor{comment}{// Now return the problem to its original size}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04654}04654     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04655}04655     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04656}04656       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04657}04657     \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04658}04658     \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04659}04659   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04660}04660 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04661}04661 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04662}04662   \textcolor{comment}{//=============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04663}04663 \textcolor{comment}{  /// Get the number of elemental degrees of freedom}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04664}04664 \textcolor{comment}{}  \textcolor{comment}{//=============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04665}\mbox{\hyperlink{classoomph_1_1HopfHandler_a8d1b73ec4e9b8b27252b4bacf2ef7f38}{04665}}   \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1HopfHandler_a8d1b73ec4e9b8b27252b4bacf2ef7f38}{HopfHandler::ndof}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04666}04666   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04667}04667     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04668}04668     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04669}04669     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04670}04670         \textcolor{comment}{// Full augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04671}04671       \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04672}04672         \textcolor{keywordflow}{return} (3 * raw\_ndof + 2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04673}04673         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04674}04674         \textcolor{comment}{// Standard non-\/augmented system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04675}04675       \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04676}04676         \textcolor{keywordflow}{return} raw\_ndof;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04677}04677         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04678}04678         \textcolor{comment}{// Complex system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04679}04679       \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04680}04680         \textcolor{keywordflow}{return} (2 * raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04681}04681         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04682}04682 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04683}04683       \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04684}04684         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Solve\_which\_system can only be 0,1 or 2"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04685}04685                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04686}04686                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04687}04687     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04688}04688   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04689}04689 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04690}04690   \textcolor{comment}{//=============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04691}04691 \textcolor{comment}{  /// Get the global equation number of the local unknown}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04692}04692 \textcolor{comment}{}  \textcolor{comment}{//============================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04693}\mbox{\hyperlink{classoomph_1_1HopfHandler_a9feb8087e8b9554164c0de002f4ec056}{04693}}   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \mbox{\hyperlink{classoomph_1_1HopfHandler_a9feb8087e8b9554164c0de002f4ec056}{HopfHandler::eqn\_number}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04694}04694                                         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ieqn\_local)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04695}04695   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04696}04696     \textcolor{comment}{// Get the raw value}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04697}04697     \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04698}04698     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} global\_eqn;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04699}04699     \textcolor{keywordflow}{if} (ieqn\_local < raw\_ndof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04700}04700     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04701}04701       global\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04702}04702     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04703}04703     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ieqn\_local < 2 * raw\_ndof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04704}04704     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04705}04705       global\_eqn = \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} + elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local -\/ raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04706}04706     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04707}04707     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ieqn\_local < 3 * raw\_ndof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04708}04708     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04709}04709       global\_eqn = 2 * \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} + elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(ieqn\_local -\/ 2 * raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04710}04710     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04711}04711     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ieqn\_local == 3 * raw\_ndof)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04712}04712     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04713}04713       global\_eqn = 3 * \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04714}04714     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04715}04715     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04716}04716     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04717}04717       global\_eqn = 3 * \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} + 1;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04718}04718     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04719}04719     \textcolor{keywordflow}{return} global\_eqn;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04720}04720   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04721}04721 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04722}04722   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04723}04723 \textcolor{comment}{  /// Get the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04724}04724 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04725}\mbox{\hyperlink{classoomph_1_1HopfHandler_a61a4006161da6532a9acfec0f979aafa}{04725}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_a61a4006161da6532a9acfec0f979aafa}{HopfHandler::get\_residuals}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04726}04726                                   \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04727}04727   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04728}04728     \textcolor{comment}{// Should only call get residuals for the full system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04729}04729     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} == 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04730}04730     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04731}04731       \textcolor{comment}{// Need to get raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04732}04732       \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04733}04733 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04734}04734       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} jacobian(raw\_ndof), M(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04735}04735       \textcolor{comment}{// Get the basic residuals, jacobian and mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04736}04736       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(residuals, jacobian, M);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04737}04737 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04738}04738       \textcolor{comment}{// Initialise the pen-\/ultimate residual}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04739}04739       residuals[3 * raw\_ndof] =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04740}04740         -\/1.0 / (double)(\mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Mesh_af01dfefb66c15579b540be62999d93ee}{nelement}}());}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04741}04741       residuals[3 * raw\_ndof + 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04742}04742 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04743}04743       \textcolor{comment}{// Now multiply to fill in the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04744}04744       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04745}04745       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04746}04746         residuals[raw\_ndof + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04747}04747         residuals[2 * raw\_ndof + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04748}04748         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < raw\_ndof; j++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04749}04749         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04750}04750           \textcolor{keywordtype}{unsigned} global\_unknown = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04751}04751           \textcolor{comment}{// Real part}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04752}04752           residuals[raw\_ndof + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += jacobian(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[global\_unknown] +}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04753}04753                                      \mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}} * M(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[global\_unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04754}04754           \textcolor{comment}{// Imaginary part}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04755}04755           residuals[2 * raw\_ndof + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += jacobian(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[global\_unknown] -\/}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04756}04756                                          \mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}} * M(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[global\_unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04757}04757         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04758}04758         \textcolor{comment}{// Get the global equation number}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04759}04759         \textcolor{keywordtype}{unsigned} global\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04760}04760 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04761}04761         \textcolor{comment}{// Real part}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04762}04762         residuals[3 * raw\_ndof] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04763}04763           (\mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[global\_eqn] * \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[global\_eqn]) / \mbox{\hyperlink{classoomph_1_1HopfHandler_a1b429a8220b316a487998cae04f46ec7}{Count}}[global\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04764}04764         \textcolor{comment}{// Imaginary part}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04765}04765         residuals[3 * raw\_ndof + 1] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04766}04766           (\mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[global\_eqn] * \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[global\_eqn]) / \mbox{\hyperlink{classoomph_1_1HopfHandler_a1b429a8220b316a487998cae04f46ec7}{Count}}[global\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04767}04767       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04768}04768     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04769}04769     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04770}04770     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04771}04771       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Solve\_which\_system can only be 0"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04772}04772                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04773}04773                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04774}04774     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04775}04775   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04776}04776 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04777}04777 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04778}04778   \textcolor{comment}{//===============================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04779}04779 \textcolor{comment}{  /// Calculate the elemental Jacobian matrix "{}d equation}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04780}04780 \textcolor{comment}{  /// / d variable"{}.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04781}04781 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04782}\mbox{\hyperlink{classoomph_1_1HopfHandler_ab36c50421f53accced01dd9e04d904ef}{04782}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_ab36c50421f53accced01dd9e04d904ef}{HopfHandler::get\_jacobian}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04783}04783                                  \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04784}04784                                  \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& jacobian)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04785}04785   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04786}04786     \textcolor{comment}{// The standard case}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04787}04787     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} == 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04788}04788     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04789}04789       \textcolor{keywordtype}{unsigned} augmented\_ndof = \mbox{\hyperlink{classoomph_1_1HopfHandler_a8d1b73ec4e9b8b27252b4bacf2ef7f38}{ndof}}(elem\_pt);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04790}04790       \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04791}04791 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04792}04792       \textcolor{comment}{// Get the basic residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04793}04793       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} M(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04794}04794       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(residuals, jacobian, M);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04795}04795       \textcolor{comment}{// Now fill in the actual residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04796}04796       \mbox{\hyperlink{classoomph_1_1HopfHandler_a61a4006161da6532a9acfec0f979aafa}{get\_residuals}}(elem\_pt, residuals);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04797}04797 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04798}04798       \textcolor{comment}{// Now the jacobian appears in other entries}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04799}04799       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; ++n)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04800}04800       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04801}04801         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < raw\_ndof; ++m)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04802}04802         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04803}04803           jacobian(raw\_ndof + n, raw\_ndof + m) = jacobian(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04804}04804           jacobian(raw\_ndof + n, 2 * raw\_ndof + m) = \mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}} * M(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04805}04805           jacobian(2 * raw\_ndof + n, 2 * raw\_ndof + m) = jacobian(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04806}04806           jacobian(2 * raw\_ndof + n, raw\_ndof + m) = -\/\mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}} * M(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04807}04807           \textcolor{keywordtype}{unsigned} global\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04808}04808           jacobian(raw\_ndof + n, 3 * raw\_ndof + 1) += M(n, m) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[global\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04809}04809           jacobian(2 * raw\_ndof + n, 3 * raw\_ndof + 1) -\/=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04810}04810             M(n, m) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[global\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04811}04811         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04812}04812 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04813}04813         \textcolor{keywordtype}{unsigned} local\_eqn = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04814}04814         jacobian(3 * raw\_ndof, raw\_ndof + n) = \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[local\_eqn] / \mbox{\hyperlink{classoomph_1_1HopfHandler_a1b429a8220b316a487998cae04f46ec7}{Count}}[local\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04815}04815         jacobian(3 * raw\_ndof + 1, 2 * raw\_ndof + n) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04816}04816           \mbox{\hyperlink{classoomph_1_1HopfHandler_a99aabcf5ac54311f1f7acb0dbd431b84}{C}}[local\_eqn] / \mbox{\hyperlink{classoomph_1_1HopfHandler_a1b429a8220b316a487998cae04f46ec7}{Count}}[local\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04817}04817       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04818}04818 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04819}04819       \textcolor{keyword}{const} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}} = 1.0e-\/8;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04820}04820 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04821}04821       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} newres\_p(augmented\_ndof), newres\_m(augmented\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04822}04822 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04823}04823       \textcolor{comment}{// Loop over the dofs}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04824}04824       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04825}04825       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04826}04826         \textcolor{comment}{// Just do the x's}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04827}04827         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} global\_eqn = \mbox{\hyperlink{classoomph_1_1HopfHandler_a9feb8087e8b9554164c0de002f4ec056}{eqn\_number}}(elem\_pt, n);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04828}04828         \textcolor{keywordtype}{double}* unknown\_pt = \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[global\_eqn];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04829}04829         \textcolor{keywordtype}{double} init = *unknown\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04830}04830         *unknown\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04831}04831 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04832}04832         \textcolor{comment}{// Get the new residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04833}04833         \mbox{\hyperlink{classoomph_1_1HopfHandler_a61a4006161da6532a9acfec0f979aafa}{get\_residuals}}(elem\_pt, newres\_p);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04834}04834 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04835}04835         \textcolor{comment}{// Reset}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04836}04836         *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04837}04837 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04838}04838         \textcolor{comment}{// Subtract}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04839}04839         *unknown\_pt -\/= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04840}04840         \mbox{\hyperlink{classoomph_1_1HopfHandler_a61a4006161da6532a9acfec0f979aafa}{get\_residuals}}(elem\_pt, newres\_m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04841}04841 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04842}04842         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < raw\_ndof; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04843}04843         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04844}04844           jacobian(raw\_ndof + m, n) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04845}04845             (newres\_p[raw\_ndof + m] -\/ residuals[raw\_ndof + m]) / (\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04846}04846           jacobian(2 * raw\_ndof + m, n) =}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04847}04847             (newres\_p[2 * raw\_ndof + m] -\/ residuals[2 * raw\_ndof + m]) /}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04848}04848             (\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04849}04849         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04850}04850         \textcolor{comment}{// Reset the unknown}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04851}04851         *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04852}04852       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04853}04853 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04854}04854       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04855}04855         \textcolor{comment}{// Now do the global parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04856}04856         \textcolor{keywordtype}{double}* unknown\_pt = \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}[3 * \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04857}04857         \textcolor{keywordtype}{double} init = *unknown\_pt;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04858}04858         *unknown\_pt += \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04859}04859 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04860}04860         \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04861}04861         \textcolor{comment}{// Get the new residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04862}04862         \mbox{\hyperlink{classoomph_1_1HopfHandler_a61a4006161da6532a9acfec0f979aafa}{get\_residuals}}(elem\_pt, newres\_p);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04863}04863 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04864}04864         \textcolor{comment}{// Reset}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04865}04865         *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04866}04866 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04867}04867         \textcolor{comment}{// Subtract}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04868}04868         *unknown\_pt -\/= \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04869}04869         \mbox{\hyperlink{classoomph_1_1HopfHandler_a61a4006161da6532a9acfec0f979aafa}{get\_residuals}}(elem\_pt, newres\_m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04870}04870 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04871}04871         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < augmented\_ndof -\/ 2; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04872}04872         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04873}04873           jacobian(m, 3 * raw\_ndof) = (newres\_p[m] -\/ residuals[m]) / \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a6f0d2ceb4451e66bb7ef4ab4fdb62bcf}{FD\_step}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04874}04874         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04875}04875         \textcolor{comment}{// Reset the unknown}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04876}04876         *unknown\_pt = init;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04877}04877         \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a5f08629e3c9c72b441ec7f19f175b2c7}{actions\_after\_change\_in\_bifurcation\_parameter}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04878}04878       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04879}04879     \} \textcolor{comment}{// End of standard case}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04880}04880     \textcolor{comment}{// Normal case}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04881}04881     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} == 1)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04882}04882     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04883}04883       \textcolor{comment}{// Just get the normal jacobian and residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04884}04884       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_ab915bdad7e6643e5e73a6d98bc7cf48e}{get\_jacobian}}(residuals, jacobian);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04885}04885     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04886}04886     \textcolor{comment}{// Otherwise the augmented complex case}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04887}04887     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} == 2)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04888}04888     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04889}04889       \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04890}04890 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04891}04891       \textcolor{comment}{// Get the basic residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04892}04892       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} M(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04893}04893       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_acd153d7425b92936314100a7b7354bdc}{get\_jacobian\_and\_mass\_matrix}}(residuals, jacobian, M);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04894}04894 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04895}04895       \textcolor{comment}{// We now need to fill in the other blocks}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04896}04896       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04897}04897       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04898}04898         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < raw\_ndof; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04899}04899         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04900}04900           jacobian(n, raw\_ndof + m) = \mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}} * M(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04901}04901           jacobian(raw\_ndof + n, m) = -\/\mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}} * M(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04902}04902           jacobian(raw\_ndof + n, raw\_ndof + m) = jacobian(n, m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04903}04903         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04904}04904       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04905}04905 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04906}04906       \textcolor{comment}{// Now overwrite to fill in the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04907}04907       \textcolor{comment}{// The decision take is to solve for the mass matrix multiplied}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04908}04908       \textcolor{comment}{// terms in the residuals because they require no additional}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04909}04909       \textcolor{comment}{// information to assemble.}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04910}04910       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < raw\_ndof; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04911}04911       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04912}04912         residuals[n] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04913}04913         residuals[raw\_ndof + n] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04914}04914         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < raw\_ndof; m++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04915}04915         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04916}04916           \textcolor{keywordtype}{unsigned} global\_unknown = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(m);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04917}04917           \textcolor{comment}{// Real part}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04918}04918           residuals[n] += M(n, m) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[global\_unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04919}04919           \textcolor{comment}{// Imaginary part}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04920}04920           residuals[raw\_ndof + n] -\/= M(n, m) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[global\_unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04921}04921         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04922}04922       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04923}04923     \} \textcolor{comment}{// End of complex augmented case}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04924}04924     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04925}04925     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04926}04926       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Solve\_which\_system can only be 0,1 or 2"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04927}04927                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04928}04928                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04929}04929     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04930}04930   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04931}04931 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04932}04932 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04933}04933   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04934}04934 \textcolor{comment}{  /// Get the derivatives of the augmented residuals with respect to}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04935}04935 \textcolor{comment}{  /// a parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04936}04936 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04937}\mbox{\hyperlink{classoomph_1_1HopfHandler_a2953368ecc48dc22f8ea1f563064ece2}{04937}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_a2953368ecc48dc22f8ea1f563064ece2}{HopfHandler::get\_dresiduals\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04938}04938     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04939}04939     \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04940}04940     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dres\_dparam)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04941}04941   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04942}04942     \textcolor{comment}{// Should only call get residuals for the full system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04943}04943     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} == 0)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04944}04944     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04945}04945       \textcolor{comment}{// Need to get raw residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04946}04946       \textcolor{keywordtype}{unsigned} raw\_ndof = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37204f67b37d212fd170c68d48f6da57}{ndof}}();}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04947}04947 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04948}04948       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} djac\_dparam(raw\_ndof), dM\_dparam(raw\_ndof);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04949}04949       \textcolor{comment}{// Get the basic residuals, jacobian and mass matrix}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04950}04950       elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_aa4146a407d84ad907b4c41cf555c7f28}{get\_djacobian\_and\_dmass\_matrix\_dparameter}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04951}04951         parameter\_pt, dres\_dparam, djac\_dparam, dM\_dparam);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04952}04952 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04953}04953       \textcolor{comment}{// Initialise the pen-\/ultimate residual, which does not}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04954}04954       \textcolor{comment}{// depend on the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04955}04955       dres\_dparam[3 * raw\_ndof] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04956}04956       dres\_dparam[3 * raw\_ndof + 1] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04957}04957 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04958}04958       \textcolor{comment}{// Now multiply to fill in the residuals}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04959}04959       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < raw\_ndof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04960}04960       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04961}04961         dres\_dparam[raw\_ndof + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04962}04962         dres\_dparam[2 * raw\_ndof + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = 0.0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04963}04963         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < raw\_ndof; j++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04964}04964         \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04965}04965           \textcolor{keywordtype}{unsigned} global\_unknown = elem\_pt-\/>\mbox{\hyperlink{classoomph_1_1GeneralisedElement_a37ac5a1d5234fa931ab710c0c74d55d2}{eqn\_number}}(j);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04966}04966           \textcolor{comment}{// Real part}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04967}04967           dres\_dparam[raw\_ndof + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04968}04968             djac\_dparam(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[global\_unknown] +}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04969}04969             \mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}} * dM\_dparam(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[global\_unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04970}04970           \textcolor{comment}{// Imaginary part}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04971}04971           dres\_dparam[2 * raw\_ndof + \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04972}04972             djac\_dparam(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[global\_unknown] -\/}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04973}04973             \mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}} * dM\_dparam(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) * \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[global\_unknown];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04974}04974         \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04975}04975       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04976}04976     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04977}04977     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04978}04978     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04979}04979       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}Solve\_which\_system can only be 0"{}},}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04980}04980                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04981}04981                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04982}04982     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04983}04983   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04984}04984 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04985}04985 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04986}04986   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04987}04987 \textcolor{comment}{  /// Overload the derivative of the residuals and jacobian}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04988}04988 \textcolor{comment}{  /// with respect to a parameter so that it breaks because it should not}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04989}04989 \textcolor{comment}{  /// be required}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04990}04990 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04991}\mbox{\hyperlink{classoomph_1_1HopfHandler_a59fb2c41d850cfe1fdccc3e97ca75135}{04991}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_a59fb2c41d850cfe1fdccc3e97ca75135}{HopfHandler::get\_djacobian\_dparameter}}(\mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04992}04992                                              \textcolor{keywordtype}{double}* \textcolor{keyword}{const}\& parameter\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04993}04993                                              \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& dres\_dparam,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04994}04994                                              \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& djac\_dparam)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04995}04995   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04996}04996     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04997}04997     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04998}04998       << \textcolor{stringliteral}{"{}This function has not been implemented because it is not required\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l04999}04999     error\_stream << \textcolor{stringliteral}{"{}in standard problems.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05000}05000     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05001}05001       << \textcolor{stringliteral}{"{}If you find that you need it, you will have to implement it!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05002}05002 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05003}05003     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05004}05004       error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05005}05005   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05006}05006 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05007}05007 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05008}05008   \textcolor{comment}{//=====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05009}05009 \textcolor{comment}{  /// Overload the hessian vector product function so that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05010}05010 \textcolor{comment}{  /// it breaks because it should not be required}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05011}05011 \textcolor{comment}{}  \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05012}\mbox{\hyperlink{classoomph_1_1HopfHandler_a74b0266ee15bcb294dbb946156095f8c}{05012}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_a74b0266ee15bcb294dbb946156095f8c}{HopfHandler::get\_hessian\_vector\_products}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05013}05013     \mbox{\hyperlink{classoomph_1_1GeneralisedElement}{GeneralisedElement}}* \textcolor{keyword}{const}\& elem\_pt,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05014}05014     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \textcolor{keyword}{const}\& Y,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05015}05015     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} \textcolor{keyword}{const}\& C,}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05016}05016     \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& product)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05017}05017   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05018}05018     std::ostringstream error\_stream;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05019}05019     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05020}05020       << \textcolor{stringliteral}{"{}This function has not been implemented because it is not required\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05021}05021     error\_stream << \textcolor{stringliteral}{"{}in standard problems.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05022}05022     error\_stream}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05023}05023       << \textcolor{stringliteral}{"{}If you find that you need it, you will have to implement it!\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05024}05024 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05025}05025     \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05026}05026       error\_stream.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05027}05027   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05028}05028 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05029}05029 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05030}05030   \textcolor{comment}{//==========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05031}05031 \textcolor{comment}{  /// Return the eigenfunction(s) associated with the bifurcation that}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05032}05032 \textcolor{comment}{  /// has been detected in bifurcation tracking problems}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05033}05033 \textcolor{comment}{}  \textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05034}\mbox{\hyperlink{classoomph_1_1HopfHandler_a9d1ee586e6274cfa0baa15f82b9fa0ae}{05034}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_a9d1ee586e6274cfa0baa15f82b9fa0ae}{HopfHandler::get\_eigenfunction}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& eigenfunction)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05035}05035   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05036}05036     \textcolor{comment}{// There is a real and imaginary part of the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05037}05037     eigenfunction.resize(2);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05038}05038     \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(\mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05039}05039     \textcolor{comment}{// Rebuild the vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05040}05040     eigenfunction[0].build(\&dist, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05041}05041     eigenfunction[1].build(\&dist, 0.0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05042}05042     \textcolor{comment}{// Set the value to be the null vector}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05043}05043     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05044}05044     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05045}05045       eigenfunction[0][n] = \mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05046}05046       eigenfunction[1][n] = \mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[n];}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05047}05047     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05048}05048   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05049}05049 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05050}05050 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05051}05051   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05052}05052 \textcolor{comment}{  /// Set to solve the standard (underlying jacobian)  system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05053}05053 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05054}\mbox{\hyperlink{classoomph_1_1HopfHandler_acd2149152659deef1d938739222dbcf2}{05054}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_acd2149152659deef1d938739222dbcf2}{HopfHandler::solve\_standard\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05055}05055   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05056}05056     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} != 1)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05057}05057     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05058}05058       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} = 1;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05059}05059       \textcolor{comment}{// Restrict the problem to the standard variables only}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05060}05060       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05061}05061       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05062}05062         \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05063}05063       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05064}05064       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05065}05065     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05066}05066   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05067}05067 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05068}05068   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05069}05069 \textcolor{comment}{  /// Set to solve the complex (jacobian and mass matrix)  system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05070}05070 \textcolor{comment}{}  \textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05071}\mbox{\hyperlink{classoomph_1_1HopfHandler_ac7feecfa644ae33b4a4a9fa8d1d993af}{05071}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_ac7feecfa644ae33b4a4a9fa8d1d993af}{HopfHandler::solve\_complex\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05072}05072   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05073}05073     \textcolor{comment}{// If we were not solving the complex system resize the unknowns}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05074}05074     \textcolor{comment}{// accordingly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05075}05075     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} != 2)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05076}05076     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05077}05077       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} = 2;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05078}05078       \textcolor{comment}{// Resize to the first Ndofs (will work whichever system we were}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05079}05079       \textcolor{comment}{// solving before)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05080}05080       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05081}05081       \textcolor{comment}{// Add the first (real) part of the eigenfunction back into the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05082}05082       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05083}05083       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05084}05084         \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05085}05085       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05086}05086       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05087}05087         \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} * 2, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05088}05088       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05089}05089       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05090}05090     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05091}05091   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05092}05092 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05093}05093 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05094}05094   \textcolor{comment}{//=================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05095}05095 \textcolor{comment}{  /// Set to Solve full system system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05096}05096 \textcolor{comment}{}  \textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05097}\mbox{\hyperlink{classoomph_1_1HopfHandler_a507681043126f6bea58cc90deed16d1d}{05097}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HopfHandler_a507681043126f6bea58cc90deed16d1d}{HopfHandler::solve\_full\_system}}()}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05098}05098   \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05099}05099     \textcolor{comment}{// If we are starting from another system}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05100}05100     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}})}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05101}05101     \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05102}05102       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa3d4d806a328a460edaae915670edad3}{Solve\_which\_system}} = 0;}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05103}05103 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05104}05104       \textcolor{comment}{// Resize to the first Ndofs (will work whichever system we were}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05105}05105       \textcolor{comment}{// solving before)}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05106}05106       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.resize(\mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05107}05107       \textcolor{comment}{// Add the additional unknowns back into the problem}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05108}05108       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05109}05109       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05110}05110         \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a117a5e192857e2f51c9c5d392fd6e5e7}{Phi}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05111}05111       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05112}05112       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} n = 0; n < \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}}; n++)}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05113}05113       \{}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05114}05114         \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a9f4d4f9e8962f1cd666df8de85a37d2a}{Psi}}[n]);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05115}05115       \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05116}05116       \textcolor{comment}{// Now add the parameter}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05117}05117       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\mbox{\hyperlink{classoomph_1_1HopfHandler_aff98f00728cd365d552229fec352f4e6}{Parameter\_pt}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05118}05118       \textcolor{comment}{// Finally add the frequency}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05119}05119       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_aa9e4cfff7e1dc295036b0e58bc11ae75}{Dof\_pt}}.push\_back(\&\mbox{\hyperlink{classoomph_1_1HopfHandler_a1dc27019f4889918cd01207576eabaea}{Omega}});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05120}05120 }
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05121}05121       \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05122}05122       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_ade01b88db08dcec1706fe44eaa0090a3}{Dof\_distribution\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a3cab441019e738e4c6db6ee22dd71515}{build}}(}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05123}05123         \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), 3 * \mbox{\hyperlink{classoomph_1_1HopfHandler_ac35b7c357ab453b686e80d8efe761945}{Ndof}} + 2, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05124}05124       \textcolor{comment}{// Remove all previous sparse storage used during Jacobian assembly}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05125}05125       \mbox{\hyperlink{classoomph_1_1HopfHandler_aa4464f9abb45bad3222f748703c31155}{Problem\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1Problem_a547c85bfa6a2eb3effc4db1b46ebcdde}{Sparse\_assemble\_with\_arrays\_previous\_allocation}}.resize(0);}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05126}05126     \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05127}05127   \}}
\DoxyCodeLine{\Hypertarget{assembly__handler_8cc_source_l05128}05128 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
