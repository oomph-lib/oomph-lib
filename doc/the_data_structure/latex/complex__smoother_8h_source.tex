\hypertarget{complex__smoother_8h_source}{}\doxysection{complex\+\_\+smoother.\+h}
\label{complex__smoother_8h_source}\index{complex\_smoother.h@{complex\_smoother.h}}
\mbox{\hyperlink{complex__smoother_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2022 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00026}00026 \textcolor{comment}{// Include guards}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00027}00027 \textcolor{preprocessor}{\#ifndef OOMPH\_COMPLEX\_SMOOTHER\_HEADER}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00028}00028 \textcolor{preprocessor}{\#define OOMPH\_COMPLEX\_SMOOTHER\_HEADER}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00030}00030 \textcolor{comment}{// Config header generated by autoconfig}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00031}00031 \textcolor{preprocessor}{\#ifdef HAVE\_CONFIG\_H}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00032}00032 \textcolor{preprocessor}{\#include <oomph-\/lib-\/config.h>}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00033}00033 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00035}00035 \textcolor{comment}{// Namespace extension}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00036}00036 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00037}00037 \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00038}00038   \textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00039}00039 \textcolor{comment}{  /// Helmholtz smoother class:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00040}00040 \textcolor{comment}{  /// The smoother class is designed for the Helmholtz equation to be used}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00041}00041 \textcolor{comment}{  /// in conjunction with multigrid. The action of the smoother should}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00042}00042 \textcolor{comment}{  /// reduce the high frequency errors. These methods are inefficient as}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00043}00043 \textcolor{comment}{  /// stand-\/alone solvers}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00044}00044 \textcolor{comment}{}  \textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00045}\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother}{00045}}   \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother}{HelmholtzSmoother}} : \textcolor{keyword}{public} \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver}{IterativeLinearSolver}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00046}00046   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00047}00047   \textcolor{keyword}{public}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00048}00048 \textcolor{comment}{    /// Empty constructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00049}\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a7d220faf3d4834550ed0bc42f077c303}{00049}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a7d220faf3d4834550ed0bc42f077c303}{HelmholtzSmoother}}() : \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a2b4b16dcb611cb27371afa1636e125cf}{Use\_as\_smoother}}(false) \{\}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00050}00050 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00051}00051 \textcolor{comment}{    /// Virtual empty destructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00052}\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_ac83116186f1a5beffab8faa299b8d4f1}{00052}} \textcolor{comment}{}    \textcolor{keyword}{virtual} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_ac83116186f1a5beffab8faa299b8d4f1}{\string~HelmholtzSmoother}}()\{\};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00053}00053 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00054}00054 \textcolor{comment}{    /// The smoother\_solve function performs fixed number of iterations}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00055}00055 \textcolor{comment}{    /// on the system A*result=rhs. The number of (smoothing) iterations is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00056}00056 \textcolor{comment}{    /// the same as the max. number of iterations in the underlying}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00057}00057 \textcolor{comment}{    /// IterativeLinearSolver class.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00058}\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a8ec748270df3e1199f19ef267d5b8e85}{00058}} \textcolor{comment}{}    \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a8ec748270df3e1199f19ef267d5b8e85}{complex\_smoother\_solve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00059}00059                                         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& result) = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00061}00061 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00062}00062 \textcolor{comment}{    /// Setup the smoother for the matrix specified by the pointer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00063}\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a7c46336fdc3b386b0bab6111a3c55d44}{00063}} \textcolor{comment}{}    \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a7c46336fdc3b386b0bab6111a3c55d44}{complex\_smoother\_setup}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<CRDoubleMatrix*>}} matrix\_pt) = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00064}00064 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00065}00065 \textcolor{comment}{    /// Helper function to calculate a complex matrix-\/vector product.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00066}00066 \textcolor{comment}{    /// Assumes the matrix has been provided as a Vector of length two; the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00067}00067 \textcolor{comment}{    /// first entry containing the real part of the system matrix and the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00068}00068 \textcolor{comment}{    /// second entry containing the imaginary part}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00069}\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_aeabcedb15b9f86681bcbcfbbbcc6b45c}{00069}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_aeabcedb15b9f86681bcbcfbbbcc6b45c}{complex\_matrix\_multiplication}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<CRDoubleMatrix*>}} matrices\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00070}00070                                        \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& x,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00071}00071                                        \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& soln)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00072}00072     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00073}00073 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00074}00074       \textcolor{comment}{// PARANOID check -\/ Make sure the input matrix has the right size}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00075}00075       \textcolor{keywordflow}{if} (matrices\_pt.size() != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00076}00076       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00077}00077         \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00078}00078         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00079}00079 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00080}00080         \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00081}00081         error\_message\_stream << \textcolor{stringliteral}{"{}Can only deal with two matrices. You have "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00082}00082                              << matrices\_pt.size() << \textcolor{stringliteral}{"{} matrices."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00084}00084         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00085}00085         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00086}00086                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00087}00087                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00088}00088       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00089}00089       \textcolor{comment}{// PARANOID check -\/ Make sure the vector x has the right size}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00090}00090       \textcolor{keywordflow}{if} (x.size() != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00091}00091       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00092}00092         \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00093}00093         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00095}00095         \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00096}00096         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00097}00097           << \textcolor{stringliteral}{"{}Can only deal with two input vectors. You have "{}} << x.size()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00098}00098           << \textcolor{stringliteral}{"{} vectors."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00100}00100         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00101}00101         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00102}00102                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00103}00103                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00104}00104       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00105}00105       \textcolor{comment}{// PARANOID check -\/ Make sure the vector soln has the right size}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00106}00106       \textcolor{keywordflow}{if} (soln.size() != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00107}00107       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00108}00108         \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00109}00109         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00110}00110 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00111}00111         \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00112}00112         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00113}00113           << \textcolor{stringliteral}{"{}Can only deal with two output vectors. You have "{}} << soln.size()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00114}00114           << \textcolor{stringliteral}{"{} output vectors."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00115}00115 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00116}00116         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00117}00117         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00118}00118                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00119}00119                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00120}00120       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00121}00121 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00122}00122 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00123}00123       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00124}00124       \textcolor{comment}{// Suppose we have a complex matrix, A, and two complex vectors, x and}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00125}00125       \textcolor{comment}{// soln. We wish to compute the product A*x=soln (note, * does not mean}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00126}00126       \textcolor{comment}{// we are using complex conjugates here, it is simply used to indicate}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00127}00127       \textcolor{comment}{// a multiplication). To do this we must make use of the fact that we}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00128}00128       \textcolor{comment}{// possess the real and imaginary separately. As a result, it is computed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00129}00129       \textcolor{comment}{// using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00130}00130       \textcolor{comment}{//           soln = A*x,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00131}00131       \textcolor{comment}{//                = (A\_r + i*A\_c)*(x\_r + i*x\_c),}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00132}00132       \textcolor{comment}{//                = [A\_r*x\_r -\/ A\_c*x\_c] + i*[A\_r*x\_c + A\_c*x\_r],}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00133}00133       \textcolor{comment}{// ==> real(soln) = A\_r*x\_r -\/ A\_c*x\_c,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00134}00134       \textcolor{comment}{//   \& imag(soln) = A\_r*x\_c + A\_c*x\_r,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00135}00135       \textcolor{comment}{// where the subscripts \_r and \_c are used to identify the real and}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00136}00136       \textcolor{comment}{// imaginary part, respectively.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00137}00137       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00138}00138 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00139}00139       \textcolor{comment}{// Store the value of A\_r*x\_r in the real part of soln}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00140}00140       matrices\_pt[0]-\/>multiply(x[0], soln[0]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00141}00141 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00142}00142       \textcolor{comment}{// Store the value of A\_r*x\_c in the imaginary part of soln}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00143}00143       matrices\_pt[0]-\/>multiply(x[1], soln[1]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00144}00144 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00145}00145       \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00146}00146       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(this-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00147}00147 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00148}00148       \textcolor{comment}{// Calculate the value of A\_c*x\_c}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00149}00149       matrices\_pt[1]-\/>multiply(x[1], temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00151}00151       \textcolor{comment}{// Subtract the value of temp from soln[0] to get the real part of soln}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00152}00152       soln[0] -\/= temp;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00153}00153 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00154}00154       \textcolor{comment}{// Calculate the value of A\_c*x\_r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00155}00155       matrices\_pt[1]-\/>multiply(x[0], temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00156}00156 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00157}00157       \textcolor{comment}{// Add the value of temp to soln[1] to get the imaginary part of soln}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00158}00158       soln[1] += temp;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00159}00159     \} \textcolor{comment}{// End of complex\_matrix\_multiplication}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00160}00160 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00161}00161 \textcolor{comment}{    /// Self-\/test to check that all the dimensions of the inputs to}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00162}00162 \textcolor{comment}{    /// solve helper are consistent and everything that needs to be built, is.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00163}00163 \textcolor{comment}{}    \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00164}00164     \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a10dbef9689095e84e92f6864938850f7}{check\_validity\_of\_solve\_helper\_inputs}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00165}00165       \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* \textcolor{keyword}{const}\& real\_matrix\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00166}00166       \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* \textcolor{keyword}{const}\& imag\_matrix\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00167}00167       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00168}00168       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& solution,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00169}00169       \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& n\_dof);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00171}00171   \textcolor{keyword}{protected}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00172}00172 \textcolor{comment}{    /// When a derived class object is being used as a smoother in}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00173}00173 \textcolor{comment}{    /// the MG algorithm the residual norm}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00174}00174 \textcolor{comment}{    /// does not need to be calculated. This boolean is used as a flag to}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00175}00175 \textcolor{comment}{    /// indicate this in solve\_helper(...)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00176}\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a2b4b16dcb611cb27371afa1636e125cf}{00176}} \textcolor{comment}{}    \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a2b4b16dcb611cb27371afa1636e125cf}{Use\_as\_smoother}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00177}00177   \};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00179}00179   \textcolor{comment}{//==================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00180}00180 \textcolor{comment}{  /// Self-\/test to be called inside solve\_helper to ensure}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00181}00181 \textcolor{comment}{  /// that all inputs are consistent and everything that needs to}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00182}00182 \textcolor{comment}{  /// be built, is.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00183}00183 \textcolor{comment}{}  \textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00184}00184   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00185}\mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a10dbef9689095e84e92f6864938850f7}{00185}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a10dbef9689095e84e92f6864938850f7}{HelmholtzSmoother::check\_validity\_of\_solve\_helper\_inputs}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00186}00186     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* \textcolor{keyword}{const}\& real\_matrix\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00187}00187     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* \textcolor{keyword}{const}\& imag\_matrix\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00188}00188     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00189}00189     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& solution,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00190}00190     \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& n\_dof)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00191}00191   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00192}00192     \textcolor{comment}{// Number of dof types should be 2 (real \& imaginary)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00193}00193     \textcolor{keywordtype}{unsigned} n\_dof\_types = 2;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00194}00194 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00195}00195     \textcolor{comment}{// Create a vector to hold the matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00196}00196     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<CRDoubleMatrix*>}} matrix\_storage\_pt(2, 0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00197}00197 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00198}00198     \textcolor{comment}{// Assign the first entry in matrix\_storage\_pt}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00199}00199     matrix\_storage\_pt[0] = real\_matrix\_pt;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00201}00201     \textcolor{comment}{// Assign the second entry in matrix\_storage\_pt}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00202}00202     matrix\_storage\_pt[1] = imag\_matrix\_pt;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00203}00203 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00204}00204     \textcolor{comment}{// Loop over the real and imaginary parts}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00205}00205     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00206}00206     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00207}00207       \textcolor{comment}{// Check if the matrix is distributable. If it is then it should}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00208}00208       \textcolor{comment}{// not be distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00209}00209       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00210}00210             matrix\_storage\_pt[dof\_type]) != 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00211}00211       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00212}00212         \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00213}00213               matrix\_storage\_pt[dof\_type])}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00214}00214               -\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00215}00215         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00216}00216           std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00217}00217           error\_message\_stream << \textcolor{stringliteral}{"{}The matrix must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00218}00218           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00219}00219                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00220}00220                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00221}00221         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00222}00222       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00223}00223       \textcolor{comment}{// Check that this rhs distribution is setup}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00224}00224       \textcolor{keywordflow}{if} (!(rhs[dof\_type].built()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00225}00225       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00226}00226         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00227}00227         error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector distribution must be setup."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00228}00228         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00229}00229                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00230}00230                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00231}00231       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00232}00232       \textcolor{comment}{// Check that the rhs has the right number of global rows}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00233}00233       \textcolor{keywordflow}{if} (rhs[dof\_type].\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != n\_dof)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00234}00234       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00235}00235         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00236}00236         error\_message\_stream << \textcolor{stringliteral}{"{}RHS does not have the same dimension as the "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00237}00237                              << \textcolor{stringliteral}{"{}linear system"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00238}00238         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00239}00239                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00240}00240                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00241}00241       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00242}00242       \textcolor{comment}{// Check that the rhs is not distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00243}00243       \textcolor{keywordflow}{if} (rhs[dof\_type].\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a5505731e7e73d7e4251c67c7adec6bf5}{distributed}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00244}00244       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00245}00245         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00246}00246         error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00247}00247         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00248}00248                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00249}00249                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00250}00250       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00251}00251       \textcolor{comment}{// Check that if the result is setup it matches the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00252}00252       \textcolor{comment}{// of the rhs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00253}00253       \textcolor{keywordflow}{if} (solution[dof\_type].built())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00254}00254       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00255}00255         \textcolor{keywordflow}{if} (!(*rhs[dof\_type].\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() ==}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00256}00256               *solution[dof\_type].\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00257}00257         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00258}00258           std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00259}00259           error\_message\_stream << \textcolor{stringliteral}{"{}If the result distribution is setup then it "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00260}00260                                << \textcolor{stringliteral}{"{}must be the same as the rhs distribution"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00261}00261           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00262}00262                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00263}00263                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00264}00264         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00265}00265       \} \textcolor{comment}{// if ((solution[0].built())||(solution[1].built()))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00266}00266     \} \textcolor{comment}{// for (unsigned dof\_type=0;dof\_type<n\_dof\_types;dof\_type)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00267}00267   \} \textcolor{comment}{// End of check\_validity\_of\_solve\_helper\_inputs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00268}00268 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00269}00269 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00270}00270 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00271}00271 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00272}00272 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00273}00273 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00274}00274 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00275}00275   \textcolor{comment}{//=========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00276}00276 \textcolor{comment}{  /// Damped Jacobi "{}solver"{} templated by matrix type. The "{}solver"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00277}00277 \textcolor{comment}{  /// exists in many different incarnations: It's an IterativeLinearSolver,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00278}00278 \textcolor{comment}{  /// and a Smoother, all of which use the same basic iteration.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00279}00279 \textcolor{comment}{}  \textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00280}00280   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00281}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi}{00281}}   \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi}{ComplexDampedJacobi}} : \textcolor{keyword}{public} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother}{HelmholtzSmoother}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00282}00282   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00283}00283   \textcolor{keyword}{public}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00284}00284 \textcolor{comment}{    /// Constructor (empty)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00285}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5c76dd5e5fac0246eced85a66df6c7ee}{00285}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5c76dd5e5fac0246eced85a66df6c7ee}{ComplexDampedJacobi}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a7db5ab84129d155d289dbf592aa41b5e}{omega}} = 0.5)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00286}00286       : \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a36cb47a2cec4a979de7aa93ccc3dfc7f}{Matrix\_can\_be\_deleted}}(true),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00287}00287         \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{Matrix\_real\_pt}}(0),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00288}00288         \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{Matrix\_imag\_pt}}(0),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00289}00289         \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a735337bf7a2a9d3f2265d8c5eaf74850}{Omega}}(\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a7db5ab84129d155d289dbf592aa41b5e}{omega}})\{\};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00290}00290 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00291}00291 \textcolor{comment}{    /// Empty destructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00292}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a102defdc208413f82a6cd377bf5e0517}{00292}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a102defdc208413f82a6cd377bf5e0517}{\string~ComplexDampedJacobi}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00293}00293     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00294}00294       \textcolor{comment}{// Run clean\_up\_memory}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00295}00295       \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a4e246d712c8eb9e4db05f859148784d3}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00296}00296     \} \textcolor{comment}{// End of \string~ComplexDampedJacobi}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00297}00297 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00298}00298 \textcolor{comment}{    /// Cleanup data that's stored for resolve (if any has been stored)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00299}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a4e246d712c8eb9e4db05f859148784d3}{00299}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a4e246d712c8eb9e4db05f859148784d3}{clean\_up\_memory}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00300}00300     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00301}00301       \textcolor{comment}{// If the real matrix pointer isn't null AND we're allowed to delete}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00302}00302       \textcolor{comment}{// the matrix which is only when we create the matrix ourselves}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00303}00303       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{Matrix\_real\_pt}} != 0) \&\& (\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a36cb47a2cec4a979de7aa93ccc3dfc7f}{Matrix\_can\_be\_deleted}}))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00304}00304       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00305}00305         \textcolor{comment}{// Delete the matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00306}00306         \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{Matrix\_real\_pt}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00307}00307 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00308}00308         \textcolor{comment}{// Assign the associated pointer the value NULL}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00309}00309         \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{Matrix\_real\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00310}00310       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00311}00311 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00312}00312       \textcolor{comment}{// If the real matrix pointer isn't null AND we're allowed to delete}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00313}00313       \textcolor{comment}{// the matrix which is only when we create the matrix ourselves}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00314}00314       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{Matrix\_imag\_pt}} != 0) \&\& (\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a36cb47a2cec4a979de7aa93ccc3dfc7f}{Matrix\_can\_be\_deleted}}))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00315}00315       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00316}00316         \textcolor{comment}{// Delete the matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00317}00317         \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{Matrix\_imag\_pt}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00318}00318 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00319}00319         \textcolor{comment}{// Assign the associated pointer the value NULL}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00320}00320         \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{Matrix\_imag\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00321}00321       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00322}00322     \} \textcolor{comment}{// End of clean\_up\_memory}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00323}00323 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00324}00324 \textcolor{comment}{    /// Broken copy constructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00325}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_ae9a1221ec8c0753340946b85a8b8ee01}{00325}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_ae9a1221ec8c0753340946b85a8b8ee01}{ComplexDampedJacobi}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi}{ComplexDampedJacobi}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00326}00326 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00327}00327 \textcolor{comment}{    /// Broken assignment operator}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00328}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a22a6a3188f2891fecf464a815dfa4e2e}{00328}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a22a6a3188f2891fecf464a815dfa4e2e}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi}{ComplexDampedJacobi}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00329}00329 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00330}00330 \textcolor{comment}{    /// Function to calculate the value of Omega by passing in the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00331}00331 \textcolor{comment}{    /// value of k and h [see Elman et al. "{}A multigrid method enhanced by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00332}00332 \textcolor{comment}{    /// Krylov subspace iteration for discrete Helmholtz equations"{}, p.1303]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00333}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_af7a53121690e157bdd5bc191a31f9892}{00333}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_af7a53121690e157bdd5bc191a31f9892}{calculate\_omega}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& k, \textcolor{keyword}{const} \textcolor{keywordtype}{double}\& h)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00334}00334     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00335}00335       \textcolor{comment}{// Create storage for the parameter kh}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00336}00336       \textcolor{keywordtype}{double} kh = k * h;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00337}00337 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00338}00338       \textcolor{comment}{// Store the value of pi}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00339}00339       \textcolor{keywordtype}{double} pi = \mbox{\hyperlink{namespaceoomph_1_1MathematicalConstants_a61ae4ddbc59fbd0797ebb671e48c8d6d}{MathematicalConstants::Pi}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00340}00340 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00341}00341       \textcolor{comment}{// Calculate the value of Omega}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00342}00342       \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a7db5ab84129d155d289dbf592aa41b5e}{omega}} = (12.0 -\/ 4.0 * pow(kh, 2.0)) / (18.0 -\/ 3.0 * pow(kh, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00343}00343 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00344}00344       \textcolor{comment}{// Set the tolerance for how close omega can be to 0}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00345}00345       \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a7be3c4ea16f1fc9b397e7c87eae253d8}{tolerance}} = 1.0e-\/03;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00346}00346 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00347}00347       \textcolor{comment}{// Only store the value of omega if it lies in the range (0,1]. If it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00348}00348       \textcolor{comment}{// isn't it will produce a divergent scheme. Note, to avoid letting}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00349}00349       \textcolor{comment}{// omega become too small we make sure it is greater than some tolerance}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00350}00350       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a7db5ab84129d155d289dbf592aa41b5e}{omega}} > \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a7be3c4ea16f1fc9b397e7c87eae253d8}{tolerance}}) \&\& !(\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a7db5ab84129d155d289dbf592aa41b5e}{omega}} > 1))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00351}00351       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00352}00352         \textcolor{comment}{// Since omega lies in the specified range, store it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00353}00353         \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a735337bf7a2a9d3f2265d8c5eaf74850}{Omega}} = \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a7db5ab84129d155d289dbf592aa41b5e}{omega}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00354}00354       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00355}00355       \textcolor{comment}{// On the coarsest grids: if the wavenumber is greater than pi and}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00356}00356       \textcolor{comment}{// kh>2cos(pi*h/2) then we can choose omega from the range (0,omega\_2)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00357}00357       \textcolor{comment}{// where omega\_2 is defined in [Elman et al."{}A multigrid method}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00358}00358       \textcolor{comment}{// enhanced by Krylov subspace iteration for discrete Helmholtz}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00359}00359       \textcolor{comment}{// equations"{}, p.1295]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00360}00360       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((k > pi) \&\& (kh > 2 * cos(pi * h / 2)))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00361}00361       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00362}00362         \textcolor{comment}{// Calculate the numerator of omega\_2}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00363}00363         \textcolor{keywordtype}{double} omega\_2 = (2.0 -\/ pow(kh, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00364}00364 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00365}00365         \textcolor{comment}{// Divide by the denominator of the fraction}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00366}00366         omega\_2 /= (2.0 * pow(sin(pi * h / 2), 2.0) -\/ 0.5 * pow(kh, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00368}00368         \textcolor{comment}{// If 2/3 lies in the range (0,omega\_2), use it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00369}00369         \textcolor{keywordflow}{if} (omega\_2 > (2.0 / 3.0))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00370}00370         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00371}00371           \textcolor{comment}{// Assign Omega the damping factor used for the Poisson equation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00372}00372           \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a735337bf7a2a9d3f2265d8c5eaf74850}{Omega}} = 2.0 / 3.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00373}00373         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00374}00374         \textcolor{comment}{// If omega\_2 is less than 2/3 use the midpoint of (tolerance,omega\_2)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00375}00375         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00376}00376         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00377}00377           \textcolor{comment}{// Set the value of Omega}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00378}00378           \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a735337bf7a2a9d3f2265d8c5eaf74850}{Omega}} = 0.5 * (\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a7be3c4ea16f1fc9b397e7c87eae253d8}{tolerance}} + omega\_2);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00379}00379         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00380}00380       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00381}00381       \textcolor{comment}{// Since the value of kh must be fairly large, make the value of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00382}00382       \textcolor{comment}{// omega small to compensate}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00383}00383       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00384}00384       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00385}00385         \textcolor{comment}{// Since kh doesn't lie in the chosen range, set it to some small value}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00386}00386         \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a735337bf7a2a9d3f2265d8c5eaf74850}{Omega}} = 0.2;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00387}00387       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00388}00388     \} \textcolor{comment}{// End of calculate\_omega}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00389}00389 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00390}00390 \textcolor{comment}{    /// Get access to the value of Omega (lvalue)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00391}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a7db5ab84129d155d289dbf592aa41b5e}{00391}} \textcolor{comment}{}    \textcolor{keywordtype}{double}\& \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a7db5ab84129d155d289dbf592aa41b5e}{omega}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00392}00392     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00393}00393       \textcolor{comment}{// Return the value of Omega}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00394}00394       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a735337bf7a2a9d3f2265d8c5eaf74850}{Omega}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00395}00395     \} \textcolor{comment}{// End of omega}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00396}00396 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00397}00397 \textcolor{comment}{    /// Setup: Pass pointer to the matrix and store in cast form}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00398}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a4cf2cdac05266021cd0660ba60ae6a8b}{00398}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a4cf2cdac05266021cd0660ba60ae6a8b}{complex\_smoother\_setup}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<CRDoubleMatrix*>}} helmholtz\_matrix\_pt)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00399}00399     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00400}00400       \textcolor{comment}{// Assume the matrices have been passed in from the outside so we must}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00401}00401       \textcolor{comment}{// not delete it. This is needed to avoid pre-\/ and post-\/smoothers}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00402}00402       \textcolor{comment}{// deleting the same matrix in the MG solver. If this was originally}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00403}00403       \textcolor{comment}{// set to TRUE then this will be sorted out in the other functions}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00404}00404       \textcolor{comment}{// from which this was called}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00405}00405       \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a36cb47a2cec4a979de7aa93ccc3dfc7f}{Matrix\_can\_be\_deleted}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00406}00406 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00407}00407       \textcolor{comment}{// Assign the real matrix pointers}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00408}00408       \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{Matrix\_real\_pt}} = helmholtz\_matrix\_pt[0];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00409}00409 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00410}00410       \textcolor{comment}{// Assign the imaginary matrix pointers}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00411}00411       \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{Matrix\_imag\_pt}} = helmholtz\_matrix\_pt[1];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00412}00412 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00413}00413 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00414}00414       \textcolor{comment}{// PARANOID check that if the matrix is distributable. If it is not then}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00415}00415       \textcolor{comment}{// it should not be distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00416}00416       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{Matrix\_real\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}() != \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{Matrix\_imag\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_abd8d231b0549540144b4739a667b1e75}{nrow}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00417}00417       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00418}00418         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00419}00419         error\_message\_stream << \textcolor{stringliteral}{"{}Incompatible real and complex matrix sizes."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00420}00420         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00421}00421                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00422}00422                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00423}00423       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00424}00424 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00425}00425 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00426}00426       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00427}00427       \textcolor{comment}{// We need the matrix diagonals to calculate inv(D) (where D is the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00428}00428       \textcolor{comment}{// diagonal of A) as it remains the same for each use of the iterative}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00429}00429       \textcolor{comment}{// scheme. To avoid unnecessary computations we store it now so it can}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00430}00430       \textcolor{comment}{// simply be called in each iteration.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00431}00431       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00432}00432 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00433}00433       \textcolor{comment}{// Grab the diagonal entries of the real part of the system matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00434}00434       \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5f8a5cd7da48fc81c9224c2c0a6d509e}{Matrix\_diagonal\_real}} = \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{Matrix\_real\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad438e693468cd0ae179460eafcaab038}{diagonal\_entries}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00435}00435 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00436}00436       \textcolor{comment}{// Grab the diagonal entries of the imaginary part of the system matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00437}00437       \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a68788038c7bd09732455662c5be2ab85}{Matrix\_diagonal\_imag}} = \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{Matrix\_imag\_pt}}-\/>\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix_ad438e693468cd0ae179460eafcaab038}{diagonal\_entries}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00438}00438 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00439}00439       \textcolor{comment}{// Find the number of entries in the vectors containing the diagonal}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00440}00440       \textcolor{comment}{// entries of both the real and the imaginary matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00441}00441       \textcolor{keywordtype}{unsigned} n\_dof = \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5f8a5cd7da48fc81c9224c2c0a6d509e}{Matrix\_diagonal\_real}}.size();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00442}00442 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00443}00443       \textcolor{comment}{// Make a dummy vector to store the entries of Matrix\_diagonal\_inv\_sq}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00444}00444       \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5626c629f590cee327c045a333ca315d}{Matrix\_diagonal\_inv\_sq}}.resize(n\_dof, 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00445}00445 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00446}00446       \textcolor{comment}{// Create a helper variable to store A\_r(j,j), for some j}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00447}00447       \textcolor{keywordtype}{double} dummy\_r;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00448}00448 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00449}00449       \textcolor{comment}{// Create a helper variable to store A\_c(j,j), for some j}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00450}00450       \textcolor{keywordtype}{double} dummy\_c;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00451}00451 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00452}00452       \textcolor{comment}{// Loop over the entries of Matrix\_diagonal\_inv\_sq and set the i-\/th}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00453}00453       \textcolor{comment}{// entry to 1/(A\_r(i,i)\string^2 + A\_c(i,i)\string^2)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00454}00454       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00455}00455       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00456}00456         \textcolor{comment}{// Store the value of A\_r(i,i)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00457}00457         dummy\_r = \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5f8a5cd7da48fc81c9224c2c0a6d509e}{Matrix\_diagonal\_real}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00458}00458 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00459}00459         \textcolor{comment}{// Store the value of A\_c(i,i)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00460}00460         dummy\_c = \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a68788038c7bd09732455662c5be2ab85}{Matrix\_diagonal\_imag}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00461}00461 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00462}00462         \textcolor{comment}{// Store the value of 1/(A\_r(i,i)\string^2 + A\_c(i,i)\string^2)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00463}00463         \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5626c629f590cee327c045a333ca315d}{Matrix\_diagonal\_inv\_sq}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] =}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00464}00464           1.0 / (dummy\_r * dummy\_r + dummy\_c * dummy\_c);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00465}00465       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00466}00466     \} \textcolor{comment}{// End of complex\_smoother\_setup}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00467}00467 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00468}00468 \textcolor{comment}{    /// The smoother\_solve function performs fixed number of iterations}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00469}00469 \textcolor{comment}{    /// on the system A*result=rhs. The number of (smoothing) iterations is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00470}00470 \textcolor{comment}{    /// the same as the max. number of iterations in the underlying}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00471}00471 \textcolor{comment}{    /// IterativeLinearSolver class.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00472}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a3e548db0f775e4239ff7b9c76a7b1c76}{00472}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a3e548db0f775e4239ff7b9c76a7b1c76}{complex\_smoother\_solve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00473}00473                                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& solution)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00474}00474     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00475}00475       \textcolor{comment}{// If you use a smoother but you don't want to calculate the residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00476}00476       \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a2b4b16dcb611cb27371afa1636e125cf}{Use\_as\_smoother}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00477}00477 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00478}00478       \textcolor{comment}{// Call the helper function}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00479}00479       \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a09214dc600fe5d261bdb3795aa943aac}{complex\_solve\_helper}}(rhs, solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00480}00480     \} \textcolor{comment}{// End of complex\_smoother\_solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00481}00481 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00482}00482 \textcolor{comment}{    /// Use damped Jacobi iteration as an IterativeLinearSolver:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00483}00483 \textcolor{comment}{    /// This obtains the Jacobian matrix J and the residual vector r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00484}00484 \textcolor{comment}{    /// (needed for the Newton method) from the problem's get\_jacobian}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00485}00485 \textcolor{comment}{    /// function and returns the result of Jx=r.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00486}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_ab9267bcbaf8435303190a1c12dbb7c2b}{00486}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_ab9267bcbaf8435303190a1c12dbb7c2b}{solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00487}00487     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00488}00488       \mbox{\hyperlink{namespaceoomph_1_1BrokenCopy_a32dc384e671e786bac0c67cbff701f45}{BrokenCopy::broken\_assign}}(\textcolor{stringliteral}{"{}ComplexDampedJacobi"{}});}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00489}00489     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00490}00490 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00491}00491 \textcolor{comment}{    /// Number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00492}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a34e565b3536b286b5544f5e30935b9e9}{00492}} \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a34e565b3536b286b5544f5e30935b9e9}{iterations}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00493}00493 \textcolor{keyword}{    }\{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00494}00494       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_af6c791c81e9600c9c4daa13ae3024dec}{Iterations}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00495}00495     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00496}00496 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00497}00497   \textcolor{keyword}{private}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00498}00498 \textcolor{comment}{    /// This is where the actual work is done}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00499}00499 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a09214dc600fe5d261bdb3795aa943aac}{complex\_solve\_helper}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00500}00500                               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00501}00501 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00502}00502 \textcolor{comment}{    /// Boolean flag to indicate if the matrices pointed to by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00503}00503 \textcolor{comment}{    /// Matrix\_real\_pt and Matrix\_imag\_pt can be deleted.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00504}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a36cb47a2cec4a979de7aa93ccc3dfc7f}{00504}} \textcolor{comment}{}    \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a36cb47a2cec4a979de7aa93ccc3dfc7f}{Matrix\_can\_be\_deleted}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00505}00505 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00506}00506 \textcolor{comment}{    /// Pointer to the real part of the system matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00507}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{00507}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_aad28f093e125e259fb34b0c33269ec04}{Matrix\_real\_pt}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00508}00508 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00509}00509 \textcolor{comment}{    /// Pointer to the real part of the system matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00510}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{00510}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a6f1e4350f4e9075d1bcb0fa518ffc0ea}{Matrix\_imag\_pt}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00511}00511 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00512}00512 \textcolor{comment}{    /// Vector containing the diagonal entries of A\_r (real(A))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00513}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5f8a5cd7da48fc81c9224c2c0a6d509e}{00513}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5f8a5cd7da48fc81c9224c2c0a6d509e}{Matrix\_diagonal\_real}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00514}00514 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00515}00515 \textcolor{comment}{    /// Vector containing the diagonal entries of A\_c (imag(A))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00516}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a68788038c7bd09732455662c5be2ab85}{00516}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a68788038c7bd09732455662c5be2ab85}{Matrix\_diagonal\_imag}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00517}00517 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00518}00518 \textcolor{comment}{    /// Vector whose j'th entry is given by 1/(A\_r(j,j)\string^2 + A\_c(j,j)\string^2)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00519}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5626c629f590cee327c045a333ca315d}{00519}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a5626c629f590cee327c045a333ca315d}{Matrix\_diagonal\_inv\_sq}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00520}00520 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00521}00521 \textcolor{comment}{    /// Number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00522}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_af6c791c81e9600c9c4daa13ae3024dec}{00522}} \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_af6c791c81e9600c9c4daa13ae3024dec}{Iterations}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00523}00523 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00524}00524 \textcolor{comment}{    /// Damping factor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00525}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a735337bf7a2a9d3f2265d8c5eaf74850}{00525}} \textcolor{comment}{}    \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a735337bf7a2a9d3f2265d8c5eaf74850}{Omega}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00526}00526   \};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00527}00527 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00528}00528   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00529}00529 \textcolor{comment}{  /// This is where the actual work is done.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00530}00530 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00531}00531   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00532}\mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a09214dc600fe5d261bdb3795aa943aac}{00532}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexDampedJacobi_a09214dc600fe5d261bdb3795aa943aac}{ComplexDampedJacobi<MATRIX>::complex\_solve\_helper}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00533}00533     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& solution)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00534}00534   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00535}00535     \textcolor{comment}{// Get number of dofs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00536}00536     \textcolor{keywordtype}{unsigned} n\_dof = Matrix\_real\_pt-\/>nrow();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00537}00537 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00538}00538 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00539}00539     \textcolor{comment}{// Upcast the matrix to the appropriate type}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00540}00540     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* tmp\_rmatrix\_pt =}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00541}00541       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(Matrix\_real\_pt);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00542}00542 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00543}00543     \textcolor{comment}{// Upcast the matrix to the appropriate type}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00544}00544     \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* tmp\_imatrix\_pt =}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00545}00545       \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(Matrix\_imag\_pt);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00546}00546 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00547}00547     \textcolor{comment}{// PARANOID Run the self-\/tests to check the inputs are correct}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00548}00548     this-\/>check\_validity\_of\_solve\_helper\_inputs<MATRIX>(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00549}00549       tmp\_rmatrix\_pt, tmp\_imatrix\_pt, rhs, solution, n\_dof);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00550}00550 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00551}00551     \textcolor{comment}{// We don't need the real matrix pointer any more}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00552}00552     tmp\_rmatrix\_pt = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00553}00553 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00554}00554     \textcolor{comment}{// We don't need the imaginary matrix pointer any more}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00555}00555     tmp\_imatrix\_pt = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00556}00556 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00557}00557 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00558}00558     \textcolor{comment}{// Setup the solution if it is not}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00559}00559     \textcolor{keywordflow}{if} ((!solution[0].distribution\_pt()-\/>built()) ||}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00560}00560         (!solution[1].distribution\_pt()-\/>built()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00561}00561     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00562}00562       solution[0].build(rhs[0].distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00563}00563       solution[1].build(rhs[1].distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00564}00564     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00565}00565 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00566}00566     \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00567}00567     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00568}00568 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00569}00569     \textcolor{comment}{// Copy the real and imaginary part of the solution vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00570}00570     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x\_real(solution[0]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00571}00571     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} x\_imag(solution[1]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00572}00572 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00573}00573     \textcolor{comment}{// Copy the real and imaginary part of the RHS vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00574}00574     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} rhs\_real(rhs[0]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00575}00575     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} rhs\_imag(rhs[1]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00576}00576 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00577}00577     \textcolor{comment}{// Create storage for the real and imaginary part of the constant term}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00578}00578     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} constant\_term\_real(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00579}00579     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} constant\_term\_imag(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00580}00580 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00581}00581     \textcolor{comment}{// Create storage for the real and imaginary part of the residual vector.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00582}00582     \textcolor{comment}{// These aren't used/built if we're inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00583}00583     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} residual\_real;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00584}00584     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} residual\_imag;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00585}00585 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00586}00586     \textcolor{comment}{// Create storage for the norm of the real and imaginary parts of the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00587}00587     \textcolor{comment}{// residual vector. These aren't used if we're inside the multigrid}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00588}00588     \textcolor{comment}{// solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00589}00589     \textcolor{keywordtype}{double} res\_real\_norm = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00590}00590     \textcolor{keywordtype}{double} res\_imag\_norm = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00591}00591 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00592}00592     \textcolor{comment}{// Variable to hold the current residual norm. This isn't used if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00593}00593     \textcolor{comment}{// we're inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00594}00594     \textcolor{keywordtype}{double} norm\_res = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00595}00595 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00596}00596     \textcolor{comment}{// Variables to hold the initial residual norm. This isn't used if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00597}00597     \textcolor{comment}{// we're inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00598}00598     \textcolor{keywordtype}{double} norm\_f = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00599}00599 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00600}00600     \textcolor{comment}{// Initialise the value of Iterations}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00601}00601     Iterations = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00602}00602 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00603}00603     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00604}00604     \textcolor{comment}{// Initial guess isn't necessarily zero (restricted solution from finer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00605}00605     \textcolor{comment}{// grids) therefore both x and the residual need to be assigned values}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00606}00606     \textcolor{comment}{// from inputs. The constant term at the end of the stationary iteration}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00607}00607     \textcolor{comment}{// is also calculated here since it does not change at all throughout the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00608}00608     \textcolor{comment}{// iterative process:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00609}00609     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00610}00610 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00611}00611     \textcolor{comment}{// Loop over all the entries of each vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00612}00612     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00613}00613     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00614}00614       \textcolor{comment}{// Calculate the numerator of the i'th entry in the real component of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00615}00615       \textcolor{comment}{// the constant term}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00616}00616       constant\_term\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = (Matrix\_diagonal\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * rhs\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00617}00617                                Matrix\_diagonal\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * rhs\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00618}00618 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00619}00619       \textcolor{comment}{// Divide by the denominator}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00620}00620       constant\_term\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] *= Matrix\_diagonal\_inv\_sq[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00621}00621 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00622}00622       \textcolor{comment}{// Scale by the damping factor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00623}00623       constant\_term\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] *= Omega;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00624}00624 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00625}00625       \textcolor{comment}{// Calculate the numerator of the i'th entry in the imaginary component of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00626}00626       \textcolor{comment}{// the constant term}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00627}00627       constant\_term\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = (Matrix\_diagonal\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * rhs\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00628}00628                                Matrix\_diagonal\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * rhs\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00629}00629 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00630}00630       \textcolor{comment}{// Divide by the denominator}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00631}00631       constant\_term\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] *= Matrix\_diagonal\_inv\_sq[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00632}00632 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00633}00633       \textcolor{comment}{// Scale by the damping factor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00634}00634       constant\_term\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] *= Omega;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00635}00635     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00636}00636 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00637}00637     \textcolor{comment}{// Create 4 temporary vectors to store the various matrix-\/vector products}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00638}00638     \textcolor{comment}{// required. The appropriate combination has been appended to the name. For}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00639}00639     \textcolor{comment}{// instance, the product A\_r*x\_c corresponds to temp\_vec\_rc (real*imag)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00640}00640     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_vec\_rr(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00641}00641     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_vec\_cc(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00642}00642     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_vec\_rc(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00643}00643     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_vec\_cr(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00644}00644 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00645}00645     \textcolor{comment}{// Calculate the different combinations of A*x (or A*e depending on the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00646}00646     \textcolor{comment}{// level in the heirarchy) in the complex case (i.e. A\_r*x\_r, A\_c*x\_c,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00647}00647     \textcolor{comment}{// A\_r*x\_c and A\_c*x\_r)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00648}00648     Matrix\_real\_pt-\/>multiply(x\_real, temp\_vec\_rr);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00649}00649     Matrix\_imag\_pt-\/>multiply(x\_imag, temp\_vec\_cc);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00650}00650     Matrix\_real\_pt-\/>multiply(x\_imag, temp\_vec\_rc);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00651}00651     Matrix\_imag\_pt-\/>multiply(x\_real, temp\_vec\_cr);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00652}00652 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00653}00653     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00654}00654     \textcolor{comment}{// Calculating the residual r=b-\/Ax in the complex case requires more care}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00655}00655     \textcolor{comment}{// than the real case. The correct calculation can be derived rather easily.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00656}00656     \textcolor{comment}{// Consider the splitting of A, x and b into their complex components:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00657}00657     \textcolor{comment}{//           r = b -\/ A*x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00658}00658     \textcolor{comment}{//             = (b\_r + i*b\_c) -\/ (A\_r + i*A\_c)*(x\_r + i*x\_c)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00659}00659     \textcolor{comment}{//             = [b\_r -\/ A\_r*x\_r + A\_c*x\_c] + i*[b\_c -\/ A\_r*x\_c -\/ A\_c*x\_r]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00660}00660     \textcolor{comment}{// ==> real(r) = b\_r -\/ A\_r*x\_r + A\_c*x\_c}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00661}00661     \textcolor{comment}{//   \& imag(r) = b\_c -\/ A\_r*x\_c -\/ A\_c*x\_r.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00662}00662     \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00663}00663 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00664}00664     \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00665}00665     \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00666}00666     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00667}00667       \textcolor{comment}{// Create storage for the real and imaginary part of the residual vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00668}00668       residual\_real.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00669}00669       residual\_imag.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00670}00670 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00671}00671       \textcolor{comment}{// Real part of the residual:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00672}00672       residual\_real = rhs\_real;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00673}00673       residual\_real -\/= temp\_vec\_rr;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00674}00674       residual\_real += temp\_vec\_cc;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00675}00675 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00676}00676       \textcolor{comment}{// Imaginary part of the residual:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00677}00677       residual\_imag = rhs\_imag;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00678}00678       residual\_imag -\/= temp\_vec\_rc;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00679}00679       residual\_imag -\/= temp\_vec\_cr;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00680}00680 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00681}00681       \textcolor{comment}{// Calculate the 2-\/norm (noting that the 2-\/norm of a complex vector a of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00682}00682       \textcolor{comment}{// length n is simply the square root of the sum of the squares of each}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00683}00683       \textcolor{comment}{// real and imaginary component). That is:}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00684}00684 \textcolor{comment}{      /// \(\backslash\)f[ \(\backslash\)|a\(\backslash\)|\_2\string^2=\(\backslash\)sum\_\{i=0\}\string^\{i=n-\/1\}\(\backslash\)real(a[i])\string^2+\(\backslash\)imag(a[i])\string^2. \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00685}00685 \textcolor{comment}{}      \textcolor{comment}{// can be written as:}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00686}00686 \textcolor{comment}{      /// \(\backslash\)f[ \(\backslash\)|a\(\backslash\)|\_2\string^2=\(\backslash\)|\(\backslash\)real(a)\(\backslash\)|\_2\string^2+\(\backslash\)|\(\backslash\)imag(a)\(\backslash\)|\_2\string^2. \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00687}00687 \textcolor{comment}{}      \textcolor{keywordtype}{double} res\_real\_norm = residual\_real.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00688}00688       \textcolor{keywordtype}{double} res\_imag\_norm = residual\_imag.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00689}00689       \textcolor{keywordtype}{double} norm\_res =}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00690}00690         sqrt(res\_real\_norm * res\_real\_norm + res\_imag\_norm * res\_imag\_norm);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00691}00691 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00692}00692       \textcolor{comment}{// If required will document convergence history to screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00693}00693       \textcolor{comment}{// or file (if stream is open)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00694}00694       \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00695}00695       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00696}00696         \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00697}00697         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00698}00698           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00699}00699         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00700}00700         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00701}00701         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00702}00702           Output\_file\_stream << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00703}00703         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00704}00704       \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00705}00705     \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00706}00706 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00707}00707     \textcolor{comment}{// Two temporary vectors to store the value of A\_r*x\_r -\/ A\_c*x\_c and}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00708}00708     \textcolor{comment}{// A\_c*x\_r + A\_r*x\_c in each iteration}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00709}00709     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_vec\_real(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00710}00710     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp\_vec\_imag(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00711}00711 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00712}00712     \textcolor{comment}{// Calculate A\_r*x\_r -\/ A\_c*x\_c}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00713}00713     temp\_vec\_real = temp\_vec\_rr;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00714}00714     temp\_vec\_real -\/= temp\_vec\_cc;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00715}00715 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00716}00716     \textcolor{comment}{// Calculate A\_c*x\_r + A\_r*x\_c}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00717}00717     temp\_vec\_imag = temp\_vec\_cr;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00718}00718     temp\_vec\_imag += temp\_vec\_rc;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00719}00719 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00720}00720     \textcolor{comment}{// Outermost loop: Run up to Max\_iter times}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00721}00721     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iter\_num = 0; iter\_num < \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}; iter\_num++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00722}00722     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00723}00723       \textcolor{comment}{// Loop over each degree of freedom and update}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00724}00724       \textcolor{comment}{// the current approximation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00725}00725       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_dof; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00726}00726       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00727}00727         \textcolor{comment}{// Make a couple of dummy variables to help with calculations}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00728}00728         \textcolor{keywordtype}{double} dummy\_r = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00729}00729         \textcolor{keywordtype}{double} dummy\_c = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00730}00730 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00731}00731         \textcolor{comment}{// Calculate one part of the correction term (real)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00732}00732         dummy\_r = (Matrix\_diagonal\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * temp\_vec\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00733}00733                    Matrix\_diagonal\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * temp\_vec\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00734}00734 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00735}00735         \textcolor{comment}{// Calculate one part of the correction term (imaginary)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00736}00736         dummy\_c = (Matrix\_diagonal\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * temp\_vec\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00737}00737                    Matrix\_diagonal\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * temp\_vec\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00738}00738 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00739}00739         \textcolor{comment}{// Scale by Omega/([A(i,i)\_r]\string^2+[A(i,i)\_c]\string^2)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00740}00740         dummy\_r *= Omega * Matrix\_diagonal\_inv\_sq[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00741}00741         dummy\_c *= Omega * Matrix\_diagonal\_inv\_sq[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00742}00742 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00743}00743         \textcolor{comment}{// Update the value of x\_real}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00744}00744         x\_real[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/= dummy\_r;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00745}00745         x\_imag[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/= dummy\_c;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00746}00746       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00747}00747 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00748}00748       \textcolor{comment}{// Update the value of x (or e depending on the level in the heirarchy)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00749}00749       x\_real += constant\_term\_real;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00750}00750       x\_imag += constant\_term\_imag;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00751}00751 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00752}00752       \textcolor{comment}{// Calculate the different combinations of A*x (or A*e depending on the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00753}00753       \textcolor{comment}{// level in the heirarchy) in the complex case (i.e. A\_r*x\_r, A\_c*x\_c,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00754}00754       \textcolor{comment}{// A\_r*x\_c and A\_c*x\_r)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00755}00755       Matrix\_real\_pt-\/>multiply(x\_real, temp\_vec\_rr);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00756}00756       Matrix\_imag\_pt-\/>multiply(x\_imag, temp\_vec\_cc);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00757}00757       Matrix\_real\_pt-\/>multiply(x\_imag, temp\_vec\_rc);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00758}00758       Matrix\_imag\_pt-\/>multiply(x\_real, temp\_vec\_cr);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00759}00759 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00760}00760       \textcolor{comment}{// Calculate A\_r*x\_r -\/ A\_c*x\_c}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00761}00761       temp\_vec\_real = temp\_vec\_rr;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00762}00762       temp\_vec\_real -\/= temp\_vec\_cc;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00763}00763 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00764}00764       \textcolor{comment}{// Calculate A\_c*x\_r + A\_r*x\_c}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00765}00765       temp\_vec\_imag = temp\_vec\_cr;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00766}00766       temp\_vec\_imag += temp\_vec\_rc;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00767}00767 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00768}00768       \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00769}00769       \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00770}00770       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00771}00771         \textcolor{comment}{// Calculate the residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00772}00772         residual\_real = rhs\_real;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00773}00773         residual\_real -\/= temp\_vec\_rr;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00774}00774         residual\_real += temp\_vec\_cc;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00775}00775 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00776}00776         \textcolor{comment}{// Calculate the imaginary part of the residual vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00777}00777         residual\_imag = rhs\_imag;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00778}00778         residual\_imag -\/= temp\_vec\_rc;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00779}00779         residual\_imag -\/= temp\_vec\_cr;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00780}00780 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00781}00781         \textcolor{comment}{// Calculate the 2-\/norm using the method mentioned previously}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00782}00782         res\_real\_norm = residual\_real.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00783}00783         res\_imag\_norm = residual\_imag.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9ac9245cac87ddcdb70cfcd697553a55}{norm}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00784}00784         norm\_res =}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00785}00785           sqrt(res\_real\_norm * res\_real\_norm + res\_imag\_norm * res\_imag\_norm) /}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00786}00786           norm\_f;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00787}00787 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00788}00788         \textcolor{comment}{// If required, this will document convergence history to}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00789}00789         \textcolor{comment}{// screen or file (if the stream is open)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00790}00790         \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00791}00791         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00792}00792           \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00793}00793           \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00794}00794             \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00795}00795           \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00796}00796           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00797}00797           \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00798}00798             Output\_file\_stream << Iterations << \textcolor{stringliteral}{"{} "{}} << norm\_res << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00799}00799           \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00800}00800         \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00801}00801 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00802}00802         \textcolor{comment}{// Check the tolerance only if the residual norm is being computed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00803}00803         \textcolor{keywordflow}{if} (norm\_res < Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00804}00804         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00805}00805           \textcolor{comment}{// Break out of the for-\/loop}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00806}00806           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00807}00807         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00808}00808       \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00809}00809     \} \textcolor{comment}{// for (unsigned iter\_num=0;iter\_num<Max\_iter;iter\_num++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00810}00810 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00811}00811     \textcolor{comment}{// Calculate the residual only if we're not inside the multigrid solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00812}00812     \textcolor{keywordflow}{if} (!Use\_as\_smoother)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00813}00813     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00814}00814       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00815}00815       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00816}00816       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00817}00817         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)n(Complex) damped Jacobi converged. Residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00818}00818                    << norm\_res}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00819}00819                    << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of iterations to convergence: "{}} << Iterations}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00820}00820                    << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00821}00821                    << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00822}00822       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00823}00823     \} \textcolor{comment}{// if (!Use\_as\_smoother)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00824}00824 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00825}00825     \textcolor{comment}{// Copy the solution into the solution vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00826}00826     solution[0] = x\_real;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00827}00827     solution[1] = x\_imag;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00828}00828 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00829}00829     \textcolor{comment}{// Doc time for solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00830}00830     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00831}00831     Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00832}00832     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00833}00833     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00834}00834       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with (complex) damped Jacobi [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00835}00835                  << Solution\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00836}00836     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00837}00837 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00838}00838     \textcolor{comment}{// If the solver failed to converge and the user asked for an error if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00839}00839     \textcolor{comment}{// this happened}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00840}00840     \textcolor{keywordflow}{if} ((Iterations > \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} -\/ 1) \&\& (Throw\_error\_after\_max\_iter))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00841}00841     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00842}00842       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message =}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00843}00843         \textcolor{stringliteral}{"{}Solver failed to converge and you requested "{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00844}00844       error\_message += \textcolor{stringliteral}{"{}an error on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00845}00845       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00846}00846         error\_message, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00847}00847     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00848}00848   \} \textcolor{comment}{// End of complex\_solve\_helper function}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00849}00849 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00850}00850   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00851}00851 \textcolor{comment}{  /// The GMRES method rewritten for complex matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00852}00852 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00853}00853   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00854}\mbox{\hyperlink{classoomph_1_1ComplexGMRES}{00854}}   \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1ComplexGMRES}{ComplexGMRES}} : \textcolor{keyword}{public} \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother}{HelmholtzSmoother}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00855}00855   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00856}00856   \textcolor{keyword}{public}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00857}00857 \textcolor{comment}{    /// Constructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00858}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a8d0bfc83e16222c1eee97d8118505bae}{00858}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a8d0bfc83e16222c1eee97d8118505bae}{ComplexGMRES}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00859}00859       : \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a208aaa9528d6b08afa5324f77ac70581}{Iterations}}(0),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00860}00860         \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}(0),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00861}00861         \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a2694315efaf2aa353ad4d67f316b1597}{Resolving}}(false),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00862}00862         \mbox{\hyperlink{classoomph_1_1ComplexGMRES_aa38fa18230fc30f271d59481ccee3b55}{Matrix\_can\_be\_deleted}}(true)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00863}00863     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00864}00864     \} \textcolor{comment}{// End of ComplexGMRES constructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00865}00865 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00866}00866 \textcolor{comment}{    /// Empty destructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00867}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_ade91020000a1b6bf316ff9753ac6498b}{00867}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1ComplexGMRES_ade91020000a1b6bf316ff9753ac6498b}{\string~ComplexGMRES}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00868}00868     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00869}00869       \textcolor{comment}{// Run clean\_up\_memory}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00870}00870       \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a946b88bc1392180c56909b739bfa7b3c}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00871}00871     \} \textcolor{comment}{// End of \string~ComplexGMRES}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00872}00872 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00873}00873 \textcolor{comment}{    /// Broken copy constructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00874}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a45c56dfc89b265bad26548ce8daf7432}{00874}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a45c56dfc89b265bad26548ce8daf7432}{ComplexGMRES}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1ComplexGMRES}{ComplexGMRES}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00875}00875 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00876}00876 \textcolor{comment}{    /// Broken assignment operator}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00877}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_abcf05a5279648148018565c665aa9d02}{00877}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_abcf05a5279648148018565c665aa9d02}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1ComplexGMRES}{ComplexGMRES}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00878}00878 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00879}00879 \textcolor{comment}{    /// Overload disable resolve so that it cleans up memory too}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00880}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a07db774f0aca4e71579c7c071e25a451}{00880}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a07db774f0aca4e71579c7c071e25a451}{disable\_resolve}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00881}00881     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00882}00882       \textcolor{comment}{// Disable resolve using the LinearSolver function}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00883}00883       \mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{LinearSolver::disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00884}00884 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00885}00885       \textcolor{comment}{// Clean up anything kept in memory}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00886}00886       \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a946b88bc1392180c56909b739bfa7b3c}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00887}00887     \} \textcolor{comment}{// End of disable resolve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00888}00888 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00889}00889 \textcolor{comment}{    /// Solver: Takes pointer to problem and returns the results vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00890}00890 \textcolor{comment}{    /// which contains the solution of the linear system defined by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00891}00891 \textcolor{comment}{    /// the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00892}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a76987ec784cd80e6605c63ef8d0ec6b7}{00892}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a76987ec784cd80e6605c63ef8d0ec6b7}{solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00893}00893     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00894}00894       \textcolor{comment}{// Write the error message into a string}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00895}00895       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} error\_message = \textcolor{stringliteral}{"{}Solve function for class\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00896}00896       error\_message += \textcolor{stringliteral}{"{}ComplexGMRES\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00897}00897       error\_message += \textcolor{stringliteral}{"{}is deliberately broken to avoid the accidental \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00898}00898       error\_message += \textcolor{stringliteral}{"{}use of the inappropriate C++ default. If you \(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00899}00899       error\_message += \textcolor{stringliteral}{"{}really need one for this class, write it yourself...\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00900}00900 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00901}00901       \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00902}00902       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00903}00903         error\_message, OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00904}00904     \} \textcolor{comment}{// End of solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00905}00905 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00906}00906 \textcolor{comment}{    /// Linear-\/algebra-\/type solver: Takes pointer to a matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00907}00907 \textcolor{comment}{    /// and rhs vector and returns the solution of the linear system}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00908}00908 \textcolor{comment}{    /// Call the broken base-\/class version. If you want this, please}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00909}00909 \textcolor{comment}{    /// implement it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00910}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a9dd1695e8d907d57151df79a6e3e3968}{00910}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a9dd1695e8d907d57151df79a6e3e3968}{solve}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00911}00911                \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00912}00912                \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& result)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00913}00913     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00914}00914       \mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{LinearSolver::solve}}(matrix\_pt, rhs, result);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00915}00915     \} \textcolor{comment}{// End of solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00916}00916 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00917}00917 \textcolor{comment}{    /// Number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00918}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a10760c61c62771773e2adc57055717aa}{00918}} \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a10760c61c62771773e2adc57055717aa}{iterations}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00919}00919 \textcolor{keyword}{    }\{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00920}00920       \textcolor{comment}{// Return the number of iterations used}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00921}00921       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a208aaa9528d6b08afa5324f77ac70581}{Iterations}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00922}00922     \} \textcolor{comment}{// End of iterations}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00923}00923 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00924}00924 \textcolor{comment}{    /// Setup: Pass pointer to the matrix and store in cast form}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00925}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a1c8ff4f7c1a14f195942ba3e33e73b49}{00925}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a1c8ff4f7c1a14f195942ba3e33e73b49}{complex\_smoother\_setup}}(\mbox{\hyperlink{classoomph_1_1Vector}{Vector<CRDoubleMatrix*>}} helmholtz\_matrix\_pt)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00926}00926     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00927}00927       \textcolor{comment}{// Assume the matrices have been passed in from the outside so we must}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00928}00928       \textcolor{comment}{// not delete it. This is needed to avoid pre-\/ and post-\/smoothers}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00929}00929       \textcolor{comment}{// deleting the same matrix in the MG solver. If this was originally}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00930}00930       \textcolor{comment}{// set to TRUE then this will be sorted out in the other functions}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00931}00931       \textcolor{comment}{// from which this was called}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00932}00932       \mbox{\hyperlink{classoomph_1_1ComplexGMRES_aa38fa18230fc30f271d59481ccee3b55}{Matrix\_can\_be\_deleted}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00933}00933 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00934}00934 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00935}00935       \textcolor{comment}{// PARANOID check -\/ Make sure the input has the right number of matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00936}00936       \textcolor{keywordflow}{if} (helmholtz\_matrix\_pt.size() != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00937}00937       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00938}00938         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00939}00939         error\_message\_stream << \textcolor{stringliteral}{"{}Can only deal with two matrices. You have "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00940}00940                              << helmholtz\_matrix\_pt.size() << \textcolor{stringliteral}{"{} matrices."{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00941}00941                              << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00942}00942 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00943}00943         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00944}00944         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00945}00945                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00946}00946                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00947}00947       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00948}00948 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00949}00949 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00950}00950       \textcolor{comment}{// Resize the storage for the system matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00951}00951       \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}.resize(2, 0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00952}00952 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00953}00953       \textcolor{comment}{// Assign the real matrix pointer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00954}00954       \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[0] = helmholtz\_matrix\_pt[0];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00955}00955 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00956}00956       \textcolor{comment}{// Assign the imaginary matrix pointers}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00957}00957       \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[1] = helmholtz\_matrix\_pt[1];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00958}00958 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00959}00959 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00960}00960       \textcolor{comment}{// PARANOID check -\/ Make sure that the constituent matrices have the same}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00961}00961       \textcolor{comment}{// number of rows}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00962}00962       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[0]-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[1]-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00963}00963       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00964}00964         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00965}00965         error\_message\_stream << \textcolor{stringliteral}{"{}Incompatible real and imag. matrix sizes."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00966}00966         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00967}00967                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00968}00968                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00969}00969       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00970}00970       \textcolor{comment}{// PARANOID check -\/ Make sure that the constituent matrices have the same}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00971}00971       \textcolor{comment}{// number of columns}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00972}00972       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[0]-\/>ncol() != \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[1]-\/>ncol())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00973}00973       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00974}00974         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00975}00975         error\_message\_stream << \textcolor{stringliteral}{"{}Incompatible real and imag. matrix sizes."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00976}00976         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00977}00977                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00978}00978                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00979}00979       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00980}00980 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00981}00981     \} \textcolor{comment}{// End of complex\_smoother\_setup}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00982}00982 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00983}00983 \textcolor{comment}{    /// The smoother\_solve function performs fixed number of iterations}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00984}00984 \textcolor{comment}{    /// on the system A*result=rhs. The number of (smoothing) iterations is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00985}00985 \textcolor{comment}{    /// the same as the max. number of iterations in the underlying}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00986}00986 \textcolor{comment}{    /// IterativeLinearSolver class.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00987}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a874520bc44cd8127497d972373938df9}{00987}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a874520bc44cd8127497d972373938df9}{complex\_smoother\_solve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00988}00988                                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& solution)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00989}00989     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00990}00990       \textcolor{comment}{// If you use a smoother but you don't want to calculate the residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00991}00991       \mbox{\hyperlink{classoomph_1_1HelmholtzSmoother_a2b4b16dcb611cb27371afa1636e125cf}{Use\_as\_smoother}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00992}00992 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00993}00993       \textcolor{comment}{// Use the helper function where the work is actually done}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00994}00994       \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a848721022a08fde4b2182a143f287ded}{complex\_solve\_helper}}(rhs, solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00995}00995     \} \textcolor{comment}{// End of complex\_smoother\_solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00996}00996 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00997}00997   \textcolor{keyword}{private}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00998}00998 \textcolor{comment}{    /// Cleanup data that's stored for resolve (if any has been stored)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l00999}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a946b88bc1392180c56909b739bfa7b3c}{00999}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a946b88bc1392180c56909b739bfa7b3c}{clean\_up\_memory}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01000}01000     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01001}01001       \textcolor{comment}{// If the real matrix pointer isn't null AND we're allowed to delete}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01002}01002       \textcolor{comment}{// the matrix which is only when we create the matrix ourselves}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01003}01003       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[0] != 0) \&\& (\mbox{\hyperlink{classoomph_1_1ComplexGMRES_aa38fa18230fc30f271d59481ccee3b55}{Matrix\_can\_be\_deleted}}))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01004}01004       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01005}01005         \textcolor{comment}{// Delete the matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01006}01006         \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[0];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01007}01007 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01008}01008         \textcolor{comment}{// Assign the associated pointer the value NULL}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01009}01009         \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[0] = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01010}01010       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01011}01011 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01012}01012       \textcolor{comment}{// If the real matrix pointer isn't null AND we're allowed to delete}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01013}01013       \textcolor{comment}{// the matrix which is only when we create the matrix ourselves}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01014}01014       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[1] != 0) \&\& (\mbox{\hyperlink{classoomph_1_1ComplexGMRES_aa38fa18230fc30f271d59481ccee3b55}{Matrix\_can\_be\_deleted}}))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01015}01015       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01016}01016         \textcolor{comment}{// Delete the matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01017}01017         \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[1];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01018}01018 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01019}01019         \textcolor{comment}{// Assign the associated pointer the value NULL}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01020}01020         \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}}[1] = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01021}01021       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01022}01022     \} \textcolor{comment}{// End of clean\_up\_memory}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01023}01023 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01024}01024 \textcolor{comment}{    /// This is where the actual work is done}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01025}01025 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a848721022a08fde4b2182a143f287ded}{complex\_solve\_helper}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01026}01026                               \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01027}01027 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01028}01028 \textcolor{comment}{    /// Helper function to update the result vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01029}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a0c6df8b6c50a0ccd344a62654b1411d0}{01029}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a0c6df8b6c50a0ccd344a62654b1411d0}{update}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& k,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01030}01030                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>>\& hessenberg,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01031}01031                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01032}01032                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}>\& v,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01033}01033                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& x)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01034}01034     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01035}01035       \textcolor{comment}{// Make a local copy of s}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01036}01036       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> y(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01037}01037 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01038}01038       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01039}01039       \textcolor{comment}{// The Hessenberg matrix should be an upper triangular matrix at}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01040}01040       \textcolor{comment}{// this point (although from its storage it would appear to be a}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01041}01041       \textcolor{comment}{// lower triangular matrix since the indexing has been reversed)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01042}01042       \textcolor{comment}{// so finding the minimiser of J(y)=min||s-\/R\_m*y|| where R\_m is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01043}01043       \textcolor{comment}{// the matrix R in the QR factorisation of the Hessenberg matrix.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01044}01044       \textcolor{comment}{// Therefore, to obtain y we simply need to use a backwards}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01045}01045       \textcolor{comment}{// substitution. Note: The implementation here may appear to be}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01046}01046       \textcolor{comment}{// somewhat confusing as the indexing in the Hessenberg matrix is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01047}01047       \textcolor{comment}{// reversed. This implementation of a backwards substitution does}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01048}01048       \textcolor{comment}{// not run along the columns of the triangular matrix but rather}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01049}01049       \textcolor{comment}{// up the rows.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01050}01050       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01051}01051       \textcolor{comment}{// The outer loop is a loop over the columns of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01052}01052       \textcolor{comment}{// since the indexing is reversed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01053}01053       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = \textcolor{keywordtype}{int}(k); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} >= 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}-\/-\/)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01054}01054       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01055}01055         \textcolor{comment}{// Divide the i-\/th entry of y by the i-\/th diagonal entry of H}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01056}01056         y[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] /= hessenberg[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01057}01057 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01058}01058         \textcolor{comment}{// The inner loop is a loop over the rows of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01059}01059         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} -\/ 1; j >= 0; j-\/-\/)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01060}01060         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01061}01061           \textcolor{comment}{// Update the j-\/th entry of y}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01062}01062           y[j] -\/= hessenberg[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][j] * y[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01063}01063         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01064}01064       \} \textcolor{comment}{// for (int i=int(k);i>=0;i-\/-\/)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01065}01065 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01066}01066       \textcolor{comment}{// Calculate the number of entries in x (simply use the real part as}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01067}01067       \textcolor{comment}{// both the real and imaginary part should have the same length)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01068}01068       \textcolor{keywordtype}{unsigned} n\_row = x[0].nrow();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01069}01069 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01070}01070       \textcolor{comment}{// We assume here that the vector x (which is passed in) is actually x\_0}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01071}01071       \textcolor{comment}{// so we simply need to update its entries to calculate the solution, x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01072}01072       \textcolor{comment}{// which is given by x=x\_0+Vy.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01073}01073       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j <= k; j++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01074}01074       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01075}01075         \textcolor{comment}{// For fast access (real part)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01076}01076         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* vj\_r\_pt = v[j][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01077}01077 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01078}01078         \textcolor{comment}{// For fast access (imaginary part)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01079}01079         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* vj\_c\_pt = v[j][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01080}01080 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01081}01081         \textcolor{comment}{// Loop over the entries in x and update them}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01082}01082         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01083}01083         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01084}01084           \textcolor{comment}{// Update the real part of the i-\/th entry in x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01085}01085           x[0][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += (vj\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].real()) -\/ (vj\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].imag());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01086}01086 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01087}01087           \textcolor{comment}{// Update the imaginary part of the i-\/th entry in x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01088}01088           x[1][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += (vj\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].real()) + (vj\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].imag());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01089}01089         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01090}01090       \} \textcolor{comment}{// for (unsigned j=0;j<=k;j++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01091}01091     \} \textcolor{comment}{// End of update}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01092}01092 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01093}01093 \textcolor{comment}{    /// Helper function: Generate a plane rotation. This is done by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01094}01094 \textcolor{comment}{    /// finding the value of \(\backslash\)f\$ \(\backslash\)cos(\(\backslash\)theta) \(\backslash\)f\$ (i.e. cs) and the value of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01095}01095 \textcolor{comment}{    /// \(\backslash\)f\$ \(\backslash\)sin(\(\backslash\)theta) \(\backslash\)f\$ (i.e. sn) such that:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01096}01096 \textcolor{comment}{    /// \(\backslash\)f[ \(\backslash\)begin\{bmatrix\} \(\backslash\)overline\{\(\backslash\)cos\(\backslash\)theta\} \& \(\backslash\)overline\{\(\backslash\)sin\(\backslash\)theta\} \(\backslash\)cr -\/\(\backslash\)sin\(\backslash\)theta \& \(\backslash\)cos\(\backslash\)theta \(\backslash\)end\{bmatrix\} \(\backslash\)begin\{bmatrix\} dx \(\backslash\)\(\backslash\) dy \(\backslash\)end\{bmatrix\} = \(\backslash\)begin\{bmatrix\} r \(\backslash\)\(\backslash\) 0 \(\backslash\)end\{bmatrix\}, \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01097}01097 \textcolor{comment}{    /// where \(\backslash\)f\$ r=\(\backslash\)sqrt\{pow(|dx|,2)+pow(|dy|,2)\} \(\backslash\)f\$. The values of a and b}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01098}01098 \textcolor{comment}{    /// are given by:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01099}01099 \textcolor{comment}{    /// The values of dx and dy are given by:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01100}01100 \textcolor{comment}{    /// \(\backslash\)f[ \(\backslash\)cos\(\backslash\)theta\&=\(\backslash\)dfrac\{dx\}\{\(\backslash\)sqrt\{|dx|\string^2+|dy|\string^2\}\}, \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01101}01101 \textcolor{comment}{    /// and}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01102}01102 \textcolor{comment}{    /// \(\backslash\)f[ \(\backslash\)sin\(\backslash\)theta\&=\(\backslash\)dfrac\{dy\}\{\(\backslash\)sqrt\{|dx|\string^2+|dy|\string^2\}\}. \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01103}01103 \textcolor{comment}{    /// Taken from: Saad Y."{}Iterative methods for sparse linear systems"{}, p.193.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01104}01104 \textcolor{comment}{    /// We also check to see that sn is always a real (nonnegative) number. See}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01105}01105 \textcolor{comment}{    /// pp.193-\/194 for an explanation.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01106}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a07183636586d7d30fcde380ef88e5fe6}{01106}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a07183636586d7d30fcde380ef88e5fe6}{generate\_plane\_rotation}}(std::complex<double>\& dx,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01107}01107                                  std::complex<double>\& dy,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01108}01108                                  std::complex<double>\& cs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01109}01109                                  std::complex<double>\& sn)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01110}01110     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01111}01111       \textcolor{comment}{// If dy=0 then we do not need to apply a rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01112}01112       \textcolor{keywordflow}{if} (dy == 0.0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01113}01113       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01114}01114         \textcolor{comment}{// Using theta=0 gives cos(theta)=1}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01115}01115         cs = 1.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01116}01116 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01117}01117         \textcolor{comment}{// Using theta=0 gives sin(theta)=0}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01118}01118         sn = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01119}01119       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01120}01120       \textcolor{comment}{// If dx or dy is large using the original form of calculting cs and sn is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01121}01121       \textcolor{comment}{// naive since this may overflow or underflow so instead we calculate}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01122}01122       \textcolor{comment}{// r=sqrt(pow(|dx|,2)+pow(|dy|,2)) using r=|dy|sqrt(1+pow(|dx|/|dy|,2)) if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01123}01123       \textcolor{comment}{// |dy|>|dx| [see <A}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01124}01124       \textcolor{comment}{// HREF=https://en.wikipedia.org/wiki/Hypot"{}>Hypot</A>.].}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01125}01125       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (std::abs(dy) > std::abs(dx))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01126}01126       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01127}01127         \textcolor{comment}{// Since |dy|>|dx| calculate the ratio |dx|/|dy|}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01128}01128         std::complex<double> temp = dx / dy;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01129}01129 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01130}01130         \textcolor{comment}{// Calculate the value of sin(theta) using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01131}01131         \textcolor{comment}{//          sin(theta)=dy/sqrt(pow(|dx|,2)+pow(|dy|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01132}01132         \textcolor{comment}{//                    =(dy/|dy|)/sqrt(1+pow(|dx|/|dy|,2)).}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01133}01133         sn = (dy / std::abs(dy)) / sqrt(1.0 + pow(std::abs(temp), 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01134}01134 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01135}01135         \textcolor{comment}{// Calculate the value of cos(theta) using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01136}01136         \textcolor{comment}{//            cos(theta)=dx/sqrt(pow(|dy|,2)+pow(|dx|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01137}01137         \textcolor{comment}{//                      =(dx/|dy|)/sqrt(1+pow(|dx|/|dy|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01138}01138         \textcolor{comment}{//                      =(dx/dy)*sin(theta).}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01139}01139         cs = temp * sn;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01140}01140       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01141}01141       \textcolor{comment}{// Otherwise, we have |dx|>=|dy| so to, again, avoid overflow or underflow}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01142}01142       \textcolor{comment}{// calculate the values of cs and sn using the method above}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01143}01143       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01144}01144       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01145}01145         \textcolor{comment}{// Since |dx|>=|dy| calculate the ratio dy/dx}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01146}01146         std::complex<double> temp = dy / dx;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01147}01147 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01148}01148         \textcolor{comment}{// Calculate the value of cos(theta) using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01149}01149         \textcolor{comment}{//          cos(theta)=dx/sqrt(pow(|dx|,2)+pow(|dy|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01150}01150         \textcolor{comment}{//                    =(dx/|dx|)/sqrt(1+pow(|dy|/|dx|,2)).}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01151}01151         cs = (dx / std::abs(dx)) / sqrt(1.0 + pow(std::abs(temp), 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01152}01152 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01153}01153         \textcolor{comment}{// Calculate the value of sin(theta) using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01154}01154         \textcolor{comment}{//            sin(theta)=dy/sqrt(pow(|dx|,2)+pow(|dy|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01155}01155         \textcolor{comment}{//                      =(dy/|dx|)/sqrt(1+pow(|dy|/|dx|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01156}01156         \textcolor{comment}{//                      =(dy/dx)*cos(theta).}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01157}01157         sn = temp * cs;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01158}01158       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01159}01159 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01160}01160       \textcolor{comment}{// Set the tolerance for sin(theta)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01161}01161       \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a7be3c4ea16f1fc9b397e7c87eae253d8}{tolerance}} = 1.0e-\/15;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01162}01162 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01163}01163       \textcolor{comment}{// Make sure sn is real and nonnegative (it should be!)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01164}01164       \textcolor{keywordflow}{if} ((std::fabs(sn.imag()) > \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a7be3c4ea16f1fc9b397e7c87eae253d8}{tolerance}}) || (sn.real() < 0))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01165}01165       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01166}01166         \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01167}01167         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01168}01168 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01169}01169         \textcolor{comment}{// Create an error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01170}01170         error\_message\_stream << \textcolor{stringliteral}{"{}The value of sin(theta) is not real "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01171}01171                              << \textcolor{stringliteral}{"{}and/or nonnegative. Value is: "{}} << sn}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01172}01172                              << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01173}01173 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01174}01174         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01175}01175         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01176}01176                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01177}01177                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01178}01178       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01179}01179     \} \textcolor{comment}{// End of generate\_plane\_rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01180}01180 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01181}01181 \textcolor{comment}{    /// Helper function: Apply plane rotation. This is done using the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01182}01182 \textcolor{comment}{    /// update:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01183}01183 \textcolor{comment}{    /// \(\backslash\)f[ \(\backslash\)begin\{bmatrix\} dx \(\backslash\)\(\backslash\) dy \(\backslash\)end\{bmatrix\} \(\backslash\)leftarrow \(\backslash\)begin\{bmatrix\} \(\backslash\)overline\{\(\backslash\)cos\(\backslash\)theta\} \& \(\backslash\)overline\{\(\backslash\)sin\(\backslash\)theta\} \(\backslash\)\(\backslash\) -\/\(\backslash\)sin\(\backslash\)theta \& \(\backslash\)cos\(\backslash\)theta \(\backslash\)end\{bmatrix\} \(\backslash\)begin\{bmatrix\} dx \(\backslash\)\(\backslash\) dy \(\backslash\)end\{bmatrix\}. \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01184}01184 \textcolor{comment}{    /// Taken from: Saad Y."{}Iterative methods for sparse linear systems"{}, p.193.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01185}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a8aa80ff477c4b131f8c1a4c74f872df1}{01185}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a8aa80ff477c4b131f8c1a4c74f872df1}{apply\_plane\_rotation}}(std::complex<double>\& dx,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01186}01186                               std::complex<double>\& dy,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01187}01187                               std::complex<double>\& cs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01188}01188                               std::complex<double>\& sn)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01189}01189     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01190}01190       \textcolor{comment}{// Calculate the value of dx but don't update it yet}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01191}01191       std::complex<double> temp = std::conj(cs) * dx + std::conj(sn) * dy;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01192}01192 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01193}01193       \textcolor{comment}{// Set the value of dy}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01194}01194       dy = -\/sn * dx + cs * dy;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01195}01195 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01196}01196       \textcolor{comment}{// Set the value of dx using the correct values of dx and dy}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01197}01197       dx = temp;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01198}01198     \} \textcolor{comment}{// End of apply\_plane\_rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01199}01199 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01200}01200 \textcolor{comment}{    /// Number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01201}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a208aaa9528d6b08afa5324f77ac70581}{01201}} \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a208aaa9528d6b08afa5324f77ac70581}{Iterations}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01202}01202 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01203}01203 \textcolor{comment}{    /// Vector of pointers to the real and imaginary part of the system matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01204}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{01204}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1Vector}{Vector<CRDoubleMatrix*>}} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_adfd862b611a335b5d6872a9eb37aa193}{Matrices\_storage\_pt}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01205}01205 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01206}01206 \textcolor{comment}{    /// Boolean flag to indicate if the solve is done in re-\/solve mode,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01207}01207 \textcolor{comment}{    /// bypassing setup of matrix and preconditioner}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01208}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a2694315efaf2aa353ad4d67f316b1597}{01208}} \textcolor{comment}{}    \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a2694315efaf2aa353ad4d67f316b1597}{Resolving}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01209}01209 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01210}01210 \textcolor{comment}{    /// Boolean flag to indicate if the real and imaginary system}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01211}01211 \textcolor{comment}{    /// matrices can be deleted}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01212}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_aa38fa18230fc30f271d59481ccee3b55}{01212}} \textcolor{comment}{}    \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_aa38fa18230fc30f271d59481ccee3b55}{Matrix\_can\_be\_deleted}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01213}01213   \};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01214}01214 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01215}01215   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01216}01216 \textcolor{comment}{  /// This is where the actual work is done}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01217}01217 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01218}01218   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01219}\mbox{\hyperlink{classoomph_1_1ComplexGMRES_a848721022a08fde4b2182a143f287ded}{01219}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1ComplexGMRES_a848721022a08fde4b2182a143f287ded}{ComplexGMRES<MATRIX>::complex\_solve\_helper}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01220}01220     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& rhs, \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& solution)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01221}01221   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01222}01222     \textcolor{comment}{// Set the number of dof types (real and imaginary for this solver)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01223}01223     \textcolor{keywordtype}{unsigned} n\_dof\_types = 2;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01224}01224 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01225}01225     \textcolor{comment}{// Get the number of dofs (note, the total number of dofs in the problem}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01226}01226     \textcolor{comment}{// is 2*n\_row but if the constituent vectors and matrices were stored in}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01227}01227     \textcolor{comment}{// complex objects there would only be (n\_row) rows so we use that)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01228}01228     \textcolor{keywordtype}{unsigned} n\_row = Matrices\_storage\_pt[0]-\/>nrow();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01229}01229 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01230}01230     \textcolor{comment}{// Make sure Max\_iter isn't greater than n\_dof. The user cannot use this}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01231}01231     \textcolor{comment}{// many iterations when using Krylov subspace methods}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01232}01232     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} > n\_row)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01233}01233     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01234}01234       \textcolor{comment}{// Create an output string stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01235}01235       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01236}01236 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01237}01237       \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01238}01238       error\_message\_stream << \textcolor{stringliteral}{"{}The maximum number of iterations cannot exceed "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01239}01239                            << \textcolor{stringliteral}{"{}the number of rows in the problem."{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01240}01240                            << \textcolor{stringliteral}{"{}\(\backslash\)nMaximum number of iterations: "{}} << \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01241}01241                            << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of rows: "{}} << n\_row << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01242}01242 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01243}01243       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01244}01244       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01245}01245                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01246}01246                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01247}01247     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01248}01248 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01249}01249     \textcolor{comment}{// Loop over the real and imaginary parts}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01250}01250     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01251}01251     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01252}01252 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01253}01253       \textcolor{comment}{// PARANOID check that if the matrix is distributable then it should not}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01254}01254       \textcolor{comment}{// be then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01255}01255       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01256}01256             Matrices\_storage\_pt[dof\_type]) != 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01257}01257       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01258}01258         \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01259}01259               Matrices\_storage\_pt[dof\_type])}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01260}01260               -\/>distributed())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01261}01261         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01262}01262           std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01263}01263           error\_message\_stream << \textcolor{stringliteral}{"{}The matrix must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01264}01264           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01265}01265                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01266}01266                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01267}01267         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01268}01268       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01269}01269       \textcolor{comment}{// PARANOID check that this rhs distribution is setup}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01270}01270       \textcolor{keywordflow}{if} (!rhs[dof\_type].built())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01271}01271       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01272}01272         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01273}01273         error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector distribution must be setup."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01274}01274         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01275}01275                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01276}01276                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01277}01277       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01278}01278       \textcolor{comment}{// PARANOID check that the rhs has the right number of global rows}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01279}01279       \textcolor{keywordflow}{if} (rhs[dof\_type].nrow() != n\_row)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01280}01280       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01281}01281         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01282}01282         error\_message\_stream << \textcolor{stringliteral}{"{}RHS does not have the same dimension as the"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01283}01283                              << \textcolor{stringliteral}{"{} linear system"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01284}01284         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01285}01285                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01286}01286                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01287}01287       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01288}01288       \textcolor{comment}{// PARANOID check that the rhs is not distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01289}01289       \textcolor{keywordflow}{if} (rhs[dof\_type].distribution\_pt()-\/>distributed())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01290}01290       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01291}01291         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01292}01292         error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01293}01293         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01294}01294                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01295}01295                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01296}01296       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01297}01297       \textcolor{comment}{// PARANOID check that if the result is setup it matches the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01298}01298       \textcolor{comment}{// of the rhs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01299}01299       \textcolor{keywordflow}{if} (solution[dof\_type].built())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01300}01300       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01301}01301         \textcolor{keywordflow}{if} (!(*rhs[dof\_type].distribution\_pt() ==}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01302}01302               *solution[dof\_type].distribution\_pt()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01303}01303         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01304}01304           std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01305}01305           error\_message\_stream << \textcolor{stringliteral}{"{}If the result distribution is setup then it "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01306}01306                                << \textcolor{stringliteral}{"{}must be the same as the rhs distribution"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01307}01307           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01308}01308                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01309}01309                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01310}01310         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01311}01311       \} \textcolor{comment}{// if (solution[dof\_type].built())}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01312}01312 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01313}01313       \textcolor{comment}{// Set up the solution distribution if it's not already distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01314}01314       \textcolor{keywordflow}{if} (!solution[dof\_type].built())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01315}01315       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01316}01316         \textcolor{comment}{// Build the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01317}01317         solution[dof\_type].build(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01318}01318       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01319}01319       \textcolor{comment}{// Otherwise initialise all entries to zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01320}01320       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01321}01321       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01322}01322         \textcolor{comment}{// Initialise the entries in the k-\/th vector in solution to zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01323}01323         solution[dof\_type].\mbox{\hyperlink{classoomph_1_1Vector_ad526bb1acccf11b485ebe12c9cde44fd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01324}01324       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01325}01325     \} \textcolor{comment}{// for (unsigned dof\_type=0;dof\_type<n\_dof\_types;dof\_type++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01326}01326 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01327}01327     \textcolor{comment}{// Start the solver timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01328}01328     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01329}01329 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01330}01330     \textcolor{comment}{// Storage for the relative residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01331}01331     \textcolor{keywordtype}{double} resid;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01332}01332 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01333}01333     \textcolor{comment}{// Initialise vectors (since these are not distributed vectors we template}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01334}01334     \textcolor{comment}{// one vector by the type std::complex<double> instead of using two vectors,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01335}01335     \textcolor{comment}{// each templated by the type double}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01336}01336 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01337}01337     \textcolor{comment}{// Vector, s, used in the minimisation problem: J(y)=min||s-\/R\_m*y||}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01338}01338     \textcolor{comment}{// [see Saad Y."{}Iterative methods for sparse linear systems"{}, p.176.]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01339}01339     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01340}01340 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01341}01341     \textcolor{comment}{// Vector to store the value of cos(theta) when using the Givens rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01342}01342     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> cs(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01343}01343 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01344}01344     \textcolor{comment}{// Vector to store the value of sin(theta) when using the Givens rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01345}01345     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> sn(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01346}01346 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01347}01347     \textcolor{comment}{// Create a vector of DoubleVectors (this is a distributed vector so we have}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01348}01348     \textcolor{comment}{// to create two separate DoubleVector objects to cope with the arithmetic)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01349}01349     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} w(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01350}01350 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01351}01351     \textcolor{comment}{// Build the distribution of both vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01352}01352     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01353}01353     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01354}01354       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01355}01355       w[dof\_type].build(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01356}01356     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01357}01357 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01358}01358     \textcolor{comment}{// Create a vector of DoubleVectors to store the RHS of b-\/Jx=Mr. We assume}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01359}01359     \textcolor{comment}{// both x=0 and that a preconditioner is not applied by which we deduce b=r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01360}01360     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} r(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01361}01361 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01362}01362     \textcolor{comment}{// Build the distribution of both vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01363}01363     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01364}01364     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01365}01365       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01366}01366       r[dof\_type].build(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01367}01367     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01368}01368 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01369}01369     \textcolor{comment}{// Store the value of b (the RHS vector) in r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01370}01370     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01371}01371     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01372}01372       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01373}01373       r[dof\_type] = rhs[dof\_type];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01374}01374     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01375}01375 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01376}01376     \textcolor{comment}{// Calculate the norm of the real part of r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01377}01377     \textcolor{keywordtype}{double} norm\_r = r[0].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01378}01378 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01379}01379     \textcolor{comment}{// Calculate the norm of the imaginary part of r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01380}01380     \textcolor{keywordtype}{double} norm\_c = r[1].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01381}01381 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01382}01382     \textcolor{comment}{// Compute norm(r)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01383}01383     \textcolor{keywordtype}{double} normb = sqrt(pow(norm\_r, 2.0) + pow(norm\_c, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01384}01384 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01385}01385     \textcolor{comment}{// Set the value of beta (the initial residual)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01386}01386     \textcolor{keywordtype}{double} beta = normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01387}01387 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01388}01388     \textcolor{comment}{// Compute the initial relative residual. If the entries of the RHS vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01389}01389     \textcolor{comment}{// are all zero then set normb equal to one. This is because we divide the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01390}01390     \textcolor{comment}{// value of the norm at later stages by normb and dividing by zero is not}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01391}01391     \textcolor{comment}{// definied}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01392}01392     \textcolor{keywordflow}{if} (normb == 0.0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01393}01393     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01394}01394       \textcolor{comment}{// Set the value of normb}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01395}01395       normb = 1.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01396}01396     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01397}01397 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01398}01398     \textcolor{comment}{// Calculate the ratio between the initial norm and the current norm.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01399}01399     \textcolor{comment}{// Since we haven't completed an iteration yet this will simply be one}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01400}01400     \textcolor{comment}{// unless normb was zero, in which case resid will have value zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01401}01401     resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01402}01402 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01403}01403     \textcolor{comment}{// If required, will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01404}01404     \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01405}01405     \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01406}01406     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01407}01407       \textcolor{comment}{// If an output file which is open isn't provided then output to screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01408}01408       \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01409}01409       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01410}01410         \textcolor{comment}{// Output the residual value to the screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01411}01411         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01412}01412       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01413}01413       \textcolor{comment}{// Otherwise, output to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01414}01414       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01415}01415       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01416}01416         \textcolor{comment}{// Output the residual value to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01417}01417         Output\_file\_stream << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01418}01418       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01419}01419     \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01420}01420 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01421}01421     \textcolor{comment}{// If the GMRES algorithm converges immediately}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01422}01422     \textcolor{keywordflow}{if} (resid <= Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01423}01423     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01424}01424       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01425}01425       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01426}01426       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01427}01427         \textcolor{comment}{// Notify the user}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01428}01428         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}GMRES converged immediately. Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01429}01429                    << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01430}01430       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01431}01431 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01432}01432       \textcolor{comment}{// Finish running the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01433}01433       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01434}01434     \} \textcolor{comment}{// if (resid<=Tolerance)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01435}01435 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01436}01436     \textcolor{comment}{// Initialise a vector of orthogonal basis vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01437}01437     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<DoubleVector>}}> v;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01438}01438 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01439}01439     \textcolor{comment}{// Resize the number of vectors needed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01440}01440     v.resize(n\_row + 1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01441}01441 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01442}01442     \textcolor{comment}{// Resize each Vector of DoubleVectors to store the real and imaginary}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01443}01443     \textcolor{comment}{// part of a given vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01444}01444     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_row + 1; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01445}01445     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01446}01446       \textcolor{comment}{// Create two DoubleVector objects in each Vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01447}01447       v[dof\_type].resize(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01448}01448     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01449}01449 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01450}01450     \textcolor{comment}{// Initialise the upper hessenberg matrix. Since we are not using}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01451}01451     \textcolor{comment}{// distributed vectors here, the algebra is best done using entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01452}01452     \textcolor{comment}{// of the type std::complex<double>. NOTE: For implementation purposes}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01453}01453     \textcolor{comment}{// the upper Hessenberg matrix indices are swapped so the matrix is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01454}01454     \textcolor{comment}{// effectively transposed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01455}01455     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<std::complex<double>}}>> hessenberg(n\_row + 1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01456}01456 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01457}01457     \textcolor{comment}{// Build the zeroth basis vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01458}01458     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01459}01459     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01460}01460       \textcolor{comment}{// Build the k-\/th part of the zeroth vector. Here k=0 and k=1 correspond}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01461}01461       \textcolor{comment}{// to the real and imaginary part of the zeroth vector, respectively}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01462}01462       v[0][dof\_type].build(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01463}01463     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01464}01464 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01465}01465     \textcolor{comment}{// Loop over the real and imaginary parts of v}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01466}01466     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01467}01467     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01468}01468       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01469}01469       \textcolor{keywordtype}{double}* v0\_pt = v[0][dof\_type].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01470}01470 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01471}01471       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01472}01472       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* r\_pt = r[dof\_type].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01473}01473 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01474}01474       \textcolor{comment}{// Set the zeroth basis vector v[0] to r/beta}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01475}01475       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01476}01476       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01477}01477         \textcolor{comment}{// Assign the i-\/th entry of the zeroth basis vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01478}01478         v0\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] / beta;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01479}01479       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01480}01480     \} \textcolor{comment}{// for (unsigned k=0;k<n\_dof\_types;k++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01481}01481 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01482}01482     \textcolor{comment}{// Set the first entry in the minimisation problem RHS vector (is meant}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01483}01483     \textcolor{comment}{// to the vector beta*e\_1 initially, where e\_1 is the unit vector with}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01484}01484     \textcolor{comment}{// one in its first entry)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01485}01485     \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0] = beta;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01486}01486 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01487}01487     \textcolor{comment}{// Compute the next step of the iterative scheme}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01488}01488     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}; j++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01489}01489     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01490}01490       \textcolor{comment}{// Resize the next column of the upper hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01491}01491       hessenberg[j].resize(j + 2, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01492}01492 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01493}01493       \textcolor{comment}{// Calculate w=J*v\_j. Note, we cannot use inbuilt complex matrix algebra}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01494}01494       \textcolor{comment}{// here as we're using distributed vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01495}01495       complex\_matrix\_multiplication(Matrices\_storage\_pt, v[j], w);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01496}01496 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01497}01497       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01498}01498       \textcolor{keywordtype}{double}* w\_r\_pt = w[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01499}01499 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01500}01500       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01501}01501       \textcolor{keywordtype}{double}* w\_c\_pt = w[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01502}01502 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01503}01503       \textcolor{comment}{// Loop over all of the entries on and above the principal subdiagonal of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01504}01504       \textcolor{comment}{// the Hessenberg matrix in the j-\/th column (remembering that}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01505}01505       \textcolor{comment}{// the indices of the upper Hessenberg matrix are swapped for the purpose}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01506}01506       \textcolor{comment}{// of implementation)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01507}01507       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < j + 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01508}01508       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01509}01509         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01510}01510         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* vi\_r\_pt = v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01511}01511 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01512}01512         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01513}01513         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* vi\_c\_pt = v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01514}01514 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01515}01515         \textcolor{comment}{// Loop over the entries of v and w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01516}01516         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01517}01517         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01518}01518           \textcolor{comment}{// Store the appropriate entry in v as a complex value}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01519}01519           std::complex<double> complex\_v(vi\_r\_pt[k], vi\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01520}01520 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01521}01521           \textcolor{comment}{// Store the appropriate entry in w as a complex value}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01522}01522           std::complex<double> complex\_w(w\_r\_pt[k], w\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01523}01523 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01524}01524           \textcolor{comment}{// Update the value of H(i,j) noting we're computing a complex}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01525}01525           \textcolor{comment}{// inner product here}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01526}01526           hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += std::conj(complex\_v) * complex\_w;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01527}01527         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01528}01528 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01529}01529         \textcolor{comment}{// Orthonormalise w against all previous orthogonal vectors, v\_i by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01530}01530         \textcolor{comment}{// looping over its entries and updating them}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01531}01531         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01532}01532         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01533}01533           \textcolor{comment}{// Update the real part of the k-\/th entry of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01534}01534           w\_r\_pt[k] -\/= (hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].real() * vi\_r\_pt[k] -\/}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01535}01535                         hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].imag() * vi\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01536}01536 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01537}01537           \textcolor{comment}{// Update the imaginary part of the k-\/th entry of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01538}01538           w\_c\_pt[k] -\/= (hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].real() * vi\_c\_pt[k] +}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01539}01539                         hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].imag() * vi\_r\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01540}01540         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01541}01541       \} \textcolor{comment}{// for (unsigned i=0;i<j+1;i++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01542}01542 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01543}01543       \textcolor{comment}{// Calculate the norm of the real part of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01544}01544       norm\_r = w[0].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01545}01545 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01546}01546       \textcolor{comment}{// Calculate the norm of the imaginary part of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01547}01547       norm\_c = w[1].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01548}01548 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01549}01549       \textcolor{comment}{// Calculate the norm of the vector w using norm\_r and norm\_c and assign}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01550}01550       \textcolor{comment}{// its value to the appropriate entry in the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01551}01551       hessenberg[j][j + 1] = sqrt(pow(norm\_r, 2.0) + pow(norm\_c, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01552}01552 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01553}01553       \textcolor{comment}{// Build the real part of the next orthogonal vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01554}01554       v[j + 1][0].build(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01555}01555 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01556}01556       \textcolor{comment}{// Build the imaginary part of the next orthogonal vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01557}01557       v[j + 1][1].build(this-\/>distribution\_pt(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01558}01558 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01559}01559       \textcolor{comment}{// Check if the value of hessenberg[j][j+1] is zero. If it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01560}01560       \textcolor{comment}{// isn't then we update the next entries in v}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01561}01561       \textcolor{keywordflow}{if} (hessenberg[j][j + 1] != 0.0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01562}01562       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01563}01563         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01564}01564         \textcolor{keywordtype}{double}* v\_r\_pt = v[j + 1][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01565}01565 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01566}01566         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01567}01567         \textcolor{keywordtype}{double}* v\_c\_pt = v[j + 1][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01568}01568 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01569}01569         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01570}01570         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* w\_r\_pt = w[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01571}01571 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01572}01572         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01573}01573         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* w\_c\_pt = w[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01574}01574 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01575}01575         \textcolor{comment}{// Notice, the value of H(j,j+1), as calculated above, is clearly a real}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01576}01576         \textcolor{comment}{// number. As such, calculating the division}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01577}01577         \textcolor{comment}{//                      v\_\{j+1\}=w\_\{j\}/h\_\{j+1,j\},}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01578}01578         \textcolor{comment}{// here is simple, i.e. we don't need to worry about cross terms in the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01579}01579         \textcolor{comment}{// algebra. To avoid computing h\_\{j+1,j\} several times we precompute it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01580}01580         \textcolor{keywordtype}{double} h\_subdiag\_val = hessenberg[j][j + 1].real();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01581}01581 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01582}01582         \textcolor{comment}{// Loop over the entries of the new orthogonal vector and set its values}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01583}01583         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01584}01584         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01585}01585           \textcolor{comment}{// The i-\/th entry of the real component is given by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01586}01586           v\_r\_pt[k] = w\_r\_pt[k] / h\_subdiag\_val;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01587}01587 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01588}01588           \textcolor{comment}{// Similarly, the i-\/th entry of the imaginary component is given by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01589}01589           v\_c\_pt[k] = w\_c\_pt[k] / h\_subdiag\_val;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01590}01590         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01591}01591       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01592}01592       \textcolor{comment}{// Otherwise, we have to jump to the next part of the algorithm; if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01593}01593       \textcolor{comment}{// the value of hessenberg[j][j+1] is zero then the norm of the latest}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01594}01594       \textcolor{comment}{// orthogonal vector is zero. This is only possible if the entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01595}01595       \textcolor{comment}{// in w are all zero. As a result, the Krylov space of A and r\_0 has}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01596}01596       \textcolor{comment}{// been spanned by the previously calculated orthogonal vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01597}01597       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01598}01598       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01599}01599         \textcolor{comment}{// Book says "{}Set m=j and jump to step 11"{} (p.172)...}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01600}01600         \textcolor{comment}{// Do something here!}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01601}01601         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Subdiagonal Hessenberg entry is zero."{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01602}01602                    << \textcolor{stringliteral}{"{}Do something here..."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01603}01603       \} \textcolor{comment}{// if (hessenberg[j][j+1]!=0.0)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01604}01604 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01605}01605       \textcolor{comment}{// Loop over the entries in the Hessenberg matrix and calculate the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01606}01606       \textcolor{comment}{// entries of the Givens rotation matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01607}01607       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < j; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01608}01608       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01609}01609         \textcolor{comment}{// Apply the plane rotation to all of the previous entries in the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01610}01610         \textcolor{comment}{// (j)-\/th column (remembering the indexing is reversed)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01611}01611         apply\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01612}01612           hessenberg[j][k], hessenberg[j][k + 1], cs[k], sn[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01613}01613       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01614}01614 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01615}01615       \textcolor{comment}{// Now calculate the entries of the latest Givens rotation matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01616}01616       generate\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01617}01617         hessenberg[j][j], hessenberg[j][j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01618}01618 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01619}01619       \textcolor{comment}{// Apply the plane rotation using the newly calculated entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01620}01620       apply\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01621}01621         hessenberg[j][j], hessenberg[j][j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01622}01622 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01623}01623       \textcolor{comment}{// Apply a plane rotation to the corresponding entry in the vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01624}01624       \textcolor{comment}{// s used in the minimisation problem, J(y)=min||s-\/R\_m*y||}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01625}01625       apply\_plane\_rotation(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j], \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01626}01626 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01627}01627       \textcolor{comment}{// Compute current residual using equation (6.42) in Saad Y, "{}Iterative}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01628}01628       \textcolor{comment}{// methods for sparse linear systems"{}, p.177.]. Note, since s has complex}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01629}01629       \textcolor{comment}{// entries we have to use std::abs instead of std::fabs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01630}01630       beta = std::abs(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j + 1]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01631}01631 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01632}01632       \textcolor{comment}{// Compute the relative residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01633}01633       resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01634}01634 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01635}01635       \textcolor{comment}{// If required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01636}01636       \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01637}01637       \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01638}01638       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01639}01639         \textcolor{comment}{// If an output file which is open isn't provided then output to screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01640}01640         \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01641}01641         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01642}01642           \textcolor{comment}{// Output the residual value to the screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01643}01643           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << j + 1 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01644}01644         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01645}01645         \textcolor{comment}{// Otherwise, output to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01646}01646         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01647}01647         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01648}01648           \textcolor{comment}{// Output the residual value to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01649}01649           Output\_file\_stream << j + 1 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01650}01650         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01651}01651       \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01652}01652 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01653}01653       \textcolor{comment}{// If the required tolerance has been met}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01654}01654       \textcolor{keywordflow}{if} (resid < Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01655}01655       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01656}01656         \textcolor{comment}{// Store the number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01657}01657         Iterations = j + 1;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01658}01658 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01659}01659         \textcolor{comment}{// Update the result vector using the result, x=x\_0+V\_m*y (where V\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01660}01660         \textcolor{comment}{// is given by v here)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01661}01661         update(j, hessenberg, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, v, solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01662}01662 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01663}01663         \textcolor{comment}{// If time documentation was enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01664}01664         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01665}01665         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01666}01666           \textcolor{comment}{// Output the current normalised residual norm}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01667}01667           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nGMRES converged (1). Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01668}01668                      << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01669}01669 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01670}01670           \textcolor{comment}{// Output the number of iterations it took for convergence}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01671}01671           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations to convergence: "{}} << j + 1 << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01672}01672                      << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01673}01673         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01674}01674 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01675}01675         \textcolor{comment}{// Stop the timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01676}01676         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01677}01677 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01678}01678         \textcolor{comment}{// Calculate the time taken to calculate the solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01679}01679         Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01680}01680 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01681}01681         \textcolor{comment}{// If time documentation was enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01682}01682         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01683}01683         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01684}01684           \textcolor{comment}{// Output the time taken to solve the problem using GMRES}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01685}01685           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with GMRES [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01686}01686                      << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01687}01687         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01688}01688 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01689}01689         \textcolor{comment}{// As we've met the tolerance for the solver and everything that should}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01690}01690         \textcolor{comment}{// be documented, has been, finish using the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01691}01691         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01692}01692       \} \textcolor{comment}{// if (resid<Tolerance)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01693}01693     \} \textcolor{comment}{// for (unsigned j=0;j<Max\_iter;j++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01694}01694 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01695}01695     \textcolor{comment}{// Store the number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01696}01696     Iterations = \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01697}01697 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01698}01698     \textcolor{comment}{// Only update if we actually did something}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01699}01699     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} > 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01700}01700     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01701}01701       \textcolor{comment}{// Update the result vector using the result, x=x\_0+V\_m*y (where V\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01702}01702       \textcolor{comment}{// is given by v here)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01703}01703       update(\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} -\/ 1, hessenberg, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, v, solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01704}01704     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01705}01705 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01706}01706     \textcolor{comment}{// Stop the timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01707}01707     \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01708}01708 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01709}01709     \textcolor{comment}{// Calculate the time taken to calculate the solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01710}01710     Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01711}01711 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01712}01712     \textcolor{comment}{// If time documentation was enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01713}01713     \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01714}01714     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01715}01715       \textcolor{comment}{// Output the time taken to solve the problem using GMRES}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01716}01716       \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with GMRES [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01717}01717                  << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01718}01718     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01719}01719 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01720}01720     \textcolor{comment}{// Finish using the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01721}01721     \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01722}01722   \} \textcolor{comment}{// End of complex\_solve\_helper}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01723}01723 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01724}01724 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01725}01725 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01726}01726 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01727}01727 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01728}01728 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01729}01729 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01730}01730   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01731}01731 \textcolor{comment}{  /// The GMRES method for the Helmholtz solver.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01732}01732 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01733}01733   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01734}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG}{01734}}   \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG}{HelmholtzGMRESMG}} : \textcolor{keyword}{public} \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver}{IterativeLinearSolver}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01735}01735                            \textcolor{keyword}{public} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner}{BlockPreconditioner}}<MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01736}01736   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01737}01737   \textcolor{keyword}{public}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01738}01738 \textcolor{comment}{    /// Constructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01739}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ab686680821fe3c9ac0c0a07ccb0e7550}{01739}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ab686680821fe3c9ac0c0a07ccb0e7550}{HelmholtzGMRESMG}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01740}01740       : \mbox{\hyperlink{classoomph_1_1BlockPreconditioner}{BlockPreconditioner}}<\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}>(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01741}01741         \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ae2a4718545bd42acb57aba5baa23d52f}{Iterations}}(0),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01742}01742         \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_acb64519b62c16bbec32d01c9969f746f}{Resolving}}(false),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01743}01743         \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a1550b5147f7fa822e8cbc9de93f1c06f}{Matrix\_can\_be\_deleted}}(true)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01744}01744     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01745}01745       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7f151e92397721fc2ae6acdd8253d685}{Preconditioner\_LHS}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01746}01746     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01747}01747 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01748}01748 \textcolor{comment}{    /// Destructor (cleanup storage)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01749}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_aa8bdb804033f8050742706589cd8a072}{01749}} \textcolor{comment}{}    \textcolor{keyword}{virtual} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_aa8bdb804033f8050742706589cd8a072}{\string~HelmholtzGMRESMG}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01750}01750     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01751}01751       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01752}01752     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01753}01753 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01754}01754 \textcolor{comment}{    /// Broken copy constructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01755}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7afe1fbc439c21054eaec7e152f36838}{01755}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7afe1fbc439c21054eaec7e152f36838}{HelmholtzGMRESMG}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG}{HelmholtzGMRESMG}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01756}01756 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01757}01757 \textcolor{comment}{    /// Broken assignment operator}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01758}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_aefa1cb22631d803db4bd131149a5c603}{01758}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_aefa1cb22631d803db4bd131149a5c603}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG}{HelmholtzGMRESMG}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01759}01759 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01760}01760 \textcolor{comment}{    /// Overload disable resolve so that it cleans up memory too}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01761}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a842b638722cd45650da8771aea2f9e5c}{01761}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a842b638722cd45650da8771aea2f9e5c}{disable\_resolve}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01762}01762     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01763}01763       \mbox{\hyperlink{classoomph_1_1LinearSolver_ad61c63af94c5961830bd9807225a48d6}{LinearSolver::disable\_resolve}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01764}01764       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01765}01765     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01766}01766 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01767}01767 \textcolor{comment}{    /// Implementation of the pure virtual base class function. The}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01768}01768 \textcolor{comment}{    /// function has been broken because this is meant to be used as a linear}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01769}01769 \textcolor{comment}{    /// solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01770}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a6050720b0d12f422e4b2983378dc53e5}{01770}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a6050720b0d12f422e4b2983378dc53e5}{preconditioner\_solve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& r, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& z)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01771}01771     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01772}01772       \textcolor{comment}{// Open an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01773}01773       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01774}01774 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01775}01775       \textcolor{comment}{// Create an error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01776}01776       error\_message\_stream << \textcolor{stringliteral}{"{}Preconditioner\_solve(...) is broken. "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01777}01777                            << \textcolor{stringliteral}{"{}HelmholtzGMRESMG is only meant to be used as "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01778}01778                            << \textcolor{stringliteral}{"{}a linear solver.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01779}01779 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01780}01780       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01781}01781       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01782}01782                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01783}01783                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01784}01784     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01785}01785 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01786}01786 \textcolor{comment}{    /// Implementation of the pure virtual base class function. This}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01787}01787 \textcolor{comment}{    /// accompanies the preconditioner\_solve function and so is also broken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01788}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ae566e34da6aa9ca70a034f7ef93a1aa5}{01788}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ae566e34da6aa9ca70a034f7ef93a1aa5}{setup}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01789}01789     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01790}01790       \textcolor{comment}{// Open an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01791}01791       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01792}01792 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01793}01793       \textcolor{comment}{// Create an error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01794}01794       error\_message\_stream << \textcolor{stringliteral}{"{}This function is broken. HelmholtzGMRESMG is "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01795}01795                            << \textcolor{stringliteral}{"{}only meant to be used as a linear solver.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01796}01796 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01797}01797       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01798}01798       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01799}01799                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01800}01800                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01801}01801     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01802}01802 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01803}01803 \textcolor{comment}{    /// Solver: Takes pointer to problem and returns the results vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01804}01804 \textcolor{comment}{    /// which contains the solution of the linear system defined by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01805}01805 \textcolor{comment}{    /// the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01806}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5806236b991ac2d7fe4bc7a4f19e98fb}{01806}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5806236b991ac2d7fe4bc7a4f19e98fb}{solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01807}01807     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01808}01808 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01809}01809       \textcolor{comment}{// Make sure that this is running in serial. Can't guarantee it'll}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01810}01810       \textcolor{comment}{// work when the problem is distributed over several processors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01811}01811       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1MPI__Helpers_ac16964b22bfd4f657490802beb600ffe}{MPI\_Helpers::communicator\_pt}}()-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01812}01812       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01813}01813         \textcolor{comment}{// Throw a warning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01814}01814         \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(\textcolor{stringliteral}{"{}Can't guarantee the MG solver will work in parallel!"{}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01815}01815                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01816}01816                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01817}01817       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01818}01818 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01819}01819 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01820}01820       \textcolor{comment}{// Find \# of degrees of freedom (variables)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01821}01821       \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01822}01822 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01823}01823       \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01824}01824       \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01825}01825 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01826}01826       \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01827}01827       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_acb64519b62c16bbec32d01c9969f746f}{Resolving}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01828}01828 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01829}01829       \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01830}01830       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01831}01831 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01832}01832       \textcolor{comment}{// Grab the communicator from the MGProblem object and assign it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01833}01833       this-\/>\mbox{\hyperlink{classoomph_1_1Preconditioner_a306f5a52f493816fcfda2dc9b2ee1dbf}{set\_comm\_pt}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01834}01834 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01835}01835       \textcolor{comment}{// Setup the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01836}01836       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01837}01837         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01838}01838 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01839}01839       \textcolor{comment}{// Build the internal distribution in this way because both the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01840}01840       \textcolor{comment}{// IterativeLinearSolver and BlockPreconditioner class have base-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01841}01841       \textcolor{comment}{// class subobjects of type oomph::DistributableLinearAlgebraObject}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01842}01842       \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{IterativeLinearSolver::build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01843}01843 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01844}01844       \textcolor{comment}{// Get Jacobian matrix in format specified by template parameter}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01845}01845       \textcolor{comment}{// and nonlinear residual vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01846}01846       MATRIX* \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}} = \textcolor{keyword}{new} MATRIX;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01847}01847       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01848}01848       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01849}01849       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01850}01850         \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01851}01851         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01852}01852           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}})-\/>build(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01853}01853             \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01854}01854           f.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01855}01855         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01856}01856       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01857}01857 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01858}01858       \textcolor{comment}{// Get the Jacobian and residuals vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01859}01859       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}});}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01860}01860 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01861}01861       \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01862}01862       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a1550b5147f7fa822e8cbc9de93f1c06f}{Matrix\_can\_be\_deleted}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01863}01863 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01864}01864       \textcolor{comment}{// Replace the current matrix used in Preconditioner by the new matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01865}01865       this-\/>\mbox{\hyperlink{classoomph_1_1Preconditioner_af459b7333c4c64435fd8fa933535901f}{set\_matrix\_pt}}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01866}01866 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01867}01867       \textcolor{comment}{// The preconditioner works with one mesh; set it! Since we only use}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01868}01868       \textcolor{comment}{// the block preconditioner on the finest level, we use the mesh from}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01869}01869       \textcolor{comment}{// that level}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01870}01870       this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ae055f998f6145656352aacac22e545ad}{set\_nmesh}}(1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01871}01871 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01872}01872       \textcolor{comment}{// Elements in actual pml layer are trivially wrapped versions of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01873}01873       \textcolor{comment}{// their bulk counterparts. Technically they are different elements}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01874}01874       \textcolor{comment}{// so we have to allow different element types}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01875}01875       \textcolor{keywordtype}{bool} allow\_different\_element\_types\_in\_mesh = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01876}01876       this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af97821621b570d409e6662939e5f818d}{set\_mesh}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01877}01877         0, problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(), allow\_different\_element\_types\_in\_mesh);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01878}01878 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01879}01879       \textcolor{comment}{// Set up the generic block look up scheme}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01880}01880       this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af704c4816469cef4fed9d35a9ad651ec}{block\_setup}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01881}01881 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01882}01882       \textcolor{comment}{// Extract the number of blocks.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01883}01883       \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a80808d42be8db74fd58af80b019bf317}{nblock\_types}} = this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a80808d42be8db74fd58af80b019bf317}{nblock\_types}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01884}01884 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01885}01885 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01886}01886       \textcolor{comment}{// PARANOID check -\/ there must only be two block types}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01887}01887       \textcolor{keywordflow}{if} (nblock\_types != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01888}01888       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01889}01889         \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01890}01890         std::stringstream tmp;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01891}01891         tmp << \textcolor{stringliteral}{"{}There are supposed to be two block types.\(\backslash\)nYours has "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01892}01892             << \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a80808d42be8db74fd58af80b019bf317}{nblock\_types}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01893}01893 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01894}01894         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01895}01895         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01896}01896           tmp.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01897}01897       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01898}01898 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01899}01899 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01900}01900       \textcolor{comment}{// Resize the storage for the system matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01901}01901       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}.resize(2, 0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01902}01902 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01903}01903       \textcolor{comment}{// Loop over the rows of the block matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01904}01904       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a80808d42be8db74fd58af80b019bf317}{nblock\_types}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01905}01905       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01906}01906         \textcolor{comment}{// Fix the column index}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01907}01907         \textcolor{keywordtype}{unsigned} j = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01908}01908 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01909}01909         \textcolor{comment}{// Create new CRDoubleMatrix objects}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01910}01910         \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01911}01911 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01912}01912         \textcolor{comment}{// Extract the required blocks, i.e. the first column}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01913}01913         this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a72b4dbe167da59d9ba12c7eff97d77e6}{get\_block}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j, *\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01914}01914       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01915}01915 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01916}01916       \textcolor{comment}{// Doc time for setup}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01917}01917       \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01918}01918       \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a82a12e45c78e910b46e9d0935beb8f0d}{Jacobian\_setup\_time}} = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01919}01919 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01920}01920       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01921}01921       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01922}01922         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nTime for setup of block Jacobian [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01923}01923                    << \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a82a12e45c78e910b46e9d0935beb8f0d}{Jacobian\_setup\_time}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01924}01924       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01925}01925 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01926}01926       \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01927}01927       \textcolor{comment}{// If the result distribution is wrong, then redistribute}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01928}01928       \textcolor{comment}{// before the solve and return to original distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01929}01929       \textcolor{comment}{// afterwards}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01930}01930       \textcolor{keywordflow}{if} ((!(*result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() ==}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01931}01931              *\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}())) \&\&}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01932}01932           (result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01933}01933       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01934}01934         \textcolor{comment}{// Make a distribution object}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01935}01935         \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} temp\_global\_dist(result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01936}01936 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01937}01937         \textcolor{comment}{// Build the result vector distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01938}01938         result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01939}01939 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01940}01940         \textcolor{comment}{// Solve the problem}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01941}01941         \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a3147aa77b5e71a0822cc5c661dd07e0d}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}, f, result);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01942}01942 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01943}01943         \textcolor{comment}{// Redistribute the vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01944}01944         result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&temp\_global\_dist);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01945}01945       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01946}01946       \textcolor{comment}{// Otherwise just solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01947}01947       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01948}01948       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01949}01949         \textcolor{comment}{// Solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01950}01950         \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a3147aa77b5e71a0822cc5c661dd07e0d}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}, f, result);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01951}01951       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01952}01952 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01953}01953       \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01954}01954       \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}})}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01955}01955       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01956}01956         \textcolor{comment}{// Clean up anything left in memory}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01957}01957         \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01958}01958       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01959}01959     \} \textcolor{comment}{// End of solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01960}01960 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01961}01961 \textcolor{comment}{    /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and rhs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01962}01962 \textcolor{comment}{    /// vector and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01963}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a3e6405af2506c7b789ba3208d0a9cf6d}{01963}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a3e6405af2506c7b789ba3208d0a9cf6d}{solve}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01964}01964                \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01965}01965                \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01966}01966     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01967}01967       \textcolor{comment}{// Open an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01968}01968       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01969}01969 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01970}01970       \textcolor{comment}{// Create an error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01971}01971       error\_message\_stream}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01972}01972         << \textcolor{stringliteral}{"{}This function is broken. The block preconditioner "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01973}01973         << \textcolor{stringliteral}{"{}needs access to the underlying mesh.\(\backslash\)n"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01974}01974 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01975}01975       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01976}01976       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01977}01977                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01978}01978                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01979}01979     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01980}01980 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01981}01981 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01982}01982 \textcolor{comment}{    /// Linear-\/algebra-\/type solver: Takes pointer to a matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01983}01983 \textcolor{comment}{    /// and rhs vector and returns the solution of the linear system}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01984}01984 \textcolor{comment}{    /// Call the broken base-\/class version. If you want this, please}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01985}01985 \textcolor{comment}{    /// implement it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01986}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a14ba0370fbc782fa7ab9364a035a7513}{01986}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a14ba0370fbc782fa7ab9364a035a7513}{solve}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01987}01987                \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01988}01988                \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& result)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01989}01989     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01990}01990       \mbox{\hyperlink{classoomph_1_1LinearSolver_a15ce22542b74ed1826ea485edacbeb6e}{LinearSolver::solve}}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}, rhs, result);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01991}01991     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01992}01992 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01993}01993 \textcolor{comment}{    /// Re-\/solve the system defined by the last assembled Jacobian}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01994}01994 \textcolor{comment}{    /// and the rhs vector specified here. Solution is returned in the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01995}01995 \textcolor{comment}{    /// vector result.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01996}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ad6937ea7f72719eb9e33c28c002fa380}{01996}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ad6937ea7f72719eb9e33c28c002fa380}{resolve}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01997}01997     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01998}01998       \textcolor{comment}{// We are re-\/solving}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l01999}01999       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_acb64519b62c16bbec32d01c9969f746f}{Resolving}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02000}02000 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02001}02001 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02002}02002       \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[0] == 0) || (\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[1] == 0))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02003}02003       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02004}02004         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(\textcolor{stringliteral}{"{}No matrix was stored -\/-\/ cannot re-\/solve"{}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02005}02005                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02006}02006                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02007}02007       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02008}02008 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02009}02009 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02010}02010       \textcolor{comment}{// Set up a dummy matrix. As we're resolving this won't be used in}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02011}02011       \textcolor{comment}{// solve\_helper but we need to pass a matrix in to fill the input.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02012}02012       \textcolor{comment}{// The matrices used in the calculations have already been stored}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02013}02013       \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}* \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}} = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02014}02014 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02015}02015       \textcolor{comment}{// Call the helper function}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02016}02016       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a3147aa77b5e71a0822cc5c661dd07e0d}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}, rhs, result);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02017}02017 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02018}02018       \textcolor{comment}{// Delete the matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02019}02019       \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02020}02020 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02021}02021       \textcolor{comment}{// Make it a null pointer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02022}02022       \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}} = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02023}02023 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02024}02024       \textcolor{comment}{// Reset re-\/solving flag}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02025}02025       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_acb64519b62c16bbec32d01c9969f746f}{Resolving}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02026}02026     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02027}02027 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02028}02028 \textcolor{comment}{    /// Number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02029}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ad2ae5c641eae7da8c7556b646fe38d36}{02029}} \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ad2ae5c641eae7da8c7556b646fe38d36}{iterations}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02030}02030 \textcolor{keyword}{    }\{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02031}02031       \textcolor{keywordflow}{return} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ae2a4718545bd42acb57aba5baa23d52f}{Iterations}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02032}02032     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02033}02033 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02034}02034 \textcolor{comment}{    /// Set left preconditioning (the default)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02035}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a86f6bd77359a37117aeb17798b886a81}{02035}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a86f6bd77359a37117aeb17798b886a81}{set\_preconditioner\_LHS}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02036}02036     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02037}02037       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7f151e92397721fc2ae6acdd8253d685}{Preconditioner\_LHS}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02038}02038     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02039}02039 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02040}02040 \textcolor{comment}{    /// Enable right preconditioning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02041}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ab10551b0e67b40ad91555b1e612208a2}{02041}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ab10551b0e67b40ad91555b1e612208a2}{set\_preconditioner\_RHS}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02042}02042     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02043}02043       \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7f151e92397721fc2ae6acdd8253d685}{Preconditioner\_LHS}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02044}02044     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02045}02045 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02046}02046   \textcolor{keyword}{protected}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02047}02047 \textcolor{comment}{    /// General interface to solve function}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02048}02048 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a3147aa77b5e71a0822cc5c661dd07e0d}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02049}02049                       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02050}02050                       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02051}02051 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02052}02052 \textcolor{comment}{    /// Cleanup data that's stored for resolve (if any has been stored)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02053}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{02053}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{clean\_up\_memory}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02054}02054     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02055}02055       \textcolor{comment}{// If the matrix storage has been resized}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02056}02056       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}.size() > 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02057}02057       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02058}02058         \textcolor{comment}{// If the real matrix pointer isn't null AND we're allowed to delete}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02059}02059         \textcolor{comment}{// the matrix which is only when we create the matrix ourselves}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02060}02060         \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[0] != 0) \&\& (\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a1550b5147f7fa822e8cbc9de93f1c06f}{Matrix\_can\_be\_deleted}}))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02061}02061         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02062}02062           \textcolor{comment}{// Delete the matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02063}02063           \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[0];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02064}02064 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02065}02065           \textcolor{comment}{// Assign the associated pointer the value NULL}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02066}02066           \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[0] = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02067}02067         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02068}02068 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02069}02069         \textcolor{comment}{// If the real matrix pointer isn't null AND we're allowed to delete}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02070}02070         \textcolor{comment}{// the matrix which is only when we create the matrix ourselves}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02071}02071         \textcolor{keywordflow}{if} ((\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[1] != 0) \&\& (\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a1550b5147f7fa822e8cbc9de93f1c06f}{Matrix\_can\_be\_deleted}}))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02072}02072         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02073}02073           \textcolor{comment}{// Delete the matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02074}02074           \textcolor{keyword}{delete} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[1];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02075}02075 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02076}02076           \textcolor{comment}{// Assign the associated pointer the value NULL}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02077}02077           \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[1] = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02078}02078         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02079}02079       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02080}02080     \} \textcolor{comment}{// End of clean\_up\_memory}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02081}02081 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02082}02082 \textcolor{comment}{    /// Helper function to calculate a complex matrix-\/vector product.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02083}02083 \textcolor{comment}{    /// Assumes the matrix has been provided as a Vector of length two; the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02084}02084 \textcolor{comment}{    /// first entry containing the real part of the system matrix and the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02085}02085 \textcolor{comment}{    /// second entry containing the imaginary part}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02086}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_aa94abd65000a9fac33a29a1ae2f9ec73}{02086}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_aa94abd65000a9fac33a29a1ae2f9ec73}{complex\_matrix\_multiplication}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02087}02087       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<CRDoubleMatrix*>}} \textcolor{keyword}{const} matrices\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02088}02088       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& x,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02089}02089       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& soln)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02090}02090     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02091}02091 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02092}02092       \textcolor{comment}{// PARANOID check -\/ Make sure the input matrix has the right size}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02093}02093       \textcolor{keywordflow}{if} (matrices\_pt.size() != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02094}02094       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02095}02095         \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02096}02096         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02097}02097 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02098}02098         \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02099}02099         error\_message\_stream << \textcolor{stringliteral}{"{}Can only deal with two matrices. You have "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02100}02100                              << matrices\_pt.size() << \textcolor{stringliteral}{"{} matrices."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02101}02101 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02102}02102         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02103}02103         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02104}02104                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02105}02105                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02106}02106       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02107}02107       \textcolor{comment}{// PARANOID check -\/ Make sure the vector x has the right size}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02108}02108       \textcolor{keywordflow}{if} (x.size() != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02109}02109       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02110}02110         \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02111}02111         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02112}02112 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02113}02113         \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02114}02114         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02115}02115           << \textcolor{stringliteral}{"{}Can only deal with two input vectors. You have "{}} << x.size()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02116}02116           << \textcolor{stringliteral}{"{} vectors."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02117}02117 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02118}02118         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02119}02119         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02120}02120                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02121}02121                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02122}02122       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02123}02123       \textcolor{comment}{// PARANOID check -\/ Make sure the vector soln has the right size}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02124}02124       \textcolor{keywordflow}{if} (soln.size() != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02125}02125       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02126}02126         \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02127}02127         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02128}02128 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02129}02129         \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02130}02130         error\_message\_stream}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02131}02131           << \textcolor{stringliteral}{"{}Can only deal with two output vectors. You have "{}} << soln.size()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02132}02132           << \textcolor{stringliteral}{"{} output vectors."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02133}02133 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02134}02134         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02135}02135         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02136}02136                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02137}02137                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02138}02138       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02139}02139 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02140}02140 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02141}02141       \textcolor{comment}{// NOTE: We assume all vectors have been distributed at this point but}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02142}02142       \textcolor{comment}{// code can be written at a later time to build the vectors if they're}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02143}02143       \textcolor{comment}{// not already built.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02144}02144 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02145}02145       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02146}02146       \textcolor{comment}{// Suppose we have a complex matrix, A, and two complex vectors, x and}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02147}02147       \textcolor{comment}{// soln. We wish to compute the product A*x=soln (note, * does not mean}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02148}02148       \textcolor{comment}{// we are using complex conjugates here, it is simply used to indicate}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02149}02149       \textcolor{comment}{// a multiplication). To do this we must make use of the fact that we}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02150}02150       \textcolor{comment}{// possess the real and imaginary separately. As a result, it is computed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02151}02151       \textcolor{comment}{// using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02152}02152       \textcolor{comment}{//           soln = A*x,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02153}02153       \textcolor{comment}{//                = (A\_r + i*A\_c)*(x\_r + i*x\_c),}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02154}02154       \textcolor{comment}{//                = [A\_r*x\_r -\/ A\_c*x\_c] + i*[A\_r*x\_c + A\_c*x\_r],}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02155}02155       \textcolor{comment}{// ==> real(soln) = A\_r*x\_r -\/ A\_c*x\_c,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02156}02156       \textcolor{comment}{//   \& imag(soln) = A\_r*x\_c + A\_c*x\_r,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02157}02157       \textcolor{comment}{// where the subscripts \_r and \_c are used to identify the real and}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02158}02158       \textcolor{comment}{// imaginary part, respectively.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02159}02159       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02160}02160 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02161}02161       \textcolor{comment}{// Store the value of A\_r*x\_r in the real part of soln}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02162}02162       matrices\_pt[0]-\/>multiply(x[0], soln[0]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02163}02163 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02164}02164       \textcolor{comment}{// Store the value of A\_r*x\_c in the imaginary part of soln}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02165}02165       matrices\_pt[0]-\/>multiply(x[1], soln[1]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02166}02166 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02167}02167       \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02168}02168       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[0]-\/>\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02169}02169 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02170}02170       \textcolor{comment}{// Calculate the value of A\_c*x\_c}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02171}02171       matrices\_pt[1]-\/>multiply(x[1], temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02172}02172 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02173}02173       \textcolor{comment}{// Subtract the value of temp from soln[0] to get the real part of soln}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02174}02174       soln[0] -\/= temp;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02175}02175 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02176}02176       \textcolor{comment}{// Calculate the value of A\_c*x\_r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02177}02177       matrices\_pt[1]-\/>multiply(x[0], temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02178}02178 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02179}02179       \textcolor{comment}{// Add the value of temp to soln[1] to get the imaginary part of soln}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02180}02180       soln[1] += temp;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02181}02181     \} \textcolor{comment}{// End of complex\_matrix\_multiplication}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02182}02182 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02183}02183 \textcolor{comment}{    /// Helper function to update the result vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02184}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ac08841fffc51bceb21122cd66988329b}{02184}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ac08841fffc51bceb21122cd66988329b}{update}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& k,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02185}02185                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>>\& hessenberg,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02186}02186                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02187}02187                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}>\& v,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02188}02188                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& x)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02189}02189     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02190}02190       \textcolor{comment}{// Make a local copy of s}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02191}02191       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> y(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02192}02192 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02193}02193       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02194}02194       \textcolor{comment}{// The Hessenberg matrix should be an upper triangular matrix at}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02195}02195       \textcolor{comment}{// this point (although from its storage it would appear to be a}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02196}02196       \textcolor{comment}{// lower triangular matrix since the indexing has been reversed)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02197}02197       \textcolor{comment}{// so finding the minimiser of J(y)=min||s-\/R\_m*y|| where R\_m is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02198}02198       \textcolor{comment}{// the matrix R in the QR factorisation of the Hessenberg matrix.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02199}02199       \textcolor{comment}{// Therefore, to obtain y we simply need to use a backwards}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02200}02200       \textcolor{comment}{// substitution. Note: The implementation here may appear to be}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02201}02201       \textcolor{comment}{// somewhat confusing as the indexing in the Hessenberg matrix is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02202}02202       \textcolor{comment}{// reversed. This implementation of a backwards substitution does}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02203}02203       \textcolor{comment}{// not run along the columns of the triangular matrix but rather}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02204}02204       \textcolor{comment}{// up the rows.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02205}02205       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02206}02206 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02207}02207       \textcolor{comment}{// The outer loop is a loop over the columns of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02208}02208       \textcolor{comment}{// since the indexing is reversed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02209}02209       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = \textcolor{keywordtype}{int}(k); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} >= 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}-\/-\/)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02210}02210       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02211}02211         \textcolor{comment}{// Divide the i-\/th entry of y by the i-\/th diagonal entry of H}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02212}02212         y[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] /= hessenberg[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02213}02213 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02214}02214         \textcolor{comment}{// The inner loop is a loop over the rows of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02215}02215         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} -\/ 1; j >= 0; j-\/-\/)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02216}02216         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02217}02217           \textcolor{comment}{// Update the j-\/th entry of y}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02218}02218           y[j] -\/= hessenberg[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][j] * y[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02219}02219         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02220}02220       \} \textcolor{comment}{// for (int i=int(k);i>=0;i-\/-\/)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02221}02221 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02222}02222       \textcolor{comment}{// Calculate the number of entries in x (simply use the real part as}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02223}02223       \textcolor{comment}{// both the real and imaginary part should have the same length)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02224}02224       \textcolor{keywordtype}{unsigned} n\_row = x[0].nrow();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02225}02225 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02226}02226       \textcolor{comment}{// Build a temporary vector with entries initialised to 0.0}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02227}02227       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_z(2);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02228}02228 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02229}02229       \textcolor{comment}{// Build a temporary vector with entries initialised to 0.0}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02230}02230       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_temp(2);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02231}02231 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02232}02232       \textcolor{comment}{// Build the distributions}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02233}02233       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < 2; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02234}02234       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02235}02235         \textcolor{comment}{// Build the (dof\_type)-\/th vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02236}02236         block\_z[dof\_type].build(x[0].\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02237}02237 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02238}02238         \textcolor{comment}{// Build the (dof\_type)-\/th vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02239}02239         block\_temp[dof\_type].build(x[0].\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02240}02240       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02241}02241 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02242}02242       \textcolor{comment}{// Get access to the underlying values}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02243}02243       \textcolor{keywordtype}{double}* block\_temp\_r\_pt = block\_temp[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02244}02244 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02245}02245       \textcolor{comment}{// Get access to the underlying values}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02246}02246       \textcolor{keywordtype}{double}* block\_temp\_c\_pt = block\_temp[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02247}02247 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02248}02248       \textcolor{comment}{// Calculate x=Vy}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02249}02249       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j <= k; j++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02250}02250       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02251}02251         \textcolor{comment}{// Get access to j-\/th column of Z\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02252}02252         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* vj\_r\_pt = v[j][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02253}02253 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02254}02254         \textcolor{comment}{// Get access to j-\/th column of Z\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02255}02255         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* vj\_c\_pt = v[j][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02256}02256 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02257}02257         \textcolor{comment}{// Loop over the entries in x and update them}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02258}02258         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02259}02259         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02260}02260           \textcolor{comment}{// Update the real part of the i-\/th entry in x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02261}02261           block\_temp\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02262}02262             (vj\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].real()) -\/ (vj\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].imag());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02263}02263 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02264}02264           \textcolor{comment}{// Update the imaginary part of the i-\/th entry in x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02265}02265           block\_temp\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02266}02266             (vj\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].real()) + (vj\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].imag());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02267}02267         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02268}02268       \} \textcolor{comment}{// for (unsigned j=0;j<=k;j++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02269}02269 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02270}02270       \textcolor{comment}{// If we're using LHS preconditioning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02271}02271       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7f151e92397721fc2ae6acdd8253d685}{Preconditioner\_LHS}})}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02272}02272       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02273}02273         \textcolor{comment}{// Since we're using LHS preconditioning the preconditioner is applied}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02274}02274         \textcolor{comment}{// to the matrix and RHS vector so we simply update the value of x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02275}02275         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < 2; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02276}02276         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02277}02277           \textcolor{comment}{// Update}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02278}02278           x[dof\_type] += block\_temp[dof\_type];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02279}02279         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02280}02280       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02281}02281       \textcolor{comment}{// If we're using RHS preconditioning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02282}02282       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02283}02283       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02284}02284         \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02285}02285         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02286}02286 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02287}02287         \textcolor{comment}{// Copy block vectors block\_temp back to temp}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02288}02288         this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a71d48d8a70151ef0febd4537a2214c53}{return\_block\_vectors}}(block\_temp, temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02289}02289 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02290}02290         \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02291}02291         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} z(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02292}02292 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02293}02293         \textcolor{comment}{// Copy block vectors block\_z back to z}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02294}02294         this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a71d48d8a70151ef0febd4537a2214c53}{return\_block\_vectors}}(block\_z, z);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02295}02295 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02296}02296         \textcolor{comment}{// Since we're using RHS preconditioning the preconditioner is applied}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02297}02297         \textcolor{comment}{// to the solution vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02298}02298         \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_ad4ae617ce8304f17bd42f4dc39813e22}{preconditioner\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Preconditioner_ace1199369e4465cd2b9a34884bb64ec8}{preconditioner\_solve}}(temp, z);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02299}02299 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02300}02300         \textcolor{comment}{// Split up the solution vector into DoubleVectors, whose entries are}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02301}02301         \textcolor{comment}{// arranged to match the matrix blocks and assign it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02302}02302         this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ad356946d5de4f0817cdf8793fa3cdc74}{get\_block\_vectors}}(z, block\_z);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02303}02303 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02304}02304         \textcolor{comment}{// Use the update: x\_m=x\_0+inv(M)Vy [see Saad Y,"{}Iterative methods for}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02305}02305         \textcolor{comment}{// sparse linear systems"{}, p.284]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02306}02306         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < 2; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02307}02307         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02308}02308           \textcolor{comment}{// Update}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02309}02309           x[dof\_type] += block\_z[dof\_type];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02310}02310         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02311}02311       \} \textcolor{comment}{// if(Preconditioner\_LHS) else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02312}02312     \} \textcolor{comment}{// End of update}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02313}02313 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02314}02314 \textcolor{comment}{    /// Helper function: Generate a plane rotation. This is done by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02315}02315 \textcolor{comment}{    /// finding the value of \(\backslash\)f\$ \(\backslash\)cos(\(\backslash\)theta) \(\backslash\)f\$ (i.e. cs) and the value of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02316}02316 \textcolor{comment}{    /// \(\backslash\)f\$ \(\backslash\)sin(\(\backslash\)theta) \(\backslash\)f\$ (i.e. sn) such that:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02317}02317 \textcolor{comment}{    /// \(\backslash\)f[ \(\backslash\)begin\{bmatrix\} \(\backslash\)overline\{\(\backslash\)cos\(\backslash\)theta\} \& \(\backslash\)overline\{\(\backslash\)sin\(\backslash\)theta\} \(\backslash\)\(\backslash\) -\/\(\backslash\)sin\(\backslash\)theta \& \(\backslash\)cos\(\backslash\)theta \(\backslash\)end\{bmatrix\} \(\backslash\)begin\{bmatrix\} dx \(\backslash\)\(\backslash\) dy \(\backslash\)end\{bmatrix\} = \(\backslash\)begin\{bmatrix\} r \(\backslash\)\(\backslash\) 0 \(\backslash\)end\{bmatrix\}, \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02318}02318 \textcolor{comment}{    /// where \(\backslash\)f\$ r=\(\backslash\)sqrt\{pow(|dx|,2)+pow(|dy|,2)\} \(\backslash\)f\$. The values of a and b}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02319}02319 \textcolor{comment}{    /// are given by:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02320}02320 \textcolor{comment}{    /// The values of dx and dy are given by:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02321}02321 \textcolor{comment}{    /// \(\backslash\)f[ \(\backslash\)cos\(\backslash\)theta\&=\(\backslash\)dfrac\{dx\}\{\(\backslash\)sqrt\{|dx|\string^2+|dy|\string^2\}\}, \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02322}02322 \textcolor{comment}{    /// and}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02323}02323 \textcolor{comment}{    /// \(\backslash\)f[ \(\backslash\)sin\(\backslash\)theta\&=\(\backslash\)dfrac\{dy\}\{\(\backslash\)sqrt\{|dx|\string^2+|dy|\string^2\}\}. \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02324}02324 \textcolor{comment}{    /// Taken from: Saad Y."{}Iterative methods for sparse linear systems"{}, p.193.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02325}02325 \textcolor{comment}{    /// We also check to see that sn is always a real (nonnegative) number. See}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02326}02326 \textcolor{comment}{    /// pp.193-\/194 for an explanation.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02327}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_afc666c19cb09f252e63e43c3e126fb9a}{02327}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_afc666c19cb09f252e63e43c3e126fb9a}{generate\_plane\_rotation}}(std::complex<double>\& dx,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02328}02328                                  std::complex<double>\& dy,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02329}02329                                  std::complex<double>\& cs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02330}02330                                  std::complex<double>\& sn)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02331}02331     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02332}02332       \textcolor{comment}{// If dy=0 then we do not need to apply a rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02333}02333       \textcolor{keywordflow}{if} (dy == 0.0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02334}02334       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02335}02335         \textcolor{comment}{// Using theta=0 gives cos(theta)=1}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02336}02336         cs = 1.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02337}02337 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02338}02338         \textcolor{comment}{// Using theta=0 gives sin(theta)=0}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02339}02339         sn = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02340}02340       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02341}02341       \textcolor{comment}{// If dx or dy is large using the original form of calculting cs and sn is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02342}02342       \textcolor{comment}{// naive since this may overflow or underflow so instead we calculate}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02343}02343       \textcolor{comment}{// r=sqrt(pow(|dx|,2)+pow(|dy|,2)) using r=|dy|sqrt(1+pow(|dx|/|dy|,2)) if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02344}02344       \textcolor{comment}{// |dy|>|dx| [see <A}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02345}02345       \textcolor{comment}{// HREF=https://en.wikipedia.org/wiki/Hypot"{}>Hypot</A>.].}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02346}02346       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (std::abs(dy) > std::abs(dx))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02347}02347       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02348}02348         \textcolor{comment}{// Since |dy|>|dx| calculate the ratio |dx|/|dy|}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02349}02349         std::complex<double> temp = dx / dy;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02350}02350 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02351}02351         \textcolor{comment}{// Calculate the value of sin(theta) using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02352}02352         \textcolor{comment}{//          sin(theta)=dy/sqrt(pow(|dx|,2)+pow(|dy|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02353}02353         \textcolor{comment}{//                    =(dy/|dy|)/sqrt(1+pow(|dx|/|dy|,2)).}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02354}02354         sn = (dy / std::abs(dy)) / sqrt(1.0 + pow(std::abs(temp), 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02355}02355 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02356}02356         \textcolor{comment}{// Calculate the value of cos(theta) using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02357}02357         \textcolor{comment}{//            cos(theta)=dx/sqrt(pow(|dy|,2)+pow(|dx|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02358}02358         \textcolor{comment}{//                      =(dx/|dy|)/sqrt(1+pow(|dx|/|dy|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02359}02359         \textcolor{comment}{//                      =(dx/dy)*sin(theta).}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02360}02360         cs = temp * sn;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02361}02361       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02362}02362       \textcolor{comment}{// Otherwise, we have |dx|>=|dy| so to, again, avoid overflow or underflow}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02363}02363       \textcolor{comment}{// calculate the values of cs and sn using the method above}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02364}02364       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02365}02365       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02366}02366         \textcolor{comment}{// Since |dx|>=|dy| calculate the ratio dy/dx}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02367}02367         std::complex<double> temp = dy / dx;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02368}02368 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02369}02369         \textcolor{comment}{// Calculate the value of cos(theta) using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02370}02370         \textcolor{comment}{//          cos(theta)=dx/sqrt(pow(|dx|,2)+pow(|dy|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02371}02371         \textcolor{comment}{//                    =(dx/|dx|)/sqrt(1+pow(|dy|/|dx|,2)).}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02372}02372         cs = (dx / std::abs(dx)) / sqrt(1.0 + pow(std::abs(temp), 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02373}02373 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02374}02374         \textcolor{comment}{// Calculate the value of sin(theta) using:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02375}02375         \textcolor{comment}{//            sin(theta)=dy/sqrt(pow(|dx|,2)+pow(|dy|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02376}02376         \textcolor{comment}{//                      =(dy/|dx|)/sqrt(1+pow(|dy|/|dx|,2))}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02377}02377         \textcolor{comment}{//                      =(dy/dx)*cos(theta).}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02378}02378         sn = temp * cs;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02379}02379       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02380}02380 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02381}02381       \textcolor{comment}{// Set the tolerance for sin(theta)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02382}02382       \textcolor{keywordtype}{double} \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a7be3c4ea16f1fc9b397e7c87eae253d8}{tolerance}} = 1.0e-\/15;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02383}02383 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02384}02384       \textcolor{comment}{// Make sure sn is real and nonnegative (it should be!)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02385}02385       \textcolor{keywordflow}{if} ((std::fabs(sn.imag()) > \mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a7be3c4ea16f1fc9b397e7c87eae253d8}{tolerance}}) || (sn.real() < 0))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02386}02386       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02387}02387         \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02388}02388         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02389}02389 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02390}02390         \textcolor{comment}{// Create an error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02391}02391         error\_message\_stream << \textcolor{stringliteral}{"{}The value of sin(theta) is not real "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02392}02392                              << \textcolor{stringliteral}{"{}and/or nonnegative. Value is: "{}} << sn}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02393}02393                              << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02394}02394 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02395}02395         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02396}02396         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02397}02397                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02398}02398                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02399}02399       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02400}02400     \} \textcolor{comment}{// End of generate\_plane\_rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02401}02401 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02402}02402 \textcolor{comment}{    /// Helper function: Apply plane rotation. This is done using the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02403}02403 \textcolor{comment}{    /// update:}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02404}02404 \textcolor{comment}{    /// \(\backslash\)f[ \(\backslash\)begin\{bmatrix\} dx \(\backslash\)\(\backslash\) dy \(\backslash\)end\{bmatrix\} \(\backslash\)leftarrow \(\backslash\)begin\{bmatrix\} \(\backslash\)overline\{\(\backslash\)cos\(\backslash\)theta\} \& \(\backslash\)overline\{\(\backslash\)sin\(\backslash\)theta\} \(\backslash\)\(\backslash\) -\/\(\backslash\)sin\(\backslash\)theta \& \(\backslash\)cos\(\backslash\)theta \(\backslash\)end\{bmatrix\} \(\backslash\)begin\{bmatrix\} dx \(\backslash\)\(\backslash\) dy \(\backslash\)end\{bmatrix\}. \(\backslash\)f]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02405}02405 \textcolor{comment}{    /// Taken from: Saad Y."{}Iterative methods for sparse linear systems"{}, p.193.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02406}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a6b9f8cacb73c1bcad749289aac649505}{02406}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a6b9f8cacb73c1bcad749289aac649505}{apply\_plane\_rotation}}(std::complex<double>\& dx,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02407}02407                               std::complex<double>\& dy,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02408}02408                               std::complex<double>\& cs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02409}02409                               std::complex<double>\& sn)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02410}02410     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02411}02411       \textcolor{comment}{// Calculate the value of dx but don't update it yet}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02412}02412       std::complex<double> temp = std::conj(cs) * dx + std::conj(sn) * dy;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02413}02413 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02414}02414       \textcolor{comment}{// Set the value of dy}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02415}02415       dy = -\/sn * dx + cs * dy;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02416}02416 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02417}02417       \textcolor{comment}{// Set the value of dx using the correct values of dx and dy}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02418}02418       dx = temp;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02419}02419     \} \textcolor{comment}{// End of apply\_plane\_rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02420}02420 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02421}02421 \textcolor{comment}{    /// Number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02422}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ae2a4718545bd42acb57aba5baa23d52f}{02422}} \textcolor{comment}{}    \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_ae2a4718545bd42acb57aba5baa23d52f}{Iterations}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02423}02423 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02424}02424 \textcolor{comment}{    /// Vector of pointers to the real and imaginary part of the system matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02425}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{02425}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1Vector}{Vector<CRDoubleMatrix*>}} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02426}02426 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02427}02427 \textcolor{comment}{    /// Boolean flag to indicate if the solve is done in re-\/solve mode,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02428}02428 \textcolor{comment}{    /// bypassing setup of matrix and preconditioner}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02429}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_acb64519b62c16bbec32d01c9969f746f}{02429}} \textcolor{comment}{}    \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_acb64519b62c16bbec32d01c9969f746f}{Resolving}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02430}02430 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02431}02431 \textcolor{comment}{    /// Boolean flag to indicate if the matrix pointed to be Matrix\_pt}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02432}02432 \textcolor{comment}{    /// can be deleted.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02433}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a1550b5147f7fa822e8cbc9de93f1c06f}{02433}} \textcolor{comment}{}    \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a1550b5147f7fa822e8cbc9de93f1c06f}{Matrix\_can\_be\_deleted}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02434}02434 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02435}02435 \textcolor{comment}{    /// boolean indicating use of left hand preconditioning (if true)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02436}02436 \textcolor{comment}{    /// or right hand preconditioning (if false)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02437}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7f151e92397721fc2ae6acdd8253d685}{02437}} \textcolor{comment}{}    \textcolor{keywordtype}{bool} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7f151e92397721fc2ae6acdd8253d685}{Preconditioner\_LHS}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02438}02438   \};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02439}02439 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02440}02440 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02441}02441 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02442}02442 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02443}02443 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02444}02444   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02445}02445 \textcolor{comment}{  /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and rhs vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02446}02446 \textcolor{comment}{  /// and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02447}02447 \textcolor{comment}{  /// based on the algorithm presented in Templates for the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02448}02448 \textcolor{comment}{  /// Solution of Linear Systems: Building Blocks for Iterative Methods,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02449}02449 \textcolor{comment}{  /// Barrett, Berry et al, SIAM, 2006 and the implementation in the IML++}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02450}02450 \textcolor{comment}{  /// library : http://math.nist.gov/iml++/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02451}02451 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02452}02452   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02453}\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a3147aa77b5e71a0822cc5c661dd07e0d}{02453}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a3147aa77b5e71a0822cc5c661dd07e0d}{HelmholtzGMRESMG<MATRIX>::solve\_helper}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02454}02454     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02455}02455     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02456}02456     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02457}02457   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02458}02458     \textcolor{comment}{// Set the number of dof types (real and imaginary for this solver)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02459}02459     \textcolor{keywordtype}{unsigned} n\_dof\_types = this-\/>ndof\_types();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02460}02460 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02461}02461 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02462}02462     \textcolor{comment}{// This only works for 2 dof types}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02463}02463     \textcolor{keywordflow}{if} (n\_dof\_types != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02464}02464     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02465}02465       \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02466}02466       std::stringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02467}02467 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02468}02468       \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02469}02469       error\_message\_stream << \textcolor{stringliteral}{"{}This preconditioner only works for problems "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02470}02470                            << \textcolor{stringliteral}{"{}with 2 dof types\(\backslash\)nYours has "{}} << n\_dof\_types;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02471}02471 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02472}02472       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02473}02473       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02474}02474                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02475}02475                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02476}02476     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02477}02477 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02478}02478 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02479}02479     \textcolor{comment}{// Get the number of dofs (note, the total number of dofs in the problem}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02480}02480     \textcolor{comment}{// is 2*n\_row but if the constituent vectors and matrices were stored in}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02481}02481     \textcolor{comment}{// complex objects there would only be (n\_row) rows so we use that)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02482}02482     \textcolor{keywordtype}{unsigned} n\_row = Matrices\_storage\_pt[0]-\/>nrow();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02483}02483 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02484}02484     \textcolor{comment}{// Make sure Max\_iter isn't greater than n\_dof. The user cannot use this}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02485}02485     \textcolor{comment}{// many iterations when using Krylov subspace methods}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02486}02486     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} > n\_row)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02487}02487     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02488}02488       \textcolor{comment}{// Create an output string stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02489}02489       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02490}02490 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02491}02491       \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02492}02492       error\_message\_stream << \textcolor{stringliteral}{"{}The maximum number of iterations cannot exceed "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02493}02493                            << \textcolor{stringliteral}{"{}the number of rows in the problem."{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02494}02494                            << \textcolor{stringliteral}{"{}\(\backslash\)nMaximum number of iterations: "{}} << \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02495}02495                            << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of rows: "{}} << n\_row << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02496}02496 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02497}02497       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02498}02498       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02499}02499                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02500}02500                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02501}02501     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02502}02502 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02503}02503 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02504}02504     \textcolor{comment}{// Loop over the real and imaginary parts}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02505}02505     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02506}02506     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02507}02507       \textcolor{comment}{// PARANOID check that if the matrix is distributable then it should not}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02508}02508       \textcolor{comment}{// be then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02509}02509       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02510}02510             Matrices\_storage\_pt[dof\_type]) != 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02511}02511       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02512}02512         \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02513}02513               Matrices\_storage\_pt[dof\_type])}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02514}02514               -\/>distributed())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02515}02515         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02516}02516           std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02517}02517           error\_message\_stream << \textcolor{stringliteral}{"{}The matrix must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02518}02518           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02519}02519                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02520}02520                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02521}02521         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02522}02522       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02523}02523     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02524}02524     \textcolor{comment}{// PARANOID check that this rhs distribution is setup}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02525}02525     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02526}02526     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02527}02527       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02528}02528       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector distribution must be setup."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02529}02529       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02530}02530                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02531}02531                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02532}02532     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02533}02533     \textcolor{comment}{// PARANOID check that the rhs has the right number of global rows}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02534}02534     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != 2 * n\_row)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02535}02535     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02536}02536       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02537}02537       error\_message\_stream << \textcolor{stringliteral}{"{}RHS does not have the same dimension as the"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02538}02538                            << \textcolor{stringliteral}{"{} linear system"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02539}02539       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02540}02540                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02541}02541                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02542}02542     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02543}02543     \textcolor{comment}{// PARANOID check that the rhs is not distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02544}02544     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02545}02545     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02546}02546       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02547}02547       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02548}02548       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02549}02549                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02550}02550                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02551}02551     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02552}02552     \textcolor{comment}{// PARANOID check that if the result is setup it matches the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02553}02553     \textcolor{comment}{// of the rhs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02554}02554     \textcolor{keywordflow}{if} (solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02555}02555     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02556}02556       \textcolor{keywordflow}{if} (!(*rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02557}02557       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02558}02558         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02559}02559         error\_message\_stream << \textcolor{stringliteral}{"{}If the result distribution is setup then it "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02560}02560                              << \textcolor{stringliteral}{"{}must be the same as the rhs distribution"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02561}02561         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02562}02562                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02563}02563                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02564}02564       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02565}02565     \} \textcolor{comment}{// if (solution[dof\_type].built())}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02566}02566 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02567}02567 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02568}02568     \textcolor{comment}{// Set up the solution distribution if it's not already distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02569}02569     \textcolor{keywordflow}{if} (!solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02570}02570     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02571}02571       \textcolor{comment}{// Build the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02572}02572       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02573}02573     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02574}02574     \textcolor{comment}{// Otherwise initialise all entries to zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02575}02575     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02576}02576     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02577}02577       \textcolor{comment}{// Initialise the entries in the k-\/th vector in solution to zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02578}02578       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02579}02579     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02580}02580 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02581}02581     \textcolor{comment}{// Create a vector of DoubleVectors (this is a distributed vector so we have}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02582}02582     \textcolor{comment}{// to create two separate DoubleVector objects to cope with the arithmetic)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02583}02583     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_solution(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02584}02584 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02585}02585     \textcolor{comment}{// Create a vector of DoubleVectors (this is a distributed vector so we have}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02586}02586     \textcolor{comment}{// to create two separate DoubleVector objects to cope with the arithmetic)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02587}02587     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_rhs(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02588}02588 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02589}02589     \textcolor{comment}{// Build the distribution of both vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02590}02590     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02591}02591     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02592}02592       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02593}02593       block\_solution[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02594}02594                                      0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02595}02595 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02596}02596       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02597}02597       block\_rhs[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02598}02598     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02599}02599 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02600}02600     \textcolor{comment}{// Grab the solution vector in block form}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02601}02601     this-\/>get\_block\_vectors(solution, block\_solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02602}02602 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02603}02603     \textcolor{comment}{// Grab the RHS vector in block form}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02604}02604     this-\/>get\_block\_vectors(rhs, block\_rhs);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02605}02605 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02606}02606     \textcolor{comment}{// Start the solver timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02607}02607     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02608}02608 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02609}02609     \textcolor{comment}{// Storage for the relative residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02610}02610     \textcolor{keywordtype}{double} resid;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02611}02611 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02612}02612     \textcolor{comment}{// Initialise vectors (since these are not distributed vectors we template}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02613}02613     \textcolor{comment}{// one vector by the type std::complex<double> instead of using two vectors,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02614}02614     \textcolor{comment}{// each templated by the type double}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02615}02615 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02616}02616     \textcolor{comment}{// Vector, s, used in the minimisation problem: J(y)=min||s-\/R\_m*y||}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02617}02617     \textcolor{comment}{// [see Saad Y."{}Iterative methods for sparse linear systems"{}, p.176.]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02618}02618     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02619}02619 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02620}02620     \textcolor{comment}{// Vector to store the value of cos(theta) when using the Givens rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02621}02621     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> cs(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02622}02622 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02623}02623     \textcolor{comment}{// Vector to store the value of sin(theta) when using the Givens rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02624}02624     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> sn(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02625}02625 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02626}02626     \textcolor{comment}{// Create a vector of DoubleVectors (this is a distributed vector so we have}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02627}02627     \textcolor{comment}{// to create two separate DoubleVector objects to cope with the arithmetic)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02628}02628     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_w(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02629}02629 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02630}02630     \textcolor{comment}{// Build the distribution of both vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02631}02631     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02632}02632     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02633}02633       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02634}02634       block\_w[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02635}02635     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02636}02636 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02637}02637     \textcolor{comment}{// Set up the preconditioner only if we're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02638}02638     \textcolor{keywordflow}{if} (!Resolving)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02639}02639     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02640}02640       \textcolor{comment}{// Only set up the preconditioner before solve if required}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02641}02641       \textcolor{keywordflow}{if} (Setup\_preconditioner\_before\_solve)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02642}02642       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02643}02643         \textcolor{comment}{// Set up the preconditioner from the Jacobian matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02644}02644         \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02645}02645 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02646}02646         \textcolor{comment}{// Use the setup function in the Preconditioner class}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02647}02647         preconditioner\_pt()-\/>setup(\textcolor{keyword}{dynamic\_cast<}MATRIX*\textcolor{keyword}{>}(matrix\_pt));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02648}02648 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02649}02649         \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02650}02650         \textcolor{keywordtype}{double} t\_end\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02651}02651         Preconditioner\_setup\_time = t\_end\_prec -\/ t\_start\_prec;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02652}02652 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02653}02653         \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02654}02654         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02655}02655         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02656}02656           \textcolor{comment}{// Output the time taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02657}02657           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of preconditioner [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02658}02658                      << Preconditioner\_setup\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02659}02659         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02660}02660       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02661}02661     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02662}02662     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02663}02663     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02664}02664       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02665}02665       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02666}02666       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02667}02667         \textcolor{comment}{// Notify the user}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02668}02668         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Setup of preconditioner is bypassed in resolve mode"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02669}02669                    << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02670}02670       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02671}02671     \} \textcolor{comment}{// if (!Resolving) else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02672}02672 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02673}02673     \textcolor{comment}{// Create a vector of DoubleVectors to store the RHS of b-\/Jx=Mr. We assume}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02674}02674     \textcolor{comment}{// both x=0 and that a preconditioner is not applied by which we deduce b=r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02675}02675     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_r(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02676}02676 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02677}02677     \textcolor{comment}{// Build the distribution of both vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02678}02678     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02679}02679     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02680}02680       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02681}02681       block\_r[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02682}02682     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02683}02683 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02684}02684     \textcolor{comment}{// If we're using LHS preconditioning solve b-\/Jx=Mr for r (assumes x=0)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02685}02685     \textcolor{comment}{// so calculate r=M\string^\{-\/1\}b otherwise set r=b (RHS prec.)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02686}02686     \textcolor{keywordflow}{if} (Preconditioner\_LHS)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02687}02687     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02688}02688       \textcolor{comment}{// Create a vector of the same size as rhs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02689}02689       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} r(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02690}02690 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02691}02691       \textcolor{comment}{// Copy the vectors in r to full\_r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02692}02692       this-\/>return\_block\_vectors(block\_r, r);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02693}02693 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02694}02694       \textcolor{comment}{// Use the preconditioner}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02695}02695       preconditioner\_pt()-\/>preconditioner\_solve(rhs, r);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02696}02696 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02697}02697       \textcolor{comment}{// Copy the vector full\_r into the vectors in r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02698}02698       this-\/>get\_block\_vectors(r, block\_r);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02699}02699     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02700}02700     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02701}02701     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02702}02702       \textcolor{comment}{// Store the value of b (the RHS vector) in r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02703}02703       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02704}02704       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02705}02705         \textcolor{comment}{// Copy the entries of rhs into r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02706}02706         block\_r[dof\_type] = block\_rhs[dof\_type];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02707}02707       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02708}02708     \} \textcolor{comment}{// if(Preconditioner\_LHS)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02709}02709 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02710}02710     \textcolor{comment}{// Calculate the norm of the real part of r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02711}02711     \textcolor{keywordtype}{double} norm\_r = block\_r[0].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02712}02712 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02713}02713     \textcolor{comment}{// Calculate the norm of the imaginary part of r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02714}02714     \textcolor{keywordtype}{double} norm\_c = block\_r[1].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02715}02715 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02716}02716     \textcolor{comment}{// Compute norm(r)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02717}02717     \textcolor{keywordtype}{double} normb = sqrt(pow(norm\_r, 2.0) + pow(norm\_c, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02718}02718 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02719}02719     \textcolor{comment}{// Set the value of beta (the initial residual)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02720}02720     \textcolor{keywordtype}{double} beta = normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02721}02721 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02722}02722     \textcolor{comment}{// Compute the initial relative residual. If the entries of the RHS vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02723}02723     \textcolor{comment}{// are all zero then set normb equal to one. This is because we divide the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02724}02724     \textcolor{comment}{// value of the norm at later stages by normb and dividing by zero is not}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02725}02725     \textcolor{comment}{// definied}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02726}02726     \textcolor{keywordflow}{if} (normb == 0.0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02727}02727     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02728}02728       \textcolor{comment}{// Set the value of normb}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02729}02729       normb = 1.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02730}02730     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02731}02731 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02732}02732     \textcolor{comment}{// Calculate the ratio between the initial norm and the current norm.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02733}02733     \textcolor{comment}{// Since we haven't completed an iteration yet this will simply be one}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02734}02734     \textcolor{comment}{// unless normb was zero, in which case resid will have value zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02735}02735     resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02736}02736 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02737}02737     \textcolor{comment}{// If required, will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02738}02738     \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02739}02739     \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02740}02740     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02741}02741       \textcolor{comment}{// If an output file which is open isn't provided then output to screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02742}02742       \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02743}02743       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02744}02744         \textcolor{comment}{// Output the residual value to the screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02745}02745         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02746}02746       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02747}02747       \textcolor{comment}{// Otherwise, output to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02748}02748       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02749}02749       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02750}02750         \textcolor{comment}{// Output the residual value to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02751}02751         Output\_file\_stream << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02752}02752       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02753}02753     \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02754}02754 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02755}02755     \textcolor{comment}{// If the GMRES algorithm converges immediately}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02756}02756     \textcolor{keywordflow}{if} (resid <= Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02757}02757     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02758}02758       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02759}02759       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02760}02760       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02761}02761         \textcolor{comment}{// Notify the user}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02762}02762         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}GMRES converged immediately. Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02763}02763                    << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02764}02764       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02765}02765 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02766}02766       \textcolor{comment}{// Finish running the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02767}02767       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02768}02768     \} \textcolor{comment}{// if (resid<=Tolerance)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02769}02769 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02770}02770     \textcolor{comment}{// Initialise a vector of orthogonal basis vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02771}02771     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<DoubleVector>}}> block\_v;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02772}02772 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02773}02773     \textcolor{comment}{// Resize the number of vectors needed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02774}02774     block\_v.resize(n\_row + 1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02775}02775 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02776}02776     \textcolor{comment}{// Resize each Vector of DoubleVectors to store the real and imaginary}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02777}02777     \textcolor{comment}{// part of a given vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02778}02778     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_row + 1; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02779}02779     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02780}02780       \textcolor{comment}{// Create two DoubleVector objects in each Vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02781}02781       block\_v[dof\_type].resize(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02782}02782     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02783}02783 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02784}02784     \textcolor{comment}{// Initialise the upper hessenberg matrix. Since we are not using}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02785}02785     \textcolor{comment}{// distributed vectors here, the algebra is best done using entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02786}02786     \textcolor{comment}{// of the type std::complex<double>. NOTE: For implementation purposes}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02787}02787     \textcolor{comment}{// the upper Hessenberg matrix indices are swapped so the matrix is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02788}02788     \textcolor{comment}{// effectively transposed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02789}02789     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<std::complex<double>}}>> hessenberg(n\_row + 1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02790}02790 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02791}02791     \textcolor{comment}{// Build the zeroth basis vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02792}02792     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02793}02793     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02794}02794       \textcolor{comment}{// Build the k-\/th part of the zeroth vector. Here k=0 and k=1 correspond}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02795}02795       \textcolor{comment}{// to the real and imaginary part of the zeroth vector, respectively}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02796}02796       block\_v[0][dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02797}02797     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02798}02798 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02799}02799     \textcolor{comment}{// Loop over the real and imaginary parts of v}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02800}02800     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02801}02801     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02802}02802       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02803}02803       \textcolor{keywordtype}{double}* v0\_pt = block\_v[0][dof\_type].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02804}02804 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02805}02805       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02806}02806       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_r\_pt = block\_r[dof\_type].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02807}02807 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02808}02808       \textcolor{comment}{// Set the zeroth basis vector v[0] to r/beta}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02809}02809       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02810}02810       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02811}02811         \textcolor{comment}{// Assign the i-\/th entry of the zeroth basis vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02812}02812         v0\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = block\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] / beta;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02813}02813       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02814}02814     \} \textcolor{comment}{// for (unsigned k=0;k<n\_dof\_types;k++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02815}02815 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02816}02816     \textcolor{comment}{// Set the first entry in the minimisation problem RHS vector (is meant}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02817}02817     \textcolor{comment}{// to the vector beta*e\_1 initially, where e\_1 is the unit vector with}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02818}02818     \textcolor{comment}{// one in its first entry)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02819}02819     \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0] = beta;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02820}02820 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02821}02821     \textcolor{comment}{// Compute the next step of the iterative scheme}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02822}02822     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}; j++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02823}02823     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02824}02824       \textcolor{comment}{// Resize the next column of the upper hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02825}02825       hessenberg[j].resize(j + 2, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02826}02826 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02827}02827       \textcolor{comment}{// Calculate w=M\string^\{-\/1\}(Jv[j]) (LHS prec.) or w=JM\string^\{-\/1\}v (RHS prec.)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02828}02828       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02829}02829         \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02830}02830         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} vj(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02831}02831 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02832}02832         \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02833}02833         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02834}02834 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02835}02835         \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02836}02836         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} w(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02837}02837 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02838}02838         \textcolor{comment}{// Create a temporary vector of DoubleVectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02839}02839         \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_temp(2);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02840}02840 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02841}02841         \textcolor{comment}{// Create two DoubleVectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02842}02842         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02843}02843         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02844}02844           block\_temp[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02845}02845                                      0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02846}02846         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02847}02847 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02848}02848         \textcolor{comment}{// If we're using LHS preconditioning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02849}02849         \textcolor{keywordflow}{if} (Preconditioner\_LHS)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02850}02850         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02851}02851           \textcolor{comment}{// Solve Jv[j]=Mw for w. Note, we cannot use inbuilt complex matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02852}02852           \textcolor{comment}{// algebra here as we're using distributed vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02853}02853           complex\_matrix\_multiplication(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02854}02854             Matrices\_storage\_pt, block\_v[j], block\_temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02855}02855 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02856}02856           \textcolor{comment}{// Copy block\_temp into temp}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02857}02857           this-\/>return\_block\_vectors(block\_temp, temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02858}02858 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02859}02859           \textcolor{comment}{// Copy block\_w into w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02860}02860           this-\/>return\_block\_vectors(block\_w, w);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02861}02861 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02862}02862           \textcolor{comment}{// Apply the preconditioner}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02863}02863           this-\/>preconditioner\_pt()-\/>preconditioner\_solve(temp, w);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02864}02864 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02865}02865           \textcolor{comment}{// Copy w into block\_w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02866}02866           this-\/>get\_block\_vectors(w, block\_w);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02867}02867         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02868}02868         \textcolor{comment}{// If we're using RHS preconditioning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02869}02869         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02870}02870         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02871}02871           \textcolor{comment}{// Copy the real and imaginary part of v[j] into one vector, vj}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02872}02872           this-\/>return\_block\_vectors(block\_v[j], vj);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02873}02873 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02874}02874           \textcolor{comment}{// Use w=JM\string^\{-\/1\}v by saad p270}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02875}02875           this-\/>preconditioner\_pt()-\/>preconditioner\_solve(vj, temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02876}02876 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02877}02877           \textcolor{comment}{// Copy w into block\_w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02878}02878           this-\/>get\_block\_vectors(temp, block\_temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02879}02879 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02880}02880           \textcolor{comment}{// Solve Jv[j] = Mw for w. Note, we cannot use inbuilt complex matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02881}02881           \textcolor{comment}{// algebra here as we're using distributed vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02882}02882           complex\_matrix\_multiplication(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02883}02883             Matrices\_storage\_pt, block\_temp, block\_w);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02884}02884         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02885}02885       \} \textcolor{comment}{// Calculate w=M\string^\{-\/1\}(Jv[j]) (LHS prec.) or w=JM\string^\{-\/1\}v (RHS prec.)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02886}02886 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02887}02887       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02888}02888       \textcolor{keywordtype}{double}* block\_w\_r\_pt = block\_w[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02889}02889 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02890}02890       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02891}02891       \textcolor{keywordtype}{double}* block\_w\_c\_pt = block\_w[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02892}02892 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02893}02893       \textcolor{comment}{// Loop over all of the entries on and above the principal subdiagonal of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02894}02894       \textcolor{comment}{// the Hessenberg matrix in the j-\/th column (remembering that}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02895}02895       \textcolor{comment}{// the indices of the upper Hessenberg matrix are swapped for the purpose}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02896}02896       \textcolor{comment}{// of implementation)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02897}02897       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < j + 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02898}02898       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02899}02899         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02900}02900         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* vi\_r\_pt = block\_v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02901}02901 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02902}02902         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02903}02903         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* vi\_c\_pt = block\_v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02904}02904 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02905}02905         \textcolor{comment}{// Loop over the entries of v and w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02906}02906         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02907}02907         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02908}02908           \textcolor{comment}{// Store the appropriate entry in v as a complex value}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02909}02909           std::complex<double> complex\_v(vi\_r\_pt[k], vi\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02910}02910 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02911}02911           \textcolor{comment}{// Store the appropriate entry in w as a complex value}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02912}02912           std::complex<double> complex\_w(block\_w\_r\_pt[k], block\_w\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02913}02913 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02914}02914           \textcolor{comment}{// Update the value of H(i,j) noting we're computing a complex}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02915}02915           \textcolor{comment}{// inner product here (the ordering is very important here!)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02916}02916           hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += std::conj(complex\_v) * complex\_w;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02917}02917         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02918}02918 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02919}02919         \textcolor{comment}{// Orthonormalise w against all previous orthogonal vectors, v\_i by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02920}02920         \textcolor{comment}{// looping over its entries and updating them}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02921}02921         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02922}02922         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02923}02923           \textcolor{comment}{// Update the real part of the k-\/th entry of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02924}02924           block\_w\_r\_pt[k] -\/= (hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].real() * vi\_r\_pt[k] -\/}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02925}02925                               hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].imag() * vi\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02926}02926 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02927}02927           \textcolor{comment}{// Update the imaginary part of the k-\/th entry of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02928}02928           block\_w\_c\_pt[k] -\/= (hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].real() * vi\_c\_pt[k] +}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02929}02929                               hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].imag() * vi\_r\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02930}02930         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02931}02931       \} \textcolor{comment}{// for (unsigned i=0;i<j+1;i++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02932}02932 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02933}02933       \textcolor{comment}{// Calculate the norm of the real part of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02934}02934       norm\_r = block\_w[0].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02935}02935 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02936}02936       \textcolor{comment}{// Calculate the norm of the imaginary part of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02937}02937       norm\_c = block\_w[1].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02938}02938 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02939}02939       \textcolor{comment}{// Calculate the norm of the vector w using norm\_r and norm\_c and assign}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02940}02940       \textcolor{comment}{// its value to the appropriate entry in the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02941}02941       hessenberg[j][j + 1] = sqrt(pow(norm\_r, 2.0) + pow(norm\_c, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02942}02942 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02943}02943       \textcolor{comment}{// Build the (j+1)-\/th basis vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02944}02944       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02945}02945       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02946}02946         \textcolor{comment}{// Build the k-\/th part of the zeroth vector. Here k=0 and k=1 correspond}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02947}02947         \textcolor{comment}{// to the real and imaginary part of the zeroth vector, respectively}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02948}02948         block\_v[j + 1][dof\_type].build(this-\/>block\_distribution\_pt(dof\_type),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02949}02949                                        0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02950}02950       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02951}02951 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02952}02952       \textcolor{comment}{// Check if the value of hessenberg[j][j+1] is zero. If it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02953}02953       \textcolor{comment}{// isn't then we update the next entries in v}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02954}02954       \textcolor{keywordflow}{if} (hessenberg[j][j + 1] != 0.0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02955}02955       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02956}02956         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02957}02957         \textcolor{keywordtype}{double}* v\_r\_pt = block\_v[j + 1][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02958}02958 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02959}02959         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02960}02960         \textcolor{keywordtype}{double}* v\_c\_pt = block\_v[j + 1][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02961}02961 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02962}02962         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02963}02963         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_w\_r\_pt = block\_w[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02964}02964 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02965}02965         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02966}02966         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_w\_c\_pt = block\_w[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02967}02967 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02968}02968         \textcolor{comment}{// Notice, the value of H(j,j+1), as calculated above, is clearly a real}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02969}02969         \textcolor{comment}{// number. As such, calculating the division}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02970}02970         \textcolor{comment}{//                      v\_\{j+1\}=w\_\{j\}/h\_\{j+1,j\},}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02971}02971         \textcolor{comment}{// here is simple, i.e. we don't need to worry about cross terms in the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02972}02972         \textcolor{comment}{// algebra. To avoid computing h\_\{j+1,j\} several times we precompute it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02973}02973         \textcolor{keywordtype}{double} h\_subdiag\_val = hessenberg[j][j + 1].real();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02974}02974 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02975}02975         \textcolor{comment}{// Loop over the entries of the new orthogonal vector and set its values}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02976}02976         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02977}02977         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02978}02978           \textcolor{comment}{// The i-\/th entry of the real component is given by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02979}02979           v\_r\_pt[k] = block\_w\_r\_pt[k] / h\_subdiag\_val;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02980}02980 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02981}02981           \textcolor{comment}{// Similarly, the i-\/th entry of the imaginary component is given by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02982}02982           v\_c\_pt[k] = block\_w\_c\_pt[k] / h\_subdiag\_val;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02983}02983         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02984}02984       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02985}02985       \textcolor{comment}{// Otherwise, we have to jump to the next part of the algorithm; if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02986}02986       \textcolor{comment}{// the value of hessenberg[j][j+1] is zero then the norm of the latest}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02987}02987       \textcolor{comment}{// orthogonal vector is zero. This is only possible if the entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02988}02988       \textcolor{comment}{// in w are all zero. As a result, the Krylov space of A and r\_0 has}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02989}02989       \textcolor{comment}{// been spanned by the previously calculated orthogonal vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02990}02990       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02991}02991       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02992}02992         \textcolor{comment}{// Book says "{}Set m=j and jump to step 11"{} (p.172)...}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02993}02993         \textcolor{comment}{// Do something here!}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02994}02994         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Subdiagonal Hessenberg entry is zero. "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02995}02995                    << \textcolor{stringliteral}{"{}Do something here..."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02996}02996       \} \textcolor{comment}{// if (hessenberg[j][j+1]!=0.0)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02997}02997 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02998}02998       \textcolor{comment}{// Loop over the entries in the Hessenberg matrix and calculate the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l02999}02999       \textcolor{comment}{// entries of the Givens rotation matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03000}03000       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < j; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03001}03001       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03002}03002         \textcolor{comment}{// Apply the plane rotation to all of the previous entries in the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03003}03003         \textcolor{comment}{// (j)-\/th column (remembering the indexing is reversed)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03004}03004         apply\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03005}03005           hessenberg[j][k], hessenberg[j][k + 1], cs[k], sn[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03006}03006       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03007}03007 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03008}03008       \textcolor{comment}{// Now calculate the entries of the latest Givens rotation matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03009}03009       generate\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03010}03010         hessenberg[j][j], hessenberg[j][j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03011}03011 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03012}03012       \textcolor{comment}{// Apply the plane rotation using the newly calculated entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03013}03013       apply\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03014}03014         hessenberg[j][j], hessenberg[j][j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03015}03015 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03016}03016       \textcolor{comment}{// Apply a plane rotation to the corresponding entry in the vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03017}03017       \textcolor{comment}{// s used in the minimisation problem, J(y)=min||s-\/R\_m*y||}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03018}03018       apply\_plane\_rotation(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j], \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03019}03019 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03020}03020       \textcolor{comment}{// Compute current residual using equation (6.42) in Saad Y, "{}Iterative}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03021}03021       \textcolor{comment}{// methods for sparse linear systems"{}, p.177.]. Note, since s has complex}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03022}03022       \textcolor{comment}{// entries we have to use std::abs instead of std::fabs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03023}03023       beta = std::abs(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j + 1]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03024}03024 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03025}03025       \textcolor{comment}{// Compute the relative residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03026}03026       resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03027}03027 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03028}03028       \textcolor{comment}{// If required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03029}03029       \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03030}03030       \textcolor{keywordflow}{if} (Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03031}03031       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03032}03032         \textcolor{comment}{// If an output file which is open isn't provided then output to screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03033}03033         \textcolor{keywordflow}{if} (!Output\_file\_stream.is\_open())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03034}03034         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03035}03035           \textcolor{comment}{// Output the residual value to the screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03036}03036           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << j + 1 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03037}03037         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03038}03038         \textcolor{comment}{// Otherwise, output to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03039}03039         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03040}03040         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03041}03041           \textcolor{comment}{// Output the residual value to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03042}03042           Output\_file\_stream << j + 1 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03043}03043         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03044}03044       \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03045}03045 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03046}03046       \textcolor{comment}{// If the required tolerance has been met}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03047}03047       \textcolor{keywordflow}{if} (resid < Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03048}03048       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03049}03049         \textcolor{comment}{// Store the number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03050}03050         Iterations = j + 1;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03051}03051 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03052}03052         \textcolor{comment}{// Update the result vector using the result, x=x\_0+V\_m*y (where V\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03053}03053         \textcolor{comment}{// is given by v here)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03054}03054         update(j, hessenberg, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, block\_v, block\_solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03055}03055 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03056}03056         \textcolor{comment}{// Copy the vectors in block\_solution to solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03057}03057         this-\/>return\_block\_vectors(block\_solution, solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03058}03058 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03059}03059         \textcolor{comment}{// If time documentation was enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03060}03060         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03061}03061         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03062}03062           \textcolor{comment}{// Output the current normalised residual norm}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03063}03063           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nGMRES converged (1). Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03064}03064                      << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03065}03065 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03066}03066           \textcolor{comment}{// Output the number of iterations it took for convergence}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03067}03067           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations to convergence: "{}} << j + 1 << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03068}03068                      << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03069}03069         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03070}03070 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03071}03071         \textcolor{comment}{// Stop the timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03072}03072         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03073}03073 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03074}03074         \textcolor{comment}{// Calculate the time taken to calculate the solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03075}03075         Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03076}03076 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03077}03077         \textcolor{comment}{// If time documentation was enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03078}03078         \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03079}03079         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03080}03080           \textcolor{comment}{// Output the time taken to solve the problem using GMRES}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03081}03081           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with GMRES [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03082}03082                      << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03083}03083         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03084}03084 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03085}03085         \textcolor{comment}{// As we've met the tolerance for the solver and everything that should}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03086}03086         \textcolor{comment}{// be documented, has been, finish using the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03087}03087         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03088}03088       \} \textcolor{comment}{// if (resid<Tolerance)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03089}03089     \} \textcolor{comment}{// for (unsigned j=0;j<Max\_iter;j++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03090}03090 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03091}03091     \textcolor{comment}{// Store the number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03092}03092     Iterations = \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03093}03093 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03094}03094     \textcolor{comment}{// Only update if we actually did something}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03095}03095     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} > 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03096}03096     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03097}03097       \textcolor{comment}{// Update the result vector using the result, x=x\_0+V\_m*y (where V\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03098}03098       \textcolor{comment}{// is given by v here)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03099}03099       update(\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} -\/ 1, hessenberg, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, block\_v, block\_solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03100}03100 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03101}03101       \textcolor{comment}{// Copy the vectors in block\_solution to solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03102}03102       this-\/>return\_block\_vectors(block\_solution, solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03103}03103     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03104}03104 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03105}03105     \textcolor{comment}{// Solve Mr=(b-\/Jx) for r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03106}03106     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03107}03107       \textcolor{comment}{// Create a temporary vector of DoubleVectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03108}03108       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_temp(2);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03109}03109 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03110}03110       \textcolor{comment}{// Create two DoubleVectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03111}03111       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03112}03112       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03113}03113         \textcolor{comment}{// Build the distribution of the (dof\_type)-\/th vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03114}03114         block\_temp[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03115}03115       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03116}03116 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03117}03117       \textcolor{comment}{// Calculate the value of Jx}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03118}03118       complex\_matrix\_multiplication(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03119}03119         Matrices\_storage\_pt, block\_solution, block\_temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03120}03120 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03121}03121       \textcolor{comment}{// Get the values pointer of the vector (real)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03122}03122       \textcolor{keywordtype}{double}* block\_temp\_r\_pt = block\_temp[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03123}03123 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03124}03124       \textcolor{comment}{// Get the values pointer of the vector (imaginary)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03125}03125       \textcolor{keywordtype}{double}* block\_temp\_c\_pt = block\_temp[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03126}03126 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03127}03127       \textcolor{comment}{// Get the values pointer of the RHS vector (real)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03128}03128       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_rhs\_r\_pt = block\_rhs[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03129}03129 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03130}03130       \textcolor{comment}{// Get the values pointer of the RHS vector (imaginary)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03131}03131       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_rhs\_c\_pt = block\_rhs[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03132}03132 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03133}03133       \textcolor{comment}{// Loop over the dofs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03134}03134       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03135}03135       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03136}03136         \textcolor{comment}{// Calculate b-\/Jx (real)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03137}03137         block\_temp\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = block\_rhs\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ block\_temp\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03138}03138 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03139}03139         \textcolor{comment}{// Calculate b-\/Jx (imaginary)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03140}03140         block\_temp\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = block\_rhs\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] -\/ block\_temp\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03141}03141       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03142}03142 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03143}03143       \textcolor{comment}{// If we're using LHS preconditioning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03144}03144       \textcolor{keywordflow}{if} (Preconditioner\_LHS)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03145}03145       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03146}03146         \textcolor{comment}{// Create a temporary DoubleVectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03147}03147         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} temp(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03148}03148 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03149}03149         \textcolor{comment}{// Create a vector of the same size as rhs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03150}03150         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} r(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03151}03151 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03152}03152         \textcolor{comment}{// Copy the vectors in r to full\_r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03153}03153         this-\/>return\_block\_vectors(block\_temp, temp);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03154}03154 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03155}03155         \textcolor{comment}{// Copy the vectors in r to full\_r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03156}03156         this-\/>return\_block\_vectors(block\_r, r);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03157}03157 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03158}03158         \textcolor{comment}{// Apply the preconditioner}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03159}03159         preconditioner\_pt()-\/>preconditioner\_solve(temp, r);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03160}03160       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03161}03161     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03162}03162 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03163}03163     \textcolor{comment}{// Compute the current residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03164}03164     beta = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03165}03165 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03166}03166     \textcolor{comment}{// Get access to the values pointer (real)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03167}03167     norm\_r = block\_r[0].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03168}03168 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03169}03169     \textcolor{comment}{// Get access to the values pointer (imaginary)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03170}03170     norm\_c = block\_r[1].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03171}03171 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03172}03172     \textcolor{comment}{// Calculate the full norm}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03173}03173     beta = sqrt(pow(norm\_r, 2.0) + pow(norm\_c, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03174}03174 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03175}03175     \textcolor{comment}{// Calculate the relative residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03176}03176     resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03177}03177 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03178}03178     \textcolor{comment}{// If the relative residual lies within tolerance}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03179}03179     \textcolor{keywordflow}{if} (resid < Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03180}03180     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03181}03181       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03182}03182       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03183}03183       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03184}03184         \textcolor{comment}{// Notify the user}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03185}03185         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nGMRES converged (2). Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03186}03186                    << resid}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03187}03187                    << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of iterations to convergence: "{}} << Iterations}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03188}03188                    << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03189}03189                    << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03190}03190       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03191}03191 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03192}03192       \textcolor{comment}{// End the timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03193}03193       \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03194}03194 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03195}03195       \textcolor{comment}{// Calculate the time taken for the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03196}03196       Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03197}03197 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03198}03198       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03199}03199       \textcolor{keywordflow}{if} (Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03200}03200       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03201}03201         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with GMRES [sec]: "{}} << Solution\_time}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03202}03202                    << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03203}03203       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03204}03204       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03205}03205     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03206}03206 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03207}03207     \textcolor{comment}{// Otherwise GMRES failed convergence}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03208}03208     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nGMRES did not converge to required tolerance! "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03209}03209                << \textcolor{stringliteral}{"{}\(\backslash\)nReturning with normalised residual norm: "{}} << resid}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03210}03210                << \textcolor{stringliteral}{"{}\(\backslash\)nafter "{}} << \mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} << \textcolor{stringliteral}{"{} iterations.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03211}03211                << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03212}03212 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03213}03213     \textcolor{comment}{// Throw an error if requested}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03214}03214     \textcolor{keywordflow}{if} (Throw\_error\_after\_max\_iter)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03215}03215     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03216}03216       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Solver failed to converge and you requested an error"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03217}03217       err += \textcolor{stringliteral}{"{} on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03218}03218       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03219}03219         err, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03220}03220     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03221}03221 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03222}03222     \textcolor{comment}{// Finish using the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03223}03223     \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03224}03224   \} \textcolor{comment}{// End of solve\_helper}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03225}03225 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03226}03226 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03227}03227 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03228}03228 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03229}03229 \textcolor{comment}{  /// ////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03230}03230 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03231}03231 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03232}03232   \textcolor{comment}{//======================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03233}03233 \textcolor{comment}{  /// The FGMRES method, i.e. the flexible variant of the GMRES}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03234}03234 \textcolor{comment}{  /// method which allows for nonconstant preconditioners [see Saad Y,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03235}03235 \textcolor{comment}{  /// "{}Iterative methods for sparse linear systems"{}, p.287]. Note, FGMRES}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03236}03236 \textcolor{comment}{  /// can only cater to right preconditioning; if the user tries to switch}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03237}03237 \textcolor{comment}{  /// to left preconditioning they will be notified of this}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03238}03238 \textcolor{comment}{}  \textcolor{comment}{//======================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03239}03239   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03240}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG}{03240}}   \textcolor{keyword}{class }\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG}{HelmholtzFGMRESMG}} : \textcolor{keyword}{public} \textcolor{keyword}{virtual} \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG}{HelmholtzGMRESMG}}<MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03241}03241   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03242}03242   \textcolor{keyword}{public}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03243}03243 \textcolor{comment}{    /// Constructor (empty)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03244}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_abadd59fadd8ddf7804cb6696f567dbe9}{03244}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_abadd59fadd8ddf7804cb6696f567dbe9}{HelmholtzFGMRESMG}}() : \mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG}{HelmholtzGMRESMG}}<MATRIX>()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03245}03245     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03246}03246       \textcolor{comment}{// Can only use RHS preconditioning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03247}03247       this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a7f151e92397721fc2ae6acdd8253d685}{Preconditioner\_LHS}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03248}03248     \};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03249}03249 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03250}03250 \textcolor{comment}{    /// Destructor (cleanup storage)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03251}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a89c8378219342c65d10f2c0af160bebf}{03251}} \textcolor{comment}{}    \textcolor{keyword}{virtual} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a89c8378219342c65d10f2c0af160bebf}{\string~HelmholtzFGMRESMG}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03252}03252     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03253}03253       \textcolor{comment}{// Call the clean up function in the base class GMRES}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03254}03254       this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03255}03255     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03256}03256 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03257}03257 \textcolor{comment}{    /// Broken copy constructor}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03258}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a14c2f9a783973936537427dee3b9628c}{03258}} \textcolor{comment}{}    \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a14c2f9a783973936537427dee3b9628c}{HelmholtzFGMRESMG}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG}{HelmholtzFGMRESMG}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03259}03259 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03260}03260 \textcolor{comment}{    /// Broken assignment operator}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03261}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_adf252c35e340379f2dc1c93eede84d66}{03261}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_adf252c35e340379f2dc1c93eede84d66}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG}{HelmholtzFGMRESMG}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03262}03262 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03263}03263 \textcolor{comment}{    /// Overloaded function to let the user know that left}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03264}03264 \textcolor{comment}{    /// preconditioning is not possible with FGMRES, only right preconditioning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03265}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_ae3272923b5eb1bd6d7f494a8bafdf303}{03265}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_ae3272923b5eb1bd6d7f494a8bafdf303}{set\_preconditioner\_LHS}}()}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03266}03266     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03267}03267       \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03268}03268       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03269}03269 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03270}03270       \textcolor{comment}{// Create an error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03271}03271       error\_message\_stream << \textcolor{stringliteral}{"{}FGMRES cannot use left preconditioning. It is "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03272}03272                            << \textcolor{stringliteral}{"{}only capable of using right preconditioning."{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03273}03273                            << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03274}03274 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03275}03275       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03276}03276       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03277}03277                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03278}03278                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03279}03279     \} \textcolor{comment}{// End of set\_preconditioner\_LHS}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03280}03280 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03281}03281 \textcolor{comment}{    /// Solver: Takes pointer to problem and returns the results vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03282}03282 \textcolor{comment}{    /// which contains the solution of the linear system defined by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03283}03283 \textcolor{comment}{    /// the problem's fully assembled Jacobian and residual vector.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03284}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a36a1d601676df2ebe39fcdb7a0837864}{03284}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a36a1d601676df2ebe39fcdb7a0837864}{solve}}(\mbox{\hyperlink{classoomph_1_1Problem}{Problem}}* \textcolor{keyword}{const}\& problem\_pt, \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& result)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03285}03285     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03286}03286 \textcolor{preprocessor}{\#ifdef OOMPH\_HAS\_MPI}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03287}03287       \textcolor{comment}{// Make sure that this is running in serial. Can't guarantee it'll}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03288}03288       \textcolor{comment}{// work when the problem is distributed over several processors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03289}03289       \textcolor{keywordflow}{if} (\mbox{\hyperlink{classoomph_1_1MPI__Helpers_ac16964b22bfd4f657490802beb600ffe}{MPI\_Helpers::communicator\_pt}}()-\/>nproc() > 1)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03290}03290       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03291}03291         \textcolor{comment}{// Throw a warning}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03292}03292         \mbox{\hyperlink{classoomph_1_1OomphLibWarning}{OomphLibWarning}}(\textcolor{stringliteral}{"{}Can't guarantee the MG solver will work in parallel!"{}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03293}03293                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03294}03294                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03295}03295       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03296}03296 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03297}03297 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03298}03298       \textcolor{comment}{// Find \# of degrees of freedom (variables)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03299}03299       \textcolor{keywordtype}{unsigned} n\_dof = problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a218d4dfff74bc14f3f5dc8416236e01d}{ndof}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03300}03300 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03301}03301       \textcolor{comment}{// Initialise timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03302}03302       \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03303}03303 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03304}03304       \textcolor{comment}{// We're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03305}03305       this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_acb64519b62c16bbec32d01c9969f746f}{Resolving}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03306}03306 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03307}03307       \textcolor{comment}{// Get rid of any previously stored data}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03308}03308       this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03309}03309 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03310}03310       \textcolor{comment}{// Grab the communicator from the MGProblem object and assign it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03311}03311       this-\/>\mbox{\hyperlink{classoomph_1_1Preconditioner_a306f5a52f493816fcfda2dc9b2ee1dbf}{set\_comm\_pt}}(problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03312}03312 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03313}03313       \textcolor{comment}{// Setup the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03314}03314       \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} dist(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03315}03315         problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a22e2521bc620ad0cc542213a24f31252}{communicator\_pt}}(), n\_dof, \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03316}03316 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03317}03317       \textcolor{comment}{// Build the internal distribution in this way because both the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03318}03318       \textcolor{comment}{// IterativeLinearSolver and BlockPreconditioner class have base-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03319}03319       \textcolor{comment}{// class subobjects of type oomph::DistributableLinearAlgebraObject}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03320}03320       \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_ac5340bac40b9559b0378037b57005203}{IterativeLinearSolver::build\_distribution}}(dist);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03321}03321 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03322}03322       \textcolor{comment}{// Get Jacobian matrix in format specified by template parameter}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03323}03323       \textcolor{comment}{// and nonlinear residual vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03324}03324       MATRIX* \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}} = \textcolor{keyword}{new} MATRIX;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03325}03325       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} f;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03326}03326       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03327}03327       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03328}03328         \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}) != 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03329}03329         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03330}03330           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}}*\textcolor{keyword}{>}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}})-\/>build(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03331}03331             \mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03332}03332           f.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03333}03333         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03334}03334       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03335}03335 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03336}03336       \textcolor{comment}{// Get the Jacobian and residuals vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03337}03337       problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_a4ba83bbea19db3a530539f3e9f88a7e4}{get\_jacobian}}(f, *\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}});}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03338}03338 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03339}03339       \textcolor{comment}{// We've made the matrix, we can delete it...}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03340}03340       this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a1550b5147f7fa822e8cbc9de93f1c06f}{Matrix\_can\_be\_deleted}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03341}03341 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03342}03342       \textcolor{comment}{// Replace the current matrix used in Preconditioner by the new matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03343}03343       this-\/>\mbox{\hyperlink{classoomph_1_1Preconditioner_af459b7333c4c64435fd8fa933535901f}{set\_matrix\_pt}}(matrix\_pt);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03344}03344 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03345}03345       \textcolor{comment}{// The preconditioner works with one mesh; set it! Since we only use}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03346}03346       \textcolor{comment}{// the block preconditioner on the finest level, we use the mesh from}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03347}03347       \textcolor{comment}{// that level}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03348}03348       this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_ae055f998f6145656352aacac22e545ad}{set\_nmesh}}(1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03349}03349 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03350}03350       \textcolor{comment}{// Elements in actual pml layer are trivially wrapped versions of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03351}03351       \textcolor{comment}{// their bulk counterparts. Technically they are different elements}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03352}03352       \textcolor{comment}{// so we have to allow different element types}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03353}03353       \textcolor{keywordtype}{bool} allow\_different\_element\_types\_in\_mesh = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03354}03354       this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af97821621b570d409e6662939e5f818d}{set\_mesh}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03355}03355         0, problem\_pt-\/>\mbox{\hyperlink{classoomph_1_1Problem_ae2e5559918832d0850b3631d004d0a37}{mesh\_pt}}(), allow\_different\_element\_types\_in\_mesh);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03356}03356 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03357}03357       \textcolor{comment}{// Set up the generic block look up scheme}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03358}03358       this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_af704c4816469cef4fed9d35a9ad651ec}{block\_setup}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03359}03359 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03360}03360       \textcolor{comment}{// Extract the number of blocks.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03361}03361       \textcolor{keywordtype}{unsigned} \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a80808d42be8db74fd58af80b019bf317}{nblock\_types}} = this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a80808d42be8db74fd58af80b019bf317}{nblock\_types}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03362}03362 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03363}03363 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03364}03364       \textcolor{comment}{// PARANOID check -\/ there must only be two block types}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03365}03365       \textcolor{keywordflow}{if} (nblock\_types != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03366}03366       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03367}03367         \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03368}03368         std::stringstream tmp;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03369}03369         tmp << \textcolor{stringliteral}{"{}There are supposed to be two block types.\(\backslash\)nYours has "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03370}03370             << \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a80808d42be8db74fd58af80b019bf317}{nblock\_types}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03371}03371 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03372}03372         \textcolor{comment}{// Throw an error}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03373}03373         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03374}03374           tmp.str(), OOMPH\_CURRENT\_FUNCTION, OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03375}03375       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03376}03376 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03377}03377 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03378}03378       \textcolor{comment}{// Resize the storage for the system matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03379}03379       this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}.resize(2, 0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03380}03380 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03381}03381       \textcolor{comment}{// Loop over the rows of the block matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03382}03382       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a80808d42be8db74fd58af80b019bf317}{nblock\_types}}; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03383}03383       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03384}03384         \textcolor{comment}{// Fix the column index}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03385}03385         \textcolor{keywordtype}{unsigned} j = 0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03386}03386 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03387}03387         \textcolor{comment}{// Create new CRDoubleMatrix objects}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03388}03388         this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \textcolor{keyword}{new} \mbox{\hyperlink{classoomph_1_1CRDoubleMatrix}{CRDoubleMatrix}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03389}03389 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03390}03390         \textcolor{comment}{// Extract the required blocks, i.e. the first column}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03391}03391         this-\/>\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_a72b4dbe167da59d9ba12c7eff97d77e6}{get\_block}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j, *(this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a5d8ae2181aecf890386ae48d81f90b42}{Matrices\_storage\_pt}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03392}03392       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03393}03393 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03394}03394       \textcolor{comment}{// Doc time for setup}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03395}03395       \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03396}03396       this-\/>\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a82a12e45c78e910b46e9d0935beb8f0d}{Jacobian\_setup\_time}} = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03397}03397 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03398}03398       \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a536e41b50b3f3464ca9cb4a5776acc19}{Doc\_time}})}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03399}03399       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03400}03400         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nTime for setup of block Jacobian [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03401}03401                    << this-\/>\mbox{\hyperlink{classoomph_1_1IterativeLinearSolver_a82a12e45c78e910b46e9d0935beb8f0d}{Jacobian\_setup\_time}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03402}03402       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03403}03403 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03404}03404       \textcolor{comment}{// Call linear algebra-\/style solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03405}03405       \textcolor{comment}{// If the result distribution is wrong, then redistribute}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03406}03406       \textcolor{comment}{// before the solve and return to original distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03407}03407       \textcolor{comment}{// afterwards}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03408}03408       \textcolor{keywordflow}{if} ((!(*result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() ==}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03409}03409              *\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}())) \&\&}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03410}03410           (result.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03411}03411       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03412}03412         \textcolor{comment}{// Make a distribution object}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03413}03413         \mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution}{LinearAlgebraDistribution}} temp\_global\_dist(result.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03414}03414 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03415}03415         \textcolor{comment}{// Build the result vector distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03416}03416         result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03417}03417 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03418}03418         \textcolor{comment}{// Solve the problem}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03419}03419         \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a8bfd5045cf99bbeaf94b69ede3ccf0ad}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}, f, result);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03420}03420 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03421}03421         \textcolor{comment}{// Redistribute the vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03422}03422         result.\mbox{\hyperlink{classoomph_1_1DoubleVector_a9396b861977c16606d8eca39056976c8}{redistribute}}(\&temp\_global\_dist);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03423}03423       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03424}03424       \textcolor{comment}{// Otherwise just solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03425}03425       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03426}03426       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03427}03427         \textcolor{comment}{// Solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03428}03428         \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a8bfd5045cf99bbeaf94b69ede3ccf0ad}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}}, f, result);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03429}03429       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03430}03430 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03431}03431       \textcolor{comment}{// Kill matrix unless it's still required for resolve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03432}03432       \textcolor{keywordflow}{if} (!(this-\/>\mbox{\hyperlink{classoomph_1_1LinearSolver_a5f5e7e7a44ff0897b0e4cd9524000edc}{Enable\_resolve}}))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03433}03433       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03434}03434         \textcolor{comment}{// Clean up anything left in memory}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03435}03435         this-\/>\mbox{\hyperlink{classoomph_1_1HelmholtzGMRESMG_a81ddd10ccc03d6582dcadbd5cae1edda}{clean\_up\_memory}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03436}03436       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03437}03437     \} \textcolor{comment}{// End of solve}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03438}03438 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03439}03439   \textcolor{keyword}{private}:\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03440}03440 \textcolor{comment}{    /// General interface to solve function}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03441}03441 \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a8bfd5045cf99bbeaf94b69ede3ccf0ad}{solve\_helper}}(\mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& \mbox{\hyperlink{classoomph_1_1BlockPreconditioner_aec1a6eda2d78d1e3b41ced805534d72d}{matrix\_pt}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03442}03442                       \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03443}03443                       \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03444}03444 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03445}03445 \textcolor{comment}{    /// Helper function to update the result vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03446}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_ac6e87c2d59dcee71ce599dcbabae5445}{03446}} \textcolor{comment}{}    \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_ac6e87c2d59dcee71ce599dcbabae5445}{update}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& k,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03447}03447                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>>\& hessenberg,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03448}03448                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<std::complex<double>>\& \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}},}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03449}03449                 \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1Vector}{Vector}}<\mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}>\& z\_m,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03450}03450                 \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}}\& x)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03451}03451     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03452}03452       \textcolor{comment}{// Make a local copy of s}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03453}03453       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> y(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}});}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03454}03454 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03455}03455       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03456}03456       \textcolor{comment}{// The Hessenberg matrix should be an upper triangular matrix at}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03457}03457       \textcolor{comment}{// this point (although from its storage it would appear to be a}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03458}03458       \textcolor{comment}{// lower triangular matrix since the indexing has been reversed)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03459}03459       \textcolor{comment}{// so finding the minimiser of J(y)=min||s-\/R\_m*y|| where R\_m is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03460}03460       \textcolor{comment}{// the matrix R in the QR factorisation of the Hessenberg matrix.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03461}03461       \textcolor{comment}{// Therefore, to obtain y we simply need to use a backwards}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03462}03462       \textcolor{comment}{// substitution. Note: The implementation here may appear to be}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03463}03463       \textcolor{comment}{// somewhat confusing as the indexing in the Hessenberg matrix is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03464}03464       \textcolor{comment}{// reversed. This implementation of a backwards substitution does}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03465}03465       \textcolor{comment}{// not run along the columns of the triangular matrix but rather}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03466}03466       \textcolor{comment}{// up the rows.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03467}03467       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03468}03468 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03469}03469       \textcolor{comment}{// The outer loop is a loop over the columns of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03470}03470       \textcolor{comment}{// since the indexing is reversed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03471}03471       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = \textcolor{keywordtype}{int}(k); \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} >= 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}-\/-\/)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03472}03472       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03473}03473         \textcolor{comment}{// Divide the i-\/th entry of y by the i-\/th diagonal entry of H}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03474}03474         y[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] /= hessenberg[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03475}03475 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03476}03476         \textcolor{comment}{// The inner loop is a loop over the rows of the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03477}03477         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} -\/ 1; j >= 0; j-\/-\/)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03478}03478         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03479}03479           \textcolor{comment}{// Update the j-\/th entry of y}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03480}03480           y[j] -\/= hessenberg[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][j] * y[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03481}03481         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03482}03482       \} \textcolor{comment}{// for (int i=int(k);i>=0;i-\/-\/)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03483}03483 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03484}03484       \textcolor{comment}{// Calculate the number of entries in x (simply use the real part as}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03485}03485       \textcolor{comment}{// both the real and imaginary part should have the same length)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03486}03486       \textcolor{keywordtype}{unsigned} n\_row = x[0].nrow();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03487}03487 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03488}03488       \textcolor{comment}{// Build a temporary vector with entries initialised to 0.0}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03489}03489       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_update(2);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03490}03490 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03491}03491       \textcolor{comment}{// Build the distributions}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03492}03492       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < 2; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03493}03493       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03494}03494         \textcolor{comment}{// Build the (dof\_type)-\/th vector of block\_update}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03495}03495         block\_update[dof\_type].build(x[0].\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03496}03496       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03497}03497 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03498}03498       \textcolor{comment}{// Get access to the underlying values}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03499}03499       \textcolor{keywordtype}{double}* block\_update\_r\_pt = block\_update[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03500}03500 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03501}03501       \textcolor{comment}{// Get access to the underlying values}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03502}03502       \textcolor{keywordtype}{double}* block\_update\_c\_pt = block\_update[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03503}03503 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03504}03504       \textcolor{comment}{// Calculate x=Vy}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03505}03505       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j <= k; j++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03506}03506       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03507}03507         \textcolor{comment}{// Get access to j-\/th column of Z\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03508}03508         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* z\_mj\_r\_pt = z\_m[j][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03509}03509 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03510}03510         \textcolor{comment}{// Get access to j-\/th column of Z\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03511}03511         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* z\_mj\_c\_pt = z\_m[j][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03512}03512 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03513}03513         \textcolor{comment}{// Loop over the entries in x and update them}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03514}03514         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03515}03515         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03516}03516           \textcolor{comment}{// Update the real part of the i-\/th entry in x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03517}03517           block\_update\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03518}03518             (z\_mj\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].real()) -\/ (z\_mj\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].imag());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03519}03519 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03520}03520           \textcolor{comment}{// Update the imaginary part of the i-\/th entry in x}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03521}03521           block\_update\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] +=}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03522}03522             (z\_mj\_c\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].real()) + (z\_mj\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] * y[j].imag());}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03523}03523         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03524}03524       \} \textcolor{comment}{// for (unsigned j=0;j<=k;j++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03525}03525 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03526}03526       \textcolor{comment}{// Use the update: x\_m=x\_0+inv(M)Vy [see Saad Y,"{}Iterative methods for}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03527}03527       \textcolor{comment}{// sparse linear systems"{}, p.284]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03528}03528       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < 2; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03529}03529       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03530}03530         \textcolor{comment}{// Update the solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03531}03531         x[dof\_type] += block\_update[dof\_type];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03532}03532       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03533}03533     \} \textcolor{comment}{// End of update}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03534}03534   \};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03535}03535 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03536}03536 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03537}03537 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03538}03538 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03539}03539 \textcolor{comment}{  /// ///////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03540}03540 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03541}03541 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03542}03542   \textcolor{comment}{//=============================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03543}03543 \textcolor{comment}{  /// Linear-\/algebra-\/type solver: Takes pointer to a matrix and rhs vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03544}03544 \textcolor{comment}{  /// and returns the solution of the linear system.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03545}03545 \textcolor{comment}{  /// based on the algorithm presented in Templates for the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03546}03546 \textcolor{comment}{  /// Solution of Linear Systems: Building Blocks for Iterative Methods,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03547}03547 \textcolor{comment}{  /// Barrett, Berry et al, SIAM, 2006 and the implementation in the IML++}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03548}03548 \textcolor{comment}{  /// library : http://math.nist.gov/iml++/}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03549}03549 \textcolor{comment}{}  \textcolor{comment}{//=============================================================================}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03550}03550   \textcolor{keyword}{template}<\textcolor{keyword}{typename} MATRIX>}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03551}\mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a8bfd5045cf99bbeaf94b69ede3ccf0ad}{03551}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1HelmholtzFGMRESMG_a8bfd5045cf99bbeaf94b69ede3ccf0ad}{HelmholtzFGMRESMG<MATRIX>::solve\_helper}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03552}03552     \mbox{\hyperlink{classoomph_1_1DoubleMatrixBase}{DoubleMatrixBase}}* \textcolor{keyword}{const}\& matrix\_pt,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03553}03553     \textcolor{keyword}{const} \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& rhs,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03554}03554     \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}}\& solution)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03555}03555   \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03556}03556     \textcolor{comment}{// Set the number of dof types (real and imaginary for this solver)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03557}03557     \textcolor{keywordtype}{unsigned} n\_dof\_types = this-\/>ndof\_types();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03558}03558 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03559}03559 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03560}03560     \textcolor{comment}{// This only works for 2 dof types}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03561}03561     \textcolor{keywordflow}{if} (n\_dof\_types != 2)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03562}03562     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03563}03563       \textcolor{comment}{// Create an output stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03564}03564       std::stringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03565}03565 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03566}03566       \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03567}03567       error\_message\_stream << \textcolor{stringliteral}{"{}This preconditioner only works for problems "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03568}03568                            << \textcolor{stringliteral}{"{}with 2 dof types\(\backslash\)nYours has "{}} << n\_dof\_types;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03569}03569 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03570}03570       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03571}03571       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03572}03572                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03573}03573                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03574}03574     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03575}03575 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03576}03576 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03577}03577     \textcolor{comment}{// Get the number of dofs (note, the total number of dofs in the problem}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03578}03578     \textcolor{comment}{// is 2*n\_row but if the constituent vectors and matrices were stored in}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03579}03579     \textcolor{comment}{// complex objects there would only be (n\_row) rows so we use that)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03580}03580     \textcolor{keywordtype}{unsigned} n\_row = this-\/>Matrices\_storage\_pt[0]-\/>nrow();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03581}03581 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03582}03582     \textcolor{comment}{// Make sure Max\_iter isn't greater than n\_dof. The user cannot use this}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03583}03583     \textcolor{comment}{// many iterations when using Krylov subspace methods}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03584}03584     \textcolor{keywordflow}{if} (this-\/>\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} > n\_row)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03585}03585     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03586}03586       \textcolor{comment}{// Create an output string stream}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03587}03587       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03588}03588 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03589}03589       \textcolor{comment}{// Create the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03590}03590       error\_message\_stream << \textcolor{stringliteral}{"{}The maximum number of iterations cannot exceed "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03591}03591                            << \textcolor{stringliteral}{"{}the number of rows in the problem."{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03592}03592                            << \textcolor{stringliteral}{"{}\(\backslash\)nMaximum number of iterations: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03593}03593                            << this-\/>\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}} << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of rows: "{}} << n\_row}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03594}03594                            << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03595}03595 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03596}03596       \textcolor{comment}{// Throw the error message}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03597}03597       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03598}03598                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03599}03599                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03600}03600     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03601}03601 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03602}03602 \textcolor{preprocessor}{\#ifdef PARANOID}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03603}03603     \textcolor{comment}{// Loop over the real and imaginary parts}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03604}03604     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03605}03605     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03606}03606       \textcolor{comment}{// PARANOID check that if the matrix is distributable then it should not}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03607}03607       \textcolor{comment}{// be then it should not be distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03608}03608       \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03609}03609             this-\/>Matrices\_storage\_pt[dof\_type]) != 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03610}03610       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03611}03611         \textcolor{keywordflow}{if} (\textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject}{DistributableLinearAlgebraObject}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03612}03612               this-\/>Matrices\_storage\_pt[dof\_type])}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03613}03613               -\/>distributed())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03614}03614         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03615}03615           std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03616}03616           error\_message\_stream << \textcolor{stringliteral}{"{}The matrix must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03617}03617           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03618}03618                               OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03619}03619                               OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03620}03620         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03621}03621       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03622}03622     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03623}03623     \textcolor{comment}{// PARANOID check that this rhs distribution is setup}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03624}03624     \textcolor{keywordflow}{if} (!rhs.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03625}03625     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03626}03626       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03627}03627       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector distribution must be setup."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03628}03628       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03629}03629                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03630}03630                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03631}03631     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03632}03632     \textcolor{comment}{// PARANOID check that the rhs has the right number of global rows}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03633}03633     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_a7569556f14fd68b28508920e89bd5eee}{nrow}}() != 2 * n\_row)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03634}03634     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03635}03635       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03636}03636       error\_message\_stream << \textcolor{stringliteral}{"{}RHS does not have the same dimension as the"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03637}03637                            << \textcolor{stringliteral}{"{} linear system"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03638}03638       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03639}03639                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03640}03640                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03641}03641     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03642}03642     \textcolor{comment}{// PARANOID check that the rhs is not distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03643}03643     \textcolor{keywordflow}{if} (rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1LinearAlgebraDistribution_a05842d032d28880ae37951deae804ad8}{distributed}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03644}03644     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03645}03645       std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03646}03646       error\_message\_stream << \textcolor{stringliteral}{"{}The rhs vector must not be distributed."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03647}03647       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03648}03648                           OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03649}03649                           OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03650}03650     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03651}03651     \textcolor{comment}{// PARANOID check that if the result is setup it matches the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03652}03652     \textcolor{comment}{// of the rhs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03653}03653     \textcolor{keywordflow}{if} (solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03654}03654     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03655}03655       \textcolor{keywordflow}{if} (!(*rhs.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}() == *solution.\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{distribution\_pt}}()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03656}03656       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03657}03657         std::ostringstream error\_message\_stream;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03658}03658         error\_message\_stream << \textcolor{stringliteral}{"{}If the result distribution is setup then it "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03659}03659                              << \textcolor{stringliteral}{"{}must be the same as the rhs distribution"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03660}03660         \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(error\_message\_stream.str(),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03661}03661                             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03662}03662                             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03663}03663       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03664}03664     \} \textcolor{comment}{// if (solution[dof\_type].built())}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03665}03665 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03666}03666 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03667}03667     \textcolor{comment}{// Set up the solution distribution if it's not already distributed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03668}03668     \textcolor{keywordflow}{if} (!solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_aae402d422ec4344a4a45cdb7659b7161}{built}}())}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03669}03669     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03670}03670       \textcolor{comment}{// Build the distribution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03671}03671       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a7bcc94c157d6853a0f0502e8a76ed380}{build}}(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03672}03672     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03673}03673     \textcolor{comment}{// Otherwise initialise all entries to zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03674}03674     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03675}03675     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03676}03676       \textcolor{comment}{// Initialise the entries in the k-\/th vector in solution to zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03677}03677       solution.\mbox{\hyperlink{classoomph_1_1DoubleVector_a180c1057a29f4ed721da46040a619ecd}{initialise}}(0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03678}03678     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03679}03679 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03680}03680     \textcolor{comment}{// Create a vector of DoubleVectors (this is a distributed vector so we have}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03681}03681     \textcolor{comment}{// to create two separate DoubleVector objects to cope with the arithmetic)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03682}03682     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_solution(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03683}03683 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03684}03684     \textcolor{comment}{// Create a vector of DoubleVectors (this is a distributed vector so we have}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03685}03685     \textcolor{comment}{// to create two separate DoubleVector objects to cope with the arithmetic)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03686}03686     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_rhs(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03687}03687 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03688}03688     \textcolor{comment}{// Build the distribution of both vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03689}03689     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03690}03690     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03691}03691       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03692}03692       block\_solution[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03693}03693                                      0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03694}03694 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03695}03695       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03696}03696       block\_rhs[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03697}03697     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03698}03698 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03699}03699     \textcolor{comment}{// Grab the solution vector in block form}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03700}03700     this-\/>get\_block\_vectors(solution, block\_solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03701}03701 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03702}03702     \textcolor{comment}{// Grab the RHS vector in block form}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03703}03703     this-\/>get\_block\_vectors(rhs, block\_rhs);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03704}03704 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03705}03705     \textcolor{comment}{// Start the solver timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03706}03706     \textcolor{keywordtype}{double} t\_start = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03707}03707 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03708}03708     \textcolor{comment}{// Storage for the relative residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03709}03709     \textcolor{keywordtype}{double} resid;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03710}03710 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03711}03711     \textcolor{comment}{// Initialise vectors (since these are not distributed vectors we template}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03712}03712     \textcolor{comment}{// one vector by the type std::complex<double> instead of using two vectors,}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03713}03713     \textcolor{comment}{// each templated by the type double}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03714}03714 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03715}03715     \textcolor{comment}{// Vector, s, used in the minimisation problem: J(y)=min||s-\/R\_m*y||}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03716}03716     \textcolor{comment}{// [see Saad Y."{}Iterative methods for sparse linear systems"{}, p.176.]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03717}03717     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03718}03718 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03719}03719     \textcolor{comment}{// Vector to store the value of cos(theta) when using the Givens rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03720}03720     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> cs(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03721}03721 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03722}03722     \textcolor{comment}{// Vector to store the value of sin(theta) when using the Givens rotation}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03723}03723     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<std::complex<double>}}> sn(n\_row + 1, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03724}03724 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03725}03725     \textcolor{comment}{// Create a vector of DoubleVectors (this is a distributed vector so we have}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03726}03726     \textcolor{comment}{// to create two separate DoubleVector objects to cope with the arithmetic)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03727}03727     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_w(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03728}03728 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03729}03729     \textcolor{comment}{// Build the distribution of both vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03730}03730     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03731}03731     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03732}03732       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03733}03733       block\_w[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03734}03734     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03735}03735 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03736}03736     \textcolor{comment}{// Set up the preconditioner only if we're not re-\/solving}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03737}03737     \textcolor{keywordflow}{if} (!(this-\/>Resolving))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03738}03738     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03739}03739       \textcolor{comment}{// Only set up the preconditioner before solve if required}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03740}03740       \textcolor{keywordflow}{if} (this-\/>Setup\_preconditioner\_before\_solve)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03741}03741       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03742}03742         \textcolor{comment}{// Set up the preconditioner from the Jacobian matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03743}03743         \textcolor{keywordtype}{double} t\_start\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03744}03744 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03745}03745         \textcolor{comment}{// Use the setup function in the Preconditioner class}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03746}03746         this-\/>preconditioner\_pt()-\/>setup(\textcolor{keyword}{dynamic\_cast<}MATRIX*\textcolor{keyword}{>}(matrix\_pt));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03747}03747 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03748}03748         \textcolor{comment}{// Doc time for setup of preconditioner}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03749}03749         \textcolor{keywordtype}{double} t\_end\_prec = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03750}03750         this-\/>Preconditioner\_setup\_time = t\_end\_prec -\/ t\_start\_prec;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03751}03751 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03752}03752         \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03753}03753         \textcolor{keywordflow}{if} (this-\/>Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03754}03754         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03755}03755           \textcolor{comment}{// Output the time taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03756}03756           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for setup of preconditioner [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03757}03757                      << this-\/>Preconditioner\_setup\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03758}03758         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03759}03759       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03760}03760     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03761}03761     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03762}03762     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03763}03763       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03764}03764       \textcolor{keywordflow}{if} (this-\/>Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03765}03765       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03766}03766         \textcolor{comment}{// Notify the user}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03767}03767         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Setup of preconditioner is bypassed in resolve mode"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03768}03768                    << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03769}03769       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03770}03770     \} \textcolor{comment}{// if (!Resolving) else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03771}03771 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03772}03772     \textcolor{comment}{// Create a vector of DoubleVectors to store the RHS of b-\/Jx=Mr. We assume}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03773}03773     \textcolor{comment}{// both x=0 and that a preconditioner is not applied by which we deduce b=r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03774}03774     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<DoubleVector>}} block\_r(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03775}03775 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03776}03776     \textcolor{comment}{// Build the distribution of both vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03777}03777     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03778}03778     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03779}03779       \textcolor{comment}{// Build the distribution of the k-\/th constituent vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03780}03780       block\_r[dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03781}03781     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03782}03782 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03783}03783     \textcolor{comment}{// Store the value of b (the RHS vector) in r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03784}03784     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03785}03785     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03786}03786       \textcolor{comment}{// Copy the entries of rhs into r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03787}03787       block\_r[dof\_type] = block\_rhs[dof\_type];}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03788}03788     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03789}03789 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03790}03790     \textcolor{comment}{// Calculate the norm of the real part of r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03791}03791     \textcolor{keywordtype}{double} norm\_r = block\_r[0].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03792}03792 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03793}03793     \textcolor{comment}{// Calculate the norm of the imaginary part of r}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03794}03794     \textcolor{keywordtype}{double} norm\_c = block\_r[1].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03795}03795 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03796}03796     \textcolor{comment}{// Compute norm(r)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03797}03797     \textcolor{keywordtype}{double} normb = sqrt(pow(norm\_r, 2.0) + pow(norm\_c, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03798}03798 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03799}03799     \textcolor{comment}{// Set the value of beta (the initial residual)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03800}03800     \textcolor{keywordtype}{double} beta = normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03801}03801 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03802}03802     \textcolor{comment}{// Compute the initial relative residual. If the entries of the RHS vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03803}03803     \textcolor{comment}{// are all zero then set normb equal to one. This is because we divide the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03804}03804     \textcolor{comment}{// value of the norm at later stages by normb and dividing by zero is not}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03805}03805     \textcolor{comment}{// definied}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03806}03806     \textcolor{keywordflow}{if} (normb == 0.0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03807}03807     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03808}03808       \textcolor{comment}{// Set the value of normb}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03809}03809       normb = 1.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03810}03810     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03811}03811 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03812}03812     \textcolor{comment}{// Calculate the ratio between the initial norm and the current norm.}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03813}03813     \textcolor{comment}{// Since we haven't completed an iteration yet this will simply be one}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03814}03814     \textcolor{comment}{// unless normb was zero, in which case resid will have value zero}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03815}03815     resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03816}03816 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03817}03817     \textcolor{comment}{// If required, will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03818}03818     \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03819}03819     \textcolor{keywordflow}{if} (this-\/>Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03820}03820     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03821}03821       \textcolor{comment}{// If an output file which is open isn't provided then output to screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03822}03822       \textcolor{keywordflow}{if} (!(this-\/>Output\_file\_stream.is\_open()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03823}03823       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03824}03824         \textcolor{comment}{// Output the residual value to the screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03825}03825         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03826}03826       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03827}03827       \textcolor{comment}{// Otherwise, output to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03828}03828       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03829}03829       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03830}03830         \textcolor{comment}{// Output the residual value to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03831}03831         this-\/>Output\_file\_stream << 0 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03832}03832       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03833}03833     \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03834}03834 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03835}03835     \textcolor{comment}{// If the GMRES algorithm converges immediately}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03836}03836     \textcolor{keywordflow}{if} (resid <= this-\/>Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03837}03837     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03838}03838       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03839}03839       \textcolor{keywordflow}{if} (this-\/>Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03840}03840       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03841}03841         \textcolor{comment}{// Notify the user}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03842}03842         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}FGMRES converged immediately. Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03843}03843                    << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03844}03844       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03845}03845 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03846}03846       \textcolor{comment}{// Finish running the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03847}03847       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03848}03848     \} \textcolor{comment}{// if (resid<=Tolerance)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03849}03849 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03850}03850     \textcolor{comment}{// Initialise a vector of orthogonal basis vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03851}03851     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<DoubleVector>}}> block\_v;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03852}03852 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03853}03853     \textcolor{comment}{// Resize the number of vectors needed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03854}03854     block\_v.resize(n\_row + 1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03855}03855 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03856}03856     \textcolor{comment}{// Create a vector of DoubleVectors (stores the preconditioned vectors)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03857}03857     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<DoubleVector>}}> block\_z;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03858}03858 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03859}03859     \textcolor{comment}{// Resize the number of vectors needed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03860}03860     block\_z.resize(n\_row + 1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03861}03861 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03862}03862     \textcolor{comment}{// Resize each Vector of DoubleVectors to store the real and imaginary}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03863}03863     \textcolor{comment}{// part of a given vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03864}03864     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row + 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03865}03865     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03866}03866       \textcolor{comment}{// Create space for two DoubleVector objects in each Vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03867}03867       block\_v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].resize(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03868}03868 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03869}03869       \textcolor{comment}{// Create space for two DoubleVector objects in each Vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03870}03870       block\_z[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].resize(n\_dof\_types);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03871}03871     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03872}03872 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03873}03873     \textcolor{comment}{// Initialise the upper hessenberg matrix. Since we are not using}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03874}03874     \textcolor{comment}{// distributed vectors here, the algebra is best done using entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03875}03875     \textcolor{comment}{// of the type std::complex<double>. NOTE: For implementation purposes}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03876}03876     \textcolor{comment}{// the upper Hessenberg matrix indices are swapped so the matrix is}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03877}03877     \textcolor{comment}{// effectively transposed}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03878}03878     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<Vector<std::complex<double>}}>> hessenberg(n\_row + 1);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03879}03879 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03880}03880     \textcolor{comment}{// Build the zeroth basis vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03881}03881     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03882}03882     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03883}03883       \textcolor{comment}{// Build the k-\/th part of the zeroth vector. Here k=0 and k=1 correspond}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03884}03884       \textcolor{comment}{// to the real and imaginary part of the zeroth vector, respectively}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03885}03885       block\_v[0][dof\_type].build(this-\/>block\_distribution\_pt(dof\_type), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03886}03886     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03887}03887 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03888}03888     \textcolor{comment}{// Loop over the real and imaginary parts of v}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03889}03889     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03890}03890     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03891}03891       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03892}03892       \textcolor{keywordtype}{double}* block\_v0\_pt = block\_v[0][dof\_type].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03893}03893 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03894}03894       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03895}03895       \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_r\_pt = block\_r[dof\_type].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03896}03896 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03897}03897       \textcolor{comment}{// Set the zeroth basis vector v[0] to r/beta}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03898}03898       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < n\_row; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03899}03899       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03900}03900         \textcolor{comment}{// Assign the i-\/th entry of the zeroth basis vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03901}03901         block\_v0\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = block\_r\_pt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] / beta;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03902}03902       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03903}03903     \} \textcolor{comment}{// for (unsigned k=0;k<n\_dof\_types;k++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03904}03904 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03905}03905     \textcolor{comment}{// Set the first entry in the minimisation problem RHS vector (is meant}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03906}03906     \textcolor{comment}{// to the vector beta*e\_1 initially, where e\_1 is the unit vector with}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03907}03907     \textcolor{comment}{// one in its first entry)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03908}03908     \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[0] = beta;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03909}03909 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03910}03910     \textcolor{comment}{// Compute the next step of the iterative scheme}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03911}03911     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < this-\/>\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}}; j++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03912}03912     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03913}03913       \textcolor{comment}{// Resize the next column of the upper hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03914}03914       hessenberg[j].resize(j + 2, std::complex<double>(0.0, 0.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03915}03915 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03916}03916       \textcolor{comment}{// Calculate w\_j=Jz\_j where z\_j=M\string^\{-\/1\}v\_j (RHS prec.)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03917}03917       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03918}03918         \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03919}03919         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} vj(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03920}03920 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03921}03921         \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03922}03922         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} zj(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03923}03923 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03924}03924         \textcolor{comment}{// Create a temporary vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03925}03925         \mbox{\hyperlink{classoomph_1_1DoubleVector}{DoubleVector}} w(\mbox{\hyperlink{classoomph_1_1DistributableLinearAlgebraObject_abfa9cf25494c796d62b15bad586fab47}{IterativeLinearSolver::distribution\_pt}}(), 0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03926}03926 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03927}03927         \textcolor{comment}{// Create two DoubleVectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03928}03928         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03929}03929         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03930}03930           \textcolor{comment}{// Build the k-\/th part of the j-\/th preconditioning result vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03931}03931           block\_z[j][dof\_type].build(this-\/>block\_distribution\_pt(dof\_type),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03932}03932                                      0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03933}03933         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03934}03934 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03935}03935         \textcolor{comment}{// Copy the real and imaginary part of v[j] into one vector, vj}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03936}03936         this-\/>return\_block\_vectors(block\_v[j], vj);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03937}03937 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03938}03938         \textcolor{comment}{// Calculate z\_j=M\string^\{-\/1\}v\_j by saad p270}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03939}03939         this-\/>preconditioner\_pt()-\/>preconditioner\_solve(vj, zj);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03940}03940 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03941}03941         \textcolor{comment}{// Copy zj into z[j][0] and z[j][1]}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03942}03942         this-\/>get\_block\_vectors(zj, block\_z[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03943}03943 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03944}03944         \textcolor{comment}{// Calculate w\_j=J*(M\string^\{-\/1\}v\_j). Note, we cannot use inbuilt complex}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03945}03945         \textcolor{comment}{// matrix algebra here as we're using distributed vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03946}03946         this-\/>complex\_matrix\_multiplication(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03947}03947           this-\/>Matrices\_storage\_pt, block\_z[j], block\_w);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03948}03948       \} \textcolor{comment}{// Calculate w=JM\string^\{-\/1\}v (RHS prec.)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03949}03949 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03950}03950       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03951}03951       \textcolor{keywordtype}{double}* block\_w\_r\_pt = block\_w[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03952}03952 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03953}03953       \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03954}03954       \textcolor{keywordtype}{double}* block\_w\_c\_pt = block\_w[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03955}03955 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03956}03956       \textcolor{comment}{// Loop over all of the entries on and above the principal subdiagonal of}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03957}03957       \textcolor{comment}{// the Hessenberg matrix in the j-\/th column (remembering that}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03958}03958       \textcolor{comment}{// the indices of the upper Hessenberg matrix are swapped for the purpose}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03959}03959       \textcolor{comment}{// of implementation)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03960}03960       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < j + 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03961}03961       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03962}03962         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03963}03963         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_vi\_r\_pt = block\_v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03964}03964 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03965}03965         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03966}03966         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_vi\_c\_pt = block\_v[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03967}03967 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03968}03968         \textcolor{comment}{// Loop over the entries of v and w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03969}03969         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03970}03970         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03971}03971           \textcolor{comment}{// Store the appropriate entry in v as a complex value}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03972}03972           std::complex<double> complex\_v(block\_vi\_r\_pt[k], block\_vi\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03973}03973 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03974}03974           \textcolor{comment}{// Store the appropriate entry in w as a complex value}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03975}03975           std::complex<double> complex\_w(block\_w\_r\_pt[k], block\_w\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03976}03976 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03977}03977           \textcolor{comment}{// Update the value of H(i,j) noting we're computing a complex}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03978}03978           \textcolor{comment}{// inner product here (the ordering is very important here!)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03979}03979           hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += std::conj(complex\_v) * complex\_w;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03980}03980         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03981}03981 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03982}03982         \textcolor{comment}{// Orthonormalise w against all previous orthogonal vectors, v\_i by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03983}03983         \textcolor{comment}{// looping over its entries and updating them}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03984}03984         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03985}03985         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03986}03986           \textcolor{comment}{// Update the real part of the k-\/th entry of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03987}03987           block\_w\_r\_pt[k] -\/= (hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].real() * block\_vi\_r\_pt[k] -\/}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03988}03988                               hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].imag() * block\_vi\_c\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03989}03989 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03990}03990           \textcolor{comment}{// Update the imaginary part of the k-\/th entry of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03991}03991           block\_w\_c\_pt[k] -\/= (hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].real() * block\_vi\_c\_pt[k] +}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03992}03992                               hessenberg[j][\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].imag() * block\_vi\_r\_pt[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03993}03993         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03994}03994       \} \textcolor{comment}{// for (unsigned i=0;i<j+1;i++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03995}03995 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03996}03996       \textcolor{comment}{// Calculate the norm of the real part of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03997}03997       norm\_r = block\_w[0].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03998}03998 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l03999}03999       \textcolor{comment}{// Calculate the norm of the imaginary part of w}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04000}04000       norm\_c = block\_w[1].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04001}04001 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04002}04002       \textcolor{comment}{// Calculate the norm of the vector w using norm\_r and norm\_c and assign}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04003}04003       \textcolor{comment}{// its value to the appropriate entry in the Hessenberg matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04004}04004       hessenberg[j][j + 1] = sqrt(pow(norm\_r, 2.0) + pow(norm\_c, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04005}04005 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04006}04006       \textcolor{comment}{// Build the (j+1)-\/th basis vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04007}04007       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} dof\_type = 0; dof\_type < n\_dof\_types; dof\_type++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04008}04008       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04009}04009         \textcolor{comment}{// Build the k-\/th part of the zeroth vector. Here k=0 and k=1 correspond}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04010}04010         \textcolor{comment}{// to the real and imaginary part of the zeroth vector, respectively}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04011}04011         block\_v[j + 1][dof\_type].build(this-\/>block\_distribution\_pt(dof\_type),}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04012}04012                                        0.0);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04013}04013       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04014}04014 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04015}04015       \textcolor{comment}{// Check if the value of hessenberg[j][j+1] is zero. If it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04016}04016       \textcolor{comment}{// isn't then we update the next entries in v}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04017}04017       \textcolor{keywordflow}{if} (hessenberg[j][j + 1] != 0.0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04018}04018       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04019}04019         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04020}04020         \textcolor{keywordtype}{double}* block\_v\_r\_pt = block\_v[j + 1][0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04021}04021 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04022}04022         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04023}04023         \textcolor{keywordtype}{double}* block\_v\_c\_pt = block\_v[j + 1][1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04024}04024 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04025}04025         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04026}04026         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_w\_r\_pt = block\_w[0].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04027}04027 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04028}04028         \textcolor{comment}{// For fast access}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04029}04029         \textcolor{keyword}{const} \textcolor{keywordtype}{double}* block\_w\_c\_pt = block\_w[1].values\_pt();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04030}04030 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04031}04031         \textcolor{comment}{// Notice, the value of H(j,j+1), as calculated above, is clearly a real}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04032}04032         \textcolor{comment}{// number. As such, calculating the division}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04033}04033         \textcolor{comment}{//                      v\_\{j+1\}=w\_\{j\}/h\_\{j+1,j\},}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04034}04034         \textcolor{comment}{// here is simple, i.e. we don't need to worry about cross terms in the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04035}04035         \textcolor{comment}{// algebra. To avoid computing h\_\{j+1,j\} several times we precompute it}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04036}04036         \textcolor{keywordtype}{double} h\_subdiag\_val = hessenberg[j][j + 1].real();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04037}04037 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04038}04038         \textcolor{comment}{// Loop over the entries of the new orthogonal vector and set its values}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04039}04039         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < n\_row; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04040}04040         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04041}04041           \textcolor{comment}{// The i-\/th entry of the real component is given by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04042}04042           block\_v\_r\_pt[k] = block\_w\_r\_pt[k] / h\_subdiag\_val;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04043}04043 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04044}04044           \textcolor{comment}{// Similarly, the i-\/th entry of the imaginary component is given by}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04045}04045           block\_v\_c\_pt[k] = block\_w\_c\_pt[k] / h\_subdiag\_val;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04046}04046         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04047}04047       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04048}04048       \textcolor{comment}{// Otherwise, we have to jump to the next part of the algorithm; if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04049}04049       \textcolor{comment}{// the value of hessenberg[j][j+1] is zero then the norm of the latest}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04050}04050       \textcolor{comment}{// orthogonal vector is zero. This is only possible if the entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04051}04051       \textcolor{comment}{// in w are all zero. As a result, the Krylov space of A and r\_0 has}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04052}04052       \textcolor{comment}{// been spanned by the previously calculated orthogonal vectors}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04053}04053       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04054}04054       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04055}04055         \textcolor{comment}{// Book says "{}Set m=j and jump to step 11"{} (p.172)...}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04056}04056         \textcolor{comment}{// Do something here!}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04057}04057         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Subdiagonal Hessenberg entry is zero. "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04058}04058                    << \textcolor{stringliteral}{"{}Do something here..."{}} << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04059}04059       \} \textcolor{comment}{// if (hessenberg[j][j+1]!=0.0)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04060}04060 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04061}04061       \textcolor{comment}{// Loop over the entries in the Hessenberg matrix and calculate the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04062}04062       \textcolor{comment}{// entries of the Givens rotation matrices}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04063}04063       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} k = 0; k < j; k++)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04064}04064       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04065}04065         \textcolor{comment}{// Apply the plane rotation to all of the previous entries in the}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04066}04066         \textcolor{comment}{// (j)-\/th column (remembering the indexing is reversed)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04067}04067         this-\/>apply\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04068}04068           hessenberg[j][k], hessenberg[j][k + 1], cs[k], sn[k]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04069}04069       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04070}04070 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04071}04071       \textcolor{comment}{// Now calculate the entries of the latest Givens rotation matrix}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04072}04072       this-\/>generate\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04073}04073         hessenberg[j][j], hessenberg[j][j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04074}04074 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04075}04075       \textcolor{comment}{// Apply the plane rotation using the newly calculated entries}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04076}04076       this-\/>apply\_plane\_rotation(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04077}04077         hessenberg[j][j], hessenberg[j][j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04078}04078 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04079}04079       \textcolor{comment}{// Apply a plane rotation to the corresponding entry in the vector}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04080}04080       \textcolor{comment}{// s used in the minimisation problem, J(y)=min||s-\/R\_m*y||}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04081}04081       this-\/>apply\_plane\_rotation(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j], \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j + 1], cs[j], sn[j]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04082}04082 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04083}04083       \textcolor{comment}{// Compute current residual using equation (6.42) in Saad Y, "{}Iterative}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04084}04084       \textcolor{comment}{// methods for sparse linear systems"{}, p.177.]. Note, since s has complex}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04085}04085       \textcolor{comment}{// entries we have to use std::abs instead of std::fabs}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04086}04086       beta = std::abs(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[j + 1]);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04087}04087 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04088}04088       \textcolor{comment}{// Compute the relative residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04089}04089       resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04090}04090 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04091}04091       \textcolor{comment}{// If required will document convergence history to screen or file (if}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04092}04092       \textcolor{comment}{// stream open)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04093}04093       \textcolor{keywordflow}{if} (this-\/>Doc\_convergence\_history)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04094}04094       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04095}04095         \textcolor{comment}{// If an output file which is open isn't provided then output to screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04096}04096         \textcolor{keywordflow}{if} (!(this-\/>Output\_file\_stream.is\_open()))}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04097}04097         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04098}04098           \textcolor{comment}{// Output the residual value to the screen}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04099}04099           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << j + 1 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04100}04100         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04101}04101         \textcolor{comment}{// Otherwise, output to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04102}04102         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04103}04103         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04104}04104           \textcolor{comment}{// Output the residual value to file}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04105}04105           this-\/>Output\_file\_stream << j + 1 << \textcolor{stringliteral}{"{} "{}} << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04106}04106         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04107}04107       \} \textcolor{comment}{// if (Doc\_convergence\_history)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04108}04108 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04109}04109       \textcolor{comment}{// If the required tolerance has been met}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04110}04110       \textcolor{keywordflow}{if} (resid < this-\/>Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04111}04111       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04112}04112         \textcolor{comment}{// Store the number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04113}04113         this-\/>Iterations = j + 1;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04114}04114 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04115}04115         \textcolor{comment}{// Update the result vector using the result, x=x\_0+V\_m*y (where V\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04116}04116         \textcolor{comment}{// is given by v here)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04117}04117         update(j, hessenberg, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, block\_z, block\_solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04118}04118 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04119}04119         \textcolor{comment}{// Copy the vectors in block\_solution to solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04120}04120         this-\/>return\_block\_vectors(block\_solution, solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04121}04121 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04122}04122         \textcolor{comment}{// If time documentation was enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04123}04123         \textcolor{keywordflow}{if} (this-\/>Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04124}04124         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04125}04125           \textcolor{comment}{// Output the current normalised residual norm}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04126}04126           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nFGMRES converged (1). Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04127}04127                      << resid << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04128}04128 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04129}04129           \textcolor{comment}{// Output the number of iterations it took for convergence}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04130}04130           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Number of iterations to convergence: "{}} << j + 1 << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04131}04131                      << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04132}04132         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04133}04133 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04134}04134         \textcolor{comment}{// Stop the timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04135}04135         \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04136}04136 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04137}04137         \textcolor{comment}{// Calculate the time taken to calculate the solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04138}04138         this-\/>Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04139}04139 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04140}04140         \textcolor{comment}{// If time documentation was enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04141}04141         \textcolor{keywordflow}{if} (this-\/>Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04142}04142         \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04143}04143           \textcolor{comment}{// Output the time taken to solve the problem using GMRES}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04144}04144           \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with FGMRES [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04145}04145                      << this-\/>Solution\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04146}04146         \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04147}04147 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04148}04148         \textcolor{comment}{// As we've met the tolerance for the solver and everything that should}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04149}04149         \textcolor{comment}{// be documented, has been, finish using the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04150}04150         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04151}04151       \} \textcolor{comment}{// if (resid<Tolerance)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04152}04152     \} \textcolor{comment}{// for (unsigned j=0;j<Max\_iter;j++)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04153}04153 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04154}04154     \textcolor{comment}{// Store the number of iterations taken}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04155}04155     this-\/>Iterations = this-\/>\mbox{\hyperlink{namespaceoomph_1_1BlackBoxFDNewtonSolver_a20ac8568daf0d63afa3945a817ff3e2d}{Max\_iter}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04156}04156 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04157}04157     \textcolor{comment}{// Only update if we actually did something}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04158}04158     \textcolor{keywordflow}{if} (this-\/>Max\_iter > 0)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04159}04159     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04160}04160       \textcolor{comment}{// Update the result vector using the result, x=x\_0+V\_m*y (where V\_m}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04161}04161       \textcolor{comment}{// is given by v here)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04162}04162       update(this-\/>Max\_iter -\/ 1, hessenberg, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, block\_z, block\_solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04163}04163 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04164}04164       \textcolor{comment}{// Copy the vectors in block\_solution to solution}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04165}04165       this-\/>return\_block\_vectors(block\_solution, solution);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04166}04166     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04167}04167 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04168}04168     \textcolor{comment}{// Compute the current residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04169}04169     beta = 0.0;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04170}04170 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04171}04171     \textcolor{comment}{// Get access to the values pointer (real)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04172}04172     norm\_r = block\_r[0].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04173}04173 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04174}04174     \textcolor{comment}{// Get access to the values pointer (imaginary)}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04175}04175     norm\_c = block\_r[1].norm();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04176}04176 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04177}04177     \textcolor{comment}{// Calculate the full norm}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04178}04178     beta = sqrt(pow(norm\_r, 2.0) + pow(norm\_c, 2.0));}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04179}04179 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04180}04180     \textcolor{comment}{// Calculate the relative residual}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04181}04181     resid = beta / normb;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04182}04182 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04183}04183     \textcolor{comment}{// If the relative residual lies within tolerance}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04184}04184     \textcolor{keywordflow}{if} (resid < this-\/>Tolerance)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04185}04185     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04186}04186       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04187}04187       \textcolor{keywordflow}{if} (this-\/>Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04188}04188       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04189}04189         \textcolor{comment}{// Notify the user}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04190}04190         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nFGMRES converged (2). Normalised residual norm: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04191}04191                    << resid << \textcolor{stringliteral}{"{}\(\backslash\)nNumber of iterations to convergence: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04192}04192                    << this-\/>Iterations << \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04193}04193                    << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04194}04194       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04195}04195 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04196}04196       \textcolor{comment}{// End the timer}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04197}04197       \textcolor{keywordtype}{double} t\_end = \mbox{\hyperlink{namespaceoomph_1_1TimingHelpers_a9fb6ad7e2e01b0914e9f7072ef9ebfa6}{TimingHelpers::timer}}();}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04198}04198 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04199}04199       \textcolor{comment}{// Calculate the time taken for the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04200}04200       this-\/>Solution\_time = t\_end -\/ t\_start;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04201}04201 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04202}04202       \textcolor{comment}{// If time documentation is enabled}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04203}04203       \textcolor{keywordflow}{if} (this-\/>Doc\_time)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04204}04204       \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04205}04205         \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}Time for solve with FGMRES [sec]: "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04206}04206                    << this-\/>Solution\_time << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04207}04207       \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04208}04208       \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04209}04209     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04210}04210 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04211}04211     \textcolor{comment}{// Otherwise GMRES failed convergence}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04212}04212     \mbox{\hyperlink{namespaceoomph_aec474227917784dc0a255faf289cfc16}{oomph\_info}} << \textcolor{stringliteral}{"{}\(\backslash\)nFGMRES did not converge to required tolerance! "{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04213}04213                << \textcolor{stringliteral}{"{}\(\backslash\)nReturning with normalised residual norm: "{}} << resid}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04214}04214                << \textcolor{stringliteral}{"{}\(\backslash\)nafter "{}} << this-\/>Max\_iter << \textcolor{stringliteral}{"{} iterations.\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04215}04215                << std::endl;}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04216}04216 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04217}04217     \textcolor{comment}{// Throw an error if requested}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04218}04218     \textcolor{keywordflow}{if} (this-\/>Throw\_error\_after\_max\_iter)}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04219}04219     \{}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04220}04220       \mbox{\hyperlink{namespaceoomph_1_1Global__string__for__annotation_ac5379de2fa7fe44f2cb31785fc208135}{std::string}} err = \textcolor{stringliteral}{"{}Solver failed to converge and you requested an error"{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04221}04221       err += \textcolor{stringliteral}{"{} on convergence failures."{}};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04222}04222       \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04223}04223         err, OOMPH\_EXCEPTION\_LOCATION, OOMPH\_CURRENT\_FUNCTION);}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04224}04224     \}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04225}04225 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04226}04226     \textcolor{comment}{// Finish using the solver}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04227}04227     \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04228}04228   \} \textcolor{comment}{// End of solve\_helper}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04229}04229 \} \textcolor{comment}{// End of namespace oomph}}
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04230}04230 }
\DoxyCodeLine{\Hypertarget{complex__smoother_8h_source_l04231}04231 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
