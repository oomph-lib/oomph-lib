\hypertarget{refineable__spherical__navier__stokes__elements_8cc_source}{}\doxysection{refineable\+\_\+spherical\+\_\+navier\+\_\+stokes\+\_\+elements.\+cc}
\label{refineable__spherical__navier__stokes__elements_8cc_source}\index{refineable\_spherical\_navier\_stokes\_elements.cc@{refineable\_spherical\_navier\_stokes\_elements.cc}}
\mbox{\hyperlink{refineable__spherical__navier__stokes__elements_8cc}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00001}00001 \textcolor{comment}{// LIC// ====================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00002}00002 \textcolor{comment}{// LIC// This file forms part of oomph-\/lib, the object-\/oriented,}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00003}00003 \textcolor{comment}{// LIC// multi-\/physics finite-\/element library, available}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00004}00004 \textcolor{comment}{// LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00005}00005 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00006}00006 \textcolor{comment}{// LIC// Copyright (C) 2006-\/2022 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00007}00007 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00008}00008 \textcolor{comment}{// LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00009}00009 \textcolor{comment}{// LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00010}00010 \textcolor{comment}{// LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00011}00011 \textcolor{comment}{// LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00012}00012 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00013}00013 \textcolor{comment}{// LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00014}00014 \textcolor{comment}{// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00015}00015 \textcolor{comment}{// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00016}00016 \textcolor{comment}{// LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00017}00017 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00018}00018 \textcolor{comment}{// LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00019}00019 \textcolor{comment}{// LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00020}00020 \textcolor{comment}{// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00021}00021 \textcolor{comment}{// LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00022}00022 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00023}00023 \textcolor{comment}{// LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00024}00024 \textcolor{comment}{// LIC//}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00025}00025 \textcolor{comment}{// LIC//====================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00026}00026 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{refineable__spherical__navier__stokes__elements_8h}{refineable\_spherical\_navier\_stokes\_elements.h}}"{}}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00029}00029 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceoomph}{oomph}}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00030}00030 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00031}00031   \textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00032}00032 \textcolor{comment}{  /// Add element's contribution to the elemental}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00033}00033 \textcolor{comment}{  /// residual vector and/or Jacobian matrix.}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00034}00034 \textcolor{comment}{  /// flag=1: compute both}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00035}00035 \textcolor{comment}{  /// flag=0: compute only residual vector}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00036}00036 \textcolor{comment}{}  \textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00037}\mbox{\hyperlink{classoomph_1_1RefineableSphericalNavierStokesEquations_aaadda4a5dbffc1e23db2ac8b3dd86d4a}{00037}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{classoomph_1_1RefineableSphericalNavierStokesEquations_aaadda4a5dbffc1e23db2ac8b3dd86d4a}{RefineableSphericalNavierStokesEquations::}}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00038}00038 \mbox{\hyperlink{classoomph_1_1RefineableSphericalNavierStokesEquations_aaadda4a5dbffc1e23db2ac8b3dd86d4a}{    fill\_in\_generic\_residual\_contribution\_spherical\_nst}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00039}00039       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}}\& residuals,}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00040}00040       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& jacobian,}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00041}00041       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}}\& mass\_matrix,}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00042}00042       \textcolor{keywordtype}{unsigned} flag)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00043}00043   \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00044}00044     \textcolor{comment}{// Find out how many nodes there are}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00045}00045     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_node = \mbox{\hyperlink{classoomph_1_1FiniteElement_a6219ed269a6d89b5aa14659cce48905a}{nnode}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00047}00047     \textcolor{comment}{// Get continuous time from timestepper of first node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00048}00048     \textcolor{keywordtype}{double} time = \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(0)-\/>\mbox{\hyperlink{classoomph_1_1Data_a065d7bffcec82bf4d4bd7b41f9aa80b3}{time\_stepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_ac73981d5a68161d7b317bebb4ee04adb}{time\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Time_a43461269b799134f4b7a9aca3e79a7c8}{time}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00049}00049 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00050}00050     \textcolor{comment}{// Find out how many pressure dofs there are}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00051}00051     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_pres = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_ae01203564bc66dacf84c1ed65e4b7930}{npres\_spherical\_nst}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00053}00053     \textcolor{comment}{// Get the local indices of the nodal coordinates}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00054}00054     \textcolor{keywordtype}{unsigned} u\_nodal\_index[3];}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00055}00055     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 3; ++\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00056}00056     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00057}00057       u\_nodal\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = this-\/>\mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a2f269e20874a87df919cc4ece4b05fe5}{u\_index\_spherical\_nst}}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00058}00058     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00059}00059 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00060}00060     \textcolor{comment}{// Which nodal value represents the pressure? (Negative if pressure}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00061}00061     \textcolor{comment}{// is not based on nodal interpolation).}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00062}00062     \textcolor{keyword}{const} \textcolor{keywordtype}{int} p\_index = this-\/>\mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a7b0edc8eedacaef9e55f3551a7cb5400}{p\_nodal\_index\_spherical\_nst}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00064}00064     \textcolor{comment}{// Local array of booleans that are true if the l-\/th pressure value is}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00065}00065     \textcolor{comment}{// hanging (avoid repeated virtual function calls)}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00066}00066     \textcolor{keywordtype}{bool} pressure\_dof\_is\_hanging[n\_pres];}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00067}00067     \textcolor{comment}{// If the pressure is stored at a node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00068}00068     \textcolor{keywordflow}{if} (p\_index >= 0)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00069}00069     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00070}00070       \textcolor{comment}{// Read out whether the pressure is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00071}00071       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_pres; ++l)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00072}00072       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00073}00073         pressure\_dof\_is\_hanging[l] = \mbox{\hyperlink{classoomph_1_1RefineableSphericalNavierStokesEquations_a022b5fab872e9b138a04c2d481b56afc}{pressure\_node\_pt}}(l)-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}(p\_index);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00074}00074       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00075}00075     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00076}00076     \textcolor{comment}{// Otherwise the pressure is not stored at a node and so cannot hang}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00077}00077     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00078}00078     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00079}00079       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_pres; ++l)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00080}00080       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00081}00081         pressure\_dof\_is\_hanging[l] = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00082}00082       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00083}00083     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00086}00086     \textcolor{comment}{// Set up memory for the shape and test functions}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00087}00087     \mbox{\hyperlink{classoomph_1_1Shape}{Shape}} psif(n\_node), testf(n\_node);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00088}00088     \mbox{\hyperlink{classoomph_1_1DShape}{DShape}} dpsifdx(n\_node, 2), dtestfdx(n\_node, 2);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00090}00090     \textcolor{comment}{// Set up memory for pressure shape and test functions}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00091}00091     \mbox{\hyperlink{classoomph_1_1Shape}{Shape}} psip(n\_pres), testp(n\_pres);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00093}00093     \textcolor{comment}{// Set the value of n\_intpt}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00094}00094     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} n\_intpt = \mbox{\hyperlink{classoomph_1_1FiniteElement_a1a4723c4ee3fe4c6404203bb987f804e}{integral\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Integral_a1a270de9d99a1fcf1d25a6c1017f65fa}{nweight}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00095}00095 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00096}00096     \textcolor{comment}{// Set the Vector to hold local coordinates}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00097}00097     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}(2);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00098}00098 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00099}00099     \textcolor{comment}{// Get Physical Variables from Element}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00100}00100     \textcolor{comment}{// Reynolds number must be multiplied by the density ratio}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00101}00101     \textcolor{keyword}{const} \textcolor{keywordtype}{double} dens\_ratio = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a85677bad4aba0227e9e2428aa3328154}{density\_ratio}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00102}00102     \textcolor{keyword}{const} \textcolor{keywordtype}{double} scaled\_re = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_af286b69344e17bff453567616347ee82}{re}}() * dens\_ratio;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00103}00103     \textcolor{keyword}{const} \textcolor{keywordtype}{double} scaled\_re\_st = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_ac6991e808873715f93017a165be289b4}{re\_st}}() * dens\_ratio;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00104}00104     \textcolor{keyword}{const} \textcolor{keywordtype}{double} scaled\_re\_inv\_ro = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_af6ec244f4a2f2d88b191d4331ab6f59c}{re\_invro}}() * dens\_ratio;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00105}00105     \textcolor{comment}{// const double scaled\_re\_inv\_fr = re\_invfr()*dens\_ratio;}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00106}00106     \textcolor{comment}{// const double visc\_ratio = viscosity\_ratio();}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00107}00107     \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} G = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a8e2be209a7fcc1418da83f908927d7ba}{g}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00108}00108 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00109}00109     \textcolor{comment}{// Integers to store the local equation and unknown numbers}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00110}00110     \textcolor{keywordtype}{int} local\_eqn = 0, local\_unknown = 0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00112}00112     \textcolor{comment}{// Local storage for pointers to hang info objects}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00113}00113     \mbox{\hyperlink{classoomph_1_1HangInfo}{HangInfo}} *hang\_info\_pt = 0, *hang\_info2\_pt = 0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00114}00114 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00115}00115     \textcolor{comment}{// Loop over the integration points}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00116}00116     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ipt = 0; ipt < n\_intpt; ipt++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00117}00117     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00118}00118       \textcolor{comment}{// Assign values of s}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00119}00119       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00120}00120       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00121}00121         \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] = \mbox{\hyperlink{classoomph_1_1FiniteElement_a1a4723c4ee3fe4c6404203bb987f804e}{integral\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Integral_a1a2122f99a87c18649bafdd9ed739758}{knot}}(ipt, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}});}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00122}00122       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00124}00124       \textcolor{comment}{// Get the integral weight}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00125}00125       \textcolor{keywordtype}{double} w = \mbox{\hyperlink{classoomph_1_1FiniteElement_a1a4723c4ee3fe4c6404203bb987f804e}{integral\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1Integral_ac65335e2aab120b285b3d6c294507b06}{weight}}(ipt);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00127}00127       \textcolor{comment}{// Call the derivatives of the shape and test functions}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00128}00128       \textcolor{keywordtype}{double} J = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a10ed6f34245f5b31095ae636fc08749a}{dshape\_and\_dtest\_eulerian\_at\_knot\_spherical\_nst}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00129}00129         ipt, psif, dpsifdx, testf, dtestfdx);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00130}00130 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00131}00131       \textcolor{comment}{// Call the pressure shape and test functions}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00132}00132       \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a17799ec1f3a1d8bbeee1d357bba0a249}{pshape\_spherical\_nst}}(\mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, psip, testp);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00133}00133 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00134}00134       \textcolor{comment}{// Premultiply the weights and the Jacobian}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00135}00135       \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} = w * J;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00136}00136 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00137}00137       \textcolor{comment}{// Calculate local values of the pressure and velocity components}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00138}00138       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00139}00139       \textcolor{keywordtype}{double} interpolated\_p = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00140}00140       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} interpolated\_u(3, 0.0);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00141}00141       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} \mbox{\hyperlink{classoomph_1_1FiniteElement_a5a9c1ead9819cd17603096e63087020f}{interpolated\_x}}(2, 0.0);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00142}00142       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} mesh\_velocity(2, 0.0);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00143}00143       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} dudt(3, 0.0);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00144}00144       \mbox{\hyperlink{classoomph_1_1DenseMatrix}{DenseMatrix<double>}} interpolated\_dudx(3, 2, 0.0);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00146}00146       \textcolor{comment}{// Calculate pressure}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00147}00147       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_pres; l++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00148}00148       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00149}00149         interpolated\_p += this-\/>\mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a5b50d547e5a2ad5896dc9612e2bb4176}{p\_spherical\_nst}}(l) * psip(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00150}00150       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00151}00151 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00152}00152       \textcolor{comment}{// Calculate velocities and derivatives}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00153}00153 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00154}00154       \textcolor{comment}{// Loop over nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00155}00155       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_node; l++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00156}00156       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00157}00157         \textcolor{comment}{// Cache the shape function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00158}00158         \textcolor{keywordtype}{double} psi\_ = psif(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00159}00159         \textcolor{comment}{// Loop over positions separately}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00160}00160         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00161}00161         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00162}00162           \mbox{\hyperlink{classoomph_1_1FiniteElement_a5a9c1ead9819cd17603096e63087020f}{interpolated\_x}}[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += \mbox{\hyperlink{classoomph_1_1FiniteElement_a9152c16ae9899168bcdaac7c2f977444}{nodal\_position}}(l, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) * psi\_;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00163}00163         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00164}00164 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00165}00165         \textcolor{comment}{// Loop over velocity directions (three of these)}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00166}00166         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 3; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00167}00167         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00168}00168           \textcolor{keyword}{const} \textcolor{keywordtype}{double} u\_value = this-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a28fd5c2d4aeba5ef65bee0e0d72569f5}{nodal\_value}}(l, u\_nodal\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00169}00169           interpolated\_u[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += u\_value * psi\_;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00170}00170           dudt[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a6f9ce7398b2f2a767fddc7473046c674}{du\_dt\_spherical\_nst}}(l, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) * psi\_;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00172}00172           \textcolor{comment}{// Loop over derivative directions for gradients}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00173}00173           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} j = 0; j < 2; j++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00174}00174           \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00175}00175             interpolated\_dudx(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j) += u\_value * dpsifdx(l, j);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00176}00176           \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00177}00177         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00178}00178 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00179}00179         \textcolor{comment}{// Only bother to calculate the mesh velocity if we are using an ALE}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00180}00180         \textcolor{comment}{// method}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00181}00181         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_ae99a23d65958a96ae2d90151b86d30ab}{ALE\_is\_disabled}})}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00182}00182         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00183}00183           \textcolor{keywordflow}{throw} \mbox{\hyperlink{classoomph_1_1OomphLibError}{OomphLibError}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00184}00184             \textcolor{stringliteral}{"{}ALE is not properly implemented for Refineable Spherical NS yet"{}},}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00185}00185             OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00186}00186             OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00187}00187 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00188}00188           \textcolor{comment}{// Loop over directions (only DIM (2) of these)}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00189}00189           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00190}00190           \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00191}00191             mesh\_velocity[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}] += this-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_adcd3fe593044db9afae4c15f85ebb175}{dnodal\_position\_dt}}(l, \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}) * psi\_;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00192}00192           \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00193}00193         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00194}00194       \} \textcolor{comment}{// End of loop over the nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00195}00195 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00196}00196       \textcolor{comment}{// Get the user-\/defined body force terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00197}00197       \mbox{\hyperlink{classoomph_1_1Vector}{Vector<double>}} body\_force(3);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00198}00198       this-\/>\mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_a6dbdc5a0b33a0f36494ffefed1a938ac}{get\_body\_force\_spherical\_nst}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00199}00199         time, ipt, \mbox{\hyperlink{cfortran_8h_ab7123126e4885ef647dd9c6e3807a21c}{s}}, \mbox{\hyperlink{classoomph_1_1FiniteElement_a5a9c1ead9819cd17603096e63087020f}{interpolated\_x}}, body\_force);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00201}00201       \textcolor{comment}{// Get the user-\/defined source function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00202}00202       \textcolor{comment}{// double}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00203}00203       \textcolor{comment}{// source=this-\/>get\_source\_spherical\_nst(time(),ipt,interpolated\_x);}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00204}00204 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00205}00205       \textcolor{comment}{// r is the first postition component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00206}00206       \textcolor{keyword}{const} \textcolor{keywordtype}{double} r = \mbox{\hyperlink{classoomph_1_1FiniteElement_a5a9c1ead9819cd17603096e63087020f}{interpolated\_x}}[0];}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00207}00207       \textcolor{keyword}{const} \textcolor{keywordtype}{double} r2 = r * r;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00208}00208       \textcolor{comment}{// const double theta = interpolated\_x[1];}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00209}00209       \textcolor{keyword}{const} \textcolor{keywordtype}{double} sin\_theta = sin(\mbox{\hyperlink{classoomph_1_1FiniteElement_a5a9c1ead9819cd17603096e63087020f}{interpolated\_x}}[1]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00210}00210       \textcolor{keyword}{const} \textcolor{keywordtype}{double} cos\_theta = cos(\mbox{\hyperlink{classoomph_1_1FiniteElement_a5a9c1ead9819cd17603096e63087020f}{interpolated\_x}}[1]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00211}00211       \textcolor{keyword}{const} \textcolor{keywordtype}{double} cot\_theta = cos\_theta / sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00212}00212 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00213}00213       \textcolor{keyword}{const} \textcolor{keywordtype}{double} u\_r = interpolated\_u[0];}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00214}00214       \textcolor{keyword}{const} \textcolor{keywordtype}{double} u\_theta = interpolated\_u[1];}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00215}00215       \textcolor{keyword}{const} \textcolor{keywordtype}{double} u\_phi = interpolated\_u[2];}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00216}00216 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00217}00217       \textcolor{comment}{// Pre-\/calculate the scaling factor of the jacobian}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00218}00218       \textcolor{comment}{// double W\_pure = W;}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00219}00219 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00220}00220       \textcolor{comment}{// W *= r*r*sin(theta);}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00221}00221 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00222}00222       \textcolor{comment}{// MOMENTUM EQUATIONS}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00223}00223       \textcolor{comment}{//==================}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00224}00224       \textcolor{comment}{// Number of master nodes and storage for the weight of the shape function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00225}00225       \textcolor{keywordtype}{unsigned} n\_master = 1;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00226}00226       \textcolor{keywordtype}{double} hang\_weight = 1.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00227}00227 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00228}00228       \textcolor{comment}{// Loop over the nodes for the test functions/equations}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00229}00229       \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00230}00230       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_node; l++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00231}00231       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00232}00232         \textcolor{comment}{// Local boolean that indicates the hanging status of the node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00233}00233         \textcolor{keyword}{const} \textcolor{keywordtype}{bool} is\_node\_hanging = \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l)-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00235}00235         \textcolor{comment}{// If the node is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00236}00236         \textcolor{keywordflow}{if} (is\_node\_hanging)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00237}00237         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00238}00238           \textcolor{comment}{// Get the hanging pointer}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00239}00239           hang\_info\_pt = \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l)-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00240}00240           \textcolor{comment}{// Read out number of master nodes from hanging data}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00241}00241           n\_master = hang\_info\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00242}00242         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00243}00243         \textcolor{comment}{// Otherwise the node is its own master}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00244}00244         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00245}00245         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00246}00246           n\_master = 1;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00247}00247         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00248}00248 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00249}00249         \textcolor{comment}{// Loop over the master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00250}00250         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_master; m++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00251}00251         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00252}00252           \textcolor{comment}{// Loop over velocity components for equations}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00253}00253           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} = 0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}} < 2 + 1; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00254}00254           \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00255}00255             \textcolor{comment}{// Get the equation number}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00256}00256             \textcolor{comment}{// If the node is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00257}00257             \textcolor{keywordflow}{if} (is\_node\_hanging)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00258}00258             \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00259}00259               \textcolor{comment}{// Get the equation number from the master node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00260}00260               local\_eqn = this-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_abc3d0cb0131ebf717ff0620242c9ca2b}{local\_hang\_eqn}}(hang\_info\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_a7a935ae7eeca594a648ca1800444827c}{master\_node\_pt}}(m),}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00261}00261                                                u\_nodal\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00262}00262               \textcolor{comment}{// Get the hang weight from the master node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00263}00263               hang\_weight = hang\_info\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_ac49ebdd8957a658fe4a2420108d2dcee}{master\_weight}}(m);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00264}00264             \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00265}00265             \textcolor{comment}{// If the node is not hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00266}00266             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00267}00267             \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00268}00268               \textcolor{comment}{// Local equation number}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00269}00269               local\_eqn = this-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a5da80bbed97543e586f698251d67941d}{nodal\_local\_eqn}}(l, u\_nodal\_index[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00270}00270               \textcolor{comment}{// Node contributes with full weight}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00271}00271               hang\_weight = 1.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00272}00272             \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00273}00273 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00274}00274             \textcolor{comment}{// If it's not a boundary condition...}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00275}00275             \textcolor{keywordflow}{if} (local\_eqn >= 0)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00276}00276             \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00277}00277               \textcolor{comment}{// initialise for residual calculation}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00278}00278               \textcolor{keywordtype}{double} sum = 0.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00279}00279 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00280}00280               \textcolor{keywordflow}{switch} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00281}00281               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00282}00282                   \textcolor{comment}{// RADIAL MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00283}00283                 \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00284}00284                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00285}00285                   \textcolor{comment}{// Convective r-\/terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00286}00286                   \textcolor{keywordtype}{double} conv = r * u\_r * interpolated\_dudx(0, 0);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00287}00287 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00288}00288                   \textcolor{comment}{// Convective theta-\/terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00289}00289                   conv += u\_theta * interpolated\_dudx(0, 1);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00290}00290 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00291}00291                   \textcolor{comment}{// Remaining convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00292}00292                   conv -\/= (u\_theta * u\_theta + u\_phi * u\_phi);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00293}00293 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00294}00294                   \textcolor{comment}{// Add the time-\/derivative and convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00295}00295                   sum += (scaled\_re\_st * dudt[0] * r2 + scaled\_re * r * conv) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00296}00296                          sin\_theta * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00297}00297 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00298}00298                   \textcolor{comment}{// Add the user-\/defined body force term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00299}00299                   sum -\/= r2 * sin\_theta * body\_force[0] * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00300}00300 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00301}00301                   \textcolor{comment}{// Add the Coriolis term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00302}00302                   sum -\/= 2.0 * scaled\_re\_inv\_ro * sin\_theta * u\_phi * r2 *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00303}00303                          sin\_theta * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00304}00304 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00305}00305                   \textcolor{comment}{// r-\/derivative test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00306}00306                   sum += (-\/interpolated\_p + 2 * interpolated\_dudx(0, 0)) * r2 *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00307}00307                          sin\_theta * dtestfdx(l, 0);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00308}00308 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00309}00309                   \textcolor{comment}{// theta-\/derivative test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00310}00310                   sum += (r * interpolated\_dudx(1, 0) -\/ u\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00311}00311                           interpolated\_dudx(0, 1)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00312}00312                          sin\_theta * dtestfdx(l, 1);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00313}00313 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00314}00314                   \textcolor{comment}{// Undifferentiated test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00315}00315                   sum += 2.0 *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00316}00316                          ((-\/r * interpolated\_p + +interpolated\_dudx(1, 1) +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00317}00317                            2.0 * u\_r) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00318}00318                             sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00319}00319                           u\_theta * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00320}00320                          testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00321}00321                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00322}00322                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00323}00323 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00324}00324                 \textcolor{comment}{// THETA-\/COMPONENT MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00325}00325                 \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00326}00326                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00327}00327                   \textcolor{comment}{// All convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00328}00328                   \textcolor{keywordtype}{double} conv =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00329}00329                     (u\_r * interpolated\_dudx(1, 0) * r +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00330}00330                      u\_theta * interpolated\_dudx(1, 1) + u\_r * u\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00331}00331                       sin\_theta -\/}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00332}00332                     u\_phi * u\_phi * cos\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00333}00333 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00334}00334                   \textcolor{comment}{// Add the time-\/derivative and convective terms to the}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00335}00335                   \textcolor{comment}{// residual}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00336}00336                   sum += (scaled\_re\_st * r2 * sin\_theta * dudt[1] +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00337}00337                           scaled\_re * r * conv) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00338}00338                          testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00339}00339 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00340}00340                   \textcolor{comment}{// Add the user-\/defined body force term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00341}00341                   sum -\/= r2 * sin\_theta * body\_force[1] * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00342}00342 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00343}00343                   \textcolor{comment}{// Add the Coriolis term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00344}00344                   sum -\/= 2.0 * scaled\_re\_inv\_ro * cos\_theta * u\_phi * r2 *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00345}00345                          sin\_theta * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00346}00346 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00347}00347                   \textcolor{comment}{// r-\/derivative test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00348}00348                   sum += (r * interpolated\_dudx(1, 0) -\/ u\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00349}00349                           interpolated\_dudx(0, 1)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00350}00350                          r * sin\_theta * dtestfdx(l, 0);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00351}00351 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00352}00352                   \textcolor{comment}{// theta-\/derivative test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00353}00353                   sum += (-\/r * interpolated\_p + 2.0 * interpolated\_dudx(1, 1) +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00354}00354                           2 * u\_r) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00355}00355                          sin\_theta * dtestfdx(l, 1);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00356}00356 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00357}00357                   \textcolor{comment}{// Undifferentiated test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00358}00358                   sum -\/= ((r * interpolated\_dudx(1, 0) -\/ u\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00359}00359                            interpolated\_dudx(0, 1)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00360}00360                             sin\_theta -\/}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00361}00361                           (-\/r * interpolated\_p + 2.0 * u\_r +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00362}00362                            2.0 * u\_theta * cot\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00363}00363                             cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00364}00364                          testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00365}00365                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00366}00366                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00368}00368                 \textcolor{comment}{// PHI-\/COMPONENT MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00369}00369                 \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00370}00370 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00371}00371                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00372}00372                   \textcolor{comment}{// Convective r-\/terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00373}00373                   \textcolor{keywordtype}{double} conv = u\_r * interpolated\_dudx(2, 0) * r * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00374}00374 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00375}00375                   \textcolor{comment}{// Convective theta-\/terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00376}00376                   conv += u\_theta * interpolated\_dudx(2, 1) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00377}00377 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00378}00378                   \textcolor{comment}{// Remaining convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00379}00379                   conv += u\_phi * (u\_r * sin\_theta + u\_theta * cos\_theta);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00380}00380 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00381}00381                   \textcolor{comment}{// Add the time-\/derivative and convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00382}00382                   sum += (scaled\_re\_st * r2 * dudt[2] * sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00383}00383                           scaled\_re * conv * r) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00384}00384                          testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00385}00385 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00386}00386                   sum -\/= r2 * sin\_theta * body\_force[2] * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00387}00387 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00388}00388                   \textcolor{comment}{// Add the Coriolis term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00389}00389                   sum += 2.0 * scaled\_re\_inv\_ro *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00390}00390                          (cos\_theta * u\_theta + sin\_theta * u\_r) * r2 *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00391}00391                          sin\_theta * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00392}00392 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00393}00393 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00394}00394                   \textcolor{comment}{// r-\/derivative test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00395}00395                   sum += (r2 * interpolated\_dudx(2, 0) -\/ r * u\_phi) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00396}00396                          dtestfdx(l, 0) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00397}00397 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00398}00398                   \textcolor{comment}{// theta-\/derivative test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00399}00399                   sum +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00400}00400                     (interpolated\_dudx(2, 1) * sin\_theta -\/ u\_phi * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00401}00401                     dtestfdx(l, 1);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00402}00402 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00403}00403                   \textcolor{comment}{// Undifferentiated test function component of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00404}00404                   sum -\/= ((r * interpolated\_dudx(2, 0) -\/ u\_phi) * sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00405}00405                           (interpolated\_dudx(2, 1) -\/ u\_phi * cot\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00406}00406                             cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00407}00407                          testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00408}00408                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00409}00409                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00410}00410               \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00411}00411 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00412}00412               \textcolor{comment}{// Add contribution}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00413}00413               \textcolor{comment}{// Sign changed to be consistent with other NS implementations}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00414}00414               residuals[local\_eqn] -\/= sum * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00415}00415 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00416}00416               \textcolor{comment}{// CALCULATE THE JACOBIAN}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00417}00417               \textcolor{keywordflow}{if} (flag)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00418}00418               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00419}00419                 \textcolor{comment}{// Number of master nodes and weights}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00420}00420                 \textcolor{keywordtype}{unsigned} n\_master2 = 1;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00421}00421                 \textcolor{keywordtype}{double} hang\_weight2 = 1.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00422}00422                 \textcolor{comment}{// Loop over the velocity nodes for columns}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00423}00423                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l2 = 0; l2 < n\_node; l2++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00424}00424                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00425}00425                   \textcolor{comment}{// Local boolean for hanging status}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00426}00426                   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} is\_node2\_hanging = \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l2)-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00427}00427 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00428}00428                   \textcolor{comment}{// If the node is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00429}00429                   \textcolor{keywordflow}{if} (is\_node2\_hanging)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00430}00430                   \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00431}00431                     hang\_info2\_pt = \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l2)-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00432}00432                     \textcolor{comment}{// Read out number of master nodes from hanging data}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00433}00433                     n\_master2 = hang\_info2\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00434}00434                   \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00435}00435                   \textcolor{comment}{// Otherwise the node is its own master}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00436}00436                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00437}00437                   \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00438}00438                     n\_master2 = 1;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00439}00439                   \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00440}00440 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00441}00441                   \textcolor{comment}{// Loop over the master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00442}00442                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m2 = 0; m2 < n\_master2; m2++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00443}00443                   \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00444}00444                     \textcolor{comment}{// Loop over the velocity components}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00445}00445                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i2 = 0; i2 < 2 + 1; i2++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00446}00446                     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00447}00447                       \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00448}00448                       \textcolor{comment}{// If the node is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00449}00449                       \textcolor{keywordflow}{if} (is\_node2\_hanging)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00450}00450                       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00451}00451                         \textcolor{comment}{// Get the equation number from the master node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00452}00452                         local\_unknown = this-\/>\mbox{\hyperlink{classoomph_1_1RefineableElement_abc3d0cb0131ebf717ff0620242c9ca2b}{local\_hang\_eqn}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00453}00453                           hang\_info2\_pt-\/>master\_node\_pt(m2), u\_nodal\_index[i2]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00454}00454                         hang\_weight2 = hang\_info2\_pt-\/>master\_weight(m2);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00455}00455                       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00456}00456                       \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00457}00457                       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00458}00458                         local\_unknown =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00459}00459                           this-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a5da80bbed97543e586f698251d67941d}{nodal\_local\_eqn}}(l2, u\_nodal\_index[i2]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00460}00460                         hang\_weight2 = 1.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00461}00461                       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00462}00462 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00463}00463                       \textcolor{comment}{// If the unknown is non-\/zero}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00464}00464                       \textcolor{keywordflow}{if} (local\_unknown >= 0)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00465}00465                       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00466}00466                         \textcolor{comment}{// Different results for i and i2}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00467}00467                         \textcolor{keywordflow}{switch} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00468}00468                         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00469}00469                             \textcolor{comment}{// RADIAL MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00470}00470                           \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00471}00471                             \textcolor{keywordflow}{switch} (i2)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00472}00472                             \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00473}00473                                 \textcolor{comment}{// radial component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00474}00474                               \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00475}00475 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00476}00476                                 \textcolor{comment}{// Add the mass matrix entries}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00477}00477                                 \textcolor{keywordflow}{if} (flag == 2)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00478}00478                                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00479}00479                                   mass\_matrix(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00480}00480                                     scaled\_re\_st * psif(l2) * testf(l) * r2 *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00481}00481                                     sin\_theta * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00482}00482                                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00483}00483 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00484}00484                                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00485}00485                                   \textcolor{comment}{// Convective r-\/term contribution}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00486}00486                                   \textcolor{keywordtype}{double} jac\_conv =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00487}00487                                     r * (psif(l2) * interpolated\_dudx(0, 0) +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00488}00488                                          u\_r * dpsifdx(l2, 0));}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00489}00489 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00490}00490                                   \textcolor{comment}{// Convective theta-\/term contribution}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00491}00491                                   jac\_conv += u\_theta * dpsifdx(l2, 1);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00492}00492 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00493}00493                                   \textcolor{comment}{// Add the time-\/derivative contribution and}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00494}00494                                   \textcolor{comment}{// the convective}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00495}00495                                   \textcolor{comment}{// contribution to the sum}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00496}00496                                   \textcolor{keywordtype}{double} jac\_sum =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00497}00497                                     (scaled\_re\_st *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00498}00498                                        \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l2)-\/>\mbox{\hyperlink{classoomph_1_1Data_a065d7bffcec82bf4d4bd7b41f9aa80b3}{time\_stepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a4cb0aecb044b77ba0553cdd54b586d8a}{weight}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00499}00499                                          1, 0) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00500}00500                                        psif(l2) * r2 +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00501}00501                                      scaled\_re * jac\_conv * r) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00502}00502                                     testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00503}00503 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00504}00504 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00505}00505                                   \textcolor{comment}{// Contribution from the r-\/derivative test}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00506}00506                                   \textcolor{comment}{// function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00507}00507                                   \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00508}00508                                   jac\_sum +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00509}00509                                     2.0 * dpsifdx(l2, 0) * dtestfdx(l, 0) * r2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00510}00510 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00511}00511                                   \textcolor{comment}{// Contribution from the theta-\/derivative}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00512}00512                                   \textcolor{comment}{// test function part  of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00513}00513                                   jac\_sum += dpsifdx(l2, 1) * dtestfdx(l, 1);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00514}00514 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00515}00515 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00516}00516                                   \textcolor{comment}{// Contribution from the undifferentiated}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00517}00517                                   \textcolor{comment}{// test function part}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00518}00518                                   \textcolor{comment}{// of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00519}00519                                   jac\_sum += 4.0 * psif[l2] * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00520}00520 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00521}00521                                   \textcolor{comment}{// Add the total contribution to the}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00522}00522                                   \textcolor{comment}{// jacobian multiplied}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00523}00523                                   \textcolor{comment}{// by the jacobian weight}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00524}00524                                   jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00525}00525                                     jac\_sum * sin\_theta * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00526}00526                                     hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00527}00527                                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00528}00528 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00529}00529                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00530}00530 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00531}00531                                 \textcolor{comment}{// axial component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00532}00532                               \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00533}00533                               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00534}00534                                 \textcolor{comment}{// No time derivative contribution}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00535}00535 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00536}00536                                 \textcolor{comment}{// Convective contribution}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00537}00537                                 \textcolor{keywordtype}{double} jac\_sum =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00538}00538                                   scaled\_re *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00539}00539                                   (interpolated\_dudx(0, 1) -\/ 2.0 * u\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00540}00540                                   psif(l2) * r * sin\_theta * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00541}00541 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00542}00542                                 \textcolor{comment}{// Contribution from the theta-\/derivative}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00543}00543                                 \textcolor{comment}{// test function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00544}00544                                 \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00545}00545                                 jac\_sum += (r * dpsifdx(l2, 0) -\/ psif(l2)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00546}00546                                            dtestfdx(l, 1) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00547}00547 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00548}00548                                 \textcolor{comment}{// Contribution from the undifferentiated}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00549}00549                                 \textcolor{comment}{// test function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00550}00550                                 \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00551}00551                                 jac\_sum += 2.0 *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00552}00552                                            (dpsifdx(l2, 1) * sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00553}00553                                             psif(l2) * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00554}00554                                            testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00555}00555 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00556}00556                                 \textcolor{comment}{// Add the full contribution to the jacobian}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00557}00557                                 \textcolor{comment}{// matrix}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00558}00558                                 jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00559}00559                                   jac\_sum * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00560}00560 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00561}00561                               \} \textcolor{comment}{// End of i2 = 1 section}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00562}00562 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00563}00563                               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00564}00564 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00565}00565                                 \textcolor{comment}{// azimuthal component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00566}00566                               \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00567}00567                               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00568}00568                                 \textcolor{comment}{// Single convective-\/term contribution}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00569}00569                                 jacobian(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00570}00570                                   2.0 * scaled\_re * u\_phi * psif[l2] * r *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00571}00571                                   sin\_theta * testf[l] * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00572}00572                                   hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00573}00573 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00574}00574                                 \textcolor{comment}{// Add the Coriolis term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00575}00575                                 jacobian(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00576}00576                                   2.0 * scaled\_re\_inv\_ro * sin\_theta *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00577}00577                                   psif(l2) * r2 * sin\_theta * testf[l] * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00578}00578                                   hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00579}00579                               \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00580}00580 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00581}00581                               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00582}00582                             \} \textcolor{comment}{// End of contribution radial momentum eqn}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00583}00583                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00584}00584 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00585}00585                             \textcolor{comment}{// AXIAL MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00586}00586                           \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00587}00587                             \textcolor{keywordflow}{switch} (i2)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00588}00588                             \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00589}00589                                 \textcolor{comment}{// radial component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00590}00590                               \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00591}00591                               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00592}00592                                 \textcolor{comment}{// Convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00593}00593                                 \textcolor{keywordtype}{double} jac\_sum =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00594}00594                                   scaled\_re *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00595}00595                                   (r2 * interpolated\_dudx(1, 0) + r * u\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00596}00596                                   psif(l2) * sin\_theta * testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00597}00597 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00598}00598                                 \textcolor{comment}{// Contribution from the r-\/derivative}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00599}00599                                 \textcolor{comment}{// test function part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00600}00600                                 jac\_sum += dpsifdx(l2, 1) * dtestfdx(l, 0) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00601}00601                                            sin\_theta * r;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00602}00602 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00603}00603                                 \textcolor{comment}{// Contribution from the theta-\/derivative}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00604}00604                                 \textcolor{comment}{// test function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00605}00605                                 \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00606}00606                                 jac\_sum +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00607}00607                                   2.0 * psif(l2) * dtestfdx(l, 1) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00608}00608 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00609}00609                                 \textcolor{comment}{// Contribution from the undifferentiated}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00610}00610                                 \textcolor{comment}{// test function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00611}00611                                 \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00612}00612                                 jac\_sum -\/= (dpsifdx(l2, 1) * sin\_theta -\/}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00613}00613                                             2.0 * psif(l2) * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00614}00614                                            testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00615}00615 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00616}00616                                 \textcolor{comment}{// Add the sum to the jacobian}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00617}00617                                 jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00618}00618                                   jac\_sum * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00619}00619                               \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00620}00620 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00621}00621                               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00622}00622 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00623}00623                                 \textcolor{comment}{// axial component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00624}00624                               \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00625}00625 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00626}00626                                 \textcolor{comment}{// Add the mass matrix terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00627}00627                                 \textcolor{keywordflow}{if} (flag == 2)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00628}00628                                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00629}00629                                   mass\_matrix(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00630}00630                                     scaled\_re\_st * psif[l2] * testf[l] * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00631}00631                                     r2 * sin\_theta * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00632}00632                                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00633}00633 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00634}00634 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00635}00635                                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00636}00636                                   \textcolor{comment}{// Contribution from the convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00637}00637                                   \textcolor{keywordtype}{double} jac\_conv =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00638}00638                                     r * u\_r * dpsifdx(l2, 0) +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00639}00639                                     u\_theta * dpsifdx(l2, 1) +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00640}00640                                     (interpolated\_dudx(1, 1) + u\_r) * psif(l2);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00641}00641 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00642}00642                                   \textcolor{comment}{// Add the time-\/derivative term and the}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00643}00643                                   \textcolor{comment}{// convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00644}00644                                   \textcolor{keywordtype}{double} jac\_sum =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00645}00645                                     (scaled\_re\_st *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00646}00646                                        \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l2)-\/>\mbox{\hyperlink{classoomph_1_1Data_a065d7bffcec82bf4d4bd7b41f9aa80b3}{time\_stepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a4cb0aecb044b77ba0553cdd54b586d8a}{weight}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00647}00647                                          1, 0) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00648}00648                                        psif(l2) * r2 +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00649}00649                                      scaled\_re * r * jac\_conv) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00650}00650                                     testf(l) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00651}00651 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00652}00652 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00653}00653                                   \textcolor{comment}{// Contribution from the r-\/derivative test}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00654}00654                                   \textcolor{comment}{// function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00655}00655                                   \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00656}00656                                   jac\_sum += (r * dpsifdx(l2, 0) -\/ psif(l2)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00657}00657                                              r * dtestfdx(l, 0) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00658}00658 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00659}00659                                   \textcolor{comment}{// Contribution from the theta-\/derivative}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00660}00660                                   \textcolor{comment}{// test function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00661}00661                                   \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00662}00662                                   jac\_sum += 2.0 * dpsifdx(l2, 1) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00663}00663                                              dtestfdx(l, 1) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00664}00664 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00665}00665                                   \textcolor{comment}{// Contribution from the undifferentiated}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00666}00666                                   \textcolor{comment}{// test function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00667}00667                                   \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00668}00668                                   jac\_sum -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00669}00669                                     ((r * dpsifdx(l2, 0) -\/ psif(l2)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00670}00670                                        sin\_theta -\/}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00671}00671                                      2.0 * psif(l2) * cot\_theta * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00672}00672                                     testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00673}00673 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00674}00674                                   \textcolor{comment}{// Add the contribution to the jacobian}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00675}00675                                   jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00676}00676                                     jac\_sum * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00677}00677                                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00678}00678 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00679}00679                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00680}00680 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00681}00681                                 \textcolor{comment}{// azimuthal component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00682}00682                               \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00683}00683                               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00684}00684                                 \textcolor{comment}{// Only a convective term contribution}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00685}00685                                 jacobian(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00686}00686                                   scaled\_re * 2.0 * r * psif(l2) * u\_phi *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00687}00687                                   cos\_theta * testf(l) * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00688}00688                                   hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00689}00689 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00690}00690                                 \textcolor{comment}{// Add the Coriolis term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00691}00691                                 jacobian(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00692}00692                                   2.0 * scaled\_re\_inv\_ro * cos\_theta *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00693}00693                                   psif(l2) * r2 * sin\_theta * testf[l] * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00694}00694                                   hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00695}00695                               \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00696}00696 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00697}00697                               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00698}00698                             \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00699}00699                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00700}00700 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00701}00701                             \textcolor{comment}{// AZIMUTHAL MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00702}00702                           \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00703}00703                             \textcolor{keywordflow}{switch} (i2)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00704}00704                             \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00705}00705                                 \textcolor{comment}{// radial component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00706}00706                               \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00707}00707                               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00708}00708                                 \textcolor{comment}{// Contribution from convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00709}00709                                 jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00710}00710                                   scaled\_re *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00711}00711                                   (r * interpolated\_dudx(2, 0) + u\_phi) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00712}00712                                   psif(l2) * testf(l) * r * sin\_theta * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00713}00713                                   hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00714}00714 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00715}00715                                 \textcolor{comment}{// Coriolis term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00716}00716                                 jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00717}00717                                   2.0 * scaled\_re\_inv\_ro * sin\_theta *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00718}00718                                   psif(l2) * r2 * sin\_theta * testf[l] * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00719}00719                                   hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00720}00720                               \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00721}00721                               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00722}00722 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00723}00723                               \textcolor{comment}{// axial component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00724}00724                               \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00725}00725                               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00726}00726                                 \textcolor{comment}{// Contribution from convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00727}00727                                 jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00728}00728                                   scaled\_re *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00729}00729                                   (interpolated\_dudx(2, 1) * sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00730}00730                                    u\_phi * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00731}00731                                   r * psif(l2) * testf(l) * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00732}00732                                   hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00733}00733 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00734}00734                                 \textcolor{comment}{// Coriolis term}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00735}00735                                 jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00736}00736                                   2.0 * scaled\_re\_inv\_ro * cos\_theta *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00737}00737                                   psif(l2) * r2 * sin\_theta * testf[l] * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00738}00738                                   hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00739}00739                               \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00740}00740 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00741}00741                               \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00742}00742 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00743}00743                                 \textcolor{comment}{// azimuthal component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00744}00744                               \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00745}00745 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00746}00746                                 \textcolor{comment}{// Add the mass matrix terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00747}00747                                 \textcolor{keywordflow}{if} (flag == 2)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00748}00748                                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00749}00749                                   mass\_matrix(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00750}00750                                     scaled\_re\_st * psif[l2] * testf[l] * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00751}00751                                     r2 * sin\_theta * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00752}00752                                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00753}00753 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00754}00754                                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00755}00755                                   \textcolor{comment}{// Convective terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00756}00756                                   \textcolor{keywordtype}{double} jac\_conv =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00757}00757                                     r * u\_r * dpsifdx(l2, 0) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00758}00758 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00759}00759                                   \textcolor{comment}{// Convective theta-\/term contribution}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00760}00760                                   jac\_conv +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00761}00761                                     u\_theta * dpsifdx(l2, 1) * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00762}00762 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00763}00763                                   \textcolor{comment}{// Contribution from the remaining convective}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00764}00764                                   \textcolor{comment}{// terms}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00765}00765                                   jac\_conv +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00766}00766                                     (u\_r * sin\_theta + u\_theta * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00767}00767                                     psif(l2);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00768}00768 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00769}00769                                   \textcolor{comment}{// Add the convective and time derivatives}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00770}00770                                   \textcolor{keywordtype}{double} jac\_sum =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00771}00771                                     (scaled\_re\_st *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00772}00772                                        \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l2)-\/>\mbox{\hyperlink{classoomph_1_1Data_a065d7bffcec82bf4d4bd7b41f9aa80b3}{time\_stepper\_pt}}()-\/>\mbox{\hyperlink{classoomph_1_1TimeStepper_a4cb0aecb044b77ba0553cdd54b586d8a}{weight}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00773}00773                                          1, 0) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00774}00774                                        psif(l2) * r2 * sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00775}00775                                      scaled\_re * r * jac\_conv) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00776}00776                                     testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00777}00777 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00778}00778 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00779}00779                                   \textcolor{comment}{// Contribution from the r-\/derivative test}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00780}00780                                   \textcolor{comment}{// function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00781}00781                                   \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00782}00782                                   jac\_sum += (r * dpsifdx(l2, 0) -\/ psif(l2)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00783}00783                                              dtestfdx(l, 0) * r * sin\_theta;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00784}00784 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00785}00785                                   \textcolor{comment}{// Contribution from the theta-\/derivative}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00786}00786                                   \textcolor{comment}{// test function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00787}00787                                   \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00788}00788                                   jac\_sum += (dpsifdx(l2, 1) * sin\_theta -\/}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00789}00789                                               psif(l2) * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00790}00790                                              dtestfdx(l, 1);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00791}00791 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00792}00792                                   \textcolor{comment}{// Contribution from the undifferentiated}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00793}00793                                   \textcolor{comment}{// test function}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00794}00794                                   \textcolor{comment}{// part of stress tensor}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00795}00795                                   jac\_sum -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00796}00796                                     ((r * dpsifdx(l2, 0) -\/ psif(l2)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00797}00797                                        sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00798}00798                                      (dpsifdx(l2, 1) -\/ psif(l2) * cot\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00799}00799                                        cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00800}00800                                     testf(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00801}00801 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00802}00802                                   \textcolor{comment}{// Add to the jacobian}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00803}00803                                   jacobian(local\_eqn, local\_unknown) -\/=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00804}00804                                     jac\_sum * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00805}00805                                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00806}00806 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00807}00807                                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00808}00808                             \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00809}00809                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00810}00810                         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00811}00811                       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00812}00812                     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00813}00813                   \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00814}00814                 \} \textcolor{comment}{// End of loop over the nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00815}00815 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00816}00816 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00817}00817                 \textcolor{comment}{// Loop over the pressure shape functions}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00818}00818                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l2 = 0; l2 < n\_pres; l2++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00819}00819                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00820}00820                   \textcolor{comment}{// If the pressure dof is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00821}00821                   \textcolor{keywordflow}{if} (pressure\_dof\_is\_hanging[l2])}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00822}00822                   \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00823}00823                     \textcolor{comment}{// Pressure dof is hanging so it must be nodal-\/based}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00824}00824                     hang\_info2\_pt = \mbox{\hyperlink{classoomph_1_1RefineableSphericalNavierStokesEquations_a022b5fab872e9b138a04c2d481b56afc}{pressure\_node\_pt}}(l2)-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(p\_index);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00825}00825 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00826}00826                     \textcolor{comment}{// Get the number of master nodes from the pressure node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00827}00827                     n\_master2 = hang\_info2\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00828}00828                   \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00829}00829                   \textcolor{comment}{// Otherwise the node is its own master}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00830}00830                   \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00831}00831                   \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00832}00832                     n\_master2 = 1;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00833}00833                   \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00834}00834 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00835}00835                   \textcolor{comment}{// Loop over the master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00836}00836                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m2 = 0; m2 < n\_master2; m2++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00837}00837                   \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00838}00838                     \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00839}00839                     \textcolor{comment}{// If the pressure dof is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00840}00840                     \textcolor{keywordflow}{if} (pressure\_dof\_is\_hanging[l2])}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00841}00841                     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00842}00842                       \textcolor{comment}{// Get the unknown from the node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00843}00843                       local\_unknown = \mbox{\hyperlink{classoomph_1_1RefineableElement_abc3d0cb0131ebf717ff0620242c9ca2b}{local\_hang\_eqn}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00844}00844                         hang\_info2\_pt-\/>master\_node\_pt(m2), p\_index);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00845}00845                       \textcolor{comment}{// Get the weight from the hanging object}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00846}00846                       hang\_weight2 = hang\_info2\_pt-\/>master\_weight(m2);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00847}00847                     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00848}00848                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00849}00849                     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00850}00850                       local\_unknown = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_ad8d9a0edbe3793a008a6bff670c26643}{p\_local\_eqn}}(l2);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00851}00851                       hang\_weight2 = 1.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00852}00852                     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00853}00853 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00854}00854                     \textcolor{comment}{// If the unknown is not pinned}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00855}00855                     \textcolor{keywordflow}{if} (local\_unknown >= 0)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00856}00856                     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00857}00857                       \textcolor{comment}{// Add in contributions to different equations}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00858}00858                       \textcolor{keywordflow}{switch} (\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}})}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00859}00859                       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00860}00860                           \textcolor{comment}{// RADIAL MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00861}00861                         \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00862}00862                           jacobian(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00863}00863                             psip(l2) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00864}00864                             (r2 * dtestfdx(l, 0) + 2.0 * r * testf[l]) * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00865}00865                             sin\_theta * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00866}00866 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00867}00867 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00868}00868                           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00869}00869 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00870}00870                           \textcolor{comment}{// AXIAL MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00871}00871                         \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00872}00872                           jacobian(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00873}00873                             psip(l2) * r *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00874}00874                             (dtestfdx(l, 1) * sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00875}00875                              cos\_theta * testf(l)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00876}00876                             \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00877}00877 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00878}00878                           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00879}00879 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00880}00880                           \textcolor{comment}{// AZIMUTHAL MOMENTUM EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00881}00881                         \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00882}00882                           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00883}00883                       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00884}00884                     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00885}00885                   \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00886}00886                 \} \textcolor{comment}{// End of loop over pressure dofs}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00887}00887               \} \textcolor{comment}{// End of Jacobian calculation}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00888}00888             \} \textcolor{comment}{// End of if not boundary condition statement}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00889}00889           \} \textcolor{comment}{// End of loop over velocity components}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00890}00890         \} \textcolor{comment}{// End of loop over master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00891}00891       \} \textcolor{comment}{// End of loop over nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00892}00892 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00893}00893 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00894}00894       \textcolor{comment}{// CONTINUITY EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00895}00895       \textcolor{comment}{//===================}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00896}00896 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00897}00897       \textcolor{comment}{// Loop over the pressure shape functions}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00898}00898       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l = 0; l < n\_pres; l++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00899}00899       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00900}00900         \textcolor{comment}{// If the pressure dof is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00901}00901         \textcolor{keywordflow}{if} (pressure\_dof\_is\_hanging[l])}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00902}00902         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00903}00903           \textcolor{comment}{// Pressure dof is hanging so it must be nodal-\/based}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00904}00904           hang\_info\_pt = \mbox{\hyperlink{classoomph_1_1RefineableSphericalNavierStokesEquations_a022b5fab872e9b138a04c2d481b56afc}{pressure\_node\_pt}}(l)-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}(p\_index);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00905}00905           \textcolor{comment}{// Get the number of master nodes from the pressure node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00906}00906           n\_master = hang\_info\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00907}00907         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00908}00908         \textcolor{comment}{// Otherwise the node is its own master}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00909}00909         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00910}00910         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00911}00911           n\_master = 1;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00912}00912         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00913}00913 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00914}00914         \textcolor{comment}{// Loop over the master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00915}00915         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m = 0; m < n\_master; m++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00916}00916         \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00917}00917           \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00918}00918           \textcolor{comment}{// If the pressure dof is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00919}00919           \textcolor{keywordflow}{if} (pressure\_dof\_is\_hanging[l])}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00920}00920           \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00921}00921             local\_eqn =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00922}00922               \mbox{\hyperlink{classoomph_1_1RefineableElement_abc3d0cb0131ebf717ff0620242c9ca2b}{local\_hang\_eqn}}(hang\_info\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_a7a935ae7eeca594a648ca1800444827c}{master\_node\_pt}}(m), p\_index);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00923}00923             hang\_weight = hang\_info\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_ac49ebdd8957a658fe4a2420108d2dcee}{master\_weight}}(m);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00924}00924           \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00925}00925           \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00926}00926           \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00927}00927             local\_eqn = \mbox{\hyperlink{classoomph_1_1SphericalNavierStokesEquations_ad8d9a0edbe3793a008a6bff670c26643}{p\_local\_eqn}}(l);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00928}00928             hang\_weight = 1.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00929}00929           \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00930}00930 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00931}00931           \textcolor{comment}{// If the equation is not pinned}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00932}00932           \textcolor{keywordflow}{if} (local\_eqn >= 0)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00933}00933           \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00934}00934             \textcolor{comment}{// The entire continuity equation}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00935}00935             residuals[local\_eqn] += ((2.0 * u\_r + r * interpolated\_dudx(0, 0) +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00936}00936                                       interpolated\_dudx(1, 1)) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00937}00937                                        sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00938}00938                                      u\_theta * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00939}00939                                     r * testp(l) * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00940}00940 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00941}00941             \textcolor{comment}{// CALCULATE THE JACOBIAN}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00942}00942             \textcolor{comment}{//======================}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00943}00943             \textcolor{keywordflow}{if} (flag)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00944}00944             \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00945}00945               \textcolor{keywordtype}{unsigned} n\_master2 = 1;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00946}00946               \textcolor{keywordtype}{double} hang\_weight2 = 1.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00947}00947               \textcolor{comment}{// Loop over the velocity nodes for columns}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00948}00948               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} l2 = 0; l2 < n\_node; l2++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00949}00949               \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00950}00950                 \textcolor{comment}{// Local boolean to indicate whether the node is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00951}00951                 \textcolor{keywordtype}{bool} is\_node2\_hanging = \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l2)-\/>\mbox{\hyperlink{classoomph_1_1Node_af0e6237dfafad62cf427ff5013ddcfef}{is\_hanging}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00952}00952 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00953}00953                 \textcolor{comment}{// If the node is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00954}00954                 \textcolor{keywordflow}{if} (is\_node2\_hanging)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00955}00955                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00956}00956                   hang\_info2\_pt = \mbox{\hyperlink{classoomph_1_1FiniteElement_a9addfe893ab8205619963aa96204cdc4}{node\_pt}}(l2)-\/>\mbox{\hyperlink{classoomph_1_1Node_afefa22db8b28e783b8647e3577ee01d9}{hanging\_pt}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00957}00957                   \textcolor{comment}{// Read out number of master nodes from hanging data}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00958}00958                   n\_master2 = hang\_info2\_pt-\/>\mbox{\hyperlink{classoomph_1_1HangInfo_aa9c1130b58db2ff6d5eee4f923ba365c}{nmaster}}();}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00959}00959                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00960}00960                 \textcolor{comment}{// Otherwise the node is its own master}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00961}00961                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00962}00962                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00963}00963                   n\_master2 = 1;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00964}00964                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00965}00965 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00966}00966                 \textcolor{comment}{// Loop over the master nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00967}00967                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} m2 = 0; m2 < n\_master2; m2++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00968}00968                 \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00969}00969                   \textcolor{comment}{// Loop over the velocity components}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00970}00970                   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i2 = 0; i2 < 2 + 1; i2++)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00971}00971                   \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00972}00972                     \textcolor{comment}{// Get the number of the unknown}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00973}00973                     \textcolor{comment}{// If the node is hanging}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00974}00974                     \textcolor{keywordflow}{if} (is\_node2\_hanging)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00975}00975                     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00976}00976                       \textcolor{comment}{// Get the equation number from the master node}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00977}00977                       local\_unknown = \mbox{\hyperlink{classoomph_1_1RefineableElement_abc3d0cb0131ebf717ff0620242c9ca2b}{local\_hang\_eqn}}(}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00978}00978                         hang\_info2\_pt-\/>master\_node\_pt(m2), u\_nodal\_index[i2]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00979}00979                       hang\_weight2 = hang\_info2\_pt-\/>master\_weight(m2);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00980}00980                     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00981}00981                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00982}00982                     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00983}00983                       local\_unknown =}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00984}00984                         this-\/>\mbox{\hyperlink{classoomph_1_1FiniteElement_a5da80bbed97543e586f698251d67941d}{nodal\_local\_eqn}}(l2, u\_nodal\_index[i2]);}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00985}00985                       hang\_weight2 = 1.0;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00986}00986                     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00987}00987 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00988}00988                     \textcolor{comment}{// If the unknown is not pinned}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00989}00989                     \textcolor{keywordflow}{if} (local\_unknown >= 0)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00990}00990                     \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00991}00991                       \textcolor{keywordflow}{switch} (i2)}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00992}00992                       \{}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00993}00993                           \textcolor{comment}{// radial component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00994}00994                         \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00995}00995                           jacobian(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00996}00996                             (2.0 * psif(l2) + r * dpsifdx(l2, 0)) * r *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00997}00997                             sin\_theta * testp(l) * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00998}00998                             hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l00999}00999 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01000}01000 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01001}01001                           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01002}01002 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01003}01003                           \textcolor{comment}{// axial component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01004}01004                         \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01005}01005                           jacobian(local\_eqn, local\_unknown) +=}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01006}01006                             r *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01007}01007                             (dpsifdx(l2, 1) * sin\_theta +}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01008}01008                              psif(l2) * cos\_theta) *}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01009}01009                             testp(l) * \mbox{\hyperlink{namespaceoomph_1_1QuadTreeNames_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6}{W}} * hang\_weight * hang\_weight2;}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01010}01010 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01011}01011 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01012}01012                           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01013}01013 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01014}01014                           \textcolor{comment}{// azimuthal component}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01015}01015                         \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01016}01016                           \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01017}01017                       \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01018}01018                     \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01019}01019                   \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01020}01020                 \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01021}01021               \} \textcolor{comment}{// End of loop over nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01022}01022 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01023}01023               \textcolor{comment}{// NO PRESSURE CONTRIBUTIONS TO CONTINUITY EQUATION}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01024}01024             \} \textcolor{comment}{// End of Jacobian calculation}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01025}01025           \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01026}01026         \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01027}01027       \} \textcolor{comment}{// End of loop over pressure nodes}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01028}01028 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01029}01029     \} \textcolor{comment}{// end of loop over integration points}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01030}01030   \}}
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01031}01031 }
\DoxyCodeLine{\Hypertarget{refineable__spherical__navier__stokes__elements_8cc_source_l01032}01032 \} \textcolor{comment}{// namespace oomph}}

\end{DoxyCode}
