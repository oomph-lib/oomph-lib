\hypertarget{superlu__complex_8c_source}{}\doxysection{superlu\+\_\+complex.\+c}
\label{superlu__complex_8c_source}\index{superlu\_complex.c@{superlu\_complex.c}}
\mbox{\hyperlink{superlu__complex_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00002}00002 \textcolor{comment}{/* Wrapper for SuperLU solver. Based on fortran wrapper supplied}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00003}00003 \textcolor{comment}{ * with SuperLU version 3.0. Given that, it seems appropriate}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00004}00004 \textcolor{comment}{ * to retain this copyright notice:}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00005}00005 \textcolor{comment}{ *}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00006}00006 \textcolor{comment}{ * -\/-\/ SuperLU routine (version 3.0) -\/-\/}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00007}00007 \textcolor{comment}{ * Univ. of California Berkeley, Xerox Palo Alto Research Center,}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00008}00008 \textcolor{comment}{ * and Lawrence Berkeley National Lab.}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00009}00009 \textcolor{comment}{ * October 15, 2003}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00010}00010 \textcolor{comment}{ *}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00011}00011 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00012}00012 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00013}00013 \textcolor{preprocessor}{\#include "{}../../external\_src/oomph\_superlu\_4.3/slu\_zdefs.h"{}}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00014}00014 \textcolor{preprocessor}{\#include "{}math.h"{}}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00017}00017 \textcolor{comment}{/* ================================================= */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00018}00018 \textcolor{comment}{/* Pointer to the LU factors*/}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00019}00019 \textcolor{comment}{/* ================================================= */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00020}\mbox{\hyperlink{superlu__complex_8c_a2b91e9b8520a970ebe560735f71ba3bd}{00020}} \textcolor{keyword}{typedef} \textcolor{keywordtype}{void}* \mbox{\hyperlink{superlu__complex_8c_a2b91e9b8520a970ebe560735f71ba3bd}{fptr}};  }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00021}00021 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00023}00023 \textcolor{comment}{/* ================================================= */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00024}00024 \textcolor{comment}{/* Struct for the lu factors  */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00025}00025 \textcolor{comment}{/* ================================================= */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00026}00026 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00027}00027     SuperMatrix *\mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00028}00028     SuperMatrix *\mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00029}00029     \textcolor{keywordtype}{int} *perm\_c;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00030}00030     \textcolor{keywordtype}{int} *perm\_r;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00031}00031 \} \mbox{\hyperlink{structfactors__t}{factors\_t}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00035}00035 \textcolor{comment}{/* =========================================================================}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00036}00036 \textcolor{comment}{ * Wrapper to superlu solver:}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00037}00037 \textcolor{comment}{ *}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00038}00038 \textcolor{comment}{ * op\_flag    = int specifies the operation:}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00039}00039 \textcolor{comment}{ *                1, performs LU decomposition for the first time}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00040}00040 \textcolor{comment}{ *                2, performs triangular solve}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00041}00041 \textcolor{comment}{ *                3, free all the storage in the end}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00042}00042 \textcolor{comment}{ * n          = dimension of matrix}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00043}00043 \textcolor{comment}{ * nnz        = \# of nonzero entries}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00044}00044 \textcolor{comment}{ * nrhs       = \# of RHSs}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00045}00045 \textcolor{comment}{ * values     = double array containing the nonzero entries }}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00046}00046 \textcolor{comment}{ * rowind     = int array containing the row indices of the entries }}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00047}00047 \textcolor{comment}{ * colptr     = int array containing the column start}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00048}00048 \textcolor{comment}{ * b          = double array containing the rhs vector (gets overwritten}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00049}00049 \textcolor{comment}{ *              with solution)}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00050}00050 \textcolor{comment}{ * ldb        = leading dimension of b}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00051}00051 \textcolor{comment}{ * transpose  =  0/1 if matrix is transposed/not transposed}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00052}00052 \textcolor{comment}{ * doc        = 0/1 for full doc/no full doc }}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00053}00053 \textcolor{comment}{ * info       = info flag from superlu}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00054}00054 \textcolor{comment}{ * f\_factors  = pointer to LU factors. (If op\_flag == 1, it is an output }}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00055}00055 \textcolor{comment}{ *              and contains the pointer pointing to the structure of }}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00056}00056 \textcolor{comment}{ *              the factored matrices. Otherwise, it it an input.}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00057}00057 \textcolor{comment}{ * Returns the SIGN of the determinant of the matrix }}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00058}00058 \textcolor{comment}{ * =========================================================================}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00059}00059 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00060}\mbox{\hyperlink{superlu__complex_8c_a09a380b3a4c8b979a16271913c19d164}{00060}} \textcolor{keywordtype}{int} \mbox{\hyperlink{superlu__complex_8c_a09a380b3a4c8b979a16271913c19d164}{superlu\_complex}}(\textcolor{keywordtype}{int} *op\_flag, \textcolor{keywordtype}{int} *n, \textcolor{keywordtype}{int} *nnz, \textcolor{keywordtype}{int} *nrhs,}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00061}00061                     doublecomplex *values, \textcolor{keywordtype}{int} *rowind, \textcolor{keywordtype}{int} *colptr,}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00062}00062                     doublecomplex *b, \textcolor{keywordtype}{int} *ldb, \textcolor{keywordtype}{int} *transpose, \textcolor{keywordtype}{int} *\mbox{\hyperlink{namespaceoomph_1_1LeakCheckNames_ad5ef7bca3a63e643b0eec22dd3bab58b}{doc}},}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00063}00063                     \mbox{\hyperlink{superlu_8c_a2b91e9b8520a970ebe560735f71ba3bd}{fptr}} *f\_factors, \textcolor{keywordtype}{int} *info)}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00064}00064  }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00065}00065 \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00066}00066  }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00067}00067     SuperMatrix A, AC, \mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a43c804e2bcf9862a4bf629d5f01761e8}{B}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00068}00068     SuperMatrix *\mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}}, *\mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00069}00069     \textcolor{keywordtype}{int} *perm\_r; \textcolor{comment}{/* row permutations from partial pivoting */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00070}00070     \textcolor{keywordtype}{int} *perm\_c; \textcolor{comment}{/* column permutation vector */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00071}00071     \textcolor{keywordtype}{int} *etree;  \textcolor{comment}{/* column elimination tree */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00072}00072     SCformat *Lstore;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00073}00073     NCformat *Ustore;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00074}00074     \textcolor{keywordtype}{int}      \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}, j, panel\_size, permc\_spec, relax;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00075}00075     trans\_t  trans;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00076}00076     \textcolor{comment}{//double   drop\_tol = 0.0; //No longer needed SuperLU 4.3}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00077}00077     mem\_usage\_t   mem\_usage;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00078}00078     superlu\_options\_t options;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00079}00079     SuperLUStat\_t stat;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00080}00080     \mbox{\hyperlink{structfactors__t}{factors\_t}} *LUfactors;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00082}00082     doublecomplex *Lval;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00083}00083     doublecomplex *diagU, *dblock;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00084}00084     int\_t fsupc, nsupr, nsupc, luptr;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00085}00085     int\_t i2, k2, nsupers; }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00086}00086     \textcolor{keywordtype}{int} signature=1;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00087}00087     \textcolor{keywordtype}{int} sign = 0;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00088}00088 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00089}00089 \textcolor{comment}{/*   Do we need to transpose? */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00090}00090     \textcolor{keywordflow}{if} (*transpose==0)}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00091}00091      \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00092}00092       trans = NOTRANS;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00093}00093      \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00094}00094     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00095}00095      \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00096}00096       trans = TRANS;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00097}00097      \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00098}00098 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00099}00099     \textcolor{keywordflow}{if} ( *op\_flag == 1 ) \{ \textcolor{comment}{/* LU decomposition */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00100}00100 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00101}00101         \textcolor{comment}{/* Set the default input options. */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00102}00102         set\_default\_options(\&options);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00104}00104         \textcolor{comment}{/* Initialize the statistics variables. */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00105}00105         StatInit(\&stat);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00107}00107         zCreate\_CompCol\_Matrix(\&A, *n, *n, *nnz, values, rowind, colptr,}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00108}00108                                SLU\_NC, SLU\_Z, SLU\_GE);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00109}00109         \mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}} = (SuperMatrix *) SUPERLU\_MALLOC( \textcolor{keyword}{sizeof}(SuperMatrix) );}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00110}00110         \mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}} = (SuperMatrix *) SUPERLU\_MALLOC( \textcolor{keyword}{sizeof}(SuperMatrix) );}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00111}00111         \textcolor{keywordflow}{if} ( !(perm\_r = intMalloc(*n)) ) ABORT(\textcolor{stringliteral}{"{}Malloc fails for perm\_r[]."{}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00112}00112         \textcolor{keywordflow}{if} ( !(perm\_c = intMalloc(*n)) ) ABORT(\textcolor{stringliteral}{"{}Malloc fails for perm\_c[]."{}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00113}00113         \textcolor{keywordflow}{if} ( !(etree = intMalloc(*n)) ) ABORT(\textcolor{stringliteral}{"{}Malloc fails for etree[]."{}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00114}00114 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00115}00115         \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00116}00116 \textcolor{comment}{         * Get column permutation vector perm\_c[], according to permc\_spec:}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00117}00117 \textcolor{comment}{         *   permc\_spec = 0: natural ordering }}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00118}00118 \textcolor{comment}{         *   permc\_spec = 1: minimum degree on structure of A'*A}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00119}00119 \textcolor{comment}{         *   permc\_spec = 2: minimum degree on structure of A'+A}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00120}00120 \textcolor{comment}{         *   permc\_spec = 3: approximate minimum degree for unsymmetric matrices}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00121}00121 \textcolor{comment}{         */}     }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00122}00122         permc\_spec = options.ColPerm;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00123}00123         get\_perm\_c(permc\_spec, \&A, perm\_c);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00124}00124         }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00125}00125         sp\_preorder(\&options, \&A, perm\_c, etree, \&AC);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00127}00127         panel\_size = sp\_ienv(1);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00128}00128         relax = sp\_ienv(2);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00130}00130         zgstrf(\&options, \&AC, \textcolor{comment}{/*drop\_tol,*/} relax, panel\_size, }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00131}00131                etree, NULL, 0, perm\_c, perm\_r, \mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}}, \mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}}, \&stat, info);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00132}00132 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00133}00133         \textcolor{keywordflow}{if} ( *info == 0 ) \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00134}00134             Lstore = (SCformat *) \mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}}-\/>Store;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00135}00135             Ustore = (NCformat *) \mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}}-\/>Store;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00136}00136             \textcolor{keywordflow}{if} (*\mbox{\hyperlink{namespaceoomph_1_1LeakCheckNames_ad5ef7bca3a63e643b0eec22dd3bab58b}{doc}}!=0)}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00137}00137              \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00138}00138               printf(\textcolor{stringliteral}{"{} No of nonzeros in factor L = \%d\(\backslash\)n"{}}, Lstore-\/>nnz);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00139}00139               printf(\textcolor{stringliteral}{"{} No of nonzeros in factor U = \%d\(\backslash\)n"{}}, Ustore-\/>nnz);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00140}00140               printf(\textcolor{stringliteral}{"{} No of nonzeros in L+U = \%d\(\backslash\)n"{}}, Lstore-\/>nnz + Ustore-\/>nnz);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00141}00141               zQuerySpace(\mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}}, \mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}}, \&mem\_usage);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00142}00142               printf(\textcolor{stringliteral}{"{} L\(\backslash\)\(\backslash\)U MB \%.3f\(\backslash\)ttotal MB needed \%.3f\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00143}00143                      \textcolor{comment}{//\(\backslash\)texpansions \%d\(\backslash\)n"{},}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00144}00144                      mem\_usage.for\_lu/1e6, mem\_usage.total\_needed/1e6);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00145}00145                      \textcolor{comment}{//mem\_usage.expansions);}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00146}00146              \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00147}00147         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00148}00148             printf(\textcolor{stringliteral}{"{}dgstrf() error returns INFO= \%d\(\backslash\)n"{}}, *info);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00149}00149             \textcolor{keywordflow}{if} ( *info <= *n ) \{ \textcolor{comment}{/* factorization completes */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00150}00150                zQuerySpace(\mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}}, \mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}}, \&mem\_usage);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00151}00151                printf(\textcolor{stringliteral}{"{} L\(\backslash\)\(\backslash\)U MB \%.3f\(\backslash\)ttotal MB needed \%.3f\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00152}00152                       \textcolor{comment}{//\(\backslash\)texpansions \%d\(\backslash\)n\(\backslash\)n"{},}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00153}00153                       mem\_usage.for\_lu/1e6, mem\_usage.total\_needed/1e6);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00154}00154                \textcolor{comment}{//mem\_usage.expansions);}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00155}00155             \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00156}00156         \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00157}00157         }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00158}00158         \textcolor{comment}{/* Save the LU factors in the factors handle */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00159}00159         LUfactors = (\mbox{\hyperlink{structfactors__t}{factors\_t}}*) SUPERLU\_MALLOC(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structfactors__t}{factors\_t}}));}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00160}00160         LUfactors-\/>\mbox{\hyperlink{structfactors__t_a17d4587aa0c7b0e0e39300d4087d4131}{L}} = \mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00161}00161         LUfactors-\/>\mbox{\hyperlink{structfactors__t_a336bf3fd72304c337b78e71607de7d1e}{U}} = \mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00162}00162         LUfactors-\/>\mbox{\hyperlink{structfactors__t_af26c51d6a48540340d440ff1c20a28cc}{perm\_c}} = perm\_c;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00163}00163         LUfactors-\/>\mbox{\hyperlink{structfactors__t_af0016e789d7a575ffc8945a23b3b812a}{perm\_r}} = perm\_r;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00164}00164         *f\_factors = (\mbox{\hyperlink{superlu__complex_8c_a2b91e9b8520a970ebe560735f71ba3bd}{fptr}}) LUfactors;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00166}00166         \textcolor{comment}{//Work out and print the sign of the determinant}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00167}00167         \textcolor{comment}{//This code is hacked from supraLU by  Alex Pletzer}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00168}00168         \textcolor{comment}{//and Doug McCune (NTCC) (http://w3.pppl.gov/ntcc/SupraLu/)}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00169}00169         Lstore = \mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}}-\/>Store;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00170}00170         Lval = Lstore-\/>nzval;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00171}00171         nsupers = Lstore-\/>nsuper + 1;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00172}00172 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00173}00173         \textcolor{comment}{//Get the diagonal entries of the U matrix}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00174}00174         \textcolor{comment}{//Allocate store for the entries}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00175}00175         \textcolor{keywordflow}{if} ( !(diagU = SUPERLU\_MALLOC( *n * \textcolor{keyword}{sizeof}(SuperMatrix) )) )}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00176}00176          ABORT(\textcolor{stringliteral}{"{}Malloc fails for diagU[]."{}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00177}00177         \textcolor{comment}{//Loop over the number of super diagonal terms(?)}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00178}00178         \textcolor{keywordflow}{for}(k2=0; k2< nsupers; k2++)}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00179}00179          \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00180}00180           fsupc = L\_FST\_SUPC(k2);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00181}00181           nsupc = L\_FST\_SUPC(k2+1) -\/ fsupc;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00182}00182           nsupr = L\_SUB\_START(fsupc+1) -\/ L\_SUB\_START(fsupc);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00183}00183           luptr = L\_NZ\_START(fsupc);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00184}00184 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00185}00185           dblock = \&diagU[fsupc];}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00186}00186           \textcolor{keywordflow}{for}(i2 = 0; i2 < nsupc; i2++)}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00187}00187            \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00188}00188             dblock[i2] = Lval[luptr];}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00189}00189             luptr += nsupr + 1;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00190}00190            \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00191}00191          \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00192}00192                   }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00193}00193         \textcolor{comment}{//Now multiply all the diagonal terms together to get the determinant}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00194}00194         \textcolor{comment}{//Note that we need to use the mantissa, exponent formulation to}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00195}00195         \textcolor{comment}{//avoid underflow errors}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00196}00196         \textcolor{keywordtype}{double} determinant\_mantissa=1.0;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00197}00197         \textcolor{keywordtype}{int} determinant\_exponent = 0, iexp;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00198}00198         \textcolor{keywordflow}{for}(\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}=0; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}<*n; \mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}++)}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00199}00199          \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00200}00200           determinant\_mantissa *= frexp(diagU[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}].r, \&iexp);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00201}00201           determinant\_exponent += iexp;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00202}00202           \textcolor{comment}{/* normalise*/}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00203}00203           determinant\_mantissa = frexp(determinant\_mantissa,\&iexp);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00204}00204           determinant\_exponent += iexp;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00205}00205                     }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00206}00206           \textcolor{comment}{/*Now worry about the permutations }}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00207}00207 \textcolor{comment}{            (this is done in a stupid, but not too inefficient way)*/}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00208}00208           \textcolor{keywordflow}{for}(j=\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}};j<*n;j++)}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00209}00209            \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00210}00210             \textcolor{keywordflow}{if}(perm\_r[j] < perm\_r[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]) \{signature *= -\/1;\}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00211}00211             \textcolor{keywordflow}{if}(perm\_c[j] < perm\_c[\mbox{\hyperlink{cfortran_8h_adb50e893b86b3e55e751a42eab3cba82}{i}}]) \{signature *= -\/1;\}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00212}00212            \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00213}00213          \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00214}00214         }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00215}00215         \textcolor{comment}{//Find the sign of the determinant}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00216}00216         \textcolor{keywordflow}{if}(determinant\_mantissa > 0.0) \{sign = 1;\}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00217}00217         \textcolor{keywordflow}{if}(determinant\_mantissa < 0.0) \{sign = -\/1;\}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00218}00218         }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00219}00219         \textcolor{comment}{//Multiply the sign by the signature}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00220}00220         sign *= signature;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00221}00221  }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00222}00222         \textcolor{comment}{/* Free un-\/wanted storage */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00223}00223         SUPERLU\_FREE(diagU);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00224}00224         SUPERLU\_FREE(etree);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00225}00225         Destroy\_SuperMatrix\_Store(\&A);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00226}00226         Destroy\_CompCol\_Permuted(\&AC);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00227}00227         StatFree(\&stat);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00228}00228 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00229}00229         \textcolor{comment}{//Return the sign of the determinant}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00230}00230         \textcolor{keywordflow}{return} sign;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00231}00231         }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00232}00232     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *op\_flag == 2 ) \{ \textcolor{comment}{/* Triangular solve */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00233}00233         \textcolor{comment}{/* Initialize the statistics variables. */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00234}00234         StatInit(\&stat);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00235}00235 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00236}00236         \textcolor{comment}{/* Extract the LU factors in the factors handle */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00237}00237         LUfactors = (\mbox{\hyperlink{structfactors__t}{factors\_t}}*) *f\_factors;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00238}00238         \mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}} = LUfactors-\/>\mbox{\hyperlink{structfactors__t_a17d4587aa0c7b0e0e39300d4087d4131}{L}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00239}00239         \mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}} = LUfactors-\/>\mbox{\hyperlink{structfactors__t_a336bf3fd72304c337b78e71607de7d1e}{U}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00240}00240         perm\_c = LUfactors-\/>\mbox{\hyperlink{structfactors__t_af26c51d6a48540340d440ff1c20a28cc}{perm\_c}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00241}00241         perm\_r = LUfactors-\/>\mbox{\hyperlink{structfactors__t_af0016e789d7a575ffc8945a23b3b812a}{perm\_r}};}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00242}00242 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00243}00243         zCreate\_Dense\_Matrix(\&\mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a43c804e2bcf9862a4bf629d5f01761e8}{B}}, *n, *nrhs, b, *ldb, SLU\_DN, SLU\_Z, SLU\_GE);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00244}00244 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00245}00245         \textcolor{comment}{/* Solve the system A*X=B, overwriting B with X. */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00246}00246         zgstrs (trans, \mbox{\hyperlink{namespaceoomph_1_1BinaryTreeNames_a7ff5e7e46beae31bf81579531b1f9895a8df863dabb4096fa066f7a6dbf7502d1}{L}}, \mbox{\hyperlink{namespaceoomph_a0593b984eb38bc1e68275a8aed5b9382}{U}}, perm\_c, perm\_r, \&\mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a43c804e2bcf9862a4bf629d5f01761e8}{B}}, \&stat, info);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00247}00247 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00248}00248         Destroy\_SuperMatrix\_Store(\&\mbox{\hyperlink{namespaceoomph_1_1OcTreeNames_ae7e7e58298b85825061eeff362656c40a43c804e2bcf9862a4bf629d5f01761e8}{B}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00249}00249         StatFree(\&stat);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00250}00250 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00251}00251         \textcolor{comment}{//Return zero}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00252}00252         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00253}00253 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00254}00254     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( *op\_flag == 3 ) \{ \textcolor{comment}{/* Free storage */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00255}00255         \textcolor{comment}{/* Free the LU factors in the factors handle */}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00256}00256         LUfactors = (\mbox{\hyperlink{structfactors__t}{factors\_t}}*) *f\_factors;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00257}00257         SUPERLU\_FREE (LUfactors-\/>\mbox{\hyperlink{structfactors__t_af0016e789d7a575ffc8945a23b3b812a}{perm\_r}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00258}00258         SUPERLU\_FREE (LUfactors-\/>\mbox{\hyperlink{structfactors__t_af26c51d6a48540340d440ff1c20a28cc}{perm\_c}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00259}00259         Destroy\_SuperNode\_Matrix(LUfactors-\/>\mbox{\hyperlink{structfactors__t_a17d4587aa0c7b0e0e39300d4087d4131}{L}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00260}00260         Destroy\_CompCol\_Matrix(LUfactors-\/>\mbox{\hyperlink{structfactors__t_a336bf3fd72304c337b78e71607de7d1e}{U}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00261}00261         SUPERLU\_FREE (LUfactors-\/>\mbox{\hyperlink{structfactors__t_a17d4587aa0c7b0e0e39300d4087d4131}{L}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00262}00262         SUPERLU\_FREE (LUfactors-\/>\mbox{\hyperlink{structfactors__t_a336bf3fd72304c337b78e71607de7d1e}{U}});}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00263}00263         SUPERLU\_FREE (LUfactors);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00264}00264         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00265}00265     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00266}00266         fprintf(stderr,\textcolor{stringliteral}{"{}Invalid op\_flag=\%d passed to c\_cpp\_dgssv()\(\backslash\)n"{}},*op\_flag);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00267}00267         exit(-\/1);}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00268}00268     \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00269}00269 \}}
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00270}00270 }
\DoxyCodeLine{\Hypertarget{superlu__complex_8c_source_l00271}00271 }

\end{DoxyCode}
