<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: refineable_spherical_navier_stokes_elements.cc Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../figures/manifest.json">
<link rel="mask-icon" href="../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../html/index.html"><img alt="oomph-lib" src="../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get it <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../doc/subversion/html/index.html">Get code from subversion repository</a></li>
            <li><a href="../../../doc/download/html/index.html">Get code as tar file</a></li>
            <li><a href="../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_24a9aee8bc053ffec0b94ff39c612277.html">spherical_navier_stokes</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">refineable_spherical_navier_stokes_elements.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="refineable__spherical__navier__stokes__elements_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//LIC// ====================================================================</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//LIC// This file forms part of oomph-lib, the object-oriented, </span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//LIC// multi-physics finite-element library, available </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//LIC// at http://www.oomph-lib.org.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//LIC// Copyright (C) 2006-2021 Matthias Heil and Andrew Hazel</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//LIC// This library is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//LIC// modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//LIC// License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//LIC// version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//LIC// This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//LIC// Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//LIC// You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//LIC// License along with this library; if not, write to the Free Software</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//LIC// 02110-1301  USA.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//LIC// The authors may be contacted at oomph-lib@maths.man.ac.uk.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//LIC//====================================================================</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="refineable__spherical__navier__stokes__elements_8h.html">refineable_spherical_navier_stokes_elements.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceoomph.html">oomph</a></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//========================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/// Add element&#39;s contribution to the elemental </span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">/// residual vector and/or Jacobian matrix.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">/// flag=1: compute both</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/// flag=0: compute only residual vector</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keywordtype">void</span> <a class="code" href="classoomph_1_1RefineableSphericalNavierStokesEquations.html#aaadda4a5dbffc1e23db2ac8b3dd86d4a">RefineableSphericalNavierStokesEquations::</a></div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="classoomph_1_1RefineableSphericalNavierStokesEquations.html#aaadda4a5dbffc1e23db2ac8b3dd86d4a">   40</a></span>&#160;<a class="code" href="classoomph_1_1RefineableSphericalNavierStokesEquations.html#aaadda4a5dbffc1e23db2ac8b3dd86d4a">fill_in_generic_residual_contribution_spherical_nst</a>(<a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="the__data__structure_8txt.html#a1400a973def57b85051cfe1070be1810">residuals</a>, </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                              <a class="code" href="classoomph_1_1DenseMatrix.html">DenseMatrix&lt;double&gt;</a> &amp;jacobian, </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                                              <a class="code" href="classoomph_1_1DenseMatrix.html">DenseMatrix&lt;double&gt;</a> &amp;mass_matrix,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                              <span class="keywordtype">unsigned</span> flag)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; <span class="comment">//Find out how many nodes there are</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_node = <a class="code" href="classoomph_1_1FiniteElement.html#a6219ed269a6d89b5aa14659cce48905a">nnode</a>();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; <span class="comment">// Get continuous time from timestepper of first node</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; <span class="keywordtype">double</span> time=<a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(0)-&gt;<a class="code" href="classoomph_1_1Data.html#a5b34970d16205921dca3ada720da8445">time_stepper_pt</a>()-&gt;<a class="code" href="classoomph_1_1TimeStepper.html#ad77678873af47aa208a9385b26ac1641">time_pt</a>()-&gt;<a class="code" href="classoomph_1_1Time.html#a6e28ea7a6664a2f5f5e1be871304a2c7">time</a>();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; <span class="comment">//Find out how many pressure dofs there are</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_pres = <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#ae01203564bc66dacf84c1ed65e4b7930">npres_spherical_nst</a>();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; <span class="comment">// Get the local indices of the nodal coordinates</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; <span class="keywordtype">unsigned</span> u_nodal_index[3];</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;3;++<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>) {u_nodal_index[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] = this-&gt;<a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a2f269e20874a87df919cc4ece4b05fe5">u_index_spherical_nst</a>(<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>);}</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; <span class="comment">// Which nodal value represents the pressure? (Negative if pressure</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; <span class="comment">// is not based on nodal interpolation).</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; <span class="keyword">const</span> <span class="keywordtype">int</span> p_index = this-&gt;<a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a7b0edc8eedacaef9e55f3551a7cb5400">p_nodal_index_spherical_nst</a>();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">// Local array of booleans that are true if the l-th pressure value is</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">// hanging (avoid repeated virtual function calls)</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; <span class="keywordtype">bool</span> pressure_dof_is_hanging[n_pres];</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; <span class="comment">//If the pressure is stored at a node</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; <span class="keywordflow">if</span>(p_index &gt;= 0)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;   <span class="comment">//Read out whether the pressure is hanging</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_pres;++l)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;     pressure_dof_is_hanging[l] = </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <a class="code" href="classoomph_1_1RefineableSphericalNavierStokesEquations.html#a1daddea2d11bb46db3e6aef3843b288d">pressure_node_pt</a>(l)-&gt;<a class="code" href="classoomph_1_1Node.html#af0e6237dfafad62cf427ff5013ddcfef">is_hanging</a>(p_index);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; <span class="comment">//Otherwise the pressure is not stored at a node and so cannot hang</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; <span class="keywordflow">else</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_pres;++l)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    {pressure_dof_is_hanging[l] = <span class="keyword">false</span>;}</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;   </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">//Set up memory for the shape and test functions</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<a class="code" href="classoomph_1_1Shape.html">Shape</a> psif(n_node), testf(n_node);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<a class="code" href="classoomph_1_1DShape.html">DShape</a> dpsifdx(n_node,2), dtestfdx(n_node,2);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">//Set up memory for pressure shape and test functions</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<a class="code" href="classoomph_1_1Shape.html">Shape</a> psip(n_pres), testp(n_pres);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">//Set the value of n_intpt</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_intpt = <a class="code" href="classoomph_1_1FiniteElement.html#a79f1710873332823c47023d370f0596b">integral_pt</a>()-&gt;<a class="code" href="classoomph_1_1Integral.html#a1a270de9d99a1fcf1d25a6c1017f65fa">nweight</a>();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">//Set the Vector to hold local coordinates</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> <a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>(2);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">//Get Physical Variables from Element</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">//Reynolds number must be multiplied by the density ratio</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; <span class="keyword">const</span> <span class="keywordtype">double</span> dens_ratio = <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a64fc30a2f613c7d0bbd5db7ad8bd27c8">density_ratio</a>();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; <span class="keyword">const</span> <span class="keywordtype">double</span> scaled_re  = <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a339dc121adc8a2eb62805ac63171fd6c">re</a>()*dens_ratio;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; <span class="keyword">const</span> <span class="keywordtype">double</span> scaled_re_st = <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#af3627c5846c81dacdfb150576a28db61">re_st</a>()*dens_ratio;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; <span class="keyword">const</span> <span class="keywordtype">double</span> scaled_re_inv_ro = <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a4a9bb055e3ea5f00d1edee5efcad4937">re_invro</a>()*dens_ratio;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; <span class="comment">//const double scaled_re_inv_fr = re_invfr()*dens_ratio;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; <span class="comment">//const double visc_ratio = viscosity_ratio();</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> G = <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#ac580f29734c9595980428b8324099d7d">g</a>();</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">//Integers to store the local equation and unknown numbers</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keywordtype">int</span> local_eqn=0, local_unknown=0;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">//Local storage for pointers to hang info objects</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; <a class="code" href="classoomph_1_1HangInfo.html">HangInfo</a> *hang_info_pt=0, *hang_info2_pt=0; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">//Loop over the integration points</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ipt=0;ipt&lt;n_intpt;ipt++)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   <span class="comment">//Assign values of s</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;2;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++) {<a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] = <a class="code" href="classoomph_1_1FiniteElement.html#a79f1710873332823c47023d370f0596b">integral_pt</a>()-&gt;<a class="code" href="classoomph_1_1Integral.html#a1a2122f99a87c18649bafdd9ed739758">knot</a>(ipt,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>);}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   <span class="comment">//Get the integral weight</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   <span class="keywordtype">double</span> w = <a class="code" href="classoomph_1_1FiniteElement.html#a79f1710873332823c47023d370f0596b">integral_pt</a>()-&gt;<a class="code" href="classoomph_1_1Integral.html#ac65335e2aab120b285b3d6c294507b06">weight</a>(ipt);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;   <span class="comment">//Call the derivatives of the shape and test functions</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   <span class="keywordtype">double</span> J = </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a10ed6f34245f5b31095ae636fc08749a">dshape_and_dtest_eulerian_at_knot_spherical_nst</a>(ipt,psif,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                                    dpsifdx,testf,dtestfdx);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;   </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   <span class="comment">//Call the pressure shape and test functions</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a17799ec1f3a1d8bbeee1d357bba0a249">pshape_spherical_nst</a>(<a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>,psip,testp);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   <span class="comment">//Premultiply the weights and the Jacobian</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   <span class="keywordtype">double</span> <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a> = w*J;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="comment">//Calculate local values of the pressure and velocity components</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; <span class="comment">//--------------------------------------------------------------</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   <span class="keywordtype">double</span> interpolated_p=0.0;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>(3,0.0);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> <a class="code" href="classoomph_1_1FiniteElement.html#a5a9c1ead9819cd17603096e63087020f">interpolated_x</a>(2,0.0);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;   <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> mesh_velocity(2,0.0);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> dudt(3,0.0);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   <a class="code" href="classoomph_1_1DenseMatrix.html">DenseMatrix&lt;double&gt;</a> interpolated_dudx(3,2,0.0);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;   <span class="comment">//Calculate pressure</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_pres;l++) </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    {interpolated_p += this-&gt;<a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a5b50d547e5a2ad5896dc9612e2bb4176">p_spherical_nst</a>(l)*psip(l);}</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   <span class="comment">//Calculate velocities and derivatives</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   <span class="comment">// Loop over nodes</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++) </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;     <span class="comment">//Cache the shape function</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;     <span class="keywordtype">double</span> psi_ = psif(l);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;     <span class="comment">//Loop over positions separately</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;2;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;       <a class="code" href="classoomph_1_1FiniteElement.html#a5a9c1ead9819cd17603096e63087020f">interpolated_x</a>[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] += <a class="code" href="classoomph_1_1FiniteElement.html#a9152c16ae9899168bcdaac7c2f977444">nodal_position</a>(l,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)*psi_;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;     </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;     <span class="comment">//Loop over velocity directions (three of these)</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;3;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">double</span> u_value = this-&gt;<a class="code" href="classoomph_1_1FiniteElement.html#a28fd5c2d4aeba5ef65bee0e0d72569f5">nodal_value</a>(l,u_nodal_index[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>]);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;       <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] += u_value*psi_;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;       dudt[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] += <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a6f9ce7398b2f2a767fddc7473046c674">du_dt_spherical_nst</a>(l,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)*psi_;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;       </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;       <span class="comment">//Loop over derivative directions for gradients</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j=0;j&lt;2;j++)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        {                               </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;         interpolated_dudx(<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>,j) += u_value*dpsifdx(l,j);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;     </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;     <span class="comment">//Only bother to calculate the mesh velocity if we are using an ALE</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;     <span class="comment">//method</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;     <span class="keywordflow">if</span> (!<a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#ae99a23d65958a96ae2d90151b86d30ab">ALE_is_disabled</a>)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;       <span class="keywordflow">throw</span> <a class="code" href="classoomph_1_1OomphLibError.html">OomphLibError</a>(</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="stringliteral">&quot;ALE is not properly implemented for Refineable Spherical NS yet&quot;</span>,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        OOMPH_CURRENT_FUNCTION,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;       <span class="comment">//Loop over directions (only DIM (2) of these)</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;2;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;         mesh_velocity[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] += this-&gt;<a class="code" href="classoomph_1_1FiniteElement.html#adcd3fe593044db9afae4c15f85ebb175">dnodal_position_dt</a>(l,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)*psi_;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    } <span class="comment">//End of loop over the nodes</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;   <span class="comment">//Get the user-defined body force terms</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> body_force(3);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;   this-&gt;<a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#a6dbdc5a0b33a0f36494ffefed1a938ac">get_body_force_spherical_nst</a>(time,ipt,<a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>,<a class="code" href="classoomph_1_1FiniteElement.html#a5a9c1ead9819cd17603096e63087020f">interpolated_x</a>,body_force);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;   <span class="comment">//Get the user-defined source function</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="comment">//double source=this-&gt;get_source_spherical_nst(time(),ipt,interpolated_x);</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <span class="comment">// r is the first postition component</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> r = <a class="code" href="classoomph_1_1FiniteElement.html#a5a9c1ead9819cd17603096e63087020f">interpolated_x</a>[0];</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> r2 = r*r;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   <span class="comment">//const double theta = interpolated_x[1];</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> sin_theta = sin(<a class="code" href="classoomph_1_1FiniteElement.html#a5a9c1ead9819cd17603096e63087020f">interpolated_x</a>[1]);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> cos_theta = cos(<a class="code" href="classoomph_1_1FiniteElement.html#a5a9c1ead9819cd17603096e63087020f">interpolated_x</a>[1]);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> cot_theta = cos_theta/sin_theta;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> u_r = <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>[0];</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> u_theta = <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>[1];</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> u_phi = <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>[2];</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   <span class="comment">//Pre-calculate the scaling factor of the jacobian</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   <span class="comment">//double W_pure = W;</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;   </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   <span class="comment">//W *= r*r*sin(theta);</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   <span class="comment">//MOMENTUM EQUATIONS</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   <span class="comment">//==================</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   <span class="comment">//Number of master nodes and storage for the weight of the shape function</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   <span class="keywordtype">unsigned</span> n_master=1; <span class="keywordtype">double</span> hang_weight=1.0;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   <span class="comment">//Loop over the nodes for the test functions/equations</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   <span class="comment">//----------------------------------------------------</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;     <span class="comment">//Local boolean that indicates the hanging status of the node</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">bool</span> is_node_hanging = <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l)-&gt;<a class="code" href="classoomph_1_1Node.html#af0e6237dfafad62cf427ff5013ddcfef">is_hanging</a>();</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;     </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;     <span class="comment">//If the node is hanging</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;     <span class="keywordflow">if</span>(is_node_hanging)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;       <span class="comment">//Get the hanging pointer</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;       hang_info_pt = <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l)-&gt;<a class="code" href="classoomph_1_1Node.html#ab7b94371e9a8b62fe9a5cc7a03113ad9">hanging_pt</a>();</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;       <span class="comment">//Read out number of master nodes from hanging data</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;       n_master = hang_info_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#aa9c1130b58db2ff6d5eee4f923ba365c">nmaster</a>();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;     <span class="comment">//Otherwise the node is its own master</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;     <span class="keywordflow">else</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;       n_master = 1;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;     </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;     <span class="comment">//Loop over the master nodes</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> m=0;m&lt;n_master;m++)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;       <span class="comment">// Loop over velocity components for equations</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;2+1;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;         <span class="comment">//Get the equation number</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;         <span class="comment">//If the node is hanging</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;         <span class="keywordflow">if</span>(is_node_hanging)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;          {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;         <span class="comment">//Get the equation number from the master node</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;         local_eqn = this-&gt;<a class="code" href="classoomph_1_1RefineableElement.html#abc3d0cb0131ebf717ff0620242c9ca2b">local_hang_eqn</a>(hang_info_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#a2c102c3048a87bbfdde753a094f641fe">master_node_pt</a>(m),</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                          u_nodal_index[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>]);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;         <span class="comment">//Get the hang weight from the master node</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;         hang_weight = hang_info_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#a923bb47b87b6d4dd535e6ae41a4ff88c">master_weight</a>(m);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;       <span class="comment">//If the node is not hanging</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;         <span class="comment">// Local equation number</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;         local_eqn = this-&gt;<a class="code" href="classoomph_1_1FiniteElement.html#a5da80bbed97543e586f698251d67941d">nodal_local_eqn</a>(l,u_nodal_index[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>]);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;         <span class="comment">// Node contributes with full weight</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;         hang_weight = 1.0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;         </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;         <span class="comment">//If it&#39;s not a boundary condition...</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;         <span class="keywordflow">if</span>(local_eqn&gt;= 0)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;           <span class="comment">// initialise for residual calculation</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;           <span class="keywordtype">double</span> sum=0.0;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;           </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;           <span class="keywordflow">switch</span> (<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;             <span class="comment">// RADIAL MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;             <span class="comment">// Convective r-terms</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;             <span class="keywordtype">double</span> conv = r*u_r*interpolated_dudx(0,0);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;             </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;             <span class="comment">// Convective theta-terms</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;             conv += u_theta*interpolated_dudx(0,1);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;             </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;             <span class="comment">// Remaining convective terms</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;             conv -= (u_theta*u_theta + u_phi*u_phi);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;             </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;             <span class="comment">//Add the time-derivative and convective terms</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;             sum += (scaled_re_st*dudt[0]*r2 + scaled_re*r*conv)*</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;              sin_theta*testf(l);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;             <span class="comment">//Add the user-defined body force term</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;             sum -= r2*sin_theta*body_force[0]*testf(l);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;             <span class="comment">//Add the Coriolis term</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;             sum -= 2.0*scaled_re_inv_ro*sin_theta*u_phi*r2*sin_theta*testf(l);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;             </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;             <span class="comment">// r-derivative test function component of stress tensor</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;             sum += (-interpolated_p + 2*interpolated_dudx(0,0))*</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;              r2*sin_theta*dtestfdx(l,0);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;             </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;             <span class="comment">// theta-derivative test function component of stress tensor</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;             sum += (r*interpolated_dudx(1,0) - u_theta + </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                     interpolated_dudx(0,1))*sin_theta*dtestfdx(l,1);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;             </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;             <span class="comment">// Undifferentiated test function component of stress tensor</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;             sum += 2.0*( (-r*interpolated_p + </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                           + interpolated_dudx(1,1) + </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                           2.0*u_r)*sin_theta + </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                          u_theta*cos_theta)*testf(l);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="comment">// THETA-COMPONENT MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;             <span class="comment">// All convective terms</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;             <span class="keywordtype">double</span> conv = </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;              (u_r*interpolated_dudx(1,0)*r </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;               + u_theta*interpolated_dudx(1,1)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;               + u_r*u_theta)*sin_theta  - u_phi*u_phi*cos_theta;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;             </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;             <span class="comment">//Add the time-derivative and convective terms to the residual</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;             sum += (scaled_re_st*r2*sin_theta*dudt[1] + </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                     scaled_re*r*conv)*testf(l);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;             <span class="comment">//Add the user-defined body force term</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;             sum -= r2*sin_theta*body_force[1]*testf(l);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;              <span class="comment">//Add the Coriolis term</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;             sum -= 2.0*scaled_re_inv_ro*cos_theta*u_phi*r2*sin_theta*testf(l);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;             <span class="comment">// r-derivative test function component of stress tensor</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;             sum += </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;              (r*interpolated_dudx(1,0) - u_theta + interpolated_dudx(0,1))*</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;              r*sin_theta*dtestfdx(l,0);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;             </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;             <span class="comment">// theta-derivative test function component of stress tensor</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;             sum += </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;              (-r*interpolated_p + 2.0*interpolated_dudx(1,1) + </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;               2*u_r)*sin_theta*dtestfdx(l,1);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;             </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;             <span class="comment">// Undifferentiated test function component of stress tensor</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;             sum -= </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;              ((r*interpolated_dudx(1,0) - u_theta + interpolated_dudx(0,1))*</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;               sin_theta</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;               - (-r*interpolated_p + 2.0*u_r + 2.0*u_theta*cot_theta)*</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;               cos_theta)*testf(l);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;             </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="comment">// PHI-COMPONENT MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;             </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;             <span class="comment">// Convective r-terms</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;             <span class="keywordtype">double</span> conv = u_r*interpolated_dudx(2,0)*r*sin_theta;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;             </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;             <span class="comment">// Convective theta-terms</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;             conv += u_theta*interpolated_dudx(2,1)*sin_theta;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;             </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;             <span class="comment">// Remaining convective terms</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;             conv += u_phi*(u_r*sin_theta + u_theta*cos_theta);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;             </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;             <span class="comment">//Add the time-derivative and convective terms</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;             sum += (scaled_re_st*r2*dudt[2]*sin_theta </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                     + scaled_re*conv*r)*testf(l);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;             </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;             sum -= r2*sin_theta*body_force[2]*testf(l);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;             <span class="comment">//Add the Coriolis term</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;             sum += 2.0*scaled_re_inv_ro*</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;              (cos_theta*u_theta + sin_theta*u_r)*r2*sin_theta*testf(l);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;             <span class="comment">// r-derivative test function component of stress tensor</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;             sum += </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;              (r2*interpolated_dudx(2,0) - r*u_phi)*dtestfdx(l,0)*sin_theta;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;             </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;             <span class="comment">// theta-derivative test function component of stress tensor</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;             sum += (interpolated_dudx(2,1)*sin_theta </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                     - u_phi*cos_theta)*dtestfdx(l,1);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;             </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;             <span class="comment">// Undifferentiated test function component of stress tensor</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;             sum -= ((r*interpolated_dudx(2,0) - u_phi)*sin_theta </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                     + (interpolated_dudx(2,1) - u_phi*cot_theta)*cos_theta)*</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;              testf(l);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;             </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;           </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;           <span class="comment">// Add contribution</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;           <span class="comment">//Sign changed to be consistent with other NS implementations</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;           <a class="code" href="the__data__structure_8txt.html#a1400a973def57b85051cfe1070be1810">residuals</a>[local_eqn] -= sum*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;           </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;           <span class="comment">//CALCULATE THE JACOBIAN</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;           <span class="keywordflow">if</span> (flag)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;             <span class="comment">//Number of master nodes and weights</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;             <span class="keywordtype">unsigned</span> n_master2=1; <span class="keywordtype">double</span> hang_weight2=1.0;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;             <span class="comment">//Loop over the velocity nodes for columns</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l2=0;l2&lt;n_node;l2++)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;              {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;               <span class="comment">//Local boolean for hanging status</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;               <span class="keyword">const</span> <span class="keywordtype">bool</span> is_node2_hanging = <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l2)-&gt;<a class="code" href="classoomph_1_1Node.html#af0e6237dfafad62cf427ff5013ddcfef">is_hanging</a>();</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                 </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;               <span class="comment">//If the node is hanging</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;               <span class="keywordflow">if</span>(is_node2_hanging)</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                 hang_info2_pt = <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l2)-&gt;<a class="code" href="classoomph_1_1Node.html#ab7b94371e9a8b62fe9a5cc7a03113ad9">hanging_pt</a>();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                 <span class="comment">//Read out number of master nodes from hanging data</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                 n_master2 = hang_info2_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#aa9c1130b58db2ff6d5eee4f923ba365c">nmaster</a>();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;               <span class="comment">//Otherwise the node is its own master</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                 n_master2 = 1;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;               </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;               <span class="comment">//Loop over the master nodes</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;               <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> m2=0;m2&lt;n_master2;m2++)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                 <span class="comment">//Loop over the velocity components</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i2=0;i2&lt;2+1;i2++)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                  {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                   <span class="comment">//Get the number of the unknown</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                   <span class="comment">//If the node is hanging</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                   <span class="keywordflow">if</span>(is_node2_hanging)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                    {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                     <span class="comment">//Get the equation number from the master node</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                     local_unknown = </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                      this-&gt;<a class="code" href="classoomph_1_1RefineableElement.html#abc3d0cb0131ebf717ff0620242c9ca2b">local_hang_eqn</a>(hang_info2_pt-&gt;master_node_pt(m2),</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                                           u_nodal_index[i2]);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                     hang_weight2 = hang_info2_pt-&gt;master_weight(m2);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                     local_unknown = </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                      this-&gt;<a class="code" href="classoomph_1_1FiniteElement.html#a5da80bbed97543e586f698251d67941d">nodal_local_eqn</a>(l2,u_nodal_index[i2]);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                     hang_weight2 = 1.0;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                    }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                   </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                   <span class="comment">// If the unknown is non-zero</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                   <span class="keywordflow">if</span>(local_unknown &gt;= 0)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                    {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                     <span class="comment">//Different results for i and i2</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                     <span class="keywordflow">switch</span> (<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                      {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                       <span class="comment">// RADIAL MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                      <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                       <span class="keywordflow">switch</span> (i2)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                        {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                         <span class="comment">// radial component</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                        <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                         </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                         <span class="comment">//Add the mass matrix entries</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                         <span class="keywordflow">if</span>(flag==2)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                          {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                           mass_matrix(local_eqn,local_unknown) +=</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                            scaled_re_st*psif(l2)*testf(l)*r2*sin_theta*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                            *hang_weight*hang_weight2;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                          }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                         </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                         {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                          <span class="comment">// Convective r-term contribution</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                          <span class="keywordtype">double</span> jac_conv = </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                           r*(psif(l2)*interpolated_dudx(0,0) + </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                              u_r*dpsifdx(l2,0));</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                          </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                          <span class="comment">// Convective theta-term contribution</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                          jac_conv += u_theta*dpsifdx(l2,1);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                          </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                          <span class="comment">//Add the time-derivative contribution and </span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                          <span class="comment">//the convective</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                          <span class="comment">//contribution to the sum</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                          <span class="keywordtype">double</span> jac_sum = </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                           (scaled_re_st*</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                            <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l2)-&gt;<a class="code" href="classoomph_1_1Data.html#a5b34970d16205921dca3ada720da8445">time_stepper_pt</a>()-&gt;<a class="code" href="classoomph_1_1TimeStepper.html#a4cb0aecb044b77ba0553cdd54b586d8a">weight</a>(1,0)*</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                            psif(l2)*r2 + scaled_re*jac_conv*r)*testf(l);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                          </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                          </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                          <span class="comment">// Contribution from the r-derivative test function </span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                          <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                          jac_sum += 2.0*dpsifdx(l2,0)*dtestfdx(l,0)*r2;  </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                          </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                          <span class="comment">// Contribution from the theta-derivative </span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                          <span class="comment">//test function part  of stress tensor</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                          jac_sum += dpsifdx(l2,1)*dtestfdx(l,1); </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                          </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                          </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                          <span class="comment">// Contribution from the undifferentiated </span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                          <span class="comment">//test function part </span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                          <span class="comment">//of stress tensor</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                          jac_sum += 4.0*psif[l2]*testf(l);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                          </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                          <span class="comment">//Add the total contribution to the </span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                          <span class="comment">//jacobian multiplied </span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                          <span class="comment">//by the jacobian weight</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                          jacobian(local_eqn,local_unknown) -= </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                           jac_sum*sin_theta*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                         }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                         </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                         </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                         <span class="comment">// axial component</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                        <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                        {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                         <span class="comment">// No time derivative contribution</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                         </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                         <span class="comment">// Convective contribution</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                         <span class="keywordtype">double</span> jac_sum = </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                          scaled_re*(interpolated_dudx(0,1) - 2.0*u_theta)*</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                          psif(l2)*r*sin_theta*testf(l); </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                         </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                         <span class="comment">//Contribution from the theta-derivative </span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                         <span class="comment">//test function </span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                         <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                         jac_sum += </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                          (r*dpsifdx(l2,0) - psif(l2))*dtestfdx(l,1)*sin_theta;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                         </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                         <span class="comment">// Contribution from the undifferentiated </span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                         <span class="comment">//test function </span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                         <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                         jac_sum += </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                          2.0*(dpsifdx(l2,1)*sin_theta + </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                               psif(l2)*cos_theta)*testf(l);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                         </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                         <span class="comment">//Add the full contribution to the jacobian matrix</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                         jacobian(local_eqn,local_unknown) -= </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                          jac_sum*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                         </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                        } <span class="comment">// End of i2 = 1 section</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                      </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                       <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                           </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                       <span class="comment">// azimuthal component</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                         <span class="comment">// Single convective-term contribution</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                         jacobian(local_eqn,local_unknown) += </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                          2.0*scaled_re*u_phi*psif[l2]*r*sin_theta*testf[l]*</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                          <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                         <span class="comment">//Add the Coriolis term</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                         jacobian(local_eqn,local_unknown) +=</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                          2.0*scaled_re_inv_ro*sin_theta*psif(l2)*r2*</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                          sin_theta*testf[l]*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                        }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                        </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                        } <span class="comment">//End of contribution radial momentum eqn</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                       <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                       </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                       <span class="comment">// AXIAL MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                      <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                       <span class="keywordflow">switch</span> (i2)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                        {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                         <span class="comment">// radial component</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                        <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                        {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                         <span class="comment">//Convective terms</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                         <span class="keywordtype">double</span> jac_sum = scaled_re*(</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                          r2*interpolated_dudx(1,0) + r*u_theta)*psif(l2)*</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                          sin_theta*testf(l);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                         </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                         <span class="comment">// Contribution from the r-derivative </span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                         <span class="comment">//test function part of stress tensor</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                         jac_sum += dpsifdx(l2,1)*dtestfdx(l,0)*sin_theta*r;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                         </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                         <span class="comment">// Contribution from the theta-derivative </span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                         <span class="comment">//test function </span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                         <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                         jac_sum += 2.0*psif(l2)*dtestfdx(l,1)*sin_theta;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                         </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                         <span class="comment">// Contribution from the undifferentiated </span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                         <span class="comment">//test function </span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                         <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                         jac_sum -= (dpsifdx(l2,1)*sin_theta  </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                                     - 2.0*psif(l2)*cos_theta)*testf(l);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                         </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                         <span class="comment">//Add the sum to the jacobian</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                         jacobian(local_eqn,local_unknown) -= </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                          jac_sum*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                        }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                        </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                       <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                           </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                       <span class="comment">// axial component</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                         </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                         <span class="comment">//Add the mass matrix terms</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                         <span class="keywordflow">if</span>(flag==2)</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                          {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                           mass_matrix(local_eqn,local_unknown) +=</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                            scaled_re_st*psif[l2]*testf[l]*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*r2*sin_theta</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                            *hang_weight*hang_weight2;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                          }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                         </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                         </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                         {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                          <span class="comment">// Contribution from the convective terms</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                          <span class="keywordtype">double</span> jac_conv = </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                           r*u_r*dpsifdx(l2,0) + u_theta*dpsifdx(l2,1) + </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                           (interpolated_dudx(1,1) + u_r)*psif(l2);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                          </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                          <span class="comment">//Add the time-derivative term and the </span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                          <span class="comment">//convective terms</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                          <span class="keywordtype">double</span> jac_sum = </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                           (scaled_re_st*</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                            <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l2)-&gt;<a class="code" href="classoomph_1_1Data.html#a5b34970d16205921dca3ada720da8445">time_stepper_pt</a>()-&gt;<a class="code" href="classoomph_1_1TimeStepper.html#a4cb0aecb044b77ba0553cdd54b586d8a">weight</a>(1,0)*</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                            psif(l2)*r2 + </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                            scaled_re*r*jac_conv)*testf(l)*sin_theta;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                          </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                          </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                          <span class="comment">// Contribution from the r-derivative test function </span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                          <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                          jac_sum += </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                           (r*dpsifdx(l2,0) - psif(l2))*r*</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                           dtestfdx(l,0)*sin_theta;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                          </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                          <span class="comment">// Contribution from the theta-derivative </span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                          <span class="comment">//test function </span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                          <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                          jac_sum += 2.0*dpsifdx(l2,1)*dtestfdx(l,1)*sin_theta;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                          </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                          <span class="comment">// Contribution from the undifferentiated </span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                          <span class="comment">//test function </span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                          <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                          jac_sum -= </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                           ((r*dpsifdx(l2,0) - psif(l2))*sin_theta </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                            - 2.0*psif(l2)*cot_theta*cos_theta)*testf(l);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                          </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                          <span class="comment">//Add the contribution to the jacobian</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                          jacobian(local_eqn,local_unknown) -= </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                           jac_sum*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                         }</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                         </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                         <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                         </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                         <span class="comment">// azimuthal component</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                        {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                         <span class="comment">// Only a convective term contribution</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                         jacobian(local_eqn,local_unknown) += </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                          scaled_re*2.0*r*psif(l2)*u_phi*cos_theta*testf(l)*</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                          <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                         </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                         <span class="comment">//Add the Coriolis term</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                         jacobian(local_eqn,local_unknown) +=</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                          2.0*scaled_re_inv_ro*cos_theta*psif(l2)*r2</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                          *sin_theta*testf[l]*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                        }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                        </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                       <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                      }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                          </div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                     <span class="comment">// AZIMUTHAL MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                    <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                     <span class="keywordflow">switch</span> (i2)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                      {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                       <span class="comment">// radial component</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                      <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                      {</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                       <span class="comment">// Contribution from convective terms</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                       jacobian(local_eqn,local_unknown) -= </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                        scaled_re*(r*interpolated_dudx(2,0) + u_phi)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                        *psif(l2)*testf(l)*r*sin_theta*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                        hang_weight*hang_weight2;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                   </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                       <span class="comment">//Coriolis term</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                       jacobian(local_eqn,local_unknown) -=</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                        2.0*scaled_re_inv_ro*sin_theta*psif(l2)*r2</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                        *sin_theta*testf[l]*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                       </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                      }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                      </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                      <span class="comment">// axial component</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                      <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                      {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                       </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                       <span class="comment">//Contribution from convective terms</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                       jacobian(local_eqn,local_unknown) -=</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                        scaled_re*(interpolated_dudx(2,1)*sin_theta</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                   + u_phi*cos_theta)*r*psif(l2)*testf(l)*</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                        <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                       <span class="comment">//Coriolis term</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                       jacobian(local_eqn,local_unknown) -=</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                        2.0*scaled_re_inv_ro*cos_theta*psif(l2)*r2*sin_theta</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        *testf[l]*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                       </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                      }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                       <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                            </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                       <span class="comment">// azimuthal component</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                      <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                                                   </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                       <span class="comment">//Add the mass matrix terms</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                       <span class="keywordflow">if</span>(flag==2)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                        {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                         mass_matrix(local_eqn,local_unknown) +=</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                          scaled_re_st*psif[l2]*testf[l]*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*r2*sin_theta</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                          *hang_weight*hang_weight2;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                        }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                       </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                       {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                        <span class="comment">//Convective terms</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                        <span class="keywordtype">double</span> jac_conv = r*u_r*dpsifdx(l2,0)*sin_theta;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                        </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                        <span class="comment">// Convective theta-term contribution</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                        jac_conv += u_theta*dpsifdx(l2,1)*sin_theta;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                        </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                        <span class="comment">// Contribution from the remaining convective terms</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                        jac_conv += </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                         (u_r*sin_theta + u_theta*cos_theta)*psif(l2);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                        </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                        <span class="comment">//Add the convective and time derivatives</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                        <span class="keywordtype">double</span> jac_sum =</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                         (scaled_re_st*</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                          <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l2)-&gt;<a class="code" href="classoomph_1_1Data.html#a5b34970d16205921dca3ada720da8445">time_stepper_pt</a>()-&gt;<a class="code" href="classoomph_1_1TimeStepper.html#a4cb0aecb044b77ba0553cdd54b586d8a">weight</a>(1,0)*</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                          psif(l2)*r2*sin_theta +</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                          scaled_re*r*jac_conv)*testf(l);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                        </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                        </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                        <span class="comment">// Contribution from the r-derivative test function </span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                        <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                        jac_sum += </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                         (r*dpsifdx(l2,0) </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                          - psif(l2))*dtestfdx(l,0)*r*sin_theta;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                        </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                        <span class="comment">// Contribution from the theta-derivative </span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                        <span class="comment">//test function </span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                        <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                        jac_sum += </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                         (dpsifdx(l2,1)*sin_theta - psif(l2)*cos_theta)*</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                         dtestfdx(l,1);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                        </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                        <span class="comment">// Contribution from the undifferentiated </span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                        <span class="comment">//test function </span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        <span class="comment">//part of stress tensor</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                        jac_sum -= ((r*dpsifdx(l2,0) - psif(l2))*sin_theta</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                                    + (dpsifdx(l2,1) - psif(l2)*cot_theta)*</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                                    cos_theta)*testf(l);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                        </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                        <span class="comment">//Add to the jacobian</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                        jacobian(local_eqn,local_unknown) -= </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                         jac_sum*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                       }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                       </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                       <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                      }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                     <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                    }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                    }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;              }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            } <span class="comment">//End of loop over the nodes</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;           <span class="comment">//Loop over the pressure shape functions</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l2=0;l2&lt;n_pres;l2++)</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;             <span class="comment">//If the pressure dof is hanging</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;             <span class="keywordflow">if</span>(pressure_dof_is_hanging[l2])</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;              {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;               <span class="comment">// Pressure dof is hanging so it must be nodal-based</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;               hang_info2_pt = </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                <a class="code" href="classoomph_1_1RefineableSphericalNavierStokesEquations.html#a1daddea2d11bb46db3e6aef3843b288d">pressure_node_pt</a>(l2)-&gt;<a class="code" href="classoomph_1_1Node.html#ab7b94371e9a8b62fe9a5cc7a03113ad9">hanging_pt</a>(p_index);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;               <span class="comment">//Get the number of master nodes from the pressure node</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;               n_master2 = hang_info2_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#aa9c1130b58db2ff6d5eee4f923ba365c">nmaster</a>();</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;              }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;             <span class="comment">//Otherwise the node is its own master</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;              {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;               n_master2 = 1;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;              }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                 </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;             <span class="comment">//Loop over the master nodes</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> m2=0;m2&lt;n_master2;m2++)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;              {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;               <span class="comment">//Get the number of the unknown</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;               <span class="comment">//If the pressure dof is hanging</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;               <span class="keywordflow">if</span>(pressure_dof_is_hanging[l2])</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                 <span class="comment">//Get the unknown from the node</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                 local_unknown = </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                  <a class="code" href="classoomph_1_1RefineableElement.html#abc3d0cb0131ebf717ff0620242c9ca2b">local_hang_eqn</a>(hang_info2_pt-&gt;master_node_pt(m2),</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                                 p_index);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                 <span class="comment">//Get the weight from the hanging object</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                 hang_weight2 = hang_info2_pt-&gt;master_weight(m2);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                 local_unknown = <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#ad8d9a0edbe3793a008a6bff670c26643">p_local_eqn</a>(l2);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                 hang_weight2 = 1.0;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                   </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;               <span class="comment">//If the unknown is not pinned</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;               <span class="keywordflow">if</span>(local_unknown &gt;= 0)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                 <span class="comment">//Add in contributions to different equations</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                 <span class="keywordflow">switch</span> (<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                  {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                   <span class="comment">// RADIAL MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                  <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                   jacobian(local_eqn,local_unknown) += </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                    psip(l2)*(r2*dtestfdx(l,0) + 2.0*r*testf[l])*</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                    <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*sin_theta*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                   </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                   <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                       </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                   <span class="comment">// AXIAL MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                  <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                   jacobian(local_eqn,local_unknown) += </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    psip(l2)*r*(dtestfdx(l,1)*sin_theta + cos_theta*testf(l))*</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                    <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                   </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                   <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                       </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                   <span class="comment">// AZIMUTHAL MOMENTUM EQUATION</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                  <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                   <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                  }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;              }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            } <span class="comment">//End of loop over pressure dofs</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;          }<span class="comment">// End of Jacobian calculation</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        } <span class="comment">//End of if not boundary condition statement</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      } <span class="comment">//End of loop over velocity components </span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    } <span class="comment">//End of loop over master nodes</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  } <span class="comment">//End of loop over nodes</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                          </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; <span class="comment">//CONTINUITY EQUATION</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; <span class="comment">//===================</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; <span class="comment">//Loop over the pressure shape functions</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_pres;l++)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;   <span class="comment">//If the pressure dof is hanging</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;   <span class="keywordflow">if</span>(pressure_dof_is_hanging[l])</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;     <span class="comment">// Pressure dof is hanging so it must be nodal-based</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;     hang_info_pt = <a class="code" href="classoomph_1_1RefineableSphericalNavierStokesEquations.html#a1daddea2d11bb46db3e6aef3843b288d">pressure_node_pt</a>(l)-&gt;<a class="code" href="classoomph_1_1Node.html#ab7b94371e9a8b62fe9a5cc7a03113ad9">hanging_pt</a>(p_index);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;     <span class="comment">//Get the number of master nodes from the pressure node</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;     n_master = hang_info_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#aa9c1130b58db2ff6d5eee4f923ba365c">nmaster</a>();</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;   <span class="comment">//Otherwise the node is its own master</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   <span class="keywordflow">else</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;     n_master = 1;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;         </div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   <span class="comment">//Loop over the master nodes</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> m=0;m&lt;n_master;m++)</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;     <span class="comment">//Get the number of the unknown</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;     <span class="comment">//If the pressure dof is hanging</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;     <span class="keywordflow">if</span>(pressure_dof_is_hanging[l])</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;       local_eqn = <a class="code" href="classoomph_1_1RefineableElement.html#abc3d0cb0131ebf717ff0620242c9ca2b">local_hang_eqn</a>(hang_info_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#a2c102c3048a87bbfdde753a094f641fe">master_node_pt</a>(m),p_index);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;       hang_weight = hang_info_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#a923bb47b87b6d4dd535e6ae41a4ff88c">master_weight</a>(m);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      }</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;     <span class="keywordflow">else</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;       local_eqn = <a class="code" href="classoomph_1_1SphericalNavierStokesEquations.html#ad8d9a0edbe3793a008a6bff670c26643">p_local_eqn</a>(l);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;       hang_weight = 1.0;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;           </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;     <span class="comment">//If the equation is not pinned</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;     <span class="keywordflow">if</span>(local_eqn &gt;= 0)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;       <span class="comment">//The entire continuity equation</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;       <a class="code" href="the__data__structure_8txt.html#a1400a973def57b85051cfe1070be1810">residuals</a>[local_eqn] += </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        ((2.0*u_r + r*interpolated_dudx(0,0) + interpolated_dudx(1,1))*</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;         sin_theta + u_theta*cos_theta)*r*testp(l)*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;              </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;       <span class="comment">//CALCULATE THE JACOBIAN</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;       <span class="comment">//======================</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;       <span class="keywordflow">if</span> (flag)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;         <span class="keywordtype">unsigned</span> n_master2=1; <span class="keywordtype">double</span> hang_weight2=1.0;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;         <span class="comment">//Loop over the velocity nodes for columns</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l2=0;l2&lt;n_node;l2++)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;          {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;           <span class="comment">//Local boolean to indicate whether the node is hanging</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;           <span class="keywordtype">bool</span> is_node2_hanging = <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l2)-&gt;<a class="code" href="classoomph_1_1Node.html#af0e6237dfafad62cf427ff5013ddcfef">is_hanging</a>();</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                 </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;           <span class="comment">//If the node is hanging</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;           <span class="keywordflow">if</span>(is_node2_hanging)</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;             hang_info2_pt = <a class="code" href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">node_pt</a>(l2)-&gt;<a class="code" href="classoomph_1_1Node.html#ab7b94371e9a8b62fe9a5cc7a03113ad9">hanging_pt</a>();</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;             <span class="comment">//Read out number of master nodes from hanging data</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;             n_master2 = hang_info2_pt-&gt;<a class="code" href="classoomph_1_1HangInfo.html#aa9c1130b58db2ff6d5eee4f923ba365c">nmaster</a>();</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;           <span class="comment">//Otherwise the node is its own master</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;             n_master2 = 1;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                 </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;           <span class="comment">//Loop over the master nodes</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> m2=0;m2&lt;n_master2;m2++)</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;             <span class="comment">//Loop over the velocity components</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i2=0;i2&lt;2+1;i2++)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;              {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;               <span class="comment">//Get the number of the unknown</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;               <span class="comment">//If the node is hanging</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;               <span class="keywordflow">if</span>(is_node2_hanging)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                 <span class="comment">//Get the equation number from the master node</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                 local_unknown = </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                  <a class="code" href="classoomph_1_1RefineableElement.html#abc3d0cb0131ebf717ff0620242c9ca2b">local_hang_eqn</a>(hang_info2_pt-&gt;master_node_pt(m2),</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                 u_nodal_index[i2]);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                 hang_weight2 = hang_info2_pt-&gt;master_weight(m2);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                 local_unknown = this-&gt;<a class="code" href="classoomph_1_1FiniteElement.html#a5da80bbed97543e586f698251d67941d">nodal_local_eqn</a>(l2,u_nodal_index[i2]);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                 hang_weight2 = 1.0;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                     </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;               <span class="comment">//If the unknown is not pinned</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;               <span class="keywordflow">if</span>(local_unknown &gt;= 0)</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                 <span class="keywordflow">switch</span> (i2)</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                  {</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                   <span class="comment">// radial component</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                  <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                   jacobian(local_eqn,local_unknown) += </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                    (2.0*psif(l2) + r*dpsifdx(l2,0))*r*sin_theta*testp(l)*</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                    <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*hang_weight*hang_weight2;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                   </div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                   <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                   <span class="comment">// axial component</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                  <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                   jacobian(local_eqn,local_unknown) += </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                    r*(dpsifdx(l2,1)*sin_theta + </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                       psif(l2)*cos_theta)*testp(l)*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>*</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                    hang_weight*hang_weight2;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                   <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                   <span class="comment">// azimuthal component</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                  <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                   <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                  }</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;              }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;          } <span class="comment">//End of loop over nodes</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;         <span class="comment">//NO PRESSURE CONTRIBUTIONS TO CONTINUITY EQUATION</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        } <span class="comment">//End of Jacobian calculation</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  } <span class="comment">//End of loop over pressure nodes</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;       </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;} <span class="comment">// end of loop over integration points</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;}</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassoomph_1_1FiniteElement_html_ace0e7fb72a805b5c2c600347bfae7a9b"><div class="ttname"><a href="classoomph_1_1FiniteElement.html#ace0e7fb72a805b5c2c600347bfae7a9b">oomph::FiniteElement::node_pt</a></div><div class="ttdeci">Node *&amp; node_pt(const unsigned &amp;n)</div><div class="ttdoc">Return a pointer to the local node n.</div><div class="ttdef"><b>Definition:</b> <a href="elements_8h_source.html#l02122">elements.h:2122</a></div></div>
<div class="ttc" id="athe__data__structure_8txt_html_a5448c72da3359c7796cf0c5f800732a1"><div class="ttname"><a href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a></div><div class="ttdeci">and code FiniteElement::J_eulerian(...) \endcode returns the Jacobian of the mapping from Eulerian coordinates to local coordinates. - The function \c GeneralisedElement c QElement&lt; 3, 2 &gt; is an node brick element with a trilinear mapping between and global coordinates The dimension and the number of c Nodes must be set by calling the appropriate c set_ functions in the see ref set_commands above The most important member functions implemented at this level include Functions that evaluate the shape in terms of the c FiniteElement s coordinates functions that determine whether a c Node is located at a particular coordinate Output functions that allow the element shapes to be plotted we specify a pointer to a spatial integration the default assignment can be over written at a higher level This is discussed in more detail in a&lt; A HREF=&quot;../../optimisation/html/index.html&quot;&gt; separate document&lt;/A &gt; subsubsection Maths_Element we implement the equations that are represented by the specific element We implement the employing either the geometric shape functions that already exist on or employing additional shape functions defined at this level This allows us to write further member functions such as c interpolated_u(...)</div></div>
<div class="ttc" id="aclassoomph_1_1FiniteElement_html_adcd3fe593044db9afae4c15f85ebb175"><div class="ttname"><a href="classoomph_1_1FiniteElement.html#adcd3fe593044db9afae4c15f85ebb175">oomph::FiniteElement::dnodal_position_dt</a></div><div class="ttdeci">double dnodal_position_dt(const unsigned &amp;n, const unsigned &amp;i) const</div><div class="ttdoc">Return the i-th component of nodal velocity: dx/dt at local node n.</div><div class="ttdef"><b>Definition:</b> <a href="elements_8h_source.html#l02251">elements.h:2251</a></div></div>
<div class="ttc" id="athe__data__structure_8txt_html_a1400a973def57b85051cfe1070be1810"><div class="ttname"><a href="the__data__structure_8txt.html#a1400a973def57b85051cfe1070be1810">residuals</a></div><div class="ttdeci">endcode The default implementation of c the simplest possible implementation of a new element requires only the specification of c we need to know which c Data affects the residuals(and hence the Jacobian matrix). For a \c GeneralisedElement such \c Data exists in two forms</div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a10ed6f34245f5b31095ae636fc08749a"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a10ed6f34245f5b31095ae636fc08749a">oomph::SphericalNavierStokesEquations::dshape_and_dtest_eulerian_at_knot_spherical_nst</a></div><div class="ttdeci">virtual double dshape_and_dtest_eulerian_at_knot_spherical_nst(const unsigned &amp;ipt, Shape &amp;psi, DShape &amp;dpsidx, Shape &amp;test, DShape &amp;dtestdx) const =0</div><div class="ttdoc">Compute the shape functions and derivatives w.r.t. global coords at ipt-th integration point Return J...</div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_ae99a23d65958a96ae2d90151b86d30ab"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#ae99a23d65958a96ae2d90151b86d30ab">oomph::SphericalNavierStokesEquations::ALE_is_disabled</a></div><div class="ttdeci">bool ALE_is_disabled</div><div class="ttdoc">Boolean flag to indicate if ALE formulation is disabled when time-derivatives are computed....</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00127">spherical_navier_stokes_elements.h:127</a></div></div>
<div class="ttc" id="aclassoomph_1_1HangInfo_html_aa9c1130b58db2ff6d5eee4f923ba365c"><div class="ttname"><a href="classoomph_1_1HangInfo.html#aa9c1130b58db2ff6d5eee4f923ba365c">oomph::HangInfo::nmaster</a></div><div class="ttdeci">unsigned nmaster() const</div><div class="ttdoc">Return the number of master nodes.</div><div class="ttdef"><b>Definition:</b> <a href="nodes_8h_source.html#l00728">nodes.h:728</a></div></div>
<div class="ttc" id="aclassoomph_1_1RefineableSphericalNavierStokesEquations_html_a1daddea2d11bb46db3e6aef3843b288d"><div class="ttname"><a href="classoomph_1_1RefineableSphericalNavierStokesEquations.html#a1daddea2d11bb46db3e6aef3843b288d">oomph::RefineableSphericalNavierStokesEquations::pressure_node_pt</a></div><div class="ttdeci">virtual Node * pressure_node_pt(const unsigned &amp;n_p)</div><div class="ttdoc">Pointer to n_p-th pressure node (Default: NULL, indicating that pressure is not based on nodal interp...</div><div class="ttdef"><b>Definition:</b> <a href="refineable__spherical__navier__stokes__elements_8h_source.html#l00056">refineable_spherical_navier_stokes_elements.h:56</a></div></div>
<div class="ttc" id="aclassoomph_1_1OomphLibError_html"><div class="ttname"><a href="classoomph_1_1OomphLibError.html">oomph::OomphLibError</a></div><div class="ttdef"><b>Definition:</b> <a href="oomph__definitions_8h_source.html#l00225">oomph_definitions.h:225</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a7b0edc8eedacaef9e55f3551a7cb5400"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a7b0edc8eedacaef9e55f3551a7cb5400">oomph::SphericalNavierStokesEquations::p_nodal_index_spherical_nst</a></div><div class="ttdeci">virtual int p_nodal_index_spherical_nst() const</div><div class="ttdoc">Return the index at which the pressure is stored if it is stored at the nodes. If not stored at the n...</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00375">spherical_navier_stokes_elements.h:375</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_ae01203564bc66dacf84c1ed65e4b7930"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#ae01203564bc66dacf84c1ed65e4b7930">oomph::SphericalNavierStokesEquations::npres_spherical_nst</a></div><div class="ttdeci">virtual unsigned npres_spherical_nst() const =0</div><div class="ttdoc">Function to return number of pressure degrees of freedom.</div></div>
<div class="ttc" id="aclassoomph_1_1FiniteElement_html_a5a9c1ead9819cd17603096e63087020f"><div class="ttname"><a href="classoomph_1_1FiniteElement.html#a5a9c1ead9819cd17603096e63087020f">oomph::FiniteElement::interpolated_x</a></div><div class="ttdeci">virtual double interpolated_x(const Vector&lt; double &gt; &amp;s, const unsigned &amp;i) const</div><div class="ttdoc">Return FE interpolated coordinate x[i] at local coordinate s.</div><div class="ttdef"><b>Definition:</b> <a href="elements_8cc_source.html#l03877">elements.cc:3877</a></div></div>
<div class="ttc" id="aclassoomph_1_1Time_html_a6e28ea7a6664a2f5f5e1be871304a2c7"><div class="ttname"><a href="classoomph_1_1Time.html#a6e28ea7a6664a2f5f5e1be871304a2c7">oomph::Time::time</a></div><div class="ttdeci">double &amp; time()</div><div class="ttdoc">Return the current value of the continuous time.</div><div class="ttdef"><b>Definition:</b> <a href="timesteppers_8h_source.html#l00126">timesteppers.h:126</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a5b50d547e5a2ad5896dc9612e2bb4176"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a5b50d547e5a2ad5896dc9612e2bb4176">oomph::SphericalNavierStokesEquations::p_spherical_nst</a></div><div class="ttdeci">virtual double p_spherical_nst(const unsigned &amp;n_p) const =0</div><div class="ttdoc">Pressure at local pressure &quot;node&quot; n_p Uses suitably interpolated value for hanging nodes.</div></div>
<div class="ttc" id="aclassoomph_1_1HangInfo_html_a2c102c3048a87bbfdde753a094f641fe"><div class="ttname"><a href="classoomph_1_1HangInfo.html#a2c102c3048a87bbfdde753a094f641fe">oomph::HangInfo::master_node_pt</a></div><div class="ttdeci">Node *const &amp; master_node_pt(const unsigned &amp;i) const</div><div class="ttdoc">Return a pointer to the i-th master node.</div><div class="ttdef"><b>Definition:</b> <a href="nodes_8h_source.html#l00731">nodes.h:731</a></div></div>
<div class="ttc" id="aclassoomph_1_1Integral_html_a1a270de9d99a1fcf1d25a6c1017f65fa"><div class="ttname"><a href="classoomph_1_1Integral.html#a1a270de9d99a1fcf1d25a6c1017f65fa">oomph::Integral::nweight</a></div><div class="ttdeci">virtual unsigned nweight() const =0</div><div class="ttdoc">Return the number of integration points of the scheme.</div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_af3627c5846c81dacdfb150576a28db61"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#af3627c5846c81dacdfb150576a28db61">oomph::SphericalNavierStokesEquations::re_st</a></div><div class="ttdeci">const double &amp; re_st() const</div><div class="ttdoc">Product of Reynolds and Strouhal number (=Womersley number)</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00239">spherical_navier_stokes_elements.h:239</a></div></div>
<div class="ttc" id="aclassoomph_1_1RefineableSphericalNavierStokesEquations_html_aaadda4a5dbffc1e23db2ac8b3dd86d4a"><div class="ttname"><a href="classoomph_1_1RefineableSphericalNavierStokesEquations.html#aaadda4a5dbffc1e23db2ac8b3dd86d4a">oomph::RefineableSphericalNavierStokesEquations::fill_in_generic_residual_contribution_spherical_nst</a></div><div class="ttdeci">void fill_in_generic_residual_contribution_spherical_nst(Vector&lt; double &gt; &amp;residuals, DenseMatrix&lt; double &gt; &amp;jacobian, DenseMatrix&lt; double &gt; &amp;mass_matrix, unsigned flag)</div><div class="ttdoc">Add element's contribution to the elemental residual vector and/or Jacobian matrix flag=1: compute bo...</div><div class="ttdef"><b>Definition:</b> <a href="refineable__spherical__navier__stokes__elements_8cc_source.html#l00040">refineable_spherical_navier_stokes_elements.cc:40</a></div></div>
<div class="ttc" id="aclassoomph_1_1Node_html_ab7b94371e9a8b62fe9a5cc7a03113ad9"><div class="ttname"><a href="classoomph_1_1Node.html#ab7b94371e9a8b62fe9a5cc7a03113ad9">oomph::Node::hanging_pt</a></div><div class="ttdeci">HangInfo *const &amp; hanging_pt() const</div><div class="ttdoc">Return pointer to hanging node data (this refers to the geometric hanging node status) (const version...</div><div class="ttdef"><b>Definition:</b> <a href="nodes_8h_source.html#l01143">nodes.h:1143</a></div></div>
<div class="ttc" id="aclassoomph_1_1FiniteElement_html_a9152c16ae9899168bcdaac7c2f977444"><div class="ttname"><a href="classoomph_1_1FiniteElement.html#a9152c16ae9899168bcdaac7c2f977444">oomph::FiniteElement::nodal_position</a></div><div class="ttdeci">double nodal_position(const unsigned &amp;n, const unsigned &amp;i) const</div><div class="ttdoc">Return the i-th coordinate at local node n. If the node is hanging, the appropriate interpolation is ...</div><div class="ttdef"><b>Definition:</b> <a href="elements_8h_source.html#l02240">elements.h:2240</a></div></div>
<div class="ttc" id="aclassoomph_1_1TimeStepper_html_ad77678873af47aa208a9385b26ac1641"><div class="ttname"><a href="classoomph_1_1TimeStepper.html#ad77678873af47aa208a9385b26ac1641">oomph::TimeStepper::time_pt</a></div><div class="ttdeci">Time *const &amp; time_pt() const</div><div class="ttdoc">Access function for the pointer to time (const version)</div><div class="ttdef"><b>Definition:</b> <a href="timesteppers_8h_source.html#l00536">timesteppers.h:536</a></div></div>
<div class="ttc" id="aclassoomph_1_1DenseMatrix_html"><div class="ttname"><a href="classoomph_1_1DenseMatrix.html">oomph::DenseMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a339dc121adc8a2eb62805ac63171fd6c"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a339dc121adc8a2eb62805ac63171fd6c">oomph::SphericalNavierStokesEquations::re</a></div><div class="ttdeci">const double &amp; re() const</div><div class="ttdoc">Reynolds number.</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00236">spherical_navier_stokes_elements.h:236</a></div></div>
<div class="ttc" id="aclassoomph_1_1HangInfo_html"><div class="ttname"><a href="classoomph_1_1HangInfo.html">oomph::HangInfo</a></div><div class="ttdoc">Class that contains data for hanging nodes.</div><div class="ttdef"><b>Definition:</b> <a href="nodes_8h_source.html#l00679">nodes.h:679</a></div></div>
<div class="ttc" id="anamespaceoomph_1_1QuadTreeNames_html_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6"><div class="ttname"><a href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">oomph::QuadTreeNames::W</a></div><div class="ttdeci">@ W</div><div class="ttdef"><b>Definition:</b> <a href="quadtree_8h_source.html#l00056">quadtree.h:56</a></div></div>
<div class="ttc" id="aclassoomph_1_1Integral_html_a1a2122f99a87c18649bafdd9ed739758"><div class="ttname"><a href="classoomph_1_1Integral.html#a1a2122f99a87c18649bafdd9ed739758">oomph::Integral::knot</a></div><div class="ttdeci">virtual double knot(const unsigned &amp;i, const unsigned &amp;j) const =0</div><div class="ttdoc">Return local coordinate s[j] of i-th integration point.</div></div>
<div class="ttc" id="aclassoomph_1_1Node_html_af0e6237dfafad62cf427ff5013ddcfef"><div class="ttname"><a href="classoomph_1_1Node.html#af0e6237dfafad62cf427ff5013ddcfef">oomph::Node::is_hanging</a></div><div class="ttdeci">bool is_hanging() const</div><div class="ttdoc">Test whether the node is geometrically hanging.</div><div class="ttdef"><b>Definition:</b> <a href="nodes_8h_source.html#l01202">nodes.h:1202</a></div></div>
<div class="ttc" id="aclassoomph_1_1FiniteElement_html_a79f1710873332823c47023d370f0596b"><div class="ttname"><a href="classoomph_1_1FiniteElement.html#a79f1710873332823c47023d370f0596b">oomph::FiniteElement::integral_pt</a></div><div class="ttdeci">Integral *const &amp; integral_pt() const</div><div class="ttdoc">Return the pointer to the integration scheme (const version)</div><div class="ttdef"><b>Definition:</b> <a href="elements_8h_source.html#l01921">elements.h:1921</a></div></div>
<div class="ttc" id="anamespaceoomph_html"><div class="ttname"><a href="namespaceoomph.html">oomph</a></div><div class="ttdoc">DRAIG: Change all instances of (SPATIAL_DIM) to (DIM-1).</div><div class="ttdef"><b>Definition:</b> <a href="advection__diffusion__elements_8cc_source.html#l00029">advection_diffusion_elements.cc:29</a></div></div>
<div class="ttc" id="aclassoomph_1_1FiniteElement_html_a6219ed269a6d89b5aa14659cce48905a"><div class="ttname"><a href="classoomph_1_1FiniteElement.html#a6219ed269a6d89b5aa14659cce48905a">oomph::FiniteElement::nnode</a></div><div class="ttdeci">unsigned nnode() const</div><div class="ttdoc">Return the number of nodes.</div><div class="ttdef"><b>Definition:</b> <a href="elements_8h_source.html#l02159">elements.h:2159</a></div></div>
<div class="ttc" id="aclassoomph_1_1Vector_html"><div class="ttname"><a href="classoomph_1_1Vector.html">oomph::Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a4a9bb055e3ea5f00d1edee5efcad4937"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a4a9bb055e3ea5f00d1edee5efcad4937">oomph::SphericalNavierStokesEquations::re_invro</a></div><div class="ttdeci">const double &amp; re_invro() const</div><div class="ttdoc">Global Reynolds number multiplied by inverse Rossby number.</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00268">spherical_navier_stokes_elements.h:268</a></div></div>
<div class="ttc" id="acfortran_8h_html_adb50e893b86b3e55e751a42eab3cba82"><div class="ttname"><a href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a></div><div class="ttdeci">cstr elem_len * i</div><div class="ttdef"><b>Definition:</b> <a href="cfortran_8h_source.html#l00603">cfortran.h:603</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a6f9ce7398b2f2a767fddc7473046c674"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a6f9ce7398b2f2a767fddc7473046c674">oomph::SphericalNavierStokesEquations::du_dt_spherical_nst</a></div><div class="ttdeci">double du_dt_spherical_nst(const unsigned &amp;n, const unsigned &amp;i) const</div><div class="ttdoc">i-th component of du/dt at local node n. Uses suitably interpolated value for hanging nodes.</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00323">spherical_navier_stokes_elements.h:323</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a2f269e20874a87df919cc4ece4b05fe5"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a2f269e20874a87df919cc4ece4b05fe5">oomph::SphericalNavierStokesEquations::u_index_spherical_nst</a></div><div class="ttdeci">virtual unsigned u_index_spherical_nst(const unsigned &amp;i) const</div><div class="ttdoc">Return the index at which the i-th unknown velocity component.</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00317">spherical_navier_stokes_elements.h:317</a></div></div>
<div class="ttc" id="aclassoomph_1_1HangInfo_html_a923bb47b87b6d4dd535e6ae41a4ff88c"><div class="ttname"><a href="classoomph_1_1HangInfo.html#a923bb47b87b6d4dd535e6ae41a4ff88c">oomph::HangInfo::master_weight</a></div><div class="ttdeci">const double &amp; master_weight(const unsigned &amp;i) const</div><div class="ttdoc">Return weight for dofs on i-th master node.</div><div class="ttdef"><b>Definition:</b> <a href="nodes_8h_source.html#l00748">nodes.h:748</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a17799ec1f3a1d8bbeee1d357bba0a249"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a17799ec1f3a1d8bbeee1d357bba0a249">oomph::SphericalNavierStokesEquations::pshape_spherical_nst</a></div><div class="ttdeci">virtual void pshape_spherical_nst(const Vector&lt; double &gt; &amp;s, Shape &amp;psi) const =0</div><div class="ttdoc">Compute the pressure shape functions at local coordinate s.</div></div>
<div class="ttc" id="aclassoomph_1_1DShape_html"><div class="ttname"><a href="classoomph_1_1DShape.html">oomph::DShape</a></div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00271">shape.h:271</a></div></div>
<div class="ttc" id="aclassoomph_1_1FiniteElement_html_a5da80bbed97543e586f698251d67941d"><div class="ttname"><a href="classoomph_1_1FiniteElement.html#a5da80bbed97543e586f698251d67941d">oomph::FiniteElement::nodal_local_eqn</a></div><div class="ttdeci">int nodal_local_eqn(const unsigned &amp;n, const unsigned &amp;i) const</div><div class="ttdoc">Return the local equation number corresponding to the i-th value at the n-th local node.</div><div class="ttdef"><b>Definition:</b> <a href="elements_8h_source.html#l01399">elements.h:1399</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a64fc30a2f613c7d0bbd5db7ad8bd27c8"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a64fc30a2f613c7d0bbd5db7ad8bd27c8">oomph::SphericalNavierStokesEquations::density_ratio</a></div><div class="ttdeci">const double &amp; density_ratio() const</div><div class="ttdoc">Density ratio for element: Element's density relative to the viscosity used in the definition of the ...</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00256">spherical_navier_stokes_elements.h:256</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_a6dbdc5a0b33a0f36494ffefed1a938ac"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#a6dbdc5a0b33a0f36494ffefed1a938ac">oomph::SphericalNavierStokesEquations::get_body_force_spherical_nst</a></div><div class="ttdeci">virtual void get_body_force_spherical_nst(const double &amp;time, const unsigned &amp;ipt, const Vector&lt; double &gt; &amp;s, const Vector&lt; double &gt; &amp;x, Vector&lt; double &gt; &amp;result)</div><div class="ttdoc">Calculate the body force at a given time and local and/or Eulerian position. This function is virtual...</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00167">spherical_navier_stokes_elements.h:167</a></div></div>
<div class="ttc" id="aclassoomph_1_1Data_html_a5b34970d16205921dca3ada720da8445"><div class="ttname"><a href="classoomph_1_1Data.html#a5b34970d16205921dca3ada720da8445">oomph::Data::time_stepper_pt</a></div><div class="ttdeci">TimeStepper *&amp; time_stepper_pt()</div><div class="ttdoc">Return the pointer to the timestepper.</div><div class="ttdef"><b>Definition:</b> <a href="nodes_8h_source.html#l00242">nodes.h:242</a></div></div>
<div class="ttc" id="arefineable__spherical__navier__stokes__elements_8h_html"><div class="ttname"><a href="refineable__spherical__navier__stokes__elements_8h.html">refineable_spherical_navier_stokes_elements.h</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_ad8d9a0edbe3793a008a6bff670c26643"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#ad8d9a0edbe3793a008a6bff670c26643">oomph::SphericalNavierStokesEquations::p_local_eqn</a></div><div class="ttdeci">virtual int p_local_eqn(const unsigned &amp;n) const =0</div><div class="ttdoc">Access function for the local equation number information for the pressure. p_local_eqn[n] = local eq...</div></div>
<div class="ttc" id="aclassoomph_1_1TimeStepper_html_a4cb0aecb044b77ba0553cdd54b586d8a"><div class="ttname"><a href="classoomph_1_1TimeStepper.html#a4cb0aecb044b77ba0553cdd54b586d8a">oomph::TimeStepper::weight</a></div><div class="ttdeci">virtual double weight(const unsigned &amp;i, const unsigned &amp;j) const</div><div class="ttdoc">Access function for j-th weight for the i-th derivative.</div><div class="ttdef"><b>Definition:</b> <a href="timesteppers_8h_source.html#l00553">timesteppers.h:553</a></div></div>
<div class="ttc" id="aclassoomph_1_1FiniteElement_html_a28fd5c2d4aeba5ef65bee0e0d72569f5"><div class="ttname"><a href="classoomph_1_1FiniteElement.html#a28fd5c2d4aeba5ef65bee0e0d72569f5">oomph::FiniteElement::nodal_value</a></div><div class="ttdeci">double nodal_value(const unsigned &amp;n, const unsigned &amp;i) const</div><div class="ttdoc">Return the i-th value stored at local node n. Produces suitably interpolated values for hanging nodes...</div><div class="ttdef"><b>Definition:</b> <a href="elements_8h_source.html#l02483">elements.h:2483</a></div></div>
<div class="ttc" id="aclassoomph_1_1Integral_html_ac65335e2aab120b285b3d6c294507b06"><div class="ttname"><a href="classoomph_1_1Integral.html#ac65335e2aab120b285b3d6c294507b06">oomph::Integral::weight</a></div><div class="ttdeci">virtual double weight(const unsigned &amp;i) const =0</div><div class="ttdoc">Return weight of i-th integration point.</div></div>
<div class="ttc" id="aclassoomph_1_1RefineableElement_html_abc3d0cb0131ebf717ff0620242c9ca2b"><div class="ttname"><a href="classoomph_1_1RefineableElement.html#abc3d0cb0131ebf717ff0620242c9ca2b">oomph::RefineableElement::local_hang_eqn</a></div><div class="ttdeci">int local_hang_eqn(Node *const &amp;node_pt, const unsigned &amp;i)</div><div class="ttdoc">Access function that returns the local equation number for the hanging node variables (values stored ...</div><div class="ttdef"><b>Definition:</b> <a href="refineable__elements_8h_source.html#l00264">refineable_elements.h:264</a></div></div>
<div class="ttc" id="aclassoomph_1_1Shape_html"><div class="ttname"><a href="classoomph_1_1Shape.html">oomph::Shape</a></div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00077">shape.h:77</a></div></div>
<div class="ttc" id="aclassoomph_1_1SphericalNavierStokesEquations_html_ac580f29734c9595980428b8324099d7d"><div class="ttname"><a href="classoomph_1_1SphericalNavierStokesEquations.html#ac580f29734c9595980428b8324099d7d">oomph::SphericalNavierStokesEquations::g</a></div><div class="ttdeci">const Vector&lt; double &gt; &amp; g() const</div><div class="ttdoc">Vector of gravitational components.</div><div class="ttdef"><b>Definition:</b> <a href="spherical__navier__stokes__elements_8h_source.html#l00274">spherical_navier_stokes_elements.h:274</a></div></div>
<div class="ttc" id="acfortran_8h_html_ab7123126e4885ef647dd9c6e3807a21c"><div class="ttname"><a href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a></div><div class="ttdeci">static char t char * s</div><div class="ttdef"><b>Definition:</b> <a href="cfortran_8h_source.html#l00568">cfortran.h:568</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Wed Jul 21 2021 17:50:36
        </div>
      </div>
    </footer>
</body>
</html>
