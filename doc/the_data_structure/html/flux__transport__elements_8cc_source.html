<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: flux_transport_elements.cc Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../figures/manifest.json">
<link rel="mask-icon" href="../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../html/index.html"><img alt="oomph-lib" src="../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get it <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../doc/subversion/html/index.html">Get code from subversion repository</a></li>
            <li><a href="../../../doc/download/html/index.html">Get code as tar file</a></li>
            <li><a href="../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_9c050f721f257cb07e8a9dc5eeafbae9.html">flux_transport</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">flux_transport_elements.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="flux__transport__elements_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//LIC// ====================================================================</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//LIC// This file forms part of oomph-lib, the object-oriented, </span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//LIC// multi-physics finite-element library, available </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//LIC// at http://www.oomph-lib.org.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//LIC// Copyright (C) 2006-2021 Matthias Heil and Andrew Hazel</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//LIC// This library is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//LIC// modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//LIC// License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//LIC// version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//LIC// This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//LIC// Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//LIC// You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//LIC// License along with this library; if not, write to the Free Software</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//LIC// 02110-1301  USA.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//LIC// The authors may be contacted at oomph-lib@maths.man.ac.uk.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//LIC//====================================================================</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//Non-inline member function of the flux transport elements class</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="flux__transport__elements_8h.html">flux_transport_elements.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;../generic/shape.h&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;../generic/timesteppers.h&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceoomph.html">oomph</a></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; <span class="comment">//======================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> ///Return the derivatives of the flux components as functions of the </span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> ///unknowns. The default implementation is to use second-order </span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> ///finite-differences, but these can be overloaded in specific equations</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"></span> <span class="comment">//========================================================================</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keywordtype">void</span>  <a class="code" href="classoomph_1_1FluxTransportEquations.html#a85c3239c26cb1fb4ddd102759eb0fc0d">FluxTransportEquations&lt;DIM&gt;::</a></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="classoomph_1_1FluxTransportEquations.html#a85c3239c26cb1fb4ddd102759eb0fc0d">   41</a></span>&#160;<a class="code" href="classoomph_1_1FluxTransportEquations.html#a85c3239c26cb1fb4ddd102759eb0fc0d">dflux_du</a>(<span class="keyword">const</span> <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="the__data__structure_8txt.html#aaa5287b1cf3ca06b3f413cb95bd1ec60">u</a>, <a class="code" href="classoomph_1_1RankThreeTensor.html">RankThreeTensor&lt;double&gt;</a> &amp;df_du)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;{</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; <span class="comment">//Find the number of fluxes</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_flux = nflux();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; <span class="comment">//Local copy of the unknowns</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> u_local = <a class="code" href="the__data__structure_8txt.html#aaa5287b1cf3ca06b3f413cb95bd1ec60">u</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; <span class="comment">//Finite differences</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; <a class="code" href="classoomph_1_1DenseMatrix.html">DenseMatrix&lt;double&gt;</a> <a class="code" href="namespaceoomph_1_1OcTreeNames.html#ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927">F</a>(n_flux,DIM), F_plus(n_flux,DIM), F_minus(n_flux,DIM);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; <span class="keyword">const</span> <span class="keywordtype">double</span> fd_step = <a class="code" href="classoomph_1_1GeneralisedElement.html#a156163c9f6fbd17548a9fa836616d19b">GeneralisedElement::Default_fd_jacobian_step</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   <span class="comment">//Now loop over all the fluxes</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> p=0;p&lt;n_flux;p++)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   <span class="comment">//Store the old value</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">double</span> old_var = u_local[p];</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <span class="comment">//Increment the value</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   u_local[p] += fd_step;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   <span class="comment">//Get the new values</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   flux(u_local,F_plus);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   <span class="comment">//Reset the value</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   u_local[p] = old_var;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;   <span class="comment">//Decrement the value</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   u_local[p] -= fd_step;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;   <span class="comment">//Get the new values</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   flux(u_local,F_minus);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   <span class="comment">//Assemble the entries of the jacobian</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> r=0;r&lt;n_flux;r++)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j=0;j&lt;DIM;j++)</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;       df_du(r,j,p) = (F_plus(r,j) - F_minus(r,j))/(2.0*fd_step);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   <span class="comment">//Reset the value</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   u_local[p] = old_var;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;}</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; <span class="comment">//===================================================================== </span><span class="comment"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> ///\short Compute the residuals for the flux transport equations; </span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> /// flag=1 compute jacobian as well</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> /// flag=2 compute mass matrix and jacobian as well</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> /// flag=3 compute mass matrix as well</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span> <span class="comment">//=======================================================================</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">void</span> <a class="code" href="classoomph_1_1FluxTransportEquations.html#a6994eab818eb7236e24e45b6fedec1f7">FluxTransportEquations&lt;DIM&gt;::</a></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="classoomph_1_1FluxTransportEquations.html#a6994eab818eb7236e24e45b6fedec1f7">   89</a></span>&#160;<a class="code" href="classoomph_1_1FluxTransportEquations.html#a6994eab818eb7236e24e45b6fedec1f7"> fill_in_generic_residual_contribution_flux_transport</a>(</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="the__data__structure_8txt.html#a1400a973def57b85051cfe1070be1810">residuals</a>, <a class="code" href="classoomph_1_1DenseMatrix.html">DenseMatrix&lt;double&gt;</a> &amp;jacobian, </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="classoomph_1_1DenseMatrix.html">DenseMatrix&lt;double&gt;</a> &amp;mass_matrix, <span class="keywordtype">unsigned</span> flag)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   <span class="comment">//Find the number of fluxes</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_flux = this-&gt;nflux();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">//Find the number of nodes</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_node = this-&gt;nnode();</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="comment">//Storage for the shape function and derivatives of shape function</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   <a class="code" href="classoomph_1_1Shape.html">Shape</a> psi(n_node), test(n_node);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   <a class="code" href="classoomph_1_1DShape.html">DShape</a> dpsidx(n_node,DIM), dtestdx(n_node,DIM);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   <span class="comment">//Cache the nodal indices at which the unknowns are stored</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   <span class="keywordtype">unsigned</span> u_nodal_index[n_flux];</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++) </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    {u_nodal_index[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] = this-&gt;u_index_flux_transport(<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>);}</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   <span class="comment">//Find the number of integration points</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   <span class="keywordtype">unsigned</span> n_intpt = this-&gt;integral_pt()-&gt;nweight();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;     </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   <span class="comment">//Integers to store the local equations and unknowns</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   <span class="keywordtype">int</span> local_eqn=0, local_unknown = 0;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   <span class="comment">//Loop over the integration points</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ipt=0;ipt&lt;n_intpt;ipt++)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;     <span class="comment">//Get the shape functions at the knot</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;     <span class="keywordtype">double</span> J = </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      this-&gt;dshape_and_dtest_eulerian_at_knot_flux_transport(ipt,psi,dpsidx,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                                             test,dtestdx);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;     <span class="comment">//Get the integral weight</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;     <span class="keywordtype">double</span> <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a> = this-&gt;integral_pt()-&gt;weight(ipt)*J;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;     <span class="comment">//Storage for the local unknowns</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;     <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>(n_flux,0.0);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;     <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> interpolated_dudt(n_flux,0.0);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;     <span class="comment">//Loop over the shape functions</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;       <span class="comment">//Locally cache the shape function</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">double</span> psi_ = psi(l);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;         <span class="comment">//Calculate the velocity and tangent vector</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] += this-&gt;nodal_value(l,u_nodal_index[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>])*psi_;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;         interpolated_dudt[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] += this-&gt;du_dt_flux_transport(l,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)*psi_;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;     <span class="comment">//Calculate the flux at the integration point</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;     <a class="code" href="classoomph_1_1DenseMatrix.html">DenseMatrix&lt;double&gt;</a> <a class="code" href="namespaceoomph_1_1OcTreeNames.html#ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927">F</a>(n_flux,DIM);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;     this-&gt;flux(<a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>,<a class="code" href="namespaceoomph_1_1OcTreeNames.html#ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927">F</a>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;     <a class="code" href="classoomph_1_1RankThreeTensor.html">RankThreeTensor&lt;double&gt;</a> dF_du(n_flux,DIM,n_flux);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;     <span class="keywordflow">if</span>((flag) &amp;&amp; (flag!=3))</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      {this-&gt;dflux_du(<a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>,dF_du);}</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;     <span class="comment">//We need to assemble the contributions to the volume integral</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;       <span class="comment">//Loop over the unknowns</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;         <span class="comment">//Get the local equation number</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;         local_eqn = this-&gt;nodal_local_eqn(l,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;       </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;         <span class="comment">//if it&#39;s not a boundary condition</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;         <span class="keywordflow">if</span>(local_eqn &gt;= 0)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;           <span class="comment">//Add the time derivatives</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;           <a class="code" href="the__data__structure_8txt.html#a1400a973def57b85051cfe1070be1810">residuals</a>[local_eqn] -= interpolated_dudt[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>]*test(l)*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;           </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;           <span class="comment">//Calculate the flux dot product</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;           <span class="keywordtype">double</span> flux_dot = 0.0;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;           <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> k=0;k&lt;DIM;k++)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            {flux_dot += <a class="code" href="namespaceoomph_1_1OcTreeNames.html#ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927">F</a>(<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>,k)*dtestdx(l,k);}</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;           <span class="comment">//Add the contribution to the residuals</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;           <a class="code" href="the__data__structure_8txt.html#a1400a973def57b85051cfe1070be1810">residuals</a>[local_eqn] += flux_dot*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;           <span class="comment">//Now worry about the jacobian and mass matrix terms</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;           <span class="keywordflow">if</span>(flag) </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;             <span class="comment">//If we are assembling the jacobian</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;             <span class="keywordflow">if</span>(flag &lt; 3)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;              {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;               <span class="comment">//Loop over the shape functions again</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;               <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l2=0;l2&lt;n_node;l2++)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                 <span class="comment">//Loop over the unknowns again</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                 <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i2=0;i2&lt;n_flux;i2++)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                  {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                   <span class="comment">//Get the local unknowns</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                   local_unknown = this-&gt;nodal_local_eqn(l2,i2);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                   <span class="comment">//If not pinned</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                   <span class="keywordflow">if</span>(local_unknown &gt;= 0)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                    {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                     <span class="comment">//Add the time derivative terms</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                     <span class="keywordflow">if</span>(i2==<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                      {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                       jacobian(local_eqn,local_unknown) -=</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                        node_pt(l2)-&gt;time_stepper_pt()-&gt;weight(1,0)*</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        psi(l2)*test(l)*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                       <span class="comment">//Add the mass matrix if we are computing</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                       <span class="comment">//it and the jacobian</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                       <span class="keywordflow">if</span>(flag==2)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                        {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                         mass_matrix(local_eqn,local_unknown) +=</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                          psi(l2)*test(l)*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                        }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                      }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                     </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                     <span class="comment">//Add the flux derivative terms</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                     <span class="keywordtype">double</span> dflux_dot = 0.0;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> k=0;k&lt;DIM;k++)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                      {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                       dflux_dot += dF_du(<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>,k,i2)*dtestdx(l,k);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                      }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                     jacobian(local_eqn,local_unknown) += </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                      dflux_dot*psi(l2)*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                  }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;              }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;             <span class="comment">//End of jacobian assembly, here we are just assembling the</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;             <span class="comment">//mass matrix</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;              {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;               <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l2=0;l2&lt;n_node;l2++)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                 local_unknown = this-&gt;nodal_local_eqn(l2,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                 <span class="keywordflow">if</span>(local_unknown &gt;= 0)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                  {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                   mass_matrix(local_eqn,local_unknown) += psi(l2)*test(l)*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                  }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;              }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;          }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; <span class="comment">//==================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment"> ///Return the i-th unknown at the local coordinate s</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"></span> <span class="comment">//==================================================================</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;</div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="classoomph_1_1FluxTransportEquations.html#a919f56a48a7ab618c90ceb41da5afaeb">  241</a></span>&#160; <span class="keywordtype">double</span> <a class="code" href="classoomph_1_1FluxTransportEquations.html#a919f56a48a7ab618c90ceb41da5afaeb">FluxTransportEquations&lt;DIM&gt;::interpolated_u_flux_transport</a>(</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keyword">const</span> <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> &amp;<a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">//Find the number of nodes</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_node = this-&gt;nnode();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="comment">//Get the shape functions at the local coordinate</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <a class="code" href="classoomph_1_1Shape.html">Shape</a> psi(n_node);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  this-&gt;<a class="code" href="namespaceoomph_1_1OneDimLagrange.html#a117f8b892dc89989ecdad99ff261e120">shape</a>(s,psi);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="comment">//Now interpolate each unknown</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="the__data__structure_8txt.html#aaa5287b1cf3ca06b3f413cb95bd1ec60">u</a> = 0.0;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">//Loop over the nodes</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a>=0;<a class="code" href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a>&lt;n_node;<a class="code" href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a>++)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">double</span> psi_ = psi[<a class="code" href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a>];</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;     <a class="code" href="the__data__structure_8txt.html#aaa5287b1cf3ca06b3f413cb95bd1ec60">u</a> += this-&gt;nodal_value(<a class="code" href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a>,u_index_flux_transport(<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>))*psi_;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="the__data__structure_8txt.html#aaa5287b1cf3ca06b3f413cb95bd1ec60">u</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; <span class="comment">//======================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"> /// \short i-th component of du/dt at local node n. </span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"> /// Uses suitably interpolated value for hanging nodes.</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"></span> <span class="comment">//======================================================================</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; <span class="keywordtype">double</span> <a class="code" href="classoomph_1_1FluxTransportEquations.html#ab637781b0f2fe83c5bc8f8127af4e1d4">FluxTransportEquations&lt;DIM&gt;::</a></div>
<div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="classoomph_1_1FluxTransportEquations.html#ab637781b0f2fe83c5bc8f8127af4e1d4">  268</a></span>&#160;<a class="code" href="classoomph_1_1FluxTransportEquations.html#ab637781b0f2fe83c5bc8f8127af4e1d4"> du_dt_flux_transport</a>( <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;<a class="code" href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a>, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>)<span class="keyword"> const</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keyword">  </span>{</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   <span class="comment">// Get the data&#39;s timestepper</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   <a class="code" href="classoomph_1_1TimeStepper.html">TimeStepper</a>* time_stepper_pt = this-&gt;node_pt(<a class="code" href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a>)-&gt;time_stepper_pt();</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   <span class="comment">//Initialise dudt</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordtype">double</span> dudt=0.0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   <span class="comment">//Loop over the timesteps, if there is a non Steady timestepper</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   <span class="keywordflow">if</span> (!time_stepper_pt-&gt;<a class="code" href="classoomph_1_1TimeStepper.html#ad341ba9e80265e1c26c1cda0f40c8292">is_steady</a>())</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;     <span class="comment">//Find the index at which the dof is stored</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> u_nodal_index = this-&gt;u_index_flux_transport(<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;     </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;     <span class="comment">// Number of timsteps (past &amp; present)</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_time = time_stepper_pt-&gt;<a class="code" href="classoomph_1_1TimeStepper.html#a3939b77ec3578e4bd5b453c85649d631">ntstorage</a>();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;     <span class="comment">// Loop over the timesteps</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#af6f0bd3dc13317f895c91323c25c2b8f">t</a>=0;<a class="code" href="cfortran_8h.html#af6f0bd3dc13317f895c91323c25c2b8f">t</a>&lt;n_time;<a class="code" href="cfortran_8h.html#af6f0bd3dc13317f895c91323c25c2b8f">t</a>++)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;       dudt+=time_stepper_pt-&gt;<a class="code" href="classoomph_1_1TimeStepper.html#a4cb0aecb044b77ba0553cdd54b586d8a">weight</a>(1,<a class="code" href="cfortran_8h.html#af6f0bd3dc13317f895c91323c25c2b8f">t</a>)*nodal_value(<a class="code" href="cfortran_8h.html#af6f0bd3dc13317f895c91323c25c2b8f">t</a>,<a class="code" href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a>,u_nodal_index);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">return</span> dudt;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; <span class="comment">//==================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment"> ///Calculate the averages of the flux variables </span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment"></span> <span class="comment">//=================================================================</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;</div>
<div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="classoomph_1_1FluxTransportEquations.html#a76f71716bef2734cadcd5f79a9d8e469">  299</a></span>&#160; <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1FluxTransportEquations.html#a76f71716bef2734cadcd5f79a9d8e469">FluxTransportEquations&lt;DIM&gt;::calculate_element_averages</a>(</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">double</span>* &amp;average_value)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">//Find the number of fluxes</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_flux = this-&gt;nflux();</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">//Resize the memory if necessary</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span>(average_value==0) {average_value = <span class="keyword">new</span> <span class="keywordtype">double</span>[n_flux+1];}</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">//Initialise the averages to zero</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux+1;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++) {average_value[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] = 0.0;}</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">//Find the number of nodes</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_node = this-&gt;nnode();</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">//Storage for the shape functions</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <a class="code" href="classoomph_1_1Shape.html">Shape</a> psi(n_node);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <a class="code" href="classoomph_1_1DShape.html">DShape</a> dpsidx(n_node,DIM);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">//Cache the nodal indices at which the unknowns are stored</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;   <span class="keywordtype">unsigned</span> u_nodal_index[n_flux];</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++) </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    {u_nodal_index[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] = this-&gt;u_index_flux_transport(<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>);}</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;   <span class="comment">//Find the number of integration points</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   <span class="keywordtype">unsigned</span> n_intpt = this-&gt;integral_pt()-&gt;nweight();</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   <span class="comment">//Loop over the integration points</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ipt=0;ipt&lt;n_intpt;ipt++)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;     <span class="comment">//Get the shape functions and derivatives at the knot</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;     <span class="keywordtype">double</span> J = this-&gt;dshape_eulerian_at_knot(ipt,psi,dpsidx);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;     <span class="comment">//Get the integral weight</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;     <span class="keywordtype">double</span> <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a> = this-&gt;integral_pt()-&gt;weight(ipt)*J;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;     <span class="comment">//Storage for the local unknowns</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;     <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>(n_flux,0.0);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;     <span class="comment">//Loop over the shape functions</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;       <span class="comment">//Locally cache the shape function</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;       <span class="keyword">const</span> <span class="keywordtype">double</span> psi_ = psi(l);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;         <span class="comment">//Calculate the velocity and tangent vector</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;         <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] += this-&gt;nodal_value(l,u_nodal_index[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>])*psi_;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;     </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;     average_value[n_flux] += <a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;     <span class="comment">//Loop over the values</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;       average_value[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] += <a class="code" href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a>[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>]*<a class="code" href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">W</a>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="comment">//Divide the results by the size of the element</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;     average_value[<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>] /= average_value[n_flux];</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; <span class="comment">//====================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"> ///Output function, print the values of all unknowns</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"></span> <span class="comment">//==================================================================</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> DIM&gt;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1FluxTransportEquations.html#afd690f82a24bc20b686fc7d25a59f775">FluxTransportEquations&lt;DIM&gt;::</a></div>
<div class="line"><a name="l00371"></a><span class="lineno"><a class="line" href="classoomph_1_1FluxTransportEquations.html#a6b9ea1eb9feb8c71c1d935c52e7d896f">  371</a></span>&#160;<a class="code" href="classoomph_1_1FluxTransportEquations.html#afd690f82a24bc20b686fc7d25a59f775"> output</a>(std::ostream &amp;outfile, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;nplot)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   <span class="comment">//Find the number of fluxes</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_flux = this-&gt;nflux();</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="comment">//Vector of local coordinates</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <a class="code" href="classoomph_1_1Vector.html">Vector&lt;double&gt;</a> <a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>(DIM);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">// Tecplot header info</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   outfile &lt;&lt; tecplot_zone_string(nplot);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   <span class="comment">// Loop over plot points</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   <span class="keywordtype">unsigned</span> num_plot_points=nplot_points(nplot);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iplot=0;iplot&lt;num_plot_points;iplot++)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;     </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;     <span class="comment">// Get local coordinates of plot point</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;     get_s_plot(iplot,nplot,<a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;     </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;     <span class="comment">// Coordinates</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;DIM;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++) </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;       outfile &lt;&lt; interpolated_x(<a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;     </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;     <span class="comment">// Values</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>=0;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>&lt;n_flux;<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>++) </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;       outfile &lt;&lt; interpolated_u_flux_transport(<a class="code" href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a>,<a class="code" href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a>) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   outfile &lt;&lt; std::endl;   </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; outfile &lt;&lt; std::endl;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; <span class="comment">// Write tecplot footer (e.g. FE connectivity lists)</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; write_tecplot_zone_footer(outfile,nplot);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;}</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; <span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classoomph_1_1FluxTransportEquations.html">FluxTransportEquations&lt;1&gt;</a>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; <span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classoomph_1_1FluxTransportEquations.html">FluxTransportEquations&lt;2&gt;</a>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; <span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classoomph_1_1FluxTransportEquations.html">FluxTransportEquations&lt;3&gt;</a>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="athe__data__structure_8txt_html_a5448c72da3359c7796cf0c5f800732a1"><div class="ttname"><a href="the__data__structure_8txt.html#a5448c72da3359c7796cf0c5f800732a1">interpolated_u</a></div><div class="ttdeci">and code FiniteElement::J_eulerian(...) \endcode returns the Jacobian of the mapping from Eulerian coordinates to local coordinates. - The function \c GeneralisedElement c QElement&lt; 3, 2 &gt; is an node brick element with a trilinear mapping between and global coordinates The dimension and the number of c Nodes must be set by calling the appropriate c set_ functions in the see ref set_commands above The most important member functions implemented at this level include Functions that evaluate the shape in terms of the c FiniteElement s coordinates functions that determine whether a c Node is located at a particular coordinate Output functions that allow the element shapes to be plotted we specify a pointer to a spatial integration the default assignment can be over written at a higher level This is discussed in more detail in a&lt; A HREF=&quot;../../optimisation/html/index.html&quot;&gt; separate document&lt;/A &gt; subsubsection Maths_Element we implement the equations that are represented by the specific element We implement the employing either the geometric shape functions that already exist on or employing additional shape functions defined at this level This allows us to write further member functions such as c interpolated_u(...)</div></div>
<div class="ttc" id="aclassoomph_1_1FluxTransportEquations_html_a85c3239c26cb1fb4ddd102759eb0fc0d"><div class="ttname"><a href="classoomph_1_1FluxTransportEquations.html#a85c3239c26cb1fb4ddd102759eb0fc0d">oomph::FluxTransportEquations::dflux_du</a></div><div class="ttdeci">virtual void dflux_du(const Vector&lt; double &gt; &amp;u, RankThreeTensor&lt; double &gt; &amp;df_du)</div><div class="ttdoc">Return the flux derivatives as a funciton of the unknowns Default finite-different implementation.</div><div class="ttdef"><b>Definition:</b> <a href="flux__transport__elements_8cc_source.html#l00041">flux_transport_elements.cc:41</a></div></div>
<div class="ttc" id="anamespaceoomph_1_1OcTreeNames_html_ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927"><div class="ttname"><a href="namespaceoomph_1_1OcTreeNames.html#ae7e7e58298b85825061eeff362656c40a755807a4724a0f4d96f0817559c0a927">oomph::OcTreeNames::F</a></div><div class="ttdeci">@ F</div><div class="ttdef"><b>Definition:</b> <a href="octree_8h_source.html#l00055">octree.h:55</a></div></div>
<div class="ttc" id="athe__data__structure_8txt_html_a1400a973def57b85051cfe1070be1810"><div class="ttname"><a href="the__data__structure_8txt.html#a1400a973def57b85051cfe1070be1810">residuals</a></div><div class="ttdeci">endcode The default implementation of c the simplest possible implementation of a new element requires only the specification of c we need to know which c Data affects the residuals(and hence the Jacobian matrix). For a \c GeneralisedElement such \c Data exists in two forms</div></div>
<div class="ttc" id="aclassoomph_1_1FluxTransportEquations_html_a6994eab818eb7236e24e45b6fedec1f7"><div class="ttname"><a href="classoomph_1_1FluxTransportEquations.html#a6994eab818eb7236e24e45b6fedec1f7">oomph::FluxTransportEquations::fill_in_generic_residual_contribution_flux_transport</a></div><div class="ttdeci">virtual void fill_in_generic_residual_contribution_flux_transport(Vector&lt; double &gt; &amp;residuals, DenseMatrix&lt; double &gt; &amp;jacobian, DenseMatrix&lt; double &gt; &amp;mass_matrix, unsigned flag)</div><div class="ttdoc">Compute the residuals for the NavierStokes equations; flag=1(or 0): do (or don't) compute the Jacobi...</div><div class="ttdef"><b>Definition:</b> <a href="flux__transport__elements_8cc_source.html#l00089">flux_transport_elements.cc:89</a></div></div>
<div class="ttc" id="aclassoomph_1_1TimeStepper_html_a3939b77ec3578e4bd5b453c85649d631"><div class="ttname"><a href="classoomph_1_1TimeStepper.html#a3939b77ec3578e4bd5b453c85649d631">oomph::TimeStepper::ntstorage</a></div><div class="ttdeci">unsigned ntstorage() const</div><div class="ttdoc">Return the number of doubles required to represent history (one for steady)</div><div class="ttdef"><b>Definition:</b> <a href="timesteppers_8h_source.html#l00558">timesteppers.h:558</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluxTransportEquations_html_afd690f82a24bc20b686fc7d25a59f775"><div class="ttname"><a href="classoomph_1_1FluxTransportEquations.html#afd690f82a24bc20b686fc7d25a59f775">oomph::FluxTransportEquations::output</a></div><div class="ttdeci">void output(std::ostream &amp;outfile)</div><div class="ttdoc">Output the element data  typically the values at the nodes in a format suitable for post-processing.</div><div class="ttdef"><b>Definition:</b> <a href="flux__transport__elements_8h_source.html#l00171">flux_transport_elements.h:171</a></div></div>
<div class="ttc" id="aclassoomph_1_1GeneralisedElement_html_a156163c9f6fbd17548a9fa836616d19b"><div class="ttname"><a href="classoomph_1_1GeneralisedElement.html#a156163c9f6fbd17548a9fa836616d19b">oomph::GeneralisedElement::Default_fd_jacobian_step</a></div><div class="ttdeci">static double Default_fd_jacobian_step</div><div class="ttdoc">Double used for the default finite difference step in elemental jacobian calculations.</div><div class="ttdef"><b>Definition:</b> <a href="elements_8h_source.html#l01177">elements.h:1177</a></div></div>
<div class="ttc" id="aclassoomph_1_1RankThreeTensor_html"><div class="ttname"><a href="classoomph_1_1RankThreeTensor.html">oomph::RankThreeTensor</a></div><div class="ttdoc">A Rank 3 Tensor class.</div><div class="ttdef"><b>Definition:</b> <a href="matrices_8h_source.html#l01333">matrices.h:1333</a></div></div>
<div class="ttc" id="aclassoomph_1_1DenseMatrix_html"><div class="ttname"><a href="classoomph_1_1DenseMatrix.html">oomph::DenseMatrix&lt; double &gt;</a></div></div>
<div class="ttc" id="acfortran_8h_html_af6f0bd3dc13317f895c91323c25c2b8f"><div class="ttname"><a href="cfortran_8h.html#af6f0bd3dc13317f895c91323c25c2b8f">t</a></div><div class="ttdeci">char t</div><div class="ttdef"><b>Definition:</b> <a href="cfortran_8h_source.html#l00568">cfortran.h:568</a></div></div>
<div class="ttc" id="anamespaceoomph_1_1QuadTreeNames_html_a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6"><div class="ttname"><a href="namespaceoomph_1_1QuadTreeNames.html#a8954a5947b19986b8c4b755bc7639f7daabab2a070c062503375f8264f1b6d7d6">oomph::QuadTreeNames::W</a></div><div class="ttdeci">@ W</div><div class="ttdef"><b>Definition:</b> <a href="quadtree_8h_source.html#l00056">quadtree.h:56</a></div></div>
<div class="ttc" id="anamespaceoomph_1_1OneDimLagrange_html_a117f8b892dc89989ecdad99ff261e120"><div class="ttname"><a href="namespaceoomph_1_1OneDimLagrange.html#a117f8b892dc89989ecdad99ff261e120">oomph::OneDimLagrange::shape</a></div><div class="ttdeci">void shape(const double &amp;s, double *Psi)</div><div class="ttdoc">Definition for 1D Lagrange shape functions. The value of all the shape functions at the local coordin...</div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00545">shape.h:545</a></div></div>
<div class="ttc" id="aclassoomph_1_1TimeStepper_html"><div class="ttname"><a href="classoomph_1_1TimeStepper.html">oomph::TimeStepper</a></div><div class="ttdoc">Base class for time-stepping schemes. Timestepper provides an approximation of the temporal derivativ...</div><div class="ttdef"><b>Definition:</b> <a href="timesteppers_8h_source.html#l00215">timesteppers.h:215</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluxTransportEquations_html_ab637781b0f2fe83c5bc8f8127af4e1d4"><div class="ttname"><a href="classoomph_1_1FluxTransportEquations.html#ab637781b0f2fe83c5bc8f8127af4e1d4">oomph::FluxTransportEquations::du_dt_flux_transport</a></div><div class="ttdeci">double du_dt_flux_transport(const unsigned &amp;n, const unsigned &amp;i) const</div><div class="ttdoc">i-th component of du/dt at local node n. Uses suitably interpolated value for hanging nodes.</div><div class="ttdef"><b>Definition:</b> <a href="flux__transport__elements_8cc_source.html#l00268">flux_transport_elements.cc:268</a></div></div>
<div class="ttc" id="anamespaceoomph_html"><div class="ttname"><a href="namespaceoomph.html">oomph</a></div><div class="ttdoc">DRAIG: Change all instances of (SPATIAL_DIM) to (DIM-1).</div><div class="ttdef"><b>Definition:</b> <a href="advection__diffusion__elements_8cc_source.html#l00029">advection_diffusion_elements.cc:29</a></div></div>
<div class="ttc" id="aclassoomph_1_1Vector_html"><div class="ttname"><a href="classoomph_1_1Vector.html">oomph::Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluxTransportEquations_html_a76f71716bef2734cadcd5f79a9d8e469"><div class="ttname"><a href="classoomph_1_1FluxTransportEquations.html#a76f71716bef2734cadcd5f79a9d8e469">oomph::FluxTransportEquations::calculate_element_averages</a></div><div class="ttdeci">void calculate_element_averages(double *&amp;average_values)</div><div class="ttdoc">Compute the average values of the fluxes.</div><div class="ttdef"><b>Definition:</b> <a href="flux__transport__elements_8cc_source.html#l00299">flux_transport_elements.cc:299</a></div></div>
<div class="ttc" id="acfortran_8h_html_adb50e893b86b3e55e751a42eab3cba82"><div class="ttname"><a href="cfortran_8h.html#adb50e893b86b3e55e751a42eab3cba82">i</a></div><div class="ttdeci">cstr elem_len * i</div><div class="ttdef"><b>Definition:</b> <a href="cfortran_8h_source.html#l00603">cfortran.h:603</a></div></div>
<div class="ttc" id="aflux__transport__elements_8h_html"><div class="ttname"><a href="flux__transport__elements_8h.html">flux_transport_elements.h</a></div></div>
<div class="ttc" id="aclassoomph_1_1DShape_html"><div class="ttname"><a href="classoomph_1_1DShape.html">oomph::DShape</a></div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00271">shape.h:271</a></div></div>
<div class="ttc" id="athe__data__structure_8txt_html_af88b2d950fae19ab641bd1690e08445c"><div class="ttname"><a href="the__data__structure_8txt.html#af88b2d950fae19ab641bd1690e08445c">n</a></div><div class="ttdeci">endcode We introduce wrapper functions to access function so that we can formulate The Maths in generic terms Rather than referring to the pressure at node c n</div><div class="ttdef"><b>Definition:</b> <a href="the__data__structure_8txt_source.html#l00582">the_data_structure.txt:582</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluxTransportEquations_html"><div class="ttname"><a href="classoomph_1_1FluxTransportEquations.html">oomph::FluxTransportEquations</a></div><div class="ttdef"><b>Definition:</b> <a href="flux__transport__elements_8h_source.html#l00050">flux_transport_elements.h:50</a></div></div>
<div class="ttc" id="aclassoomph_1_1TimeStepper_html_ad341ba9e80265e1c26c1cda0f40c8292"><div class="ttname"><a href="classoomph_1_1TimeStepper.html#ad341ba9e80265e1c26c1cda0f40c8292">oomph::TimeStepper::is_steady</a></div><div class="ttdeci">bool is_steady() const</div><div class="ttdoc">Flag to indicate if a timestepper has been made steady (possibly temporarily to switch off time-depen...</div><div class="ttdef"><b>Definition:</b> <a href="timesteppers_8h_source.html#l00371">timesteppers.h:371</a></div></div>
<div class="ttc" id="athe__data__structure_8txt_html_aaa5287b1cf3ca06b3f413cb95bd1ec60"><div class="ttname"><a href="the__data__structure_8txt.html#aaa5287b1cf3ca06b3f413cb95bd1ec60">u</a></div><div class="ttdeci">Vector&lt; double &gt; u(3)</div></div>
<div class="ttc" id="aclassoomph_1_1TimeStepper_html_a4cb0aecb044b77ba0553cdd54b586d8a"><div class="ttname"><a href="classoomph_1_1TimeStepper.html#a4cb0aecb044b77ba0553cdd54b586d8a">oomph::TimeStepper::weight</a></div><div class="ttdeci">virtual double weight(const unsigned &amp;i, const unsigned &amp;j) const</div><div class="ttdoc">Access function for j-th weight for the i-th derivative.</div><div class="ttdef"><b>Definition:</b> <a href="timesteppers_8h_source.html#l00553">timesteppers.h:553</a></div></div>
<div class="ttc" id="aclassoomph_1_1Shape_html"><div class="ttname"><a href="classoomph_1_1Shape.html">oomph::Shape</a></div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00077">shape.h:77</a></div></div>
<div class="ttc" id="acfortran_8h_html_ab7123126e4885ef647dd9c6e3807a21c"><div class="ttname"><a href="cfortran_8h.html#ab7123126e4885ef647dd9c6e3807a21c">s</a></div><div class="ttdeci">static char t char * s</div><div class="ttdef"><b>Definition:</b> <a href="cfortran_8h_source.html#l00568">cfortran.h:568</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluxTransportEquations_html_a919f56a48a7ab618c90ceb41da5afaeb"><div class="ttname"><a href="classoomph_1_1FluxTransportEquations.html#a919f56a48a7ab618c90ceb41da5afaeb">oomph::FluxTransportEquations::interpolated_u_flux_transport</a></div><div class="ttdeci">double interpolated_u_flux_transport(const Vector&lt; double &gt; &amp;s, const unsigned &amp;i)</div><div class="ttdoc">Return the i-th unknown at the local coordinate s.</div><div class="ttdef"><b>Definition:</b> <a href="flux__transport__elements_8cc_source.html#l00241">flux_transport_elements.cc:241</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Mon Aug 9 2021 08:40:35
        </div>
      </div>
    </footer>
</body>
</html>
