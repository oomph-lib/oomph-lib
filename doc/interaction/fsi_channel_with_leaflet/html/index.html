<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: Flow in a 2D channel with an elastic leaflet</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Demo problem: Flow in a 2D channel with an elastic leaflet </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this example we consider the flow in a 2D channel which is partially obstructed by an elastic leaflet &ndash; the FSI generalisation of the <a href="../../../navier_stokes/channel_with_leaflet/html/index.html">Navier-Stokes problem in which the motion of the leaflet is prescribed.</a> A particular feature of this problem is that the leaflet (modelled as a thin-walled beam structure) is totally immersed in the fluid and is therefore exposed to the fluid traction from both sides.</p>
<p>The problem presented here was used as one of the test cases for <code>oomph-lib's</code> FSI preconditioner; see <br  />
<br  />
 </p><center> <a href="http://www.maths.man.ac.uk/~mheil/oomph_lib_additional_material/HeilHazelBoyleCompMech/HeilHazelBoyleCompMech.pdf">Heil, M., Hazel, A.L. &amp; Boyle, J. (2008): Solvers for large-displacement fluid-structure interaction problems: Segregated vs. monolithic approaches. Computational Mechanics.</a> </center><p>In this tutorial we concentrate on the problem formulation. The application of the preconditioner is discussed <a href="../../../preconditioners/fsi/html/index.html">elsewhere</a> &ndash; the required source code is contained in the <a href="../../../../demo_drivers/interaction/fsi_channel_with_leaflet/fsi_channel_with_leaflet.cc">driver code.</a></p>
<hr  />
 <hr  />
<h1><a class="anchor" id="the_problem"></a>
The Problem</h1>
<p>The figure below shows a sketch of the problem: A 2D channel of height <img class="formulaInl" alt="$ H^*_{tot}$" src="form_0.png" width="23" height="14"/> and length <img class="formulaInl" alt="$ L^*_{left} + L^*_{right} $" src="form_1.png" width="74" height="16"/> is partially occluded by a thin-walled elastic leaflet of height <img class="formulaInl" alt="$ H^*_{leaflet} $" src="form_2.png" width="41" height="16"/>. (As usual, we use asterisks to distinguish dimensional quantities from their non-dimensional equivalents to be introduced later.) We assume that the leaflet is sufficiently thin so that, as far as the boundary conditions for the fluid are concerned, the leaflet can be assumed to be infinitely thin. This allows us to parametrise its shape by a single Lagrangian coordinate <img class="formulaInl" alt="$ \xi^* $" src="form_3.png" width="11" height="13"/>. Hence we write the position vector to a material point on the leaflet as <img class="formulaInl" alt="$ {\bf R}^*_w(\xi^*,t^*) $" src="form_4.png" width="56" height="14"/>. A pulsatile Poiseuille flow whose mean velocity fluctuates between <img class="formulaInl" alt="$ U^* $" src="form_5.png" width="15" height="10"/> and <img class="formulaInl" alt="$ 2 U^* $" src="form_6.png" width="21" height="10"/> is imposed at the upstream end of the channel. The outflow is assumed to be parallel and axially traction-free.</p>
<div class="image">
<img src="fsi_channel_with_leaflet_dim.gif" alt=""/>
<div class="caption">
Sketch of the problem. </div></div>
 <p>We non-dimensionalise all length and coordinates on the channel width, <img class="formulaInl" alt="$ H^*_{tot} $" src="form_7.png" width="23" height="14"/> , time on the natural timescale of the flow, <img class="formulaInl" alt="$ H^*_{tot}/U^* $" src="form_8.png" width="44" height="14"/>, the velocities on the (minimum) mean velocity, <br  />
 <img class="formulaInl" alt="$ U^* $" src="form_5.png" width="15" height="10"/>, and the pressure on the viscous scale.</p>
<p>The fluid flow is then governed by the non-dimensional Navier-Stokes equations </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re \left( St \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} \right) = - \frac{\partial p}{\partial x_i} + \frac{\partial }{\partial x_j} \left[ \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right) \right], \]" src="form_9.png" width="306" height="31"/>
</p>
<p> where <img class="formulaInl" alt="$ Re = \rho U^* H_0^* / \mu $" src="form_10.png" width="85" height="14"/> and <img class="formulaInl" alt="$ St = 1 $" src="form_11.png" width="35" height="10"/>, and </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial u_i}{\partial x_i} = 0, \]" src="form_12.png" width="48" height="29"/>
</p>
 </center><p> subject to a time-periodic, parabolic inflow with non-dimensional period <img class="formulaInl" alt="$ T $" src="form_13.png" width="10" height="9"/>, </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf u} = 6 x_2 (1-x_2) \left( 1 + \frac{1}{2} (1-\cos(2 \pi t/T)) \right) {\bf e}_1 \]" src="form_14.png" width="243" height="31"/>
</p>
 </center><p> in the inflow cross-section; parallel, axially-traction-free outflow at the outlet; and no-slip on the stationary channel walls, <img class="formulaInl" alt="$ {\bf u} = {\bf 0} $" src="form_15.png" width="31" height="9"/>. The no-slip condition on the leaflet is </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf u} = \frac{\partial {\bf R}_w(\xi,t)}{\partial t}. \]" src="form_16.png" width="83" height="29"/>
</p>
 </center><p>We model the leaflet as a thin-walled, massless, elastic Kirchhoff-Love beam of wall thickness <img class="formulaInl" alt="$ h^* $" src="form_17.png" width="11" height="10"/>. The beam's effective (1D) elastic modulus is given by <img class="formulaInl" alt="$ E_{eff} = E/(1-\nu^2), $" src="form_18.png" width="105" height="15"/> where <img class="formulaInl" alt="$ E $" src="form_19.png" width="10" height="9"/> and <img class="formulaInl" alt="$ \nu $" src="form_20.png" width="6" height="6"/> are its 3D Young's modulus and Poisson's ratio, respectively. The beam's deformation is governed by the principle of virtual displacements, discussed in detail <a href="../../../beam/tensioned_string/html/index.html">in another tutorial.</a> As in the Navier-Stokes equations, we scale all lengths in the beam problem on the channel's width, <img class="formulaInl" alt="$ H^*_{tot}. $" src="form_21.png" width="26" height="14"/> The non-dimensional position vector <img class="formulaInl" alt="$ {\bf r}_w(\xi) $" src="form_22.png" width="30" height="14"/> to the undeformed wall is then given by </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf r}_w(\xi) = {\bf R}_w(\xi,t=0) = \left( \begin{array}{c} X_0 \\ \xi \end{array} \right) \ \ \ \ \ \ \mbox{where $\xi \in [0,H_{leaflet}].$} \]" src="form_23.png" width="325" height="31"/>
</p>
<p> Our non-dimensionalisation of the principle of virtual displacements requires all stresses and tractions to be non-dimensionalised on the beam's (effective 1D) elastic modulus, <img class="formulaInl" alt="$ E_{eff} $" src="form_24.png" width="25" height="13"/>. The non-dimensional load vector <img class="formulaInl" alt="$ {\bf f} = {\bf f}^{*}/E_{eff} $" src="form_25.png" width="66" height="14"/> that acts on the leaflet (combining the fluid tractions acting on its front and back faces) is then given by </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ f_i = Q \bigg\{ \left( p\big|_{front} \ N_i^{[front]} - \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right)\bigg|_{front} N_j^{[front]} \right) + \]" src="form_26.png" width="334" height="39"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ . \hspace{3cm} + \left( p\big|_{back} \ N_i^{[back]} - \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right)\bigg|_{back} N_j^{[back]} \right) \bigg\} \ \ \ \ \ \ \mbox{for $i=1,2,$} \]" src="form_27.png" width="458" height="33"/>
</p>
<p> where </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q = \frac{\mu U}{E_{eff} H_{tot}^*} \]" src="form_28.png" width="79" height="30"/>
</p>
<p> is the ratio of the fluid pressure scale, <img class="formulaInl" alt="$ \mu U/H_{tot}^* $" src="form_29.png" width="46" height="14"/> , used to non-dimensionalise the Navier-Stokes equations, to the beam's effective elastic modulus, <img class="formulaInl" alt="$ E_{eff} $" src="form_24.png" width="25" height="13"/>. The parameter <img class="formulaInl" alt="$ Q $" src="form_30.png" width="10" height="13"/> therefore indicates the strength of the fluid-structure interaction. In particular, if <img class="formulaInl" alt="$ Q=0 $" src="form_31.png" width="33" height="13"/> the leaflet does not "feel" the fluid traction. <img class="formulaInl" alt="$ {\bf N}_{front} $" src="form_32.png" width="38" height="14"/> and <img class="formulaInl" alt="$ {\bf N}_{back} $" src="form_33.png" width="33" height="13"/> are the outer unit normals on the "front" and "back" faces of the deformed leaflet, as shown in this sketch of the non-dimensional version of the problem:</p>
<div class="image">
<img src="fsi_channel_with_leaflet.gif" alt=""/>
<div class="caption">
Sketch of the problem in dimensionless variables. </div></div>
 <hr  />
 <hr  />
<h1><a class="anchor" id="results"></a>
Results</h1>
<p>The figure below shows (a) a snapshot of the flow field <br  />
 (pressure contours and instantaneous streamlines) and (b) the time-trace of the horizontal position of the leaflet's tip for a Reynolds number of <img class="formulaInl" alt="$ Re = 200 $" src="form_34.png" width="50" height="10"/>, a non-dimensional period of <img class="formulaInl" alt="$ T=2 $" src="form_35.png" width="33" height="9"/>, and an interaction parameter of <img class="formulaInl" alt="$ Q = 10^{-6} $" src="form_36.png" width="51" height="14"/>. Following the decay of initial transients the leaflet performs periodic large-amplitude oscillations with the period of the pulsating inflow. Large velocity gradients develop at the front of the leaflet and in the shear layer that emanates from its tip and separates the recirculating flow region behind the leaflet from the main flow. Fig. (c) illustrates the non-uniform mesh refinement and shows the improved resolution in the high-shear regions, particularly near the leaflet's tip where the pressure is singular. The mesh was continuously adapted throughout the simulation and contained an average of about 32,000 degrees of freedom. This is a fraction of the 1,324,343 degrees of freedom that would be required to achieve the same local resolution via uniform mesh refinement.</p>
<div class="image">
<img src="flow_from_paper.gif" alt=""/>
<div class="caption">
Computational results. </div></div>
 <p>The corresponding <a href="../figures/fsi_channel_with_leaflet_flow.avi">animation</a> illustrates the algebraic node update strategy (implemented with an <code>AlgebraicMesh</code>, discussed in more detail in <a href="../../fsi_collapsible_channel_algebraic/html/index.html">another tutorial</a>) and the evolution of the flow field. Note that the instantaneous streamlines intersect the (impermeable) leaflet because the leaflet is not stationary. The animation shows how the mesh adapts itself to changes in the flow field &ndash; using much smaller elements in high-shear regions, including the artificial outflow boundary layer that is created by the imposition of parallel outflow in a region where the flow is far from fully-developed.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="parameters"></a>
The global parameters</h1>
<p>As usual we use a namespace to define the problem parameters: The Reynolds number and its product with the Strouhal number (both initialised to 50),</p>
 <div class="fragment"><div class="line"><span class="comment">//==== start_of_global_parameters================================</span></div>
<div class="line"><span class="comment">/// Global parameters</span></div>
<div class="line"><span class="comment"></span><span class="comment">//===============================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div>
<div class="line">{<span class="comment"></span></div>
<div class="line"><span class="comment"> /// Reynolds number</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Re</a>=50.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Womersley number: Product of Reynolds and Strouhal numbers</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a085ee4bf968ffdd01a41b8c41864f907">ReSt</a>=50.0;</div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div><div class="ttdoc">Global parameters.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00046">fsi_channel_with_leaflet.cc:47</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a085ee4bf968ffdd01a41b8c41864f907"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a085ee4bf968ffdd01a41b8c41864f907">Global_Physical_Variables::ReSt</a></div><div class="ttdeci">double ReSt</div><div class="ttdoc">Womersley number: Product of Reynolds and Strouhal numbers.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00052">fsi_channel_with_leaflet.cc:52</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_ab814e627d2eb5bc50318879d19ab16b9"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a></div><div class="ttdeci">double Re</div><div class="ttdoc">Reynolds number.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00049">fsi_channel_with_leaflet.cc:49</a></div></div>
</div><!-- fragment --><p> the leaflet's non-dimensional wall thickness, <img class="formulaInl" alt="$ h = h^*/H^*_{tot} $" src="form_37.png" width="66" height="14"/>, and the FSI parameter,</p>
<div class="fragment"><div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Non-dimensional wall thickness.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">H</a>=0.05;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Fluid structure interaction parameter: Ratio of stresses used for</span></div>
<div class="line"><span class="comment"> /// non-dimensionalisation of fluid to solid stresses. </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a66cb7ecda9ba0cd72367dd697f154545">Q</a>=1.0e-6;</div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a66cb7ecda9ba0cd72367dd697f154545"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a66cb7ecda9ba0cd72367dd697f154545">Global_Physical_Variables::Q</a></div><div class="ttdeci">double Q</div><div class="ttdoc">Fluid structure interaction parameter: Ratio of stresses used for non-dimensionalisation of fluid to ...</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00059">fsi_channel_with_leaflet.cc:59</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_af6e07423e22c0991084d9a2f43727805"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a></div><div class="ttdeci">double H</div><div class="ttdoc">Non-dimensional wall thickness.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00055">fsi_channel_with_leaflet.cc:55</a></div></div>
</div><!-- fragment --><p> and the parameters that define the magnitude of the pulsating inflow.</p>
<div class="fragment"><div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Period for fluctuations in flux</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a2ffa220a56bff9b6b495ed47954d513f">Period</a>=2.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Min. flux</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#aa46dc81a0757e8f9707646e03c32d4fc">Min_flux</a>=1.0;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Max. flux</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#aee645139728fd3d01573b161c74e7e8a">Max_flux</a>=2.0;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Flux: Pulsatile flow fluctuating between Min_flux and Max_flux </span></div>
<div class="line"><span class="comment"> /// with period Period</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#ad651484fe06209606bccefe6fe23be0c">flux</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t)</div>
<div class="line"> {  </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#aa46dc81a0757e8f9707646e03c32d4fc">Min_flux</a>+</div>
<div class="line">   (<a class="code" href="namespaceGlobal__Physical__Variables.html#aee645139728fd3d01573b161c74e7e8a">Max_flux</a>-<a class="code" href="namespaceGlobal__Physical__Variables.html#aa46dc81a0757e8f9707646e03c32d4fc">Min_flux</a>)*0.5*(1.0-cos(2.0*MathematicalConstants::Pi*t/<a class="code" href="namespaceGlobal__Physical__Variables.html#a2ffa220a56bff9b6b495ed47954d513f">Period</a>));</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end_of_namespace</span></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a2ffa220a56bff9b6b495ed47954d513f"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a2ffa220a56bff9b6b495ed47954d513f">Global_Physical_Variables::Period</a></div><div class="ttdeci">double Period</div><div class="ttdoc">Period for fluctuations in flux.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00062">fsi_channel_with_leaflet.cc:62</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_aa46dc81a0757e8f9707646e03c32d4fc"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#aa46dc81a0757e8f9707646e03c32d4fc">Global_Physical_Variables::Min_flux</a></div><div class="ttdeci">double Min_flux</div><div class="ttdoc">Min. flux.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00065">fsi_channel_with_leaflet.cc:65</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_ad651484fe06209606bccefe6fe23be0c"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#ad651484fe06209606bccefe6fe23be0c">Global_Physical_Variables::flux</a></div><div class="ttdeci">double flux(const double &amp;t)</div><div class="ttdoc">Flux: Pulsatile flow fluctuating between Min_flux and Max_flux with period Period.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00072">fsi_channel_with_leaflet.cc:72</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_aee645139728fd3d01573b161c74e7e8a"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#aee645139728fd3d01573b161c74e7e8a">Global_Physical_Variables::Max_flux</a></div><div class="ttdeci">double Max_flux</div><div class="ttdoc">Max. flux.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00068">fsi_channel_with_leaflet.cc:68</a></div></div>
</div><!-- fragment --><hr  />
<p> <br  />
 </p><hr  />
<h1><a class="anchor" id="leaflet"></a>
The undeformed leaflet</h1>
<p>We use a <code>GeomObject</code> to describe the initial, stress-free shape of the elastic leaflet: a vertical straight line. The member function <code>d2position(...)</code> provides the first and second derivatives of the position vector, as required by the variational principle that governs the beam's deformation; see <a href="../../../beam/tensioned_string/html/index.html">the beam theory tutorial for details. </a></p>
<div class="fragment"><div class="line"><span class="comment">//=====start_of_undeformed_leaflet=================================</span></div>
<div class="line"><span class="comment">/// GeomObject: Undeformed straight, vertical leaflet</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=================================================================</span></div>
<div class="line"><span class="keyword">class </span><a class="code" href="classUndeformedLeaflet.html">UndeformedLeaflet</a> : <span class="keyword">public</span> GeomObject</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor: argument is the x-coordinate of the leaflet</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classUndeformedLeaflet.html#ac4c0478b1f329360684af14b59043b12">UndeformedLeaflet</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; x0): GeomObject(1,2)</div>
<div class="line">  {</div>
<div class="line">   <a class="code" href="classUndeformedLeaflet.html#aa89fc695af9e53aa38894c9d875afd36">X0</a>=x0;</div>
<div class="line">  }</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Position vector at Lagrangian coordinate zeta </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUndeformedLeaflet.html#a8e9b79702eb9a38e19886b84aeb47918">position</a>(<span class="keyword">const</span> Vector&lt;double&gt;&amp; zeta, Vector&lt;double&gt;&amp; r)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">   <span class="comment">// Position Vector</span></div>
<div class="line">   r[0] = <a class="code" href="classUndeformedLeaflet.html#aa89fc695af9e53aa38894c9d875afd36">X0</a>;</div>
<div class="line">   r[1] = zeta[0];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Parametrised position on object: r(zeta). Evaluated at</span></div>
<div class="line"><span class="comment"> /// previous timestep. t=0: current time; t&gt;0: previous</span></div>
<div class="line"><span class="comment"> /// timestep. Calls steady version.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUndeformedLeaflet.html#a8e9b79702eb9a38e19886b84aeb47918">position</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; t, <span class="keyword">const</span> Vector&lt;double&gt;&amp; zeta,</div>
<div class="line">               Vector&lt;double&gt;&amp; r)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">   <span class="comment">// Use the steady version</span></div>
<div class="line">   <a class="code" href="classUndeformedLeaflet.html#a8e9b79702eb9a38e19886b84aeb47918">position</a>(zeta,r);</div>
<div class="line">  } <span class="comment">// end of position</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Posn vector and its  1st &amp; 2nd derivatives</span></div>
<div class="line"><span class="comment"> /// w.r.t. to coordinates:</span></div>
<div class="line"><span class="comment"> /// \f$ \frac{dR_i}{d \zeta_\alpha}\f$ = drdzeta(alpha,i). </span></div>
<div class="line"><span class="comment"> /// \f$ \frac{d^2R_i}{d \zeta_\alpha d \zeta_\beta}\f$ = </span></div>
<div class="line"><span class="comment"> /// ddrdzeta(alpha,beta,i). Evaluated at current time.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUndeformedLeaflet.html#a47d674756ce22e00a44ca0bd030a99da">d2position</a>(<span class="keyword">const</span> Vector&lt;double&gt;&amp; zeta,</div>
<div class="line">                 Vector&lt;double&gt;&amp; r,</div>
<div class="line">                 DenseMatrix&lt;double&gt; &amp;drdzeta,</div>
<div class="line">                 RankThreeTensor&lt;double&gt; &amp;ddrdzeta)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">   <span class="comment">// Position vector</span></div>
<div class="line">   r[0] = <a class="code" href="classUndeformedLeaflet.html#aa89fc695af9e53aa38894c9d875afd36">X0</a>;</div>
<div class="line">   r[1] = zeta[0];</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Tangent vector</span></div>
<div class="line">   drdzeta(0,0)=0.0;</div>
<div class="line">   drdzeta(0,1)=1.0;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Derivative of tangent vector</span></div>
<div class="line">   ddrdzeta(0,0,0)=0.0;</div>
<div class="line">   ddrdzeta(0,0,1)=0.0;</div>
<div class="line">  } <span class="comment">// end of d2position</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Number of geometric Data in GeomObject: None.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">unsigned</span> <a class="code" href="classUndeformedLeaflet.html#a56153a1d117dd41657183655de094d3e">ngeom_data</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> 0;}  </div>
<div class="line"> </div>
<div class="line"> private :</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// x position of the undeformed leaflet&#39;s origin. </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="classUndeformedLeaflet.html#aa89fc695af9e53aa38894c9d875afd36">X0</a>;</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">//end_of_undeformed_wall</span></div>
<div class="ttc" id="aclassUndeformedLeaflet_html"><div class="ttname"><a href="classUndeformedLeaflet.html">UndeformedLeaflet</a></div><div class="ttdoc">//////////////////////////////////////////////////////////////////// ////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00090">fsi_channel_with_leaflet.cc:91</a></div></div>
<div class="ttc" id="aclassUndeformedLeaflet_html_a47d674756ce22e00a44ca0bd030a99da"><div class="ttname"><a href="classUndeformedLeaflet.html#a47d674756ce22e00a44ca0bd030a99da">UndeformedLeaflet::d2position</a></div><div class="ttdeci">void d2position(const Vector&lt; double &gt; &amp;zeta, Vector&lt; double &gt; &amp;r, DenseMatrix&lt; double &gt; &amp;drdzeta, RankThreeTensor&lt; double &gt; &amp;ddrdzeta) const</div><div class="ttdoc">Posn vector and its 1st &amp; 2nd derivatives w.r.t. to coordinates:  = drdzeta(alpha,...</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00126">fsi_channel_with_leaflet.cc:126</a></div></div>
<div class="ttc" id="aclassUndeformedLeaflet_html_a56153a1d117dd41657183655de094d3e"><div class="ttname"><a href="classUndeformedLeaflet.html#a56153a1d117dd41657183655de094d3e">UndeformedLeaflet::ngeom_data</a></div><div class="ttdeci">unsigned ngeom_data() const</div><div class="ttdoc">Number of geometric Data in GeomObject: None.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00145">fsi_channel_with_leaflet.cc:145</a></div></div>
<div class="ttc" id="aclassUndeformedLeaflet_html_a8e9b79702eb9a38e19886b84aeb47918"><div class="ttname"><a href="classUndeformedLeaflet.html#a8e9b79702eb9a38e19886b84aeb47918">UndeformedLeaflet::position</a></div><div class="ttdeci">void position(const Vector&lt; double &gt; &amp;zeta, Vector&lt; double &gt; &amp;r) const</div><div class="ttdoc">Position vector at Lagrangian coordinate zeta.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00102">fsi_channel_with_leaflet.cc:102</a></div></div>
<div class="ttc" id="aclassUndeformedLeaflet_html_aa89fc695af9e53aa38894c9d875afd36"><div class="ttname"><a href="classUndeformedLeaflet.html#aa89fc695af9e53aa38894c9d875afd36">UndeformedLeaflet::X0</a></div><div class="ttdeci">double X0</div><div class="ttdoc">x position of the undeformed leaflet's origin.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00150">fsi_channel_with_leaflet.cc:150</a></div></div>
<div class="ttc" id="aclassUndeformedLeaflet_html_ac4c0478b1f329360684af14b59043b12"><div class="ttname"><a href="classUndeformedLeaflet.html#ac4c0478b1f329360684af14b59043b12">UndeformedLeaflet::UndeformedLeaflet</a></div><div class="ttdeci">UndeformedLeaflet(const double &amp;x0)</div><div class="ttdoc">Constructor: argument is the x-coordinate of the leaflet.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00096">fsi_channel_with_leaflet.cc:96</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="main"></a>
The driver code</h1>
<p>As with most time-dependent demo codes, the specification of a non-zero number of command line arguments will be interpreted as the code being run as part of <code>oomph-lib's</code> self-test in which case only a few timesteps will be performed. Therefore we start by storing the command line arguments in the namespace <code>CommandLineArgs</code> to make them accessible throughout the code.</p>
<div class="fragment"><div class="line"><span class="comment">//======= start_of_main================================================</span></div>
<div class="line"><span class="comment">/// Driver code  -- pass a command line argument if you want to run</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// the code in validation mode where it only performs a few steps</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=====================================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="fsi__channel__with__leaflet_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Store command line arguments</span></div>
<div class="line"> CommandLineArgs::setup(argc,argv);</div>
<div class="ttc" id="afsi__channel__with__leaflet_8cc_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="fsi__channel__with__leaflet_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdoc">Driver code – pass a command line argument if you want to run the code in validation mode where it on...</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00756">fsi_channel_with_leaflet.cc:756</a></div></div>
</div><!-- fragment --><p> Next we specify the geometry and mesh parameters, and build the <code>Problem</code> object, using the <code>AlgebraicElement</code> version of the two-dimensional <code>RefineableQTaylorHoodElements</code>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">//Parameters for the leaflet: x-position of root and height</span></div>
<div class="line"> <span class="keywordtype">double</span> x_0 = 1.0; </div>
<div class="line"> <span class="keywordtype">double</span> hleaflet=0.5;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of elements in various regions of mesh</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nleft=6; </div>
<div class="line"> <span class="keywordtype">unsigned</span> nright=18;</div>
<div class="line"> <span class="keywordtype">unsigned</span> ny1=3; </div>
<div class="line"> <span class="keywordtype">unsigned</span> ny2=3; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Dimensions of fluid mesh: length to the left and right of leaflet</span></div>
<div class="line"> <span class="comment">// and total height</span></div>
<div class="line"> <span class="keywordtype">double</span> lleft =1.0; </div>
<div class="line"> <span class="keywordtype">double</span> lright=3.0; </div>
<div class="line"> <span class="keywordtype">double</span> htot=1.0;</div>
<div class="line">  </div>
<div class="line"> <span class="comment">//Build the problem</span></div>
<div class="line"> <a class="code" href="classFSIChannelWithLeafletProblem.html">FSIChannelWithLeafletProblem</a>&lt;</div>
<div class="line">  AlgebraicElement&lt;RefineableQTaylorHoodElement&lt;2&gt; &gt; &gt;</div>
<div class="line">  problem(lleft,lright,hleaflet,</div>
<div class="line">          htot,nleft,nright,ny1,ny2,x_0); </div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html">FSIChannelWithLeafletProblem</a></div><div class="ttdoc">//////////////////////////////////////////////////////////////////// ////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00164">fsi_channel_with_leaflet.cc:165</a></div></div>
</div><!-- fragment --><p> We prepare a <code>DocInfo</code> object and open a trace file to document the system's evolution.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Set up doc info</span></div>
<div class="line"> DocInfo doc_info; </div>
<div class="line"> doc_info.set_directory(<span class="stringliteral">&quot;RESLT&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Trace file</span></div>
<div class="line"> ofstream trace;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/trace.dat&quot;</span>,doc_info.directory().c_str());</div>
<div class="line"> trace.open(filename);</div>
</div><!-- fragment --><p> Next we assign the timestepping parameters (using fewer timesteps if the code is run during a self-test) and document the system's initial state which provides the initial guess for the Newton iteration in the subsequent steady solve.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of timesteps (reduced for validation)</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nstep=200;</div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::Argc&gt;1)</div>
<div class="line">  {</div>
<div class="line">   nstep=2;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Timestep: </span></div>
<div class="line"> <span class="keywordtype">double</span> dt=0.05;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Initialise timestep </span></div>
<div class="line"> problem.initialise_dt(dt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Doc initial guess for steady solve</span></div>
<div class="line"> problem.doc_solution(doc_info,trace);</div>
<div class="line"> doc_info.number()++; </div>
</div><!-- fragment --><p> We wish to start the time-dependent simulation from an initial condition that corresponds to the steady solution of the problem with unit influx (i.e. the steady solution obtained if the time-dependent boundary condition that is applied at the inlet is held fixed at its value for <img class="formulaInl" alt="$ t= 0 $" src="form_38.png" width="29" height="9"/>). For the required Reynolds number of <img class="formulaInl" alt="$ Re=200 $" src="form_39.png" width="50" height="10"/>, the currently assigned initial guess (zero velocity and pressure, with the wall <br  />
 in its undeformed position) is "too far" from the actual solution and the Newton method would diverge (try it!). Therefore we generate the initial steady solution in a preliminary sequence of steady computations in which we first compute the solution for a Reynolds number of <img class="formulaInl" alt="$ Re=50 $" src="form_40.png" width="44" height="10"/> (for this value the Newton method does converge). This solution is then used as the initial guess for the computation at <img class="formulaInl" alt="$ Re=100 $" src="form_41.png" width="50" height="10"/>, etc. We allow for up to 3 mesh adaptations for each Reynolds number to allow the mesh to adapt itself to the flow conditions before starting the time-dependent run.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Initial loop to increment the Reynolds number in sequence of steady solves</span></div>
<div class="line"> <span class="comment">//---------------------------------------------------------------------------</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_increment=4;</div>
<div class="line"> <span class="comment">// Just to one step for validation run</span></div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::Argc&gt;1)</div>
<div class="line">  {</div>
<div class="line">   n_increment=1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set max. number of adaptations</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> max_adapt=3;</div>
<div class="line"> </div>
<div class="line"> <a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a>=0.0;</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;n_increment;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Increase Re and ReSt (for St=1)</span></div>
<div class="line">   <a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a>+=50.0;</div>
<div class="line">   <a class="code" href="namespaceGlobal__Physical__Variables.html#a085ee4bf968ffdd01a41b8c41864f907">Global_Physical_Variables::ReSt</a>=<a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Solve the steady problem </span></div>
<div class="line">   std::cout &lt;&lt; <span class="stringliteral">&quot;Computing a steady solution for Re=&quot;</span> </div>
<div class="line">             &lt;&lt;  <a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a> &lt;&lt; std::endl;</div>
<div class="line">   problem.steady_newton_solve(max_adapt);</div>
<div class="line">   problem.doc_solution(doc_info,trace);</div>
<div class="line">   doc_info.number()++; </div>
<div class="line">  } <span class="comment">// reached final Reynolds number </span></div>
</div><!-- fragment --><p>Finally, we start the proper timestepping procedure, allowing for one mesh adaptation per timestep and suppressing the re-assignment of the initial condition after the mesh adaptation by setting the <code>first</code> flag to false.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Proper time-dependent run</span></div>
<div class="line"> <span class="comment">//--------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Limit the number of adaptations during unsteady run to one per timestep</span></div>
<div class="line"> max_adapt=1;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Don&#39;t re-set the initial conditions when adapting the mesh</span></div>
<div class="line"> <span class="keywordtype">bool</span> first = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Timestepping loop</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> istep=0;istep&lt;nstep;istep++)</div>
<div class="line">  { </div>
<div class="line">   <span class="comment">// Solve the problem</span></div>
<div class="line">   problem.unsteady_newton_solve(dt,max_adapt,first);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Output the solution</span></div>
<div class="line">   problem.doc_solution(doc_info,trace);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Step number</span></div>
<div class="line">   doc_info.number()++;</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">}<span class="comment">//end of main</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="problem"></a>
The Problem class</h1>
<p>The <code>Problem</code> class contains the usual member functions, most of which are either empty or explained in more detail below.</p>
 <div class="fragment"><div class="line"><span class="comment">//=====start_of_problem_class========================================</span></div>
<div class="line"><span class="comment">/// FSI leaflet in channel</span></div>
<div class="line"><span class="comment"></span><span class="comment">//===================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classFSIChannelWithLeafletProblem.html">FSIChannelWithLeafletProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor: Pass the lenght of the domain at the left</span></div>
<div class="line"><span class="comment"> /// of the leaflet lleft,the lenght of the domain at the right of the</span></div>
<div class="line"><span class="comment"> /// leaflet lright,the height of the leaflet hleaflet, the total height</span></div>
<div class="line"><span class="comment"> /// of the domain htot, the number of macro-elements at the left of the</span></div>
<div class="line"><span class="comment"> /// leaflet nleft, the number of macro-elements at the right of the</span></div>
<div class="line"><span class="comment"> /// leaflet nright, the number of macro-elements under hleaflet ny1,</span></div>
<div class="line"><span class="comment"> /// the number of macro-elements above hleaflet ny2, the abscissa</span></div>
<div class="line"><span class="comment"> /// of the origin of the leaflet x_0.</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classFSIChannelWithLeafletProblem.html#aaa0a455e91c4fb2dd9696607b802d01b">FSIChannelWithLeafletProblem</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; lleft,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; lright, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; hleaflet,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; htot,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; nleft, <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; nright,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; ny1, <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp;  ny2,</div>
<div class="line">                              <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; x_0);  </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Destructor empty</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classFSIChannelWithLeafletProblem.html#a5df1d8f7229314a92ffb48ec61f56fe0">~FSIChannelWithLeafletProblem</a>(){}</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Actions after solve (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classFSIChannelWithLeafletProblem.html#abff6e46a940263c9255a61f649bb4239">actions_after_newton_solve</a>(){}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Actions before solve (empty) </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classFSIChannelWithLeafletProblem.html#a8a32ef77f32b3283b4b509669deb0a11">actions_before_newton_solve</a>(){}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Actions after adaptation</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classFSIChannelWithLeafletProblem.html#acc3f4745ea9b4524aebbc4f2556d1286">actions_after_adapt</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function to the wall mesh</span></div>
<div class="line"><span class="comment"></span> OneDLagrangianMesh&lt;FSIHermiteBeamElement&gt;* <a class="code" href="classFSIChannelWithLeafletProblem.html#ab6a1c532882a71ddd576c752da389de0">wall_mesh_pt</a>() </div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="classFSIChannelWithLeafletProblem.html#a943437726f0a54fa8f7fc9ffb12bc4cd">Wall_mesh_pt</a>;</div>
<div class="line">  } </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function to fluid mesh</span></div>
<div class="line"><span class="comment"></span> RefineableAlgebraicChannelWithLeafletMesh&lt;ELEMENT&gt;* <a class="code" href="classFSIChannelWithLeafletProblem.html#aec9244497829f9a85cbca7307c4d4e10">fluid_mesh_pt</a>()</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="classFSIChannelWithLeafletProblem.html#a40cee3652918bdcf67569afc89d3074d">Fluid_mesh_pt</a>;</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc the solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classFSIChannelWithLeafletProblem.html#a055f124f38dca43bc3ed36b80c5c0880">doc_solution</a>(DocInfo&amp; doc_info, ofstream&amp; trace);</div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_a055f124f38dca43bc3ed36b80c5c0880"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#a055f124f38dca43bc3ed36b80c5c0880">FSIChannelWithLeafletProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(DocInfo &amp;doc_info, ofstream &amp;trace)</div><div class="ttdoc">Doc the solution.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00633">fsi_channel_with_leaflet.cc:633</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_a40cee3652918bdcf67569afc89d3074d"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#a40cee3652918bdcf67569afc89d3074d">FSIChannelWithLeafletProblem::Fluid_mesh_pt</a></div><div class="ttdeci">RefineableAlgebraicChannelWithLeafletMesh&lt; ELEMENT &gt; * Fluid_mesh_pt</div><div class="ttdoc">Pointer to the fluid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00244">fsi_channel_with_leaflet.cc:244</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_a5df1d8f7229314a92ffb48ec61f56fe0"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#a5df1d8f7229314a92ffb48ec61f56fe0">FSIChannelWithLeafletProblem::~FSIChannelWithLeafletProblem</a></div><div class="ttdeci">~FSIChannelWithLeafletProblem()</div><div class="ttdoc">Destructor empty.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00185">fsi_channel_with_leaflet.cc:185</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_a8a32ef77f32b3283b4b509669deb0a11"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#a8a32ef77f32b3283b4b509669deb0a11">FSIChannelWithLeafletProblem::actions_before_newton_solve</a></div><div class="ttdeci">void actions_before_newton_solve()</div><div class="ttdoc">Actions before solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00191">fsi_channel_with_leaflet.cc:191</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_a943437726f0a54fa8f7fc9ffb12bc4cd"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#a943437726f0a54fa8f7fc9ffb12bc4cd">FSIChannelWithLeafletProblem::Wall_mesh_pt</a></div><div class="ttdeci">OneDLagrangianMesh&lt; FSIHermiteBeamElement &gt; * Wall_mesh_pt</div><div class="ttdoc">Pointer to the &quot;wall&quot; mesh.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00247">fsi_channel_with_leaflet.cc:247</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_aaa0a455e91c4fb2dd9696607b802d01b"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#aaa0a455e91c4fb2dd9696607b802d01b">FSIChannelWithLeafletProblem::FSIChannelWithLeafletProblem</a></div><div class="ttdeci">FSIChannelWithLeafletProblem(const double &amp;lleft, const double &amp;lright, const double &amp;hleaflet, const double &amp;htot, const unsigned &amp;nleft, const unsigned &amp;nright, const unsigned &amp;ny1, const unsigned &amp;ny2, const double &amp;x_0)</div><div class="ttdoc">Constructor: Pass the lenght of the domain at the left of the leaflet lleft,the lenght of the domain ...</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00265">fsi_channel_with_leaflet.cc:265</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_ab6a1c532882a71ddd576c752da389de0"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#ab6a1c532882a71ddd576c752da389de0">FSIChannelWithLeafletProblem::wall_mesh_pt</a></div><div class="ttdeci">OneDLagrangianMesh&lt; FSIHermiteBeamElement &gt; * wall_mesh_pt()</div><div class="ttdoc">Access function to the wall mesh.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00197">fsi_channel_with_leaflet.cc:197</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_abff6e46a940263c9255a61f649bb4239"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#abff6e46a940263c9255a61f649bb4239">FSIChannelWithLeafletProblem::actions_after_newton_solve</a></div><div class="ttdeci">void actions_after_newton_solve()</div><div class="ttdoc">Actions after solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00188">fsi_channel_with_leaflet.cc:188</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_acc3f4745ea9b4524aebbc4f2556d1286"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#acc3f4745ea9b4524aebbc4f2556d1286">FSIChannelWithLeafletProblem::actions_after_adapt</a></div><div class="ttdeci">void actions_after_adapt()</div><div class="ttdoc">Actions after adaptation.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00572">fsi_channel_with_leaflet.cc:572</a></div></div>
<div class="ttc" id="aclassFSIChannelWithLeafletProblem_html_aec9244497829f9a85cbca7307c4d4e10"><div class="ttname"><a href="classFSIChannelWithLeafletProblem.html#aec9244497829f9a85cbca7307c4d4e10">FSIChannelWithLeafletProblem::fluid_mesh_pt</a></div><div class="ttdeci">RefineableAlgebraicChannelWithLeafletMesh&lt; ELEMENT &gt; * fluid_mesh_pt()</div><div class="ttdoc">Access function to fluid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="fsi__channel__with__leaflet_8cc_source.html#l00203">fsi_channel_with_leaflet.cc:203</a></div></div>
</div><!-- fragment --><p>Two member functions are implemented here: The function <code>actions_before_implicit_timestep()</code> updates the time-dependent velocity profile at the upstream boundary (boundary 3; see the enumeration of the mesh boundaries in the <a href="../../../meshes/mesh_list/html/index.html#channel_with_leaflet"><code>ChannelWithLeafletMesh</code></a>): </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Update the inflow velocity</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> actions_before_implicit_timestep()</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Actual time</span></div>
<div class="line">   <span class="keywordtype">double</span> t=time_pt()-&gt;time();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Amplitude of flow</span></div>
<div class="line">   <span class="keywordtype">double</span> ampl=<a class="code" href="namespaceGlobal__Physical__Variables.html#ad651484fe06209606bccefe6fe23be0c">Global_Physical_Variables::flux</a>(t);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Update parabolic flow along boundary 3</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> ibound=3; </div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">   {</div>
<div class="line">    <span class="keywordtype">double</span> ycoord = Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;x(1); </div>
<div class="line">    <span class="keywordtype">double</span> uy = ampl*6.0*ycoord/Htot*(1.0-ycoord/Htot);</div>
<div class="line">    Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(0,uy);</div>
<div class="line">    Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(1,0.0);    </div>
<div class="line">   }</div>
<div class="line">  } <span class="comment">// end of actions_before_implicit_timestep</span></div>
</div><!-- fragment --><p> Since the node-update is performed by an algebraic node-update procedure the nodal positions in the fluid mesh must be updated whenever any of the (solid) degrees-of-freedom change. This is done automatically during the computation of the shape derivatives (implemented in the <code>AlgebraicElement</code> wrapper class described <a href="../../fsi_collapsible_channel_algebraic/html/index.html">another tutorial</a>), but an additional node update must be performed when the unknowns are updated by the Newton solver. This is achieved by performing a further node-update in the function <code>actions_before_newton_convergence_check()</code>:</p>
<div class="fragment"><div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update before checking Newton convergence: Update the</span></div>
<div class="line"><span class="comment"> /// nodal positions in the fluid mesh in response to possible </span></div>
<div class="line"><span class="comment"> /// changes in the wall shape</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> actions_before_newton_convergence_check()</div>
<div class="line">  {</div>
<div class="line">   Fluid_mesh_pt-&gt;node_update();</div>
<div class="line">  }</div>
</div><!-- fragment --><p> The private member data contains the usual pointers to the <code>Problem's</code> two sub-meshes, the pointer to <code>GeomObject</code> that represents the leaflet, and the total height of the channel.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Pointer to the fluid mesh</span></div>
<div class="line"><span class="comment"></span> RefineableAlgebraicChannelWithLeafletMesh&lt;ELEMENT&gt;* Fluid_mesh_pt;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to the &quot;wall&quot; mesh</span></div>
<div class="line"><span class="comment"></span> OneDLagrangianMesh&lt;FSIHermiteBeamElement&gt;* Wall_mesh_pt;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to the GeomObject that represents the wall</span></div>
<div class="line"><span class="comment"></span> GeomObject* Leaflet_pt;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Total height of the domain</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> Htot;</div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="constructor"></a>
The problem constructor</h1>
<p>We start the problem construction by creating two timesteppers: A <code>BFD&lt;2&gt;</code> timestepper for the fluid and the fake timestepper <code>Steady&lt;2&gt;</code> for the (massless) solid. (<a href="../../fsi_collapsible_channel_adapt/html/index.html">Recall </a> that timesteppers from the <code>Steady</code> family return zero time-derivatives but keep track of the past histories. These are needed during the adaptive refinement of the fluid mesh: when assigning the history of the previous nodal positions for newly created fluid nodes, we must evaluate the position of the leaflet at previous timesteps; this is discussed in more detail in <a href="../../fsi_collapsible_channel_adapt/html/index.html">another tutorial</a>.)</p>
<div class="fragment"><div class="line"><span class="comment">//=====start_of_constructor==============================================</span></div>
<div class="line"><span class="comment">/// Constructor</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a class="code" href="classFSIChannelWithLeafletProblem.html#aaa0a455e91c4fb2dd9696607b802d01b">FSIChannelWithLeafletProblem&lt;ELEMENT&gt;::FSIChannelWithLeafletProblem</a>(</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; lleft,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; lright,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; hleaflet,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; htot,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; nleft,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; nright,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; ny1,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp;  ny2,</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; x_0) : Htot(htot)</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Timesteppers:</span></div>
<div class="line"> <span class="comment">//--------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Allocate the timestepper</span></div>
<div class="line"> BDF&lt;2&gt;* fluid_time_stepper_pt=<span class="keyword">new</span> BDF&lt;2&gt;;</div>
<div class="line"> add_time_stepper_pt(fluid_time_stepper_pt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Allocate the wall timestepper</span></div>
<div class="line"> Steady&lt;2&gt;* wall_time_stepper_pt=<span class="keyword">new</span> Steady&lt;2&gt;;</div>
<div class="line"> add_time_stepper_pt(wall_time_stepper_pt);</div>
</div><!-- fragment --><p> Next we create the mesh of 1D Hermite beam elements that represents the leaflet, passing a pointer to an instance of the <code><a class="el" href="classUndeformedLeaflet.html" title="//////////////////////////////////////////////////////////////////// ////////////////////////////////...">UndeformedLeaflet</a></code> to its constructor.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Discretise leaflet</span></div>
<div class="line"> <span class="comment">//-------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Geometric object that represents the undeformed leaflet</span></div>
<div class="line"> <a class="code" href="classUndeformedLeaflet.html">UndeformedLeaflet</a>* undeformed_wall_pt=<span class="keyword">new</span> <a class="code" href="classUndeformedLeaflet.html">UndeformedLeaflet</a>(x_0);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Create the &quot;wall&quot; mesh with FSI Hermite beam elements</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_wall_el=5;</div>
<div class="line"> Wall_mesh_pt = <span class="keyword">new</span> OneDLagrangianMesh&lt;FSIHermiteBeamElement&gt;</div>
<div class="line">  (n_wall_el,hleaflet,undeformed_wall_pt,wall_time_stepper_pt);</div>
</div><!-- fragment --><p> The wall mesh defines the geometry of the deformed leaflet, therefore we create a <code>GeomObject</code> representation of that mesh, using the <code>MeshAsGeomObject</code> class, and pass it to the constructor of the fluid mesh:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Provide GeomObject representation of leaflet mesh and build fluid mesh</span></div>
<div class="line"> <span class="comment">//-----------------------------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build a geometric object (one Lagrangian, two Eulerian coordinates)</span></div>
<div class="line"> <span class="comment">// from the wall mesh</span></div>
<div class="line"> MeshAsGeomObject* wall_geom_object_pt=</div>
<div class="line">  <span class="keyword">new</span> MeshAsGeomObject(Wall_mesh_pt); </div>
<div class="line"> </div>
<div class="line"><span class="comment">//Build the mesh</span></div>
<div class="line"> Fluid_mesh_pt =<span class="keyword">new</span> RefineableAlgebraicChannelWithLeafletMesh&lt;ELEMENT&gt;(</div>
<div class="line">  wall_geom_object_pt,</div>
<div class="line">  lleft, lright,</div>
<div class="line">  hleaflet,</div>
<div class="line">  htot,nleft,</div>
<div class="line">  nright,ny1,ny2,</div>
<div class="line">  fluid_time_stepper_pt);</div>
</div><!-- fragment --><p> We specify an error estimator for the fluid mesh and add both meshes to the <code>Problem</code> before combining them into a global mesh.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Set error estimator</span></div>
<div class="line"> Z2ErrorEstimator* error_estimator_pt=<span class="keyword">new</span> Z2ErrorEstimator;</div>
<div class="line"> Fluid_mesh_pt-&gt;spatial_error_estimator_pt()=error_estimator_pt;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build global mesh</span></div>
<div class="line"> <span class="comment">//------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Add the sub meshes to the problem</span></div>
<div class="line"> add_sub_mesh(Fluid_mesh_pt);</div>
<div class="line"> add_sub_mesh(Wall_mesh_pt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Combine all submeshes into a single Mesh</span></div>
<div class="line"> build_global_mesh();</div>
</div><!-- fragment --><p> Dirichlet conditions (prescribed velocity) are applied on virtually all boundaries of the fluid domain (prescribed inflow at the inlet; zero velocity on the rigid channel walls; fluid velocity prescribed by the wall motion on the leaflet), apart from the outflow (boundary 1; see the enumeration of the mesh boundaries in the <a href="../../../meshes/mesh_list/html/index.html#channel_with_leaflet"><code>ChannelWithLeafletMesh</code></a>) where the axial velocity is unknown (and determined indirectly by the "axially-traction-free" condition) while the vertical velocity has to be set to zero to ensure parallel outflow.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Fluid boundary conditions</span></div>
<div class="line"> <span class="comment">//--------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Pin the boundary nodes of the fluid mesh</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> num_bound = Fluid_mesh_pt-&gt;nboundary();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=0;ibound&lt;num_bound;ibound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {</div>
<div class="line">      Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;pin(1);</div>
<div class="line">     </div>
<div class="line">      <span class="comment">// Do not pin the x velocity of the outflow</span></div>
<div class="line">      <span class="keywordflow">if</span>( ibound != 1)</div>
<div class="line">      {</div>
<div class="line">       Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;pin(0); </div>
<div class="line">      }      </div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> <span class="comment">// end loop over boundaries</span></div>
</div><!-- fragment --><p> Next we assign the parabolic velocity profile at the inlet (recall that all values are initialised to zero so no further action is required on any of the other Dirichlet boundaries).</p>
<div class="fragment"><div class="line">   </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup parabolic flow along boundary 3 (everything else that&#39;s </span></div>
<div class="line"> <span class="comment">// pinned has homogenous boundary conditions so no action is required</span></div>
<div class="line"> <span class="comment">// as that&#39;s the default assignment). Inflow profile is parabolic</span></div>
<div class="line"> <span class="comment">// and this is interpolated correctly during mesh refinement so</span></div>
<div class="line"> <span class="comment">// no re-assignment necessary after adaptation.</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> ibound=3; </div>
<div class="line"> <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">double</span> ycoord = Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;x(1); </div>
<div class="line">   <span class="keywordtype">double</span> uy = 6.0*ycoord/htot*(1.0-ycoord/htot);</div>
<div class="line">   Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(0,uy);</div>
<div class="line">   Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(1,0.0);    </div>
<div class="line">  }<span class="comment">// end of setup boundary condition</span></div>
</div><!-- fragment --><p> The leaflet is clamped at its lower end so we pin its <img class="formulaInl" alt="$x_1$" src="form_42.png" width="13" height="9"/>- and <img class="formulaInl" alt="$x_2$" src="form_43.png" width="13" height="9"/>-positions, and impose a vertical slope by setting <img class="formulaInl" alt="$ dx_1/ds = 0 $" src="form_44.png" width="60" height="14"/> (where s is the local coordinate along the element; see the discussion of the boundary conditions for beam elements in <a href="../../../beam/tensioned_string/html/index.html">another tutorial</a> for details).</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Boundary conditions for wall mesh</span></div>
<div class="line"> <span class="comment">//----------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set the boundary conditions: the lower end of the beam is fixed in space</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> b=0; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin displacements in both x and y directions</span></div>
<div class="line"> wall_mesh_pt()-&gt;boundary_node_pt(b,0)-&gt;pin_position(0); </div>
<div class="line"> wall_mesh_pt()-&gt;boundary_node_pt(b,0)-&gt;pin_position(1);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Infinite slope: Pin type 1 (slope) dof for displacement direction 0 </span></div>
<div class="line"> wall_mesh_pt()-&gt;boundary_node_pt(b,0)-&gt;pin_position(1,0);</div>
</div><!-- fragment --><p> Next, we complete the build of the fluid elements by passing pointers to the relevant physical parameters to the elements and pinning any redundant pressure degrees of freedom; see <a href="../../../navier_stokes/adaptive_driven_cavity/html/index.html">another tutorial</a> for details.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Complete build of fluid elements</span></div>
<div class="line"> <span class="comment">//---------------------------------</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element = Fluid_mesh_pt-&gt;nelement();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over the elements to set up element-specific </span></div>
<div class="line"> <span class="comment">// things that cannot be handled by constructor</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Upcast from GeneralisedElement to the present element</span></div>
<div class="line">   ELEMENT* el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(Fluid_mesh_pt-&gt;element_pt(e));</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Set the Reynolds number</span></div>
<div class="line">   el_pt-&gt;re_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a>;</div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Set the Womersley number</span></div>
<div class="line">   el_pt-&gt;re_st_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#a085ee4bf968ffdd01a41b8c41864f907">Global_Physical_Variables::ReSt</a>;</div>
<div class="line">      </div>
<div class="line">  }<span class="comment">// end loop over elements</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin redudant pressure dofs</span></div>
<div class="line"> RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">  pin_redundant_nodal_pressures(Fluid_mesh_pt-&gt;element_pt());</div>
</div><!-- fragment --><p> When completing the build of the wall elements we use the function <code>enable_fluid_loading_on_both_sides()</code> to indicate that the leaflet is completely immersed in the fluid so that fluid tractions act on both of its faces. When setting up the fluid-structure interaction below, one of the two faces will have to be identified as the "front" (face 0) and the other one as the "back" (face 1). The function <code>normal_points_into_fluid()</code> allows us to indicate if the outer unit normal on the leaflet (as computed by <code>FSIHermiteBeamElement::get_normal(...)</code> points into the fluid, when viewed from the "front" face. Here it does not &ndash; see <a class="el" href="index.html#comm">Further comments</a> for more details on this slightly subtle point).</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Complete build of wall elements</span></div>
<div class="line"> <span class="comment">//--------------------------------</span></div>
<div class="line"> n_element = wall_mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Upcast to the specific element type</span></div>
<div class="line">   FSIHermiteBeamElement *elem_pt = </div>
<div class="line">    <span class="keyword">dynamic_cast&lt;</span>FSIHermiteBeamElement*<span class="keyword">&gt;</span>(wall_mesh_pt()-&gt;element_pt(e));</div>
<div class="line">    </div>
<div class="line">   <span class="comment">// Set physical parameters for each element:</span></div>
<div class="line">   elem_pt-&gt;h_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a>;</div>
<div class="line">    </div>
<div class="line">   <span class="comment">// Function that specifies the load ratios</span></div>
<div class="line">   elem_pt-&gt;q_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#a66cb7ecda9ba0cd72367dd697f154545">Global_Physical_Variables::Q</a>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Set the undeformed shape for each element</span></div>
<div class="line">   elem_pt-&gt;undeformed_beam_pt() = undeformed_wall_pt;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Leaflet is immersed and loaded by fluid on both sides</span></div>
<div class="line">   elem_pt-&gt;enable_fluid_loading_on_both_sides();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// The normal to the leaflet, as computed by the </span></div>
<div class="line">   <span class="comment">// FSIHermiteElements points away from the fluid rather than </span></div>
<div class="line">   <span class="comment">// into the fluid (as assumed by default) when viewed from</span></div>
<div class="line">   <span class="comment">// the &quot;front&quot; (face 0).</span></div>
<div class="line">   elem_pt-&gt;set_normal_pointing_out_of_fluid();</div>
<div class="line"> </div>
<div class="line">  } <span class="comment">// end of loop over elements</span></div>
</div><!-- fragment --><p>We can now set up the fluid structure interaction. The motion of the leaflet determines the fluid velocity of all nodes on boundaries 4 and 5 via the no-slip condition (see the enumeration of the mesh boundaries in the <a href="../../../meshes/mesh_list/html/index.html#channel_with_leaflet"><code>ChannelWithLeafletMesh</code></a>). The fluid velocity at these nodes can be updated automatically whenever a fluid node is moved (by the fluid mesh's node-update function) by specifying an auxiliary node update function.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup FSI</span></div>
<div class="line"> <span class="comment">//----------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// The velocity of the fluid nodes on the wall (fluid mesh boundary 4,5)</span></div>
<div class="line"> <span class="comment">// is set by the wall motion -- hence the no-slip condition must be</span></div>
<div class="line"> <span class="comment">// re-applied whenever a node update is performed for these nodes. </span></div>
<div class="line"> <span class="comment">// Such tasks may be performed automatically by the auxiliary node update </span></div>
<div class="line"> <span class="comment">// function specified by a function pointer:</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=4;ibound&lt;6;ibound++ )</div>
<div class="line">  { </div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {   </div>
<div class="line">     Fluid_mesh_pt-&gt;boundary_node_pt(ibound, inod)-&gt;</div>
<div class="line">      set_auxiliary_node_update_fct_pt(</div>
<div class="line">       FSI_functions::apply_no_slip_on_moving_wall);</div>
<div class="line">    }</div>
<div class="line">  }<span class="comment">// aux node update fct has been set</span></div>
</div><!-- fragment --><p> Finally, we have to determine which fluid elements are adjacent to the two faces of the <code>FSIHermiteBeamElements</code> to allow them to compute the fluid traction they are exposed to. This is done separately for the "front" and "back" faces. The "front" of the leaflet (face 0) is assumed to coincide with the fluid mesh boundary 4; the "back" (face 1) is assumed to coincide with the fluid mesh boundary 5.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Work out which fluid dofs affect the residuals of the wall elements:</span></div>
<div class="line"> <span class="comment">// We pass the boundary between the fluid and solid meshes and </span></div>
<div class="line"> <span class="comment">// pointers to the meshes. The interaction boundary is boundary 4 and 5</span></div>
<div class="line"> <span class="comment">// of the 2D fluid mesh.</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Front of leaflet: Set face=0 (which is also the default so this argument</span></div>
<div class="line"> <span class="comment">// could be omitted)</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> face=0; </div>
<div class="line"> FSI_functions::setup_fluid_load_info_for_solid_elements&lt;ELEMENT,2&gt;</div>
<div class="line">  (<span class="keyword">this</span>,4,Fluid_mesh_pt,Wall_mesh_pt,face); </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Back of leaflet: face 1, needs to be specified explicitly</span></div>
<div class="line"> face=1; </div>
<div class="line"> FSI_functions::setup_fluid_load_info_for_solid_elements&lt;ELEMENT,2&gt;</div>
<div class="line">  (<span class="keyword">this</span>,5,Fluid_mesh_pt,Wall_mesh_pt,face); </div>
</div><!-- fragment --><p>Following the setup of the fluid-structure interaction we assign the equation numbers:</p>
<div class="fragment"><div class="line"> <span class="comment">// Setup equation numbering scheme</span></div>
<div class="line"> cout &lt;&lt;<span class="stringliteral">&quot;Number of equations: &quot;</span> &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl; </div>
<div class="line">}<span class="comment">//end of constructor</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="adapt"></a>
Actions after the mesh adaptation</h1>
<p>Once the fluid mesh has been adapted we free all pressure degrees of freedom and then (re-)pin any redundant ones; see the discussion in <a href="../../../navier_stokes/adaptive_driven_cavity/html/index.html">another tutorial</a> for details.</p>
<div class="fragment"><div class="line"><span class="comment">//==== start_of_actions_after_adapt=================================</span></div>
<div class="line"><span class="comment">/// Actions_after_adapt()</span></div>
<div class="line"><span class="comment"></span><span class="comment">//==================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classFSIChannelWithLeafletProblem.html#acc3f4745ea9b4524aebbc4f2556d1286">FSIChannelWithLeafletProblem&lt;ELEMENT&gt;::actions_after_adapt</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Unpin all pressure dofs</span></div>
<div class="line"> RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">  unpin_all_pressure_dofs(Fluid_mesh_pt-&gt;element_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin redundant pressure dofs</span></div>
<div class="line"> RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">  pin_redundant_nodal_pressures(Fluid_mesh_pt-&gt;element_pt());</div>
</div><!-- fragment --><p> Any newly created fluid nodes on the leaflet (i.e. on the fluid mesh boundaries 4 and 5) must be subjected to the automatic application of the no-slip condition. For simplicity we (re-)specify the auxiliary node update function pointer for all of the nodes on those boundaries.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// (Re-)apply the no slip condition on the moving wall</span></div>
<div class="line"> <span class="comment">//-----------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// The velocity of the fluid nodes on the wall (fluid mesh boundary 4,5)</span></div>
<div class="line"> <span class="comment">// is set by the wall motion -- hence the no-slip condition must be</span></div>
<div class="line"> <span class="comment">// re-applied whenever a node update is performed for these nodes. </span></div>
<div class="line"> <span class="comment">// Such tasks may be performed automatically by the auxiliary node update </span></div>
<div class="line"> <span class="comment">// function specified by a function pointer:</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=4;ibound&lt;6;ibound++ )</div>
<div class="line">  { </div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {   </div>
<div class="line">     Fluid_mesh_pt-&gt;boundary_node_pt(ibound, inod)-&gt;</div>
<div class="line">      set_auxiliary_node_update_fct_pt(</div>
<div class="line">       FSI_functions::apply_no_slip_on_moving_wall);</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// aux node update fct has been (re-)set</span></div>
</div><!-- fragment --><p> Finally, the adaptation of the fluid mesh may change the fluid elements that are adjacent to the wall elements so we re-generate the corresponding FSI lookup schemes.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Re-setup FSI</span></div>
<div class="line"> <span class="comment">//-------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Work out which fluid dofs affect the residuals of the wall elements:</span></div>
<div class="line"> <span class="comment">// We pass the boundary between the fluid and solid meshes and </span></div>
<div class="line"> <span class="comment">// pointers to the meshes. The interaction boundary is boundary 4 and 5</span></div>
<div class="line"> <span class="comment">// of the 2D fluid mesh.</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Front of leaflet: Set face=0 (which is also the default so this argument</span></div>
<div class="line"> <span class="comment">// could be omitted)</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> face=0; </div>
<div class="line"> FSI_functions::setup_fluid_load_info_for_solid_elements&lt;ELEMENT,2&gt;</div>
<div class="line">  (<span class="keyword">this</span>,4,Fluid_mesh_pt,Wall_mesh_pt,face); </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Back of leaflet: face 1, needs to be specified explicitly</span></div>
<div class="line"> face=1; </div>
<div class="line"> FSI_functions::setup_fluid_load_info_for_solid_elements&lt;ELEMENT,2&gt;</div>
<div class="line">  (<span class="keyword">this</span>,5,Fluid_mesh_pt,Wall_mesh_pt,face); </div>
<div class="line">  </div>
<div class="line">} <span class="comment">// end_of_actions_after_adapt</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="doc"></a>
Post Processing</h1>
<p>The function <code>doc_solution(...)</code> documents the results. We output the fluid and solid meshes and document selected additional quantities in the trace file.</p>
<div class="fragment"><div class="line"><span class="comment">//==start_of_doc_solution=================================================</span></div>
<div class="line"><span class="comment">/// Doc the solution</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classFSIChannelWithLeafletProblem.html#a055f124f38dca43bc3ed36b80c5c0880">FSIChannelWithLeafletProblem&lt;ELEMENT&gt;::doc_solution</a>(DocInfo&amp; doc_info,</div>
<div class="line">                                                         ofstream&amp; trace)</div>
<div class="line">{ </div>
<div class="line"> ofstream some_file;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of plot points</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> npts;</div>
<div class="line"> npts=5; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output fluid solution </span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> Fluid_mesh_pt-&gt;output(some_file,npts);</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output wall solution </span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/wall_soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> Wall_mesh_pt-&gt;output(some_file,npts);</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Get node at tip of leaflet</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_el_wall=Wall_mesh_pt-&gt;nelement();</div>
<div class="line"> Node* tip_node_pt=Wall_mesh_pt-&gt;finite_element_pt(n_el_wall-1)-&gt;node_pt(1);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Get time:</span></div>
<div class="line"> <span class="keywordtype">double</span> time=time_pt()-&gt;time();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Write trace file</span></div>
<div class="line"> trace &lt;&lt; time &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">       &lt;&lt; <a class="code" href="namespaceGlobal__Physical__Variables.html#ad651484fe06209606bccefe6fe23be0c">Global_Physical_Variables::flux</a>(time) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">       &lt;&lt; tip_node_pt-&gt;x(0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">       &lt;&lt; tip_node_pt-&gt;x(1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">       &lt;&lt; tip_node_pt-&gt;dposition_dt(0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">       &lt;&lt; tip_node_pt-&gt;dposition_dt(1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">       &lt;&lt; doc_info.number() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">       &lt;&lt; std::endl;</div>
</div><!-- fragment --><p> The remaining output is created to determine which elements are located next to the fluid mesh boundaries 4 and 5 (Yes, <a href="../../../meshes/mesh_list/html/index.html#channel_with_leaflet">the documentation for the mesh</a> illustrates the enumeration of the mesh boundaries but we generally prefer to be paranoid; see <a class="el" href="index.html#comm">Further comments</a> ), and to establish the direction of the unit normal on the beam.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Help me figure out what the &quot;front&quot; and &quot;back&quot; faces of the leaflet are</span></div>
<div class="line"> <span class="comment">//------------------------------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output fluid elements on fluid mesh boundary 4 (associated with</span></div>
<div class="line"> <span class="comment">// the &quot;front&quot;)</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> bound=4;</div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/fluid_boundary_elements_front_%i.dat&quot;</span>,</div>
<div class="line">         doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> <span class="keywordtype">unsigned</span> nel= Fluid_mesh_pt-&gt;nboundary_element(bound);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e=0;e&lt;nel;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(Fluid_mesh_pt-&gt;boundary_element_pt(bound,e))</div>
<div class="line">    -&gt;output(some_file,npts);</div>
<div class="line">  }</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output fluid elements on fluid mesh boundary 5 (associated with</span></div>
<div class="line"> <span class="comment">// the &quot;back&quot;)</span></div>
<div class="line"> bound=5;</div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/fluid_boundary_elements_back_%i.dat&quot;</span>,</div>
<div class="line">         doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> nel= Fluid_mesh_pt-&gt;nboundary_element(bound);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e=0;e&lt;nel;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(Fluid_mesh_pt-&gt;boundary_element_pt(bound,e))</div>
<div class="line">    -&gt;output(some_file,npts);</div>
<div class="line">  }</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output normal vector on wall elements</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/wall_normal_%i.dat&quot;</span>,</div>
<div class="line">         doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> nel=Wall_mesh_pt-&gt;nelement();</div>
<div class="line"> Vector&lt;double&gt; s(1);</div>
<div class="line"> Vector&lt;double&gt; x(2);</div>
<div class="line"> Vector&lt;double&gt; xi(1);</div>
<div class="line"> Vector&lt;double&gt; N(2);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e=0;e&lt;nel;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Get pointer to element</span></div>
<div class="line">   FSIHermiteBeamElement* el_pt=</div>
<div class="line">    <span class="keyword">dynamic_cast&lt;</span>FSIHermiteBeamElement*<span class="keyword">&gt;</span>(Wall_mesh_pt-&gt;element_pt(e));</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Loop over plot points</span></div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;npts;i++)</div>
<div class="line">    {</div>
<div class="line">     s[0]=-1.0+2.0*double(i)/double(npts-1);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Get Eulerian position</span></div>
<div class="line">     el_pt-&gt;interpolated_x(s,x);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Get unit normal</span></div>
<div class="line">     el_pt-&gt;get_normal(s,N);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Get Lagrangian coordinate</span></div>
<div class="line">     el_pt-&gt;interpolated_xi(s,xi);</div>
<div class="line">     </div>
<div class="line">     some_file &lt;&lt; x[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; x[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">               &lt;&lt; N[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; N[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">               &lt;&lt; xi[0] &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end_of_doc_solution</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="comm_ex"></a>
Further comments and exercises</h1>
<h2><a class="anchor" id="comm"></a>
Further comments</h2>
<ol type="1">
<li><b>How does one identify the "front" and "back" of an immersed beam structure?</b> <br  />
<br  />
 When setting up the fluid-structure interaction in the <a class="el" href="index.html#constructor">The problem constructor</a> we had to associate the fluid mesh boundaries 4 and 5 (the boundaries adjacent to the leaflet (see the enumeration of the mesh boundaries in the <a href="../../../meshes/mesh_list/html/index.html#channel_with_leaflet"><code>ChannelWithLeafletMesh</code></a>) with the "front" and "back" of the fully immersed beam structure. Furthermore, since the computation of the fluid traction acting on the leaflet depends on the direction of the normal, and the normal on the "front" of the leaflet points in the opposite direction to that on its "back" it is important to assess which normal is used in the automatic computation of the fluid traction. There are two ways of establishing this: <br  />
<br  />
<ol type="a">
<li><b>Quick and dirty:</b> <br  />
 Set <code>FSIHermiteBeamElement::normal_points_into_fluid()</code> to <code>true</code> and perform a steady computation. If the leaflet is sucked towards the high-pressure region you got it wrong. <br  />
<br  />
</li>
<li><b>Do it properly:</b> <br  />
 Use the output generated in <code>doc_solution(...)</code> to identify the elements adjacent to the fluid mesh boundaries 4 and 5 (i.e. the fluid elements next to the leaflet's "front" and "back" faces), respectively, and the normal vector returned by <code>FSIHermiteBeamElement::get_normal(...)</code> &ndash; this is the normal that is used in the computation of the fluid traction. The figure below shows a plot of these within an adaptively refined fluid mesh. <br  />
<br  />
<div class="image">
<img src="front_and_back.gif" alt=""/>
<div class="caption">
Elements near the `front' (red) and `back' (green) of the leaflet and the outer unit normal on the leaflet. </div></div>
  The red and green elements are the fluid elements adjacent to the fluid mesh boundaries 4 and 5 (i.e. the "front" and "back" of the leaflet), respectively. The normal vectors (shown in blue) point towards the upstream end of the channel so they point <em>away</em> <em>from</em> (rather than <em>into</em>) the fluid that is adjacent to the "front" (the red region). This is why we set <code>FSIHermiteBeamElement::normal_points_into_fluid()=false</code> (Admittedly, we used the former method to get this right and only documented the proper way to do it when writing this tutorial...) <br  />
<br  />
</li>
</ol>
</li>
<li><b>Use of faster solvers: <code>oomph-lib's</code> FSI preconditioner</b> <br  />
<br  />
 The problem presented in this tutorial was used as one of the test cases for <code>oomph-lib's</code> FSI preconditioner; see <br  />
<br  />
 <center> <a href="http://www.maths.man.ac.uk/~mheil/oomph_lib_additional_material/HeilHazelBoyleCompMech/HeilHazelBoyleCompMech.pdf">Heil, M., Hazel, A.L. &amp; Boyle, J. (2008): Solvers for large-displacement fluid-structure interaction problems: Segregated vs. monolithic approaches. Computational Mechanics.</a> </center> <br  />
<br  />
 The use of this preconditioner (which leads to much faster solution times) is described in another tutorial. However, the required source code is already part of the driver code and has simply been ignored in this tutorial. Feel free to experiment with the preconditioner by modifying <a href="../../../../demo_drivers/interaction/fsi_channel_with_leaflet/fsi_channel_with_leaflet.cc">the source code.</a></li>
</ol>
<h2><a class="anchor" id="ex"></a>
Exercises</h2>
<ol type="1">
<li>Confirm that choosing the wrong value for the flag <br  />
 <code>FSIHermiteBeamElement::normal_points_into_fluid()</code> makes the leaflet move in the wrong direction as it perceives positive fluid tractions as negative ones and vice versa. Here is what you should get: <div class="image">
<img src="normal_points_in_wrong_direction.gif" alt=""/>
<div class="caption">
Deformation of the leaflet with the wrong choice of FSIHermiteBeamElement::normal_points_into_fluid(): The leaflet gets sucked towards the high-pressure region. </div></div>
  Clearly, the normal points in the wrong direction and the tractions have the wrong sign. This can be made "consistent", however, by also swapping the association between the mesh boundaries and the leaflet's faces. I.e. if we associate mesh boundary 5 with the "front" via <br  />
<br  />
<div class="fragment"><div class="line"><span class="comment">// Front of leaflet: face 0</span></div>
<div class="line">face=0; </div>
<div class="line">FSI_functions::setup_fluid_load_info_for_solid_elements&lt;ELEMENT,2&gt;</div>
<div class="line"> (<span class="keyword">this</span>,5,Fluid_mesh_pt,Wall_mesh_pt,face); </div>
</div><!-- fragment --> <br  />
 and mesh boundary 4 with the "back" via <br  />
<br  />
<div class="fragment"><div class="line"><span class="comment">// Back of leaflet: face 1</span></div>
<div class="line">face=1; </div>
<div class="line">FSI_functions::setup_fluid_load_info_for_solid_elements&lt;ELEMENT,2&gt;</div>
<div class="line"> (<span class="keyword">this</span>,4,Fluid_mesh_pt,Wall_mesh_pt,face); </div>
</div><!-- fragment --> <br  />
 the code gives the right results again (make sure you change the code in the problem constructor and in the actions after adaptation!) &ndash; sometimes two wrongs do cancel each other out! <br  />
<br  />
</li>
<li><a href="../figures/fsi_channel_with_leaflet_flow.avi">The animation</a> of the flow field shows that the outflow boundary condition is applied "too close" to the leaflet: in the relatively short domain chosen here, the outflow is far from fully developed and as a result the imposition of a parallel flow leads to the development of a artificial outflow boundary layer. <br  />
<br  />
<div class="image">
<img src="outflow_bl.gif" alt=""/>
<div class="caption">
Artificial outflow boundary layer. </div></div>
  Confirm that an increase in the downstream length of the domain (or a reduction in the Reynolds number) improves the situation. <br  />
<br  />
</li>
<li>The algebraic node-update technique employed in the <a href="../../../meshes/mesh_list/html/index.html#channel_with_leaflet"><code>ChannelWithLeafletMesh</code></a> forces <em>all</em> fluid nodes to move when the leaflet deforms. An increase in the downstream length of the fluid domain therefore leads to a significant increase in computational cost. Use the improved node-update technique suggested in the <a href="../../../navier_stokes/channel_with_leaflet/html/index.html#ex">corresponding Navier-Stokes example</a> (only move the nodes in the vicinity of the leaflet) to improve the efficiency of the code.</li>
</ol>
<hr  />
 <hr  />
 <h1><a class="anchor" id="ackn"></a>
Acknowledgements</h1>
<ul>
<li>This code was originally developed by Floraine Cordier.</li>
</ul>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory:<br  />
<br  />
<center> <a href="
../../../../
demo_drivers/interaction/fsi_channel_with_leaflet/
">demo_drivers/interaction/fsi_channel_with_leaflet/ </a> </center><br  />
</li>
<li>The driver code is: <br  />
<br  />
<center> <a href="
../../../../
demo_drivers/interaction/fsi_channel_with_leaflet/fsi_channel_with_leaflet.cc
">demo_drivers/interaction/fsi_channel_with_leaflet/fsi_channel_with_leaflet.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:30:46
        </div>
      </div>
    </footer>
</body>
</html>
