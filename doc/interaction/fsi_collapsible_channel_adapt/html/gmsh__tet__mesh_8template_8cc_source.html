<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: gmsh_tet_mesh.template.cc Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_6c67e72d2f29709d1e2582429aa24112.html">meshes</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">gmsh_tet_mesh.template.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="gmsh__tet__mesh_8template_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// LIC// ====================================================================</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// LIC// This file forms part of oomph-lib, the object-oriented,</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// LIC// multi-physics finite-element library, available</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// LIC// at http://www.oomph-lib.org.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// LIC//</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// LIC// Copyright (C) 2006-2021 Matthias Heil and Andrew Hazel</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// LIC//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// LIC// This library is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// LIC// modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// LIC// License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// LIC// version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// LIC//</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// LIC// This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// LIC// Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// LIC//</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// LIC// You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// LIC// License along with this library; if not, write to the Free Software</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// LIC// 02110-1301  USA.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// LIC//</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// LIC// The authors may be contacted at oomph-lib@maths.man.ac.uk.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// LIC//</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// LIC//====================================================================</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#ifndef OOMPH_GMSH_TET_MESH_TEMPLATE_CC</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#define OOMPH_GMSH_TET_MESH_TEMPLATE_CC</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gmsh__tet__mesh_8template_8h.html">gmsh_tet_mesh.template.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceoomph.html">oomph</a></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">//======================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">  /// Adapt problem based on specified elemental error estimates</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"></span>  <span class="comment">//======================================================================</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="classoomph_1_1RefineableGmshTetMesh.html#ad3ee00690d125ab8211f64d5c85dd3b9">   40</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1RefineableGmshTetMesh.html#ad3ee00690d125ab8211f64d5c85dd3b9">RefineableGmshTetMesh&lt;ELEMENT&gt;::adapt</a>(<span class="keyword">const</span> Vector&lt;double&gt;&amp; elem_error)</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordtype">double</span> t_start = 0.0;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">//###################################</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    t_start = TimingHelpers::timer();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">//###################################</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// Get refinement targets</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    Vector&lt;double&gt; target_size(elem_error.size());</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordtype">double</span> max_edge_ratio =</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      this-&gt;compute_volume_target(elem_error, target_size);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// Get maximum target volume</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordtype">unsigned</span> n = target_size.size();</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordtype">double</span> max_size = 0.0;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordtype">double</span> min_size = DBL_MAX;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e = 0; e &lt; n; e++)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <span class="keywordflow">if</span> (target_size[e] &gt; max_size) max_size = target_size[e];</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">if</span> (target_size[e] &lt; min_size) min_size = target_size[e];</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    }</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    oomph_info &lt;&lt; <span class="stringliteral">&quot;Maximum target size: &quot;</span> &lt;&lt; max_size &lt;&lt; std::endl;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    oomph_info &lt;&lt; <span class="stringliteral">&quot;Minimum target size: &quot;</span> &lt;&lt; min_size &lt;&lt; std::endl;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    oomph_info &lt;&lt; <span class="stringliteral">&quot;Number of elements to be refined &quot;</span> &lt;&lt; this-&gt;Nrefined</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;               &lt;&lt; std::endl;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    oomph_info &lt;&lt; <span class="stringliteral">&quot;Number of elements to be unrefined &quot;</span> &lt;&lt; this-&gt;Nunrefined</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;               &lt;&lt; std::endl;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    oomph_info &lt;&lt; <span class="stringliteral">&quot;Max edge ratio &quot;</span> &lt;&lt; max_edge_ratio &lt;&lt; std::endl;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">double</span> orig_max_size, orig_min_size;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    this-&gt;max_and_min_element_size(orig_max_size, orig_min_size);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    oomph_info &lt;&lt; <span class="stringliteral">&quot;Max/min element size in original mesh: &quot;</span> &lt;&lt; orig_max_size</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; orig_min_size &lt;&lt; std::endl;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">//##################################################################</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    oomph_info</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;adapt: Time for getting volume targets                      : &quot;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      &lt;&lt; TimingHelpers::timer() - t_start &lt;&lt; <span class="stringliteral">&quot; sec &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">//##################################################################</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// Should we bother to adapt?</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span> ((Nrefined &gt; 0) || (Nunrefined &gt; this-&gt;max_keep_unrefined()) ||</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        (max_edge_ratio &gt; this-&gt;max_permitted_edge_ratio()))</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keywordflow">if</span> (!((Nrefined &gt; 0) || (Nunrefined &gt; max_keep_unrefined())))</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        oomph_info &lt;&lt; <span class="stringliteral">&quot;Mesh regeneration triggered by edge ratio criterion\n&quot;</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="comment">// Are we dealing with a solid mesh?</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      SolidMesh* solid_mesh_pt = <span class="keyword">dynamic_cast&lt;</span>SolidMesh*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="comment">// If the mesh is a solid mesh then do the mapping based on the</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="comment">// Eulerian coordinates</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="keywordtype">bool</span> use_eulerian_coords = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keywordflow">if</span> (solid_mesh_pt != 0)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        use_eulerian_coords = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      MeshAsGeomObject* mesh_geom_obj_pt = 0;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_CGAL</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="comment">// Make cgal-based bin</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      CGALSamplePointContainerParameters cgal_params(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">if</span> (use_eulerian_coords)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        cgal_params.enable_use_eulerian_coordinates_during_setup();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      mesh_geom_obj_pt = <span class="keyword">new</span> MeshAsGeomObject(&amp;cgal_params);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      std::ostringstream error_message;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      error_message &lt;&lt; <span class="stringliteral">&quot;Non-CGAL-based target size transfer not implemented.\n&quot;</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="keywordflow">throw</span> OomphLibError(</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        error_message.str(), OOMPH_CURRENT_FUNCTION, OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">// Do something here...</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="comment">// Set up a map from pointer to element to its number</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="comment">// in the mesh</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      std::map&lt;GeneralisedElement*, unsigned&gt; element_number;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordtype">unsigned</span> nelem = this-&gt;nelement();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e = 0; e &lt; nelem; e++)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        element_number[this-&gt;element_pt(e)] = e;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">// Get min/max coordinates</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      Vector&lt;std::pair&lt;double, double&gt;&gt; min_and_max_coordinates =</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        mesh_geom_obj_pt-&gt;sample_point_container_pt()</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;          -&gt;min_and_max_coordinates();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">// Setup grid dimensions for size transfer</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keywordtype">double</span> dx =</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        (min_and_max_coordinates[0].second - min_and_max_coordinates[0].first);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="keywordtype">double</span> dy =</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        (min_and_max_coordinates[1].second - min_and_max_coordinates[1].first);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordtype">double</span> dz =</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        (min_and_max_coordinates[2].second - min_and_max_coordinates[2].first);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordtype">double</span> dx_target =</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        this-&gt;Gmsh_parameters_pt-&gt;dx_for_target_size_transfer();</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keywordtype">unsigned</span> nx = unsigned(dx / dx_target);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordtype">unsigned</span> ny = unsigned(dy / dx_target);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keywordtype">unsigned</span> nz = unsigned(dz / dx_target);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      dx /= double(nx);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      dy /= double(ny);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      dz /= double(nz);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">// Size transfer via hard disk -- yikes...</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      std::string target_size_file_name =</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        this-&gt;Gmsh_parameters_pt-&gt;target_size_file_name();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      std::ofstream target_size_file;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      target_size_file.open(target_size_file_name.c_str());</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      target_size_file &lt;&lt; min_and_max_coordinates[0].first &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                       &lt;&lt; min_and_max_coordinates[1].first &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                       &lt;&lt; min_and_max_coordinates[2].first &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      target_size_file &lt;&lt; dx &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; dy &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; dz &lt;&lt; std::endl;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      target_size_file &lt;&lt; nx + 1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; ny + 1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nz + 1 &lt;&lt; std::endl;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="comment">// Doc target areas</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordtype">int</span> counter =</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        this-&gt;Gmsh_parameters_pt-&gt;counter_for_filename_gmsh_size_transfer();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      std::string stem =</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        this-&gt;Gmsh_parameters_pt-&gt;stem_for_filename_gmsh_size_transfer();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      std::ofstream latest_sizes_file;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordtype">bool</span> doc_target_areas = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> ((stem != <span class="stringliteral">&quot;&quot;</span>) &amp;&amp; (counter &gt;= 0))</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        doc_target_areas = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        std::string filename =</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          stem + oomph::StringConversion::to_string(counter) + <span class="stringliteral">&quot;.dat&quot;</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        latest_sizes_file.open(filename.c_str());</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        latest_sizes_file &lt;&lt; <span class="stringliteral">&quot;ZONE I=&quot;</span> &lt;&lt; nx + 1 &lt;&lt; <span class="stringliteral">&quot;, J=&quot;</span> &lt;&lt; ny + 1</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;, K=&quot;</span> &lt;&lt; nz + 1 &lt;&lt; std::endl;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        this-&gt;Gmsh_parameters_pt-&gt;counter_for_filename_gmsh_size_transfer()++;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      Vector&lt;double&gt; x(3);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt;= nx; i++)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        x[0] = min_and_max_coordinates[0].first + double(i) * dx;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt;= ny; j++)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;          x[1] = min_and_max_coordinates[1].first + double(j) * dy;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0; k &lt;= nz; k++)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            x[2] = min_and_max_coordinates[2].first + double(k) * dz;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="comment">// Try the specified number of nearest sample points for Newton</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="comment">// search then just settle on the nearest one</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            Vector&lt;double&gt; <a class="code" href="fsi__collapsible__channel__adapt_8txt.html#abe1a872647b7cfc1c732b57adef7d1b9">s</a>(3);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <a class="code" href="fsi__collapsible__channel__adapt_8txt.html#a9c6741891789e8156d85c39d4e3adaa7">GeomObject</a>* geom_obj_pt = 0;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordtype">unsigned</span> max_sample_points =</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;              this-&gt;Gmsh_parameters_pt</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                -&gt;max_sample_points_for_limited_locate_zeta_during_target_size_transfer();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor">#ifdef OOMPH_HAS_CGAL</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keyword">dynamic_cast&lt;</span>CGALSamplePointContainer*<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;              mesh_geom_obj_pt-&gt;sample_point_container_pt())</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;              -&gt;limited_locate_zeta(x, max_sample_points, geom_obj_pt, <a class="code" href="fsi__collapsible__channel__adapt_8txt.html#abe1a872647b7cfc1c732b57adef7d1b9">s</a>);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            std::ostringstream error_message;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            error_message</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Non-CGAL-based target size transfer not implemented.\n&quot;</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                OOMPH_CURRENT_FUNCTION,</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="comment">// Do something here...</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">if</span> (geom_obj_pt == 0)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;              std::stringstream error_message;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;              error_message &lt;&lt; <span class="stringliteral">&quot;Limited locate zeta failed for zeta = [ &quot;</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                            &lt;&lt; x[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; x[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; x[2]</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot; ]. Makes no sense!\n&quot;</span>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;              <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                  OOMPH_CURRENT_FUNCTION,</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                  OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;              FiniteElement* fe_pt = <span class="keyword">dynamic_cast&lt;</span>FiniteElement*<span class="keyword">&gt;</span>(geom_obj_pt);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;              <span class="keywordflow">if</span> (fe_pt == 0)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;              {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                std::stringstream error_message;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                error_message</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;Cast to FE for GeomObject returned by limited &quot;</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;locate zeta failed for zeta = [ &quot;</span> &lt;&lt; x[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; x[1]</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; x[2] &lt;&lt; <span class="stringliteral">&quot; ]. Makes no sense!\n&quot;</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                    OOMPH_CURRENT_FUNCTION,</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                    OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;              }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;              {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <span class="comment">// What&#39;s the target size of the element that contains this</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="comment">// point</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                <span class="keywordtype">double</span> tg_size =</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                  pow(target_size[element_number[fe_pt]], 1.0 / 3.0);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                target_size_file &lt;&lt; tg_size &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="comment">// Doc?</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                <span class="keywordflow">if</span> (doc_target_areas)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                  latest_sizes_file &lt;&lt; x[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; x[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; x[2] &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                    &lt;&lt; tg_size &lt;&lt; std::endl;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">#ifdef PARANOID</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;              }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;          target_size_file &lt;&lt; std::endl;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      target_size_file.close();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keywordflow">if</span> (doc_target_areas)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        latest_sizes_file.close();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">// Build new mesh, reading area information from file</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordtype">bool</span> use_mesh_grading_from_file = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <a class="code" href="classoomph_1_1RefineableGmshTetMesh.html">RefineableGmshTetMesh&lt;ELEMENT&gt;</a>* new_mesh_pt =</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keyword">new</span> <a class="code" href="classoomph_1_1RefineableGmshTetMesh.html">RefineableGmshTetMesh&lt;ELEMENT&gt;</a>(this-&gt;Gmsh_parameters_pt,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                           use_mesh_grading_from_file,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                           this-&gt;Time_stepper_pt);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="comment">/* // keep around for debugging */</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="comment">/* unsigned nplot=5; */</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="comment">/* ofstream vtu_file; */</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="comment">/* vtu_file.open(&quot;new_mesh.vtu&quot;); */</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="comment">/* new_mesh_pt-&gt;output_paraview(vtu_file,nplot); */</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="comment">/* vtu_file.close(); */</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">//###################################</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      t_start = TimingHelpers::timer();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="comment">//###################################</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      ProjectionProblem&lt;ELEMENT&gt;* project_problem_pt = 0;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="comment">// Check that the projection step is not disabled</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">if</span> (!this-&gt;Gmsh_parameters_pt-&gt;projection_is_disabled())</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">// Project current solution onto new mesh</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="comment">//---------------------------------------</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        project_problem_pt = <span class="keyword">new</span> ProjectionProblem&lt;ELEMENT&gt;;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        project_problem_pt-&gt;mesh_pt() = new_mesh_pt;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        project_problem_pt-&gt;project(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        oomph_info</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;adapt: Time for project soln onto new mesh                : &quot;</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;          &lt;&lt; TimingHelpers::timer() - t_start &lt;&lt; <span class="stringliteral">&quot; sec &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="comment">//###################################</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      t_start = TimingHelpers::timer();</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="comment">//###################################</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="comment">// Flush the old mesh</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordtype">unsigned</span> nnod = nnode();</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = nnod; j &gt; 0; j--)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keyword">delete</span> Node_pt[j - 1];</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        Node_pt[j - 1] = 0;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keywordtype">unsigned</span> nel = nelement();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e = nel; e &gt; 0; e--)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keyword">delete</span> Element_pt[e - 1];</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        Element_pt[e - 1] = 0;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="comment">// Now copy back to current mesh</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="comment">//------------------------------</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      nnod = new_mesh_pt-&gt;nnode();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      Node_pt.resize(nnod);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      nel = new_mesh_pt-&gt;nelement();</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      Element_pt.resize(nel);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; nnod; j++)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        Node_pt[j] = new_mesh_pt-&gt;node_pt(j);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e = 0; e &lt; nel; e++)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        Element_pt[e] = new_mesh_pt-&gt;element_pt(e);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="comment">// Copy the boundary schemes</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="keywordtype">unsigned</span> nbound = new_mesh_pt-&gt;nboundary();</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      Boundary_element_pt.resize(nbound);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      Face_index_at_boundary.resize(nbound);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      Boundary_node_pt.resize(nbound);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> b = 0; b &lt; nbound; b++)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordtype">unsigned</span> nel = new_mesh_pt-&gt;nboundary_element(b);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        Boundary_element_pt[b].resize(nel);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        Face_index_at_boundary[b].resize(nel);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e = 0; e &lt; nel; e++)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;          Boundary_element_pt[b][e] = new_mesh_pt-&gt;boundary_element_pt(b, e);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;          Face_index_at_boundary[b][e] =</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            new_mesh_pt-&gt;face_index_at_boundary(b, e);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordtype">unsigned</span> nnod = new_mesh_pt-&gt;nboundary_node(b);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        Boundary_node_pt[b].resize(nnod);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; nnod; j++)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          Boundary_node_pt[b][j] = new_mesh_pt-&gt;boundary_node_pt(b, j);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="comment">// Also copy over the new boundary and region information</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordtype">unsigned</span> n_region = new_mesh_pt-&gt;nregion();</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="comment">// Only bother if we have regions</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">if</span> (n_region &gt; 1)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="comment">// Deal with the region information first</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        this-&gt;Region_element_pt.resize(n_region);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        this-&gt;Region_attribute.resize(n_region);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; n_region; i++)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          <span class="comment">// Copy across region attributes (region ids!)</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          this-&gt;Region_attribute[i] = new_mesh_pt-&gt;region_attribute(i);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;          <span class="comment">// Find the number of elements in the region</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          <span class="keywordtype">unsigned</span> r = this-&gt;Region_attribute[i];</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          <span class="keywordtype">unsigned</span> n_region_element = new_mesh_pt-&gt;nregion_element(r);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;          this-&gt;Region_element_pt[i].resize(n_region_element);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e = 0; e &lt; n_region_element; e++)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;          {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            this-&gt;Region_element_pt[i][e] =</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;              new_mesh_pt-&gt;region_element_pt(r, e);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="comment">// Now the boundary region information</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        this-&gt;Boundary_region_element_pt.resize(nbound);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        this-&gt;Face_index_region_at_boundary.resize(nbound);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment">// Now loop over the boundaries</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> b = 0; b &lt; nbound; ++b)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          <span class="comment">// Loop over the regions</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; n_region; ++i)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;          {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keywordtype">unsigned</span> r = this-&gt;Region_attribute[i];</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordtype">unsigned</span> n_boundary_el_in_region =</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;              new_mesh_pt-&gt;nboundary_element_in_region(b, r);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="keywordflow">if</span> (n_boundary_el_in_region &gt; 0)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;              <span class="comment">// Allocate storage in the map</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;              this-&gt;Boundary_region_element_pt[b][r].resize(</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                n_boundary_el_in_region);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;              this-&gt;Face_index_region_at_boundary[b][r].resize(</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                n_boundary_el_in_region);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;              <span class="comment">// Copy over the information</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e = 0; e &lt; n_boundary_el_in_region; ++e)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;              {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                this-&gt;Boundary_region_element_pt[b][r][e] =</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                  new_mesh_pt-&gt;boundary_element_in_region_pt(b, r, e);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                this-&gt;Face_index_region_at_boundary[b][r][e] =</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                  new_mesh_pt-&gt;face_index_at_boundary_in_region(b, r, e);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;              }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;          }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        } <span class="comment">// End of loop over boundaries</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      } <span class="comment">// End of case when more than one region</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">// Flush the mesh</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      new_mesh_pt-&gt;flush_element_and_node_storage();</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="comment">// Delete the mesh and the problem</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="keyword">delete</span> new_mesh_pt;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="keyword">delete</span> project_problem_pt;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="comment">//##################################################################</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      oomph_info</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;adapt: Time for moving nodes etc. to actual mesh          : &quot;</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        &lt;&lt; TimingHelpers::timer() - t_start &lt;&lt; <span class="stringliteral">&quot; sec &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="comment">//##################################################################</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="comment">// Solid mesh?</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordflow">if</span> (solid_mesh_pt != 0)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="comment">// Warning</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        std::stringstream error_message;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        error_message</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;Lagrangian coordinates are currently not projected but are\n&quot;</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;are re-set during adaptation. This is not appropriate for\n&quot;</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;real solid mechanics problems!\n&quot;</span>;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        OomphLibWarning(error_message.str(),</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                        OOMPH_CURRENT_FUNCTION,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                        OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="comment">// Reset Lagrangian coordinates</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keyword">dynamic_cast&lt;</span>SolidMesh*<span class="keyword">&gt;</span>(<span class="keyword">this</span>)-&gt;set_lagrangian_nodal_coordinates();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordtype">double</span> max_area;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keywordtype">double</span> min_area;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      this-&gt;max_and_min_element_size(max_area, min_area);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      oomph_info &lt;&lt; <span class="stringliteral">&quot;Max/min element size in adapted mesh: &quot;</span> &lt;&lt; max_area &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                 &lt;&lt; min_area &lt;&lt; std::endl;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      oomph_info &lt;&lt; <span class="stringliteral">&quot;Not enough benefit in adaptation.\n&quot;</span>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      Nrefined = 0;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      Nunrefined = 0;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;} <span class="comment">// namespace oomph</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="preprocessor">#endif</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassoomph_1_1RefineableGmshTetMesh_html"><div class="ttname"><a href="classoomph_1_1RefineableGmshTetMesh.html">oomph::RefineableGmshTetMesh</a></div><div class="ttdef"><b>Definition:</b> <a href="gmsh__tet__mesh_8template_8h_source.html#l02283">gmsh_tet_mesh.template.h:2283</a></div></div>
<div class="ttc" id="afsi__collapsible__channel__adapt_8txt_html_a9c6741891789e8156d85c39d4e3adaa7"><div class="ttname"><a href="fsi__collapsible__channel__adapt_8txt.html#a9c6741891789e8156d85c39d4e3adaa7">GeomObject</a></div><div class="ttdeci">this is used if there is only a single node update as in the c AlgebraicCollapsibleChannelMesh n n A vector such as the intrinsic coordinates of reference points on the c GeomObjects n n By we assume that a newly created c AlgebraicNode is updated by the same node update function as the c AlgebraicNodes in its father element Therefore we pass the pointer to the c the node update function and the vector of pointers to c GeomObjects to the newly created c and interpolate the reference values between those stored at the c AlgebraicNodes in the father elements In most cases this provides a sensible default For it is hard to imagine a situation in which it would be sensible to update the position of newly created c AlgebraicNodes by a procedure that differs from that used for the surrounding c AlgebraicNodes that already existed in the father element since the reference values vary from node to in the c AlgebraicCollapsibleChannelMesh one of the reference values is the f x_1 f coordinate of the reference point on the fixed lower wall For the c AlgebraicNodes that already existed in the coarse base this value is given by the the c AlgebraicNodes f x_1 f coordinate in the undeformed mesh Interpolation of this value for the newly created c AlgebraicNodes results in an axially uniform subdivision of the refined elements The same procedure may be used to assign the reference value that represents the intrinsic coordinate of the reference point on the upper wall at least as long as the upper wall is only ever addressed as a compound c GeomObject</div><div class="ttdef"><b>Definition:</b> <a href="fsi__collapsible__channel__adapt_8txt_source.html#l00226">fsi_collapsible_channel_adapt.txt:226</a></div></div>
<div class="ttc" id="anamespaceoomph_html"><div class="ttname"><a href="namespaceoomph.html">oomph</a></div><div class="ttdef"><b>Definition:</b> <a href="annular__domain_8h_source.html#l00034">annular_domain.h:34</a></div></div>
<div class="ttc" id="agmsh__tet__mesh_8template_8h_html"><div class="ttname"><a href="gmsh__tet__mesh_8template_8h.html">gmsh_tet_mesh.template.h</a></div></div>
<div class="ttc" id="aclassoomph_1_1RefineableGmshTetMesh_html_ad3ee00690d125ab8211f64d5c85dd3b9"><div class="ttname"><a href="classoomph_1_1RefineableGmshTetMesh.html#ad3ee00690d125ab8211f64d5c85dd3b9">oomph::RefineableGmshTetMesh::adapt</a></div><div class="ttdeci">void adapt(const Vector&lt; double &gt; &amp;elem_error)</div><div class="ttdoc">Adapt mesh, based on elemental error provided.</div><div class="ttdef"><b>Definition:</b> <a href="gmsh__tet__mesh_8template_8cc_source.html#l00040">gmsh_tet_mesh.template.cc:40</a></div></div>
<div class="ttc" id="afsi__collapsible__channel__adapt_8txt_html_abe1a872647b7cfc1c732b57adef7d1b9"><div class="ttname"><a href="fsi__collapsible__channel__adapt_8txt.html#abe1a872647b7cfc1c732b57adef7d1b9">s</a></div><div class="ttdeci">respectively The red arrow identifies the reference point for the newly created node VI whose reference coordinate f IV and i e the nodes in its father element I w textwidth update_single Illustration of the default update procedure for the node update IV and V in its father element the default assignment is not appropriate for nodes that are updated by and the values of the coordinate at which the reference points are located This is illustrated in the sketch below in which the sub c parametrised by their coordinates f s</div><div class="ttdef"><b>Definition:</b> <a href="fsi__collapsible__channel__adapt_8txt_source.html#l00254">fsi_collapsible_channel_adapt.txt:254</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Fri Aug 27 2021 17:42:16
        </div>
      </div>
    </footer>
</body>
</html>
