<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: Turek &amp; Hron&#39;s FSI benchmark problem</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Demo problem: Turek &amp; Hron's FSI benchmark problem </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this example we consider the flow in a 2D channel past a cylinder with an attached elastic "flag". This is the FSI benchmark problem proposed by Turek &amp; Hron, </p><center> "Proposal for Numerical Benchmarking of Fluid-Structure Interaction between an Elastic Object and a Laminar Incompressible Flow", S. Turek &amp; J. Hron, pp. 371-385. In: 
"Fluid-Structure Interaction" Springer Lecture Notes in Computational Science and Engineering <b>53</b>. Ed. H.-J. Bungartz &amp; M. Schaefer. Springer Verlag 2006. </center><p>The problem combines the two single-physics problems of <br  />
<br  />
</p><ul>
<li><a href="../../../navier_stokes/turek_flag_non_fsi/html/index.html">Flow past a cylinder with a "flag" whose motion is prescribed.</a> <br  />
<br  />
</li>
<li><a href="../../../solid/airy_cantilever/html/index.html">The deformation of a finite-thickness cantilever beam (modelled as a 2D solid), loaded by surface tractions.</a> <br  />
<br  />
</li>
</ul>
<p>This is our first example problem that involves the coupling between a fluid and "proper" solid (rather than beam structure) and also includes both fluid and wall inertia.</p>
<p>The problem presented here was used as one of the test cases for <code>oomph-lib's</code> FSI preconditioner; see <br  />
<br  />
 </p><center> <a href="http://www.maths.man.ac.uk/~mheil/oomph_lib_additional_material/HeilHazelBoyleCompMech/HeilHazelBoyleCompMech.pdf">Heil, M., Hazel, A.L. &amp; Boyle, J. (2008): Solvers for large-displacement fluid-structure interaction problems: Segregated vs. monolithic approaches. Computational Mechanics.</a> </center><p><br  />
<br  />
In this tutorial we concentrate on the problem formulation. The application of the preconditioner is discussed <a href="../../../preconditioners/fsi/html/index.html">elsewhere</a> &ndash; the required source code is contained in the <a href="../../../../demo_drivers/interaction/turek_flag/turek_flag.cc">driver code.</a></p>
<hr  />
 <hr  />
<h1><a class="anchor" id="the_problem"></a>
The Problem</h1>
<p>The figure below shows a sketch of the problem: A 2D channel of height <img class="formulaInl" alt="$ H^*$" src="form_0.png" width="16" height="10"/> and length <img class="formulaInl" alt="$ L^* $" src="form_1.png" width="13" height="10"/> conveys fluid of density <img class="formulaInl" alt="$ \rho_f $" src="form_2.png" width="14" height="10"/> and dynamic viscosity <img class="formulaInl" alt="$ \mu $" src="form_3.png" width="9" height="9"/> and contains a cylinder of diameter <img class="formulaInl" alt="$ d^* $" src="form_4.png" width="11" height="10"/>, centred at <img class="formulaInl" alt="$ (X^*_c, Y^*_c) $" src="form_5.png" width="48" height="14"/> to which a linearly elastic "flag" of thickness <img class="formulaInl" alt="$ H^*_{flag}$" src="form_6.png" width="30" height="16"/> and length <img class="formulaInl" alt="$ L^*_{flag} $" src="form_7.png" width="28" height="16"/> is attached. Steady Poiseuille flow with average velocity <img class="formulaInl" alt="$ U^* $" src="form_8.png" width="15" height="10"/> is imposed at the left end of the channel while we assume the outflow to be parallel and axially traction-free. We model the flag as a linearly elastic Hookean solid with elastic modulus <img class="formulaInl" alt="$ E^* $" src="form_9.png" width="15" height="10"/>, density <img class="formulaInl" alt="$ \rho_s $" src="form_10.png" width="13" height="9"/> and Poisson's ratio <img class="formulaInl" alt="$ \nu. $" src="form_11.png" width="9" height="6"/></p>
<div class="image">
<img src="turek_flag_dim.gif" alt=""/>
<div class="caption">
Sketch of the problem in dimensional variables. </div></div>
 <p>We non-dimensionalise all length and coordinates on the diameter of the cylinder, <img class="formulaInl" alt="$ d^* $" src="form_4.png" width="11" height="10"/>, the velocities on the mean velocity, <img class="formulaInl" alt="$ U^* $" src="form_8.png" width="15" height="10"/>, and the fluid pressure on the viscous scale. To facilitate comparisons with Turek &amp; Hron's dimensional benchmark data (particularly for the period of the self-excited oscillations), we use a timescale of <img class="formulaInl" alt="$ T^* = 1 \ \mbox{sec} $" src="form_12.png" width="59" height="10"/> to non-dimensionalise time. The fluid flow is then governed by the non-dimensional Navier-Stokes equations </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re \left( St \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} \right) = - \frac{\partial p}{\partial x_i} + \frac{\partial }{\partial x_j} \left[ \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right) \right], \]" src="form_13.png" width="306" height="31"/>
</p>
<p> where <img class="formulaInl" alt="$ Re = \rho U^* H_0^* / \mu $" src="form_14.png" width="85" height="14"/> and <img class="formulaInl" alt="$ St = d^* / (U^* T^*) $" src="form_15.png" width="88" height="14"/>, and </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial u_i}{\partial x_i} = 0, \]" src="form_16.png" width="48" height="29"/>
</p>
 </center><p> subject to parabolic inflow </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf u} = 6 x_2 (1-x_2) {\bf e}_1 \]" src="form_17.png" width="99" height="14"/>
</p>
 </center><p> at the inflow cross-section; parallel, axially-traction-free outflow at the outlet; and no-slip on the stationary channel walls and the surface of the cylinder, <img class="formulaInl" alt="$ {\bf u} = {\bf 0} $" src="form_18.png" width="31" height="9"/>. The no-slip condition on the moving flag is </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf u} = St \ \frac{\partial {\bf R}_w(\xi_{[top,tip,bottom]},t)}{\partial t} \ \ \ \ \ \ \ \ \ \ \ \ \ \ (1) \]" src="form_19.png" width="239" height="29"/>
</p>
 </center><p> where <img class="formulaInl" alt="$ \xi_{[top,tip,bottom]} $" src="form_20.png" width="74" height="15"/> are Lagrangian coordinates parametrising the three faces of the flag.</p>
<p>We describe the deformation of the elastic flag by the non-dimensional position vector <img class="formulaInl" alt="$ {\bf R}(\xi^1, \xi^2, t) $" src="form_21.png" width="60" height="15"/> which is determined by the principle of virtual displacements </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \int_{v} \left\{ \sigma^{ij} \ \delta \gamma_{ij} - \left( {\bf f} - \Lambda^2 \frac{\partial^2 {\bf R}}{\partial t^{2}} \right) \cdot \delta {\bf R} \right\} \ dv -\oint_{A_{tract}} {\bf t} \cdot \delta {\bf R} \ dA =0, \ \ \ \ \ \ \ \ (2) \]" src="form_22.png" width="396" height="33"/>
</p>
<p> where all solid stresses and tractions have been non-dimensionalised on Young's modulus, <img class="formulaInl" alt="$ E^* $" src="form_9.png" width="15" height="10"/>; see the <a href="../../../solid/solid_theory/html/index.html">Solid Mechanics Tutorial</a> for details. The solid mechanics timescale ratio (the ratio of the timescale <img class="formulaInl" alt="$ T^* $" src="form_23.png" width="15" height="10"/> chosen to non-dimensionalise time, to the intrinsic timescale of the solid) can be expressed in terms of the Reynolds and Strouhal numbers, the density ratio, and the FSI interaction parameter as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Lambda^2 = \left( \frac{d^*}{T^*} \sqrt{\frac{\rho_s}{E^*}} \right)^2 = St^2 \left( \frac{\rho_s}{\rho_f} \right) Re \ Q. \]" src="form_24.png" width="209" height="35"/>
</p>
<p>Here is a sketch of the non-dimensional version of the problem:</p>
<div class="image">
<img src="turek_flag.gif" alt=""/>
<div class="caption">
Sketch of the fluid problem in dimensionless variables, showing the Lagrangian coordinates that parametrise the three faces of the flag. </div></div>
 <hr  />
 <hr  />
<h1><a class="anchor" id="parameters"></a>
Parameter values for the benchmark problems</h1>
<p>The (dimensional) parameter values given in Turek &amp; Hron's benchmark correspond to the following non-dimensional parameters:</p>
<h2><a class="anchor" id="geom"></a>
Geometry</h2>
<ul>
<li>Cylinder diameter <img class="formulaInl" alt="$ d = 1 $" src="form_25.png" width="29" height="10"/></li>
<li>Centre of cylinder <img class="formulaInl" alt="$ X_c = Y_c = 2 $" src="form_26.png" width="68" height="13"/></li>
<li>Channel length <img class="formulaInl" alt="$ L= 25 $" src="form_27.png" width="38" height="10"/></li>
<li>Channel width <img class="formulaInl" alt="$ H = 4.1 $" src="form_28.png" width="44" height="10"/></li>
<li>Thickness of the undeformed flag <img class="formulaInl" alt="$ H_{flag} = 0.2 $" src="form_29.png" width="63" height="14"/></li>
<li>Right end of undeformed flag <img class="formulaInl" alt="$ x_{tip} = 6 $" src="form_30.png" width="44" height="13"/></li>
</ul>
<h2><a class="anchor" id="nd_params"></a>
Non-dimensional parameters</h2>
<p>The three FSI test cases correspond to the following non-dimensional parameters:</p>
<table border="1">
<tr>
<td align="center">..  </td><td align="center"><img class="formulaInl" alt="$ Re = U^* d^* \rho_f/\mu $" src="form_31.png" width="86" height="14"/>  </td><td align="center"><img class="formulaInl" alt="$ St = d^* /(U^* T^*) $" src="form_32.png" width="88" height="14"/>  </td><td align="center"><img class="formulaInl" alt="$ Q = \mu U^* / (E^* d^*) $" src="form_33.png" width="93" height="14"/>  </td><td align="center"><img class="formulaInl" alt="$ \rho_s/\rho_f $" src="form_34.png" width="31" height="14"/>  </td><td align="center"><img class="formulaInl" alt="$ \Lambda^2 = (d^* /T^* \sqrt{\rho_s/E^*})^2 = St^2 (\rho_s/\rho_f) Re \ Q $" src="form_35.png" width="231" height="16"/>   </td></tr>
<tr>
<td align="center"><b>FSI1</b>  </td><td align="center"><img class="formulaInl" alt="$ 20 $" src="form_36.png" width="13" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 0.5 $" src="form_37.png" width="16" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 1.429 \times 10^{-6} $" src="form_38.png" width="69" height="11"/>  </td><td align="center"><img class="formulaInl" alt="$ 1 $" src="form_39.png" width="5" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 7.145 \times 10^{-6} $" src="form_40.png" width="69" height="11"/>   </td></tr>
<tr>
<td align="center"><b>FSI2</b>  </td><td align="center"><img class="formulaInl" alt="$ 100 $" src="form_41.png" width="19" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 0.1 $" src="form_42.png" width="16" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 7.143 \times 10^{-6} $" src="form_43.png" width="69" height="11"/>  </td><td align="center"><img class="formulaInl" alt="$ 10 $" src="form_44.png" width="13" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 7.143 \times 10^{-6} $" src="form_43.png" width="69" height="11"/>   </td></tr>
<tr>
<td align="center"><b>FSI3</b>  </td><td align="center"><img class="formulaInl" alt="$ 200 $" src="form_45.png" width="19" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 0.05 $" src="form_46.png" width="23" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 3.571 \times 10^{-6} $" src="form_47.png" width="70" height="11"/>  </td><td align="center"><img class="formulaInl" alt="$ 1 $" src="form_39.png" width="5" height="9"/>  </td><td align="center"><img class="formulaInl" alt="$ 1.786 \times 10^{-6} $" src="form_48.png" width="69" height="11"/>   </td></tr>
</table>
<hr  />
 <hr  />
<h1><a class="anchor" id="results"></a>
Results</h1>
<p>The test cases FSI2 and FSI3 are the most interesting because the system develops large-amplitude self-excited oscillations</p>
<h2><a class="anchor" id="fsi2_results"></a>
FSI2</h2>
<p>Following an initial transient period the system settles into large-amplitude self-excited oscillations during which the oscillating flag generates a regular vortex pattern that is advected along the channel. This is illustrated in the figure below which shows a snapshot of the flow field (pressure contours and instantaneous streamlines) at <img class="formulaInl" alt="$ t=6.04. $" src="form_49.png" width="48" height="9"/></p>
<div class="image">
<img src="fsi2_flow605_cropped.gif" alt=""/>
<div class="caption">
Snapshot of the flow field (instantaneous streamlines and pressure contours) </div></div>
 <p>The constantly adapted mesh contains and average of 65,000 degrees of freedom. A relatively large timestep of <img class="formulaInl" alt="$ \Delta t = 0.01 $" src="form_50.png" width="53" height="10"/> &ndash; corresponding to about 50 timesteps per period of the oscillation &ndash; was used in this computation. With this discretisation the system settles into oscillations with a period of <img class="formulaInl" alt="$ \approx 0.52 $" src="form_51.png" width="35" height="9"/> and an amplitude of the tip-displacement of <img class="formulaInl" alt="$ 0.01 \pm 0.83. $" src="form_52.png" width="64" height="9"/></p>
<div class="image">
<img src="fsi2_trace_cropped.gif" alt=""/>
<div class="caption">
Time trace of the tip displacement. </div></div>
 <h2><a class="anchor" id="fsi3_results"></a>
FSI3</h2>
<p>The figures below shows the corresponding results for the case FSI3 in which the fluid and solid densities are equal and the Reynolds number twice as large as in the FSI2 case. The system performs oscillations of much higher frequency and smaller amplitude. This is illustrated in the figure below which shows a snapshot of the flow field (pressure contours and instantaneous streamlines) at <img class="formulaInl" alt="$ t=3.615. $" src="form_53.png" width="54" height="9"/></p>
<div class="image">
<img src="fsi3_flow724_cropped.gif" alt=""/>
<div class="caption">
Snapshot of the flow field (instantaneous streamlines and pressure contours) </div></div>
 <p>This computation was performed with a timestep of <img class="formulaInl" alt="$ \Delta t = 0.005 $" src="form_54.png" width="60" height="10"/> and resulted in oscillations with a period of <img class="formulaInl" alt="$ \approx 0.19 $" src="form_55.png" width="35" height="9"/> and an amplitude of the tip-displacement of <img class="formulaInl" alt="$ 0.01 \pm 0.36. $" src="form_56.png" width="64" height="9"/></p>
<p>The increase in frequency and Reynolds number leads to the development of thinner boundary and shear layers which require a finer spatial resolution, involving an average of 84,000 degrees of freedom.</p>
<div class="image">
<img src="fsi3_trace_cropped.gif" alt=""/>
<div class="caption">
Time trace of the tip displacement. </div></div>
 <hr  />
 <hr  />
<h1><a class="anchor" id="overview"></a>
Overview of the driver code</h1>
<p>Since the driver code is somewhat lengthy we start by providing a brief overview of the main steps in the <code>Problem</code> construction:</p><ol type="1">
<li>We start by discretising the flag with 2D solid elements, as in the corresponding <a href="../../../solid/airy_cantilever/html/index.html">single-physics solid mechanics example.</a> <br  />
<br  />
</li>
<li>Next we attach <code>FSISolidTractionElements</code> to the three solid mesh boundaries that are exposed to the fluid traction. These elements are used to compute and impose the fluid traction onto the solid elements, using the flow field from the adjacent fluid elements. <br  />
<br  />
</li>
<li>We now combine the three sets of <code>FSISolidTractionElements</code> into three individual (sub-)meshes and convert these to <code>GeomObjects</code>, using the <code>MeshAsGeomObject</code> class. <br  />
<br  />
</li>
<li>The <code>GeomObject</code> representation of the three surface meshes is then passed to the constructor of the fluid mesh. The <a href="../../../interaction/fsi_collapsible_channel_algebraic/html/index.html">algebraic node-update methodology</a> provided in the <code>AlgebraicMesh</code> base class is used to update its nodal positions in response to the motion of its bounding <code>GeomObjects</code>. <br  />
<br  />
</li>
<li>Finally, we use the helper function <code>FSI_functions::setup_fluid_load_info_for_solid_elements(...)</code> to set up the fluid-structure interaction &ndash; this function determines which fluid elements are adjacent to the Gauss points in the <code>FSISolidTractionElements</code> that apply the fluid traction to the solid. <br  />
<br  />
</li>
<li>Done! <br  />
<br  />
</li>
</ol>
<hr  />
 <hr  />
<h1><a class="anchor" id="parameters"></a>
Parameter values for the benchmark problems</h1>
<p>As usual, We use a namespace to define the (many) global parameters, using default assignments for the FSI1 test case.</p>
 <div class="fragment"><div class="line"><span class="comment">//=====start_of_global_parameters=================================</span></div>
<div class="line"><span class="comment">/// Global variables</span></div>
<div class="line"><span class="comment"></span><span class="comment">//================================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGlobal__Parameters.html">Global_Parameters</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Default case ID</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">string</span> <a class="code" href="namespaceGlobal__Parameters.html#a887474a9be53363806b4de417f660dba">Case_ID</a>=<span class="stringliteral">&quot;FSI1&quot;</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Reynolds number (default assignment for FSI1 test case)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Re</a>=20.0; </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Strouhal number (default assignment for FSI1 test case)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#af1af40a0df651e86bc1be273fafa98da">St</a>=0.5;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Product of Reynolds and Strouhal numbers (default</span></div>
<div class="line"><span class="comment"> /// assignment for FSI1 test case)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a7a59a32365e87566069e458dc83bd18a">ReSt</a>=10.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// FSI parameter (default assignment for FSI1 test case)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a7814fddf663e56168174a42d2cd6b4c1">Q</a>=1.429e-6;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Density ratio (solid to fluid; default assignment for FSI1</span></div>
<div class="line"><span class="comment"> /// test case)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a517d4c31b8bce6563c2f605266dd9679">Density_ratio</a>=1.0; </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Height of flag</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#ab360628e7830e43e355ce5768f6d6a6c">H</a>=0.2;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// x position of centre of cylinder</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a0f0247cc83ba202413b50e7b4b7fceb0">Centre_x</a>=2.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// y position of centre of cylinder</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#af41282d812fdff4867e3d8c825886290">Centre_y</a>=2.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Radius of cylinder</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a126c1e491ef187867b6b7bfb52b476ad">Radius</a>=0.5;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to constitutive law</span></div>
<div class="line"><span class="comment"></span> ConstitutiveLaw* <a class="code" href="namespaceGlobal__Parameters.html#adbd1f040f375c96fe56b3f475f7dbec2">Constitutive_law_pt</a>=0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Timescale ratio for solid (dependent parameter</span></div>
<div class="line"><span class="comment"> /// assigned in set_parameters())</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a3e3428638f89f970fcf2148b0bab1465">Lambda_sq</a>=0.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Timestep</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#ab29c9f716872de235c78e62bce2c4109">Dt</a>=0.1;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Ignore fluid (default assignment for FSI1 test case)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">bool</span> <a class="code" href="namespaceGlobal__Parameters.html#aac13d615d2acd78d22a3137ffd62f7aa">Ignore_fluid_loading</a>=<span class="keyword">false</span>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Elastic modulus</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#aa3dfbdb1b2fd80d516850f66c96b6fd0">E</a>=1.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Poisson&#39;s ratio</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a20fccdcfa2c15ad8b951b9ada3bb1661">Nu</a>=0.4; </div>
<div class="ttc" id="anamespaceGlobal__Parameters_html"><div class="ttname"><a href="namespaceGlobal__Parameters.html">Global_Parameters</a></div><div class="ttdoc">Global variables.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00051">turek_flag.cc:52</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a0f0247cc83ba202413b50e7b4b7fceb0"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a0f0247cc83ba202413b50e7b4b7fceb0">Global_Parameters::Centre_x</a></div><div class="ttdeci">double Centre_x</div><div class="ttdoc">x position of centre of cylinder</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00078">turek_flag.cc:78</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a126c1e491ef187867b6b7bfb52b476ad"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a126c1e491ef187867b6b7bfb52b476ad">Global_Parameters::Radius</a></div><div class="ttdeci">double Radius</div><div class="ttdoc">Radius of cylinder.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00084">turek_flag.cc:84</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a20fccdcfa2c15ad8b951b9ada3bb1661"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a20fccdcfa2c15ad8b951b9ada3bb1661">Global_Parameters::Nu</a></div><div class="ttdeci">double Nu</div><div class="ttdoc">Poisson's ratio.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00103">turek_flag.cc:103</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a3e3428638f89f970fcf2148b0bab1465"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a3e3428638f89f970fcf2148b0bab1465">Global_Parameters::Lambda_sq</a></div><div class="ttdeci">double Lambda_sq</div><div class="ttdoc">Timescale ratio for solid (dependent parameter assigned in set_parameters())</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00091">turek_flag.cc:91</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a517d4c31b8bce6563c2f605266dd9679"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a517d4c31b8bce6563c2f605266dd9679">Global_Parameters::Density_ratio</a></div><div class="ttdeci">double Density_ratio</div><div class="ttdoc">Density ratio (solid to fluid; default assignment for FSI1 test case)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00072">turek_flag.cc:72</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a7814fddf663e56168174a42d2cd6b4c1"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a7814fddf663e56168174a42d2cd6b4c1">Global_Parameters::Q</a></div><div class="ttdeci">double Q</div><div class="ttdoc">FSI parameter (default assignment for FSI1 test case)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00068">turek_flag.cc:68</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a7a59a32365e87566069e458dc83bd18a"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a7a59a32365e87566069e458dc83bd18a">Global_Parameters::ReSt</a></div><div class="ttdeci">double ReSt</div><div class="ttdoc">Product of Reynolds and Strouhal numbers (default assignment for FSI1 test case)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00065">turek_flag.cc:65</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a887474a9be53363806b4de417f660dba"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a887474a9be53363806b4de417f660dba">Global_Parameters::Case_ID</a></div><div class="ttdeci">string Case_ID</div><div class="ttdoc">Default case ID.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00055">turek_flag.cc:55</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a9d72e94a9305c6a310940a6a427ebe06"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Global_Parameters::Re</a></div><div class="ttdeci">double Re</div><div class="ttdoc">Reynolds number (default assignment for FSI1 test case)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00058">turek_flag.cc:58</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_aa3dfbdb1b2fd80d516850f66c96b6fd0"><div class="ttname"><a href="namespaceGlobal__Parameters.html#aa3dfbdb1b2fd80d516850f66c96b6fd0">Global_Parameters::E</a></div><div class="ttdeci">double E</div><div class="ttdoc">Elastic modulus.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00100">turek_flag.cc:100</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_aac13d615d2acd78d22a3137ffd62f7aa"><div class="ttname"><a href="namespaceGlobal__Parameters.html#aac13d615d2acd78d22a3137ffd62f7aa">Global_Parameters::Ignore_fluid_loading</a></div><div class="ttdeci">bool Ignore_fluid_loading</div><div class="ttdoc">Ignore fluid (default assignment for FSI1 test case)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00097">turek_flag.cc:97</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_ab29c9f716872de235c78e62bce2c4109"><div class="ttname"><a href="namespaceGlobal__Parameters.html#ab29c9f716872de235c78e62bce2c4109">Global_Parameters::Dt</a></div><div class="ttdeci">double Dt</div><div class="ttdoc">Timestep.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00094">turek_flag.cc:94</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_ab360628e7830e43e355ce5768f6d6a6c"><div class="ttname"><a href="namespaceGlobal__Parameters.html#ab360628e7830e43e355ce5768f6d6a6c">Global_Parameters::H</a></div><div class="ttdeci">double H</div><div class="ttdoc">Height of flag.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00075">turek_flag.cc:75</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_adbd1f040f375c96fe56b3f475f7dbec2"><div class="ttname"><a href="namespaceGlobal__Parameters.html#adbd1f040f375c96fe56b3f475f7dbec2">Global_Parameters::Constitutive_law_pt</a></div><div class="ttdeci">ConstitutiveLaw * Constitutive_law_pt</div><div class="ttdoc">Pointer to constitutive law.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00087">turek_flag.cc:87</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_af1af40a0df651e86bc1be273fafa98da"><div class="ttname"><a href="namespaceGlobal__Parameters.html#af1af40a0df651e86bc1be273fafa98da">Global_Parameters::St</a></div><div class="ttdeci">double St</div><div class="ttdoc">Strouhal number (default assignment for FSI1 test case)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00061">turek_flag.cc:61</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_af41282d812fdff4867e3d8c825886290"><div class="ttname"><a href="namespaceGlobal__Parameters.html#af41282d812fdff4867e3d8c825886290">Global_Parameters::Centre_y</a></div><div class="ttdeci">double Centre_y</div><div class="ttdoc">y position of centre of cylinder</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00081">turek_flag.cc:81</a></div></div>
</div><!-- fragment --><p> We also include a gravitational body force for the solid. (This is only used for the solid mechanics test cases, CSM1 and CSM2, which will not be discussed here.)</p>
<div class="fragment"><div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Non-dim gravity (default assignment for FSI1 test case)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a335000b5db4206486a116ae0468d2d0c">Gravity</a>=0.0; </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Non-dimensional gravity as body force</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceGlobal__Parameters.html#a200109847bf4cc26da4d00e8d68d569e">gravity</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; time, </div>
<div class="line">              <span class="keyword">const</span> Vector&lt;double&gt; &amp;xi,</div>
<div class="line">              Vector&lt;double&gt; &amp;b)</div>
<div class="line"> {</div>
<div class="line">  b[0]=0.0;</div>
<div class="line">  b[1]=-<a class="code" href="namespaceGlobal__Parameters.html#a335000b5db4206486a116ae0468d2d0c">Gravity</a>;</div>
<div class="line"> }</div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a200109847bf4cc26da4d00e8d68d569e"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a200109847bf4cc26da4d00e8d68d569e">Global_Parameters::gravity</a></div><div class="ttdeci">void gravity(const double &amp;time, const Vector&lt; double &gt; &amp;xi, Vector&lt; double &gt; &amp;b)</div><div class="ttdoc">Non-dimensional gravity as body force.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00109">turek_flag.cc:109</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a335000b5db4206486a116ae0468d2d0c"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a335000b5db4206486a116ae0468d2d0c">Global_Parameters::Gravity</a></div><div class="ttdeci">double Gravity</div><div class="ttdoc">Non-dim gravity (default assignment for FSI1 test case)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00106">turek_flag.cc:106</a></div></div>
</div><!-- fragment --><p> The domain geometry and flow field are fairly complex and it is difficult to construct a good initial guess for the Newton iteration. To ensure its convergence at the beginning of the simulation we therefore employ the method suggested by Turek &amp; Hron: We start the flow from rest and ramp up the inflow profile from zero to its maximum value. The parameters for the time-dependent increase in the influx are defined here:</p>
<div class="fragment"><div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Period for ramping up in flux</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#af6afcca0b1ffdf88144f99cdfed18d3b">Ramp_period</a>=2.0;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Min. flux </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a5aabde2d31d07e5d0a84f6ff02c263dc">Min_flux</a>=0.0; </div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Max. flux</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a13f0d5d16393d21bbc904aea5cff4ea4">Max_flux</a>=1.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Flux increases between Min_flux and Max_flux over </span></div>
<div class="line"><span class="comment"> /// period Ramp_period</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a536aa5314a6cdb36af852e9513351d55">flux</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t)</div>
<div class="line"> {    </div>
<div class="line">  <span class="keywordflow">if</span> (t&lt;<a class="code" href="namespaceGlobal__Parameters.html#af6afcca0b1ffdf88144f99cdfed18d3b">Ramp_period</a>)</div>
<div class="line">   {</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespaceGlobal__Parameters.html#a5aabde2d31d07e5d0a84f6ff02c263dc">Min_flux</a>+(<a class="code" href="namespaceGlobal__Parameters.html#a13f0d5d16393d21bbc904aea5cff4ea4">Max_flux</a>-<a class="code" href="namespaceGlobal__Parameters.html#a5aabde2d31d07e5d0a84f6ff02c263dc">Min_flux</a>)*</div>
<div class="line">     0.5*(1.0-cos(MathematicalConstants::Pi*t/<a class="code" href="namespaceGlobal__Parameters.html#af6afcca0b1ffdf88144f99cdfed18d3b">Ramp_period</a>));</div>
<div class="line">   }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">   {</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespaceGlobal__Parameters.html#a13f0d5d16393d21bbc904aea5cff4ea4">Max_flux</a>;</div>
<div class="line">   }</div>
<div class="line"> } <span class="comment">// end of specification of ramped influx</span></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a13f0d5d16393d21bbc904aea5cff4ea4"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a13f0d5d16393d21bbc904aea5cff4ea4">Global_Parameters::Max_flux</a></div><div class="ttdeci">double Max_flux</div><div class="ttdoc">Max. flux.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00124">turek_flag.cc:124</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a536aa5314a6cdb36af852e9513351d55"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a536aa5314a6cdb36af852e9513351d55">Global_Parameters::flux</a></div><div class="ttdeci">double flux(const double &amp;t)</div><div class="ttdoc">Flux increases between Min_flux and Max_flux over period Ramp_period.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00128">turek_flag.cc:128</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a5aabde2d31d07e5d0a84f6ff02c263dc"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a5aabde2d31d07e5d0a84f6ff02c263dc">Global_Parameters::Min_flux</a></div><div class="ttdeci">double Min_flux</div><div class="ttdoc">Min. flux.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00121">turek_flag.cc:121</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_af6afcca0b1ffdf88144f99cdfed18d3b"><div class="ttname"><a href="namespaceGlobal__Parameters.html#af6afcca0b1ffdf88144f99cdfed18d3b">Global_Parameters::Ramp_period</a></div><div class="ttdeci">double Ramp_period</div><div class="ttdoc">Period for ramping up in flux.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00118">turek_flag.cc:118</a></div></div>
</div><!-- fragment --><p> Finally, we provide a helper function that assigns the parameters for the various test cases, depending on their ID ("FSI1", "FSI2", "FSI3", "CSM1" or "CSM2"). Here is the assignment for the case FSI1:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Set parameters for the various test cases</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceGlobal__Parameters.html#a8c333f9041cad78d5c0160a8e2c169f5">set_parameters</a>(<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; case_id)</div>
<div class="line"> {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Remember which case we&#39;re dealing with</span></div>
<div class="line">  <a class="code" href="namespaceGlobal__Parameters.html#a887474a9be53363806b4de417f660dba">Case_ID</a>=case_id;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Setup independent parameters depending on test case</span></div>
<div class="line">  <span class="keywordflow">if</span> (case_id==<span class="stringliteral">&quot;FSI1&quot;</span>)</div>
<div class="line">   {</div>
<div class="line">    <span class="comment">// Reynolds number based on diameter of cylinder</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Re</a>=20.0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Strouhal number based on timescale of one second</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#af1af40a0df651e86bc1be273fafa98da">St</a>=0.5;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Womersley number</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#a7a59a32365e87566069e458dc83bd18a">ReSt</a>=<a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Re</a>*<a class="code" href="namespaceGlobal__Parameters.html#af1af40a0df651e86bc1be273fafa98da">St</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// FSI parameter</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#a7814fddf663e56168174a42d2cd6b4c1">Q</a>=1.429e-6;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Timestep -- aiming for about 40 steps per period</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#ab29c9f716872de235c78e62bce2c4109">Dt</a>=0.1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Density ratio</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#a517d4c31b8bce6563c2f605266dd9679">Density_ratio</a>=1.0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Gravity</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#a335000b5db4206486a116ae0468d2d0c">Gravity</a>=0.0;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Max. flux</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#a13f0d5d16393d21bbc904aea5cff4ea4">Max_flux</a>=1.0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Ignore fluid</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#aac13d615d2acd78d22a3137ffd62f7aa">Ignore_fluid_loading</a>=<span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Compute dependent parameters</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Timescale ratio for solid </span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#a3e3428638f89f970fcf2148b0bab1465">Lambda_sq</a>=<a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Re</a>*<a class="code" href="namespaceGlobal__Parameters.html#a7814fddf663e56168174a42d2cd6b4c1">Q</a>*<a class="code" href="namespaceGlobal__Parameters.html#a517d4c31b8bce6563c2f605266dd9679">Density_ratio</a>*<a class="code" href="namespaceGlobal__Parameters.html#af1af40a0df651e86bc1be273fafa98da">St</a>*<a class="code" href="namespaceGlobal__Parameters.html#af1af40a0df651e86bc1be273fafa98da">St</a>;</div>
<div class="line">  }</div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a8c333f9041cad78d5c0160a8e2c169f5"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a8c333f9041cad78d5c0160a8e2c169f5">Global_Parameters::set_parameters</a></div><div class="ttdeci">void set_parameters(const string &amp;case_id)</div><div class="ttdoc">Set parameters for the various test cases.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00143">turek_flag.cc:143</a></div></div>
</div><!-- fragment --><p> In the interest of brevity we omit the listings of the assignments for the other cases. Finally, we select the length of the time interval over which the influx is ramped up from zero to its maximum value to be equal to 20 timesteps, create a constitutive equation for the solid, and document the parameter values used in the simulation:</p>
<div class="fragment"><div class="line">  <span class="comment">// Ramp period (20 timesteps)</span></div>
<div class="line">  <a class="code" href="namespaceGlobal__Parameters.html#af6afcca0b1ffdf88144f99cdfed18d3b">Ramp_period</a>=<a class="code" href="namespaceGlobal__Parameters.html#ab29c9f716872de235c78e62bce2c4109">Dt</a>*20.0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// &quot;Big G&quot; Linear constitutive equations:</span></div>
<div class="line">  <a class="code" href="namespaceGlobal__Parameters.html#adbd1f040f375c96fe56b3f475f7dbec2">Constitutive_law_pt</a> = <span class="keyword">new</span> GeneralisedHookean(&amp;<a class="code" href="namespaceGlobal__Parameters.html#a20fccdcfa2c15ad8b951b9ada3bb1661">Nu</a>,&amp;<a class="code" href="namespaceGlobal__Parameters.html#aa3dfbdb1b2fd80d516850f66c96b6fd0">E</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Doc</span></div>
<div class="line">  oomph_info &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;-------------------------------------------&quot;</span> </div>
<div class="line">             &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Case: &quot;</span> &lt;&lt; case_id &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Re            = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Re</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;St            = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#af1af40a0df651e86bc1be273fafa98da">St</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;ReSt          = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#a7a59a32365e87566069e458dc83bd18a">ReSt</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Q             = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#a7814fddf663e56168174a42d2cd6b4c1">Q</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Dt            = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#ab29c9f716872de235c78e62bce2c4109">Dt</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Ramp_period   = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#af6afcca0b1ffdf88144f99cdfed18d3b">Ramp_period</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Max_flux      = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#a13f0d5d16393d21bbc904aea5cff4ea4">Max_flux</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Density_ratio = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#a517d4c31b8bce6563c2f605266dd9679">Density_ratio</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Lambda_sq     = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#a3e3428638f89f970fcf2148b0bab1465">Lambda_sq</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Gravity       = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#a335000b5db4206486a116ae0468d2d0c">Gravity</a> &lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;Ignore fluid  = &quot;</span> &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#aac13d615d2acd78d22a3137ffd62f7aa">Ignore_fluid_loading</a>&lt;&lt; std::endl;</div>
<div class="line">  oomph_info &lt;&lt; <span class="stringliteral">&quot;-------------------------------------------&quot;</span></div>
<div class="line">             &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line">}<span class="comment">// end_of_namespace</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="driver"></a>
The driver code</h1>
<p>The driver code has the usual structure, though in this case we use the command line arguments to indicate which case (FSI1, FSI2, FSI3, CSM1 or CSM2) to run. The absence of a command line argument is interpreted as the code being run as part of <code>oomph-lib's</code> self-test procedure in which case we perform a computation with the parameter values for case FSI1 and perform only a few timesteps.</p>
<div class="fragment"><div class="line"><span class="comment">//=======start_of_main==================================================</span></div>
<div class="line"><span class="comment">/// Driver </span></div>
<div class="line"><span class="comment"></span><span class="comment">//======================================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="turek__flag_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Store command line arguments</span></div>
<div class="line"> CommandLineArgs::setup(argc,argv);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Get case id as string</span></div>
<div class="line"> <span class="keywordtype">string</span> case_id=<span class="stringliteral">&quot;FSI1&quot;</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::Argc==1)</div>
<div class="line">  {</div>
<div class="line">   oomph_info &lt;&lt; <span class="stringliteral">&quot;No command line arguments; running self-test FSI1&quot;</span> </div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CommandLineArgs::Argc==2)</div>
<div class="line">  {</div>
<div class="line">   case_id=CommandLineArgs::Argv[1];</div>
<div class="line">  }</div>
<div class="line"> <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">   oomph_info &lt;&lt; <span class="stringliteral">&quot;Wrong number of command line arguments&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">   oomph_info &lt;&lt; <span class="stringliteral">&quot;Enter none (for default) or one (namely the case id&quot;</span> </div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">   oomph_info &lt;&lt; <span class="stringliteral">&quot;which should be one of: FSI1, FSI2, FSI3, CSM1&quot;</span> </div>
<div class="line">              &lt;&lt; std::endl;</div>
<div class="line">  } </div>
<div class="line"> std::cout &lt;&lt; <span class="stringliteral">&quot;Running case &quot;</span> &lt;&lt; case_id &lt;&lt; std::endl;</div>
<div class="ttc" id="aturek__flag_8cc_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="turek__flag_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdoc">Driver.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l01080">turek_flag.cc:1080</a></div></div>
</div><!-- fragment --><p> We set up the global parameter values, create a <code>DocInfo</code> object and trace file to record the output, and build the problem.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Setup parameters for case identified by command line</span></div>
<div class="line"> <span class="comment">// argument</span></div>
<div class="line"> <a class="code" href="namespaceGlobal__Parameters.html#a8c333f9041cad78d5c0160a8e2c169f5">Global_Parameters::set_parameters</a>(case_id);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Prepare output</span></div>
<div class="line"> DocInfo doc_info;</div>
<div class="line"> ofstream trace_file; </div>
<div class="line"> doc_info.set_directory(<span class="stringliteral">&quot;RESLT&quot;</span>);</div>
<div class="line"> trace_file.open(<span class="stringliteral">&quot;RESLT/trace.dat&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Length and height of domain</span></div>
<div class="line"> <span class="keywordtype">double</span> length=25.0;</div>
<div class="line"> <span class="keywordtype">double</span> height=4.1;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Set up the problem</span></div>
<div class="line"> <a class="code" href="classTurekProblem.html">TurekProblem&lt;AlgebraicElement&lt;RefineableQTaylorHoodElement&lt;2&gt;</a> &gt;,</div>
<div class="line">  RefineableQPVDElement&lt;2,3&gt; &gt; problem(length, height);</div>
<div class="ttc" id="aclassTurekProblem_html"><div class="ttname"><a href="classTurekProblem.html">TurekProblem</a></div><div class="ttdoc">//////////////////////////////////////////////////////////////////// ////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00370">turek_flag.cc:371</a></div></div>
</div><!-- fragment --><p> Next, we choose the number of timesteps (using a smaller number for a validation run, and for the case FSI1 in which the system rapidly approaches a steady state) and initialise the time-stepping for an impulsive start from the zero flow solution.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Default number of timesteps</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nstep=4000;</div>
<div class="line"> <span class="keywordflow">if</span> (<a class="code" href="namespaceGlobal__Parameters.html#a887474a9be53363806b4de417f660dba">Global_Parameters::Case_ID</a>==<span class="stringliteral">&quot;FSI1&quot;</span>)</div>
<div class="line">  {</div>
<div class="line">   std::cout &lt;&lt; <span class="stringliteral">&quot;Reducing number of steps for FSI1 &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">   nstep=400;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::Argc==1)</div>
<div class="line">  {</div>
<div class="line">   std::cout &lt;&lt; <span class="stringliteral">&quot;Reducing number of steps for validation &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">   nstep=2;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Timestep: </span></div>
<div class="line"> <span class="keywordtype">double</span> dt=<a class="code" href="namespaceGlobal__Parameters.html#ab29c9f716872de235c78e62bce2c4109">Global_Parameters::Dt</a>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Initialise timestep </span></div>
<div class="line"> problem.initialise_dt(dt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Impulsive start</span></div>
<div class="line"> problem.assign_initial_values_impulsive(dt);</div>
</div><!-- fragment --><p> Finally, we document the initial condition and start the time-stepping procedure, setting the <code>first</code> flag to <code>false</code> because we have not specified an analytical expression for the initial conditions that could be re-assigned after the mesh adaptation when computing the first timestep.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Doc the initial condition</span></div>
<div class="line"> problem.doc_solution(doc_info,trace_file);</div>
<div class="line"> doc_info.number()++; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Don&#39;t re-set the initial conditions when adapting during first</span></div>
<div class="line"> <span class="comment">// timestep</span></div>
<div class="line"> <span class="keywordtype">bool</span> first = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Max number of adaptation for time-stepping</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> max_adapt=1;</div>
<div class="line"> </div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;nstep;i++)</div>
<div class="line">  { </div>
<div class="line">  <span class="comment">// Solve the problem</span></div>
<div class="line">  problem.unsteady_newton_solve(dt,max_adapt,first); </div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Output the solution</span></div>
<div class="line">  problem.doc_solution(doc_info,trace_file);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Step number</span></div>
<div class="line">  doc_info.number()++;</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line"> trace_file.close(); </div>
<div class="line"> </div>
<div class="line">}<span class="comment">//end of main</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="problem"></a>
The Problem class</h1>
<p>The <code>Problem</code> class contains the usual member functions, such as access functions to the various meshes. Because the nodal positions are updated by an algebraic node-update procedure, the function <code>actions_before_newton_convergence_check()</code> is employed to update the nodal positions in response to changes in the (solid) variables during the Newton iteration. The function <code>actions_before_implicit_timestep()</code> is used to adjust the influx during the start-up period.</p>
 <div class="fragment"><div class="line"><span class="comment">//====start_of_problem_class=========================================== </span></div>
<div class="line"><span class="comment">/// Problem class</span></div>
<div class="line"><span class="comment"></span><span class="comment">//====================================================================== </span></div>
<div class="line"><span class="keyword">template</span>&lt; <span class="keyword">class</span> FLUID_ELEMENT,<span class="keyword">class</span> SOLID_ELEMENT &gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classTurekProblem.html">TurekProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor: Pass length and height of domain</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classTurekProblem.html#a69f6624fd854393f0c0e5303603ec749">TurekProblem</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;length, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;height);</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Access function for the fluid mesh </span></div>
<div class="line"><span class="comment"></span> RefineableAlgebraicCylinderWithFlagMesh&lt;FLUID_ELEMENT&gt;* <a class="code" href="classTurekProblem.html#a0fc23b86efec256cb7f4450a928f7999">fluid_mesh_pt</a>() </div>
<div class="line">  { <span class="keywordflow">return</span> <a class="code" href="classTurekProblem.html#a18a0daace5dc50db4b93879e4a600e6a">Fluid_mesh_pt</a>;}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function for the solid mesh</span></div>
<div class="line"><span class="comment"></span> ElasticRefineableRectangularQuadMesh&lt;SOLID_ELEMENT&gt;*&amp; <a class="code" href="classTurekProblem.html#a89430ae6d87a85a83e23e14e0b0d72b7">solid_mesh_pt</a>() </div>
<div class="line">  {<span class="keywordflow">return</span> <a class="code" href="classTurekProblem.html#a1a449088ae3cc96ade1c58979294afed">Solid_mesh_pt</a>;} </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function for the i-th mesh of FSI traction elements</span></div>
<div class="line"><span class="comment"></span> SolidMesh*&amp; <a class="code" href="classTurekProblem.html#a93a4b3d4e598a499631e00cfa701ee3c">traction_mesh_pt</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; i)</div>
<div class="line">  {<span class="keywordflow">return</span> <a class="code" href="classTurekProblem.html#a0b8588d0f133ffb9a281c5747786f95f">Traction_mesh_pt</a>[i];} </div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Actions after adapt: Re-setup the fsi lookup scheme</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#a39df0332d7606a5befe89bb0e581184b">actions_after_adapt</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc the solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#a2cf0eb1610b4c3a7cdbd3c7948cdd46e">doc_solution</a>(DocInfo&amp; doc_info, ofstream&amp; trace_file);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update function (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#ae97d3bad44e12274168e883c966b3983">actions_after_newton_solve</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update function (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#a889518fdaf0c4215e21981afbfc669bd">actions_before_newton_solve</a>(){}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the (dependent) fluid node positions following the</span></div>
<div class="line"><span class="comment"> /// update of the solid variables before performing Newton convergence</span></div>
<div class="line"><span class="comment"> /// check</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#aa896171b1a817ca35cba9b723bb15ed2">actions_before_newton_convergence_check</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the time-dependent influx</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#a4ad226ceec27cb3c3ea4d1ecfd4e573f">actions_before_implicit_timestep</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Create FSI traction elements</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#ad460a2e860c9425297cf70ee125de10b">create_fsi_traction_elements</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to solid mesh</span></div>
<div class="line"><span class="comment"></span> ElasticRefineableRectangularQuadMesh&lt;SOLID_ELEMENT&gt;* <a class="code" href="classTurekProblem.html#a1a449088ae3cc96ade1c58979294afed">Solid_mesh_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to fluid mesh</span></div>
<div class="line"><span class="comment"></span> RefineableAlgebraicCylinderWithFlagMesh&lt;FLUID_ELEMENT&gt;* <a class="code" href="classTurekProblem.html#a18a0daace5dc50db4b93879e4a600e6a">Fluid_mesh_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Vector of pointers to mesh of FSI traction elements</span></div>
<div class="line"><span class="comment"></span> Vector&lt;SolidMesh*&gt; <a class="code" href="classTurekProblem.html#a0b8588d0f133ffb9a281c5747786f95f">Traction_mesh_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Combined mesh of traction elements -- only used for documentation</span></div>
<div class="line"><span class="comment"></span> SolidMesh* <a class="code" href="classTurekProblem.html#ac61477b19dfaaba6fb2c7a5c72240ac6">Combined_traction_mesh_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Overall height of domain</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="classTurekProblem.html#a24d68af05e815f7164e30f53ce7357ce">Domain_height</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Overall length of domain</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="classTurekProblem.html#aff485942ff327ccfcafd3608910ef635">Domain_length</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to solid control node</span></div>
<div class="line"><span class="comment"></span> Node* <a class="code" href="classTurekProblem.html#ad65b9a2f833ed9bae3520980c76d1f2f">Solid_control_node_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to fluid control node</span></div>
<div class="line"><span class="comment"></span> Node* <a class="code" href="classTurekProblem.html#a3d297a52fffd79bb7083fd57c2574fff">Fluid_control_node_pt</a>;</div>
<div class="line"> </div>
<div class="line">};<span class="comment">// end_of_problem_class</span></div>
<div class="ttc" id="aclassTurekProblem_html_a0b8588d0f133ffb9a281c5747786f95f"><div class="ttname"><a href="classTurekProblem.html#a0b8588d0f133ffb9a281c5747786f95f">TurekProblem::Traction_mesh_pt</a></div><div class="ttdeci">Vector&lt; SolidMesh * &gt; Traction_mesh_pt</div><div class="ttdoc">Vector of pointers to mesh of FSI traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00422">turek_flag.cc:422</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a0fc23b86efec256cb7f4450a928f7999"><div class="ttname"><a href="classTurekProblem.html#a0fc23b86efec256cb7f4450a928f7999">TurekProblem::fluid_mesh_pt</a></div><div class="ttdeci">RefineableAlgebraicCylinderWithFlagMesh&lt; FLUID_ELEMENT &gt; * fluid_mesh_pt()</div><div class="ttdoc">Access function for the fluid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00379">turek_flag.cc:379</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a18a0daace5dc50db4b93879e4a600e6a"><div class="ttname"><a href="classTurekProblem.html#a18a0daace5dc50db4b93879e4a600e6a">TurekProblem::Fluid_mesh_pt</a></div><div class="ttdeci">RefineableAlgebraicCylinderWithFlagMesh&lt; FLUID_ELEMENT &gt; * Fluid_mesh_pt</div><div class="ttdoc">Pointer to fluid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00419">turek_flag.cc:419</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a1a449088ae3cc96ade1c58979294afed"><div class="ttname"><a href="classTurekProblem.html#a1a449088ae3cc96ade1c58979294afed">TurekProblem::Solid_mesh_pt</a></div><div class="ttdeci">ElasticRefineableRectangularQuadMesh&lt; SOLID_ELEMENT &gt; * Solid_mesh_pt</div><div class="ttdoc">Pointer to solid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00416">turek_flag.cc:416</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a24d68af05e815f7164e30f53ce7357ce"><div class="ttname"><a href="classTurekProblem.html#a24d68af05e815f7164e30f53ce7357ce">TurekProblem::Domain_height</a></div><div class="ttdeci">double Domain_height</div><div class="ttdoc">Overall height of domain.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00428">turek_flag.cc:428</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a2cf0eb1610b4c3a7cdbd3c7948cdd46e"><div class="ttname"><a href="classTurekProblem.html#a2cf0eb1610b4c3a7cdbd3c7948cdd46e">TurekProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(DocInfo &amp;doc_info, ofstream &amp;trace_file)</div><div class="ttdoc">Doc the solution.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l01008">turek_flag.cc:1008</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a39df0332d7606a5befe89bb0e581184b"><div class="ttname"><a href="classTurekProblem.html#a39df0332d7606a5befe89bb0e581184b">TurekProblem::actions_after_adapt</a></div><div class="ttdeci">void actions_after_adapt()</div><div class="ttdoc">Actions after adapt: Re-setup the fsi lookup scheme.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00895">turek_flag.cc:895</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a3d297a52fffd79bb7083fd57c2574fff"><div class="ttname"><a href="classTurekProblem.html#a3d297a52fffd79bb7083fd57c2574fff">TurekProblem::Fluid_control_node_pt</a></div><div class="ttdeci">Node * Fluid_control_node_pt</div><div class="ttdoc">Pointer to fluid control node.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00437">turek_flag.cc:437</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a4ad226ceec27cb3c3ea4d1ecfd4e573f"><div class="ttname"><a href="classTurekProblem.html#a4ad226ceec27cb3c3ea4d1ecfd4e573f">TurekProblem::actions_before_implicit_timestep</a></div><div class="ttdeci">void actions_before_implicit_timestep()</div><div class="ttdoc">Update the time-dependent influx.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00868">turek_flag.cc:869</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a69f6624fd854393f0c0e5303603ec749"><div class="ttname"><a href="classTurekProblem.html#a69f6624fd854393f0c0e5303603ec749">TurekProblem::TurekProblem</a></div><div class="ttdeci">TurekProblem(const double &amp;length, const double &amp;height)</div><div class="ttdoc">Constructor: Pass length and height of domain.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00446">turek_flag.cc:447</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a889518fdaf0c4215e21981afbfc669bd"><div class="ttname"><a href="classTurekProblem.html#a889518fdaf0c4215e21981afbfc669bd">TurekProblem::actions_before_newton_solve</a></div><div class="ttdeci">void actions_before_newton_solve()</div><div class="ttdoc">Update function (empty)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00400">turek_flag.cc:400</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a89430ae6d87a85a83e23e14e0b0d72b7"><div class="ttname"><a href="classTurekProblem.html#a89430ae6d87a85a83e23e14e0b0d72b7">TurekProblem::solid_mesh_pt</a></div><div class="ttdeci">ElasticRefineableRectangularQuadMesh&lt; SOLID_ELEMENT &gt; *&amp; solid_mesh_pt()</div><div class="ttdoc">Access function for the solid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00383">turek_flag.cc:383</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_a93a4b3d4e598a499631e00cfa701ee3c"><div class="ttname"><a href="classTurekProblem.html#a93a4b3d4e598a499631e00cfa701ee3c">TurekProblem::traction_mesh_pt</a></div><div class="ttdeci">SolidMesh *&amp; traction_mesh_pt(const unsigned &amp;i)</div><div class="ttdoc">Access function for the i-th mesh of FSI traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00387">turek_flag.cc:387</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_aa896171b1a817ca35cba9b723bb15ed2"><div class="ttname"><a href="classTurekProblem.html#aa896171b1a817ca35cba9b723bb15ed2">TurekProblem::actions_before_newton_convergence_check</a></div><div class="ttdeci">void actions_before_newton_convergence_check()</div><div class="ttdoc">Update the (dependent) fluid node positions following the update of the solid variables before perfor...</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00857">turek_flag.cc:857</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_ac61477b19dfaaba6fb2c7a5c72240ac6"><div class="ttname"><a href="classTurekProblem.html#ac61477b19dfaaba6fb2c7a5c72240ac6">TurekProblem::Combined_traction_mesh_pt</a></div><div class="ttdeci">SolidMesh * Combined_traction_mesh_pt</div><div class="ttdoc">Combined mesh of traction elements – only used for documentation.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00425">turek_flag.cc:425</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_ad460a2e860c9425297cf70ee125de10b"><div class="ttname"><a href="classTurekProblem.html#ad460a2e860c9425297cf70ee125de10b">TurekProblem::create_fsi_traction_elements</a></div><div class="ttdeci">void create_fsi_traction_elements()</div><div class="ttdoc">Create FSI traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00953">turek_flag.cc:953</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_ad65b9a2f833ed9bae3520980c76d1f2f"><div class="ttname"><a href="classTurekProblem.html#ad65b9a2f833ed9bae3520980c76d1f2f">TurekProblem::Solid_control_node_pt</a></div><div class="ttdeci">Node * Solid_control_node_pt</div><div class="ttdoc">Pointer to solid control node.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00434">turek_flag.cc:434</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_ae97d3bad44e12274168e883c966b3983"><div class="ttname"><a href="classTurekProblem.html#ae97d3bad44e12274168e883c966b3983">TurekProblem::actions_after_newton_solve</a></div><div class="ttdeci">void actions_after_newton_solve()</div><div class="ttdoc">Update function (empty)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00397">turek_flag.cc:397</a></div></div>
<div class="ttc" id="aclassTurekProblem_html_aff485942ff327ccfcafd3608910ef635"><div class="ttname"><a href="classTurekProblem.html#aff485942ff327ccfcafd3608910ef635">TurekProblem::Domain_length</a></div><div class="ttdeci">double Domain_length</div><div class="ttdoc">Overall length of domain.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag_8cc_source.html#l00431">turek_flag.cc:431</a></div></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="constructor"></a>
The problem constructor</h1>
<p>We start by building the solid mesh, using an initial discretisation with 20 x 2 elements in the x- and y-directions. (The length of the flag is determined such that it emanates from its intersection with the cylinder and ends at x=6; The <code>origin</code> vector shifts the "lower left" vertex of the solid mesh so that its centreline is aligned with the cylinder.)</p>
<div class="fragment"><div class="line"><span class="comment">//=====start_of_constructor============================================= </span></div>
<div class="line"><span class="comment">/// Constructor: Pass length and height of domain</span></div>
<div class="line"><span class="comment"></span><span class="comment">//====================================================================== </span></div>
<div class="line"><span class="keyword">template</span>&lt; <span class="keyword">class</span> FLUID_ELEMENT,<span class="keyword">class</span> SOLID_ELEMENT &gt;</div>
<div class="line"><a class="code" href="classTurekProblem.html#a69f6624fd854393f0c0e5303603ec749">TurekProblem&lt;FLUID_ELEMENT,SOLID_ELEMENT&gt;::</a></div>
<div class="line"><a class="code" href="classTurekProblem.html#a69f6624fd854393f0c0e5303603ec749">TurekProblem</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;length,</div>
<div class="line">             <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;height) :  Domain_height(height),</div>
<div class="line">                                      Domain_length(length)</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Increase max. number of iterations in Newton solver to</span></div>
<div class="line"> <span class="comment">// accomodate possible poor initial guesses</span></div>
<div class="line"> Max_newton_iterations=20;</div>
<div class="line"> Max_residuals=1.0e4;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build solid mesh</span></div>
<div class="line"> <span class="comment">//------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// # of elements in x-direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_x=20;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// # of elements in y-direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_y=2;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Domain length in y-direction </span></div>
<div class="line"> <span class="keywordtype">double</span> l_y=<a class="code" href="namespaceGlobal__Parameters.html#ab360628e7830e43e355ce5768f6d6a6c">Global_Parameters::H</a>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create the flag timestepper (consistent with BDF&lt;2&gt; for fluid)</span></div>
<div class="line"> Newmark&lt;2&gt;* flag_time_stepper_pt=<span class="keyword">new</span> Newmark&lt;2&gt;;</div>
<div class="line"> add_time_stepper_pt(flag_time_stepper_pt); </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Left point on centreline of flag so that the top and bottom</span></div>
<div class="line"><span class="comment"> /// vertices merge with the cylinder.</span></div>
<div class="line"><span class="comment"></span> Vector&lt;double&gt; origin(2);</div>
<div class="line"> origin[0]=<a class="code" href="namespaceGlobal__Parameters.html#a0f0247cc83ba202413b50e7b4b7fceb0">Global_Parameters::Centre_x</a>+</div>
<div class="line">  <a class="code" href="namespaceGlobal__Parameters.html#a126c1e491ef187867b6b7bfb52b476ad">Global_Parameters::Radius</a>*</div>
<div class="line">  sqrt(1.0-<a class="code" href="namespaceGlobal__Parameters.html#ab360628e7830e43e355ce5768f6d6a6c">Global_Parameters::H</a>*<a class="code" href="namespaceGlobal__Parameters.html#ab360628e7830e43e355ce5768f6d6a6c">Global_Parameters::H</a>/</div>
<div class="line">       (4.0*<a class="code" href="namespaceGlobal__Parameters.html#a126c1e491ef187867b6b7bfb52b476ad">Global_Parameters::Radius</a>*<a class="code" href="namespaceGlobal__Parameters.html#a126c1e491ef187867b6b7bfb52b476ad">Global_Parameters::Radius</a>));</div>
<div class="line"> origin[1]=<a class="code" href="namespaceGlobal__Parameters.html#af41282d812fdff4867e3d8c825886290">Global_Parameters::Centre_y</a>-0.5*l_y;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set length of flag so that endpoint actually stretches all the</span></div>
<div class="line"> <span class="comment">// way to x=6:</span></div>
<div class="line"> <span class="keywordtype">double</span> l_x=6.0-origin[0];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Now create the mesh</span></div>
<div class="line"> solid_mesh_pt() = <span class="keyword">new</span> ElasticRefineableRectangularQuadMesh&lt;SOLID_ELEMENT&gt;(</div>
<div class="line">  n_x,n_y,l_x,l_y,origin,flag_time_stepper_pt);</div>
</div><!-- fragment --><p> We create an error estimator for the solid mesh and identify a control node at the tip of the flag to track its motion.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Set error estimator for the solid mesh</span></div>
<div class="line"> Z2ErrorEstimator* solid_error_estimator_pt=<span class="keyword">new</span> Z2ErrorEstimator;</div>
<div class="line"> solid_mesh_pt()-&gt;spatial_error_estimator_pt()=solid_error_estimator_pt;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Element that contains the control point</span></div>
<div class="line"> FiniteElement* el_pt=solid_mesh_pt()-&gt;finite_element_pt(n_x*n_y/2-1);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// How many nodes does it have?</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nnod=el_pt-&gt;nnode();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Get the control node</span></div>
<div class="line"> Solid_control_node_pt=el_pt-&gt;node_pt(nnod-1);</div>
<div class="line"> </div>
<div class="line"> std::cout &lt;&lt; <span class="stringliteral">&quot;Coordinates of solid control point &quot;</span> </div>
<div class="line">           &lt;&lt; Solid_control_node_pt-&gt;x(0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">           &lt;&lt; Solid_control_node_pt-&gt;x(1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><p> Finally, we perform one uniform mesh refinement and disable any further mesh adaptation.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Refine the mesh uniformly</span></div>
<div class="line"> solid_mesh_pt()-&gt;refine_uniformly();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Do not allow the solid mesh to be refined again</span></div>
<div class="line"> solid_mesh_pt()-&gt;disable_adaptation();</div>
</div><!-- fragment --><p> Next, we attach <code>FSISolidTractionElements</code> to the boundaries of the solid mesh that are exposed to the fluid. We complete their build by specifying which boundary of the bulk mesh they are attached to, as this information is required when setting up the fluid-structure interaction; see <a class="el" href="index.html#com_ex">Further comments and exercises</a>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build mesh of solid traction elements that apply the fluid</span></div>
<div class="line"> <span class="comment">//------------------------------------------------------------</span></div>
<div class="line"> <span class="comment">// traction to the solid elements</span></div>
<div class="line"> <span class="comment">//-------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create storage for Meshes of FSI traction elements at the bottom</span></div>
<div class="line"> <span class="comment">// top and left boundaries of the flag</span></div>
<div class="line"> Traction_mesh_pt.resize(3);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Now construct the traction element meshes</span></div>
<div class="line"> Traction_mesh_pt[0]=<span class="keyword">new</span> SolidMesh;</div>
<div class="line"> Traction_mesh_pt[1]=<span class="keyword">new</span> SolidMesh;</div>
<div class="line"> Traction_mesh_pt[2]=<span class="keyword">new</span> SolidMesh;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build the FSI traction elements</span></div>
<div class="line"> create_fsi_traction_elements();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over traction elements, pass the FSI parameter and tell them </span></div>
<div class="line"> <span class="comment">// the boundary number in the bulk solid mesh -- this is required so </span></div>
<div class="line"> <span class="comment">// they can get access to the boundary coordinates!</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> bound=0;bound&lt;3;bound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> n_face_element = Traction_mesh_pt[bound]-&gt;nelement();</div>
<div class="line">   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_face_element;e++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">//Cast the element pointer and specify boundary number</span></div>
<div class="line">     FSISolidTractionElement&lt;SOLID_ELEMENT,2&gt;* elem_pt=</div>
<div class="line">     <span class="keyword">dynamic_cast&lt;</span>FSISolidTractionElement&lt;SOLID_ELEMENT,2&gt;*<span class="keyword">&gt;</span></div>
<div class="line">      (Traction_mesh_pt[bound]-&gt;element_pt(e));</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Specify boundary number</span></div>
<div class="line">     elem_pt-&gt;set_boundary_number_in_bulk_mesh(bound);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Function that specifies the load ratios</span></div>
<div class="line">     elem_pt-&gt;q_pt() = &amp;<a class="code" href="namespaceGlobal__Parameters.html#a7814fddf663e56168174a42d2cd6b4c1">Global_Parameters::Q</a>;</div>
<div class="line">    </div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// build of FSISolidTractionElements is complete</span></div>
</div><!-- fragment --><p> Finally, we create <code>GeomObject</code> representations of the three surface meshes of <code>FSISolidTractionElements</code>. We will use these to represent the curvilinear, moving boundaries of the fluid mesh.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Turn the three meshes of FSI traction elements into compound</span></div>
<div class="line"> <span class="comment">// geometric objects (one Lagrangian, two Eulerian coordinates)</span></div>
<div class="line"> <span class="comment">// that determine the boundary of the fluid mesh</span></div>
<div class="line"> MeshAsGeomObject*</div>
<div class="line">  bottom_flag_pt=</div>
<div class="line">  <span class="keyword">new</span> MeshAsGeomObject</div>
<div class="line">  (Traction_mesh_pt[0]);</div>
<div class="line"> </div>
<div class="line"> MeshAsGeomObject* tip_flag_pt=</div>
<div class="line">  <span class="keyword">new</span> MeshAsGeomObject</div>
<div class="line">  (Traction_mesh_pt[1]);</div>
<div class="line"> </div>
<div class="line"> MeshAsGeomObject* top_flag_pt=</div>
<div class="line">  <span class="keyword">new</span> MeshAsGeomObject</div>
<div class="line">  (Traction_mesh_pt[2]);</div>
</div><!-- fragment --><p> The final mesh to be built is the fluid mesh whose constructor requires pointers to the four <code>GeomObjects</code> that represent the cylinder and three fluid-loaded faces of the flag, respectively. We represent the cylinder by a <code>Circle</code> object:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build fluid mesh</span></div>
<div class="line"> <span class="comment">//-----------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Create a new Circle object as the central cylinder</span></div>
<div class="line"> Circle* cylinder_pt = <span class="keyword">new</span> Circle(<a class="code" href="namespaceGlobal__Parameters.html#a0f0247cc83ba202413b50e7b4b7fceb0">Global_Parameters::Centre_x</a>,</div>
<div class="line">                                  <a class="code" href="namespaceGlobal__Parameters.html#af41282d812fdff4867e3d8c825886290">Global_Parameters::Centre_y</a>,</div>
<div class="line">                                  <a class="code" href="namespaceGlobal__Parameters.html#a126c1e491ef187867b6b7bfb52b476ad">Global_Parameters::Radius</a>);</div>
</div><!-- fragment --><p> We build the mesh and identify a control node (a node at the upstream face of the cylinder), before creating an error estimator and performing one uniform mesh refinement.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Allocate the fluid timestepper</span></div>
<div class="line"> BDF&lt;2&gt;* fluid_time_stepper_pt=<span class="keyword">new</span> BDF&lt;2&gt;;</div>
<div class="line"> add_time_stepper_pt(fluid_time_stepper_pt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build fluid mesh</span></div>
<div class="line"> Fluid_mesh_pt=</div>
<div class="line">  <span class="keyword">new</span> RefineableAlgebraicCylinderWithFlagMesh&lt;FLUID_ELEMENT&gt;</div>
<div class="line">  (cylinder_pt, </div>
<div class="line">   top_flag_pt,</div>
<div class="line">   bottom_flag_pt,</div>
<div class="line">   tip_flag_pt,</div>
<div class="line">   length, height, </div>
<div class="line">   l_x,<a class="code" href="namespaceGlobal__Parameters.html#ab360628e7830e43e355ce5768f6d6a6c">Global_Parameters::H</a>,</div>
<div class="line">   <a class="code" href="namespaceGlobal__Parameters.html#a0f0247cc83ba202413b50e7b4b7fceb0">Global_Parameters::Centre_x</a>,</div>
<div class="line">   <a class="code" href="namespaceGlobal__Parameters.html#af41282d812fdff4867e3d8c825886290">Global_Parameters::Centre_y</a>,</div>
<div class="line">   <a class="code" href="namespaceGlobal__Parameters.html#a126c1e491ef187867b6b7bfb52b476ad">Global_Parameters::Radius</a>,</div>
<div class="line">   fluid_time_stepper_pt);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// I happen to have found out by inspection that</span></div>
<div class="line"> <span class="comment">// node 5 in the hand-coded fluid mesh is at the </span></div>
<div class="line"> <span class="comment">// upstream tip of the cylinder</span></div>
<div class="line"> Fluid_control_node_pt=Fluid_mesh_pt-&gt;node_pt(5);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set error estimator for the fluid mesh</span></div>
<div class="line"> Z2ErrorEstimator* fluid_error_estimator_pt=<span class="keyword">new</span> Z2ErrorEstimator;</div>
<div class="line"> fluid_mesh_pt()-&gt;spatial_error_estimator_pt()=fluid_error_estimator_pt;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Refine uniformly</span></div>
<div class="line"> Fluid_mesh_pt-&gt;refine_uniformly();</div>
</div><!-- fragment --><p> We now add the various meshes to the <code>Problem's</code> collection of sub-meshes and combine them to a global mesh</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build combined global mesh</span></div>
<div class="line"> <span class="comment">//---------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Add Solid mesh the problem&#39;s collection of submeshes</span></div>
<div class="line"> add_sub_mesh(solid_mesh_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Add traction sub-meshes</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;3;i++)</div>
<div class="line">  {</div>
<div class="line">   add_sub_mesh(traction_mesh_pt(i));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Add fluid mesh</span></div>
<div class="line"> add_sub_mesh(fluid_mesh_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build combined &quot;global&quot; mesh</span></div>
<div class="line"> build_global_mesh();</div>
</div><!-- fragment --><p> The application of boundary conditions for the solid are straightforward: All displacements of the flag's left end (mesh boundary 3) are suppressed; the other faces are free. Strictly speaking, the pinning of the redundant solid pressure nodes is superfluous since the <code>RefineableQPVDElement</code> used for the discretisation of the flag employ a displacement-based formulation, but it is good practise to perform this step anyway to "future-proof" the code for the use of other element types.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Apply solid boundary conditons</span></div>
<div class="line"> <span class="comment">//-------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Solid mesh: Pin the left boundary (boundary 3) in both directions</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_side = mesh_pt()-&gt;nboundary_node(3);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Loop over the nodes</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_side;i++)</div>
<div class="line">  {</div>
<div class="line">   solid_mesh_pt()-&gt;boundary_node_pt(3,i)-&gt;pin_position(0);</div>
<div class="line">   solid_mesh_pt()-&gt;boundary_node_pt(3,i)-&gt;pin_position(1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin the redundant solid pressures (if any)</span></div>
<div class="line"> PVDEquationsBase&lt;2&gt;::pin_redundant_nodal_solid_pressures(</div>
<div class="line">  solid_mesh_pt()-&gt;element_pt());</div>
</div><!-- fragment --><p> The fluid has Dirichlet boundary conditions (prescribed velocity) everywhere apart from the outflow where only the horizontal velocity is unknown.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Apply fluid boundary conditions</span></div>
<div class="line"> <span class="comment">//--------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Fluid mesh: Horizontal, traction-free outflow; pinned elsewhere</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> num_bound = fluid_mesh_pt()-&gt;nboundary();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=0;ibound&lt;num_bound;ibound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod= fluid_mesh_pt()-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Parallel, axially traction free outflow at downstream end</span></div>
<div class="line">     <span class="keywordflow">if</span> (ibound != 1)</div>
<div class="line">      {</div>
<div class="line">       fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;pin(0);</div>
<div class="line">       fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;pin(1);</div>
<div class="line">      }</div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">       fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;pin(1);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }<span class="comment">//end_of_pin</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin redundant pressure dofs in fluid mesh</span></div>
<div class="line"> RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">  pin_redundant_nodal_pressures(fluid_mesh_pt()-&gt;element_pt());</div>
</div><!-- fragment --><p> We impose a parabolic inflow profile with the current value of the influx at the inlet (fluid mesh boundary 3).</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Apply boundary conditions for fluid</span></div>
<div class="line"> <span class="comment">//-------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Impose parabolic flow along boundary 3</span></div>
<div class="line"> <span class="comment">// Current flow rate</span></div>
<div class="line"> <span class="keywordtype">double</span> t=0.0;</div>
<div class="line"> <span class="keywordtype">double</span> ampl=<a class="code" href="namespaceGlobal__Parameters.html#a536aa5314a6cdb36af852e9513351d55">Global_Parameters::flux</a>(t);</div>
<div class="line"> <span class="keywordtype">unsigned</span> ibound=3; </div>
<div class="line"> <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">double</span> ycoord = Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;x(1); </div>
<div class="line">   <span class="keywordtype">double</span> uy = ampl*6.0*ycoord/Domain_height*(1.0-ycoord/Domain_height);</div>
<div class="line">   Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(0,uy);</div>
<div class="line">   Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(1,0.0);    </div>
<div class="line">  }</div>
</div><!-- fragment --><p> We complete the build of the solid elements by passing them the pointer to the constitutive equation, the gravity vector and the timescale ratio:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Complete build of solid elements</span></div>
<div class="line"> <span class="comment">//---------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Pass problem parameters to solid elements</span></div>
<div class="line"> <span class="keywordtype">unsigned</span>  n_element =solid_mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_element;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">//Cast to a solid element</span></div>
<div class="line">   SOLID_ELEMENT *el_pt = <span class="keyword">dynamic_cast&lt;</span>SOLID_ELEMENT*<span class="keyword">&gt;</span>(</div>
<div class="line">    solid_mesh_pt()-&gt;element_pt(i));</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Set the constitutive law</span></div>
<div class="line">   el_pt-&gt;constitutive_law_pt() =</div>
<div class="line">    <a class="code" href="namespaceGlobal__Parameters.html#adbd1f040f375c96fe56b3f475f7dbec2">Global_Parameters::Constitutive_law_pt</a>;</div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Set the body force</span></div>
<div class="line">   el_pt-&gt;body_force_fct_pt() = <a class="code" href="namespaceGlobal__Parameters.html#a200109847bf4cc26da4d00e8d68d569e">Global_Parameters::gravity</a>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Timescale ratio for solid</span></div>
<div class="line">   el_pt-&gt;lambda_sq_pt() = &amp;<a class="code" href="namespaceGlobal__Parameters.html#a3e3428638f89f970fcf2148b0bab1465">Global_Parameters::Lambda_sq</a>;</div>
<div class="line">  }</div>
</div><!-- fragment --><p> The fluid elements require pointers to the Reynolds and Womersley (product of Reynolds and Strouhal) numbers:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Complete build of fluid elements</span></div>
<div class="line"> <span class="comment">//---------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set physical parameters in the fluid mesh</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nelem=fluid_mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e=0;e&lt;nelem;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Upcast from GeneralisedElement to the present element</span></div>
<div class="line">   FLUID_ELEMENT* el_pt = <span class="keyword">dynamic_cast&lt;</span>FLUID_ELEMENT*<span class="keyword">&gt;</span></div>
<div class="line">    (fluid_mesh_pt()-&gt;element_pt(e));</div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Set the Reynolds number</span></div>
<div class="line">   el_pt-&gt;re_pt() = &amp;<a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Global_Parameters::Re</a>;   </div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Set the Womersley number</span></div>
<div class="line">   el_pt-&gt;re_st_pt() = &amp;<a class="code" href="namespaceGlobal__Parameters.html#a7a59a32365e87566069e458dc83bd18a">Global_Parameters::ReSt</a>;</div>
<div class="line">   </div>
<div class="line">  }<span class="comment">//end_of_loop</span></div>
</div><!-- fragment --><p> Setting up the fluid-structure interaction is done from "both" sides" of the fluid-solid interface: First we ensure that the no-slip condition is automatically applied to all fluid nodes that are located on the three faces of the flag (mesh boundaries 5, 6 and 7). This is done by passing the function pointer to the <br  />
 <code>FSI_functions::apply_no_slip_on_moving_wall()</code> function to the relevant fluid nodes (<a href="../../../navier_stokes/osc_ellipse/html/index.html">recall</a> that the auxiliary node update functions are automatically executed whenever the position of a node is updated by the algebraic node update). Since the no-slip condition (1) involves the Strouhal number (which, in the current problem, is not equal to the default value of <code>FSI_functions::Strouhal_for_no_slip=1.0</code>), we overwrite the default assignment with the actual Strouhal number in the problem.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup FSI</span></div>
<div class="line"> <span class="comment">//----------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pass Strouhal number to the helper function that automatically applies</span></div>
<div class="line"> <span class="comment">// the no-slip condition</span></div>
<div class="line"> FSI_functions::Strouhal_for_no_slip=<a class="code" href="namespaceGlobal__Parameters.html#af1af40a0df651e86bc1be273fafa98da">Global_Parameters::St</a>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// The velocity of the fluid nodes on the wall (fluid mesh boundary 5,6,7)</span></div>
<div class="line"> <span class="comment">// is set by the wall motion -- hence the no-slip condition must be</span></div>
<div class="line"> <span class="comment">// re-applied whenever a node update is performed for these nodes. </span></div>
<div class="line"> <span class="comment">// Such tasks may be performed automatically by the auxiliary node update </span></div>
<div class="line"> <span class="comment">// function specified by a function pointer:</span></div>
<div class="line"> <span class="keywordflow">if</span> (!<a class="code" href="namespaceGlobal__Parameters.html#aac13d615d2acd78d22a3137ffd62f7aa">Global_Parameters::Ignore_fluid_loading</a>)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=5;ibound&lt;8;ibound++ )</div>
<div class="line">    { </div>
<div class="line">     <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">      {   </div>
<div class="line">       Fluid_mesh_pt-&gt;boundary_node_pt(ibound, inod)-&gt;</div>
<div class="line">        set_auxiliary_node_update_fct_pt(</div>
<div class="line">         FSI_functions::apply_no_slip_on_moving_wall);</div>
<div class="line">      }</div>
<div class="line">    } <span class="comment">// done automatic application of no-slip</span></div>
</div><!-- fragment --><p> Next, we set up the lookup schemes required by the <code>FSISolidTractionElements</code> to establish which fluid elements affect the traction onto the solid:</p>
<div class="fragment"><div class="line">  </div>
<div class="line">   <span class="comment">// Work out which fluid dofs affect the residuals of the wall elements:</span></div>
<div class="line">   <span class="comment">// We pass the boundary between the fluid and solid meshes and </span></div>
<div class="line">   <span class="comment">// pointers to the meshes. The interaction boundary are boundaries 5,6,7</span></div>
<div class="line">   <span class="comment">// of the 2D fluid mesh.</span></div>
<div class="line">   FSI_functions::setup_fluid_load_info_for_solid_elements&lt;FLUID_ELEMENT,2&gt;</div>
<div class="line">    (<span class="keyword">this</span>,5,Fluid_mesh_pt,Traction_mesh_pt[0]);  </div>
<div class="line">   </div>
<div class="line">   FSI_functions::setup_fluid_load_info_for_solid_elements&lt;FLUID_ELEMENT,2&gt;</div>
<div class="line">    (<span class="keyword">this</span>,6,Fluid_mesh_pt,Traction_mesh_pt[2]);  </div>
<div class="line">   </div>
<div class="line">   FSI_functions::setup_fluid_load_info_for_solid_elements&lt;FLUID_ELEMENT,2&gt;</div>
<div class="line">    (<span class="keyword">this</span>,7,Fluid_mesh_pt,Traction_mesh_pt[1]); </div>
<div class="line">  } </div>
</div><!-- fragment --><p>All interactions have now been specified and we conclude by assigning the equation numbers</p>
<div class="fragment"><div class="line"> <span class="comment">// Assign equation numbers</span></div>
<div class="line"> cout &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl; </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}<span class="comment">//end_of_constructor</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="set_traction"></a>
Create traction elements</h1>
<p>This is a helper function that attaches <code>FSISolidTractionElement</code> to the solid elements that are exposed to the fluid traction. We store the elements in three distinct sub-meshes &ndash; one for each face. (Yet another mesh, pointed to by <code>Combined_traction_mesh_pt</code>, is created for post-processing purposes.)</p>
<div class="fragment"><div class="line"><span class="comment">//============start_of_create_traction_elements==============================</span></div>
<div class="line"><span class="comment">/// Create FSI traction elements </span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> FLUID_ELEMENT,<span class="keyword">class</span> SOLID_ELEMENT &gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#ad460a2e860c9425297cf70ee125de10b">TurekProblem&lt;FLUID_ELEMENT,SOLID_ELEMENT&gt;::create_fsi_traction_elements</a>()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Container to collect all nodes in the traction meshes</span></div>
<div class="line"> std::set&lt;SolidNode*&gt; all_nodes;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Traction elements are located on boundaries 0-2:</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> b=0;b&lt;3;b++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// How many bulk elements are adjacent to boundary b?</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> n_element = solid_mesh_pt()-&gt;nboundary_element(b);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Loop over the bulk elements adjacent to boundary b?</span></div>
<div class="line">   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Get pointer to the bulk element that is adjacent to boundary b</span></div>
<div class="line">     SOLID_ELEMENT* bulk_elem_pt = <span class="keyword">dynamic_cast&lt;</span>SOLID_ELEMENT*<span class="keyword">&gt;</span>(</div>
<div class="line">      solid_mesh_pt()-&gt;boundary_element_pt(b,e));</div>
<div class="line">     </div>
<div class="line">     <span class="comment">//What is the index of the face of the element e along boundary b</span></div>
<div class="line">     <span class="keywordtype">int</span> face_index = solid_mesh_pt()-&gt;face_index_at_boundary(b,e);</div>
<div class="line">          </div>
<div class="line">     <span class="comment">// Create new element and add to mesh</span></div>
<div class="line">     Traction_mesh_pt[b]-&gt;add_element_pt(</div>
<div class="line">      <span class="keyword">new</span> FSISolidTractionElement&lt;SOLID_ELEMENT,2&gt;(bulk_elem_pt,face_index));</div>
<div class="line">     </div>
<div class="line">    } <span class="comment">//end of loop over bulk elements adjacent to boundary b</span></div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Identify unique nodes</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> nnod=solid_mesh_pt()-&gt;nboundary_node(b);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;nnod;j++)</div>
<div class="line">    {</div>
<div class="line">     all_nodes.insert(solid_mesh_pt()-&gt;boundary_node_pt(b,j));</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build combined mesh of fsi traction elements</span></div>
<div class="line"> Combined_traction_mesh_pt=<span class="keyword">new</span> SolidMesh(Traction_mesh_pt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Stick nodes into combined traction mesh</span></div>
<div class="line"> <span class="keywordflow">for</span> (std::set&lt;SolidNode*&gt;::iterator it=all_nodes.begin();</div>
<div class="line">      it!=all_nodes.end();it++)</div>
<div class="line">  {</div>
<div class="line">   Combined_traction_mesh_pt-&gt;add_node_pt(*it);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of create_traction_elements</span></div>
</div><!-- fragment --><hr  />
 <hr  />
 <h1><a class="anchor" id="check"></a>
Actions before Newton convergence check</h1>
<p>The algebraic node-update procedure updates the positions in response to changes in the solid displacements but this is not done automatically when the Newton solver updates the solid mechanics degrees of freedom. We therefore force a node-update before the Newton convergence check.</p>
 <div class="fragment"><div class="line"><span class="comment">//====start_of_actions_before_newton_convergence_check===================</span></div>
<div class="line"><span class="comment">/// Update the (dependent) fluid node positions following the</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// update of the solid variables</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> FLUID_ELEMENT,<span class="keyword">class</span> SOLID_ELEMENT&gt; </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#aa896171b1a817ca35cba9b723bb15ed2">TurekProblem&lt;FLUID_ELEMENT,SOLID_ELEMENT&gt;</a></div>
<div class="line"><a class="code" href="classTurekProblem.html#aa896171b1a817ca35cba9b723bb15ed2">::actions_before_newton_convergence_check</a> ()</div>
<div class="line">{</div>
<div class="line"> fluid_mesh_pt()-&gt;node_update();</div>
<div class="line">}</div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="timestep"></a>
Actions before the timestep</h1>
<p>Before each timestep we update the inflow profile for all fluid nodes on mesh boundary 3.</p>
<div class="fragment"><div class="line"><span class="comment">//===== start_of_actions_before_implicit_timestep=========================</span></div>
<div class="line"><span class="comment">/// Actions before implicit timestep: Update inflow profile</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> FLUID_ELEMENT,<span class="keyword">class</span> SOLID_ELEMENT&gt; </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#a4ad226ceec27cb3c3ea4d1ecfd4e573f">TurekProblem&lt;FLUID_ELEMENT,SOLID_ELEMENT&gt;::</a></div>
<div class="line"><a class="code" href="classTurekProblem.html#a4ad226ceec27cb3c3ea4d1ecfd4e573f">actions_before_implicit_timestep</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Current time</span></div>
<div class="line"> <span class="keywordtype">double</span> t=time_pt()-&gt;time();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Amplitude of flow</span></div>
<div class="line"> <span class="keywordtype">double</span> ampl=<a class="code" href="namespaceGlobal__Parameters.html#a536aa5314a6cdb36af852e9513351d55">Global_Parameters::flux</a>(t);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Update parabolic flow along boundary 3</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> ibound=3; </div>
<div class="line"> <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">double</span> ycoord = Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;x(1); </div>
<div class="line">   <span class="keywordtype">double</span> uy = ampl*6.0*ycoord/Domain_height*(1.0-ycoord/Domain_height);</div>
<div class="line">   Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(0,uy);</div>
<div class="line">   Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(1,0.0);    </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end_of_actions_before_implicit_timestep</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="after_adapt"></a>
Actions after adapt</h1>
<p>After each adaptation, we unpin and re-pin all redundant pressures degrees of freedom. This is necessary because their "redundant-ness" may have been altered by changes in the refinement pattern; see <a href="../../../navier_stokes/adaptive_driven_cavity/html/index.html">another tutorial</a> for details. We ensure the automatic application of the no-slip condition on fluid nodes that are located on the faces of the flag, and re-setup the FSI lookup scheme that tells <code>FSISolidTractionElements</code> which fluid elements are located next to their Gauss points.</p>
<div class="fragment"><div class="line"><span class="comment">//=====================start_of_actions_after_adapt=======================</span></div>
<div class="line"><span class="comment">///  Actions after adapt: Re-setup FSI</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> FLUID_ELEMENT,<span class="keyword">class</span> SOLID_ELEMENT &gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#a39df0332d7606a5befe89bb0e581184b">TurekProblem&lt;FLUID_ELEMENT,SOLID_ELEMENT&gt;::actions_after_adapt</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Unpin all pressure dofs</span></div>
<div class="line"> RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">  unpin_all_pressure_dofs(fluid_mesh_pt()-&gt;element_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin redundant pressure dofs</span></div>
<div class="line"> RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">  pin_redundant_nodal_pressures(fluid_mesh_pt()-&gt;element_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Unpin all solid pressure dofs</span></div>
<div class="line"> PVDEquationsBase&lt;2&gt;::</div>
<div class="line">  unpin_all_solid_pressure_dofs(solid_mesh_pt()-&gt;element_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin the redundant solid pressures (if any)</span></div>
<div class="line"> PVDEquationsBase&lt;2&gt;::pin_redundant_nodal_solid_pressures(</div>
<div class="line">  solid_mesh_pt()-&gt;element_pt());</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// The velocity of the fluid nodes on the wall (fluid mesh boundary 5,6,7)</span></div>
<div class="line"> <span class="comment">// is set by the wall motion -- hence the no-slip condition must be</span></div>
<div class="line"> <span class="comment">// re-applied whenever a node update is performed for these nodes. </span></div>
<div class="line"> <span class="comment">// Such tasks may be performed automatically by the auxiliary node update </span></div>
<div class="line"> <span class="comment">// function specified by a function pointer:</span></div>
<div class="line"> <span class="keywordflow">if</span> (!<a class="code" href="namespaceGlobal__Parameters.html#aac13d615d2acd78d22a3137ffd62f7aa">Global_Parameters::Ignore_fluid_loading</a>)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=5;ibound&lt;8;ibound++ )</div>
<div class="line">    { </div>
<div class="line">     <span class="keywordtype">unsigned</span> num_nod= Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">      {   </div>
<div class="line">       Fluid_mesh_pt-&gt;boundary_node_pt(ibound, inod)-&gt;</div>
<div class="line">        set_auxiliary_node_update_fct_pt(</div>
<div class="line">         FSI_functions::apply_no_slip_on_moving_wall);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Re-setup the fluid load information for fsi solid traction elements</span></div>
<div class="line">   FSI_functions::setup_fluid_load_info_for_solid_elements&lt;FLUID_ELEMENT,2&gt;</div>
<div class="line">    (<span class="keyword">this</span>,5,Fluid_mesh_pt,Traction_mesh_pt[0]); </div>
<div class="line">   </div>
<div class="line">   FSI_functions::setup_fluid_load_info_for_solid_elements&lt;FLUID_ELEMENT,2&gt;</div>
<div class="line">    (<span class="keyword">this</span>,6,Fluid_mesh_pt,Traction_mesh_pt[2]); </div>
<div class="line">   </div>
<div class="line">   FSI_functions::setup_fluid_load_info_for_solid_elements&lt;FLUID_ELEMENT,2&gt;</div>
<div class="line">    (<span class="keyword">this</span>,7,Fluid_mesh_pt,Traction_mesh_pt[1]); </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}<span class="comment">// end of actions_after_adapt</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="doc"></a>
Post-processing</h1>
<p>The function <code>doc_solution(...)</code> produces the output for the fluid, solid and traction meshes and writes selected data to the trace file.</p>
<div class="fragment"><div class="line"><span class="comment">//=====start_of_doc_solution========================================</span></div>
<div class="line"><span class="comment">/// Doc the solution</span></div>
<div class="line"><span class="comment"></span><span class="comment">//==================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> FLUID_ELEMENT,<span class="keyword">class</span> SOLID_ELEMENT &gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classTurekProblem.html#a2cf0eb1610b4c3a7cdbd3c7948cdd46e">TurekProblem&lt;FLUID_ELEMENT,SOLID_ELEMENT&gt;::doc_solution</a>(</div>
<div class="line"> DocInfo&amp; doc_info, ofstream&amp; trace_file)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  FSI_functions::doc_fsi&lt;AlgebraicNode&gt;(Fluid_mesh_pt,</span></div>
<div class="line"><span class="comment">//                                        Combined_traction_mesh_pt,</span></div>
<div class="line"><span class="comment">//                                        doc_info);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//  pause(&quot;done&quot;);</span></div>
<div class="line"> </div>
<div class="line"> ofstream some_file;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of plot points</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_plot = 5; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output solid solution</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/solid_soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> solid_mesh_pt()-&gt;output(some_file,n_plot);</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output fluid solution</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> fluid_mesh_pt()-&gt;output(some_file,n_plot);</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">//Output the traction</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/traction%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"><span class="comment">// Loop over the traction meshes</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;3;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Loop over the element in traction_mesh_pt</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> n_element = Traction_mesh_pt[i]-&gt;nelement();</div>
<div class="line">   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">    {</div>
<div class="line">     FSISolidTractionElement&lt;SOLID_ELEMENT,2&gt;* el_pt = </div>
<div class="line">      <span class="keyword">dynamic_cast&lt;</span>FSISolidTractionElement&lt;SOLID_ELEMENT,2&gt;* <span class="keyword">&gt;</span> (</div>
<div class="line">       Traction_mesh_pt[i]-&gt;element_pt(e) );</div>
<div class="line">     </div>
<div class="line">     el_pt-&gt;output(some_file,5);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> some_file.close();  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Write trace (we&#39;re only using Taylor Hood elements so we know that</span></div>
<div class="line"> <span class="comment">// the pressure is the third value at the fluid control node...</span></div>
<div class="line"> trace_file &lt;&lt; time_pt()-&gt;time() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; Solid_control_node_pt-&gt;x(0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; Solid_control_node_pt-&gt;x(1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; Fluid_control_node_pt-&gt;value(2) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">            &lt;&lt; <a class="code" href="namespaceGlobal__Parameters.html#a536aa5314a6cdb36af852e9513351d55">Global_Parameters::flux</a>(time_pt()-&gt;time()) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;Doced solution for step &quot;</span> </div>
<div class="line">      &lt;&lt; doc_info.number() </div>
<div class="line">      &lt;&lt; std::endl &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">}<span class="comment">//end_of_doc_solution</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="com_ex"></a>
Further comments and exercises</h1>
<ul>
<li>When completing the build of the <code>FSISolidTractionElements</code> (the elements that apply the fluid traction to the solid elements that are exposed to the fluid) we specified the number of the solid mesh boundary they are located on, using <br  />
<br  />
<div class="fragment"><div class="line">elem_pt-&gt;set_boundary_number_in_bulk_mesh(bound);</div>
</div><!-- fragment --> <br  />
 This information is required when setting up the fluid-structure interaction because the <code>MeshAsGeomObject</code> representation of the mesh of <code>FSISolidTractionElements</code> is parametrised by the boundary coordinate in the solid mesh. Explore the details of the implementation by commenting out the relevant line of code and use the debugger to find out how and where the code fails. <b>Note:</b> Since this step is somewhat subtle and therefore easily forgotten, the <code>FSISolidTractionElements</code> issue an explicit warning if the bulk boundary number has not been set &ndash; but only if the the library is compiled in PARANOID mode. <br  />
<br  />
</li>
<li>When comparing our results against those in Turek &amp; Hron's benchmark, we only focused on the period and amplitude of the fully-developed self-excited oscillations. The benchmark data also provides data on the time-dependent variations of the drag and lift coefficients. Design suitable <code>FaceElements</code> (to be attached to the faces of the Navier-Stokes elements that are adjacent to the flag or the cylinder) to compute these quantities. The <a href="../../../the_data_structure/html/classoomph_1_1NavierStokesSurfacePowerElement.html"><code>NavierStokesSurfacePowerElements</code></a> should provide a good basis for these.</li>
</ul>
<hr  />
 <hr  />
<h1><a class="anchor" id="ackn"></a>
Acknowledgements</h1>
<ul>
<li>This code was originally developed by Stefan Kollmannsberger and his students Iason Papaioannou and <br  />
 Orkun Oezkan Doenmez. It was completed by Floraine Cordier.</li>
</ul>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory:<br  />
<br  />
<center> <a href="../../../../demo_drivers/interaction/turek_flag/">demo_drivers/interaction/turek_flag/ </a> </center><br  />
</li>
<li>The driver code is: <br  />
<br  />
<center> <a href="../../../../demo_drivers/interaction/turek_flag/turek_flag.cc">demo_drivers/interaction/turek_flag/turek_flag.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:30:28
        </div>
      </div>
    </footer>
</body>
</html>
