This is a very simple fluid-\/structure interaction problem\+: We study the finite-\/\+Reynolds number internal flow generated by an oscillating ring. The wall motion only has a single degree of freedom\+: The ring\textquotesingle{}s average radius, which needs to be adjusted to conserve mass. \mbox{[}This is a warm-\/up problem for the full fluid structure interaction problem discussed in the next example\mbox{]}. We compare the predictions for the flow field against asymptotic results.

The nodal positions in the fluid domain is updated by {\ttfamily Macro\+Elements}.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//LIC// ====================================================================}}
\DoxyCodeLine{\textcolor{comment}{//LIC// This file forms part of oomph-\/lib, the object-\/oriented, }}
\DoxyCodeLine{\textcolor{comment}{//LIC// multi-\/physics finite-\/element library, available }}
\DoxyCodeLine{\textcolor{comment}{//LIC// at http://www.oomph-\/lib.org.}}
\DoxyCodeLine{\textcolor{comment}{//LIC// }}
\DoxyCodeLine{\textcolor{comment}{//LIC// Copyright (C) 2006-\/2024 Matthias Heil and Andrew Hazel}}
\DoxyCodeLine{\textcolor{comment}{//LIC// }}
\DoxyCodeLine{\textcolor{comment}{//LIC// This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\textcolor{comment}{//LIC// modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\textcolor{comment}{//LIC// License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\textcolor{comment}{//LIC// version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\textcolor{comment}{//LIC// }}
\DoxyCodeLine{\textcolor{comment}{//LIC// This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\textcolor{comment}{//LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\textcolor{comment}{//LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU}}
\DoxyCodeLine{\textcolor{comment}{//LIC// Lesser General Public License for more details.}}
\DoxyCodeLine{\textcolor{comment}{//LIC// }}
\DoxyCodeLine{\textcolor{comment}{//LIC// You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\textcolor{comment}{//LIC// License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\textcolor{comment}{//LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA}}
\DoxyCodeLine{\textcolor{comment}{//LIC// 02110-\/1301  USA.}}
\DoxyCodeLine{\textcolor{comment}{//LIC// }}
\DoxyCodeLine{\textcolor{comment}{//LIC// The authors may be contacted at oomph-\/lib@maths.man.ac.uk.}}
\DoxyCodeLine{\textcolor{comment}{//LIC// }}
\DoxyCodeLine{\textcolor{comment}{//LIC//====================================================================}}
\DoxyCodeLine{\textcolor{comment}{// Driver for 2D Navier Stokes flow, driven by oscillating ring}}
\DoxyCodeLine{\textcolor{comment}{// with pseudo-\/elasticity: The mean radius of ring is adjusted to}}
\DoxyCodeLine{\textcolor{comment}{// allow conservation of volume (area).}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Oomph-\/lib includes}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "{}generic.h"{}}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "{}navier\_stokes.h"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//Need to instantiate templated mesh}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "{}meshes/quarter\_circle\_sector\_mesh.h"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//Include namespace containing Sarah's asymptotics }}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{osc__ring__sarah__asymptotics_8h}{osc\_ring\_sarah\_asymptotics.h}}"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }\mbox{\hyperlink{namespaceoomph}{oomph}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }MathematicalConstants;}
\DoxyCodeLine{}
\DoxyCodeLine{  }
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{}  }
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//==================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Namespace for physical parameters}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//==================================================}}
\DoxyCodeLine{\textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceGlobal__Physical__Variables}{Global\_Physical\_Variables}}}
\DoxyCodeLine{\{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Reynolds number}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Re}}=100.0;  \textcolor{comment}{// ADJUST\_PRIORITY }}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Reynolds x Strouhal number}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a085ee4bf968ffdd01a41b8c41864f907}{ReSt}}=100.0; \textcolor{comment}{// ADJUST\_PRIORITY }}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//====================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Driver for oscillating ring problem: Wall performs oscillations}}
\DoxyCodeLine{\textcolor{comment}{/// that resemble eigenmodes of freely oscillating ring and drives}}
\DoxyCodeLine{\textcolor{comment}{/// viscous fluid flow. Mean radius of wall is adjustable and}}
\DoxyCodeLine{\textcolor{comment}{/// responds to a pressure value in the fluid to allow for}}
\DoxyCodeLine{\textcolor{comment}{/// mass conservation. }}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>}
\DoxyCodeLine{\textcolor{keyword}{class }\mbox{\hyperlink{classOscRingNStProblem}{OscRingNStProblem}} : \textcolor{keyword}{public} Problem}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Constructor: Pass timestep and function pointer to the }}
\DoxyCodeLine{\textcolor{comment}{ /// solution that provides the initial conditions for the fluid}}
\DoxyCodeLine{\textcolor{comment}{} \mbox{\hyperlink{classOscRingNStProblem}{OscRingNStProblem}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt,}
\DoxyCodeLine{                   FiniteElement::UnsteadyExactSolutionFctPt IC\_fct\_pt);}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Destructor (empty)}}
\DoxyCodeLine{\textcolor{comment}{} \string~\mbox{\hyperlink{classOscRingNStProblem}{OscRingNStProblem}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Get pointer to wall as geometric object}}
\DoxyCodeLine{\textcolor{comment}{} GeomObject* wall\_pt()}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{keywordflow}{return} Wall\_pt;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Update after solve (empty)}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} actions\_after\_newton\_solve()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Update the problem specs before solve (empty)}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} actions\_before\_newton\_solve()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Update the problem specs before checking Newton}}
\DoxyCodeLine{\textcolor{comment}{ /// convergence: Update the fluid mesh and re-\/set velocity}}
\DoxyCodeLine{\textcolor{comment}{ ///  boundary conditions -\/-\/ no slip velocity on the wall means}}
\DoxyCodeLine{\textcolor{comment}{ /// that the velocity on the wall is dependent.}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} actions\_before\_newton\_convergence\_check() }
\DoxyCodeLine{ \{}
\DoxyCodeLine{  \textcolor{comment}{// Update the fluid mesh -\/-\/ auxiliary update function for algebraic}}
\DoxyCodeLine{  \textcolor{comment}{// nodes automatically updates no slip condition.}}
\DoxyCodeLine{  fluid\_mesh\_pt()-\/>node\_update(); }
\DoxyCodeLine{ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Update the problem specs after adaptation:}}
\DoxyCodeLine{\textcolor{comment}{ /// Set auxiliary update function that applies no slip on all }}
\DoxyCodeLine{\textcolor{comment}{ /// boundary nodes and choose fluid pressure dof that drives}}
\DoxyCodeLine{\textcolor{comment}{ /// the wall deformation}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} actions\_after\_adapt() }
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{comment}{// Ring boundary: No slip; this also implies that the velocity needs}}
\DoxyCodeLine{   \textcolor{comment}{// to be updated in response to wall motion. This needs to be reset}}
\DoxyCodeLine{   \textcolor{comment}{// every time the mesh is changed -\/-\/ there's no mechanism by which}}
\DoxyCodeLine{   \textcolor{comment}{// auxiliary update functions are copied to newly created nodes.}}
\DoxyCodeLine{   \textcolor{comment}{// (that's because unlike boundary conditions, they don't }}
\DoxyCodeLine{   \textcolor{comment}{// occur exclusively at boundaries)}}
\DoxyCodeLine{   \textcolor{keywordtype}{unsigned} ibound=1;}
\DoxyCodeLine{   \{}
\DoxyCodeLine{    \textcolor{keywordtype}{unsigned} num\_nod= fluid\_mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{     \{}
\DoxyCodeLine{      fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>}
\DoxyCodeLine{       set\_auxiliary\_node\_update\_fct\_pt(}
\DoxyCodeLine{        FSI\_functions::apply\_no\_slip\_on\_moving\_wall); }
\DoxyCodeLine{     \}}
\DoxyCodeLine{   \}}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Set the reference pressure as the constant pressure in element 0}}
\DoxyCodeLine{   \textcolor{keyword}{dynamic\_cast<}PseudoBucklingRingElement*\textcolor{keyword}{>}(Wall\_pt)}
\DoxyCodeLine{    -\/>set\_reference\_pressure\_pt(fluid\_mesh\_pt()-\/>element\_pt(0)}
\DoxyCodeLine{                                -\/>internal\_data\_pt(0));}
\DoxyCodeLine{  \}}
\DoxyCodeLine{   \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Run the time integration for ntsteps steps}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} unsteady\_run(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \&ntsteps, \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& restarted,}
\DoxyCodeLine{                   DocInfo\& doc\_info);}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Set initial condition (incl previous timesteps) according}}
\DoxyCodeLine{\textcolor{comment}{ /// to specified function. }}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} set\_initial\_condition();}
\DoxyCodeLine{ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Doc the solution}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} doc\_solution(DocInfo\& doc\_info);}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Access function for the fluid mesh}}
\DoxyCodeLine{\textcolor{comment}{} MacroElementNodeUpdateRefineableQuarterCircleSectorMesh<ELEMENT>* fluid\_mesh\_pt()}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{keywordflow}{return} Fluid\_mesh\_pt; }
\DoxyCodeLine{  \}}
\DoxyCodeLine{ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Dump problem data.}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} dump\_it(ofstream\& dump\_file, DocInfo doc\_info);}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Read problem data.}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} restart(ifstream\& restart\_file);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Write header for trace file}}
\DoxyCodeLine{\textcolor{comment}{} \textcolor{keywordtype}{void} write\_trace\_file\_header();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Function pointer to set the intial condition}}
\DoxyCodeLine{\textcolor{comment}{} FiniteElement::UnsteadyExactSolutionFctPt IC\_Fct\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Pointer to wall}}
\DoxyCodeLine{\textcolor{comment}{} GeomObject* Wall\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Pointer to fluid mesh}}
\DoxyCodeLine{\textcolor{comment}{} MacroElementNodeUpdateRefineableQuarterCircleSectorMesh<ELEMENT>* Fluid\_mesh\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Pointer to wall mesh (contains only a single GeneralisedElement)}}
\DoxyCodeLine{\textcolor{comment}{} Mesh* Wall\_mesh\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Trace file}}
\DoxyCodeLine{\textcolor{comment}{} ofstream Trace\_file;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Pointer to node on coarsest mesh on which velocity is traced}}
\DoxyCodeLine{\textcolor{comment}{} Node* Veloc\_trace\_node\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{ /// Pointer to node in symmetry plane on coarsest mesh at }}
\DoxyCodeLine{\textcolor{comment}{ /// which velocity is traced}}
\DoxyCodeLine{\textcolor{comment}{} Node* Sarah\_veloc\_trace\_node\_pt;}
\DoxyCodeLine{}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Constructor: Pass (constant) timestep and function pointer to the solution }}
\DoxyCodeLine{\textcolor{comment}{/// that provides the initial conditions for the fluid.}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>}
\DoxyCodeLine{\mbox{\hyperlink{classOscRingNStProblem_acd5f633c43eb4cfb43c45361ecf85e6b}{OscRingNStProblem<ELEMENT>::OscRingNStProblem}}(\textcolor{keyword}{const} \textcolor{keywordtype}{double}\& dt, }
\DoxyCodeLine{FiniteElement::UnsteadyExactSolutionFctPt IC\_fct\_pt) : IC\_Fct\_pt(IC\_fct\_pt)}
\DoxyCodeLine{\{ }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Period of oscillation}}
\DoxyCodeLine{ \textcolor{keywordtype}{double} T=1.0;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{//Allocate the timestepper}}
\DoxyCodeLine{ add\_time\_stepper\_pt(\textcolor{keyword}{new} BDF<4>);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Initialise timestep -\/-\/ also sets the weights for all timesteppers}}
\DoxyCodeLine{ \textcolor{comment}{// in the problem.}}
\DoxyCodeLine{ initialise\_dt(dt);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Parameters for pseudo-\/buckling ring }}
\DoxyCodeLine{ \textcolor{keywordtype}{double} eps\_buckl=0.1;  \textcolor{comment}{// ADJUST\_PRIORITY }}
\DoxyCodeLine{ \textcolor{keywordtype}{double} ampl\_ratio=-\/0.5;  \textcolor{comment}{// ADJUST\_PRIORITY }}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} n\_buckl=2; \textcolor{comment}{// ADJUST\_PRIORITY }}
\DoxyCodeLine{ \textcolor{keywordtype}{double} r\_0=1.0;}
\DoxyCodeLine{ }
\DoxyCodeLine{ \textcolor{comment}{// Build wall geometric element}}
\DoxyCodeLine{ Wall\_pt=\textcolor{keyword}{new} PseudoBucklingRingElement(eps\_buckl,ampl\_ratio,n\_buckl,r\_0,T,}
\DoxyCodeLine{                                       time\_stepper\_pt());}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Fluid mesh is suspended from wall between these two Lagrangian}}
\DoxyCodeLine{ \textcolor{comment}{// coordinates:}}
\DoxyCodeLine{ \textcolor{keywordtype}{double} xi\_lo=0.0;}
\DoxyCodeLine{ \textcolor{keywordtype}{double} xi\_hi=2.0*atan(1.0);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Fractional position of dividing line for two outer blocks in fluid mesh}}
\DoxyCodeLine{ \textcolor{keywordtype}{double} fract\_mid=0.5;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Build fluid mesh}}
\DoxyCodeLine{ Fluid\_mesh\_pt=\textcolor{keyword}{new} MacroElementNodeUpdateRefineableQuarterCircleSectorMesh<ELEMENT>(}
\DoxyCodeLine{  Wall\_pt,xi\_lo,fract\_mid,xi\_hi,time\_stepper\_pt());}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Set error estimator}}
\DoxyCodeLine{ Z2ErrorEstimator* error\_estimator\_pt=\textcolor{keyword}{new} Z2ErrorEstimator;}
\DoxyCodeLine{ Fluid\_mesh\_pt-\/>spatial\_error\_estimator\_pt()=error\_estimator\_pt;}
\DoxyCodeLine{  }
\DoxyCodeLine{ \textcolor{comment}{// Fluid mesh is first sub-\/mesh}}
\DoxyCodeLine{ add\_sub\_mesh(Fluid\_mesh\_pt);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Build wall mesh }}
\DoxyCodeLine{ Wall\_mesh\_pt=\textcolor{keyword}{new} Mesh;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Wall mesh is completely empty: Add Wall element in its GeneralisedElement}}
\DoxyCodeLine{ \textcolor{comment}{// incarnation}}
\DoxyCodeLine{ Wall\_mesh\_pt-\/>add\_element\_pt(\textcolor{keyword}{dynamic\_cast<}GeneralisedElement*\textcolor{keyword}{>}(Wall\_pt));}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Wall mesh is second sub-\/mesh}}
\DoxyCodeLine{ add\_sub\_mesh(Wall\_mesh\_pt);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Combine all submeshes into a single Mesh}}
\DoxyCodeLine{ build\_global\_mesh();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Extract pointer to node at center of mesh (this node exists}}
\DoxyCodeLine{ \textcolor{comment}{// at all refinement levels and can be used to doc continuous timetrace}}
\DoxyCodeLine{ \textcolor{comment}{// of velocities)}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} nnode=fluid\_mesh\_pt()-\/>finite\_element\_pt(0)-\/>nnode();}
\DoxyCodeLine{ Veloc\_trace\_node\_pt=fluid\_mesh\_pt()-\/>finite\_element\_pt(0)-\/>node\_pt(nnode-\/1);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{//  Extract pointer to node in symmetry plane (this node exists}}
\DoxyCodeLine{ \textcolor{comment}{// at all refinement levels and can be used to doc continuous timetrace}}
\DoxyCodeLine{ \textcolor{comment}{// of velocities)}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} nnode\_1d=\textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(}
\DoxyCodeLine{  fluid\_mesh\_pt()-\/>finite\_element\_pt(0))-\/>nnode\_1d();}
\DoxyCodeLine{ Sarah\_veloc\_trace\_node\_pt=fluid\_mesh\_pt()-\/>}
\DoxyCodeLine{  finite\_element\_pt(0)-\/>node\_pt(nnode\_1d-\/1);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// The "{}pseudo-\/elastic"{} wall element is "{}loaded"{} by a pressure.}}
\DoxyCodeLine{ \textcolor{comment}{// Use the "{}constant"{} pressure component in Crouzeix Raviart}}
\DoxyCodeLine{ \textcolor{comment}{// fluid element as that pressure. }}
\DoxyCodeLine{ \textcolor{keyword}{dynamic\_cast<}PseudoBucklingRingElement*\textcolor{keyword}{>}(Wall\_pt)}
\DoxyCodeLine{  -\/>set\_reference\_pressure\_pt(fluid\_mesh\_pt()-\/>element\_pt(0)}
\DoxyCodeLine{                              -\/>internal\_data\_pt(0));}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Set the boundary conditions for this problem:}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// All nodes are free by default -\/-\/ just pin the ones that have }}
\DoxyCodeLine{ \textcolor{comment}{// Dirichlet conditions here. }}
\DoxyCodeLine{ }
\DoxyCodeLine{ \textcolor{comment}{// Bottom boundary: }}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} ibound=0;}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{keywordtype}{unsigned} num\_nod= fluid\_mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{    \{}
\DoxyCodeLine{     \textcolor{comment}{// Pin vertical velocity}}
\DoxyCodeLine{     \{}
\DoxyCodeLine{       fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>pin(1); }
\DoxyCodeLine{     \}}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{  }
\DoxyCodeLine{ \textcolor{comment}{// Ring boundary: No slip; this also implies that the velocity needs}}
\DoxyCodeLine{ \textcolor{comment}{// to be updated in response to wall motion}}
\DoxyCodeLine{ ibound=1;}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{keywordtype}{unsigned} num\_nod=fluid\_mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{    \{}
\DoxyCodeLine{     \textcolor{comment}{// Which node are we dealing with?}}
\DoxyCodeLine{     Node* node\_pt=fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod);}
\DoxyCodeLine{}
\DoxyCodeLine{     \textcolor{comment}{// Set auxiliary update function pointer to apply no-\/slip condition}}
\DoxyCodeLine{     \textcolor{comment}{// to velocities whenever nodal position is updated}}
\DoxyCodeLine{     node\_pt-\/>set\_auxiliary\_node\_update\_fct\_pt(}
\DoxyCodeLine{      FSI\_functions::apply\_no\_slip\_on\_moving\_wall);}
\DoxyCodeLine{     }
\DoxyCodeLine{     \textcolor{comment}{// Pin both velocities}}
\DoxyCodeLine{     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i=0;i<2;i++)}
\DoxyCodeLine{      \{}
\DoxyCodeLine{       node\_pt-\/>pin(i); }
\DoxyCodeLine{      \}}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{                        }
\DoxyCodeLine{ \textcolor{comment}{// Left boundary:}}
\DoxyCodeLine{ ibound=2;}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{keywordtype}{unsigned} num\_nod=fluid\_mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{    \{}
\DoxyCodeLine{     \textcolor{comment}{// Pin horizontal velocity}}
\DoxyCodeLine{      \{}
\DoxyCodeLine{       fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>pin(0);}
\DoxyCodeLine{      \}}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Complete the build of all elements so they are fully functional}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{//Find number of elements in mesh}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} n\_element = fluid\_mesh\_pt()-\/>nelement();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Loop over the elements to set up element-\/specific }}
\DoxyCodeLine{ \textcolor{comment}{// things that cannot be handled by constructor}}
\DoxyCodeLine{ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} i=0;i<n\_element;i++)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{comment}{// Upcast from FiniteElement to the present element}}
\DoxyCodeLine{   ELEMENT *el\_pt = \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(fluid\_mesh\_pt()-\/>element\_pt(i));}
\DoxyCodeLine{}
\DoxyCodeLine{   \textcolor{comment}{//Set the Reynolds number, etc}}
\DoxyCodeLine{   el\_pt-\/>re\_pt() = \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}};}
\DoxyCodeLine{   el\_pt-\/>re\_st\_pt() = \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_a085ee4bf968ffdd01a41b8c41864f907}{Global\_Physical\_Variables::ReSt}};}
\DoxyCodeLine{}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{//Attach the boundary conditions to the mesh}}
\DoxyCodeLine{ cout <<\textcolor{stringliteral}{"{}Number of equations: "{}} << assign\_eqn\_numbers() << std::endl; }
\DoxyCodeLine{ }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Set parameters for Sarah's asymptotic solution}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Amplitude of the oscillation}}
\DoxyCodeLine{ \mbox{\hyperlink{namespaceoomph_1_1SarahBL_a21bfe7e71f0baa62022d1ecc9bd175de}{SarahBL::epsilon}}=\textcolor{keyword}{static\_cast<}PseudoBucklingRingElement*\textcolor{keyword}{>}(Wall\_pt)-\/>}
\DoxyCodeLine{  eps\_buckl();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Womersley number is the same as square root of Reynolds number}}
\DoxyCodeLine{ \mbox{\hyperlink{namespaceoomph_1_1SarahBL_ab07de8eb877306afdc10ba4a17c6406b}{SarahBL::alpha}}=sqrt(\mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}});}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Amplitude ratio}}
\DoxyCodeLine{ \mbox{\hyperlink{namespaceoomph_1_1SarahBL_a5b48abf91ca062e8bfeab87f1d4a9499}{SarahBL::A}}=\textcolor{keyword}{static\_cast<}PseudoBucklingRingElement*\textcolor{keyword}{>}(Wall\_pt)-\/>ampl\_ratio();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Buckling wavenumber}}
\DoxyCodeLine{ \mbox{\hyperlink{namespaceoomph_1_1SarahBL_a3f2e6fdba588e1883d317f6e0cd7f32f}{SarahBL::N}}=\textcolor{keyword}{static\_cast<}PseudoBucklingRingElement*\textcolor{keyword}{>}(Wall\_pt)-\/>n\_buckl\_float();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Frequency of oscillation (period is one)}}
\DoxyCodeLine{ \mbox{\hyperlink{namespaceoomph_1_1SarahBL_a370241de5869d0f53fc7cd17858bfbfe}{SarahBL::Omega}}=2.0*MathematicalConstants::Pi;}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Set initial condition: Assign previous and current values}}
\DoxyCodeLine{\textcolor{comment}{/// of the velocity from the velocity field specified via}}
\DoxyCodeLine{\textcolor{comment}{/// the function pointer.}}
\DoxyCodeLine{\textcolor{comment}{///}}
\DoxyCodeLine{\textcolor{comment}{/// Values are assigned so that the velocities and accelerations}}
\DoxyCodeLine{\textcolor{comment}{/// are correct for current time.}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{classOscRingNStProblem_ab1f2083699d00da4b7f6116e10792e86}{OscRingNStProblem<ELEMENT>::set\_initial\_condition}}()}
\DoxyCodeLine{\{ }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Elastic wall: We're starting from a given initial state in which}}
\DoxyCodeLine{ \textcolor{comment}{// the wall is undeformed. If set\_initial\_condition() is called again}}
\DoxyCodeLine{ \textcolor{comment}{// after mesh refinement for first timestep, this needs to be reset.}}
\DoxyCodeLine{ \textcolor{keyword}{dynamic\_cast<}PseudoBucklingRingElement*\textcolor{keyword}{>}(Wall\_pt)-\/>set\_R\_0(1.0); }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Backup time in global timestepper}}
\DoxyCodeLine{ \textcolor{keywordtype}{double} backed\_up\_time=time\_pt()-\/>time();}
\DoxyCodeLine{         }
\DoxyCodeLine{ \textcolor{comment}{// Past history for velocities needs to be established for t=time0-\/deltat, ...}}
\DoxyCodeLine{ \textcolor{comment}{// Then provide current values (at t=time0) which will also form}}
\DoxyCodeLine{ \textcolor{comment}{// the initial guess for first solve at t=time0+deltat}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Vector of exact solution values (includes pressure)}}
\DoxyCodeLine{ Vector<double> soln(3);}
\DoxyCodeLine{ Vector<double> x(2);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{//Find number of nodes in mesh}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} num\_nod = fluid\_mesh\_pt()-\/>nnode();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Get continuous times at previous timesteps}}
\DoxyCodeLine{ \textcolor{keywordtype}{int} nprev\_steps=time\_stepper\_pt()-\/>nprev\_values();}
\DoxyCodeLine{ Vector<double> prev\_time(nprev\_steps+1);}
\DoxyCodeLine{ \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} itime=nprev\_steps;itime>=0;itime-\/-\/)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   prev\_time[itime]=time\_pt()-\/>time(\textcolor{keywordtype}{unsigned}(itime));}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Loop over current \& previous timesteps (in outer loop because}}
\DoxyCodeLine{ \textcolor{comment}{// the mesh might also move)}}
\DoxyCodeLine{ \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} itime=nprev\_steps;itime>=0;itime-\/-\/)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{keywordtype}{double} time=prev\_time[itime];}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Set global time (because this is how the geometric object refers }}
\DoxyCodeLine{   \textcolor{comment}{// to continous time }}
\DoxyCodeLine{   time\_pt()-\/>time()=time;}
\DoxyCodeLine{   }
\DoxyCodeLine{   cout << \textcolor{stringliteral}{"{}setting IC at time ="{}} << time << std::endl;}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Update the fluid mesh for this value of the continuous time}}
\DoxyCodeLine{   \textcolor{comment}{// (The wall object reads the continous time from the same}}
\DoxyCodeLine{   \textcolor{comment}{// global time object)}}
\DoxyCodeLine{   fluid\_mesh\_pt()-\/>node\_update(); }
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Loop over the nodes to set initial guess everywhere}}
\DoxyCodeLine{   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} jnod=0;jnod<num\_nod;jnod++)}
\DoxyCodeLine{    \{}
\DoxyCodeLine{     }
\DoxyCodeLine{     \textcolor{comment}{// Get nodal coordinates}}
\DoxyCodeLine{     x[0]=fluid\_mesh\_pt()-\/>node\_pt(jnod)-\/>x(0);}
\DoxyCodeLine{     x[1]=fluid\_mesh\_pt()-\/>node\_pt(jnod)-\/>x(1);}
\DoxyCodeLine{}
\DoxyCodeLine{     \textcolor{comment}{// Get intial solution}}
\DoxyCodeLine{     (*IC\_Fct\_pt)(time,x,soln);}
\DoxyCodeLine{     }
\DoxyCodeLine{     \textcolor{comment}{// Loop over velocity directions (velocities are in soln[0] and soln[1]).}}
\DoxyCodeLine{     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i=0;i<2;i++)}
\DoxyCodeLine{      \{}
\DoxyCodeLine{       fluid\_mesh\_pt()-\/>node\_pt(jnod)-\/>set\_value(itime,i,soln[i]);}
\DoxyCodeLine{      \}}
\DoxyCodeLine{     }
\DoxyCodeLine{     \textcolor{comment}{// Loop over coordinate directions}}
\DoxyCodeLine{     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i=0;i<2;i++)}
\DoxyCodeLine{      \{}
\DoxyCodeLine{       fluid\_mesh\_pt()-\/>node\_pt(jnod)-\/>x(itime,i)=x[i];}
\DoxyCodeLine{      \}}
\DoxyCodeLine{    \} }
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Reset backed up time for global timestepper}}
\DoxyCodeLine{ time\_pt()-\/>time()=backed\_up\_time;}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Doc the solution}}
\DoxyCodeLine{\textcolor{comment}{///}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{classOscRingNStProblem_a7de5df21c2179db1c97cc83332dcc82c}{OscRingNStProblem<ELEMENT>::doc\_solution}}(DocInfo\& doc\_info)}
\DoxyCodeLine{\{ }
\DoxyCodeLine{}
\DoxyCodeLine{ cout << \textcolor{stringliteral}{"{}Doc-\/ing step "{}} <<  doc\_info.number()}
\DoxyCodeLine{      << \textcolor{stringliteral}{"{} for time "{}} << time\_stepper\_pt()-\/>time\_pt()-\/>time() << std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{ ofstream some\_file;}
\DoxyCodeLine{ \textcolor{keywordtype}{char} filename[100];}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Number of plot points}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} npts;}
\DoxyCodeLine{ npts=5; }
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Output solution on fluid mesh}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ sprintf(filename,\textcolor{stringliteral}{"{}\%s/soln\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{         doc\_info.number());}
\DoxyCodeLine{ \textcolor{comment}{//some\_file.precision(20);}}
\DoxyCodeLine{ some\_file.open(filename);}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} nelem=fluid\_mesh\_pt()-\/>nelement();}
\DoxyCodeLine{ \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ielem=0;ielem<nelem;ielem++)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(fluid\_mesh\_pt()-\/>element\_pt(ielem))-\/>}
\DoxyCodeLine{    full\_output(some\_file,npts);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{ some\_file.close();}
\DoxyCodeLine{  }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Plot wall posn}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ sprintf(filename,\textcolor{stringliteral}{"{}\%s/Wall\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{         doc\_info.number());}
\DoxyCodeLine{ some\_file.open(filename);}
\DoxyCodeLine{ }
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} nplot=100;}
\DoxyCodeLine{ Vector<double > xi\_wall(1);}
\DoxyCodeLine{ Vector<double > r\_wall(2);}
\DoxyCodeLine{  \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} iplot=0;iplot<nplot;iplot++)}
\DoxyCodeLine{   \{}
\DoxyCodeLine{    xi\_wall[0]=0.5*Pi*double(iplot)/double(nplot-\/1);}
\DoxyCodeLine{    Wall\_pt-\/>position(xi\_wall,r\_wall);}
\DoxyCodeLine{    some\_file << r\_wall[0] << \textcolor{stringliteral}{"{} "{}} << r\_wall[1] << std::endl;}
\DoxyCodeLine{   \}}
\DoxyCodeLine{  some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Doc Sarah's asymptotic solution }}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ sprintf(filename,\textcolor{stringliteral}{"{}\%s/exact\_soln\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{         doc\_info.number());}
\DoxyCodeLine{ some\_file.open(filename);}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>output\_fct(some\_file,npts,}
\DoxyCodeLine{                       time\_stepper\_pt()-\/>time\_pt()-\/>time(), }
\DoxyCodeLine{                       \mbox{\hyperlink{namespaceoomph_1_1SarahBL_a80c7c03073f6436ace00d2b2c5bfa501}{SarahBL::full\_exact\_soln}});}
\DoxyCodeLine{ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Get position of control point}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ Vector<double> r(2);}
\DoxyCodeLine{ Vector<double> xi(1);}
\DoxyCodeLine{ xi[0]=MathematicalConstants::Pi/2.0;}
\DoxyCodeLine{ wall\_pt()-\/>position(xi,r);}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Get total volume (area) of computational domain, energies and average}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ \textcolor{comment}{// pressure}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ \textcolor{keywordtype}{double} area=0.0;}
\DoxyCodeLine{ \textcolor{keywordtype}{double} press\_int=0.0;}
\DoxyCodeLine{ \textcolor{keywordtype}{double} diss=0.0;}
\DoxyCodeLine{ \textcolor{keywordtype}{double} kin\_en=0.0;}
\DoxyCodeLine{ nelem=fluid\_mesh\_pt()-\/>nelement();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ielem=0;ielem<nelem;ielem++)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   area+=fluid\_mesh\_pt()-\/>finite\_element\_pt(ielem)-\/>size();}
\DoxyCodeLine{   press\_int+=\textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(fluid\_mesh\_pt()-\/>element\_pt(ielem))}
\DoxyCodeLine{    -\/>pressure\_integral();}
\DoxyCodeLine{   diss+=\textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(fluid\_mesh\_pt()-\/>element\_pt(ielem))-\/>}
\DoxyCodeLine{    dissipation();}
\DoxyCodeLine{   kin\_en+=\textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(fluid\_mesh\_pt()-\/>element\_pt(ielem))-\/>}
\DoxyCodeLine{    kin\_energy();}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Total kinetic energy in entire domain}}
\DoxyCodeLine{ \textcolor{keywordtype}{double} global\_kin=4.0*kin\_en;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Max/min refinement level}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} min\_level;}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} max\_level;}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>get\_refinement\_levels(min\_level,max\_level);}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Total dissipation for quarter domain}}
\DoxyCodeLine{ \textcolor{keywordtype}{double} time=time\_pt()-\/>time();}
\DoxyCodeLine{ \textcolor{keywordtype}{double} diss\_asympt=\mbox{\hyperlink{namespaceoomph_1_1SarahBL_abcbefc8bfea90a749dcb6961d9d5c0a0}{SarahBL::Total\_Diss\_sarah}}(time)/4.0;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Asymptotic predictions for velocities at control point}}
\DoxyCodeLine{ Vector<double> x\_sarah(2);}
\DoxyCodeLine{ Vector<double> soln\_sarah(3);}
\DoxyCodeLine{ x\_sarah[0]=Sarah\_veloc\_trace\_node\_pt-\/>x(0);}
\DoxyCodeLine{ x\_sarah[1]=Sarah\_veloc\_trace\_node\_pt-\/>x(1);}
\DoxyCodeLine{ \mbox{\hyperlink{namespaceoomph_1_1SarahBL_aa198aa1de07bb9a2eac422ed63010bc4}{SarahBL::exact\_soln}}(time,x\_sarah,soln\_sarah);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Doc}}
\DoxyCodeLine{ Trace\_file << time\_pt()-\/>time() }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << r[1]}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << global\_kin }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << \mbox{\hyperlink{namespaceoomph_1_1SarahBL_a3cb8715d5fa21d7dbff8151e90df4200}{SarahBL::Kin\_energy\_sarah}}(time\_pt()-\/>time()) }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << \textcolor{keyword}{static\_cast<}PseudoBucklingRingElement*\textcolor{keyword}{>}(Wall\_pt)-\/>r\_0()}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << area  }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << press\_int/area }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << diss  }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << diss\_asympt}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << Veloc\_trace\_node\_pt-\/>x(0)}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << Veloc\_trace\_node\_pt-\/>x(1) }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << Veloc\_trace\_node\_pt-\/>value(0)}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << Veloc\_trace\_node\_pt-\/>value(1) }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << fluid\_mesh\_pt()-\/>nelement() }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << ndof()}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << min\_level }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << max\_level}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << fluid\_mesh\_pt()-\/>nrefinement\_overruled() }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << fluid\_mesh\_pt()-\/>max\_error()  }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << fluid\_mesh\_pt()-\/>min\_error()  }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << fluid\_mesh\_pt()-\/>max\_permitted\_error() }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << fluid\_mesh\_pt()-\/>min\_permitted\_error() }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << fluid\_mesh\_pt()-\/>max\_keep\_unrefined()}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << doc\_info.number()}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << Sarah\_veloc\_trace\_node\_pt-\/>x(0) }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << Sarah\_veloc\_trace\_node\_pt-\/>x(1) }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << Sarah\_veloc\_trace\_node\_pt-\/>value(0) }
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << Sarah\_veloc\_trace\_node\_pt-\/>value(1)}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << x\_sarah[0]}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << x\_sarah[1]}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << soln\_sarah[0]}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} << soln\_sarah[1]}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{} "{}} }
\DoxyCodeLine{            << \textcolor{keyword}{static\_cast<}PseudoBucklingRingElement*\textcolor{keyword}{>}(Wall\_pt)-\/>r\_0()-\/1.0}
\DoxyCodeLine{            << std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Output fluid solution on coarse-\/ish mesh }}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Extract all elements from quadtree representation}}
\DoxyCodeLine{ Vector<Tree*> all\_element\_pt;}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>forest\_pt()-\/>}
\DoxyCodeLine{  stick\_all\_tree\_nodes\_into\_vector(all\_element\_pt);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Build a coarse mesh}}
\DoxyCodeLine{ Mesh* coarse\_mesh\_pt = \textcolor{keyword}{new} Mesh();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{//Loop over all elements and check if their refinement level is}}
\DoxyCodeLine{ \textcolor{comment}{//equal to the mesh's minimum refinement level}}
\DoxyCodeLine{ nelem=all\_element\_pt.size();}
\DoxyCodeLine{ \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ielem=0;ielem<nelem;ielem++)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   Tree* el\_pt=all\_element\_pt[ielem];}
\DoxyCodeLine{   \textcolor{keywordflow}{if} (el\_pt-\/>level()==min\_level)}
\DoxyCodeLine{    \{}
\DoxyCodeLine{     coarse\_mesh\_pt-\/>add\_element\_pt(el\_pt-\/>object\_pt());}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Output fluid solution on coarse mesh}}
\DoxyCodeLine{ sprintf(filename,\textcolor{stringliteral}{"{}\%s/coarse\_soln\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{         doc\_info.number());}
\DoxyCodeLine{ some\_file.open(filename);}
\DoxyCodeLine{ nelem=coarse\_mesh\_pt-\/>nelement();}
\DoxyCodeLine{ \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} ielem=0;ielem<nelem;ielem++)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(coarse\_mesh\_pt-\/>element\_pt(ielem))-\/>}
\DoxyCodeLine{    full\_output(some\_file,npts);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Write restart file}}
\DoxyCodeLine{ sprintf(filename,\textcolor{stringliteral}{"{}\%s/restart\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{         doc\_info.number());}
\DoxyCodeLine{ some\_file.open(filename);}
\DoxyCodeLine{ dump\_it(some\_file,doc\_info);}
\DoxyCodeLine{ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Dump the solution}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{classOscRingNStProblem_af32f94658174188b1f029446161755b2}{OscRingNStProblem<ELEMENT>::dump\_it}}(ofstream\& dump\_file,DocInfo doc\_info)}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Dump refinement status of mesh}}
\DoxyCodeLine{ \textcolor{comment}{//fluid\_mesh\_pt()-\/>dump\_refinement(dump\_file);}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Call generic dump()}}
\DoxyCodeLine{ Problem::dump(dump\_file);}
\DoxyCodeLine{  }
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Read solution from disk}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{classOscRingNStProblem_a0cf01737b8d53213d644413e84251d0f}{OscRingNStProblem<ELEMENT>::restart}}(ifstream\& restart\_file)}
\DoxyCodeLine{\{}
\DoxyCodeLine{ \textcolor{comment}{// Refine fluid mesh according to the instructions in restart file}}
\DoxyCodeLine{ \textcolor{comment}{//fluid\_mesh\_pt()-\/>refine(restart\_file);}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Rebuild the global mesh}}
\DoxyCodeLine{ \textcolor{comment}{//rebuild\_global\_mesh();}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Read generic problem data}}
\DoxyCodeLine{ Problem::read(restart\_file);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//   // Complete build of all elements so they are fully functional}}
\DoxyCodeLine{\textcolor{comment}{//  finish\_problem\_setup();}}
\DoxyCodeLine{ }
\DoxyCodeLine{ \textcolor{comment}{//Assign equation numbers}}
\DoxyCodeLine{ \textcolor{comment}{//cout <<"{}\(\backslash\)nNumber of equations: "{} << assign\_eqn\_numbers() }}
\DoxyCodeLine{ \textcolor{comment}{//     << std::endl<< std::endl; }}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Driver for timestepping the problem: Fixed timestep but }}
\DoxyCodeLine{\textcolor{comment}{/// guaranteed spatial accuracy. Beautiful, innit?}}
\DoxyCodeLine{\textcolor{comment}{///}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{classOscRingNStProblem_a00e957fb6a313a9c1de784d0fa3a7a36}{OscRingNStProblem<ELEMENT>::unsteady\_run}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned}\& ntsteps,}
\DoxyCodeLine{                                              \textcolor{keyword}{const} \textcolor{keywordtype}{bool}\& restarted,}
\DoxyCodeLine{                                              DocInfo\& doc\_info)}
\DoxyCodeLine{\{ }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Open trace file}}
\DoxyCodeLine{ \textcolor{keywordtype}{char} filename[100];   }
\DoxyCodeLine{ sprintf(filename,\textcolor{stringliteral}{"{}\%s/trace.dat"{}},doc\_info.directory().c\_str());}
\DoxyCodeLine{ Trace\_file.open(filename);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Max. number of adaptations per solve}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} max\_adapt;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Max. number of adaptations per solve}}
\DoxyCodeLine{ \textcolor{keywordflow}{if} (restarted)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   max\_adapt=0;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{ \textcolor{keywordflow}{else}}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   max\_adapt=1; }
\DoxyCodeLine{  \}}
\DoxyCodeLine{ }
\DoxyCodeLine{ \textcolor{comment}{// Max. and min. error for adaptive refinement/unrefinement}}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>max\_permitted\_error()=  0.5e-\/2;   }
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>min\_permitted\_error()=  0.5e-\/3;  }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Don't allow refinement to drop under given level}}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>min\_refinement\_level()=2;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Don't allow refinement beyond given level }}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>max\_refinement\_level()=6; }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Don't bother adapting the mesh if no refinement is required}}
\DoxyCodeLine{ \textcolor{comment}{// and if less than ... elements are to be merged.}}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>max\_keep\_unrefined()=20;}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Get max/min refinement levels in mesh}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} min\_refinement\_level;}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} max\_refinement\_level;}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>get\_refinement\_levels(min\_refinement\_level,}
\DoxyCodeLine{                                        max\_refinement\_level);}
\DoxyCodeLine{}
\DoxyCodeLine{ cout << \textcolor{stringliteral}{"{}\(\backslash\)n Initial mesh: min/max refinement levels: "{}} }
\DoxyCodeLine{      << min\_refinement\_level << \textcolor{stringliteral}{"{} "{}} << max\_refinement\_level << std::endl << std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Doc refinement targets}}
\DoxyCodeLine{ fluid\_mesh\_pt()-\/>doc\_adaptivity\_targets(cout);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Write header for trace file}}
\DoxyCodeLine{ write\_trace\_file\_header();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Doc initial condition}}
\DoxyCodeLine{ doc\_solution(doc\_info);}
\DoxyCodeLine{ doc\_info.number()++;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Switch off doc during solve}}
\DoxyCodeLine{ doc\_info.disable\_doc();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// If we set first to true, then initial guess will be re-\/assigned}}
\DoxyCodeLine{ \textcolor{comment}{// after mesh adaptation. Don't want this if we've done a restart.}}
\DoxyCodeLine{ \textcolor{keywordtype}{bool} first;}
\DoxyCodeLine{ \textcolor{keywordtype}{bool} shift;}
\DoxyCodeLine{ \textcolor{keywordflow}{if} (restarted)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   first=\textcolor{keyword}{false};}
\DoxyCodeLine{   shift=\textcolor{keyword}{false};}
\DoxyCodeLine{   \textcolor{comment}{// Move time back by dt to make sure we're re-\/solving the read-\/in solution}}
\DoxyCodeLine{   time\_pt()-\/>time()-\/=time\_pt()-\/>dt();}
\DoxyCodeLine{  \}}
\DoxyCodeLine{ \textcolor{keywordflow}{else}}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   first=\textcolor{keyword}{true};}
\DoxyCodeLine{   shift=\textcolor{keyword}{true};}
\DoxyCodeLine{  \}}
\DoxyCodeLine{ }
\DoxyCodeLine{ \textcolor{comment}{//Take the first fixed timestep with specified tolerance for Newton solver}}
\DoxyCodeLine{ \textcolor{keywordtype}{double} dt=time\_pt()-\/>dt();}
\DoxyCodeLine{ unsteady\_newton\_solve(dt,max\_adapt,first,shift);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Switch doc back on}}
\DoxyCodeLine{ doc\_info.enable\_doc();}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Doc initial solution}}
\DoxyCodeLine{ doc\_solution(doc\_info);}
\DoxyCodeLine{ doc\_info.number()++;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Now do normal run; allow for one mesh adaptation per timestep}}
\DoxyCodeLine{ max\_adapt=1; }
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{//Loop over the remaining timesteps}}
\DoxyCodeLine{ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} t=2;t<=ntsteps;t++)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{}
\DoxyCodeLine{   \textcolor{comment}{// Switch off doc during solve}}
\DoxyCodeLine{   doc\_info.disable\_doc();}
\DoxyCodeLine{}
\DoxyCodeLine{   \textcolor{comment}{//Take fixed timestep}}
\DoxyCodeLine{   first=\textcolor{keyword}{false};}
\DoxyCodeLine{   unsteady\_newton\_solve(dt,max\_adapt,first);}
\DoxyCodeLine{}
\DoxyCodeLine{   \textcolor{comment}{// Switch doc back on}}
\DoxyCodeLine{   doc\_info.enable\_doc();}
\DoxyCodeLine{}
\DoxyCodeLine{   \textcolor{comment}{// Doc solution}}
\DoxyCodeLine{   \textcolor{comment}{//if (icount\%10==0)}}
\DoxyCodeLine{    \{}
\DoxyCodeLine{     doc\_solution(doc\_info);}
\DoxyCodeLine{     doc\_info.number()++;}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Close trace file}}
\DoxyCodeLine{ Trace\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Write trace file header}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{classOscRingNStProblem_a96e12e5bb761d765ebe9065b9990112f}{OscRingNStProblem<ELEMENT>::write\_trace\_file\_header}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Doc parameters in trace file}}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}\# err\_max "{}} << fluid\_mesh\_pt()-\/>max\_permitted\_error() << std::endl;}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}\# err\_min "{}} << fluid\_mesh\_pt()-\/>min\_permitted\_error() << std::endl;}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}\# Re "{}} << \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}} << std::endl;}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}\# St "{}} << \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a085ee4bf968ffdd01a41b8c41864f907}{Global\_Physical\_Variables::ReSt}}/}
\DoxyCodeLine{                          \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}} << std::endl;}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}\# dt "{}} << time\_stepper\_pt()-\/>time\_pt()-\/>dt() << std::endl;}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}\# initial \# elements "{}} << mesh\_pt()-\/>nelement() << std::endl;}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}\# min\_refinement\_level "{}} }
\DoxyCodeLine{            << fluid\_mesh\_pt()-\/>min\_refinement\_level() << std::endl;}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}\# max\_refinement\_level "{}} }
\DoxyCodeLine{            << fluid\_mesh\_pt()-\/>max\_refinement\_level() << std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{}VARIABLES=\(\backslash\)"{}time\(\backslash\)"{},\(\backslash\)"{}V\_c\_t\_r\_l\(\backslash\)"{},\(\backslash\)"{}e\_k\_i\_n\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}e\_k\_i\_n\_(\_a\_s\_y\_m\_p\_t\_)\(\backslash\)"{},\(\backslash\)"{}R\_0\(\backslash\)"{},\(\backslash\)"{}Area\(\backslash\)"{}"{}} ;}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}Average pressure\(\backslash\)"{},\(\backslash\)"{}Total dissipation (quarter domain)\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}Asymptotic dissipation (quarter domain)\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}x<sub>1</sub><sup>(track)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}x<sub>2</sub><sup>(track)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}u<sub>1</sub><sup>(track)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}u<sub>2</sub><sup>(track)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}N<sub>element</sub>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}N<sub>dof</sub>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}max. refinement level\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}min. refinement level\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}\# of elements whose refinement was over-\/ruled\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}max. error\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}min. error\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}max. permitted error\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}min. permitted error\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}max. permitted \# of unrefined elements\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}doc number\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}x<sub>1</sub><sup>(track2 FE)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}x<sub>2</sub><sup>(track2 FE)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}u<sub>1</sub><sup>(track2 FE)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}u<sub>2</sub><sup>(track2 FE)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}x<sub>1</sub><sup>(track2 Sarah)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}x<sub>2</sub><sup>(track2 Sarah)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}u<sub>1</sub><sup>(track2 Sarah)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}u<sub>2</sub><sup>(track2 Sarah)</sup>\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << \textcolor{stringliteral}{"{},\(\backslash\)"{}R<sub>0</sub>-\/1\(\backslash\)"{}"{}};}
\DoxyCodeLine{ Trace\_file << std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{/// /////////////////////////////////////////////////////////////////////}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/// Demonstrate how to solve OscRingNSt problem in deformable domain}}
\DoxyCodeLine{\textcolor{comment}{/// with mesh adaptation}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keywordtype}{int} \mbox{\hyperlink{fsi__osc__ring_8cc_a0ddf1224851353fc92bfbff6f499fa97}{main}}(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}* argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{ \textcolor{comment}{// Store command line arguments}}
\DoxyCodeLine{ CommandLineArgs::setup(argc,argv);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{//Do a certain number of timesteps per period}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} nstep\_per\_period=40; \textcolor{comment}{// 80;  // ADJUST\_PRIORITY}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} nperiod=3;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Work out total number of steps and timestep}}
\DoxyCodeLine{ \textcolor{keywordtype}{unsigned} nstep=nstep\_per\_period*nperiod;  }
\DoxyCodeLine{ \textcolor{keywordtype}{double} dt=1.0/double(nstep\_per\_period);}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Set up the problem: Pass timestep and Sarah's asymptotic solution for}}
\DoxyCodeLine{ \textcolor{comment}{// generation of initial condition}}
\DoxyCodeLine{ \mbox{\hyperlink{classOscRingNStProblem}{OscRingNStProblem<MacroElementNodeUpdateElement<RefineableQCrouzeixRaviartElement<2>}} > >}
\DoxyCodeLine{  problem(dt,\&\mbox{\hyperlink{namespaceoomph_1_1SarahBL_a80c7c03073f6436ace00d2b2c5bfa501}{SarahBL::full\_exact\_soln}});}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Restart?}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ \textcolor{keywordtype}{bool} restarted=\textcolor{keyword}{false};}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Pointer to restart file}}
\DoxyCodeLine{ ifstream* restart\_file\_pt=0;}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// No restart}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ \textcolor{keywordflow}{if} (CommandLineArgs::Argc!=2)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   cout << \textcolor{stringliteral}{"{}No restart"{}} << std::endl;}
\DoxyCodeLine{   restarted=\textcolor{keyword}{false};}
\DoxyCodeLine{}
\DoxyCodeLine{   \textcolor{comment}{// Refine uniformly}}
\DoxyCodeLine{   problem.refine\_uniformly();}
\DoxyCodeLine{   problem.refine\_uniformly();}
\DoxyCodeLine{}
\DoxyCodeLine{   \textcolor{comment}{// Set initial condition on uniformly refined domain (if this isn't done}}
\DoxyCodeLine{   \textcolor{comment}{// then the mesh contains the interpolation of the initial guess}}
\DoxyCodeLine{   \textcolor{comment}{// on the original coarse mesh -\/-\/ if the nodal values were zero in}}
\DoxyCodeLine{   \textcolor{comment}{// the interior and nonzero on the boundary, then the the waviness of}}
\DoxyCodeLine{   \textcolor{comment}{// of the interpolated i.g. between the nodes on the coarse mesh}}
\DoxyCodeLine{   \textcolor{comment}{// gets transferred onto the fine mesh where we can do better}}
\DoxyCodeLine{   problem.set\_initial\_condition();}
\DoxyCodeLine{}
\DoxyCodeLine{  \}}
\DoxyCodeLine{ }
\DoxyCodeLine{ \textcolor{comment}{// Restart}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (CommandLineArgs::Argc==2)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   restarted=\textcolor{keyword}{true};}
\DoxyCodeLine{}
\DoxyCodeLine{   \textcolor{comment}{// Open restart file}}
\DoxyCodeLine{   restart\_file\_pt=\textcolor{keyword}{new} ifstream(CommandLineArgs::Argv[1],ios\_base::in);}
\DoxyCodeLine{   \textcolor{keywordflow}{if} (restart\_file\_pt!=0)}
\DoxyCodeLine{    \{}
\DoxyCodeLine{     cout << \textcolor{stringliteral}{"{}Have opened "{}} << CommandLineArgs::Argv[1] << }
\DoxyCodeLine{      \textcolor{stringliteral}{"{} for restart. "{}} << std::endl;}
\DoxyCodeLine{    \}}
\DoxyCodeLine{   \textcolor{keywordflow}{else}}
\DoxyCodeLine{    \{}
\DoxyCodeLine{     std::ostringstream error\_stream;}
\DoxyCodeLine{     error\_stream << \textcolor{stringliteral}{"{}ERROR while trying to open "{}} }
\DoxyCodeLine{                  << CommandLineArgs::Argv[2] }
\DoxyCodeLine{                  << \textcolor{stringliteral}{"{} for restart."{}} << std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{     \textcolor{keywordflow}{throw} OomphLibError(error\_stream.str(),}
\DoxyCodeLine{                         OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{                         OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{    \}}
\DoxyCodeLine{   \textcolor{comment}{// Do the actual restart}}
\DoxyCodeLine{   problem.restart(*restart\_file\_pt);}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Two command line arguments: do validation run}}
\DoxyCodeLine{ \textcolor{keywordflow}{if} (CommandLineArgs::Argc==3)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{    nstep=3;}
\DoxyCodeLine{    cout << \textcolor{stringliteral}{"{}Only doing nstep steps for validation: "{}} << nstep << std::endl;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Setup labels for output}}
\DoxyCodeLine{ DocInfo doc\_info;}
\DoxyCodeLine{ }
\DoxyCodeLine{ \textcolor{comment}{// Output directory}}
\DoxyCodeLine{ doc\_info.set\_directory(\textcolor{stringliteral}{"{}RESLT"{}}); }
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Do unsteady run of the problem for nstep steps}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ problem.unsteady\_run(nstep,restarted,doc\_info);}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{ \textcolor{comment}{// Validate the restart procedure}}
\DoxyCodeLine{ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{ \textcolor{keywordflow}{if} (CommandLineArgs::Argc==3)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Build problem and restart}}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Set up the problem: Pass timestep and Sarah's asymptotic solution for}}
\DoxyCodeLine{   \textcolor{comment}{// generation of initial condition}}
\DoxyCodeLine{   \mbox{\hyperlink{classOscRingNStProblem}{OscRingNStProblem}}<MacroElementNodeUpdateElement<}
\DoxyCodeLine{    RefineableQCrouzeixRaviartElement<2> > >}
\DoxyCodeLine{    restarted\_problem(dt,\&\mbox{\hyperlink{namespaceoomph_1_1SarahBL_a80c7c03073f6436ace00d2b2c5bfa501}{SarahBL::full\_exact\_soln}});}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Setup labels for output}}
\DoxyCodeLine{   DocInfo restarted\_doc\_info;}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Output directory}}
\DoxyCodeLine{   restarted\_doc\_info.set\_directory(\textcolor{stringliteral}{"{}RESLT\_restarted"{}}); }
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Step number}}
\DoxyCodeLine{   restarted\_doc\_info.number()=0;}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Copy by performing a restart from old problem}}
\DoxyCodeLine{   restart\_file\_pt=\textcolor{keyword}{new} ifstream(\textcolor{stringliteral}{"{}RESLT/restart2.dat"{}});}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Do the actual restart}}
\DoxyCodeLine{   restarted\_problem.restart(*restart\_file\_pt);}
\DoxyCodeLine{   }
\DoxyCodeLine{   \textcolor{comment}{// Do unsteady run of the problem for one step}}
\DoxyCodeLine{   \textcolor{keywordtype}{unsigned} nstep=2;}
\DoxyCodeLine{   \textcolor{keywordtype}{bool} restarted=\textcolor{keyword}{true};}
\DoxyCodeLine{   restarted\_problem.unsteady\_run(nstep,restarted,restarted\_doc\_info);}
\DoxyCodeLine{}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_pdf}{}\doxysection{PDF file}\label{index_pdf}
A \href{../latex/refman.pdf}{\texttt{ pdf version}} of this document is available. \end{document}
