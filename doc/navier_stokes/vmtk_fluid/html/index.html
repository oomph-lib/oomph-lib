<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: Steady finite-Reynolds-number flow through an iliac bifurcation</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Demo problem: Steady finite-Reynolds-number flow through an iliac bifurcation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this tutorial is to demonstrate the simulation of cardiovascular fluid mechanics problems with <code>oomph-lib</code>. We showed in <a href="../../../meshes/mesh_from_vmtk/html/index.html">another tutorial</a> how to use <a href="http://www.vmtk.org">VMTK</a> together with <code>oomph-lib's</code> conversion code <br  />
<br  />
</p><center> <a href="../../../../demo_drivers/meshing/mesh_from_vmtk/create_fluid_and_solid_surface_mesh_from_fluid_xda_mesh.cc">demo_drivers/meshing/mesh_from_vmtk/create_fluid_and_solid_surface_mesh_from_fluid_xda_mesh.cc</a> </center><p> <br  />
<br  />
to generate unstructured fluid and solid meshes for the simulation of physiological fluid-structure interaction problems based on data from medical images. Here we show how to simulate steady finite-Reynolds-number flow through a (rigid) iliac bifurcation. A particular feature of this problem is that, unlike the problem considered in <a href="../../unstructured_three_d_fluid/html/index.html">another tutorial,</a> the in- and outflow boundaries are not aligned with any coordinate planes. Parallel in- and outflow is therefore enforced by a Lagrange multiplier method, implemented using <code>oomph-lib's</code> <code>FaceElements</code>.</p>
<p>The problem studied here also serves as a "warm-up problem" for the <a href="../../../interaction/vmtk_fsi/html/index.html">corresponding fluid-structure interaction problem </a> in which the vessel wall is elastic and deforms in response to the traction that the fluid exerts onto it.</p>
<p>We stress that the tutorial focuses on the implementation aspects, not the actual physics. Since the driver code discussed here is also used in the library's self-tests we deliberately use a very coarse mesh and restrict ourselves to steady flows. The results shown below are therefore unlikely to bear much resemblance to the actual flows that arise <em>in</em> <em>vivo</em>. The section <a class="el" href="index.html#realism">How to make the simulation more realistic</a> at the end of this tutorial provides several suggestions on how to make the simulation more realistic.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="problem"></a>
The problem (and results)</h1>
<p>The two figures below show the geometry of the blood vessel (obtained from a scan of an iliac bifurcation, using the procedure discussed in <code>oomph-lib's</code> <a href="../../../meshes/mesh_from_vmtk/html/index.html">VMTK tutorial</a>) and the flow field (velocity vectors and pressure contours) for a nominal Reynolds number of <img class="formulaInl" alt="$ Re = 10. $" src="form_0.png" width="48" height="10"/> (See <a class="el" href="index.html#re">What does the Reynolds number mean in this problem?</a> for a more detailed discussion of the Reynolds number.) The flow is driven by an applied pressure drop between the in- and outflow boundaries, as in the <a href="../../unstructured_three_d_fluid/html/index.html">previous example.</a></p>
<div class="image">
<img src="vmtk_fluid.gif" alt=""/>
<div class="caption">
Velocity field and pressure contours. </div></div>
 <p>The figure below shows more clearly that the in- and outflow from the upstream and downstream cross-sections is parallel, even though the cross-sections are not aligned with any the coordinate planes.</p>
<div class="image">
<img src="vmtk_fluid2.gif" alt=""/>
<div class="caption">
Velocity field and pressure contours. Note the parallel in- and outflow. </div></div>
 <hr  />
 <hr  />
<h1><a class="anchor" id="parallel_flow"></a>
Imposing parallel in- and outflow</h1>
<p>In most of the Navier-Stokes problems we have considered so far, the geometry of the fluid domain was such that the in- and outflow cross-sections were aligned with the Cartesian coordinate planes. In such geometries the imposition of parallel in- and outflow is straightforward as it only requires pinning of the transverse velocity components. A pressure drop between upstream and downstream ends can be applied by attaching <code>NavierStokesTractionElements</code> to the bulk elements that are adjacent to the relevant domain boundaries.</p>
<p>In the current problem, the in- and outflow cross-sections have some arbitrary orientation, implying that when the in- or outflow is parallel (or, more accurately, orthogonal to the in- or outflow cross sections), neither of the three velocity components vanishes. The easiest way to enforce parallel outflow in such situations is to employ Lagrange multipliers to enforce the two constraints </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf u} \cdot {\bf t}_\alpha = 0 \mbox{\ \ \ \ for $\alpha = 1,2$,} \]" src="form_1.png" width="134" height="13"/>
</p>
<p> <br  />
 where <img class="formulaInl" alt="$ {\bf t}_\alpha $" src="form_2.png" width="13" height="11"/> (for <img class="formulaInl" alt="$\alpha = 1,2$" src="form_3.png" width="43" height="11"/>) are the two tangent vectors spanning the in- or outflow cross-sections. Physically, the Lagrange multipliers act as tangential tractions that enforce the parallel flow. The Lagrange multipliers introduce additional degrees of freedom into the problem and their implementation as <code>ImposeParallelOutflowElements</code> employs a technique similar to that used to enforce prescribed boundary displacements in solid mechanics problems. (This is discussed in <a href="../../../solid/prescribed_displ_lagr_mult/html/index.html">another tutorial</a>.) The <code>ImposeParallelOutflowElements</code> also allow the specification of a pressure that acts on the fluid (in the direction opposite to the outer unit normal on the bulk fluid element).</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="driver_code"></a>
The driver code</h1>
<p>The driver code is very similar to that discussed in <a href="../../unstructured_three_d_fluid/html/index.html">another example</a> where we imposed parallel outflow in coordinate-aligned in- and outflow cross-sections. We will therefore only discuss the changes required to impose parallel flow in cross-sections with arbitrary orientation.</p>
<hr  />
<h2><a class="anchor" id="namespace"></a>
Problem parameters</h2>
<p>The namespace specifying the problem parameters contains the Reynolds number and the in- and outflow pressures (rather than the complete traction vector):</p>
 <div class="fragment"><div class="line"><span class="comment">//=======start_namespace==========================================</span></div>
<div class="line"><span class="comment">/// Global variables</span></div>
<div class="line"><span class="comment"></span><span class="comment">//================================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGlobal__Parameters.html">Global_Parameters</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Default Reynolds number</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Re</a>=10.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Fluid pressure on inflow boundary</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a05b26d00935600b5e0149872844f224c">P_in</a>=0.5;</div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Fluid pressure on outflow boundary</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#ac680ed856897793d54c9c867da19169c">P_out</a>=-0.5; </div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end namespace</span></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html"><div class="ttname"><a href="namespaceGlobal__Parameters.html">Global_Parameters</a></div><div class="ttdoc">/////////////////////////////////////////////////////////////// /////////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="vmtk__fluid_8cc_source.html#l00045">vmtk_fluid.cc:46</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a05b26d00935600b5e0149872844f224c"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a05b26d00935600b5e0149872844f224c">Global_Parameters::P_in</a></div><div class="ttdeci">double P_in</div><div class="ttdoc">Fluid pressure on inflow boundary.</div><div class="ttdef"><b>Definition:</b> <a href="vmtk__fluid_8cc_source.html#l00052">vmtk_fluid.cc:52</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a9d72e94a9305c6a310940a6a427ebe06"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Global_Parameters::Re</a></div><div class="ttdeci">double Re</div><div class="ttdoc">Default Reynolds number.</div><div class="ttdef"><b>Definition:</b> <a href="vmtk__fluid_8cc_source.html#l00049">vmtk_fluid.cc:49</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_ac680ed856897793d54c9c867da19169c"><div class="ttname"><a href="namespaceGlobal__Parameters.html#ac680ed856897793d54c9c867da19169c">Global_Parameters::P_out</a></div><div class="ttdeci">double P_out</div><div class="ttdoc">Fluid pressure on outflow boundary.</div><div class="ttdef"><b>Definition:</b> <a href="vmtk__fluid_8cc_source.html#l00056">vmtk_fluid.cc:56</a></div></div>
</div><!-- fragment --> <hr  />
<h2><a class="anchor" id="main"></a>
The main function</h2>
<p>The main function remains identical to that in the <a href="../../unstructured_three_d_fluid/html/index.html">problem with axis-aligned outflow.</a></p>
<hr  />
<h1><a class="anchor" id="class"></a>
The Problem class</h1>
<p>The <code>Problem</code> class is practically identical to that in the <a href="../../unstructured_three_d_fluid/html/index.html">problem with axis-aligned outflow</a>, apart from some trivial changes such as the provision of storage for meshes of <code>ImposeParallelOutflowElements</code> rather than <code>NavierStokesTractionElements</code>.</p>
<hr  />
<h1><a class="anchor" id="constructor"></a>
The Problem constructor</h1>
<p>The problem constructor is also very similar. We start by building the fluid mesh, using the files created by <a href="http://wias-berlin.de/software/tetgen//"><code>tetgen</code> </a>:</p>
<div class="fragment"><div class="line"><span class="comment">//==========start_constructor=============================================</span></div>
<div class="line"><span class="comment">/// Constructor for unstructured 3D fluid problem</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a class="code" href="classUnstructuredFluidProblem.html#a9751f4afac540e148b3d90ae43dd5187">UnstructuredFluidProblem&lt;ELEMENT&gt;::UnstructuredFluidProblem</a>()</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Create fluid bulk mesh, sub-dividing &quot;corner&quot; elements</span></div>
<div class="line"> <span class="keywordtype">string</span> node_file_name=<span class="stringliteral">&quot;fluid_iliac.1.node&quot;</span>;</div>
<div class="line"> <span class="keywordtype">string</span> element_file_name=<span class="stringliteral">&quot;fluid_iliac.1.ele&quot;</span>;</div>
<div class="line"> <span class="keywordtype">string</span> face_file_name=<span class="stringliteral">&quot;fluid_iliac.1.face&quot;</span>;</div>
<div class="line"> <span class="keywordtype">bool</span> split_corner_elements=<span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"> Fluid_mesh_pt =  <span class="keyword">new</span> TetgenMesh&lt;ELEMENT&gt;(node_file_name,</div>
<div class="line">                                            element_file_name,</div>
<div class="line">                                            face_file_name,</div>
<div class="line">                                          split_corner_elements);</div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html_a9751f4afac540e148b3d90ae43dd5187"><div class="ttname"><a href="classUnstructuredFluidProblem.html#a9751f4afac540e148b3d90ae43dd5187">UnstructuredFluidProblem::UnstructuredFluidProblem</a></div><div class="ttdeci">UnstructuredFluidProblem()</div><div class="ttdoc">Constructor:</div><div class="ttdef"><b>Definition:</b> <a href="vmtk__fluid_8cc_source.html#l00134">vmtk_fluid.cc:134</a></div></div>
</div><!-- fragment --><p>Next, we set up a boundary lookup scheme that records which elements are located next to which domain boundaries, and specify the IDs of the mesh boundaries that coincide with the in- and outflow cross-sections. Note that this information reflects the specification of the boundary IDs in the <code>tetgen</code> <code>*.poly</code> file. [The conversion code <a href="../../../../demo_drivers/meshing/mesh_from_vmtk/create_fluid_and_solid_surface_mesh_from_fluid_xda_mesh.cc">create_fluid_and_solid_surface_mesh_from_fluid_xda_mesh.cc</a> lists the relation between the original boundary IDs and the new ones (obtained by giving each surface facet a separate boundary ID) at the end of the <code>*.poly</code> file.]</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Find elements next to boundaries</span></div>
<div class="line"> Fluid_mesh_pt-&gt;setup_boundary_element_info();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// The following corresponds to the boundaries as specified by</span></div>
<div class="line"> <span class="comment">// facets in the &#39;.poly&#39; input file:</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Fluid mesh inflow boundaries</span></div>
<div class="line"> Inflow_boundary_id.resize(22);</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0; i&lt;22; i++)</div>
<div class="line">  {</div>
<div class="line">   Inflow_boundary_id[i]=215+i;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Fluid mesh outflow boundaries</span></div>
<div class="line"> Outflow_boundary_id.resize(11);</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0; i&lt;11; i++)</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">   Outflow_boundary_id[i]=237+i;</div>
<div class="line"> </div>
<div class="line">  } <span class="comment">// done outflow boundaries</span></div>
</div><!-- fragment --><p> We create the meshes containing the Lagrange multiplier elements and add all sub-meshes to the Problem's global mesh.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create meshes of Lagrange multiplier elements at inflow/outflow</span></div>
<div class="line"> <span class="comment">//----------------------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create the meshes</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n=nfluid_traction_boundary();</div>
<div class="line"> Parallel_outflow_lagrange_multiplier_mesh_pt.resize(n);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;n;i++)</div>
<div class="line">  {</div>
<div class="line">   Parallel_outflow_lagrange_multiplier_mesh_pt[i]=<span class="keyword">new</span> Mesh;</div>
<div class="line">  } </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Populate them with elements</span></div>
<div class="line"> create_parallel_outflow_lagrange_elements();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Combine the lot</span></div>
<div class="line"> <span class="comment">//----------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Add sub meshes:</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Fluid bulk mesh</span></div>
<div class="line"> add_sub_mesh(Fluid_mesh_pt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// The fluid traction meshes</span></div>
<div class="line"> n=nfluid_traction_boundary();</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;n;i++)</div>
<div class="line">  { </div>
<div class="line">   add_sub_mesh(Parallel_outflow_lagrange_multiplier_mesh_pt[i]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build global mesh</span></div>
<div class="line"> build_global_mesh();</div>
</div><!-- fragment --><p>Next we apply the boundary conditions. We start by identifying the IDs of the boundaries that are subject to no-slip boundary conditions.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Apply BCs</span></div>
<div class="line"> <span class="comment">//----------</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nbound=Fluid_mesh_pt-&gt;nboundary();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Vector indicating the boundaries where we have no slip</span></div>
<div class="line"> std::vector&lt;bool&gt; pin_velocity(nbound, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over inflow/outflow boundaries</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> in_out=0;in_out&lt;2;in_out++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Loop over in/outflow boundaries</span></div>
<div class="line">   n=nfluid_inflow_traction_boundary();</div>
<div class="line">   <span class="keywordflow">if</span> (in_out==1) n=nfluid_outflow_traction_boundary();</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;n;i++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Get boundary ID</span></div>
<div class="line">     <span class="keywordtype">unsigned</span> b=0;</div>
<div class="line">     <span class="keywordflow">if</span> (in_out==0)</div>
<div class="line">      {</div>
<div class="line">       b=Inflow_boundary_id[i];</div>
<div class="line">      }</div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">       b=Outflow_boundary_id[i];</div>
<div class="line">      }</div>
<div class="line">     </div>
<div class="line">     pin_velocity[b]=<span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  } <span class="comment">// done identification of boundaries where velocities are pinned</span></div>
</div><!-- fragment --><p> Next we loop over all boundaries, visit their nodes and pin all three velocity components if the boundary is subject to a no-slip condition:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over all boundaries to apply no slip where required</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> b=0;b&lt;nbound;b++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">if</span>(pin_velocity[b])</div>
<div class="line">    {</div>
<div class="line">     <span class="keywordtype">unsigned</span> num_nod=Fluid_mesh_pt-&gt;nboundary_node(b);</div>
<div class="line">     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">      {</div>
<div class="line">       Node* nod_pt=Fluid_mesh_pt-&gt;boundary_node_pt(b,inod);</div>
<div class="line"> </div>
<div class="line">       <span class="comment">// Pin all velocities</span></div>
<div class="line">       nod_pt-&gt;pin(0); </div>
<div class="line">       nod_pt-&gt;pin(1); </div>
<div class="line">       nod_pt-&gt;pin(2); </div>
</div><!-- fragment --><p> We now check if the node in question is also located on the in- and outflow boundaries...</p>
<div class="fragment"><div class="line">       </div>
<div class="line">       <span class="comment">// Find out if the node is also located on an in- or outflow</span></div>
<div class="line">       <span class="comment">// boundary</span></div>
<div class="line">       <span class="keywordtype">bool</span> is_in_or_outflow_node=<span class="keyword">false</span>;</div>
<div class="line">       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> in_out=0;in_out&lt;2;in_out++)</div>
<div class="line">        {</div>
<div class="line">         <span class="comment">// Loop over boundaries with Lagrange multiplier elements</span></div>
<div class="line">         n=nfluid_inflow_traction_boundary();</div>
<div class="line">         <span class="keywordflow">if</span> (in_out==1) n=nfluid_outflow_traction_boundary();</div>
<div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;n;i++)</div>
<div class="line">          {</div>
<div class="line">           <span class="comment">// Get boundary ID</span></div>
<div class="line">           <span class="keywordtype">unsigned</span> bb=0;</div>
<div class="line">           <span class="keywordflow">if</span> (in_out==0)</div>
<div class="line">            {</div>
<div class="line">             bb=Inflow_boundary_id[i];</div>
<div class="line">            }</div>
<div class="line">           <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">             bb=Outflow_boundary_id[i];</div>
<div class="line">            }</div>
<div class="line">           </div>
<div class="line">           <span class="keywordflow">if</span>(nod_pt-&gt;is_on_boundary(bb))</div>
<div class="line">            {</div>
<div class="line">             is_in_or_outflow_node=<span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">        } <span class="comment">// now we know if it&#39;s on the an in- or outflow boundary...</span></div>
</div><!-- fragment --><p>...and if it is, we pin the Lagrange multipliers. They are stored after the values allocated by the "bulk" elements and we obtain the index of the first value associated with the Lagrange multipliers from the <code>BoundaryNodeBase::index_of_first_value_assigned_by_face_element()</code> function.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line">       <span class="comment">// If its on an in- or outflow boundary pin the Lagrange multipliers</span></div>
<div class="line">       <span class="keywordflow">if</span>(is_in_or_outflow_node)</div>
<div class="line">        {</div>
<div class="line">         <span class="comment">//Cast to a boundary node</span></div>
<div class="line">         BoundaryNodeBase *bnod_pt = </div>
<div class="line">          <span class="keyword">dynamic_cast&lt;</span>BoundaryNodeBase*<span class="keyword">&gt;</span></div>
<div class="line">          (Fluid_mesh_pt-&gt;boundary_node_pt(b,inod) );</div>
<div class="line">         </div>
<div class="line">         <span class="comment">// What&#39;s the index of the first Lagrange multiplier</span></div>
<div class="line">         <span class="comment">// in the node&#39;s values? </span></div>
<div class="line">         <span class="keywordtype">unsigned</span> first_index=bnod_pt-&gt;index_of_first_value_assigned_by_face_element();</div>
<div class="line">         </div>
<div class="line">         <span class="comment">// Pin the lagrange multiplier components </span></div>
<div class="line">         <span class="comment">// in the out/in_flow boundaries</span></div>
<div class="line">         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> l=0;l&lt;2;l++)</div>
<div class="line">          {</div>
<div class="line">           nod_pt-&gt;pin(first_index+l);</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// end of BC </span></div>
</div><!-- fragment --><p> The rest of the constructor is unchanged. We pass the pointer to the Reynolds number to the elements and assign the equation numbers:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Complete the build of the fluid elements so they are fully functional</span></div>
<div class="line"> <span class="comment">//----------------------------------------------------------------------</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element = Fluid_mesh_pt-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Upcast from GeneralisedElement to the present element</span></div>
<div class="line">   ELEMENT* el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(Fluid_mesh_pt-&gt;element_pt(e));</div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Set the Reynolds number</span></div>
<div class="line">   el_pt-&gt;re_pt() = &amp;<a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Global_Parameters::Re</a>;   </div>
<div class="line"> </div>
<div class="line">  } </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup equation numbering scheme</span></div>
<div class="line"> std::cout &lt;&lt;<span class="stringliteral">&quot;Number of equations: &quot;</span> &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl; </div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end constructor</span></div>
</div><!-- fragment --> <hr  />
<h2><a class="anchor" id="lagr"></a>
Creating the Lagrange multiplier elements</h2>
<p>The helper function <code>create_parallel_outflow_lagrange_elements()</code> loops over the bulk elements that are adjacent to the in- and outflow cross-sections and attaches <code>ImposeParallelOutflowElements</code> to the relevant faces. We store pointers to the newly-created elements in the appropriate meshes, and pass pointers to the doubles that specify the imposed pressure to the elements.</p>
<div class="fragment"><div class="line"><span class="comment">//============start_of_lagrange_multiplier_elements======================</span></div>
<div class="line"><span class="comment">/// Create Lagrange multiplier elements that impose parallel outflow</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUnstructuredFluidProblem.html#aea2fa32b4dd90aab81da540566b9925a">UnstructuredFluidProblem&lt;ELEMENT&gt;::</a></div>
<div class="line"><a class="code" href="classUnstructuredFluidProblem.html#aea2fa32b4dd90aab81da540566b9925a">create_parallel_outflow_lagrange_elements</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Counter for number of Lagrange multiplier meshes</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> count=0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over inflow/outflow boundaries</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> in_out=0;in_out&lt;2;in_out++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Loop over boundaries with Lagrange multiplier elements</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> n=nfluid_inflow_traction_boundary();</div>
<div class="line">   <span class="keywordflow">if</span> (in_out==1) n=nfluid_outflow_traction_boundary();</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;n;i++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Get boundary ID</span></div>
<div class="line">     <span class="keywordtype">unsigned</span> b=0;</div>
<div class="line">     <span class="keywordflow">if</span> (in_out==0)</div>
<div class="line">      {</div>
<div class="line">       b=Inflow_boundary_id[i];</div>
<div class="line">      }</div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">       b=Outflow_boundary_id[i];</div>
<div class="line">      }</div>
<div class="line">     </div>
<div class="line">     <span class="comment">// How many bulk elements are adjacent to boundary b?</span></div>
<div class="line">     <span class="keywordtype">unsigned</span> n_element = Fluid_mesh_pt-&gt;nboundary_element(b);</div>
<div class="line">     </div>
<div class="line">     <span class="comment">// Loop over the bulk elements adjacent to boundary b</span></div>
<div class="line">     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">      {</div>
<div class="line">       <span class="comment">// Get pointer to the bulk element that is adjacent to boundary b</span></div>
<div class="line">       ELEMENT* bulk_elem_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(</div>
<div class="line">        Fluid_mesh_pt-&gt;boundary_element_pt(b,e));</div>
<div class="line">       </div>
<div class="line">       <span class="comment">//What is the index of the face of the element e along boundary b</span></div>
<div class="line">       <span class="keywordtype">int</span> face_index = Fluid_mesh_pt-&gt;face_index_at_boundary(b,e);</div>
<div class="line">       </div>
<div class="line">       <span class="comment">// Build the corresponding lagrange element</span></div>
<div class="line">       ImposeParallelOutflowElement&lt;ELEMENT&gt;* el_pt = <span class="keyword">new</span> </div>
<div class="line">        ImposeParallelOutflowElement&lt;ELEMENT&gt;(bulk_elem_pt,face_index);</div>
<div class="line">       </div>
<div class="line">       <span class="comment">// Add it to the mesh</span></div>
<div class="line">       Parallel_outflow_lagrange_multiplier_mesh_pt[count]-&gt;</div>
<div class="line">        add_element_pt(el_pt);</div>
<div class="line">       </div>
<div class="line">       <span class="comment">// Set the pointer to the prescribed pressure</span></div>
<div class="line">       <span class="keywordflow">if</span> (in_out==0)</div>
<div class="line">        {</div>
<div class="line">         el_pt-&gt;pressure_pt()= &amp;<a class="code" href="namespaceGlobal__Parameters.html#a05b26d00935600b5e0149872844f224c">Global_Parameters::P_in</a>;</div>
<div class="line">        }</div>
<div class="line">       <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">         el_pt-&gt;pressure_pt()= &amp;<a class="code" href="namespaceGlobal__Parameters.html#ac680ed856897793d54c9c867da19169c">Global_Parameters::P_out</a>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">     <span class="comment">// Bump up counter</span></div>
<div class="line">     count++;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// done</span></div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html_aea2fa32b4dd90aab81da540566b9925a"><div class="ttname"><a href="classUnstructuredFluidProblem.html#aea2fa32b4dd90aab81da540566b9925a">UnstructuredFluidProblem::create_parallel_outflow_lagrange_elements</a></div><div class="ttdeci">void create_parallel_outflow_lagrange_elements()</div><div class="ttdoc">Create Lagrange multiplier elements that enforce parallel outflow.</div><div class="ttdef"><b>Definition:</b> <a href="vmtk__fluid_8cc_source.html#l00328">vmtk_fluid.cc:329</a></div></div>
</div><!-- fragment --><hr  />
 <hr  />
<h2><a class="anchor" id="doc"></a>
Post-processing</h2>
<p>The post-processing routine is unchanged.</p>
<hr  />
<h1><a class="anchor" id="comm_ex"></a>
Comments and Exercises</h1>
<h2><a class="anchor" id="re"></a>
What does the Reynolds number mean in this problem?</h2>
<p><code>oomph-lib's</code> implementation of the Navier-Stokes equations is based on <a href="../../driven_cavity/html/index.html#equation">their non-dimensional form</a> so we typically expect the geometry of the problem to have been non-dimensionalised on a representative lengthscale, <img class="formulaInl" alt="$ {\cal L} $" src="form_4.png" width="10" height="10"/>. When dealing with geometries that are obtained from medical images, the vessel coordinates are typically provided as dimensional quantities, e.g. in millimetres. Discarding the unit of the coordinates (i.e. using a non-dimensional coordinate <img class="formulaInl" alt="$ (x,y,z)=(1,2,3)$" src="form_5.png" width="96" height="14"/> to represent the point located at <img class="formulaInl" alt="$ (x^*,y^*,z^*)=(1\mbox{mm},2\mbox{mm},3\mbox{mm}),$" src="form_6.png" width="179" height="14"/> say) is therefore equivalent to non-dimensionalising all lengths on a reference length of <img class="formulaInl" alt="$ {\cal L} = 1\mbox{mm}. $" src="form_7.png" width="56" height="10"/> <a href="../../driven_cavity/html/index.html#equation">Recall</a> that the Reynolds number is defined as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re = \frac{\rho {\cal U} {\cal L}}{\mu} \]" src="form_8.png" width="59" height="30"/>
</p>
<p> where <img class="formulaInl" alt="$ \rho $" src="form_9.png" width="8" height="9"/> and <img class="formulaInl" alt="$ \mu $" src="form_10.png" width="9" height="9"/> are the fluid density and viscosity, respectively. The lengthscale <img class="formulaInl" alt="$ {\cal L} = 1\mbox{mm} $" src="form_11.png" width="54" height="10"/> does obviously not provide a measure of the dimension of our blood vessel whose diameter (at the inlet) is about <img class="formulaInl" alt="$ D \approx 16\mbox{mm}. $" src="form_12.png" width="63" height="10"/> The nominal Reynolds number of <img class="formulaInl" alt="$ Re=10 $" src="form_13.png" width="44" height="10"/> used in the computations is therefore equivalent to an actual Reynolds number (formed with the vessel diameter) of </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re_D = \frac{\rho {\cal U} D }{\mu} = Re \ \frac{D}{\cal L} = 160, \]" src="form_14.png" width="159" height="30"/>
</p>
<p> where the velocity scale <img class="formulaInl" alt="$ {\cal U} $" src="form_15.png" width="10" height="11"/> is formed with the (dimensional) applied pressure drop <img class="formulaInl" alt="$ \Delta P^* $" src="form_16.png" width="25" height="10"/> between the in- and outflow cross-sections, as in the <a href="../../unstructured_three_d_fluid/html/index.html">problem with axis-aligned in- and outflow cross-sections,</a> </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\cal U} = \frac{\Delta P^*\ {\cal L} }{\mu}. \]" src="form_17.png" width="70" height="30"/>
</p>
 <hr  />
<h2><a class="anchor" id="realism"></a>
How to make the simulation more realistic</h2>
<p>The simulation presented above is obviously very crude and serves primarily as a proof of concept. However, it is straightforward to address most of the shortcomings and we encourage you to explore the following improvements:</p><ul>
<li>Generate a finer fluid mesh using the instructions in <code>oomph-lib's</code> <a href="../../../meshes/mesh_from_vmtk/html/index.html">VMTK tutorial </a> We are hoping to make the image files used in this tutorial available soon. Please <a href="../../../contact/html/index.html">contact us</a> if you can't wait. Remember that you will have to update the enumeration of the domain boundaries if you change the mesh. <br  />
<br  />
</li>
<li>Attach "flow extensions" to the in- and outflow cross-sections, using the technique described in <code>oomph-lib's</code> <a href="../../../meshes/mesh_from_vmtk/html/index.html#add_extensions">VMTK tutorial.</a> <br  />
<br  />
</li>
<li>Make the problem time-dependent and apply a period driving pressure drop. <br  />
<br  />
</li>
</ul>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory:<br  />
<br  />
<center> <a href="../../../../demo_drivers/navier_stokes/vmtk_fluid/">demo_drivers/navier_stokes/vmtk_fluid/ </a> </center><br  />
</li>
<li>The driver code is: <br  />
<br  />
<center> <a href="../../../../demo_drivers/navier_stokes/vmtk_fluid/vmtk_fluid.cc">demo_drivers/navier_stokes/vmtk_fluid/vmtk_fluid.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:21:52
        </div>
      </div>
    </footer>
</body>
</html>
