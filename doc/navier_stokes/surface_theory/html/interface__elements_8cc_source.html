<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: interface_elements.cc Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get it <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/subversion/html/index.html">Get code from subversion repository</a></li>
            <li><a href="../../../../doc/download/html/index.html">Get code as tar file</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_5713fbe56016ecb63238bb0c588620db.html">fluid_interface</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">interface_elements.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="interface__elements_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//LIC// ====================================================================</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//LIC// This file forms part of oomph-lib, the object-oriented, </span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//LIC// multi-physics finite-element library, available </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//LIC// at http://www.oomph-lib.org.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//LIC// Copyright (C) 2006-2021 Matthias Heil and Andrew Hazel</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//LIC// This library is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//LIC// modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//LIC// License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//LIC// version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//LIC// This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//LIC// Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//LIC// You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//LIC// License along with this library; if not, write to the Free Software</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//LIC// 02110-1301  USA.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//LIC// The authors may be contacted at oomph-lib@maths.man.ac.uk.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//LIC//====================================================================</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//Non-inline functions for fluid free surface elements</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//OOMPH-LIB headers</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="interface__elements_8h.html">interface_elements.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;../generic/integral.h&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceoomph.html">oomph</a></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//=========================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">/// \short Set a pointer to the desired contact angle. Optional boolean</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">/// (defaults to true)</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/// chooses strong imposition via hijacking (true) or weak imposition</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">/// via addition to momentum equation (false). The default strong imposition</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">/// is appropriate for static contact problems.</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"></span><span class="comment">//=========================================================================</span></div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="classoomph_1_1FluidInterfaceBoundingElement.html#a8566c5bed5c87717fcb155d398ed8c8f">   48</a></span>&#160; <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a8566c5bed5c87717fcb155d398ed8c8f">FluidInterfaceBoundingElement::set_contact_angle</a>(<span class="keywordtype">double</span>* <span class="keyword">const</span> &amp;angle_pt,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                                       <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;strong)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="comment">//Set the pointer to the contact angle</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a351532c356c9e839cba87150bea354c5">Contact_angle_pt</a> = angle_pt;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// If we are hijacking the kinematic condition (the default)</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// to do the strong (pointwise form of the contact-angle condition)</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">if</span>(strong)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// Remember what we&#39;re doing</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#affa8d787e58ca23c2e73b4c8a2c30766">Contact_angle_flag</a> = 1;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">//Hijack the bulk element residuals</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classoomph_1_1FluidInterfaceElement.html">FluidInterfaceElement</a>*<span class="keyword">&gt;</span>(bulk_element_pt())</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;     -&gt;hijack_kinematic_conditions(Bulk_node_number);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;   }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">//Otherwise, we&#39;ll impose it weakly via the momentum equations.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">//This will require that the appropriate velocity node is unpinned,</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">//which is why this is a bad choice for static contact problems in which</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">//there is a no-slip condition on the wall. In that case, the momentum</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">//equation is never assembled and so the contact angle condition is not</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">//applied unless we use the strong version above.</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#affa8d787e58ca23c2e73b4c8a2c30766">Contact_angle_flag</a> = 2;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">//=========================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> /// Add contribution to element&#39;s residual vector and Jacobian</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span><span class="comment">//=========================================================================</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1PointFluidInterfaceBoundingElement.html#aad95a7d6f4e4349ee1136e623aa69c88">PointFluidInterfaceBoundingElement::</a></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="classoomph_1_1PointFluidInterfaceBoundingElement.html#aad95a7d6f4e4349ee1136e623aa69c88">   88</a></span>&#160;<a class="code" href="classoomph_1_1PointFluidInterfaceBoundingElement.html#aad95a7d6f4e4349ee1136e623aa69c88"> fill_in_generic_residual_contribution_interface_boundary</a>(</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  Vector&lt;double&gt; &amp;residuals, </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  DenseMatrix&lt;double&gt; &amp;jacobian, </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordtype">unsigned</span> flag)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">//Let&#39;s get the info from the parent</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  FiniteElement* parent_pt = bulk_element_pt();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">//Find the dimension of the problem</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordtype">unsigned</span> spatial_dim = this-&gt;nodal_dimension();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">// Outer unit normal to the wall</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  Vector&lt;double&gt; wall_normal(spatial_dim);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// Outer unit normal to the free surface</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  Vector&lt;double&gt; unit_normal(spatial_dim);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">//Storage for the coordinate</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  Vector&lt;double&gt; x(spatial_dim);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">//Find the dimension of the parent</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordtype">unsigned</span> n_dim = parent_pt-&gt;dim();</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="comment">//Dummy local coordinate, of size zero</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  Vector&lt;double&gt; s_local(0); </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="comment">//Get the x coordinate</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  this-&gt;interpolated_x(s_local,x);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">//Get the unit normal to the wall</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a1a715427e2037278891c06afd5d096fb">wall_unit_normal</a>(x,wall_normal);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">//Find the local coordinates in the parent</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  Vector&lt;double&gt; s_parent(n_dim);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  this-&gt;get_local_coordinate_in_bulk(s_local,s_parent);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">//Just get the outer unit normal</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keyword">dynamic_cast&lt;</span>FaceElement*<span class="keyword">&gt;</span>(parent_pt)-&gt;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   outer_unit_normal(s_parent,unit_normal);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">//Find the dot product of the two vectors</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordtype">double</span> dot = 0.0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;spatial_dim;i++) </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   {dot += unit_normal[i]*wall_normal[i];}</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">//Get the value of sigma from the parent</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordtype">double</span> sigma_local = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classoomph_1_1FluidInterfaceElement.html">FluidInterfaceElement</a>*<span class="keyword">&gt;</span>(parent_pt)-&gt;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   <a class="code" href="surface__theory_8txt.html#aa6e311b025109a0aa3e5058952a5cd99">sigma</a>(s_parent);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">//Are we doing the weak form replacement</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#affa8d787e58ca23c2e73b4c8a2c30766">Contact_angle_flag</a>==2)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">//Get the wall tangent vector</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    Vector&lt;double&gt; wall_tangent(spatial_dim);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    wall_tangent[0] = - wall_normal[1];</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    wall_tangent[1] = wall_normal[0];</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">//Get the capillary number</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">double</span> ca_local = <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#ae5d097813762a2544d0b49c6e2fbaaac">ca</a>();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">//Just add the appropriate contribution to the momentum equations</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;2;i++)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;     {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordtype">int</span> local_eqn = nodal_local_eqn(0,this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a08223fefc36922f4661e30e9de16830f">U_index_interface_boundary</a>[i]);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keywordflow">if</span>(local_eqn &gt;= 0)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;       {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        residuals[local_eqn] += </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;         (sigma_local/ca_local)*(sin(<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a6803f4ea8de0b3fe17b703d7489c8147">contact_angle</a>())*wall_normal[i]</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                 + cos(<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a6803f4ea8de0b3fe17b703d7489c8147">contact_angle</a>())*wall_tangent[i]);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;       }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;     }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;   }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// Otherwise [strong imposition (by hijacking) of contact angle or</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">// &quot;no constraint at all&quot;], add the appropriate contribution to </span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="comment">// the momentum equation</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// Need to find the current outer normal from the surface</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// which does not necessarily correspond to an imposed angle.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// It is whatever it is...</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    Vector&lt;double&gt; m(spatial_dim);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    this-&gt;outer_unit_normal(s_local,m);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// Get the capillary number</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">double</span> ca_local = <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#ae5d097813762a2544d0b49c6e2fbaaac">ca</a>();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">//Just add the appropriate contribution to the momentum equations</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">//This will, of course, not be added if the equation is pinned</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">//(no slip)</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;2;i++)</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;     {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordtype">int</span> local_eqn = nodal_local_eqn(0,this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a08223fefc36922f4661e30e9de16830f">U_index_interface_boundary</a>[i]);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">if</span>(local_eqn &gt;= 0)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;       {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        residuals[local_eqn] += (sigma_local/ca_local)*m[i];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;       }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;     }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">//If we are imposing the contact angle strongly (by hijacking) </span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// overwrite the kinematic equation</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#affa8d787e58ca23c2e73b4c8a2c30766">Contact_angle_flag</a>==1)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">//Read out the kinematic equation number</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">int</span> local_eqn = <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a12a0a6d7c3c1c1a5a0f42a57e60eab34">kinematic_local_eqn</a>(0);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">//Note that because we have outer unit normals for the free surface</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">//and the wall, the cosine of the contact angle is equal to </span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">//MINUS the dot product computed above</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">if</span>(local_eqn &gt;= 0)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;     {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      residuals[local_eqn] = cos(<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a6803f4ea8de0b3fe17b703d7489c8147">contact_angle</a>()) + dot; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;     }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">//NOTE: The jacobian entries will be computed automatically</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">//by finite differences.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">// Dummy arguments</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  Shape psif(1);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  DShape dpsifds(1,1);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  Vector&lt;double&gt; interpolated_n(1);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">double</span> W=0.0;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="comment">// Now add the additional contributions</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a4510bd81b572d758694715f673080041">add_additional_residual_contributions_interface_boundary</a>(</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   residuals,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   jacobian,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   flag,</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   psif,</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   dpsifds,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   interpolated_n, </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   W);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">//////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">//=========================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"> /// Add contribution to element&#39;s residual vector and Jacobian</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"></span><span class="comment">//=========================================================================</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1LineFluidInterfaceBoundingElement.html#aa162a09ba8dfcba4d81e6abaa7a29986">LineFluidInterfaceBoundingElement::</a></div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="classoomph_1_1LineFluidInterfaceBoundingElement.html#aa162a09ba8dfcba4d81e6abaa7a29986">  234</a></span>&#160;<a class="code" href="classoomph_1_1LineFluidInterfaceBoundingElement.html#aa162a09ba8dfcba4d81e6abaa7a29986"> fill_in_generic_residual_contribution_interface_boundary</a>(</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  Vector&lt;double&gt; &amp;residuals, </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  DenseMatrix&lt;double&gt; &amp;jacobian, </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordtype">unsigned</span> flag)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="comment">//Let&#39;s get the info from the parent</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  FiniteElement* parent_pt = bulk_element_pt();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">//Find the dimension of the problem</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordtype">unsigned</span> spatial_dim = this-&gt;nodal_dimension();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">//Outer unit normal to the wall</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  Vector&lt;double&gt; wall_normal(spatial_dim);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="comment">//Outer unit normal to the free surface</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  Vector&lt;double&gt; unit_normal(spatial_dim);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="comment">//Find the dimension of the parent</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordtype">unsigned</span> n_dim = parent_pt-&gt;dim();</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">//Find the local coordinates in the parent</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  Vector&lt;double&gt; s_parent(n_dim);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">//Storage for the shape functions</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordtype">unsigned</span> n_node = this-&gt;nnode();</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  Shape <a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>(n_node);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  DShape dpsids(n_node,1);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  Vector&lt;double&gt; s_local(1);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="comment">// Loop over intergration points</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">unsigned</span> n_intpt = this-&gt;integral_pt()-&gt;nweight();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ipt=0;ipt&lt;n_intpt;++ipt)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">//Get the local coordinate of the integration point</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    s_local[0] = this-&gt;integral_pt()-&gt;knot(ipt,0);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    get_local_coordinate_in_bulk(s_local,s_parent);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">//Get the local shape functions</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    this-&gt;dshape_local(s_local,<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>,dpsids);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">//Zero the position</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    Vector&lt;double&gt; x(spatial_dim,0.0);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">//Now construct the position and the tangent</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    Vector&lt;double&gt; interpolated_t1(spatial_dim,0.0);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> n=0;n&lt;n_node;n++)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;     {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> psi_local = <a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>(n);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> dpsi_local = dpsids(n,0);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;spatial_dim;i++)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;       {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordtype">double</span> pos = this-&gt;nodal_position(n,i);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        interpolated_t1[i] += pos*dpsi_local;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        x[i] += pos*psi_local;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;       }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;     }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">//Now we can calculate the Jacobian term</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordtype">double</span> t_length = 0.0;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;spatial_dim;++i) </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;     {t_length += interpolated_t1[i]*interpolated_t1[i];}</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordtype">double</span> W = std::sqrt(t_length)*this-&gt;integral_pt()-&gt;weight(ipt);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// Imposition of contact angle in weak form</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#affa8d787e58ca23c2e73b4c8a2c30766">Contact_angle_flag</a>==2)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;     {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="comment">//Get the outer unit normal of the entire interface</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keyword">dynamic_cast&lt;</span>FaceElement*<span class="keyword">&gt;</span>(parent_pt)-&gt;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;       outer_unit_normal(s_parent,unit_normal);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="comment">//Calculate the wall normal</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a1a715427e2037278891c06afd5d096fb">wall_unit_normal</a>(x,wall_normal);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="comment">//Find the dot product of the two</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordtype">double</span> dot = 0.0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;spatial_dim;i++) </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;       {dot += unit_normal[i]*wall_normal[i];}</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="comment">//Find the projection of the outer normal of the surface into the plane</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      Vector&lt;double&gt; binorm(spatial_dim);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;spatial_dim;i++)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;       {binorm[i] = unit_normal[i] - dot*wall_normal[i];}</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="comment">//Get the value of sigma from the parent</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> sigma_local =</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;       <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classoomph_1_1FluidInterfaceElement.html">FluidInterfaceElement</a>*<span class="keyword">&gt;</span>(parent_pt)-&gt;<a class="code" href="surface__theory_8txt.html#aa6e311b025109a0aa3e5058952a5cd99">sigma</a>(s_parent);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="comment">//Get the capillary number</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> ca_local = <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#ae5d097813762a2544d0b49c6e2fbaaac">ca</a>();</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="comment">//Get the contact angle</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> theta = <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a6803f4ea8de0b3fe17b703d7489c8147">contact_angle</a>();</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="comment">// Add the contributions to the momentum equation</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="comment">// Loop over the shape functions</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;       {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="comment">//Loop over the velocity components</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;3;i++)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;         {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <span class="comment">//Get the equation number for the momentum equation</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          <span class="keywordtype">int</span> local_eqn =  this-&gt;nodal_local_eqn(l,this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a08223fefc36922f4661e30e9de16830f">U_index_interface_boundary</a>[i]);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          <span class="comment">//If it&#39;s not a boundary condition</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;          <span class="keywordflow">if</span>(local_eqn &gt;= 0 )</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;           {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="comment">//Add the surface-tension contribution to the momentum equation</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            residuals[local_eqn] +=  (sigma_local/ca_local)*</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;             (sin(theta)*wall_normal[i]</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;              + cos(theta)*binorm[i])*<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>(l)*W;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;           }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;         }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;       }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;     }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// Otherwise [strong imposition (by hijacking) of contact angle or</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// &quot;no constraint at all&quot;], add the appropriate contribution to </span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// the momentum equation</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;     {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="comment">//Storage for the outer vector</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      Vector&lt;double&gt; m(3);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="comment">// Get the outer unit normal of the line</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      this-&gt;outer_unit_normal(s_local,m);  </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="comment">//Get the value of sigma from the parent</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> sigma_local = </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;       <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classoomph_1_1FluidInterfaceElement.html">FluidInterfaceElement</a>*<span class="keyword">&gt;</span>(parent_pt)-&gt;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;       <a class="code" href="surface__theory_8txt.html#aa6e311b025109a0aa3e5058952a5cd99">sigma</a>(s_parent);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="comment">//Get the capillary number</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> ca_local = <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#ae5d097813762a2544d0b49c6e2fbaaac">ca</a>();</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="comment">// Loop over the shape functions</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;       {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="comment">//Loop over the velocity components</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;3;i++)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;         {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;          <span class="comment">//Get the equation number for the momentum equation</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          <span class="keywordtype">int</span> local_eqn =  this-&gt;nodal_local_eqn(l,this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a08223fefc36922f4661e30e9de16830f">U_index_interface_boundary</a>[i]);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          <span class="comment">//If it&#39;s not a boundary condition</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          <span class="keywordflow">if</span>(local_eqn &gt;= 0 )</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;           {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <span class="comment">//Add the surface-tension contribution to the momentum equation</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            residuals[local_eqn] +=  m[i]*(sigma_local/ca_local)*<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>(l)*W;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;           }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;         }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;       }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;     } <span class="comment">//End of the line integral terms</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">//If we are imposing the contact angle strongly (by hijacking) </span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">// overwrite the kinematic equation</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#affa8d787e58ca23c2e73b4c8a2c30766">Contact_angle_flag</a>==1)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;     {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="comment">//Get the outer unit normal of the whole interface</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keyword">dynamic_cast&lt;</span>FaceElement*<span class="keyword">&gt;</span>(parent_pt)-&gt;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;       outer_unit_normal(s_parent,unit_normal);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="comment">//Calculate the wall normal</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a1a715427e2037278891c06afd5d096fb">wall_unit_normal</a>(x,wall_normal);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="comment">//Find the dot product</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordtype">double</span> dot = 0.0;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;spatial_dim;i++) </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;       {dot += unit_normal[i]*wall_normal[i];}</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="comment">//Loop over the test functions</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;       {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="comment">//Read out the kinematic equation number</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordtype">int</span> local_eqn = <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a12a0a6d7c3c1c1a5a0f42a57e60eab34">kinematic_local_eqn</a>(l);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment">//Note that because we have outer unit normals for the free surface</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="comment">//and the wall, the cosine of the contact angle is equal to </span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="comment">//MINUS the dot product</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">if</span>(local_eqn &gt;= 0)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;         {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;          residuals[local_eqn] += </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;           (cos(<a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a6803f4ea8de0b3fe17b703d7489c8147">contact_angle</a>()) + dot)*<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>(l)*W; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;         }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="comment">//NOTE: The jacobian entries will be computed automatically</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="comment">//by finite differences.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;       }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;     } <span class="comment">//End of strong form of contact angle condition</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// Add any additional residual contributions</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="classoomph_1_1FluidInterfaceBoundingElement.html#a4510bd81b572d758694715f673080041">add_additional_residual_contributions_interface_boundary</a>(</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;     residuals,jacobian,flag,<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>,dpsids,unit_normal,W);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">/////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">/////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">/////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">//============================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">/// Default value for physical constant (static)</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"></span><span class="comment">//============================================================</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; <span class="keywordtype">double</span> <a class="code" href="classoomph_1_1FluidInterfaceElement.html#adbe9dc951b87449522f6d19e4acac538">FluidInterfaceElement::Default_Physical_Constant_Value</a> = 1.0;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">//================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">/// Calculate the i-th velocity component at local coordinate s</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"></span><span class="comment">//================================================================</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; <span class="keywordtype">double</span> <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">FluidInterfaceElement::</a></div>
<div class="line"><a name="l00445"></a><span class="lineno"><a class="line" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">  445</a></span>&#160;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969"> interpolated_u</a>(<span class="keyword">const</span> Vector&lt;double&gt; &amp;s, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;i) </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="comment">//Find number of nodes</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordtype">unsigned</span> n_node = FiniteElement::nnode();</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="comment">//Storage for the local shape function</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  Shape <a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>(n_node);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">//Get values of shape function at local coordinate s</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  this-&gt;shape(s,<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">//Initialise value of u</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">double</span> <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">interpolated_u</a> = 0.0;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">//Loop over the local nodes and sum</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++) {<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">interpolated_u</a> += <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a50a509413ea7f2a481678837846dd476">u</a>(l,i)*<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>(l);}</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">return</span>(<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">interpolated_u</a>);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">//===========================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">///Calculate the contribution to the residuals from the interface</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">///implemented generically with geometric information to be</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">///added from the specific elements</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1FluidInterfaceElement.html#ae4ea3a18a513bed3725fdf413cf18874">FluidInterfaceElement:: fill_in_generic_residual_contribution_interface</a>(Vector&lt;double&gt; &amp;residuals, </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                                                                              DenseMatrix&lt;double&gt; &amp;jacobian, </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                                                              <span class="keywordtype">unsigned</span> flag)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="comment">//Find out how many nodes there are</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordtype">unsigned</span> n_node = this-&gt;nnode();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">//Set up memeory for the shape functions</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  Shape psif(n_node);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">//Find out the number of surface coordinates</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> el_dim = this-&gt;dim();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">//We have el_dim local surface coordinates</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  DShape dpsifds(n_node,el_dim);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">//Find the dimension of the problem</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">//Note that this will return 2 for the axisymmetric case</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">//which is correct in the sense that no</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">//terms will be added in the azimuthal direction</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dim = this-&gt;nodal_dimension();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">//Storage for the surface gradient</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="comment">//and divergence terms</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="comment">//These will actually be identical</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="comment">//apart from in the axisymmetric case</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  DShape dpsifdS(n_node,n_dim);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  DShape dpsifdS_div(n_node,n_dim);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">//Set the value of n_intpt</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordtype">unsigned</span> n_intpt = this-&gt;integral_pt()-&gt;nweight();</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="comment">//Get the value of the Capillary number</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordtype">double</span> Ca = <a class="code" href="classoomph_1_1FluidInterfaceElement.html#abcb18ff13b322136dd2346a6b40ecabc">ca</a>();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="comment">//Get the value of the Strouhal numer</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordtype">double</span> St = <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a0c55c0e3cff597363ecb9ab0869c0015">st</a>();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="comment">//Get the value of the external pressure</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordtype">double</span> p_ext = <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a7c0a2a21afce911c301c75febd3ba44c">pext</a>();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="comment">//Integers used to hold the local equation numbers and local unknowns</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="keywordtype">int</span> local_eqn=0, local_unknown=0;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">//Storage for the local coordinate</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  Vector&lt;double&gt; s(el_dim);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">//Loop over the integration points</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ipt=0;ipt&lt;n_intpt;ipt++)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">//Get the value of the local coordiantes at the integration point</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;el_dim;i++) {s[i] = this-&gt;integral_pt()-&gt;knot(ipt,i);}</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">//Get the integral weight</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordtype">double</span> W = this-&gt;integral_pt()-&gt;weight(ipt);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">//Call the derivatives of the shape function</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    this-&gt;dshape_local_at_knot(ipt,psif,dpsifds);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">//Define and zero the tangent Vectors and local velocities</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    Vector&lt;double&gt; interpolated_x(n_dim,0.0);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    Vector&lt;double&gt; <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">interpolated_u</a>(n_dim,0.0);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    Vector&lt;double&gt; interpolated_dx_dt(n_dim,0.0);;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    DenseMatrix&lt;double&gt; interpolated_t(el_dim,n_dim,0.0);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">//Loop over the shape functions</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;     {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="surface__theory_8txt.html#a8406ff84036288382e8fba7b209e1968">psi_</a> = psif(l);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="comment">//Loop over directional components </span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_dim;i++)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;       {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="comment">// Coordinate</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        interpolated_x[i] += this-&gt;nodal_position(l,i)*<a class="code" href="surface__theory_8txt.html#a8406ff84036288382e8fba7b209e1968">psi_</a>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="comment">//Calculate velocity of mesh</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        interpolated_dx_dt[i] += this-&gt;dnodal_position_dt(l,i)*<a class="code" href="surface__theory_8txt.html#a8406ff84036288382e8fba7b209e1968">psi_</a>;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="comment">//Calculate the tangent vectors</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j=0;j&lt;el_dim;j++)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;         {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          interpolated_t(j,i) += this-&gt;nodal_position(l,i)*dpsifds(l,j);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;         }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;       </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="comment">//Calculate velocity and tangent vector</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">interpolated_u</a>[i]  += <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a50a509413ea7f2a481678837846dd476">u</a>(l,i)*<a class="code" href="surface__theory_8txt.html#a8406ff84036288382e8fba7b209e1968">psi_</a>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;       }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;       </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;     }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">//Calculate the surface gradient and divergence</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordtype">double</span> J =</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;     this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a0180a8e36fadbbe6984f9b3c5edffc81">compute_surface_derivatives</a>(psif,dpsifds,</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                       interpolated_t,</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                       interpolated_x,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                       dpsifdS,</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                                       dpsifdS_div);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">//Get the normal vector</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">//(ALH: This could be more efficient because</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">//there is some recomputation of shape functions here)</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    Vector&lt;double&gt; interpolated_n(n_dim); </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    this-&gt;outer_unit_normal(s,interpolated_n);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="comment">//Now also get the (possible variable) surface tension</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordtype">double</span> Sigma = this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a7e5c3ca1eba5d4dd44c0eab9be252c2a">sigma</a>(s);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// Loop over the shape functions</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_node;l++)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;     {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="comment">//Loop over the velocity components</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_dim;i++)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;       {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="comment">//Get the equation number for the momentum equation</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        local_eqn = this-&gt;nodal_local_eqn(l,this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a6a818d9999c68641223edcad217a8c3f">U_index_interface</a>[i]);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="comment">//If it&#39;s not a boundary condition</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">if</span>(local_eqn &gt;= 0)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;         {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;          <span class="comment">//Add the surface-tension contribution to the momentum equation</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;          residuals[local_eqn] -= (Sigma/Ca)*dpsifdS_div(l,i)*J*W;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          <span class="comment">//If the element is a free surface, add in the external pressure</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a9177eb6e96e5ac13fe092596bc104910">Pext_data_pt</a>!=0)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;           {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <span class="comment">//External pressure term</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            residuals[local_eqn] -= p_ext*interpolated_n[i]*psif(l)*J*W;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160; </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="comment">//Add in the Jacobian term for the external pressure</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="comment">//The correct area is included in the length of the normal</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="comment">//vector</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">if</span>(flag)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;             {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;              local_unknown = <a class="code" href="classoomph_1_1FluidInterfaceElement.html#abd4aece98dee8173c6d796e23ccf1e03">pext_local_eqn</a>();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;              <span class="keywordflow">if</span>(local_unknown &gt;= 0)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;               {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                jacobian(local_eqn,local_unknown) -=</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                 interpolated_n[i]*psif(l)*J*W;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;               }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;             }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;           } <span class="comment">//End of pressure contribution</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;         }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;       } <span class="comment">//End of contribution to momentum equation</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="comment">// Kinematic BC</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      local_eqn = <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a58a82e2fd839d4381e43d46a22bf1f25">kinematic_local_eqn</a>(l);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="keywordflow">if</span>(local_eqn &gt;= 0) </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;       {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="comment">//Assemble the kinematic condition</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="comment">//The correct area is included in the normal vector</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> k=0;k&lt;n_dim;k++)</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;         {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          residuals[local_eqn] += </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;           (<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">interpolated_u</a>[k] - St*interpolated_dx_dt[k])</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;           *interpolated_n[k]*psif(l)*J*W;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;         }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;       </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="comment">//Add in the jacobian</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">if</span>(flag)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;         {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          <span class="comment">//Loop over shape functions</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l2=0;l2&lt;n_node;l2++)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;           {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="comment">//Loop over the components</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i2=0;i2&lt;n_dim;i2++)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;             {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;              local_unknown = </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;               this-&gt;nodal_local_eqn(l2,this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a6a818d9999c68641223edcad217a8c3f">U_index_interface</a>[i2]);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;              <span class="comment">//If it&#39;s a non-zero dof add</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;              <span class="keywordflow">if</span>(local_unknown &gt;= 0)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;               {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                jacobian(local_eqn,local_unknown) +=</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                 psif(l2)*interpolated_n[i2]*psif(l)*J*W;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;               }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;             }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;           }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;         } <span class="comment">//End of Jacobian contribution</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;       }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;     } <span class="comment">//End of loop over shape functions</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">// Add additional contribution required from the implementation</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">// of the node update (e.g. Lagrange multpliers etc)</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a0bc278bb201b861f47dc846453be4c06">add_additional_residual_contributions_interface</a>(residuals,</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                                    jacobian,</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                                                    flag,</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                                    psif,</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                                                    dpsifds,</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                                    dpsifdS,</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                                                    dpsifdS_div,</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                                    s,</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                                                    interpolated_x,</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                                                    interpolated_n,</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                                    W,</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                                    J);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;   } <span class="comment">//End of loop over integration points</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">//========================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">///Overload the output functions generically</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment"></span><span class="comment">//=======================================================</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1FluidInterfaceElement.html#aba83fbd0679ffca4ef6aa32f7aa5d179">FluidInterfaceElement::</a></div>
<div class="line"><a name="l00673"></a><span class="lineno"><a class="line" href="classoomph_1_1FluidInterfaceElement.html#a213b1a40132a9605ee8bd31c88b225e0">  673</a></span>&#160;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#aba83fbd0679ffca4ef6aa32f7aa5d179"> output</a>(std::ostream &amp;outfile, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;n_plot)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> el_dim = this-&gt;dim();</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dim = this-&gt;nodal_dimension();</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_velocity = this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a6a818d9999c68641223edcad217a8c3f">U_index_interface</a>.size();</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="comment">//Set output Vector</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  Vector&lt;double&gt; s(el_dim);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="comment">//Tecplot header info </span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  outfile &lt;&lt; tecplot_zone_string(n_plot);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">// Loop over plot points</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordtype">unsigned</span> num_plot_points=nplot_points(n_plot);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iplot=0;iplot&lt;num_plot_points;iplot++)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">//Get local coordinates of pliot point</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    get_s_plot(iplot,n_plot,s);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">//Output the x,y,u,v </span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_dim;i++) outfile &lt;&lt; this-&gt;interpolated_x(s,i) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_velocity;i++) outfile &lt;&lt; <a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">interpolated_u</a>(s,i) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;      </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">//Output a dummy pressure</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    outfile &lt;&lt; 0.0 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;   }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  write_tecplot_zone_footer(outfile,n_plot);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  outfile &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">//===========================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">///Overload the output function</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment"></span><span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; <span class="keywordtype">void</span> <a class="code" href="classoomph_1_1FluidInterfaceElement.html#aba83fbd0679ffca4ef6aa32f7aa5d179">FluidInterfaceElement::</a></div>
<div class="line"><a name="l00710"></a><span class="lineno"><a class="line" href="classoomph_1_1FluidInterfaceElement.html#a57efd66ae07fab9e0cf98ac5f8eeb000">  710</a></span>&#160;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#aba83fbd0679ffca4ef6aa32f7aa5d179"> output</a>(FILE* file_pt, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;n_plot)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> el_dim = this-&gt;dim();</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dim = this-&gt;nodal_dimension();</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_velocity = this-&gt;<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a6a818d9999c68641223edcad217a8c3f">U_index_interface</a>.size();</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="comment">//Set output Vector</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  Vector&lt;double&gt; s(el_dim);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">// Tecplot header info</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  fprintf(file_pt,<span class="stringliteral">&quot;%s&quot;</span>,tecplot_zone_string(n_plot).c_str());</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">// Loop over plot points</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordtype">unsigned</span> num_plot_points=nplot_points(n_plot);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iplot=0;iplot&lt;num_plot_points;iplot++)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// Get local coordinates of plot point</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    get_s_plot(iplot,n_plot,s);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">// Coordinates</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_dim;i++) </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;     {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      fprintf(file_pt,<span class="stringliteral">&quot;%g &quot;</span>,interpolated_x(s,i));</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;     }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;   </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">// Velocities</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_velocity;i++) </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;     {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      fprintf(file_pt,<span class="stringliteral">&quot;%g &quot;</span>,<a class="code" href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">interpolated_u</a>(s,i));</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;     }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;   </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="comment">// Dummy Pressure</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    fprintf(file_pt,<span class="stringliteral">&quot;%g \n&quot;</span>,0.0);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  fprintf(file_pt,<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="comment">// Write tecplot footer (e.g. FE connectivity lists)</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  write_tecplot_zone_footer(file_pt,n_plot);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; }</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160; </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">/////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">/////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">/////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">//====================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">///Specialise the surface derivatives for the line interface case</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment"></span><span class="comment">//===================================================================</span></div>
<div class="line"><a name="l00759"></a><span class="lineno"><a class="line" href="classoomph_1_1LineDerivatives.html#aa50209ce504b25d255f9f0a6df36c0e3">  759</a></span>&#160; <span class="keywordtype">double</span> <a class="code" href="classoomph_1_1LineDerivatives.html#aa50209ce504b25d255f9f0a6df36c0e3">LineDerivatives::compute_surface_derivatives</a>(</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keyword">const</span> Shape &amp;<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>, <span class="keyword">const</span> DShape &amp;dpsids,</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keyword">const</span> DenseMatrix&lt;double&gt; &amp;interpolated_t,</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="keyword">const</span> Vector&lt;double&gt; &amp;interpolated_x,</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  DShape &amp;dpsidS,</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  DShape &amp;dpsidS_div)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_shape = <a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>.nindex1();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dim = 2;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="comment">//Calculate the only entry of the surface</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="comment">//metric tensor (square length of the tangent vector)</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordtype">double</span> a11 = interpolated_t(0,0)*interpolated_t(0,0) + </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   interpolated_t(0,1)*interpolated_t(0,1);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="comment">//Now set the derivative terms of the shape functions</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_shape;l++)</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_dim;i++)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;     {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      dpsidS(l,i) = dpsids(l,0)*interpolated_t(0,i)/a11;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;     }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;   }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">//The surface divergence is the same as the surface</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="comment">//gradient operator</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  dpsidS_div = dpsidS;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="comment">//Return the jacobian</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordflow">return</span> sqrt(a11);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">//====================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">///Specialise the surface derivatives for the axisymmetric interface case</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"></span><span class="comment">//===================================================================</span></div>
<div class="line"><a name="l00799"></a><span class="lineno"><a class="line" href="classoomph_1_1AxisymmetricDerivatives.html#a306ea6b57d09d57e87e8d74a13c2f828">  799</a></span>&#160; <span class="keywordtype">double</span> <a class="code" href="classoomph_1_1AxisymmetricDerivatives.html#a306ea6b57d09d57e87e8d74a13c2f828">AxisymmetricDerivatives::compute_surface_derivatives</a>(</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keyword">const</span> Shape &amp;<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>, <span class="keyword">const</span> DShape &amp;dpsids,</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keyword">const</span> DenseMatrix&lt;double&gt; &amp;interpolated_t,</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keyword">const</span> Vector&lt;double&gt; &amp;interpolated_x,</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  DShape &amp;dpsidS,</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  DShape &amp;dpsidS_div)</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="comment">//Initially the same as the 2D case</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_shape = <a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>.nindex1();</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dim = 2;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="comment">//Calculate the only entry of the surface</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="comment">//metric tensor (square length of the tangent vector)</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordtype">double</span> a11 = interpolated_t(0,0)*interpolated_t(0,0) + </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   interpolated_t(0,1)*interpolated_t(0,1);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="comment">//Now set the derivative terms of the shape functions</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_shape;l++)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;   {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_dim;i++)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;     {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      dpsidS(l,i) = dpsids(l,0)*interpolated_t(0,i)/a11;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="comment">//Set the standard components of the divergence</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      dpsidS_div(l,i) = dpsidS(l,i);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;     }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;   }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="surface__theory_8txt.html#afa70af701d642966c656b9e67d738ca2">r</a> = interpolated_x[0];</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="comment">//The surface divergence is different because we need</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">//to take account of variation of the base vectors</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_shape;l++)</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;   {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    dpsidS_div(l,0) += <a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>(l)/<a class="code" href="surface__theory_8txt.html#afa70af701d642966c656b9e67d738ca2">r</a>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;   }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;   </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="comment">//Return the jacobian, needs to be multiplied by r</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="surface__theory_8txt.html#afa70af701d642966c656b9e67d738ca2">r</a>*sqrt(a11);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">//====================================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">///Specialise the surface derivatives for 2D surface case</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment"></span><span class="comment">//===================================================================</span></div>
<div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="classoomph_1_1SurfaceDerivatives.html#a44e841bfa4ad82dcb87e672c821ffde7">  847</a></span>&#160; <span class="keywordtype">double</span> <a class="code" href="classoomph_1_1SurfaceDerivatives.html#a44e841bfa4ad82dcb87e672c821ffde7">SurfaceDerivatives::compute_surface_derivatives</a>(</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keyword">const</span> Shape &amp;<a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>, <span class="keyword">const</span> DShape &amp;dpsids,</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keyword">const</span> DenseMatrix&lt;double&gt; &amp;interpolated_t,</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keyword">const</span> Vector&lt;double&gt; &amp;interpolated_x,</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  DShape &amp;dpsidS,</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  DShape &amp;dpsidS_div)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_shape = <a class="code" href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a>.nindex1();</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> n_dim = 3;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160; </div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="comment">//Calculate the local metric tensor</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="comment">//The dot product of the two tangent vectors</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordtype">double</span> amet[2][2];</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="surface__theory_8txt.html#a18f0cf6e2d901443012e4f0b262613b3">al</a>=0;<a class="code" href="surface__theory_8txt.html#a18f0cf6e2d901443012e4f0b262613b3">al</a>&lt;2;<a class="code" href="surface__theory_8txt.html#a18f0cf6e2d901443012e4f0b262613b3">al</a>++)</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;   {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> be=0;be&lt;2;be++)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;     {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="comment">//Initialise to zero</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      amet[<a class="code" href="surface__theory_8txt.html#a18f0cf6e2d901443012e4f0b262613b3">al</a>][be] = 0.0;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="comment">//Add the dot product contributions</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_dim;i++)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;       {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        amet[<a class="code" href="surface__theory_8txt.html#a18f0cf6e2d901443012e4f0b262613b3">al</a>][be] += interpolated_t(<a class="code" href="surface__theory_8txt.html#a18f0cf6e2d901443012e4f0b262613b3">al</a>,i)*interpolated_t(be,i);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;       }</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;     }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;   }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="comment">//Work out the determinant</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">double</span> det_a = amet[0][0]*amet[1][1] - amet[0][1]*amet[1][0];</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="comment">//Also work out the contravariant metric</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordtype">double</span> aup[2][2];</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  aup[0][0] = amet[1][1]/det_a;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  aup[0][1] = -amet[0][1]/det_a;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  aup[1][0] = -amet[1][0]/det_a;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  aup[1][1] = amet[0][0]/det_a;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">//Now construct the surface gradient terms</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l=0;l&lt;n_shape;l++)</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;   {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="comment">//Do some pre-computation</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> dpsi_temp[2] =</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;     {aup[0][0]*dpsids(l,0) + aup[0][1]*dpsids(l,1),</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      aup[1][0]*dpsids(l,0) + aup[1][1]*dpsids(l,1)};</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_dim;i++)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;     {</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      dpsidS(l,i) = dpsi_temp[0]*interpolated_t(0,i)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;       + dpsi_temp[1]*interpolated_t(1,i);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;     }</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="comment">//The divergence operator is the same</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  dpsidS_div = dpsidS;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">//Return the jacobian</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="keywordflow">return</span> sqrt(det_a);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="asurface__theory_8txt_html_afa70af701d642966c656b9e67d738ca2"><div class="ttname"><a href="surface__theory_8txt.html#afa70af701d642966c656b9e67d738ca2">r</a></div><div class="ttdeci">oomph AxisymmetricDerivatives, the specific residuals associated with a two dimensional surface in a three dimensional domain, under the assumption of axisymmetry Thus, the coordinate system is cylindrical polar f r, z, theta f, but it is assumed that there are no variations in the f theta f direction It is worthwhile including the required mathematics here because the terms are not the same as in the c LineDerivatives class Specifically, if the surface coordinates are f zeta r(s)</div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_ae5d097813762a2544d0b49c6e2fbaaac"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#ae5d097813762a2544d0b49c6e2fbaaac">oomph::FluidInterfaceBoundingElement::ca</a></div><div class="ttdeci">double ca()</div><div class="ttdoc">Return the value of the capillary number.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00170">interface_elements.h:170</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_abcb18ff13b322136dd2346a6b40ecabc"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#abcb18ff13b322136dd2346a6b40ecabc">oomph::FluidInterfaceElement::ca</a></div><div class="ttdeci">const double &amp; ca() const</div><div class="ttdoc">The value of the Capillary number.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00471">interface_elements.h:471</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a0c55c0e3cff597363ecb9ab0869c0015"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a0c55c0e3cff597363ecb9ab0869c0015">oomph::FluidInterfaceElement::st</a></div><div class="ttdeci">const double &amp; st() const</div><div class="ttdoc">The value of the Strouhal number.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00493">interface_elements.h:493</a></div></div>
<div class="ttc" id="asurface__theory_8txt_html_aa6e311b025109a0aa3e5058952a5cd99"><div class="ttname"><a href="surface__theory_8txt.html#aa6e311b025109a0aa3e5058952a5cd99">sigma</a></div><div class="ttdeci">kappa phi phi sigma</div><div class="ttdef"><b>Definition:</b> <a href="surface__theory_8txt_source.html#l00216">surface_theory.txt:216</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_a1a715427e2037278891c06afd5d096fb"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#a1a715427e2037278891c06afd5d096fb">oomph::FluidInterfaceBoundingElement::wall_unit_normal</a></div><div class="ttdeci">void wall_unit_normal(const Vector&lt; double &gt; &amp;x, Vector&lt; double &gt; &amp;normal)</div><div class="ttdoc">Function that returns the unit normal of the bounding wall directed out of the fluid.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00093">interface_elements.h:93</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_adbe9dc951b87449522f6d19e4acac538"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#adbe9dc951b87449522f6d19e4acac538">oomph::FluidInterfaceElement::Default_Physical_Constant_Value</a></div><div class="ttdeci">static double Default_Physical_Constant_Value</div><div class="ttdoc">Default value for physical constants.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00332">interface_elements.h:332</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_abd4aece98dee8173c6d796e23ccf1e03"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#abd4aece98dee8173c6d796e23ccf1e03">oomph::FluidInterfaceElement::pext_local_eqn</a></div><div class="ttdeci">int pext_local_eqn()</div><div class="ttdoc">Access function for the local equation number that corresponds to the external pressure.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00360">interface_elements.h:360</a></div></div>
<div class="ttc" id="aclassoomph_1_1LineFluidInterfaceBoundingElement_html_aa162a09ba8dfcba4d81e6abaa7a29986"><div class="ttname"><a href="classoomph_1_1LineFluidInterfaceBoundingElement.html#aa162a09ba8dfcba4d81e6abaa7a29986">oomph::LineFluidInterfaceBoundingElement::fill_in_generic_residual_contribution_interface_boundary</a></div><div class="ttdeci">void fill_in_generic_residual_contribution_interface_boundary(Vector&lt; double &gt; &amp;residuals, DenseMatrix&lt; double &gt; &amp;jacobian, unsigned flag)</div><div class="ttdoc">Overload the helper function to calculate the residuals and (if flag==true) the Jacobian  this funct...</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8cc_source.html#l00234">interface_elements.cc:234</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_a08223fefc36922f4661e30e9de16830f"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#a08223fefc36922f4661e30e9de16830f">oomph::FluidInterfaceBoundingElement::U_index_interface_boundary</a></div><div class="ttdeci">Vector&lt; unsigned &gt; U_index_interface_boundary</div><div class="ttdoc">Index at which the i-th velocity component is stored in the element's nodes.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00084">interface_elements.h:84</a></div></div>
<div class="ttc" id="aclassoomph_1_1PointFluidInterfaceBoundingElement_html_aad95a7d6f4e4349ee1136e623aa69c88"><div class="ttname"><a href="classoomph_1_1PointFluidInterfaceBoundingElement.html#aad95a7d6f4e4349ee1136e623aa69c88">oomph::PointFluidInterfaceBoundingElement::fill_in_generic_residual_contribution_interface_boundary</a></div><div class="ttdeci">void fill_in_generic_residual_contribution_interface_boundary(Vector&lt; double &gt; &amp;residuals, DenseMatrix&lt; double &gt; &amp;jacobian, unsigned flag)</div><div class="ttdoc">Overload the helper function to calculate the residuals and (if flag==1) the Jacobian  this function...</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8cc_source.html#l00088">interface_elements.cc:88</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_affa8d787e58ca23c2e73b4c8a2c30766"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#affa8d787e58ca23c2e73b4c8a2c30766">oomph::FluidInterfaceBoundingElement::Contact_angle_flag</a></div><div class="ttdeci">unsigned Contact_angle_flag</div><div class="ttdoc">Flag used to determine whether the contact angle is to be used (0 if not), and whether it will be app...</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00080">interface_elements.h:80</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_a351532c356c9e839cba87150bea354c5"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#a351532c356c9e839cba87150bea354c5">oomph::FluidInterfaceBoundingElement::Contact_angle_pt</a></div><div class="ttdeci">double * Contact_angle_pt</div><div class="ttdoc">Pointer to the desired value of the contact angle (if any)</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00069">interface_elements.h:69</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_a12a0a6d7c3c1c1a5a0f42a57e60eab34"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#a12a0a6d7c3c1c1a5a0f42a57e60eab34">oomph::FluidInterfaceBoundingElement::kinematic_local_eqn</a></div><div class="ttdeci">virtual int kinematic_local_eqn(const unsigned &amp;n)=0</div><div class="ttdoc">Function that is used to determine the local equation number of the kinematic equation associated wit...</div></div>
<div class="ttc" id="aclassoomph_1_1AxisymmetricDerivatives_html_a306ea6b57d09d57e87e8d74a13c2f828"><div class="ttname"><a href="classoomph_1_1AxisymmetricDerivatives.html#a306ea6b57d09d57e87e8d74a13c2f828">oomph::AxisymmetricDerivatives::compute_surface_derivatives</a></div><div class="ttdeci">double compute_surface_derivatives(const Shape &amp;psi, const DShape &amp;dpsids, const DenseMatrix&lt; double &gt; &amp;interpolated_t, const Vector&lt; double &gt; &amp;interpolated_x, DShape &amp;surface_gradient, DShape &amp;surface_divergence)</div><div class="ttdoc">Fill in the specific surface derivative calculations.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8cc_source.html#l00799">interface_elements.cc:799</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_aba83fbd0679ffca4ef6aa32f7aa5d179"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#aba83fbd0679ffca4ef6aa32f7aa5d179">oomph::FluidInterfaceElement::output</a></div><div class="ttdeci">void output(std::ostream &amp;outfile)</div><div class="ttdoc">Overload the output function.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00621">interface_elements.h:621</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_ae4ea3a18a513bed3725fdf413cf18874"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#ae4ea3a18a513bed3725fdf413cf18874">oomph::FluidInterfaceElement::fill_in_generic_residual_contribution_interface</a></div><div class="ttdeci">virtual void fill_in_generic_residual_contribution_interface(Vector&lt; double &gt; &amp;residuals, DenseMatrix&lt; double &gt; &amp;jacobian, unsigned flag)</div><div class="ttdoc">Helper function to calculate the residuals and (if flag==1) the Jacobian of the equations....</div><div class="ttdef"><b>Definition:</b> <a href="surface__theory_8txt_source.html#l00473">surface_theory.txt:473</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a6a818d9999c68641223edcad217a8c3f"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a6a818d9999c68641223edcad217a8c3f">oomph::FluidInterfaceElement::U_index_interface</a></div><div class="ttdeci">Vector&lt; unsigned &gt; U_index_interface</div><div class="ttdoc">Nodal index at which the i-th velocity component is stored.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00338">interface_elements.h:338</a></div></div>
<div class="ttc" id="asurface__theory_8txt_html_a778489f3b8ca18a936dc9fa53e7994da"><div class="ttname"><a href="surface__theory_8txt.html#a778489f3b8ca18a936dc9fa53e7994da">psi</a></div><div class="ttdeci">and the contribution to each component of the momentum equation is found by setting the appropriate component f psi</div><div class="ttdef"><b>Definition:</b> <a href="surface__theory_8txt_source.html#l00505">surface_theory.txt:505</a></div></div>
<div class="ttc" id="anamespaceoomph_html"><div class="ttname"><a href="namespaceoomph.html">oomph</a></div><div class="ttdef"><b>Definition:</b> <a href="constrained__volume__elements_8cc_source.html#l00032">constrained_volume_elements.cc:32</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a9177eb6e96e5ac13fe092596bc104910"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a9177eb6e96e5ac13fe092596bc104910">oomph::FluidInterfaceElement::Pext_data_pt</a></div><div class="ttdeci">Data * Pext_data_pt</div><div class="ttdoc">Pointer to the Data item that stores the external pressure.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00347">interface_elements.h:347</a></div></div>
<div class="ttc" id="aclassoomph_1_1SurfaceDerivatives_html_a44e841bfa4ad82dcb87e672c821ffde7"><div class="ttname"><a href="classoomph_1_1SurfaceDerivatives.html#a44e841bfa4ad82dcb87e672c821ffde7">oomph::SurfaceDerivatives::compute_surface_derivatives</a></div><div class="ttdeci">double compute_surface_derivatives(const Shape &amp;psi, const DShape &amp;dpsids, const DenseMatrix&lt; double &gt; &amp;interpolated_t, const Vector&lt; double &gt; &amp;interpolated_x, DShape &amp;surface_gradient, DShape &amp;surface_divergence)</div><div class="ttdoc">Fill in the specific surface derivative calculations.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8cc_source.html#l00847">interface_elements.cc:847</a></div></div>
<div class="ttc" id="ainterface__elements_8h_html"><div class="ttname"><a href="interface__elements_8h.html">interface_elements.h</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html">oomph::FluidInterfaceElement</a></div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00318">interface_elements.h:318</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a50a509413ea7f2a481678837846dd476"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a50a509413ea7f2a481678837846dd476">oomph::FluidInterfaceElement::u</a></div><div class="ttdeci">double u(const unsigned &amp;j, const unsigned &amp;i)</div><div class="ttdoc">Return the i-th velocity component at local node j.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00499">interface_elements.h:499</a></div></div>
<div class="ttc" id="asurface__theory_8txt_html_a8406ff84036288382e8fba7b209e1968"><div class="ttname"><a href="surface__theory_8txt.html#a8406ff84036288382e8fba7b209e1968">psi_</a></div><div class="ttdeci">f Two separate contributions are then derived from the cases f psi_</div><div class="ttdef"><b>Definition:</b> <a href="surface__theory_8txt_source.html#l00549">surface_theory.txt:549</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a58a82e2fd839d4381e43d46a22bf1f25"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a58a82e2fd839d4381e43d46a22bf1f25">oomph::FluidInterfaceElement::kinematic_local_eqn</a></div><div class="ttdeci">virtual int kinematic_local_eqn(const unsigned &amp;n)=0</div><div class="ttdoc">Access function that returns the local equation number for the (scalar) kinematic equation associated...</div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a7e5c3ca1eba5d4dd44c0eab9be252c2a"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a7e5c3ca1eba5d4dd44c0eab9be252c2a">oomph::FluidInterfaceElement::sigma</a></div><div class="ttdeci">virtual double sigma(const Vector&lt; double &gt; &amp;s_local)</div><div class="ttdoc">Virtual function that specifies the non-dimensional surface tension as a function of local position w...</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00458">interface_elements.h:458</a></div></div>
<div class="ttc" id="aclassoomph_1_1LineDerivatives_html_aa50209ce504b25d255f9f0a6df36c0e3"><div class="ttname"><a href="classoomph_1_1LineDerivatives.html#aa50209ce504b25d255f9f0a6df36c0e3">oomph::LineDerivatives::compute_surface_derivatives</a></div><div class="ttdeci">double compute_surface_derivatives(const Shape &amp;psi, const DShape &amp;dpsids, const DenseMatrix&lt; double &gt; &amp;interpolated_t, const Vector&lt; double &gt; &amp;interpolated_x, DShape &amp;surface_gradient, DShape &amp;surface_divergence)</div><div class="ttdoc">Fill in the specific surface derivative calculations.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8cc_source.html#l00759">interface_elements.cc:759</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_a8566c5bed5c87717fcb155d398ed8c8f"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#a8566c5bed5c87717fcb155d398ed8c8f">oomph::FluidInterfaceBoundingElement::set_contact_angle</a></div><div class="ttdeci">void set_contact_angle(double *const &amp;angle_pt, const bool &amp;strong=true)</div><div class="ttdoc">Set a pointer to the desired contact angle. Optional boolean (defaults to true) chooses strong imposi...</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8cc_source.html#l00048">interface_elements.cc:48</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a8f807a6456da7785b12e45a4c17fb969"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a8f807a6456da7785b12e45a4c17fb969">oomph::FluidInterfaceElement::interpolated_u</a></div><div class="ttdeci">double interpolated_u(const Vector&lt; double &gt; &amp;s, const unsigned &amp;i)</div><div class="ttdoc">Calculate the i-th velocity component at the local coordinate s.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8cc_source.html#l00445">interface_elements.cc:445</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a0bc278bb201b861f47dc846453be4c06"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a0bc278bb201b861f47dc846453be4c06">oomph::FluidInterfaceElement::add_additional_residual_contributions_interface</a></div><div class="ttdeci">virtual void add_additional_residual_contributions_interface(Vector&lt; double &gt; &amp;residuals, DenseMatrix&lt; double &gt; &amp;jacobian, const unsigned &amp;flag, const Shape &amp;psif, const DShape &amp;dpsifds, const DShape &amp;dpsifdS, const DShape &amp;dpsifdS_div, const Vector&lt; double &gt; &amp;s, const Vector&lt; double &gt; &amp;interpolated_x, const Vector&lt; double &gt; &amp;interpolated_n, const double &amp;W, const double &amp;J)</div><div class="ttdoc">Helper function to calculate the additional contributions to the resisuals and Jacobian that arise fr...</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00426">interface_elements.h:426</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_a4510bd81b572d758694715f673080041"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#a4510bd81b572d758694715f673080041">oomph::FluidInterfaceBoundingElement::add_additional_residual_contributions_interface_boundary</a></div><div class="ttdeci">virtual void add_additional_residual_contributions_interface_boundary(Vector&lt; double &gt; &amp;residuals, DenseMatrix&lt; double &gt; &amp;jacobian, const unsigned &amp;flag, const Shape &amp;psif, const DShape &amp;dpsifds, const Vector&lt; double &gt; &amp;interpolated_n, const double &amp;W)</div><div class="ttdoc">Empty helper function to calculate the additional contributions arising from the node update strategy...</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00228">interface_elements.h:228</a></div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a7c0a2a21afce911c301c75febd3ba44c"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a7c0a2a21afce911c301c75febd3ba44c">oomph::FluidInterfaceElement::pext</a></div><div class="ttdeci">double pext() const</div><div class="ttdoc">Return the value of the external pressure.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00506">interface_elements.h:506</a></div></div>
<div class="ttc" id="asurface__theory_8txt_html_a18f0cf6e2d901443012e4f0b262613b3"><div class="ttname"><a href="surface__theory_8txt.html#a18f0cf6e2d901443012e4f0b262613b3">al</a></div><div class="ttdeci">f where f[\mbox{\boldmath $g$}_{\alpha}] see&lt; a href=&quot;../../single_layer_free_surface/html/index.html&quot;&gt; another tutorial&lt;/a &gt; for details Note in general f see below for details&lt; HR &gt; subsection surface_transport Surface Transport Equations Consider a chemical species with surface concentration f Gamma f that is only present on the surface It can be transported within the moving surface by the standard mechanisms of advection and but changes in the surface area can also induce changes in its concentration The formulation of surface transport equations has been discussed many times in the literature and the main confusion surrounds how material derivatives are taken Unlike the conventional bulk equations the surface does not occupy every point in the so one cannot simply use the standard form of the material derivative Rather than covering the here we shall simply&lt; em &gt; ab the governing equations formulated by Lai &amp;Tseng as well as Cermelli et al(2005)</div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceElement_html_a0180a8e36fadbbe6984f9b3c5edffc81"><div class="ttname"><a href="classoomph_1_1FluidInterfaceElement.html#a0180a8e36fadbbe6984f9b3c5edffc81">oomph::FluidInterfaceElement::compute_surface_derivatives</a></div><div class="ttdeci">virtual double compute_surface_derivatives(const Shape &amp;psi, const DShape &amp;dpsids, const DenseMatrix&lt; double &gt; &amp;interpolated_t, const Vector&lt; double &gt; &amp;interpolated_x, DShape &amp;dpsidS, DShape &amp;dpsidS_div)=0</div><div class="ttdoc">Compute the surface gradient and surface divergence operators given the shape functions,...</div></div>
<div class="ttc" id="aclassoomph_1_1FluidInterfaceBoundingElement_html_a6803f4ea8de0b3fe17b703d7489c8147"><div class="ttname"><a href="classoomph_1_1FluidInterfaceBoundingElement.html#a6803f4ea8de0b3fe17b703d7489c8147">oomph::FluidInterfaceBoundingElement::contact_angle</a></div><div class="ttdeci">double &amp; contact_angle()</div><div class="ttdoc">Return value of the contact angle.</div><div class="ttdef"><b>Definition:</b> <a href="interface__elements_8h_source.html#l00191">interface_elements.h:191</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Fri Jul 9 2021 00:40:01
        </div>
      </div>
    </footer>
</body>
</html>
