<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: Fluid Mechanics on unstructured meshes</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Demo problem: Fluid Mechanics on unstructured meshes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial provides another quick demonstration of how to use unstructured meshes for the solution of fluid flow problems. (The <a href="http://en.wikipedia.org/wiki/Xfig">xfig </a>/ <a href="http://www.cs.cmu.edu/~quake/triangle.html"><code>Triangle</code> </a> <a href="../../../meshes/mesh_from_xfig/html/index.html">tutorial</a> already contains 2D and 3D unstructured fluid examples.)</p>
<p>The specific problem considered here serves as a "warm-up problem" for the <a href="../../../interaction/unstructured_fsi/html/index.html">corresponding fluid-structure interaction problem</a> in which the part of the domain boundary is replaced by an elastic object.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="problem"></a>
The problem</h1>
<p>Here is a sketch of the problem: Flow is driven through a 2D channel that is partly obstructed by an odd-shaped obstacle. The flow is driven by the imposed Poiseuille flow at the upstream end of the channel.</p>
<div class="image">
<img src="fluid_sketch.gif" alt=""/>
<div class="caption">
Sketch of the problem. </div></div>
 <hr  />
 <hr  />
<h1><a class="anchor" id="mesh"></a>
Mesh generation</h1>
<p>We use the combination of <a href="http://en.wikipedia.org/wiki/Xfig">xfig</a>, <code>oomph-lib's</code> conversion code <a href="../../../meshes/mesh_from_xfig/html/index.html"><code>fig2poly</code> </a>, and the unstructured mesh generator <a href="http://www.cs.cmu.edu/~quake/triangle.html"><code>Triangle</code> </a> to generate the mesh, using the procedure discussed in <a href="../../../meshes/mesh_from_xfig/html/index.html">another tutorial.</a></p>
<p>We start by drawing the outline of the fluid domain as a polyline in <a href="http://en.wikipedia.org/wiki/Xfig">xfig</a>:</p>
<div class="image">
<img src="xfig_screenshot.gif" alt=""/>
<div class="caption">
xfig drawing of the fluid body. </div></div>
 <p>(Note that we draw the domain upside-down because of the way <a href="http://en.wikipedia.org/wiki/Xfig">xfig</a> orients its coordinate axes.)</p>
<p>We save the figure as a *.fig file and convert it to a *.poly file using <code>oomph-lib's</code> conversion code <a href="../../../meshes/mesh_from_xfig/html/index.html"><code>fig2poly</code> </a> (a copy of which is located in <code>oomph-lib's</code> <code>bin</code> directory):</p>
<div class="fragment"><div class="line">fig2poly fluid.fig </div>
</div><!-- fragment --><p>This creates a file called <code>fluid.fig.poly</code> that can be processed using Triangle. For instance, to create a quality mesh with a maximum element size of 0.03 we use </p><div class="fragment"><div class="line">triangle -q -a0.03 fluid.fig.poly</div>
</div><!-- fragment --><p>Here is a plot of the mesh, generated by <code>showme</code> distributed with <a href="http://www.cs.cmu.edu/~quake/triangle.html"><code>Triangle</code> </a>:</p>
<div class="image">
<img src="showme_screenshot.gif" alt=""/>
<div class="caption">
Visualisation of the mesh with showme. </div></div>
 <p>The <code> *.poly, *.ele </code> and <code> *.node </code> files generated by <a href="http://www.cs.cmu.edu/~quake/triangle.html"><code>Triangle</code> </a> can now be used as input to <code>oomph-lib's</code> <code>TriangleMesh</code> class.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="results"></a>
Results</h1>
<p>The animation shown below illustrates the flow field (streamlines and pressure contours) for Reynolds numbers of <img class="formulaInl" alt="$ Re=0, 5, 10, ... $" src="form_0.png" width="84" height="13"/> An increase in Reynolds number increases the length of the recirculation region behind the obstacle; furthermore, the sharp corner at the "leading edge" of the obstacle creates very low pressures just downstream of the corner.</p>
<div class="image">
<img src="stream.gif" alt=""/>
<div class="caption">
Flowfield (streamlines and pressure contours) at various Reynolds numbers. </div></div>
 <hr  />
 <hr  />
<h1><a class="anchor" id="mesh_code"></a>
Creating the mesh</h1>
<p>In anticipation of the mesh's use in a fluid-structure interaction problem, we create the mesh by multiple inheritance from <code>oomph-lib's</code> <code>TriangleMesh</code> and the <code>SolidMesh</code> base class. This will allow us to use pseudo-solid node-update techniques to update the position of the fluid nodes in response to changes in the domain boundary. In the present problem, the "elasticity" of the fluid elements plays no useful role; see <a class="el" href="index.html#comm_ex">Comments and Exercises</a> for instructions on how to remove the pseudo-elasticity from the problem.</p>
 <div class="fragment"><div class="line"><span class="comment">//===========start_mesh====================================================</span></div>
<div class="line"><span class="comment">/// Triangle-based mesh upgraded to become a (pseudo-) solid mesh</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classElasticTriangleMesh.html">ElasticTriangleMesh</a> : <span class="keyword">public</span> <span class="keyword">virtual</span> TriangleMesh&lt;ELEMENT&gt;,</div>
<div class="line">                            <span class="keyword">public</span> <span class="keyword">virtual</span> SolidMesh </div>
<div class="line">{</div>
<div class="ttc" id="aclassElasticTriangleMesh_html"><div class="ttname"><a href="classElasticTriangleMesh.html">ElasticTriangleMesh</a></div><div class="ttdoc">Triangle-based mesh upgraded to become a (pseudo-) solid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00048">unstructured_two_d_fluid.cc:50</a></div></div>
</div><!-- fragment --><p> The constructor calls the constructor of the underlying <code>TriangleMesh</code>, and, as usual, sets the Lagrangian coordinates to the current nodal positions, making the current configuration stress-free.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Constructor: </span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classElasticTriangleMesh.html">ElasticTriangleMesh</a>(<span class="keyword">const</span> std::string&amp; node_file_name,</div>
<div class="line">                     <span class="keyword">const</span> std::string&amp; element_file_name,</div>
<div class="line">                     <span class="keyword">const</span> std::string&amp; poly_file_name,</div>
<div class="line">                     TimeStepper* time_stepper_pt=</div>
<div class="line">                     &amp;Mesh::Default_TimeStepper) : </div>
<div class="line"> TriangleMesh&lt;ELEMENT&gt;(node_file_name,element_file_name,</div>
<div class="line">                       poly_file_name, time_stepper_pt)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">//Assign the Lagrangian coordinates</span></div>
<div class="line">   set_lagrangian_nodal_coordinates();</div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Identify the domain boundaries</span></div>
<div class="line">   this-&gt;identify_boundaries();</div>
<div class="line">  }</div>
</div><!-- fragment --><p> The <code>TriangleMesh</code> constructor associates each polyline in the <code>xfig</code> drawing with a distinct <code>oomph-lib</code> mesh boundary. Hence the boundary nodes are initially located on the same, single boundary. The boundary conditions can be more easily applied if the boundary is divided into three boundaries, which is the task of the function <code>TriangleMesh::identify_boundaries()</code>.</p>
<p>We first allocate storage for three boundaries:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Function used to identify the domain boundaries</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> identify_boundaries()</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// We will have three boundaries</span></div>
<div class="line">   this-&gt;set_nboundary(3);</div>
</div><!-- fragment --><p> We loop over all nodes in the mesh and identify nodes on the left (inflow) boundary by their x-coordinate. We remove the node from the boundary 0 and re-allocate it to the new boundary 1:</p>
<div class="fragment"><div class="line"> </div>
<div class="line">   <span class="keywordtype">unsigned</span> n_node=this-&gt;nnode();</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;n_node;j++)</div>
<div class="line">    {</div>
<div class="line">     Node* nod_pt=this-&gt;node_pt(j);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Boundary 1 is left (inflow) boundary</span></div>
<div class="line">     <span class="keywordflow">if</span> (nod_pt-&gt;x(0)&lt;0.226)</div>
<div class="line">      {</div>
<div class="line">       <span class="comment">// If it&#39;s not on the upper or lower channel walls remove it</span></div>
<div class="line">       <span class="comment">// from boundary 0</span></div>
<div class="line">       <span class="keywordflow">if</span> ((nod_pt-&gt;x(1)&lt;4.08)&amp;&amp;(nod_pt-&gt;x(1)&gt;0.113))</div>
<div class="line">        {</div>
<div class="line">         this-&gt;remove_boundary_node(0,nod_pt);</div>
<div class="line">        }</div>
</div><!-- fragment --><p> Similarly, we identify all nodes on the right (outflow) boundary and re-assign them to boundary 2, before re-generating the various boundary lookup schemes that identify which elements are located next to the various mesh boundaries:</p>
<div class="fragment"><div class="line">       this-&gt;add_boundary_node(1,nod_pt);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Boundary 2 is right (outflow) boundary</span></div>
<div class="line">     <span class="keywordflow">if</span> (nod_pt-&gt;x(0)&gt;8.28)</div>
<div class="line">      {</div>
<div class="line">       <span class="comment">// If it&#39;s not on the upper or lower channel walls remove it</span></div>
<div class="line">       <span class="comment">// from boundary 0</span></div>
<div class="line">       <span class="keywordflow">if</span> ((nod_pt-&gt;x(1)&lt;4.08)&amp;&amp;(nod_pt-&gt;x(1)&gt;0.113))</div>
<div class="line">        {</div>
<div class="line">         this-&gt;remove_boundary_node(0,nod_pt);</div>
<div class="line">        }</div>
<div class="line">       this-&gt;add_boundary_node(2,nod_pt);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">   this-&gt;setup_boundary_element_info();</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Empty Destructor</span></div>
<div class="line"><span class="comment"></span> <span class="keyword">virtual</span> ~<a class="code" href="classElasticTriangleMesh.html">ElasticTriangleMesh</a>() { }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="namespace"></a>
Problem Parameters</h1>
<p>As usual we define the various problem parameters in a global namespace. We define the Reynolds number and prepare a pointer to a constitutive equation (for the pseudo-elastic elements).</p>
<div class="fragment"><div class="line"><span class="comment">//==start_namespace==============================</span></div>
<div class="line"><span class="comment">/// Namespace for physical parameters</span></div>
<div class="line"><span class="comment"></span><span class="comment">//==================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Reynolds number</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Re</a>=0.0; </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pseudo-solid Poisson ratio</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a3962c36313826b19f216f6bbbdd6a477">Nu</a>=0.3;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constitutive law used to determine the mesh deformation</span></div>
<div class="line"><span class="comment"></span> ConstitutiveLaw *<a class="code" href="namespaceGlobal__Physical__Variables.html#a2a37fb040c832ee7a086bb13bb02a100">Constitutive_law_pt</a>=0;</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end_of_namespace</span></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div><div class="ttdoc">Namespace for physical parameters.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00120">unstructured_two_d_fluid.cc:121</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a2a37fb040c832ee7a086bb13bb02a100"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a2a37fb040c832ee7a086bb13bb02a100">Global_Physical_Variables::Constitutive_law_pt</a></div><div class="ttdeci">ConstitutiveLaw * Constitutive_law_pt</div><div class="ttdoc">Constitutive law used to determine the mesh deformation.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00130">unstructured_two_d_fluid.cc:130</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a3962c36313826b19f216f6bbbdd6a477"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a3962c36313826b19f216f6bbbdd6a477">Global_Physical_Variables::Nu</a></div><div class="ttdeci">double Nu</div><div class="ttdoc">Pseudo-solid Poisson ratio.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00127">unstructured_two_d_fluid.cc:127</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_ab814e627d2eb5bc50318879d19ab16b9"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a></div><div class="ttdeci">double Re</div><div class="ttdoc">Reynolds number.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00124">unstructured_two_d_fluid.cc:124</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="main"></a>
The driver code</h1>
<p>We specify an output directory and instantiate a constitutive equation for the pseudo-elasticity, specifying the Poisson ratio.</p>
 <div class="fragment"><div class="line"><span class="comment">//==start_of_main======================================================</span></div>
<div class="line"><span class="comment">/// Driver for unstructured fluid test problem</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=====================================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="unstructured__two__d__fluid_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Label for output</span></div>
<div class="line"> DocInfo doc_info;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Set the constitutive law for the pseudo-elasticity</span></div>
<div class="line"> <a class="code" href="namespaceGlobal__Physical__Variables.html#a2a37fb040c832ee7a086bb13bb02a100">Global_Physical_Variables::Constitutive_law_pt</a> = </div>
<div class="line">  <span class="keyword">new</span> GeneralisedHookean(&amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#a3962c36313826b19f216f6bbbdd6a477">Global_Physical_Variables::Nu</a>);</div>
<div class="ttc" id="aunstructured__two__d__fluid_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="unstructured__two__d__fluid_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdoc">///////////////////////////////////////////////////////////////////// ///////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00370">unstructured_two_d_fluid.cc:370</a></div></div>
</div><!-- fragment --><p> We create the <code>Problem</code> object and output the domain boundaries and the initial guess for the flow field. </p><div class="fragment"><div class="line">  <span class="comment">// Build the problem with TTaylorHoodElements</span></div>
<div class="line">  <a class="code" href="classUnstructuredFluidProblem.html">UnstructuredFluidProblem</a>&lt;PseudoSolidNodeUpdateElement&lt;</div>
<div class="line">   TTaylorHoodElement&lt;2&gt;, </div>
<div class="line">   TPVDElement&lt;2,3&gt; &gt; &gt; problem;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Output boundaries </span></div>
<div class="line">  problem.<a class="code" href="classUnstructuredFluidProblem.html#abc5f7e9929eb6f174eaa49a491489ad9">fluid_mesh_pt</a>()-&gt;output_boundaries(<span class="stringliteral">&quot;RESLT_TH/boundaries.dat&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Output the initial guess for the solution</span></div>
<div class="line">  problem.doc_solution(doc_info);</div>
<div class="line">  doc_info.number()++;</div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html"><div class="ttname"><a href="classUnstructuredFluidProblem.html">UnstructuredFluidProblem</a></div><div class="ttdoc">///////////////////////////////////////////////////////////////////// ///////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00146">unstructured_two_d_fluid.cc:147</a></div></div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html_abc5f7e9929eb6f174eaa49a491489ad9"><div class="ttname"><a href="classUnstructuredFluidProblem.html#abc5f7e9929eb6f174eaa49a491489ad9">UnstructuredFluidProblem::fluid_mesh_pt</a></div><div class="ttdeci">ElasticTriangleMesh&lt; ELEMENT &gt; *&amp; fluid_mesh_pt()</div><div class="ttdoc">Access function for the fluid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00158">unstructured_two_d_fluid.cc:158</a></div></div>
</div><!-- fragment --><p> Finally, we perform a straightforward parameter study by slowly increasing the Reynolds number of the flow from zero.</p>
<div class="fragment"><div class="line">  </div>
<div class="line">  <span class="comment">// Parameter study</span></div>
<div class="line">  <span class="keywordtype">double</span> re_increment=5.0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> nstep=2; <span class="comment">// 10;</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;nstep;i++)</div>
<div class="line">   {</div>
<div class="line">    <span class="comment">// Solve the problem</span></div>
<div class="line">    problem.newton_solve();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Output the solution</span></div>
<div class="line">    problem.doc_solution(doc_info);</div>
<div class="line">    doc_info.number()++;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Bump up Re</span></div>
<div class="line">    <a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a>+=re_increment;</div>
<div class="line">   }  <span class="comment">//end_of_parameter_study</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="class"></a>
The Problem class</h1>
<p>The <code>Problem</code> class has the usual member functions and provides explicit storage for the fluid mesh. [This is again slight overkill for the problem at hand, and is done mainly in anticipation of the "upgrade" of this driver code to <a href="../../../interaction/unstructured_fsi/html/index.html">the FSI problem</a> with its multiple meshes; in the present problem we could, of course, store the pointer to the problem's one-and-only mesh directly in <code>Problem::mesh_pt()</code>. ]</p>
 <div class="fragment"><div class="line"><span class="comment">//==start_of_problem_class============================================</span></div>
<div class="line"><span class="comment">/// Unstructured fluid problem</span></div>
<div class="line"><span class="comment"></span><span class="comment">//====================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classUnstructuredFluidProblem.html">UnstructuredFluidProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor </span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classUnstructuredFluidProblem.html#a9751f4afac540e148b3d90ae43dd5187">UnstructuredFluidProblem</a>();</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Destructor (empty)</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classUnstructuredFluidProblem.html#a4d660faa6bae35197a4ea73139ac9963">~UnstructuredFluidProblem</a>(){}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function for the fluid mesh</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classElasticTriangleMesh.html">ElasticTriangleMesh&lt;ELEMENT&gt;</a>*&amp; <a class="code" href="classUnstructuredFluidProblem.html#abc5f7e9929eb6f174eaa49a491489ad9">fluid_mesh_pt</a>() </div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="classUnstructuredFluidProblem.html#a9b653c3879c846b412068d03bfe8c202">Fluid_mesh_pt</a>;</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Set the boundary conditions</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredFluidProblem.html#a4e57ba31d35b62c9c657c1cfd822ecde">set_boundary_conditions</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc the solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredFluidProblem.html#abcc9f0065665ae5239988b1a812e3f78">doc_solution</a>(DocInfo&amp; doc_info);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Fluid mesh</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classElasticTriangleMesh.html">ElasticTriangleMesh&lt;ELEMENT&gt;</a>* <a class="code" href="classUnstructuredFluidProblem.html#a9b653c3879c846b412068d03bfe8c202">Fluid_mesh_pt</a>;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// end_of_problem_class</span></div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html_a4d660faa6bae35197a4ea73139ac9963"><div class="ttname"><a href="classUnstructuredFluidProblem.html#a4d660faa6bae35197a4ea73139ac9963">UnstructuredFluidProblem::~UnstructuredFluidProblem</a></div><div class="ttdeci">~UnstructuredFluidProblem()</div><div class="ttdoc">Destructor (empty)</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00155">unstructured_two_d_fluid.cc:155</a></div></div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html_a4e57ba31d35b62c9c657c1cfd822ecde"><div class="ttname"><a href="classUnstructuredFluidProblem.html#a4e57ba31d35b62c9c657c1cfd822ecde">UnstructuredFluidProblem::set_boundary_conditions</a></div><div class="ttdeci">void set_boundary_conditions()</div><div class="ttdoc">Set the boundary conditions.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00214">unstructured_two_d_fluid.cc:214</a></div></div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html_a9751f4afac540e148b3d90ae43dd5187"><div class="ttname"><a href="classUnstructuredFluidProblem.html#a9751f4afac540e148b3d90ae43dd5187">UnstructuredFluidProblem::UnstructuredFluidProblem</a></div><div class="ttdeci">UnstructuredFluidProblem()</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00182">unstructured_two_d_fluid.cc:182</a></div></div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html_a9b653c3879c846b412068d03bfe8c202"><div class="ttname"><a href="classUnstructuredFluidProblem.html#a9b653c3879c846b412068d03bfe8c202">UnstructuredFluidProblem::Fluid_mesh_pt</a></div><div class="ttdeci">ElasticTriangleMesh&lt; ELEMENT &gt; * Fluid_mesh_pt</div><div class="ttdoc">Fluid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00172">unstructured_two_d_fluid.cc:172</a></div></div>
<div class="ttc" id="aclassUnstructuredFluidProblem_html_abcc9f0065665ae5239988b1a812e3f78"><div class="ttname"><a href="classUnstructuredFluidProblem.html#abcc9f0065665ae5239988b1a812e3f78">UnstructuredFluidProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(DocInfo &amp;doc_info)</div><div class="ttdoc">Doc the solution.</div><div class="ttdef"><b>Definition:</b> <a href="unstructured__two__d__fluid_8cc_source.html#l00339">unstructured_two_d_fluid.cc:339</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="constructor"></a>
The Problem constructor</h1>
<p>We start by building the fluid mesh, using the files created by <a href="http://www.cs.cmu.edu/~quake/triangle.html"><code>Triangle</code> </a>.</p>
<div class="fragment"><div class="line"><span class="comment">//==start_constructor=====================================================</span></div>
<div class="line"><span class="comment">/// Constructor </span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a class="code" href="classUnstructuredFluidProblem.html#a9751f4afac540e148b3d90ae43dd5187">UnstructuredFluidProblem&lt;ELEMENT&gt;::UnstructuredFluidProblem</a>()</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Create fluid mesh</span></div>
<div class="line"> <span class="keywordtype">string</span> fluid_node_file_name=<span class="stringliteral">&quot;fluid.fig.1.node&quot;</span>;</div>
<div class="line"> <span class="keywordtype">string</span> fluid_element_file_name=<span class="stringliteral">&quot;fluid.fig.1.ele&quot;</span>;</div>
<div class="line"> <span class="keywordtype">string</span> fluid_poly_file_name=<span class="stringliteral">&quot;fluid.fig.1.poly&quot;</span>; </div>
<div class="line"> Fluid_mesh_pt = <span class="keyword">new</span> <a class="code" href="classElasticTriangleMesh.html">ElasticTriangleMesh&lt;ELEMENT&gt;</a>(fluid_node_file_name,</div>
<div class="line">                                                  fluid_element_file_name,</div>
<div class="line">                                                  fluid_poly_file_name);</div>
</div><!-- fragment --><p> Next, we apply the boundary conditions for the fluid and the pseudo-solid equations using the function <code>set_boundary_conditions()</code>, which also completes the build of the elements by setting the appropriate pointers to the physical variables.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">//Set the boundary conditions</span></div>
<div class="line"> this-&gt;set_boundary_conditions();</div>
</div><!-- fragment --><p> We add the fluid mesh as a single sub-mesh to the <code>Problem</code> and build the global mesh (see the comment in <a class="el" href="index.html#class">The Problem class</a> .)</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Add fluid mesh</span></div>
<div class="line"> add_sub_mesh(fluid_mesh_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build global mesh</span></div>
<div class="line"> build_global_mesh();</div>
</div><!-- fragment --><p> Finally, we assign the equation numbers</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Setup equation numbering scheme</span></div>
<div class="line"> cout &lt;&lt;<span class="stringliteral">&quot;Number of equations: &quot;</span> &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl; </div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end_of_constructor</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="bound"></a>
Setting the boundary conditions</h1>
<p>We pin the pseudo-solid nodes along all domain boundaries, apply a no-slip condition for the fluid velocity along the solid boundary (boundary 0), pin the velocity at the inflow (boundary 1, where we will impose a Poiseuille flow profile), and impose parallel outflow at the downstream end (boundary 2). Given that the manual identification of mesh boundaries in unstructured meshes that are generated by third-party mesh generators is a relatively error-prone process, we document the boundary conditions in three separate files to allow an external sanity check; see <a href="../../../solid/unstructured_solid/html/index.html#comm_ex">the comments in the corresponding solid mechanics tutorial.</a> The <a class="el" href="index.html#comm_ex">Comments and Exercises</a> section of the present tutorial also has a sub-section that illustrates what can go wrong.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">//============start_of_set_boundary_conditions=============================</span><span class="comment"></span></div>
<div class="line"><span class="comment">/// Set the boundary conditions for the problem and document the boundary</span></div>
<div class="line"><span class="comment">/// nodes</span></div>
<div class="line"><span class="comment"></span><span class="comment">//==========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUnstructuredFluidProblem.html#a4e57ba31d35b62c9c657c1cfd822ecde">UnstructuredFluidProblem&lt;ELEMENT&gt;::set_boundary_conditions</a>()</div>
<div class="line">{ </div>
<div class="line"> <span class="comment">// Doc pinned nodes</span></div>
<div class="line"> std::ofstream solid_bc_file(<span class="stringliteral">&quot;pinned_solid_nodes.dat&quot;</span>);</div>
<div class="line"> std::ofstream u_bc_file(<span class="stringliteral">&quot;pinned_u_nodes.dat&quot;</span>);</div>
<div class="line"> std::ofstream v_bc_file(<span class="stringliteral">&quot;pinned_v_nodes.dat&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set the boundary conditions for fluid problem: All nodes are</span></div>
<div class="line"> <span class="comment">// free by default -- just pin the ones that have Dirichlet conditions</span></div>
<div class="line"> <span class="comment">// here. </span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nbound=Fluid_mesh_pt-&gt;nboundary();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=0;ibound&lt;nbound;ibound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod=Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Get node</span></div>
<div class="line">     Node* nod_pt=Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Pin velocity everywhere apart from outlet where we</span></div>
<div class="line">     <span class="comment">// have parallel outflow</span></div>
<div class="line">     <span class="keywordflow">if</span> (ibound!=2)</div>
<div class="line">      {</div>
<div class="line">       <span class="comment">// Pin it</span></div>
<div class="line">       nod_pt-&gt;pin(0);</div>
<div class="line">       <span class="comment">// Doc it as pinned</span></div>
<div class="line">       u_bc_file &lt;&lt; nod_pt-&gt;x(0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nod_pt-&gt;x(1) &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">     <span class="comment">// Pin it</span></div>
<div class="line">     nod_pt-&gt;pin(1);</div>
<div class="line">     <span class="comment">// Doc it as pinned</span></div>
<div class="line">     v_bc_file &lt;&lt; nod_pt-&gt;x(0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nod_pt-&gt;x(1) &lt;&lt; std::endl;</div>
<div class="line">     </div>
<div class="line">     <span class="comment">// Pin pseudo-solid positions everywhere</span></div>
<div class="line">     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;2;i++)</div>
<div class="line">      {</div>
<div class="line">       <span class="comment">// Pin the node</span></div>
<div class="line">       SolidNode* nod_pt=Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod);</div>
<div class="line">       nod_pt-&gt;pin_position(i);</div>
<div class="line">       </div>
<div class="line">       <span class="comment">// Doc it as pinned</span></div>
<div class="line">       solid_bc_file &lt;&lt; nod_pt-&gt;x(i) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">      }</div>
<div class="line">     solid_bc_file &lt;&lt; std::endl;    </div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// end loop over boundaries</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Close</span></div>
<div class="line"> solid_bc_file.close();</div>
</div><!-- fragment --><p> We complete the build of the elements by specifying the Reynolds number and the constitutive equation for the pseudo-solid equations.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Complete the build of all elements so they are fully functional</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element = fluid_mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Upcast from GeneralisedElement to the present element</span></div>
<div class="line">   ELEMENT* el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(fluid_mesh_pt()-&gt;element_pt(e));</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Set the Reynolds number</span></div>
<div class="line">   el_pt-&gt;re_pt() = &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#ab814e627d2eb5bc50318879d19ab16b9">Global_Physical_Variables::Re</a>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Set the constitutive law</span></div>
<div class="line">   el_pt-&gt;constitutive_law_pt() =</div>
<div class="line">    <a class="code" href="namespaceGlobal__Physical__Variables.html#a2a37fb040c832ee7a086bb13bb02a100">Global_Physical_Variables::Constitutive_law_pt</a>;</div>
<div class="line">  } </div>
</div><!-- fragment --><p> Finally, we impose a Poiseuille profile at the inflow boundary (boundary 1).</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Apply fluid boundary conditions: Poiseuille at inflow</span></div>
<div class="line"> <span class="comment">//------------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Find max. and min y-coordinate at inflow</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> ibound=1;</div>
<div class="line"> <span class="comment">//Initialise y_min and y_max to y-coordinate of first node on boundary</span></div>
<div class="line"> <span class="keywordtype">double</span> y_min=fluid_mesh_pt()-&gt;boundary_node_pt(ibound,0)-&gt;x(1);</div>
<div class="line"> <span class="keywordtype">double</span> y_max=y_min;</div>
<div class="line"> <span class="comment">//Loop over the rest of the nodes</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> num_nod= fluid_mesh_pt()-&gt;nboundary_node(ibound);</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=1;inod&lt;num_nod;inod++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">double</span> y=fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;x(1);</div>
<div class="line">   <span class="keywordflow">if</span> (y&gt;y_max)</div>
<div class="line">    {</div>
<div class="line">     y_max=y;</div>
<div class="line">    }</div>
<div class="line">   <span class="keywordflow">if</span> (y&lt;y_min)</div>
<div class="line">    {</div>
<div class="line">     y_min=y;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> <span class="keywordtype">double</span> y_mid=0.5*(y_min+y_max);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over all boundaries</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ibound=0;ibound&lt;fluid_mesh_pt()-&gt;nboundary();ibound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod= fluid_mesh_pt()-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Parabolic inflow at the left boundary (boundary 1)</span></div>
<div class="line">     <span class="keywordflow">if</span> (ibound==1)</div>
<div class="line">      {</div>
<div class="line">       <span class="keywordtype">double</span> y=fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;x(1);</div>
<div class="line">       <span class="keywordtype">double</span> veloc=1.5/(y_max-y_min)*</div>
<div class="line">        (y-y_min)*(y_max-y)/((y_mid-y_min)*(y_max-y_mid));</div>
<div class="line">       fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(0,veloc);</div>
<div class="line">       fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(1,0.0);</div>
<div class="line">      }</div>
<div class="line">     <span class="comment">// Zero flow elsewhere apart from x-velocity on outflow boundary</span></div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">       <span class="keywordflow">if</span>(ibound!=2)</div>
<div class="line">        {</div>
<div class="line">         fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(0,0.0);</div>
<div class="line">        }</div>
<div class="line">       fluid_mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(1,0.0);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">// end_of_set_boundary_conditions</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="doc"></a>
Post-processing</h1>
<p>The post-processing routine outputs the flow field.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">//==start_of_doc_solution=================================================</span><span class="comment"></span></div>
<div class="line"><span class="comment">/// Doc the solution</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUnstructuredFluidProblem.html#abcc9f0065665ae5239988b1a812e3f78">UnstructuredFluidProblem&lt;ELEMENT&gt;::doc_solution</a>(DocInfo&amp; doc_info)</div>
<div class="line">{ </div>
<div class="line"> ofstream some_file;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of plot points</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> npts;</div>
<div class="line"> npts=5; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output solution </span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> fluid_mesh_pt()-&gt;output(some_file,npts);</div>
<div class="line"> some_file.close();</div>
<div class="line">} <span class="comment">//end_of_doc_solution</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="comm_ex"></a>
Comments and Exercises</h1>
<hr  />
<h2><a class="anchor" id="reynolds"></a>
What is the Reynolds number?</h2>
<p>The problem considered here is a "toy"-problem, devised to illustrate the use of unstructured meshes in fluids problems. The specific non-dimensionalisation and parameter values are therefore of secondary importance. However, since <code>oomph-lib's</code> implementation of the Navier-Stokes equations is based on their non-dimensional form it is important to clarify the meaning of the Reynolds number in the present problem.</p>
<p><a href="../../driven_cavity/html/index.html#equation">Recall</a> that the Reynolds number is defined as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re = \frac{\rho {\cal U} {\cal L}}{\mu} \]" src="form_1.png" width="59" height="30"/>
</p>
<p> where <img class="formulaInl" alt="$ \rho $" src="form_2.png" width="8" height="9"/> and <img class="formulaInl" alt="$ \mu $" src="form_3.png" width="9" height="9"/> are the fluid density and viscosity, respectively. <img class="formulaInl" alt="$ {\cal L} $" src="form_4.png" width="10" height="10"/> is the reference length chosen for the non-dimensionalisation of the coordinates. In the present problem, where the domain boundaries were simply drawn in <a href="http://en.wikipedia.org/wiki/Xfig">xfig </a>, no specific reference length was identified, but inspection of the maximum and minimum y-coordinates of the inflow boundary in the mesh plot shows that the inflow boundary has a (dimensional) length of <img class="formulaInl" alt="$ (4.0875 - 0.1125) {\cal L} = 3.975 {\cal L}. $" src="form_5.png" width="159" height="14"/> In the non-dimensional version of the Navier-Stokes equations, all velocities are non-dimensionalised with a reference velocity <img class="formulaInl" alt="$ {\cal U} $" src="form_6.png" width="10" height="11"/>. When we applied the inflow boundary conditions, we chose the (dimensionless) inflow profile such that its integral over the inflow boundary yields a value of 1. The velocity scale <img class="formulaInl" alt="$ {\cal U} $" src="form_6.png" width="10" height="11"/> may therefore be interpreted as a (dimensional) average inflow velocity through the channel, i.e. the volume flux divided by the reference length scale.</p>
<hr  />
<h2><a class="anchor" id="bound"></a>
Setting the boundary conditions</h2>
<p>We wish to re-iterate the comments made in the <a href="../../../solid/unstructured_solid/html/index.html#comm_ex">corresponding solid mechanics tutorial</a> that the manual identification of nodes on domain boundaries is tedious and therefore error prone. It pays off to <b>be as a paranoid as possible</b>, by always documenting the domain boundaries and the applied boundary conditions.</p>
<p>Here is the plot of boundary conditions applied in the present problem. Hollow blue markers indicate (pseudo-)solid boundary conditions (both displacements are pinned); small red markers identify nodes where the vertical fluid velocity is pinned; hollow green markers (filling the space between the blue and red lines markers) identify nodes at which the horizontal fluid velocity is pinned.</p>
<div class="image">
<img src="bcs.gif" alt=""/>
<div class="caption">
Plot of the correct boundary conditions. </div></div>
 <p>Here is another plot, obtained with the initial version of our driver code &ndash; can you spot what's wrong and can you identify the lines were added to the mesh constructor to fix the problem?</p>
<div class="image">
<img src="bcs_wrong.gif" alt=""/>
<div class="caption">
Plot of the wrong boundary conditions. </div></div>
 <hr  />
<h2><a class="anchor" id="pseudo_elast"></a>
Pseudo-elasticity</h2>
<p>As mentioned above, the elements' pseudo-elasticity plays no useful role in the present problem, as the domain boundaries remain at fixed positions and no mesh movement is required.</p>
<ul>
<li>As an exercise, remove all functionality related to the pseudo-elasticity by changing the element type from <div class="fragment"><div class="line">PseudoSolidNodeUpdateElement&lt;TTaylorHoodElement&lt;2&gt;,TPVDElement&lt;2,3&gt; &gt;</div>
</div><!-- fragment --> to <div class="fragment"><div class="line">TTaylorHoodElement&lt;2&gt;</div>
</div><!-- fragment --> Adjust the code as required (e.g. remove mesh's inheritance from the <code>SolidMesh</code> base class; remove the application of boundary conditions for the nodal positions; etc) and confirm that the results for the flow field remain unchanged. <br  />
<br  />
</li>
<li>Alternatively, the pseudo-elasticity can can be suppressed by pinning all nodal positions, drastically reducing the number of degrees of freedom in the problem without the need to rewrite the rest of the code. (Note that this is also a useful test for the development of FSI codes.) <br  />
<br  />
</li>
<li>However, if the pseudo-elastic capabilities are retained the fluid mesh can indeed deform as an elastic body; for example, by specifying a (solid mechanics) body force. Simply follow the steps used in <a href="../../../solid/unstructured_solid/html/index.html">the corresponding solid mechanics problem.</a> Define the body force in the namespace <code><a class="el" href="namespaceGlobal__Physical__Variables.html" title="Namespace for physical parameters.">Global_Physical_Variables</a></code> and pass a (function-)pointer to it to the elements. N.B. The body force for the (pseudo-)solid equations must be specified explicitly because the Navier-Stokes equations have their own body force pointer! The compiler will complain about ambiguities in the following code: <br  />
<div class="fragment"><div class="line">[...]</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Set the body force</span></div>
<div class="line"> el_pt-&gt;body_force_fct_pt() = Global_Physical_Variables::gravity;</div>
<div class="line"> </div>
<div class="line">[...]  </div>
</div><!-- fragment --> Instead, we must be more specific by writing <br  />
<div class="fragment"><div class="line">[...]</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Set the body force</span></div>
<div class="line"> el_pt-&gt;PVDEquationsBase&lt;2&gt;::body_force_fct_pt() = </div>
<div class="line">  Global_Physical_Variables::gravity;</div>
<div class="line"> </div>
<div class="line">[...]   </div>
</div><!-- fragment --> indicating that it is the body force defined in the 2D solid mechanics equations that is being specified.</li>
</ul>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory:<br  />
<br  />
<center> <a href="../../../../demo_drivers/navier_stokes/unstructured_fluid/">demo_drivers/navier_stokes/unstructured_fluid/ </a> </center><br  />
</li>
<li>The driver code is: <br  />
<br  />
<center> <a href="../../../../demo_drivers/navier_stokes/unstructured_fluid/unstructured_two_d_fluid.cc">demo_drivers/navier_stokes/unstructured_fluid/unstructured_two_d_fluid.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:22:00
        </div>
      </div>
    </footer>
</body>
</html>
