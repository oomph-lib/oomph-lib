<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Motion of an elliptical particle in shear flow: Jeffery orbits</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Motion of an elliptical particle in shear flow: Jeffery orbits </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We study the problem of the motion of a rigid elliptical particle freely suspended in a shear flow as described by Jeffery (1922) [The motion of elliptical particles immersed in viscous fluid, <em> Proc. Roy. Soc. A </em> <b> 102 </b> 161-179]. The problem is solved using <code>oomph-lib's</code> <a href="../../../../doc/meshes/mesh_from_inline_triangle/html/index.html">inline unstructured mesh generation </a> procedures to modify the fluid mesh in response to changes in orientation of the ellipse.</p>
<h1><a class="anchor" id="overview"></a>
Overview of the problem</h1>
<div class="image">
<img src="jeff_sketch.gif" alt=""/>
<div class="caption">
A rigid ellipse immersed in a shear flow </div></div>
 <p>We consider an ellipse with centre of mass fixed at the origin of a Cartesian coordinate system <img class="formulaInl" alt="$ (x_{1}^{*}, x_{2}^{*}) $" src="form_0.png" width="40" height="14"/>, but immersed in a viscous fluid undergoing a linear shear flow with shear rate <img class="formulaInl" alt="$ G $" src="form_1.png" width="10" height="10"/>. In the absence of the ellipse the fluid velocity field would be <img class="formulaInl" alt="$ u^{*}_{1} = Gx^{*}_{2} $" src="form_2.png" width="53" height="14"/>, <img class="formulaInl" alt="$ u^{*}_{2} = 0 $" src="form_3.png" width="36" height="14"/>, where <img class="formulaInl" alt="$ u^{*}_{i} $" src="form_4.png" width="13" height="14"/> is the dimensional velocity component in the <img class="formulaInl" alt="$ x^{*}_{i} $" src="form_5.png" width="13" height="14"/> coordinate direction.</p>
<p>The configuration of a rigid body in two dimensions is determined entirely by the position of its centre of mass, <img class="formulaInl" alt="$(X^{*}_{1},X^{*}_{2})$" src="form_6.png" width="49" height="14"/> and an angle, <img class="formulaInl" alt="$\chi$" src="form_7.png" width="9" height="9"/> that specifies its orientation to a fixed axis. The equations governing the motion of the particle are then simply conservation of linear and angular momentum: </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ M \frac{\mbox{d}^{2} X^{*}_{i}}{\mbox{d} t^{*2}} = F^{*}_{i} \quad \mbox{and} \quad I \frac{\mbox{d}^{2} \chi}{\mbox{d} t^{*2}} = T^{*}, \]" src="form_8.png" width="189" height="30"/>
</p>
 </center><p> where <img class="formulaInl" alt="$M$" src="form_9.png" width="14" height="10"/> is the mass of the body, <img class="formulaInl" alt="$I$" src="form_10.png" width="8" height="10"/> is its moment of inertia about the centre of mass, <img class="formulaInl" alt="$(F^{*}_{1},F^{*}_{2})$" src="form_11.png" width="45" height="14"/> is the resultant force on the body and <img class="formulaInl" alt="$T^{*}$" src="form_12.png" width="15" height="10"/> is the resultant torque about the centre of mass.</p>
<p>In the present context, the force and torque on the body are entirely due to the viscous fluid loading on its surface in which case </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ F^{*}_{i} = \int \tau^{*}_{ij}\, n_{j}\, \mbox{d} s \quad\mbox{and}\quad T^{*} = \oint (x^{*}_{1} - X^{*}_{1}) \tau^{*}_{2j}\,n_{j} - (x^{*}_{2} - X^{*}_{2}) \tau^{*}_{1j}\,n_{j}\, \mbox{d} s, \]" src="form_13.png" width="384" height="29"/>
</p>
 </center><p> where the integral is around the perimeter of the ellipse, <img class="formulaInl" alt="$\tau^{*}_{ij}$" src="form_14.png" width="14" height="15"/> is the fluid stress tensor and <img class="formulaInl" alt="$(n_{1},n_{2})$" src="form_15.png" width="40" height="14"/> is the unit normal to the ellipse surface, directed away from the solid body.</p>
<p>We non-dimensionalise the rigid-body equations, using the same problem-specific reference quantities as used in the non-dimensionalisation of the Navier&ndash;Stokes equations, described <a href="../../../../doc/navier_stokes/driven_cavity/html/index.html">in another tutorial. </a> Thus, <img class="formulaInl" alt="$ {\cal U}$" src="form_16.png" width="10" height="11"/> is a typical fluid velocity, <img class="formulaInl" alt="$ {\cal L} $" src="form_17.png" width="10" height="10"/> is the length scale, <img class="formulaInl" alt="${\cal T}$" src="form_18.png" width="11" height="11"/> is the time scale and the fluid pressure is non-dimensionalised on the viscous scale, <img class="formulaInl" alt="$ \mu_{ref} {\cal U}/{\cal L} $" src="form_19.png" width="49" height="14"/>, where <img class="formulaInl" alt="$ \mu_{ref} $" src="form_20.png" width="24" height="10"/> is the reference fluid viscosity. Hence, </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tau^{*}_{ij} = \frac{\mu_{ref} {\cal U}}{{\cal L}} \, \tau_{ij}, \qquad x_i^{*} = {\cal L}\, x_i, \qquad X_i^* = {\cal L}\, X_i, \qquad t^* = {\cal T}\, t. \]" src="form_21.png" width="331" height="28"/>
</p>
 </center><p> The external forces and torques are non-dimensionalised on the viscous scales per unit length, <img class="formulaInl" alt="$ F^{*}_{i} = \mu_{ref} {\cal U} F_{i} $" src="form_22.png" width="76" height="14"/> and <img class="formulaInl" alt="$ T^{*} = \mu_{ref} {\cal U} {\cal L} T $" src="form_23.png" width="83" height="14"/>. The dimensionless rigid-body equations are then </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re St^{2} \frac{\rho_{s}}{\rho_{f}}\, \bar{M}\, \frac{\mbox{d}^{2} X_{i}}{\mbox{d} t^{2}} = F_{i} \quad \mbox{and} \quad Re St^{2} \frac{\rho_{s}}{\rho_{f}}\, \bar{I}\, \frac{\mbox{d}^{2} \chi}{\mbox{d} t^{2}} = T, \]" src="form_24.png" width="284" height="34"/>
</p>
 </center><p> where the dimensionless parameters </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re = \frac{\rho_{f} {\cal U}{\cal L}}{\mu_{ref}}, \quad St = \frac{\cal L}{{\cal U}{\cal T}},\quad \frac{\rho_{s}}{\rho_{f}}, \quad \bar{M} = \frac{M}{\rho_{s} {\cal L}^{2}}, \quad \bar{I} = \frac{I}{\rho_{s} {\cal L}^{4}}, \]" src="form_25.png" width="319" height="30"/>
</p>
 </center><p> are the Reynolds number, the Strouhal number, the density ratio, and the dimensionless mass and moment of inertia, respectively. In the above <img class="formulaInl" alt="$ \rho_{f} $" src="form_26.png" width="14" height="10"/> is the fluid density and <img class="formulaInl" alt="$ \rho_{s} $" src="form_27.png" width="13" height="9"/> is the solid density.</p>
<p>In the specific problem considered here, the centre of mass is fixed, and the only possible motion of the particle is free rotation. The particle motion is therefore reduced to the solution of a single equation for the unknown angle. We choose <img class="formulaInl" alt="$ {\cal L} = 2b $" src="form_28.png" width="39" height="10"/>, the major axis of the ellipse, <img class="formulaInl" alt="$ {\cal U} = 2Gb $" src="form_29.png" width="49" height="11"/> and <img class="formulaInl" alt="$ {\cal T} = G^{-1} $" src="form_30.png" width="50" height="13"/>, so that <img class="formulaInl" alt="$ St = 1 $" src="form_31.png" width="35" height="10"/> and the governing equations for the fluid and solid become </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re \left (\frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} \right) = - \frac{\partial p}{\partial x_i} + \frac{\partial }{\partial x_j} \left[ \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right] \quad\mbox{and}\quad \frac{\partial u_i}{\partial x_i} = 0. \]" src="form_32.png" width="364" height="31"/>
</p>
 </center><p> and </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re \left(\frac{\rho_{s}}{\rho_{f}}\right) \bar{I} = \oint \left[x_{1}\tau_{2j}\,n_{j} - x_{2} \tau_{1j}\,n_{j}\, \right] \mbox{d} s, \]" src="form_33.png" width="220" height="31"/>
</p>
. </center><p>We perform the computations in the domain <img class="formulaInl" alt="$ x_{1} \in [-L, L]$" src="form_34.png" width="68" height="14"/> and <img class="formulaInl" alt="$ x_{2} \in [-H, H] $" src="form_35.png" width="73" height="14"/>, and apply the boundary conditions </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ u_{1} = H f(t), u_{2} = 0, \quad\mbox{on}\quad x_{2} = -H; \]" src="form_36.png" width="201" height="14"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ u_{1} = -H f(t), u_{2} = 0, \quad\mbox{on}\quad x_{2} = H; \]" src="form_37.png" width="201" height="14"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tau_{11} = 0, u_{2} = 0, \quad\mbox{on}\quad x_{1} = -L, L; \]" src="form_38.png" width="189" height="13"/>
</p>
 where <img class="formulaInl" alt="$f(t)$" src="form_39.png" width="20" height="14"/> is a smooth ramp function such that <img class="formulaInl" alt="$f(0) = \dot{f}(0) = \ddot{f}(0) = 0$" src="form_40.png" width="126" height="16"/> and <img class="formulaInl" alt="$f(t) \to 1$" src="form_41.png" width="46" height="14"/> as <img class="formulaInl" alt="$ t \to \infty$" src="form_42.png" width="38" height="9"/>. </center><h1><a class="anchor" id="results"></a>
Results</h1>
<p>Jeffery (1922) showed that for a two-dimensional ellipse in Stokes flow ( <img class="formulaInl" alt="$ Re = 0 $" src="form_43.png" width="38" height="10"/>), the exact solution for the angle as a function of time is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \chi = \tan^{-1}\left(\frac{b}{a}\tan \frac{abGt}{a^{2} + b^{2}}\right),\quad\mbox{and}\quad \dot{\chi} = \frac{G}{a^{2} + b^{2}}\left(b^{2}\cos^{2}\chi + a^{2}\sin^{2}\chi\right). \]" src="form_44.png" width="391" height="31"/>
</p>
<p> Thus, the ellipse performs periodic orbits but with a non-uniform velocity. For sufficiently small <img class="formulaInl" alt="$ Re $" src="form_45.png" width="15" height="10"/>, Ding &amp; Aidun (2000) [The dynamics and scaling law for particles suspended in shear flow with inertia, <em> J. Fluid Mech. </em> <b> 423 </b> 317-344] showed that the system approximates the Jeffery orbits but with an increased period. Typical solutions for <img class="formulaInl" alt="$ Re = 1$" src="form_46.png" width="38" height="10"/> are shown below.</p>
<div class="image">
<img src="orbit_mesh.gif" alt=""/>
<div class="caption">
An ellipse performing approximate Jeffery orbits at Re = 1 </div></div>
 <div class="image">
<img src="jeff_graph.gif" alt=""/>
<div class="caption">
Angle and angular velocity as functions of time for Re = 1 </div></div>
 <h1><a class="anchor" id="fsi"></a>
Implementation as a fluid-structure interaction problem</h1>
<p>The problem is a fluid-structure interaction problem in which the structural dynamics are particularly simple, depending only on a single degree of freedom. Nonetheless, the two types of physical coupling between the fluid and the solid remain:</p><ol type="1">
<li>The position of the free boundary depends on the position of the rigid body.</li>
<li>The rigid body is loaded by the fluid traction.</li>
</ol>
<p>As in other <a href="../../../../doc/interaction/unstructured_fsi/html/index.html">2D unstructured FSI </a> problems, we treat the fluid mesh as a pseudo-solid body and determine the position of the boundary nodes on the fluid-solid interface using <br  />
 <code>ImposeDisplacementByLagrangeMultiplierElements</code>.</p>
<p>The rigid body mechanics is handled by using a <code>GeomObject</code> that represents the perimeter of the rigid body to create an <code>ImmersedRigidBodyElement</code> that solves the three equations of motion for a rigid body; and the load is applied to the rigid body using <code>NavierStokesSurfaceDragTorqueElements</code>.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="global"></a>
Problem Parameters</h1>
<p>We use a namespace to define the parameters used in the problem</p>
 <div class="fragment"><div class="line"><span class="comment">//==start_of_namespace==============================</span></div>
<div class="line"><span class="comment">/// Namespace for Problem Parameters</span></div>
<div class="line"><span class="comment"></span><span class="comment">//==================================================</span></div>
<div class="line"> <span class="keyword">namespace </span><a class="code" href="namespaceProblem__Parameter.html">Problem_Parameter</a></div>
<div class="line"> {    <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Reynolds number</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#acc656299287d4d9a8374c2c501750b4f">Re</a>=1.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /// Strouhal number</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#a8d9b76e390569bac0095bd0952281a30">St</a> = 1.0;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Density ratio (Solid density / Fluid density)</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#a7fcb9a415485247d626190923235be2a">Density_ratio</a> = 1.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /// Initial axis of the elliptical solid in x-direction</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">A</a> = 0.25;</div>
<div class="line">  <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Initial axis of the elliptical solid in y-direction</span></div>
<div class="line"><span class="comment">  /// (N.B. 2B = 1 is the reference length scale)</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">B</a> = 0.5;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /// Pseudo-solid (mesh) Poisson ratio</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#abec2e733c8f2d3c18ebc702b3f80cc17">Nu</a>=0.3;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /// Pseudo-solid (mesh) &quot;density&quot; </span></div>
<div class="line"><span class="comment">  /// Set to zero because we don&#39;t want inertia in the node update!</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#a20ea33c391abd96d43f79913377c1e12">Lambda_sq</a>=0.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /// Constitutive law used to determine the mesh deformation</span></div>
<div class="line"><span class="comment"></span>  ConstitutiveLaw *<a class="code" href="namespaceProblem__Parameter.html#a9852a6077458693983628319d429f11f">Constitutive_law_pt</a>=   </div>
<div class="line">   <span class="keyword">new</span> GeneralisedHookean(&amp;<a class="code" href="namespaceProblem__Parameter.html#abec2e733c8f2d3c18ebc702b3f80cc17">Problem_Parameter::Nu</a>);</div>
<div class="line"> </div>
<div class="line"> } <span class="comment">// end_of_namespace</span></div>
<div class="ttc" id="anamespaceProblem__Parameter_html"><div class="ttname"><a href="namespaceProblem__Parameter.html">Problem_Parameter</a></div><div class="ttdoc">Namespace for Problem Parameters.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00056">jeffery_orbit.cc:57</a></div></div>
<div class="ttc" id="anamespaceProblem__Parameter_html_a20ea33c391abd96d43f79913377c1e12"><div class="ttname"><a href="namespaceProblem__Parameter.html#a20ea33c391abd96d43f79913377c1e12">Problem_Parameter::Lambda_sq</a></div><div class="ttdeci">double Lambda_sq</div><div class="ttdoc">Pseudo-solid (mesh) &quot;density&quot; Set to zero because we don't want inertia in the node update!</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00079">jeffery_orbit.cc:79</a></div></div>
<div class="ttc" id="anamespaceProblem__Parameter_html_a23071148de0fea3597c2a7eb848320b6"><div class="ttname"><a href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">Problem_Parameter::A</a></div><div class="ttdeci">double A</div><div class="ttdoc">Initial axis of the elliptical solid in x-direction.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00068">jeffery_orbit.cc:68</a></div></div>
<div class="ttc" id="anamespaceProblem__Parameter_html_a7fcb9a415485247d626190923235be2a"><div class="ttname"><a href="namespaceProblem__Parameter.html#a7fcb9a415485247d626190923235be2a">Problem_Parameter::Density_ratio</a></div><div class="ttdeci">double Density_ratio</div><div class="ttdoc">Density ratio (Solid density / Fluid density)</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00065">jeffery_orbit.cc:65</a></div></div>
<div class="ttc" id="anamespaceProblem__Parameter_html_a8d9b76e390569bac0095bd0952281a30"><div class="ttname"><a href="namespaceProblem__Parameter.html#a8d9b76e390569bac0095bd0952281a30">Problem_Parameter::St</a></div><div class="ttdeci">double St</div><div class="ttdoc">Strouhal number.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00062">jeffery_orbit.cc:62</a></div></div>
<div class="ttc" id="anamespaceProblem__Parameter_html_a9852a6077458693983628319d429f11f"><div class="ttname"><a href="namespaceProblem__Parameter.html#a9852a6077458693983628319d429f11f">Problem_Parameter::Constitutive_law_pt</a></div><div class="ttdeci">ConstitutiveLaw * Constitutive_law_pt</div><div class="ttdoc">Constitutive law used to determine the mesh deformation.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00082">jeffery_orbit.cc:82</a></div></div>
<div class="ttc" id="anamespaceProblem__Parameter_html_abec2e733c8f2d3c18ebc702b3f80cc17"><div class="ttname"><a href="namespaceProblem__Parameter.html#abec2e733c8f2d3c18ebc702b3f80cc17">Problem_Parameter::Nu</a></div><div class="ttdeci">double Nu</div><div class="ttdoc">Pseudo-solid (mesh) Poisson ratio.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00075">jeffery_orbit.cc:75</a></div></div>
<div class="ttc" id="anamespaceProblem__Parameter_html_ac2362a46222574a21338a113e2bee27e"><div class="ttname"><a href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">Problem_Parameter::B</a></div><div class="ttdeci">double B</div><div class="ttdoc">Initial axis of the elliptical solid in y-direction (N.B. 2B = 1 is the reference length scale)</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00072">jeffery_orbit.cc:72</a></div></div>
<div class="ttc" id="anamespaceProblem__Parameter_html_acc656299287d4d9a8374c2c501750b4f"><div class="ttname"><a href="namespaceProblem__Parameter.html#acc656299287d4d9a8374c2c501750b4f">Problem_Parameter::Re</a></div><div class="ttdeci">double Re</div><div class="ttdoc">Reynolds number.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00059">jeffery_orbit.cc:59</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="ellipse"></a>
Defining the ellipse as a GeomObject</h1>
<p>We create a basic <code>GeomObject</code> to represent the ellipse whose boundary we parametrise by the polar angle, measured from its centre of mass.</p>
 <div class="fragment"><div class="line"><span class="comment">//===================start_of_general_ellipse=================================</span></div>
<div class="line"><span class="comment">/// A geometric object for an ellipse with initial centre of mass at</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// (centre_x, centre_y) with axis in the x direction given by 2a</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// and in the y-direction given by 2b. The boundary of the ellipse is</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// parametrised by its angle.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//============================================================================</span></div>
<div class="line"><span class="keyword">class </span><a class="code" href="classGeneralEllipse.html">GeneralEllipse</a> : <span class="keyword">public</span> GeomObject</div>
<div class="line">{</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Storage for the centre of mass and semi-major and semi-minor axes</span></div>
<div class="line"> <span class="keywordtype">double</span> <a class="code" href="classGeneralEllipse.html#aeb974769f58d136a12ac1532506304cc">Centre_x</a>, <a class="code" href="classGeneralEllipse.html#abf2def5a5140bb35e381b800c4b91dc9">Centre_y</a>, <a class="code" href="classGeneralEllipse.html#ae583e1437da6ad4eb228dda60b61808a">A</a>, <a class="code" href="classGeneralEllipse.html#a185ae9786d5c6c82eef61e163e9310c6">B</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Simple Constructor that transfers appropriate geometric </span></div>
<div class="line"><span class="comment"> /// parameters into internal data</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classGeneralEllipse.html#a50dc036d709bcd1d53eafb62b5548f67">GeneralEllipse</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;centre_x, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;centre_y,</div>
<div class="line">                <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;a, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;b)</div>
<div class="line">  : GeomObject(1,2), <a class="code" href="classGeneralEllipse.html#aeb974769f58d136a12ac1532506304cc">Centre_x</a>(centre_x), <a class="code" href="classGeneralEllipse.html#abf2def5a5140bb35e381b800c4b91dc9">Centre_y</a>(centre_y), <a class="code" href="classGeneralEllipse.html#ae583e1437da6ad4eb228dda60b61808a">A</a>(a), <a class="code" href="classGeneralEllipse.html#a185ae9786d5c6c82eef61e163e9310c6">B</a>(b)</div>
<div class="line">  {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Empty Destructor</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classGeneralEllipse.html#a3ac5c17cf8c4998f1b74913860cb3bb9">~GeneralEllipse</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Return the position of the ellipse boundary as a function of </span></div>
<div class="line"><span class="comment"> /// the angle xi[0]</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classGeneralEllipse.html#a85e975c70441a9c9c711b5e27d124bff">position</a>(<span class="keyword">const</span> Vector&lt;double&gt; &amp;xi, Vector&lt;double&gt; &amp;r)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">   r[0] = <a class="code" href="classGeneralEllipse.html#aeb974769f58d136a12ac1532506304cc">Centre_x</a> + <a class="code" href="classGeneralEllipse.html#ae583e1437da6ad4eb228dda60b61808a">A</a>*cos(xi[0]);</div>
<div class="line">   r[1] = <a class="code" href="classGeneralEllipse.html#abf2def5a5140bb35e381b800c4b91dc9">Centre_y</a> + <a class="code" href="classGeneralEllipse.html#a185ae9786d5c6c82eef61e163e9310c6">B</a>*sin(xi[0]);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Return the position which is always fixed</span></div>
<div class="line"> <span class="keywordtype">void</span> <a class="code" href="classGeneralEllipse.html#a85e975c70441a9c9c711b5e27d124bff">position</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;t,</div>
<div class="line">               <span class="keyword">const</span> Vector&lt;double&gt; &amp;xi, Vector&lt;double&gt; &amp;r)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="classGeneralEllipse.html#a85e975c70441a9c9c711b5e27d124bff">position</a>(xi,r);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"><span class="comment">//end_of_general_ellipse</span></div>
<div class="ttc" id="aclassGeneralEllipse_html"><div class="ttname"><a href="classGeneralEllipse.html">GeneralEllipse</a></div><div class="ttdoc">//////////////////////////////////////////////////////// ////////////////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00145">jeffery_orbit.cc:146</a></div></div>
<div class="ttc" id="aclassGeneralEllipse_html_a185ae9786d5c6c82eef61e163e9310c6"><div class="ttname"><a href="classGeneralEllipse.html#a185ae9786d5c6c82eef61e163e9310c6">GeneralEllipse::B</a></div><div class="ttdeci">double B</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00150">jeffery_orbit.cc:150</a></div></div>
<div class="ttc" id="aclassGeneralEllipse_html_a3ac5c17cf8c4998f1b74913860cb3bb9"><div class="ttname"><a href="classGeneralEllipse.html#a3ac5c17cf8c4998f1b74913860cb3bb9">GeneralEllipse::~GeneralEllipse</a></div><div class="ttdeci">~GeneralEllipse()</div><div class="ttdoc">Empty Destructor.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00162">jeffery_orbit.cc:162</a></div></div>
<div class="ttc" id="aclassGeneralEllipse_html_a50dc036d709bcd1d53eafb62b5548f67"><div class="ttname"><a href="classGeneralEllipse.html#a50dc036d709bcd1d53eafb62b5548f67">GeneralEllipse::GeneralEllipse</a></div><div class="ttdeci">GeneralEllipse(const double &amp;centre_x, const double &amp;centre_y, const double &amp;a, const double &amp;b)</div><div class="ttdoc">Simple Constructor that transfers appropriate geometric parameters into internal data.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00156">jeffery_orbit.cc:156</a></div></div>
<div class="ttc" id="aclassGeneralEllipse_html_a85e975c70441a9c9c711b5e27d124bff"><div class="ttname"><a href="classGeneralEllipse.html#a85e975c70441a9c9c711b5e27d124bff">GeneralEllipse::position</a></div><div class="ttdeci">void position(const Vector&lt; double &gt; &amp;xi, Vector&lt; double &gt; &amp;r) const</div><div class="ttdoc">Return the position of the ellipse boundary as a function of the angle xi[0].</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00166">jeffery_orbit.cc:166</a></div></div>
<div class="ttc" id="aclassGeneralEllipse_html_abf2def5a5140bb35e381b800c4b91dc9"><div class="ttname"><a href="classGeneralEllipse.html#abf2def5a5140bb35e381b800c4b91dc9">GeneralEllipse::Centre_y</a></div><div class="ttdeci">double Centre_y</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00150">jeffery_orbit.cc:150</a></div></div>
<div class="ttc" id="aclassGeneralEllipse_html_ae583e1437da6ad4eb228dda60b61808a"><div class="ttname"><a href="classGeneralEllipse.html#ae583e1437da6ad4eb228dda60b61808a">GeneralEllipse::A</a></div><div class="ttdeci">double A</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00150">jeffery_orbit.cc:150</a></div></div>
<div class="ttc" id="aclassGeneralEllipse_html_aeb974769f58d136a12ac1532506304cc"><div class="ttname"><a href="classGeneralEllipse.html#aeb974769f58d136a12ac1532506304cc">GeneralEllipse::Centre_x</a></div><div class="ttdeci">double Centre_x</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00150">jeffery_orbit.cc:150</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="driver"></a>
The driver code</h1>
<p>After parsing the command-line arguments, which are used to modify certain parameters for validation runs, a single instance of the <code><a class="el" href="classUnstructuredImmersedEllipseProblem.html" title="//////////////////////////////////////////////////////// ////////////////////////////////////////////...">UnstructuredImmersedEllipseProblem</a></code> (described below) is constructed using Taylor Hood elements.</p>
 <div class="fragment"><div class="line"><span class="comment">//==========start_of_main======================================</span></div>
<div class="line"><span class="comment">/// Driver code for immersed ellipse problem</span></div>
<div class="line"><span class="comment"></span><span class="comment">//============================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="jeffery__orbit_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Store command line arguments</span></div>
<div class="line"> CommandLineArgs::setup(argc,argv);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Define possible command line arguments and parse the ones that</span></div>
<div class="line"> <span class="comment">// were actually specified</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Validation?</span></div>
<div class="line"> CommandLineArgs::specify_command_line_flag(<span class="stringliteral">&quot;--validation&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Parse command line</span></div>
<div class="line"> CommandLineArgs::parse_and_assign(); </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Doc what has actually been specified on the command line</span></div>
<div class="line"> CommandLineArgs::doc_specified_flags();</div>
<div class="line">  </div>
<div class="line"> <span class="comment">// Create problem in initial configuration</span></div>
<div class="line"> <a class="code" href="classUnstructuredImmersedEllipseProblem.html">UnstructuredImmersedEllipseProblem</a>&lt;</div>
<div class="line"> ProjectableTaylorHoodElement&lt;MyTaylorHoodElement&gt; &gt; problem;  </div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html">UnstructuredImmersedEllipseProblem</a></div><div class="ttdoc">//////////////////////////////////////////////////////// ////////////////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00193">jeffery_orbit.cc:194</a></div></div>
<div class="ttc" id="ajeffery__orbit_8cc_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="jeffery__orbit_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdoc">Driver code for immersed ellipse problem.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l01198">jeffery_orbit.cc:1198</a></div></div>
</div><!-- fragment --><p> After construction the <code>Nodes</code> on the boundary of the ellipse will have been directly mapped onto the curvilinear surface using a strong (collocation) condition, <img class="formulaInl" alt="$ x_{i} = R_{i}$" src="form_47.png" width="41" height="13"/>, where <img class="formulaInl" alt="$R_{i}$" src="form_48.png" width="13" height="13"/> is the corresponding boundary of the ellipse. In the full problem the displacement boundary condition is enforced weakly via Lagrange multipliers <img class="formulaInl" alt="$ \oint \left\{x_{i} - R_{i}\right\}\psi \mbox{d} s = 0$" src="form_49.png" width="109" height="15"/>. In order to ensure consistency, we initially solve the problem in which the rigid body is pinned so that the boundary nodes are adjusted to be consistent with the weak form of the boundary condition. We note that for sufficiently fine initial meshes the difference is minimal.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">//Initially ensure that the nodal positions are consistent with </span></div>
<div class="line"> <span class="comment">//their weak imposition</span></div>
<div class="line"> problem.solve_for_consistent_nodal_positions();</div>
</div><!-- fragment --><p> Now that we have a consistent initial condition, we initialise the timestepper and set conditions consistent with a impulsive start from rest.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Initialise timestepper</span></div>
<div class="line"> <span class="keywordtype">double</span> dt=0.05;</div>
<div class="line"> problem.initialise_dt(dt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Perform impulsive start</span></div>
<div class="line"> problem.assign_initial_values_impulsive();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output initial conditions</span></div>
<div class="line"> problem.doc_solution();</div>
</div><!-- fragment --><p> We then take a fixed number of timesteps on the initial mesh, documenting the solution after each solve.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Solve problem a few times on given mesh</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nstep=3;</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;nstep;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Solve the problem</span></div>
<div class="line">   problem.unsteady_newton_solve(dt);    </div>
<div class="line">   problem.doc_solution();</div>
<div class="line">  }</div>
</div><!-- fragment --><p> Finally, we loop over a number of `&lsquo;cycles&rsquo;' in which we adapt the problem and then solve for a fixed number of time steps on the each mesh.</p>
<div class="fragment"><div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;ncycle;j++)</div>
<div class="line">  {       </div>
<div class="line">   <span class="comment">// Adapt the problem</span></div>
<div class="line">   problem.adapt();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Solve problem a few times</span></div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;nstep;i++)</div>
<div class="line">    {     </div>
<div class="line">     <span class="comment">// Solve the problem</span></div>
<div class="line">     problem.unsteady_newton_solve(dt);</div>
<div class="line">     problem.doc_solution();</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end of main</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
 <h1><a class="anchor" id="problem"></a>
The Problem class</h1>
<p>The Problem class follows the usual pattern. The time-dependent boundary conditions are applied using the <code>actions_before_implicit_timestep()</code> function and the no-slip boundary condition is applied in <code>actions_before_newton_convergence_check()</code> via an auxiliary node update function.</p>
<p><a href="../../../../doc/meshes/mesh_from_inline_triangle/html/index.html#adapt">Recall</a> that when adapting an unstructured mesh, its constituent elements are completely re-generated. Physical parameters and boundary conditions must therefore be reassigned, which is the task of the <code>complete_problem_setup()</code> function, called in <code>actions_after_adapt()</code>. Helper functions are also provided to solve the initial problem to move the boundary nodes [<code>solve_for_consistent_nodal_positions()</code>]; to apply the boundary conditions [<code>set_boundary_velocity()</code>]; and to construct and delete the surface elements that impose the Lagrange multiplier constraints and compute the load on the rigid body [<code>create_lagrange_multiplier_elements()</code>, <code>delete_lagrange_multiplier_elements()</code>, <code>create_drag_elements()</code>, <code>delete_drag_elements()</code>].</p>
<p>The class also provides storage for the meshes, the rigid body and file handles for documentation.</p>
 <div class="fragment"><div class="line"><span class="comment">//==start_of_problem_class============================================</span></div>
<div class="line"><span class="comment">/// Unstructured Navier-Stokes ALE Problem for a rigid ellipse </span></div>
<div class="line"><span class="comment"></span><span class="comment">/// immersed within a viscous fluid</span></div>
<div class="line"><span class="comment"></span><span class="comment">//====================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classUnstructuredImmersedEllipseProblem.html">UnstructuredImmersedEllipseProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a544a35f261200bb4a4e29a88faa1a69c">UnstructuredImmersedEllipseProblem</a>();</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Destructor</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a84cdf81be59fc646eb4d5b3bc0ff4280">~UnstructuredImmersedEllipseProblem</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Reset the boundary conditions when timestepping</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a368c412c4c9a9e9403b4e67d3582e3a5">actions_before_implicit_timestep</a>()</div>
<div class="line">  {</div>
<div class="line">   this-&gt;<a class="code" href="classUnstructuredImmersedEllipseProblem.html#ab201b187b240105fd8d444d943f6dada">set_boundary_velocity</a>();</div>
<div class="line">  }</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Wipe the meshes of Lagrange multiplier and drag elements</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#aa560217a33a9a9bc150fbdf15dbf1877">actions_before_adapt</a>();</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Rebuild the meshes of Lagrange multiplier and drag elements</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#ab1558b409285aea617f4abf7d3a64b3d">actions_after_adapt</a>();</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Re-apply the no slip condition (imposed indirectly via dependent</span></div>
<div class="line"><span class="comment"> /// velocities)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#afa51876a2af9dd7640ff1f5a434804bf">actions_before_newton_convergence_check</a>()</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Update mesh -- this applies the auxiliary node update function</span></div>
<div class="line">   <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a0ba79ccde26b781b66d9839460f08bd3">Fluid_mesh_pt</a>-&gt;node_update();</div>
<div class="line">  }</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Set boundary condition, assign auxiliary node update fct.</span></div>
<div class="line"><span class="comment"> /// Complete the build of all elements, attach power elements that allow</span></div>
<div class="line"><span class="comment"> /// computation of drag vector</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a42b13e3306ff2a94053907644ba17c8d">complete_problem_setup</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Set the boundary velocity</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#ab201b187b240105fd8d444d943f6dada">set_boundary_velocity</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Function that solves a simplified problem to ensure that </span></div>
<div class="line"><span class="comment"> /// the positions of the boundary nodes are initially consistent with</span></div>
<div class="line"><span class="comment"> /// the lagrange multiplier formulation</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a2a88b40ff1988de0fc696f1eb755ea54">solve_for_consistent_nodal_positions</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc the solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a08e12dd83c98f96e14e8152cc758d398">doc_solution</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; project=<span class="keyword">false</span>);</div>
<div class="line">  <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Output the exact solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a29a232dfac18ea901332bebdc14fad15">output_exact_solution</a>(std::ofstream &amp;output_file);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Create elements that enforce prescribed boundary motion</span></div>
<div class="line"><span class="comment"> /// for the pseudo-solid fluid mesh by Lagrange multipliers</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a3b4a4e279a11b37d79d040b348008765">create_lagrange_multiplier_elements</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Delete elements that impose the prescribed boundary displacement</span></div>
<div class="line"><span class="comment"> /// and wipe the associated mesh</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a51555f77dc360c94591ee68c3fc9928a">delete_lagrange_multiplier_elements</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Create elements that calculate the drag and torque on</span></div>
<div class="line"><span class="comment"> /// the boundaries</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a16a7c6022867f709ebdd59b8fee2004a">create_drag_elements</a>();</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Delete elements that calculate the drag and torque on the </span></div>
<div class="line"><span class="comment"> /// boundaries</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a7d7b84968988d37091b29957b0af5bfa">delete_drag_elements</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pin the degrees of freedom associated with the solid bodies</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a07dc16909c0223fe4b656fd270f27c11">pin_rigid_body</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Unpin the degrees of freedom associated with the solid bodies</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a4f8c7e7e4d626084f6515a152b165567">unpin_rigid_body</a>();</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Pointers to mesh of Lagrange multiplier elements</span></div>
<div class="line"><span class="comment"></span> SolidMesh* <a class="code" href="classUnstructuredImmersedEllipseProblem.html#ad644e67ccd6ab0811c5fe2b7b944fbca">Lagrange_multiplier_mesh_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to Fluid_mesh</span></div>
<div class="line"><span class="comment"></span> RefineableSolidTriangleMesh&lt;ELEMENT&gt;* <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a0ba79ccde26b781b66d9839460f08bd3">Fluid_mesh_pt</a>;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Triangle mesh polygon for outer boundary </span></div>
<div class="line"><span class="comment"></span> TriangleMeshPolygon* <a class="code" href="classUnstructuredImmersedEllipseProblem.html#ae0b35188432c371804887b6de86b48c7">Outer_boundary_polygon_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Mesh of drag elements</span></div>
<div class="line"><span class="comment"></span> Vector&lt;Mesh*&gt; <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a9b4d04277b1f42c9428b610968f6f10d">Drag_mesh_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Mesh of the generalised elements for the rigid bodies</span></div>
<div class="line"><span class="comment"></span> Mesh* <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a34f1376227d4b995678eedd77813388b">Rigid_body_mesh_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Storage for the geom object</span></div>
<div class="line"><span class="comment"></span> Vector&lt;GeomObject*&gt; <a class="code" href="classUnstructuredImmersedEllipseProblem.html#aaa6d1c19f3634a6f08f3dd7e5046217e">Rigid_body_pt</a>;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Internal DocInfo object</span></div>
<div class="line"><span class="comment"></span> DocInfo <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a1c463ed904f01e6466baae0533c79780">Doc_info</a>;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// File to document the norm of the solution (for validation purposes)</span></div>
<div class="line"><span class="comment"></span> ofstream <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a71a3b24b610e05f7be916c4214dab8dc">Norm_file</a>;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// File to document the motion of the centre of gravity</span></div>
<div class="line"><span class="comment"></span> ofstream <a class="code" href="classUnstructuredImmersedEllipseProblem.html#acd1e8ec8e510f029f449f13dfdebbc99">Cog_file</a>;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// File to document the exact motion of the centre of gravity</span></div>
<div class="line"><span class="comment"></span> ofstream <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a3dc1ec2e066466a6f228864b873d95fa">Cog_exact_file</a>;</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// end_of_problem_class</span></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a07dc16909c0223fe4b656fd270f27c11"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a07dc16909c0223fe4b656fd270f27c11">UnstructuredImmersedEllipseProblem::pin_rigid_body</a></div><div class="ttdeci">void pin_rigid_body()</div><div class="ttdoc">Pin the degrees of freedom associated with the solid bodies.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00824">jeffery_orbit.cc:824</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a08e12dd83c98f96e14e8152cc758d398"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a08e12dd83c98f96e14e8152cc758d398">UnstructuredImmersedEllipseProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(const bool &amp;project=false)</div><div class="ttdoc">Doc the solution.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l01106">jeffery_orbit.cc:1106</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a0ba79ccde26b781b66d9839460f08bd3"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a0ba79ccde26b781b66d9839460f08bd3">UnstructuredImmersedEllipseProblem::Fluid_mesh_pt</a></div><div class="ttdeci">RefineableSolidTriangleMesh&lt; ELEMENT &gt; * Fluid_mesh_pt</div><div class="ttdoc">Pointer to Fluid_mesh.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00271">jeffery_orbit.cc:271</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a16a7c6022867f709ebdd59b8fee2004a"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a16a7c6022867f709ebdd59b8fee2004a">UnstructuredImmersedEllipseProblem::create_drag_elements</a></div><div class="ttdeci">void create_drag_elements()</div><div class="ttdoc">Create elements that calculate the drag and torque on the boundaries.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l01006">jeffery_orbit.cc:1006</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a1c463ed904f01e6466baae0533c79780"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a1c463ed904f01e6466baae0533c79780">UnstructuredImmersedEllipseProblem::Doc_info</a></div><div class="ttdeci">DocInfo Doc_info</div><div class="ttdoc">Internal DocInfo object.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00286">jeffery_orbit.cc:286</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a29a232dfac18ea901332bebdc14fad15"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a29a232dfac18ea901332bebdc14fad15">UnstructuredImmersedEllipseProblem::output_exact_solution</a></div><div class="ttdeci">void output_exact_solution(std::ofstream &amp;output_file)</div><div class="ttdoc">Output the exact solution.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l01182">jeffery_orbit.cc:1183</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a2a88b40ff1988de0fc696f1eb755ea54"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a2a88b40ff1988de0fc696f1eb755ea54">UnstructuredImmersedEllipseProblem::solve_for_consistent_nodal_positions</a></div><div class="ttdeci">void solve_for_consistent_nodal_positions()</div><div class="ttdoc">Function that solves a simplified problem to ensure that the positions of the boundary nodes are init...</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00863">jeffery_orbit.cc:864</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a34f1376227d4b995678eedd77813388b"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a34f1376227d4b995678eedd77813388b">UnstructuredImmersedEllipseProblem::Rigid_body_mesh_pt</a></div><div class="ttdeci">Mesh * Rigid_body_mesh_pt</div><div class="ttdoc">Mesh of the generalised elements for the rigid bodies.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00280">jeffery_orbit.cc:280</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a368c412c4c9a9e9403b4e67d3582e3a5"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a368c412c4c9a9e9403b4e67d3582e3a5">UnstructuredImmersedEllipseProblem::actions_before_implicit_timestep</a></div><div class="ttdeci">void actions_before_implicit_timestep()</div><div class="ttdoc">Reset the boundary conditions when timestepping.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00205">jeffery_orbit.cc:205</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a3b4a4e279a11b37d79d040b348008765"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a3b4a4e279a11b37d79d040b348008765">UnstructuredImmersedEllipseProblem::create_lagrange_multiplier_elements</a></div><div class="ttdeci">void create_lagrange_multiplier_elements()</div><div class="ttdoc">Create elements that enforce prescribed boundary motion for the pseudo-solid fluid mesh by Lagrange m...</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00897">jeffery_orbit.cc:898</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a3dc1ec2e066466a6f228864b873d95fa"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a3dc1ec2e066466a6f228864b873d95fa">UnstructuredImmersedEllipseProblem::Cog_exact_file</a></div><div class="ttdeci">ofstream Cog_exact_file</div><div class="ttdoc">File to document the exact motion of the centre of gravity.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00295">jeffery_orbit.cc:295</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a42b13e3306ff2a94053907644ba17c8d"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a42b13e3306ff2a94053907644ba17c8d">UnstructuredImmersedEllipseProblem::complete_problem_setup</a></div><div class="ttdeci">void complete_problem_setup()</div><div class="ttdoc">Set boundary condition, assign auxiliary node update fct. Complete the build of all elements,...</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00654">jeffery_orbit.cc:654</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a4f8c7e7e4d626084f6515a152b165567"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a4f8c7e7e4d626084f6515a152b165567">UnstructuredImmersedEllipseProblem::unpin_rigid_body</a></div><div class="ttdeci">void unpin_rigid_body()</div><div class="ttdoc">Unpin the degrees of freedom associated with the solid bodies.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00842">jeffery_orbit.cc:842</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a51555f77dc360c94591ee68c3fc9928a"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a51555f77dc360c94591ee68c3fc9928a">UnstructuredImmersedEllipseProblem::delete_lagrange_multiplier_elements</a></div><div class="ttdeci">void delete_lagrange_multiplier_elements()</div><div class="ttdoc">Delete elements that impose the prescribed boundary displacement and wipe the associated mesh.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00980">jeffery_orbit.cc:981</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a544a35f261200bb4a4e29a88faa1a69c"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a544a35f261200bb4a4e29a88faa1a69c">UnstructuredImmersedEllipseProblem::UnstructuredImmersedEllipseProblem</a></div><div class="ttdeci">UnstructuredImmersedEllipseProblem()</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00305">jeffery_orbit.cc:306</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a71a3b24b610e05f7be916c4214dab8dc"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a71a3b24b610e05f7be916c4214dab8dc">UnstructuredImmersedEllipseProblem::Norm_file</a></div><div class="ttdeci">ofstream Norm_file</div><div class="ttdoc">File to document the norm of the solution (for validation purposes)</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00289">jeffery_orbit.cc:289</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a7d7b84968988d37091b29957b0af5bfa"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a7d7b84968988d37091b29957b0af5bfa">UnstructuredImmersedEllipseProblem::delete_drag_elements</a></div><div class="ttdeci">void delete_drag_elements()</div><div class="ttdoc">Delete elements that calculate the drag and torque on the boundaries.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l01079">jeffery_orbit.cc:1079</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a84cdf81be59fc646eb4d5b3bc0ff4280"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a84cdf81be59fc646eb4d5b3bc0ff4280">UnstructuredImmersedEllipseProblem::~UnstructuredImmersedEllipseProblem</a></div><div class="ttdeci">~UnstructuredImmersedEllipseProblem()</div><div class="ttdoc">Destructor.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00552">jeffery_orbit.cc:553</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_a9b4d04277b1f42c9428b610968f6f10d"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#a9b4d04277b1f42c9428b610968f6f10d">UnstructuredImmersedEllipseProblem::Drag_mesh_pt</a></div><div class="ttdeci">Vector&lt; Mesh * &gt; Drag_mesh_pt</div><div class="ttdoc">Mesh of drag elements.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00277">jeffery_orbit.cc:277</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_aa560217a33a9a9bc150fbdf15dbf1877"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#aa560217a33a9a9bc150fbdf15dbf1877">UnstructuredImmersedEllipseProblem::actions_before_adapt</a></div><div class="ttdeci">void actions_before_adapt()</div><div class="ttdoc">Wipe the meshes of Lagrange multiplier and drag elements.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00597">jeffery_orbit.cc:597</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_aaa6d1c19f3634a6f08f3dd7e5046217e"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#aaa6d1c19f3634a6f08f3dd7e5046217e">UnstructuredImmersedEllipseProblem::Rigid_body_pt</a></div><div class="ttdeci">Vector&lt; GeomObject * &gt; Rigid_body_pt</div><div class="ttdoc">Storage for the geom object.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00283">jeffery_orbit.cc:283</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_ab1558b409285aea617f4abf7d3a64b3d"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#ab1558b409285aea617f4abf7d3a64b3d">UnstructuredImmersedEllipseProblem::actions_after_adapt</a></div><div class="ttdeci">void actions_after_adapt()</div><div class="ttdoc">Rebuild the meshes of Lagrange multiplier and drag elements.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00618">jeffery_orbit.cc:618</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_ab201b187b240105fd8d444d943f6dada"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#ab201b187b240105fd8d444d943f6dada">UnstructuredImmersedEllipseProblem::set_boundary_velocity</a></div><div class="ttdeci">void set_boundary_velocity()</div><div class="ttdoc">Set the boundary velocity.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00736">jeffery_orbit.cc:737</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_acd1e8ec8e510f029f449f13dfdebbc99"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#acd1e8ec8e510f029f449f13dfdebbc99">UnstructuredImmersedEllipseProblem::Cog_file</a></div><div class="ttdeci">ofstream Cog_file</div><div class="ttdoc">File to document the motion of the centre of gravity.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00292">jeffery_orbit.cc:292</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_ad644e67ccd6ab0811c5fe2b7b944fbca"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#ad644e67ccd6ab0811c5fe2b7b944fbca">UnstructuredImmersedEllipseProblem::Lagrange_multiplier_mesh_pt</a></div><div class="ttdeci">SolidMesh * Lagrange_multiplier_mesh_pt</div><div class="ttdoc">Pointers to mesh of Lagrange multiplier elements.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00268">jeffery_orbit.cc:268</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_ae0b35188432c371804887b6de86b48c7"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#ae0b35188432c371804887b6de86b48c7">UnstructuredImmersedEllipseProblem::Outer_boundary_polygon_pt</a></div><div class="ttdeci">TriangleMeshPolygon * Outer_boundary_polygon_pt</div><div class="ttdoc">Triangle mesh polygon for outer boundary.</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00274">jeffery_orbit.cc:274</a></div></div>
<div class="ttc" id="aclassUnstructuredImmersedEllipseProblem_html_afa51876a2af9dd7640ff1f5a434804bf"><div class="ttname"><a href="classUnstructuredImmersedEllipseProblem.html#afa51876a2af9dd7640ff1f5a434804bf">UnstructuredImmersedEllipseProblem::actions_before_newton_convergence_check</a></div><div class="ttdeci">void actions_before_newton_convergence_check()</div><div class="ttdoc">Re-apply the no slip condition (imposed indirectly via dependent velocities)</div><div class="ttdef"><b>Definition:</b> <a href="jeffery__orbit_8cc_source.html#l00218">jeffery_orbit.cc:218</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
 <h1><a class="anchor" id="constructor"></a>
The Problem Constructor</h1>
<p>We begin by opening the output files and allocating two time steppers, one for the fluid problem and one for the rigid body problem.</p>
<div class="fragment"><div class="line"><span class="comment">//==start_constructor=====================================================</span></div>
<div class="line"><span class="comment">/// Constructor: Open output files, construct time steppers, build </span></div>
<div class="line"><span class="comment"></span><span class="comment">///  fluid mesh, immersed rigid body and combine to form the problem</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a class="code" href="classUnstructuredImmersedEllipseProblem.html#a544a35f261200bb4a4e29a88faa1a69c">UnstructuredImmersedEllipseProblem&lt;ELEMENT&gt;::</a></div>
<div class="line"><a class="code" href="classUnstructuredImmersedEllipseProblem.html#a544a35f261200bb4a4e29a88faa1a69c">UnstructuredImmersedEllipseProblem</a>()</div>
<div class="line">{ </div>
<div class="line"> <span class="comment">// Output directory</span></div>
<div class="line"> this-&gt;Doc_info.set_directory(<span class="stringliteral">&quot;RESLT&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Open norm file</span></div>
<div class="line"> this-&gt;Norm_file.open(<span class="stringliteral">&quot;RESLT/norm.dat&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Open file to trace the centre of gravity</span></div>
<div class="line"> this-&gt;Cog_file.open(<span class="stringliteral">&quot;RESLT/cog_trace.dat&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Open file to document the exact motion of the centre of gravity</span></div>
<div class="line"> this-&gt;Cog_exact_file.open(<span class="stringliteral">&quot;RESLT/cog_exact_trace.dat&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Allocate the timestepper -- this constructs the Problem&#39;s </span></div>
<div class="line"> <span class="comment">// time object with a sufficient amount of storage to store the</span></div>
<div class="line"> <span class="comment">// previous timsteps. </span></div>
<div class="line"> this-&gt;add_time_stepper_pt(<span class="keyword">new</span> BDF&lt;2&gt;);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Allocate a timestepper for the rigid body</span></div>
<div class="line"> this-&gt;add_time_stepper_pt(<span class="keyword">new</span> Newmark&lt;2&gt;);</div>
</div><!-- fragment --><p> We then define the geometry that defines the outer boundary of the unstructured mesh by constructing a <code>TriangleMeshPolygon</code> that consists of four straight-line boundaries.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Define the boundaries: Polyline with 4 different</span></div>
<div class="line"> <span class="comment">// boundaries for the outer boundary and 1 internal elliptical hole</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build the boundary segments for outer boundary, consisting of</span></div>
<div class="line"> <span class="comment">//--------------------------------------------------------------</span></div>
<div class="line"> <span class="comment">// four separate polyline segments</span></div>
<div class="line"> <span class="comment">//---------------------------------</span></div>
<div class="line"> Vector&lt;TriangleMeshCurveSection*&gt; boundary_segment_pt(4);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Set the length of the channel</span></div>
<div class="line"> <span class="keywordtype">double</span> half_length = 5.0;</div>
<div class="line"> <span class="keywordtype">double</span> half_height = 2.5;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Initialize boundary segment</span></div>
<div class="line"> Vector&lt;Vector&lt;double&gt; &gt; bound_seg(2);</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;2;i++) {bound_seg[i].resize(2);}</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// First boundary segment</span></div>
<div class="line"> bound_seg[0][0]=-half_length;</div>
<div class="line"> bound_seg[0][1]=-half_height;</div>
<div class="line"> bound_seg[1][0]=-half_length;</div>
<div class="line"> bound_seg[1][1]=half_height;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Specify 1st boundary id</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> bound_id = 0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build the 1st boundary segment</span></div>
<div class="line"> boundary_segment_pt[0] = <span class="keyword">new</span> TriangleMeshPolyLine(bound_seg,bound_id);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Second boundary segment</span></div>
<div class="line"> bound_seg[0][0]=-half_length;</div>
<div class="line"> bound_seg[0][1]=half_height;</div>
<div class="line"> bound_seg[1][0]=half_length;</div>
<div class="line"> bound_seg[1][1]=half_height;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Specify 2nd boundary id</span></div>
<div class="line"> bound_id = 1;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build the 2nd boundary segment</span></div>
<div class="line"> boundary_segment_pt[1] = <span class="keyword">new</span> TriangleMeshPolyLine(bound_seg,bound_id);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Third boundary segment</span></div>
<div class="line"> bound_seg[0][0]=half_length;</div>
<div class="line"> bound_seg[0][1]=half_height;</div>
<div class="line"> bound_seg[1][0]=half_length;</div>
<div class="line"> bound_seg[1][1]=-half_height;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Specify 3rd boundary id</span></div>
<div class="line"> bound_id = 2;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build the 3rd boundary segment</span></div>
<div class="line"> boundary_segment_pt[2] = <span class="keyword">new</span> TriangleMeshPolyLine(bound_seg,bound_id);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Fourth boundary segment</span></div>
<div class="line"> bound_seg[0][0]=half_length;</div>
<div class="line"> bound_seg[0][1]=-half_height;</div>
<div class="line"> bound_seg[1][0]=-half_length;</div>
<div class="line"> bound_seg[1][1]=-half_height;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Specify 4th boundary id</span></div>
<div class="line"> bound_id = 3;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build the 4th boundary segment</span></div>
<div class="line"> boundary_segment_pt[3] = <span class="keyword">new</span> TriangleMeshPolyLine(bound_seg,bound_id);</div>
<div class="line">  </div>
<div class="line"> <span class="comment">// Create the triangle mesh polygon for outer boundary using boundary segment</span></div>
<div class="line"> Outer_boundary_polygon_pt = <span class="keyword">new</span> TriangleMeshPolygon(boundary_segment_pt);</div>
</div><!-- fragment --><p> Next we build the single <code>ImmersedRigidBodyElement</code> from an instantiation of a <code><a class="el" href="classGeneralEllipse.html" title="//////////////////////////////////////////////////////// ////////////////////////////////////////////...">GeneralEllipse</a></code> geometric object.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Now build the moving rigid body</span></div>
<div class="line"> <span class="comment">//-------------------------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// We have one rigid body</span></div>
<div class="line"> Rigid_body_pt.resize(1);</div>
<div class="line"> Vector&lt;TriangleMeshClosedCurve*&gt; hole_pt(1);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build Rigid Body</span></div>
<div class="line"> <span class="comment">//-----------------</span></div>
<div class="line"> <span class="keywordtype">double</span> x_center = 0.0;</div>
<div class="line"> <span class="keywordtype">double</span> y_center = 0.0;</div>
<div class="line"> <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">A</a> = <a class="code" href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">Problem_Parameter::A</a>;</div>
<div class="line"> <span class="keywordtype">double</span> <a class="code" href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">B</a> = <a class="code" href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">Problem_Parameter::B</a>;</div>
<div class="line"> GeomObject* temp_hole_pt = <span class="keyword">new</span> <a class="code" href="classGeneralEllipse.html">GeneralEllipse</a>(x_center,y_center,<a class="code" href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">A</a>,<a class="code" href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">B</a>);</div>
<div class="line"> Rigid_body_pt[0] = <span class="keyword">new</span> ImmersedRigidBodyElement(temp_hole_pt,</div>
<div class="line">                                                 this-&gt;time_stepper_pt(1));</div>
</div><!-- fragment --><p> The <code>ImmersedRigidBodyElement</code> is used to define a <code>TriangleMeshCurvilinearClosedCurve</code> in exactly the same way as if it were simply a (passive) <code>GeomObject</code>, as discussed in <a href="../../../../doc/meshes/mesh_from_inline_triangle/html/index.html">another tutorial. </a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Build the two parts of the curvilinear boundary from the rigid body</span></div>
<div class="line"> Vector&lt;TriangleMeshCurveSection*&gt; curvilinear_boundary_pt(2);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//First section (boundary 4)</span></div>
<div class="line"> <span class="keywordtype">double</span> zeta_start=0.0;</div>
<div class="line"> <span class="keywordtype">double</span> zeta_end=MathematicalConstants::Pi;</div>
<div class="line"> <span class="keywordtype">unsigned</span> nsegment=8; </div>
<div class="line"> <span class="keywordtype">unsigned</span> boundary_id=4; </div>
<div class="line"> curvilinear_boundary_pt[0]=<span class="keyword">new</span> TriangleMeshCurviLine(</div>
<div class="line">  Rigid_body_pt[0],zeta_start,zeta_end,nsegment,boundary_id);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Second section (boundary 5)</span></div>
<div class="line"> zeta_start=MathematicalConstants::Pi;</div>
<div class="line"> zeta_end=2.0*MathematicalConstants::Pi;</div>
<div class="line"> nsegment=8; </div>
<div class="line"> boundary_id=5; </div>
<div class="line"> curvilinear_boundary_pt[1]=<span class="keyword">new</span> TriangleMeshCurviLine(</div>
<div class="line">  Rigid_body_pt[0],zeta_start,zeta_end, </div>
<div class="line">  nsegment,boundary_id);</div>
<div class="line">  </div>
<div class="line"> <span class="comment">// Combine to form a hole in the fluid mesh</span></div>
<div class="line"> Vector&lt;double&gt; hole_coords(2);</div>
<div class="line"> hole_coords[0]=0.0;</div>
<div class="line"> hole_coords[1]=0.0;</div>
<div class="line"> Vector&lt;TriangleMeshClosedCurve*&gt; curvilinear_hole_pt(1);</div>
<div class="line"> hole_pt[0]=</div>
<div class="line">  <span class="keyword">new</span> TriangleMeshClosedCurve(</div>
<div class="line">   curvilinear_boundary_pt,hole_coords);</div>
</div><!-- fragment --><p> We then build the unstructured fluid mesh using the boundary information, set a spatial error estimator and complete the setup of the problem</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Now build the mesh, based on the boundaries specified by</span></div>
<div class="line"> <span class="comment">//---------------------------------------------------------</span></div>
<div class="line"> <span class="comment">// polygons just created</span></div>
<div class="line"> <span class="comment">//----------------------</span></div>
<div class="line"> </div>
<div class="line"> TriangleMeshClosedCurve* closed_curve_pt=Outer_boundary_polygon_pt;</div>
<div class="line"> </div>
<div class="line"> <span class="keywordtype">double</span> uniform_element_area=1.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Use the TriangleMeshParameters object for gathering all</span></div>
<div class="line"> <span class="comment">// the necessary arguments for the TriangleMesh object</span></div>
<div class="line"> TriangleMeshParameters triangle_mesh_parameters(</div>
<div class="line">   closed_curve_pt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Define the holes on the domain</span></div>
<div class="line"> triangle_mesh_parameters.internal_closed_curve_pt() =</div>
<div class="line">   hole_pt;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Define the maximum element area</span></div>
<div class="line"> triangle_mesh_parameters.element_area() =</div>
<div class="line">   uniform_element_area;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create the mesh</span></div>
<div class="line"> Fluid_mesh_pt =</div>
<div class="line">   <span class="keyword">new</span> RefineableSolidTriangleMesh&lt;ELEMENT&gt;(</div>
<div class="line">     triangle_mesh_parameters, this-&gt;time_stepper_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set error estimator for bulk mesh</span></div>
<div class="line"> Z2ErrorEstimator* error_estimator_pt=<span class="keyword">new</span> Z2ErrorEstimator;</div>
<div class="line"> Fluid_mesh_pt-&gt;spatial_error_estimator_pt()=error_estimator_pt;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set targets for spatial adaptivity</span></div>
<div class="line"> Fluid_mesh_pt-&gt;max_permitted_error()=0.005;</div>
<div class="line"> Fluid_mesh_pt-&gt;min_permitted_error()=0.001; </div>
<div class="line"> Fluid_mesh_pt-&gt;max_element_size()=1.0;</div>
<div class="line"> Fluid_mesh_pt-&gt;min_element_size()=0.001; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Use coarser mesh during validation</span></div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::command_line_flag_has_been_set(<span class="stringliteral">&quot;--validation&quot;</span>))</div>
<div class="line">  {</div>
<div class="line">   Fluid_mesh_pt-&gt;min_element_size()=0.01; </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set boundary condition, assign auxiliary node update fct,</span></div>
<div class="line"> <span class="comment">// complete the build of all elements, attach power elements that allow</span></div>
<div class="line"> <span class="comment">// computation of drag vector</span></div>
<div class="line"> complete_problem_setup();</div>
</div><!-- fragment --><p> The <code>ImmersedRigidBodyElement</code> is not deleted during the adaptation process and so its physical parameters can be set once in the constructor. We set the initial position of the centre of mass, as well as the non-dimensional mass and moment of inertia shape, the Reynolds and Strouhal numbers, and the density ratio, which appear in the governing equations above. For this problem, we also fix the location of the centre of mass. (The section <a class="el" href="index.html#comments">Comments and Exercises</a> contains an exercise that asks you to explore what happens when you omit this step).</p>
<div class="fragment"><div class="line">  </div>
<div class="line"> <span class="comment">//Set the parameters of the rigid body elements</span></div>
<div class="line"> ImmersedRigidBodyElement* rigid_element1_pt = </div>
<div class="line">  <span class="keyword">dynamic_cast&lt;</span>ImmersedRigidBodyElement*<span class="keyword">&gt;</span>(Rigid_body_pt[0]);</div>
<div class="line"> rigid_element1_pt-&gt;initial_centre_of_mass(0) = x_center;</div>
<div class="line"> rigid_element1_pt-&gt;initial_centre_of_mass(1) = y_center; </div>
<div class="line"> rigid_element1_pt-&gt;mass_shape() = MathematicalConstants::Pi*<a class="code" href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">A</a>*<a class="code" href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">B</a>;</div>
<div class="line"> rigid_element1_pt-&gt;moment_of_inertia_shape() = </div>
<div class="line"> 0.25*MathematicalConstants::Pi*<a class="code" href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">A</a>*<a class="code" href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">B</a>*(<a class="code" href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">A</a>*<a class="code" href="namespaceProblem__Parameter.html#a23071148de0fea3597c2a7eb848320b6">A</a> + <a class="code" href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">B</a>*<a class="code" href="namespaceProblem__Parameter.html#ac2362a46222574a21338a113e2bee27e">B</a>);</div>
<div class="line"> rigid_element1_pt-&gt;re_pt() = &amp;<a class="code" href="namespaceProblem__Parameter.html#acc656299287d4d9a8374c2c501750b4f">Problem_Parameter::Re</a>;</div>
<div class="line"> rigid_element1_pt-&gt;st_pt() = &amp;<a class="code" href="namespaceProblem__Parameter.html#a8d9b76e390569bac0095bd0952281a30">Problem_Parameter::St</a>;</div>
<div class="line"> rigid_element1_pt-&gt;density_ratio_pt() = &amp;<a class="code" href="namespaceProblem__Parameter.html#a7fcb9a415485247d626190923235be2a">Problem_Parameter::Density_ratio</a>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Pin the position of the centre of mass</span></div>
<div class="line"> rigid_element1_pt-&gt;pin_centre_of_mass_coordinate(0);</div>
<div class="line"> rigid_element1_pt-&gt;pin_centre_of_mass_coordinate(1);</div>
</div><!-- fragment --><p> For later reference, we store the single <code>ImmersedRigidBodyElement</code> in a mesh</p>
<div class="fragment"><div class="line"> </div>
<div class="line">  <span class="comment">// Create the mesh for the rigid bodies</span></div>
<div class="line"> Rigid_body_mesh_pt = <span class="keyword">new</span> Mesh;</div>
<div class="line"> Rigid_body_mesh_pt-&gt;add_element_pt(rigid_element1_pt);</div>
</div><!-- fragment --><p> We then create the elements that apply the load on the rigid body and pass the entire mesh of elements to the rigid body. This is the equivalent of the function <code>FSI_functions::setup_fluid_load_info_for_solid_elements</code>(..), but here the procedure is very simple because <b> all </b> the surface elements affect the single rigid body.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Create the drag mesh for the rigid bodies</span></div>
<div class="line"> Drag_mesh_pt.resize(1);</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> m=0;m&lt;1;m++) {Drag_mesh_pt[m] = <span class="keyword">new</span> Mesh;}</div>
<div class="line"> this-&gt;create_drag_elements();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Add the drag mesh to the appropriate rigid bodies</span></div>
<div class="line"> rigid_element1_pt-&gt;set_drag_mesh(Drag_mesh_pt[0]);</div>
</div><!-- fragment --><p> We next create the mesh of Lagrange-multiplier elements that drive the deformation of the fluid mesh in response to the motion of the ellipse</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create Lagrange multiplier mesh for boundary motion</span></div>
<div class="line"> <span class="comment">//----------------------------------------------------</span></div>
<div class="line"> <span class="comment">// Construct the mesh of elements that enforce prescribed boundary motion</span></div>
<div class="line"> <span class="comment">// of pseudo-solid fluid mesh by Lagrange multipliers</span></div>
<div class="line"> Lagrange_multiplier_mesh_pt=<span class="keyword">new</span> SolidMesh;</div>
<div class="line"> create_lagrange_multiplier_elements();</div>
</div><!-- fragment --><p> and then construct the global mesh and assign equation numbers.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Combine meshes</span></div>
<div class="line"> <span class="comment">//---------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Add Fluid_mesh_pt sub meshes</span></div>
<div class="line"> this-&gt;add_sub_mesh(Fluid_mesh_pt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Add Lagrange_multiplier sub meshes</span></div>
<div class="line"> this-&gt;add_sub_mesh(this-&gt;Lagrange_multiplier_mesh_pt);</div>
<div class="line"> </div>
<div class="line"> this-&gt;add_sub_mesh(this-&gt;Rigid_body_mesh_pt);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build global mesh</span></div>
<div class="line"> this-&gt;build_global_mesh();</div>
<div class="line">    </div>
<div class="line"> <span class="comment">// Setup equation numbering scheme</span></div>
<div class="line"> cout &lt;&lt;<span class="stringliteral">&quot;Number of equations: &quot;</span> &lt;&lt; this-&gt;assign_eqn_numbers() &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end_of_constructor</span></div>
</div><!-- fragment --><p> Note that the <code>Drag_mesh_pt</code> does not need to be added as a sub-mesh because its elements do not contribute <em> directly </em> to the residuals and Jacobian.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="complete"></a>
Completing the problem setup</h1>
<p>The helper function <code>complete_problem_setup()</code> starts by (re-)applying the boundary conditions by pinning the fluid velocity in the <img class="formulaInl" alt="$ x_{2}$" src="form_50.png" width="13" height="9"/>-direction on all boundaries and that in the <img class="formulaInl" alt="$ x_{1} $" src="form_51.png" width="13" height="9"/>-direction on the top and bottom (boundaries 1 and 3).</p>
 <div class="fragment"><div class="line"><span class="comment">//============start_complete_problem_setup=================================</span></div>
<div class="line"><span class="comment">/// Set boundary condition, assign auxiliary node update fct.</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// Complete the build of all elements, attach power elements that allow</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// computation of drag vector</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a42b13e3306ff2a94053907644ba17c8d">UnstructuredImmersedEllipseProblem&lt;ELEMENT&gt;::complete_problem_setup</a>()</div>
<div class="line">{   </div>
<div class="line"> <span class="comment">// Set the boundary conditions for fluid problem: All nodes are</span></div>
<div class="line"> <span class="comment">// free by default -- just pin the ones that have Dirichlet conditions</span></div>
<div class="line"> <span class="comment">// here. </span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nbound=Fluid_mesh_pt-&gt;nboundary();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=0;ibound&lt;nbound;ibound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod=Fluid_mesh_pt-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Cache pointer to node</span></div>
<div class="line">     Node* <span class="keyword">const</span> nod_pt=Fluid_mesh_pt-&gt;boundary_node_pt(ibound,inod);</div>
<div class="line">     </div>
<div class="line">     <span class="comment">//Pin x-velocity unless on inlet (0) and outlet (2) boundaries</span></div>
<div class="line">     <span class="comment">//of the external rectangular box</span></div>
<div class="line">     <span class="keywordflow">if</span>((ibound!=0) &amp;&amp; (ibound!=2)) {nod_pt-&gt;pin(0);}</div>
<div class="line">     <span class="comment">//Pin the y-velocity on all boundaries</span></div>
<div class="line">     nod_pt-&gt;pin(1);</div>
</div><!-- fragment --><p> The boundary conditions for the solid degrees of freedom that describe the mesh deformation are assigned next by pinning the nodal positions on the fixed domain boundaries (boundaries 0, 1, 2, 3):</p>
<div class="fragment"><div class="line">     </div>
<div class="line">     <span class="comment">// Pin pseudo-solid positions apart from on the </span></div>
<div class="line">     <span class="comment">// ellipse boundary that is allowed to move</span></div>
<div class="line">     <span class="comment">// Cache cast pointer to solid node</span></div>
<div class="line">     SolidNode* <span class="keyword">const</span> solid_node_pt = <span class="keyword">dynamic_cast&lt;</span>SolidNode*<span class="keyword">&gt;</span>(nod_pt);</div>
<div class="line">          </div>
<div class="line">     <span class="comment">//Pin the solid positions on all external boundaries</span></div>
<div class="line">     <span class="keywordflow">if</span>(ibound &lt; 4)</div>
<div class="line">      {</div>
<div class="line">       solid_node_pt-&gt;pin_position(0);</div>
<div class="line">       solid_node_pt-&gt;pin_position(1);</div>
<div class="line">      }</div>
</div><!-- fragment --><p> The nodes on the boundary of the rigid body should be free to move, so they are unpinned and an auxiliary node update function is set to apply the no-slip boundary condition from the <code>Node's</code> positional history values.</p>
<div class="fragment"><div class="line">     <span class="comment">// Unpin the position of all the nodes on hole boundaries:</span></div>
<div class="line">     <span class="comment">// since they will be moved using Lagrange Multiplier</span></div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">       solid_node_pt-&gt;unpin_position(0);</div>
<div class="line">       solid_node_pt-&gt;unpin_position(1);</div>
<div class="line">       </div>
<div class="line">       <span class="comment">// Assign auxiliary node update fct, which determines the</span></div>
<div class="line">       <span class="comment">// velocity on the moving boundary using the position history</span></div>
<div class="line">       <span class="comment">// values</span></div>
<div class="line">       <span class="comment">// A more accurate version may be obtained by using velocity</span></div>
<div class="line">       <span class="comment">// based on the actual position of the geometric object,</span></div>
<div class="line">       <span class="comment">// but this introduces additional dependencies between the</span></div>
<div class="line">       <span class="comment">// Data of the rigid body and the fluid elements.</span></div>
<div class="line">       nod_pt-&gt;set_auxiliary_node_update_fct_pt(</div>
<div class="line">        FSI_functions::apply_no_slip_on_moving_wall); </div>
<div class="line">      }</div>
<div class="line">    } <span class="comment">//End of loop over boundary nodes</span></div>
<div class="line">  } <span class="comment">// End loop over boundaries</span></div>
</div><!-- fragment --><p> We then loop over the fluid elements and set pointers to the physical parameters and the apply the velocity boundary conditions</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Complete the build of all elements so they are fully functional</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element = Fluid_mesh_pt-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Upcast from GeneralisedElement to the present element</span></div>
<div class="line">   ELEMENT* el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(Fluid_mesh_pt-&gt;element_pt(e));</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Set the Reynolds number</span></div>
<div class="line">   el_pt-&gt;re_pt() = &amp;<a class="code" href="namespaceProblem__Parameter.html#acc656299287d4d9a8374c2c501750b4f">Problem_Parameter::Re</a>;</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Set the Womersley number (same as Re since St=1)</span></div>
<div class="line">   el_pt-&gt;re_st_pt() = &amp;<a class="code" href="namespaceProblem__Parameter.html#acc656299287d4d9a8374c2c501750b4f">Problem_Parameter::Re</a>;</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Set the constitutive law for pseudo-elastic mesh deformation</span></div>
<div class="line">   el_pt-&gt;constitutive_law_pt()=<a class="code" href="namespaceProblem__Parameter.html#a9852a6077458693983628319d429f11f">Problem_Parameter::Constitutive_law_pt</a>;</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Set the &quot;density&quot; for pseudo-elastic mesh deformation</span></div>
<div class="line">   el_pt-&gt;lambda_sq_pt()=&amp;<a class="code" href="namespaceProblem__Parameter.html#a20ea33c391abd96d43f79913377c1e12">Problem_Parameter::Lambda_sq</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Re-apply Dirichlet boundary conditions for current and history values</span></div>
<div class="line"> <span class="comment">// (projection ignores boundary conditions!)</span></div>
<div class="line"> this-&gt;set_boundary_velocity();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end_of_complete_problem_setup</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="surface"></a>
Creating and destroying the surface elements</h1>
<p>The general procedure for creating, attaching and deleting<code>FaceElements</code> is exactly the same as described <a href="../../../../doc/poisson/two_d_poisson_flux_bc/html/index.html">in another tutorial, </a> so is not described in detail here.</p>
<p>The functions <code>create_lagrange_multiplier_elements()</code> and <code>create_drag_elements()</code> construct surface <code>ImposeDisplacementByLagrangeMulitiplierElements</code> and <code>NavierStokesSurfaceDragTorqueElements</code>, respectively, around the boundary of the rigid body, setting any required member data. For example, the <code>NavierStokesSurfaceDragTorqueElements</code> require the location of the centre of mass in order to compute the torque. The elements are added to the internal storage containers <code>Lagrange_multiplier_mesh_pt</code> and <code>Drag_mesh_pt</code>. The corresponding functions <code>delete_lagrange_multiplier_elements()</code> and <code>delete_drag_elements()</code> are used to delete and remove the elements before adaptation.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="bc"></a>
Setting the boundary velocity</h1>
<p>The function <code>set_boundary_velocity()</code> is used to apply the time-dependent boundary conditions to the external boundaries of the fluid domain. The only subtlety is that after a remesh the history values for the boundary nodes must also be (re-)applied; and, for simplicity, the history values are always reset.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="initial"></a>
Solving for consistent initial nodal positions</h1>
<p>The initial nodal positions are made consistent with the weakly-imposed displacement boundary condition by pinning the rigid body degrees of freedom, performing a steady Newton solve and then releasing the rigid body degrees of freedom.</p>
<div class="fragment"><div class="line"><span class="comment">//==========start_solve_for_consistent_nodal_positions================</span></div>
<div class="line"><span class="comment">/// Assemble and solve a simplified problem that ensures that the </span></div>
<div class="line"><span class="comment"></span><span class="comment">/// positions of the boundary nodes are consistent with the weak </span></div>
<div class="line"><span class="comment"></span><span class="comment">/// imposition of the displacement boundary conditions on the surface</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// of the ellipse.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//===================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUnstructuredImmersedEllipseProblem.html#a2a88b40ff1988de0fc696f1eb755ea54">UnstructuredImmersedEllipseProblem&lt;ELEMENT&gt;::</a></div>
<div class="line"><a class="code" href="classUnstructuredImmersedEllipseProblem.html#a2a88b40ff1988de0fc696f1eb755ea54">solve_for_consistent_nodal_positions</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">//First pin all degrees of freedom in the rigid body</span></div>
<div class="line"> this-&gt;pin_rigid_body();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Must reassign equation numbrs</span></div>
<div class="line"> this-&gt;assign_eqn_numbers();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Do a steady solve to map the nodes to the boundary of the ellipse</span></div>
<div class="line"> this-&gt;steady_newton_solve();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Now unpin the rigid body...</span></div>
<div class="line"> this-&gt;unpin_rigid_body();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//...and then repin the position of the centre of mass</span></div>
<div class="line"> ImmersedRigidBodyElement* rigid_element1_pt = </div>
<div class="line">  <span class="keyword">dynamic_cast&lt;</span>ImmersedRigidBodyElement*<span class="keyword">&gt;</span>(Rigid_body_pt[0]);</div>
<div class="line"> rigid_element1_pt-&gt;pin_centre_of_mass_coordinate(0);</div>
<div class="line"> rigid_element1_pt-&gt;pin_centre_of_mass_coordinate(1);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//and then reassign equation numbers</span></div>
<div class="line"> this-&gt;assign_eqn_numbers();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end_solve_for_consistent_nodal_positions</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="comments"></a>
Comments and Exercises</h1>
<h2><a class="anchor" id="exercises"></a>
Exercises</h2>
<ol type="1">
<li>Confirm that for sufficiently large times the solution agrees with Jeffery's analytic solution when you set <img class="formulaInl" alt="$ Re=0 $" src="form_52.png" width="38" height="10"/>. Explain why you expect there to be a discrepancy at early times.<br  />
<br  />
</li>
<li>What happens when the centre of mass is not fixed? Can you explain the observed behaviour?<br  />
<br  />
</li>
<li>What happens if you don't call the function <code>solve_for_consistent_nodal_positions()</code>? Can you explain the observed behaviour?<br  />
<br  />
</li>
<li>Investigate the behaviour of the system with increasing <img class="formulaInl" alt="$Re$" src="form_53.png" width="15" height="10"/>. What happens to the oscillations for <img class="formulaInl" alt="$ Re &gt; 30 $" src="form_54.png" width="44" height="11"/>?<br  />
<br  />
</li>
</ol>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory:<br  />
<br  />
<center> <a href="../../../../demo_drivers/navier_stokes/jeffery_orbit/">demo_drivers/navier_stokes/jeffery_orbit/ </a> </center><br  />
</li>
<li>The driver code is: <br  />
<br  />
<center> <a href="../../../../demo_drivers/navier_stokes/jeffery_orbit/jeffery_orbit.cc">demo_drivers/navier_stokes/jeffery_orbit/jeffery_orbit.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:22:37
        </div>
      </div>
    </footer>
</body>
</html>
