<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: Flow past a cylinder with a waving flag</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Demo problem: Flow past a cylinder with a waving flag </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this example we consider the flow in a 2D channel that contains a cylinder with a waving "flag". This is a "warm-up problem" for the solution of Turek &amp; Hron's FSI benchmark problem discussed in <a href="../../../interaction/turek_flag/html/index.html">another tutorial.</a></p>
<hr  />
 <hr  />
<h1><a class="anchor" id="the_problem"></a>
The Problem</h1>
<p>The figure below shows a sketch of the problem: A 2D channel of height <img class="formulaInl" alt="$ H^*$" src="form_0.png" width="16" height="10"/> and length <img class="formulaInl" alt="$ L^* $" src="form_1.png" width="13" height="10"/> contains a cylinder of diameter <img class="formulaInl" alt="$ d^* $" src="form_2.png" width="11" height="10"/>, centred at <img class="formulaInl" alt="$ (X^*_c, Y^*_c) $" src="form_3.png" width="48" height="14"/> to which a "flag" of thickness <img class="formulaInl" alt="$ H^*_{flag}$" src="form_4.png" width="30" height="16"/> and length <img class="formulaInl" alt="$ L^*_{flag} $" src="form_5.png" width="28" height="16"/> is attached. We assume that the flag performs time-periodic oscillations with period <img class="formulaInl" alt="$ T^*. $" src="form_6.png" width="19" height="10"/> Steady Poiseuille flow with average velocity <img class="formulaInl" alt="$ U^* $" src="form_7.png" width="15" height="10"/> is imposed at the left end of the channel while we assume the outflow to be parallel and axially traction-free.</p>
<div class="image">
<img src="turek_flag_non_fsi_dim.gif" alt=""/>
<div class="caption">
Sketch of the problem in dimensional variables. </div></div>
 <p>We non-dimensionalise all length and coordinates on the diameter of the cylinder, <img class="formulaInl" alt="$ d^* $" src="form_2.png" width="11" height="10"/>, time on the natural timescale of the flow, <img class="formulaInl" alt="$ d^*/U^* $" src="form_8.png" width="33" height="14"/>, the velocities on the mean velocity, <img class="formulaInl" alt="$ U^* $" src="form_7.png" width="15" height="10"/>, and the pressure on the viscous scale. The problem is then governed by the non-dimensional Navier-Stokes equations </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Re \left( St \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} \right) = - \frac{\partial p}{\partial x_i} + \frac{\partial }{\partial x_j} \left[ \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right) \right], \]" src="form_9.png" width="306" height="31"/>
</p>
<p> where <img class="formulaInl" alt="$ Re = \rho U^* H_0^* / \mu $" src="form_10.png" width="85" height="14"/> and <img class="formulaInl" alt="$ St = 1 $" src="form_11.png" width="35" height="10"/>, and </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial u_i}{\partial x_i} = 0, \]" src="form_12.png" width="48" height="29"/>
</p>
 </center><p> subject to parabolic inflow </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf u} = 6 x_2 (1-x_2) {\bf e}_1 \]" src="form_13.png" width="99" height="14"/>
</p>
 </center><p> at the inflow cross-section; parallel, axially-traction-free outflow at the outlet; and no-slip on the stationary channel walls and the surface of the cylinder, <img class="formulaInl" alt="$ {\bf u} = {\bf 0} $" src="form_14.png" width="31" height="9"/>. The no-slip condition on the moving flag is </p><center> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf u} = \frac{\partial {\bf R}_w(\xi_{[top,tip,bottom]},t)}{\partial t} \]" src="form_15.png" width="148" height="29"/>
</p>
 </center><p> where <img class="formulaInl" alt="$ \xi_{[top,tip,bottom]} $" src="form_16.png" width="74" height="15"/> are Lagrangian coordinates parametrising the three faces of the flag. The flag performs oscillations with non-dimensional period <img class="formulaInl" alt="$ T = T^* U^* / H^*_{tot} $" src="form_17.png" width="86" height="14"/>. Here is a sketch of the non-dimensional version of the problem:</p>
<div class="image">
<img src="turek_flag_non_fsi.gif" alt=""/>
<div class="caption">
Sketch of the problem in dimensionless variables, showing the Lagrangian coordinates that parametrise the three faces of the flag. </div></div>
 <hr  />
 <hr  />
<h1><a class="anchor" id="results"></a>
Results</h1>
<p>The figure below shows a snapshot of the flow field <br  />
 (pressure contours and instantaneous streamlines) for a Reynolds number of <img class="formulaInl" alt="$ Re=100 $" src="form_18.png" width="50" height="10"/> and an oscillation period of <img class="formulaInl" alt="$ T= 10 $" src="form_19.png" width="39" height="9"/>, as well as the corresponding fluid mesh. Note how <code>oomph-lib's</code> automatic mesh adaptation has refined the mesh in the high-shear regions near the front of the cylinder and at the trailing edge of the flag.</p>
<div class="image">
<img src="flow_cropped.gif" alt=""/>
<div class="caption">
Mesh (top) and flow field (bottom). </div></div>
 <p>The corresponding <a href="../figures/turek_flag_non_fsi.avi">animation</a> illustrates the algebraic node update strategy (implemented with an <code>AlgebraicMesh</code>, discussed in more detail in <a href="../../algebraic_collapsible_channel/html/index.html">another tutorial</a>) and the evolution of the flow field. Note that the instantaneous streamlines intersect the (impermeable) flag because the flag is not stationary.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="parameters"></a>
The global parameters</h1>
<p>As usual we use a namespace to define the (single) global parameter, the Reynolds number.</p>
 <div class="fragment"><div class="line"><span class="comment">//====start_of_global_parameters==========================================</span></div>
<div class="line"><span class="comment">/// Global parameters</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGlobal__Parameters.html">Global_Parameters</a></div>
<div class="line">{<span class="comment"></span></div>
<div class="line"><span class="comment"> /// Reynolds number</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Re</a>=100.0;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceGlobal__Parameters_html"><div class="ttname"><a href="namespaceGlobal__Parameters.html">Global_Parameters</a></div><div class="ttdoc">Global parameters.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00055">turek_flag_non_fsi.cc:56</a></div></div>
<div class="ttc" id="anamespaceGlobal__Parameters_html_a9d72e94a9305c6a310940a6a427ebe06"><div class="ttname"><a href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Global_Parameters::Re</a></div><div class="ttdeci">double Re</div><div class="ttdoc">Reynolds number.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00058">turek_flag_non_fsi.cc:58</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="leaflet"></a>
Specification of the flag geometry</h1>
<p>We specify the flag geometry and its time-dependent motion by representing its three faces by <code>GeomObjects</code>, each parametrised by its own Lagrangian coordinate, as shown in the sketch above. The geometry of the cylinder is represented by one of <code>oomph-lib's</code> generic <code>GeomObjects</code>, the <code>Circle</code>.</p>
<p>We enclose the relevant data in its own namespace and start by defining the period of the oscillation, and the geometric parameters controlling the flag's initial shape and its subsequent motion.</p>
 <div class="fragment"><div class="line"><span class="comment">//====start_of_flag_definition===========================================</span></div>
<div class="line"><span class="comment">/// Namespace for definition of flag boundaries</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceFlag__definition.html">Flag_definition</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Period of prescribed flag oscillation</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceFlag__definition.html#a47976a19abd58b9c31671f074ca57285">Period</a>=10.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Height of flag</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>=0.2;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Length of flag</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceFlag__definition.html#a94553533bee82260731a466182369a9d">L</a>=3.5;</div>
<div class="line">   <span class="comment"></span></div>
<div class="line"><span class="comment"> /// x position of centre of cylinder</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceFlag__definition.html#a60f30c718c6c67504b05dca7832be8aa">Centre_x</a>=2.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// y position of centre of cylinder</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceFlag__definition.html#a0024007edc2ad0ef647939aa6b06bde7">Centre_y</a>=2.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Radius of cylinder</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>=0.5;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Amplitude of tip deflection</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceFlag__definition.html#ad0eb269ec983b485aa24a6f2c25d2f5b">Amplitude</a>=0.33;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to the global time object</span></div>
<div class="line"><span class="comment"></span> Time* <a class="code" href="namespaceFlag__definition.html#adc7ca9d539ba8569c5eaa574de22c08f">Time_pt</a>=0;</div>
<div class="ttc" id="anamespaceFlag__definition_html"><div class="ttname"><a href="namespaceFlag__definition.html">Flag_definition</a></div><div class="ttdoc">Namespace for definition of flag boundaries.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00066">turek_flag_non_fsi.cc:67</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_a0024007edc2ad0ef647939aa6b06bde7"><div class="ttname"><a href="namespaceFlag__definition.html#a0024007edc2ad0ef647939aa6b06bde7">Flag_definition::Centre_y</a></div><div class="ttdeci">double Centre_y</div><div class="ttdoc">y position of centre of cylinder</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00082">turek_flag_non_fsi.cc:82</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_a47976a19abd58b9c31671f074ca57285"><div class="ttname"><a href="namespaceFlag__definition.html#a47976a19abd58b9c31671f074ca57285">Flag_definition::Period</a></div><div class="ttdeci">double Period</div><div class="ttdoc">Period of prescribed flag oscillation.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00070">turek_flag_non_fsi.cc:70</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_a60f30c718c6c67504b05dca7832be8aa"><div class="ttname"><a href="namespaceFlag__definition.html#a60f30c718c6c67504b05dca7832be8aa">Flag_definition::Centre_x</a></div><div class="ttdeci">double Centre_x</div><div class="ttdoc">x position of centre of cylinder</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00079">turek_flag_non_fsi.cc:79</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_a6cdf33de1fe6f94832181664d7769af7"><div class="ttname"><a href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">Flag_definition::H</a></div><div class="ttdeci">double H</div><div class="ttdoc">Height of flag.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00073">turek_flag_non_fsi.cc:73</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_a921d8bd82b7b267651dea625a548dfcb"><div class="ttname"><a href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Flag_definition::Radius</a></div><div class="ttdeci">double Radius</div><div class="ttdoc">Radius of cylinder.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00085">turek_flag_non_fsi.cc:85</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_a94553533bee82260731a466182369a9d"><div class="ttname"><a href="namespaceFlag__definition.html#a94553533bee82260731a466182369a9d">Flag_definition::L</a></div><div class="ttdeci">double L</div><div class="ttdoc">Length of flag.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00076">turek_flag_non_fsi.cc:76</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_ad0eb269ec983b485aa24a6f2c25d2f5b"><div class="ttname"><a href="namespaceFlag__definition.html#ad0eb269ec983b485aa24a6f2c25d2f5b">Flag_definition::Amplitude</a></div><div class="ttdeci">double Amplitude</div><div class="ttdoc">Amplitude of tip deflection.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00088">turek_flag_non_fsi.cc:88</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_adc7ca9d539ba8569c5eaa574de22c08f"><div class="ttname"><a href="namespaceFlag__definition.html#adc7ca9d539ba8569c5eaa574de22c08f">Flag_definition::Time_pt</a></div><div class="ttdeci">Time * Time_pt</div><div class="ttdoc">Pointer to the global time object.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00091">turek_flag_non_fsi.cc:91</a></div></div>
</div><!-- fragment --><p> We choose the motion of the flag such that it vaguely resembles that expected in the corresponding FSI problem: We subject the flag's upper and lower faces to purely vertical displacements that deform them into a fraction of a sine wave, while keeping the face at the tip of the flag straight and vertical. We implement this by prescribing the time-dependent motion of the two vertices at the tip of the flag with two functions:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Time-dependent vector to upper tip of the &quot;flag&quot;</span></div>
<div class="line"><span class="comment"></span> Vector&lt;double&gt; <a class="code" href="namespaceFlag__definition.html#a6af3444eee77be503be4aa8c2ef47c13">upper_tip</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">double</span> tmp_ampl=<a class="code" href="namespaceFlag__definition.html#ad0eb269ec983b485aa24a6f2c25d2f5b">Amplitude</a>;</div>
<div class="line">   <span class="keywordflow">if</span> (t&lt;=0.0) tmp_ampl=0.0;</div>
<div class="line">   Vector&lt;double&gt; uppertip(2);</div>
<div class="line">   uppertip[0]= <a class="code" href="namespaceFlag__definition.html#a60f30c718c6c67504b05dca7832be8aa">Centre_x</a>+<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>*sqrt(1.0-<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>*<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>/(4.0*<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>*<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>))+<a class="code" href="namespaceFlag__definition.html#a94553533bee82260731a466182369a9d">L</a>;</div>
<div class="line">   uppertip[1]= <a class="code" href="namespaceFlag__definition.html#a0024007edc2ad0ef647939aa6b06bde7">Centre_y</a>+0.5*<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>-</div>
<div class="line">    tmp_ampl*sin(2.0*MathematicalConstants::Pi*t/<a class="code" href="namespaceFlag__definition.html#a47976a19abd58b9c31671f074ca57285">Period</a>);</div>
<div class="line">   <span class="keywordflow">return</span> uppertip;</div>
<div class="line">  }  </div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Time-dependent vector to bottom tip of the &quot;flag&quot;</span></div>
<div class="line"><span class="comment"></span> Vector&lt;double&gt; <a class="code" href="namespaceFlag__definition.html#a91eabcfac65c509ab3448d82db1eb988">lower_tip</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">double</span> tmp_ampl=<a class="code" href="namespaceFlag__definition.html#ad0eb269ec983b485aa24a6f2c25d2f5b">Amplitude</a>;</div>
<div class="line">   <span class="keywordflow">if</span> (t&lt;=0.0) tmp_ampl=0.0;</div>
<div class="line">   Vector&lt;double&gt; lowertip(2);</div>
<div class="line">   lowertip[0]= <a class="code" href="namespaceFlag__definition.html#a60f30c718c6c67504b05dca7832be8aa">Centre_x</a>+<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>*sqrt(1.0-<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>*<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>/(4.0*<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>*<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>))+<a class="code" href="namespaceFlag__definition.html#a94553533bee82260731a466182369a9d">L</a>;</div>
<div class="line">   lowertip[1]= <a class="code" href="namespaceFlag__definition.html#a0024007edc2ad0ef647939aa6b06bde7">Centre_y</a>-0.5*<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>-</div>
<div class="line">    tmp_ampl*sin(2.0*MathematicalConstants::Pi*t/<a class="code" href="namespaceFlag__definition.html#a47976a19abd58b9c31671f074ca57285">Period</a>);</div>
<div class="line">   <span class="keywordflow">return</span> lowertip;</div>
<div class="line">  } <span class="comment">// end of bottom tip</span></div>
<div class="ttc" id="anamespaceFlag__definition_html_a6af3444eee77be503be4aa8c2ef47c13"><div class="ttname"><a href="namespaceFlag__definition.html#a6af3444eee77be503be4aa8c2ef47c13">Flag_definition::upper_tip</a></div><div class="ttdeci">Vector&lt; double &gt; upper_tip(const double &amp;t)</div><div class="ttdoc">Time-dependent vector to upper tip of the &quot;flag&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00096">turek_flag_non_fsi.cc:96</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_a91eabcfac65c509ab3448d82db1eb988"><div class="ttname"><a href="namespaceFlag__definition.html#a91eabcfac65c509ab3448d82db1eb988">Flag_definition::lower_tip</a></div><div class="ttdeci">Vector&lt; double &gt; lower_tip(const double &amp;t)</div><div class="ttdoc">Time-dependent vector to bottom tip of the &quot;flag&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00108">turek_flag_non_fsi.cc:108</a></div></div>
</div><!-- fragment --><p> This information is then used in three custom-written <code>GeomObject</code> that define the time-dependent shape of the three faces. Here is the one describing the shape of the upper face:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">//-----start_of_top_of_flag--------------------------------------</span><span class="comment"></span></div>
<div class="line"><span class="comment">/// GeomObject that defines the upper boundary of the flag</span></div>
<div class="line"><span class="comment"></span><span class="comment">//---------------------------------------------------------------</span></div>
<div class="line"> <span class="keyword">class </span>TopOfFlag : <span class="keyword">public</span> GeomObject</div>
<div class="line"> {</div>
<div class="line">  </div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Constructor: It&#39;s a 1D object in 2D space </span></div>
<div class="line"><span class="comment"></span>  TopOfFlag() : GeomObject(1,2) {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /// Destructor (empty)</span></div>
<div class="line"><span class="comment"></span>  ~TopOfFlag(){}</div>
<div class="line">  <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Return the position along the top of the flag (xi[0] varies </span></div>
<div class="line"><span class="comment">  /// between 0 and Lx)</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">void</span> position(<span class="keyword">const</span> <span class="keywordtype">unsigned</span>&amp; t,<span class="keyword">const</span> Vector&lt;double&gt; &amp;xi, Vector&lt;double&gt; &amp;r)<span class="keyword"></span></div>
<div class="line"><span class="keyword">   const</span></div>
<div class="line"><span class="keyword">   </span>{</div>
<div class="line">    <span class="comment">// Compute position of fixed point on the cylinder</span></div>
<div class="line">    Vector&lt;double&gt; point_on_circle(2);     </div>
<div class="line">    point_on_circle[0]=<a class="code" href="namespaceFlag__definition.html#a60f30c718c6c67504b05dca7832be8aa">Centre_x</a>+<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>*sqrt(1.0-<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>*<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>/(4.0*<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>*<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>));</div>
<div class="line">    point_on_circle[1]=<a class="code" href="namespaceFlag__definition.html#a0024007edc2ad0ef647939aa6b06bde7">Centre_y</a>+<a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">H</a>/2.0;</div>
<div class="line"> </div>
<div class="line">    r[0] = point_on_circle[0]+xi[0]/<a class="code" href="namespaceFlag__definition.html#a94553533bee82260731a466182369a9d">L</a>*(<a class="code" href="namespaceFlag__definition.html#a6af3444eee77be503be4aa8c2ef47c13">upper_tip</a>(<a class="code" href="namespaceFlag__definition.html#adc7ca9d539ba8569c5eaa574de22c08f">Time_pt</a>-&gt;time(t))[0]-</div>
<div class="line">                                        point_on_circle[0]);</div>
<div class="line">    </div>
<div class="line">    r[1] = point_on_circle[1]+xi[0]/<a class="code" href="namespaceFlag__definition.html#a94553533bee82260731a466182369a9d">L</a>*(<a class="code" href="namespaceFlag__definition.html#a6af3444eee77be503be4aa8c2ef47c13">upper_tip</a>(<a class="code" href="namespaceFlag__definition.html#adc7ca9d539ba8569c5eaa574de22c08f">Time_pt</a>-&gt;time(t))[1]-</div>
<div class="line">                                        point_on_circle[1])+</div>
<div class="line">     1.0/3.0*sin((r[0]-point_on_circle[0])/</div>
<div class="line">                 (<a class="code" href="namespaceFlag__definition.html#a6af3444eee77be503be4aa8c2ef47c13">upper_tip</a>(<a class="code" href="namespaceFlag__definition.html#adc7ca9d539ba8569c5eaa574de22c08f">Time_pt</a>-&gt;time(t))[0]-</div>
<div class="line">                  point_on_circle[0])*MathematicalConstants::Pi)</div>
<div class="line">     *sin(2.0* MathematicalConstants::Pi*<a class="code" href="namespaceFlag__definition.html#adc7ca9d539ba8569c5eaa574de22c08f">Time_pt</a>-&gt;time(t)/<a class="code" href="namespaceFlag__definition.html#a47976a19abd58b9c31671f074ca57285">Period</a>);</div>
<div class="line">    </div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">  <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Current position</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">void</span> position(<span class="keyword">const</span> Vector&lt;double&gt; &amp;xi, Vector&lt;double&gt; &amp;r)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">   </span>{</div>
<div class="line">    <span class="keywordflow">return</span> position(0,xi,r);</div>
<div class="line">   }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  /// Number of geometric Data in GeomObject: None.</span></div>
<div class="line"><span class="comment"></span>  <span class="keywordtype">unsigned</span> ngeom_data()<span class="keyword"> const </span>{<span class="keywordflow">return</span> 0;} </div>
<div class="line">  </div>
<div class="line">};</div>
</div><!-- fragment --><p> [We omit the definition of the other two <code>GeomObjects</code>, <code>BottomOfFlag</code> and <code>TipOfFlag</code> in in the interest of brevity. Their definitions can be found in the <a href="
../../../../demo_drivers/navier_stokes/turek_flag_non_fsi/turek_flag_non_fsi.cc
">source code</a>.] We provide storage for the pointers to the four <code>GeomObjects</code> required for the representation of the flag,</p>
<div class="fragment"><div class="line"> <span class="comment">/// Pointer to GeomObject that bounds the upper edge of the flag</span></div>
<div class="line"> TopOfFlag* <a class="code" href="namespaceFlag__definition.html#af602ebeb0c40d05d00961af07bf3e842">Top_flag_pt</a>=0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to GeomObject that bounds the bottom edge of the flag</span></div>
<div class="line"><span class="comment"></span> BottomOfFlag* <a class="code" href="namespaceFlag__definition.html#adde5e58da47e90ef46e1183188281f2e">Bottom_flag_pt</a>=0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to GeomObject that bounds the tip edge of the flag</span></div>
<div class="line"><span class="comment"></span> TipOfFlag* <a class="code" href="namespaceFlag__definition.html#a17de6efd8447ee9c2bb5a1767084ecef">Tip_flag_pt</a>=0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to GeomObject of type Circle that defines the</span></div>
<div class="line"><span class="comment"> /// central cylinder.</span></div>
<div class="line"><span class="comment"></span> Circle* <a class="code" href="namespaceFlag__definition.html#a87051411606f6aa4518ace9ce66a4189">Cylinder_pt</a>=0;</div>
<div class="ttc" id="anamespaceFlag__definition_html_a17de6efd8447ee9c2bb5a1767084ecef"><div class="ttname"><a href="namespaceFlag__definition.html#a17de6efd8447ee9c2bb5a1767084ecef">Flag_definition::Tip_flag_pt</a></div><div class="ttdeci">TipOfFlag * Tip_flag_pt</div><div class="ttdoc">Pointer to GeomObject that bounds the tip edge of the flag.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00270">turek_flag_non_fsi.cc:270</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_a87051411606f6aa4518ace9ce66a4189"><div class="ttname"><a href="namespaceFlag__definition.html#a87051411606f6aa4518ace9ce66a4189">Flag_definition::Cylinder_pt</a></div><div class="ttdeci">Circle * Cylinder_pt</div><div class="ttdoc">Pointer to GeomObject of type Circle that defines the central cylinder.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00274">turek_flag_non_fsi.cc:274</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_adde5e58da47e90ef46e1183188281f2e"><div class="ttname"><a href="namespaceFlag__definition.html#adde5e58da47e90ef46e1183188281f2e">Flag_definition::Bottom_flag_pt</a></div><div class="ttdeci">BottomOfFlag * Bottom_flag_pt</div><div class="ttdoc">Pointer to GeomObject that bounds the bottom edge of the flag.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00267">turek_flag_non_fsi.cc:267</a></div></div>
<div class="ttc" id="anamespaceFlag__definition_html_af602ebeb0c40d05d00961af07bf3e842"><div class="ttname"><a href="namespaceFlag__definition.html#af602ebeb0c40d05d00961af07bf3e842">Flag_definition::Top_flag_pt</a></div><div class="ttdeci">TopOfFlag * Top_flag_pt</div><div class="ttdoc">Pointer to GeomObject that bounds the upper edge of the flag.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00264">turek_flag_non_fsi.cc:264</a></div></div>
</div><!-- fragment --><p> and provide a setup function that generates the <code>GeomObjects</code> and stores the pointer to the global <code>Time</code> object that will be created by the <code>Problem:</code> </p>
<div class="fragment"><div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Create all GeomObjects needed to define the cylinder and the flag</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceFlag__definition.html#a61a03bffd4a34950ef9892be53c49f89">setup</a>(Time* time_pt)</div>
<div class="line"> {</div>
<div class="line">  <span class="comment">// Assign pointer to global time object</span></div>
<div class="line">  <a class="code" href="namespaceFlag__definition.html#adc7ca9d539ba8569c5eaa574de22c08f">Time_pt</a>=time_pt;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Create GeomObject of type Circle that defines the</span></div>
<div class="line">  <span class="comment">// central cylinder.</span></div>
<div class="line">  <a class="code" href="namespaceFlag__definition.html#a87051411606f6aa4518ace9ce66a4189">Cylinder_pt</a>=<span class="keyword">new</span> Circle(<a class="code" href="namespaceFlag__definition.html#a60f30c718c6c67504b05dca7832be8aa">Centre_x</a>,<a class="code" href="namespaceFlag__definition.html#a0024007edc2ad0ef647939aa6b06bde7">Centre_y</a>,<a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Radius</a>);</div>
<div class="line">  <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Create GeomObject that bounds the upper edge of the flag</span></div>
<div class="line"><span class="comment"></span>  <a class="code" href="namespaceFlag__definition.html#af602ebeb0c40d05d00961af07bf3e842">Top_flag_pt</a>=<span class="keyword">new</span> TopOfFlag;</div>
<div class="line">  <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Create GeomObject that bounds the bottom edge of the flag</span></div>
<div class="line"><span class="comment"></span>  <a class="code" href="namespaceFlag__definition.html#adde5e58da47e90ef46e1183188281f2e">Bottom_flag_pt</a>=<span class="keyword">new</span> BottomOfFlag;</div>
<div class="line">  <span class="comment"></span></div>
<div class="line"><span class="comment">  /// Create GeomObject that bounds the tip edge of the flag</span></div>
<div class="line"><span class="comment"></span>  <a class="code" href="namespaceFlag__definition.html#a17de6efd8447ee9c2bb5a1767084ecef">Tip_flag_pt</a>=<span class="keyword">new</span> TipOfFlag;</div>
<div class="line"> </div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of namespace that specifies the flag</span></div>
<div class="ttc" id="anamespaceFlag__definition_html_a61a03bffd4a34950ef9892be53c49f89"><div class="ttname"><a href="namespaceFlag__definition.html#a61a03bffd4a34950ef9892be53c49f89">Flag_definition::setup</a></div><div class="ttdeci">void setup(Time *time_pt)</div><div class="ttdoc">Create all GeomObjects needed to define the cylinder and the flag.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00277">turek_flag_non_fsi.cc:277</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="mesh"></a>
The mesh</h1>
<p>The figure below shows a sketch of the (unrefined) mesh and the enumeration of its boundaries. Various different implementations of the mesh exist, allowing the user to perform the node-update in response to the motion of the flag by a <code>Domain/MacroElement</code> - based procedure, or by using an algebraic node update. In either case, only the nodes in the elements that are shaded in yellow (or refined elements that are generated from these) participate in the node-update.</p>
<div class="image">
<img src="cylinder_with_flag_mesh.gif" alt=""/>
<div class="caption">
The (unrefined) mesh. Only nodes in the yellow regions participate in the node-update. </div></div>
 <p>The node update strategy is illustrated in the <a href="../figures/turek_flag_non_fsi.avi">animation</a> of the flow field and the mesh motion.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="main"></a>
The driver code</h1>
<p>The driver code has the usual structure for a time-dependent problem: We store the command line arguments, create a <code>DocInfo</code> object, and assign the parameters that specify the dimensions of the channel.</p>
 <div class="fragment"><div class="line"><span class="comment">//======start_of_main==================================================</span></div>
<div class="line"><span class="comment">/// Driver code -- pass a command line argument if you want to run</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// the code in validation mode where it only performs a few steps</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=====================================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="turek__flag__non__fsi_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Store command line arguments</span></div>
<div class="line"> <a class="code" href="namespaceFlag__definition.html#a61a03bffd4a34950ef9892be53c49f89">CommandLineArgs::setup</a>(argc,argv);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set up doc info</span></div>
<div class="line"> DocInfo doc_info; </div>
<div class="line"> doc_info.set_directory(<span class="stringliteral">&quot;RESLT&quot;</span>);</div>
<div class="line"> doc_info.number()=0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Length and height of domain</span></div>
<div class="line"> <span class="keywordtype">double</span> length=25.0;</div>
<div class="line"> <span class="keywordtype">double</span> height=4.1;</div>
<div class="ttc" id="aturek__flag__non__fsi_8cc_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="turek__flag__non__fsi_8cc.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdoc">//////////////////////////////////////////////////////////////////// ////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00576">turek_flag_non_fsi.cc:576</a></div></div>
</div><!-- fragment --><p> We build the problem using a mesh in which the node update is performed by the <code>AlgebraicMesh</code> class. (The driver code also provides the option to use a <code>Domain/MacroElement</code> - based node update &ndash; this option is chosen via suitable #ifdefs; see the <a href="
../../../../demo_drivers/navier_stokes/turek_flag_non_fsi/turek_flag_non_fsi.cc
">source code</a> for details).</p>
<div class="fragment"><div class="line"> <span class="comment">// Create Problem with AlgebraicMesh-based node update</span></div>
<div class="line"> <a class="code" href="classTurekNonFSIProblem.html">TurekNonFSIProblem</a></div>
<div class="line">  &lt;AlgebraicElement&lt;RefineableQCrouzeixRaviartElement&lt;2&gt; &gt; &gt; </div>
<div class="line">  problem(length, height);</div>
<div class="ttc" id="aclassTurekNonFSIProblem_html"><div class="ttname"><a href="classTurekNonFSIProblem.html">TurekNonFSIProblem</a></div><div class="ttdoc">///////////////////////////////////////////////////////////////// ///////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00311">turek_flag_non_fsi.cc:312</a></div></div>
</div><!-- fragment --><p> Next we set up the time-stepping (as usual, fewer timesteps are performed during a validation run which is identified by a non-zero number of command line arguments):</p>
<div class="fragment"><div class="line"><span class="comment">// Number of timesteps per period</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nsteps_per_period=40;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of periods</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nperiod=3; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of timesteps  (reduced for validation)</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nstep=nsteps_per_period*nperiod;</div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::Argc&gt;1)</div>
<div class="line">  {</div>
<div class="line">   nstep=2;</div>
<div class="line">   <span class="comment">// Also reduce the Reynolds number to reduce the mesh refinement</span></div>
<div class="line">   <a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Global_Parameters::Re</a>=10.0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Timestep: </span></div>
<div class="line"> <span class="keywordtype">double</span> dt=<a class="code" href="namespaceFlag__definition.html#a47976a19abd58b9c31671f074ca57285">Flag_definition::Period</a>/double(nsteps_per_period);</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Initialise timestep </span></div>
<div class="line"><span class="comment"></span> problem.initialise_dt(dt);</div>
</div><!-- fragment --><p>We start the simulation with a steady solve, allowing up to three levels of adaptive refinement (fewer if we are performing a validation run):</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Solve adaptively with up to max_adapt rounds of refinement (fewer if </span></div>
<div class="line"> <span class="comment">// run during self-test)</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> max_adapt=3;</div>
<div class="line"> <span class="keywordflow">if</span> (CommandLineArgs::Argc&gt;1)</div>
<div class="line">  {</div>
<div class="line">   max_adapt=1;</div>
<div class="line">  } </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Output intial guess for steady Newton solve</span></div>
<div class="line"><span class="comment"></span> problem.doc_solution(doc_info);</div>
<div class="line"> doc_info.number()++;</div>
</div><!-- fragment --><p> Finally, we enter the proper timestepping loop, allowing one spatial adaptation per timestep and suppressing the re-assignment of initial conditions following an adaptation by setting the parameter <code>first</code> to false. (See the discussion of timestepping with automatic mesh adaptation in <a href="../../../unsteady_heat/two_d_unsteady_heat_adapt/html/index.html">another tutorial</a>.)</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Do steady solve first -- this also sets the history values</span></div>
<div class="line"> <span class="comment">// to those corresponding to an impulsive start from the</span></div>
<div class="line"> <span class="comment">// steady solution</span></div>
<div class="line"> problem.steady_newton_solve(max_adapt);</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Output steady solution = initial condition for subsequent unsteady solve</span></div>
<div class="line"><span class="comment"></span> problem.doc_solution(doc_info);</div>
<div class="line"> doc_info.number()++;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Reduce the max number of adaptations for time-dependent simulation</span></div>
<div class="line"><span class="comment"></span> max_adapt=1;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// We don&#39;t want to re-assign the initial condition after the mesh</span></div>
<div class="line"> <span class="comment">// adaptation</span></div>
<div class="line"> <span class="keywordtype">bool</span> first=<span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Timestepping loop</span></div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> istep=0;istep&lt;nstep;istep++)</div>
<div class="line">  { </div>
<div class="line">   <span class="comment">// Solve the problem</span></div>
<div class="line">   problem.unsteady_newton_solve(dt,max_adapt,first);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Output the solution</span></div>
<div class="line">   problem.doc_solution(doc_info);</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Step number</span></div>
<div class="line">   doc_info.number()++;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">}<span class="comment">//end of main</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="problem"></a>
The Problem class</h1>
<p>The problem class provides an access function to the mesh (note the use of #ifdefs to choose the correct one), and defines the interfaces for the usual member functions, either empty or explained in more detail below.</p>
 <div class="fragment"><div class="line"><span class="comment">//======= start_of_problem_class=====================================</span></div>
<div class="line"><span class="comment">/// Flow around a cylinder with flag</span></div>
<div class="line"><span class="comment"></span><span class="comment">//===================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classTurekNonFSIProblem.html">TurekNonFSIProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor: Pass length and height of domain.</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classTurekNonFSIProblem.html#aacb3214544ef81c2f8b49777457e8be6">TurekNonFSIProblem</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;length, </div>
<div class="line">                         <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;height);</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Update the problem specs after solve (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekNonFSIProblem.html#a161cfe46817a5129dcc33c7ce3a17173">actions_after_newton_solve</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the problem specs before solve (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekNonFSIProblem.html#ae5881b3424aee1ba7b947fff96493d2f">actions_before_newton_solve</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// After adaptation: Unpin pressures and pin redudant pressure dofs.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekNonFSIProblem.html#a88ed5ef8b1be34f5176c29ffec20eedd">actions_after_adapt</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the velocity boundary condition on the flag</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekNonFSIProblem.html#a29725cde9071c3a83792469787ea6c7d">actions_before_implicit_timestep</a>();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef USE_MACRO_ELEMENTS</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function for the specific mesh</span></div>
<div class="line"><span class="comment"></span> RefineableCylinderWithFlagMesh&lt;ELEMENT&gt;* <a class="code" href="classTurekNonFSIProblem.html#a6b9af904a3091d55a61b35c2ce7d7fcb">mesh_pt</a>() </div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">return</span> <span class="keyword">dynamic_cast&lt;</span>RefineableCylinderWithFlagMesh&lt;ELEMENT&gt;*<span class="keyword">&gt;</span></div>
<div class="line">    (Problem::mesh_pt());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function for the specific mesh</span></div>
<div class="line"><span class="comment"></span> RefineableAlgebraicCylinderWithFlagMesh&lt;ELEMENT&gt;* <a class="code" href="classTurekNonFSIProblem.html#a6b9af904a3091d55a61b35c2ce7d7fcb">mesh_pt</a>() </div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">return</span> <span class="keyword">dynamic_cast&lt;</span>RefineableAlgebraicCylinderWithFlagMesh&lt;ELEMENT&gt;*<span class="keyword">&gt;</span></div>
<div class="line">    (Problem::mesh_pt());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc the solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classTurekNonFSIProblem.html#a2f129e4eba71784a58b27d846fdc2a61">doc_solution</a>(DocInfo&amp; doc_info);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Height of channel</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="classTurekNonFSIProblem.html#a7e85e76876a9b1136cc340b0bb25e299">Height</a>;</div>
<div class="line"> </div>
<div class="line">};<span class="comment">//end_of_problem_class</span></div>
<div class="ttc" id="aclassTurekNonFSIProblem_html_a161cfe46817a5129dcc33c7ce3a17173"><div class="ttname"><a href="classTurekNonFSIProblem.html#a161cfe46817a5129dcc33c7ce3a17173">TurekNonFSIProblem::actions_after_newton_solve</a></div><div class="ttdeci">void actions_after_newton_solve()</div><div class="ttdoc">Update the problem specs after solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00321">turek_flag_non_fsi.cc:321</a></div></div>
<div class="ttc" id="aclassTurekNonFSIProblem_html_a29725cde9071c3a83792469787ea6c7d"><div class="ttname"><a href="classTurekNonFSIProblem.html#a29725cde9071c3a83792469787ea6c7d">TurekNonFSIProblem::actions_before_implicit_timestep</a></div><div class="ttdeci">void actions_before_implicit_timestep()</div><div class="ttdoc">Update the velocity boundary condition on the flag.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00520">turek_flag_non_fsi.cc:520</a></div></div>
<div class="ttc" id="aclassTurekNonFSIProblem_html_a2f129e4eba71784a58b27d846fdc2a61"><div class="ttname"><a href="classTurekNonFSIProblem.html#a2f129e4eba71784a58b27d846fdc2a61">TurekNonFSIProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(DocInfo &amp;doc_info)</div><div class="ttdoc">Doc the solution.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00547">turek_flag_non_fsi.cc:547</a></div></div>
<div class="ttc" id="aclassTurekNonFSIProblem_html_a6b9af904a3091d55a61b35c2ce7d7fcb"><div class="ttname"><a href="classTurekNonFSIProblem.html#a6b9af904a3091d55a61b35c2ce7d7fcb">TurekNonFSIProblem::mesh_pt</a></div><div class="ttdeci">RefineableCylinderWithFlagMesh&lt; ELEMENT &gt; * mesh_pt()</div><div class="ttdoc">Access function for the specific mesh.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00336">turek_flag_non_fsi.cc:336</a></div></div>
<div class="ttc" id="aclassTurekNonFSIProblem_html_a7e85e76876a9b1136cc340b0bb25e299"><div class="ttname"><a href="classTurekNonFSIProblem.html#a7e85e76876a9b1136cc340b0bb25e299">TurekNonFSIProblem::Height</a></div><div class="ttdeci">double Height</div><div class="ttdoc">Height of channel.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00360">turek_flag_non_fsi.cc:360</a></div></div>
<div class="ttc" id="aclassTurekNonFSIProblem_html_a88ed5ef8b1be34f5176c29ffec20eedd"><div class="ttname"><a href="classTurekNonFSIProblem.html#a88ed5ef8b1be34f5176c29ffec20eedd">TurekNonFSIProblem::actions_after_adapt</a></div><div class="ttdeci">void actions_after_adapt()</div><div class="ttdoc">After adaptation: Unpin pressures and pin redudant pressure dofs.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00503">turek_flag_non_fsi.cc:503</a></div></div>
<div class="ttc" id="aclassTurekNonFSIProblem_html_aacb3214544ef81c2f8b49777457e8be6"><div class="ttname"><a href="classTurekNonFSIProblem.html#aacb3214544ef81c2f8b49777457e8be6">TurekNonFSIProblem::TurekNonFSIProblem</a></div><div class="ttdeci">TurekNonFSIProblem(const double &amp;length, const double &amp;height)</div><div class="ttdoc">Constructor: Pass length and height of domain.</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00371">turek_flag_non_fsi.cc:371</a></div></div>
<div class="ttc" id="aclassTurekNonFSIProblem_html_ae5881b3424aee1ba7b947fff96493d2f"><div class="ttname"><a href="classTurekNonFSIProblem.html#ae5881b3424aee1ba7b947fff96493d2f">TurekNonFSIProblem::actions_before_newton_solve</a></div><div class="ttdeci">void actions_before_newton_solve()</div><div class="ttdoc">Update the problem specs before solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="turek__flag__non__fsi_8cc_source.html#l00324">turek_flag_non_fsi.cc:324</a></div></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="constructor"></a>
The problem constructor</h1>
<p>The initial assignment of zero velocity and pressure provides a very poor initial guess for the preliminary steady Newton solve. We therefore increase the maximum residuals and iteration counts allowed in the Newton iteration before creating the timestepper and setting up the <code>GeomObjects</code> required to parametrise the flag:</p>
<div class="fragment"><div class="line"><span class="comment">//=====start_of_constructor===============================================</span></div>
<div class="line"><span class="comment">/// Constructor: Pass length and height of domain.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a class="code" href="classTurekNonFSIProblem.html#aacb3214544ef81c2f8b49777457e8be6">TurekNonFSIProblem&lt;ELEMENT&gt;::TurekNonFSIProblem</a>(</div>
<div class="line"> <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;length, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;height) : Height(height)</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Bump up Newton solver parameters to allow for crappy initial guesses</span></div>
<div class="line"> Max_residuals=100.0;;</div>
<div class="line"> Max_newton_iterations=50;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Allocate the timestepper</span></div>
<div class="line"> add_time_stepper_pt(<span class="keyword">new</span> BDF&lt;2&gt;);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup flag/cylinder geometry</span></div>
<div class="line"> <a class="code" href="namespaceFlag__definition.html#a61a03bffd4a34950ef9892be53c49f89">Flag_definition::setup</a>(time_pt());</div>
</div><!-- fragment --><p> Next we build the mesh, passing the pointers to the various <code>GeomObjects</code> and the geometric parameters to its constructor.</p>
<div class="fragment"><div class="line"> <span class="comment">// Build mesh (with AlgebraicMesh-based node update)</span></div>
<div class="line"> Problem::mesh_pt()=<span class="keyword">new</span> RefineableAlgebraicCylinderWithFlagMesh&lt;ELEMENT&gt;</div>
<div class="line">  (<a class="code" href="namespaceFlag__definition.html#a87051411606f6aa4518ace9ce66a4189">Flag_definition::Cylinder_pt</a>,</div>
<div class="line">   <a class="code" href="namespaceFlag__definition.html#af602ebeb0c40d05d00961af07bf3e842">Flag_definition::Top_flag_pt</a>, </div>
<div class="line">   <a class="code" href="namespaceFlag__definition.html#adde5e58da47e90ef46e1183188281f2e">Flag_definition::Bottom_flag_pt</a>, </div>
<div class="line">   <a class="code" href="namespaceFlag__definition.html#a17de6efd8447ee9c2bb5a1767084ecef">Flag_definition::Tip_flag_pt</a>,</div>
<div class="line">   length, height, </div>
<div class="line">   <a class="code" href="namespaceFlag__definition.html#a94553533bee82260731a466182369a9d">Flag_definition::L</a>,</div>
<div class="line">   <a class="code" href="namespaceFlag__definition.html#a6cdf33de1fe6f94832181664d7769af7">Flag_definition::H</a>, </div>
<div class="line">   <a class="code" href="namespaceFlag__definition.html#a60f30c718c6c67504b05dca7832be8aa">Flag_definition::Centre_x</a>,</div>
<div class="line">   <a class="code" href="namespaceFlag__definition.html#a0024007edc2ad0ef647939aa6b06bde7">Flag_definition::Centre_y</a>,</div>
<div class="line">   <a class="code" href="namespaceFlag__definition.html#a921d8bd82b7b267651dea625a548dfcb">Flag_definition::Radius</a>,</div>
<div class="line">   time_stepper_pt());</div>
</div><!-- fragment --><p> We perform two rounds of uniform refinement (the Newton solver does not converge on coarser meshes) before creating an error estimator for the subsequent automatic mesh adaptation.</p>
<div class="fragment"><div class="line"> <span class="comment">// Refine uniformly</span></div>
<div class="line"> mesh_pt()-&gt;refine_uniformly();</div>
<div class="line"> mesh_pt()-&gt;refine_uniformly();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set error estimator</span></div>
<div class="line"> Z2ErrorEstimator* error_estimator_pt=<span class="keyword">new</span> Z2ErrorEstimator;</div>
<div class="line"> mesh_pt()-&gt;spatial_error_estimator_pt()=error_estimator_pt;</div>
</div><!-- fragment --><p> Both velocity components are imposed by Dirichlet conditions (either via a no-slip condition or via the imposed inflow profile) on all boundaries, apart from the outflow cross-section (mesh boundary 1), where the axial velocity is unknown.</p>
<div class="fragment"><div class="line">  </div>
<div class="line"> <span class="comment">// Set the boundary conditions for this problem: All nodes are</span></div>
<div class="line"> <span class="comment">// free by default -- just pin the ones that have Dirichlet conditions</span></div>
<div class="line"> <span class="comment">// here. </span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Pin both velocities at all boundaries apart from outflow</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> num_bound = mesh_pt()-&gt;nboundary();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> ibound=0;ibound&lt;num_bound;ibound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod= mesh_pt()-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Parallel, axially traction free outflow at downstream end</span></div>
<div class="line">     <span class="keywordflow">if</span> (ibound != 1)</div>
<div class="line">      {</div>
<div class="line">       mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;pin(0);</div>
<div class="line">       mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;pin(1);</div>
<div class="line">      }</div>
<div class="line">     <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">       mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;pin(1);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  } <span class="comment">// done bc</span></div>
</div><!-- fragment --><p> Next we complete the build of the elements, passing the relevant pointers to physical parameters,</p>
<div class="fragment"><div class="line">  </div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Pass pointer to Reynolds number to elements</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> nelem=mesh_pt()-&gt;nelement();</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e=0;e&lt;nelem;e++)</div>
<div class="line">   {</div>
<div class="line">    <span class="comment">// Upcast from GeneralisedElement to the present element</span></div>
<div class="line">    ELEMENT* el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(mesh_pt()-&gt;element_pt(e));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//Set the Reynolds number</span></div>
<div class="line">    el_pt-&gt;re_pt() = &amp;<a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Global_Parameters::Re</a>;   </div>
<div class="line">    </div>
<div class="line">    <span class="comment">//Set the Womersley number (assuming St=1)</span></div>
<div class="line">    el_pt-&gt;re_st_pt() = &amp;<a class="code" href="namespaceGlobal__Parameters.html#a9d72e94a9305c6a310940a6a427ebe06">Global_Parameters::Re</a>;</div>
<div class="line">   }</div>
</div><!-- fragment --><p> and impose the steady Poiseuille profile at the inlet (mesh boundary 3).</p>
<div class="fragment"><div class="line">  </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Setup Poiseuille flow along boundary 3</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> ibound=3;</div>
<div class="line">  <span class="keywordtype">unsigned</span> num_nod= mesh_pt()-&gt;nboundary_node(ibound);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">   {</div>
<div class="line">    <span class="keywordtype">double</span> ycoord = mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;x(1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set Poiseuille velocity</span></div>
<div class="line">    <span class="keywordtype">double</span> uy = 6.0*ycoord/Height*(1.0-ycoord/Height);</div>
<div class="line">    </div>
<div class="line">    mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(0,uy);</div>
<div class="line">    mesh_pt()-&gt;boundary_node_pt(ibound,inod)-&gt;set_value(1,0.0);</div>
<div class="line">   }   </div>
</div><!-- fragment --><p> Finally, we pin the redundant pressure degrees of freedom (see <a href="../../../navier_stokes/adaptive_driven_cavity/html/index.html">another tutorial</a> for details), and assign the equations numbers.</p>
<div class="fragment"><div class="line"> </div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Pin redudant pressure dofs</span></div>
<div class="line">  RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">   pin_redundant_nodal_pressures(mesh_pt()-&gt;element_pt());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Assign equations numbers</span></div>
<div class="line">  cout &lt;&lt;<span class="stringliteral">&quot;Number of equations: &quot;</span> &lt;&lt; assign_eqn_numbers() &lt;&lt; endl;  </div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of constructor</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="after_adapt"></a>
Actions before adapt</h1>
<p>After each adaptation, we unpin and re-pin all redundant pressures degrees of freedom (see <a href="../../../navier_stokes/adaptive_driven_cavity/html/index.html">another tutorial</a> for details). Since the inflow profile is parabolic, it is interpolated correctly from "father" to "son" elements during mesh refinement so no further action is required.</p>
<div class="fragment"><div class="line"><span class="comment">//=====actions_after_adapt================================================</span></div>
<div class="line"><span class="comment">/// Actions after adapt</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ELEMENT&gt; </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classTurekNonFSIProblem.html#a88ed5ef8b1be34f5176c29ffec20eedd">TurekNonFSIProblem&lt;ELEMENT&gt;::actions_after_adapt</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Unpin all pressure dofs</span></div>
<div class="line"> RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">  unpin_all_pressure_dofs(mesh_pt()-&gt;element_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin redundant pressure dofs</span></div>
<div class="line"> RefineableNavierStokesEquations&lt;2&gt;::</div>
<div class="line">  pin_redundant_nodal_pressures(mesh_pt()-&gt;element_pt());</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end_of_actions_after_adapt</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="timestep"></a>
Actions before the timestep</h1>
<p>Before each timestep we update the nodal positions in the mesh and re-apply the no-slip condition at the nodes on mesh boundaries 5 - 7.</p>
<div class="fragment"><div class="line"><span class="comment">//==== start_of_actions_before_implicit_timestep==========================</span></div>
<div class="line"><span class="comment">/// Actions before implicit timestep: Update velocity boundary conditions</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ELEMENT&gt; </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classTurekNonFSIProblem.html#a29725cde9071c3a83792469787ea6c7d">TurekNonFSIProblem&lt;ELEMENT&gt;::actions_before_implicit_timestep</a>()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Update the domain shape</span></div>
<div class="line"> mesh_pt()-&gt;node_update();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Moving leaflet: No slip; this implies that the velocity needs</span></div>
<div class="line"> <span class="comment">// to be updated in response to flag motion</span></div>
<div class="line"> <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> ibound=5;ibound&lt;8;ibound++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> num_nod=mesh_pt()-&gt;nboundary_node(ibound);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> inod=0;inod&lt;num_nod;inod++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Which node are we dealing with?</span></div>
<div class="line">     Node* node_pt=mesh_pt()-&gt;boundary_node_pt(ibound,inod);</div>
<div class="line">     </div>
<div class="line">     <span class="comment">// Apply no slip</span></div>
<div class="line">     FSI_functions::apply_no_slip_on_moving_wall(node_pt);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">//end_of_actions_before_implicit_timestep</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="doc"></a>
Post Processing</h1>
<p>The function doc_solution(...) documents the results.</p>
<div class="fragment"><div class="line"><span class="comment">//==start_of_doc_solution=================================================</span></div>
<div class="line"><span class="comment">/// Doc the solution</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classTurekNonFSIProblem.html#a2f129e4eba71784a58b27d846fdc2a61">TurekNonFSIProblem&lt;ELEMENT&gt;::doc_solution</a>(DocInfo&amp; doc_info)</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> ofstream some_file;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of plot points</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> npts;</div>
<div class="line"> npts=5; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output solution </span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> mesh_pt()-&gt;output(some_file,npts);</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end_of_doc_solution</span></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="ex_com"></a>
Comments and Exercises</h1>
<ul>
<li>Compare the results obtained when the node update is performed with the algebraic or the <code>MacroElement/Domain-based</code> node update. (<code>oomph-lib's</code> build machinery will automatically generate both versions of the code, using the <code>-DUSE_MACRO_ELEMENTS</code> compilation flag).</li>
</ul>
<hr  />
 <hr  />
<h1><a class="anchor" id="ackn"></a>
Acknowledgements</h1>
<ul>
<li>This code was originally developed by Stefan Kollmannsberger and his students Iason Papaioannou and <br  />
 Orkun Oezkan Doenmez. It was completed by Floraine Cordier.</li>
</ul>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory:<br  />
<br  />
<center> <a href="
../../../../
demo_drivers/navier_stokes/turek_flag_non_fsi/
">demo_drivers/navier_stokes/turek_flag_non_fsi/ </a> </center><br  />
</li>
<li>The driver code is: <br  />
<br  />
<center> <a href="
../../../../
demo_drivers/navier_stokes/turek_flag_non_fsi/turek_flag_non_fsi.cc
">demo_drivers/navier_stokes/turek_flag_non_fsi/turek_flag_non_fsi.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:21:41
        </div>
      </div>
    </footer>
</body>
</html>
