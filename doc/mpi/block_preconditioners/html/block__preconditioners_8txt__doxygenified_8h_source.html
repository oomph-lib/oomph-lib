<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: block_preconditioners.txt_doxygenified.h Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get it <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/subversion/html/index.html">Get code from subversion repository</a></li>
            <li><a href="../../../../doc/download/html/index.html">Get code as tar file</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">block_preconditioners.txt_doxygenified.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="block__preconditioners_8txt__doxygenified_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">\mainpage oomph-lib&#39;s Block Preconditioning Framework</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">   </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">\c oomph-lib&#39;s block preconditioning framework</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">provides an environment for the development of block </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">preconditioners for the iterative solution of linear systems</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">by Krylov subspace methods. The framework is based on the</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">classification of the problem&#39;s unknowns (degrees of freedom; here</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">abbreviated as dofs)</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">into different &quot;dof types&quot; which, in a multi-physics context, </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">typically represent different physical quantities. A key feature of</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">the framework is that</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">it allows existing block preconditioners (which were developed for a particular</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">single-physics application, say) to be re-used, in a hierarchical </span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">fashion, in block preconditioners for related</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">multi-physics problems. This means that existing Navier-Stokes</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">and solid mechanics preconditioners can be used to create</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">preconditioners for fluid-structure interaction problems, say. </span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">Following a brief overview of the underlying</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">ideas and their implementation in \c oomph-lib this tutorial discusses </span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">a sequence of increasingly complex block preconditioners that illustrate the</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">framework&#39;s capabilities in the context of a (rather artificial) model</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">problem. The final example illustrates a simple implementation of</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">a block preconditioner for an FSI problem. We conclude with a few </span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">comments on the use of block preconditioners in parallel. </span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">Other tutorials discuss how the methodology is used in &quot;real&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">preconditioners. See, for instance, the tutorials discussing</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">- \c oomph-lib&#39;s </span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">  &lt;a href=&quot;../../distributed_general_purpose_block_preconditioners/html/index.html&quot;&gt;&quot;general purpose&quot; </span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">  block preconditioners.&lt;/a&gt; \n\n</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">- The &lt;a href=&quot;../../../preconditioners/lsc_navier_stokes/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">  NavierStokesSchurComplementPreconditioner for Navier-Stokes problems</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">  &lt;/a&gt; \n\n</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">- The &lt;a href=&quot;../../../preconditioners/fsi/html/index.html&quot;&gt; FSIPreconditioner</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">  for monolithically-discretised fluid-structure interaction problems.&lt;/a&gt;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">  \n\n</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">- The </span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">  &lt;a href=&quot;../../../preconditioners/prescribed_displ_lagr_mult/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">  preconditioner for large-displacement solid mechanics problems </span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">  in which boundary displacements are prescribed.&lt;/a&gt;\n\n</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">- The previous preconditioner is mainly used as a subsidiary</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">  block preconditioner for the </span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">  &lt;a href=&quot;../../../preconditioners/pseudo_solid_fsi/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">  solution of fluid-structure interaction problems with (pseudo-)solid </span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">  fluid mesh updates.&lt;/a&gt; \n\n</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">\section theory Theoretical background</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">In \c oomph-lib, all problems are solved by Newton&#39;s method,</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">which requires the repeated solution of linear systems of the form</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">{\bf J}\;{\bf \delta x}=-{\bf r}</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">for the Newton correction \f$\bf \delta x\f$ where \f${\bf J}\f$ is the</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">Jacobian matrix and \f$\bf r\f$ is the vector of residuals. (Left) </span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">preconditioning represents a transformation of the original linear system to</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">{\bf P}^{-1}{\bf J}\;{\bf \delta x}=-{\bf P}^{-1}{\bf r},</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">introduced with the aim of accelerating the convergence of Krylov subspace </span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">solvers such as GMRES or CG. The application of the preconditioner </span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">requires the solution of</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">{\bf P}{\bf z}={\bf y}</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">for \f$\bf z\f$ at each Krylov iteration.</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">Block preconditioners are based (at least formally) on a</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">reordering of the linear system such that related unknowns</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">(e.g. dofs representing the same physical quantity)</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">are grouped together and enumerated consecutively. </span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">For instance, in linear elasticity problems (discussed in </span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">&lt;a href=&quot;../../../linear_elasticity/periodic_load/html/index.html&quot;&gt;another</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">tutorial&lt;/A&gt;) where we compute the displacement field of an elastic</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">body in response to an applied traction, the (discrete) unknowns</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">can be sub-divided according to which component of the displacement</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">vector they represent. Using this classification of the dofs, </span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">the re-ordered linear system for a two-dimensional problem then has the form</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">\left[ </span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">{\bf J}_{xx}&amp;{\bf J}_{xy}\\</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">{\bf J}_{xy}&amp;{\bf J}_{yy}</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">\left[ </span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">\bf \delta x_x\\</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">\bf \delta x_y\\</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">-</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">\bf r_x\\</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">\bf r_y\\</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">A simple (and, in fact, quite effective) block preconditioner for this</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">linear system can be formed by retaining only the diagonal blocks</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">of the system matrix, leading to the block diagonal preconditioner </span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">{\bf P}_{diag}=</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">{\bf J}_{xx}&amp; \\</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">      &amp;{\bf J}_{yy}</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">The application of this preconditioner requires the solution of </span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">the linear system</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">{\bf J}_{xx}&amp; \\</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">      &amp;{\bf J}_{yy}</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">{\bf z_x}\\</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">\bf z_y\\</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">\bf y_x\\</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">\bf y_y</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">\right],</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">which requires the (exact or approximate) solution of the two </span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">smaller linear systems \f$ {\bf J}_{xx} \ {\bf z_x} = {\bf y_x}\f$</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">and \f$ {\bf J}_{yy} \ {\bf z_y} = {\bf y_y}\f$.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">\section generic_implementation Overview</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">The above example shows that the application of block preconditioners</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">typically require several generic steps:</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">-# The classification of the dofs.</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">-# The application of subsidiary preconditioning operations such as </span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">   the solution of (smaller) linear systems or the evaluation of matrix-vector </span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">   products with some of the blocks that are extracted from the</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">   original linear system.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">   </span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">The following subsections describe how these tasks are performed</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">within \c oomph-lib&#39;s block preconditioning framework.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">\subsection block_preconditionable_elements The classification of dof types via block preconditionable elements</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">The classification of dofs is specified by the elements since they are</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">the only objects within \c oomph-lib&#39;s data structure </span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">that &quot;know&quot; what role a specific dof plays in &quot;their&quot; equations. </span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">During the setup phase, the block preconditioner loops over &quot;all</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">elements&quot; (specified via one or more \c Meshes -- here simply used as </span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">containers for elements; see below for further details) to establish the </span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">&quot;dof type&quot; for each global unknown.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">To achieve this, the class \c GeneralisedElement </span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">contains two broken virtual methods that must be re-implemented/overloaded to</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">label each of the element&#39;s dofs with its type. These methods are:</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">- \c GeneralisedElement::ndof_types() must return the number of dof types</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">  associated with an element.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">- \c GeneralisedElement::get_dof_numbers_for_unknowns(...) must return</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">  a list of pairs comprising a map from global equation number to </span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">  dof type for all unknowns in the element.</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">These are already implemented for many elements. If not, the functions</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">are easy to write. For instance, \c oomph-lib&#39;s &lt;c&gt;DIM&lt;/c&gt;-dimensional </span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">linear elasticity elements from the \c QLinearElasticityElement family</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">can be made block-preconditionable by using the following</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">wrapper class:</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">\dontinclude two_d_linear_elasticity_with_simple_block_diagonal_preconditioner.cc</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">\skipline  start_of_mylinearelasticityelement</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">\until };</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">Thus, in the two-dimensional \c MyLinearElasticityElement&lt;2&gt; we </span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">have two types of dofs, corresponding to the displacements in the </span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">\f$x\f$ and \f$ y \f$ directions, respectively. They are enumerated </span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">as dof types 0 and 1, respectively.</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">\subsection dof_types_and_block_types dof types, blocks, compound blocks and meshes</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">In the block diagonal preconditioner for the two-dimensional linear</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">elasticity problem, discussed above, we have dof types that </span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">correspond directly to</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">the blocks in the (re-ordered) Jacobian matrix. However, as we will</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">demonstrate &lt;a href=&quot;#compound&quot;&gt;below&lt;/a&gt;, it is also </span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">possible to combine the blocks associated with multiple dofs into a</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">single (compound) block in which case the number of blocks is smaller than the</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">number of dof types. The relationship between dof types, block types, </span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">the elemental dof type classification and meshes are as follows</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">- \b Elemental \b dof \b type \b classification: Each element</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">  classifies its own dof types in the function </span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">  \c get_dof_numbers_for_unknowns(...). In the case of the two-dimensional</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">  \c MyLinearElasticityElement&lt;2&gt; elements, the dof types are classified</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">  as \c 0 and \c 1; for two-dimensional \c QTaylorHoodElement&lt;2&gt; </span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">  Navier-Stokes </span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">  elements, the dof types</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">  are classified as \c 0 and \c 1 for the \f$ x \f$ and \f$y</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">  \f$-velocities, and \c 2 for the pressure \f$ p \f$; etc.</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">  \n\n</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">- \b Role \b of \b meshes: When classifying the degrees of freedom into</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">  dof types, the block preconditioning framework</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">  visits all elements that make contributions to the Jacobian matrix</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">  and associates the global equation number of each dof with the dof type</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">  specified by the element. The block preconditioning framework is</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">  given access to the elements via (possibly multiple) meshes (here</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">  simply interpreted as containers for elements), each of </span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">  which is assumed to contain elements of a single type. The total</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">  number of dof types in the block preconditioner is the</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">  sum of the dof types of the elements in the meshes. For</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">  instance, in a 2D fluid-structure interaction problem we have two</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">  different element types, the solid elements (which contain the</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">  \f$ x \f$ and \f$ y\f$ solid displacements, \f$ u_x \f$ and \f$</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">  u_y \f$, respectively, assumed to be </span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">  enumerated as dof types</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">  0 and 1 by these elements) and the fluid elements (which contain the</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">  \f$ x \f$- and \f$ y \f$ - fluid velocities, \f$ v_x \f$ and \f$ v_y</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">  \f$ ,  and the pressure, \f$ p \f$, assumed to </span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">  be enumerated as dof types</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">  0, 1 and 2 by these elements). Assuming the mesh of solid elements</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">  is specified as mesh 0 and the mesh of fluid elements is mesh 1, the</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">  block preconditioner has a total of five dof types which represent,</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">  in order, \f$ u_x, u_y, v_x, v_y, p\f$. Note that if certain degrees of</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">  freedom are classified by multiple elements, the most recent</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">  assignment of the dof type over-writes previous assignments.</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">  The order in which meshes are specified therefore matters. </span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">  \n</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">  A corollary to this is that a block preconditioner does not</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">  need to &quot;know&quot; about elements that do not introduce any new </span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">  unknowns. For instance, \c FaceElements that apply Neumann/flux </span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">  boundary conditions operate on dofs that are already</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">  contained in (and therefore classified by) the elements in the </span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">  &quot;bulk&quot; mesh. Conversely, if a \c FaceElement</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">  imposes a boundary condition via Lagrange-multipliers, the dofs</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">  that represent these Lagrange multipliers must be</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">  classified by the \c FaceElements since the &quot;bulk elements&quot; are not</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">  aware of them. </span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">  \n</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">  If \c oomph-lib is compiled with the \c PARANOID flag, </span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">  an error is thrown if any of the global unknowns are not associated</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">  with a dof type.\n\n</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">- \b Blocks: The blocks are the sub-blocks of the system matrix</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">  (usually the Jacobian matrix from the Newton method) that the block</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">  preconditioner works with. By default, each block is associated with</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">  exactly one dof type. However, it is possible create &quot;compound blocks&quot; that </span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">  are associated with more than one dof type. For example, in the </span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">  Navier-Stokes LSC preconditioner (in 2D) we have three dof </span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">  types (the \f$x\f$ and</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">  \f$y\f$-velocities and the pressure), but the preconditioner works with </span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">  just two block types (forming the velocity and pressure blocks). The setup</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">  of the block types is handled by the function \c block_setup(...) discussed</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">  below.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">\section multi_poisson Simple preconditioner examples</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">We will now illustrate the capabilities of the block preconditioning</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">framework by considering the system of \f$ N \f$ coupled PDEs </span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">\f[ </span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">\left( \frac{\partial^2 u_i}{\partial x_j^2} </span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">+ \beta \sum_{k=1}^{N} u_k \right)  = f_i(x_j) \ \ \ \ i=1,...,N</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">\ \ \ \ \ \ \ \ \ \ \ \ (1)</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">for the  \f$ N \f$ fields  \f$ u_i(x_j) \f$. If  \f$ \beta=0 \f$,</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">the system represents  \f$ N \f$ (uncoupled) Poisson equations,</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">each with their own source function  \f$ f_i(x_j). \f$ If  \f$ \beta</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">\ne 0 \f$ the PDE for \f$ u_i(x_j) \f$ is affected by all other</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">fields via the Helmholtz-like second term on the left-hand-side.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">The \c MultiPoissonElements discretise the equations </span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">with standard Galerkin-type finite elements in which each field</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">is treated as its own dof type. If  \f$ N = 5, \f$ the linear system </span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">to be solved in the course of the Newton method,</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">{\bf J} \ \delta {\bf x} = -{\bf r},</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">(2)</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">has a \f$5 \times 5\f$  block structure implying that, following a</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">formal re-numbering</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">of the unknowns, the matrix and the vectors can be written as</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">{\bf J} = </span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">\begin{array}{ccccc}</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">J_{11} &amp; J_{12} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">J_{21} &amp; J_{22} &amp; J_{23} &amp; J_{24} &amp; J_{25} \\</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">J_{31} &amp; J_{32} &amp; J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">J_{41} &amp; J_{42} &amp; J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">J_{51} &amp; J_{52} &amp; J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">\right),</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"> \ \</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">\delta {\bf x} = </span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">\delta x_{1}  \\</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">\delta x_{2}  \\</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">\delta x_{3}  \\</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">\delta x_{4}  \\</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">\delta x_{5}  \\</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"> \ \mbox{ and } \ </span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">{\bf r} = </span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">r_{1}  \\</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">r_{2}  \\</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">r_{3}  \\</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">r_{4}  \\</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">r_{5}  \\</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">(3)</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">We wish to solve this linear system by preconditioned Krylov subspace methods,</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">using a block preconditioner \f${\bf P}\f$ formed (formally) </span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">from the blocks of the system matrix \f${\bf }J\f$. As</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">discussed above, the</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">application of the preconditioner (typically once per iteration of the</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">Krylov solver) then requires the solution of linear systems of the form</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">\f$</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">{\bf P} {\bf y} = {\bf z},</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">\f$ </span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">for \f${\bf y}\f$. The preconditioning operation can also be written as</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">\f$</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">{\bf y} = {\bf P}^{-1} {\bf z}</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">\f$ </span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">where the operator \f${\bf P}^{-1}\f$ represents </span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">the application of the preconditioner to a vector \f${\bf z}\f$. </span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">Formally, the operator \f${\bf P}^{-1}\f$ represents the inverse of </span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">the matrix \f${\bf P}\f$ but its application may, of course, be performed  </span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">approximately by another ``subsidiary&#39;&#39; preconditioner/inexact solver</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">e.g. by performing a small number of multigrid cycles, say.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">(Note that we say ``formally&#39;&#39; because the preconditioner does not</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">actually have to be associated with a specific matrix -- it simply has</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">to act as a linear operator that ``turns \f${\bf z}\f$ into \f${\bf y}\f$&#39;&#39;).</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">A specific block preconditioner must be derived from the</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">\c BlockPreconditioner base class and must implement two </span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">pure virtual member functions of the underlying \c Preconditioner</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">class:</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">- \c void \c Preconditioner::setup(): This function is</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">called once during the solution of a given linear system</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">by any of \c oomph-lib &#39;s Krylov subspace solvers. It typically </span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">extracts a  certain number of blocks from the matrix \f${\bf J}\f$, possibly </span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">manipulates its local copies of these blocks, and performs any </span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">preliminary computations required </span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">to allow the rapid subsequent application of \f${\bf P}^{-1}\f$.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">- \c void \c Preconditioner::preconditioner_solve(\f$\bf{z}\f$,\f$\bf{y}\f$):</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">This function applies \f${\bf P}^{-1}\f$ to the input argument</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">\f${\bf z}\f$ and computes \f${\bf y}\f$, typically using some data that has</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">been pre-computed in the \c setup() function.</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">To allow a block preconditioner to classify all dofs, the</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">preconditioner must be given access to all elements that contribute </span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">to the linear system to be solved. This is done by specifying pointers to these</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">elements via one or more \c Mesh objects (which simply act as</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">containers for the element pointers), using the functions \c set_nmesh(...)</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">(which specifies how many meshes the preconditioner works with) and</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">\c set_mesh(...).</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">We will discuss the implementation of the required functions (and associated</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">capabilities of the block preconditioning framework)</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">in a number of increasingly complex block preconditioners</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">for the solution of the \f$5 \times 5\f$ linear system </span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">defined by equations (2) and</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">(3). We stress that the purpose</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">of this exercise is not the development of particularly clever</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">preconditioners but simply an excuse to demonstrate the use of the</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">available ``machinery&#39;&#39;. Specifically we will demonstrate how to:</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">- extract selected blocks from the system matrix (usually the Jacobian</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">  matrix assembled by the Newton solver).</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">- perform matrix vector products with selected off-diagonal blocks.</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">- solve linear systems associated with selected blocks, using either a</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">  direct solver and/or subsidiary preconditioners (inexact solvers), </span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">  including cases where the</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">  subsidiary preconditioners are block preconditioners themselves.</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">- replace and modify selected blocks and how to make such</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">  modified blocks available to subsidiary block preconditioners.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">- concatenate and coarsen blocks.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">\subsection diagonal A block diagonal preconditioner</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">NEW FEATURES: How to extract matrix blocks and corresponding block vectors</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">from their full-size counterparts</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">\subsubsection diag_theory Theory</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">The simplest possible block preconditioner is a block-diagonal </span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">preconditioner, formed by retaining only the diagonal blocks of</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">\f${\bf J}\f$, so that</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">{\bf P} = </span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">\begin{array}{ccccc}</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">J_{11} &amp; &amp; &amp; &amp; \\</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">&amp; J_{22} &amp;  &amp;  &amp; \\</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; &amp; \\</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment"> &amp; &amp; &amp; J_{44} &amp; \\</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment"> &amp;  &amp; &amp;  &amp; J_{55} \\</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">(4)</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">The application of this preconditioner (i.e. the solution of the</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">linear system \f${\bf P} {\bf</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">  y} ={\bf z}\f$ for \f${\bf y}\f$) requires the solution of the </span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">five much smaller linear systems</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">{\bf J}_{11} \ {\bf y}_1 = {\bf z}_1, \\</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">{\bf J}_{22} \ {\bf y}_2 = {\bf z}_2, \\</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">{\bf J}_{33} \ {\bf y}_3 = {\bf z}_3, \\</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">{\bf J}_{44} \ {\bf y}_4 = {\bf z}_4, \\</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">{\bf J}_{55} \ {\bf y}_5 = {\bf z}_5, \\</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">(5)</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">where we have assumed that the two vectors \f${\bf y}\f$ and \f${\bf z}\f$</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">are re-ordered into ``block vectors&#39;&#39; in the same way as </span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">the vectors \f$\delta {\bf x}\f$ and \f${\bf r}\f$ in </span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">&quot;the original linear system&quot; (2) are re-ordered into</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">the ``block vectors&#39;&#39; in (3).</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">The implementation of the preconditioning operations in </span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">(5)  can naturally be subdivided into two</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">distinct \c setup() and \c preconditioner\_solve(...) phases.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">Assuming that the linear systems in (5) are solved exactly </span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">by a direct solver (an ``exact preconditioner&#39;&#39;) that </span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">can pre-compute and store the LU decomposition of the diagonal matrix blocks,</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">the \c setup() phase involves the following operations</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">[text in square brackets refers to their \c oomph-lib -specific </span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">implementation]:</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">- Set up any data structures/lookup tables that are required to </span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">extract matrix blocks from the original matrix</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">\f${\bf J}\f$ [by calling</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">the \c BlockPreconditioner::block\_setup() function]. </span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">- Extract the five diagonal blocks \f${\bf J}_{ii}\f$ </span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">(for \f$i=1,...,5\f$) [using the </span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">\c BlockPreconditioner::get\_block(...) function].</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">- Compute and store the LU decomposition of the diagonal blocks</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">to allow the rapid solution of the systems \f${\bf J}_{ii} \ {\bf y}_i = </span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">{\bf z}_i\f$ (for \f$i=1,...,5\f$) during the \c preconditioner\_solve(...)</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">phase by back-substitution. [This is done by calling the \c setup(...)</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">function of the subsidiary preconditioner/inexact solver. Following this,</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">the diagonal matrix blocks are longer required and can be deleted.]</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">Once the \c setup() phase has been completed, the solution of the linear</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">system \f${\bf P} {\bf y} = {\bf z}\f$ by the \c preconditioner\_solve(...) </span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">function involves the following steps:</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">- Extract the five ``block vectors&#39;&#39; \f${\bf z}_i\f$ (for \f$i=1,...,5\f$)</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">from the vector \f${\bf z}\f$ [using the </span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">\c BlockPreconditioner::get\_block\_vectors(...) function].</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">- Solve the linear systems \f${\bf J}_{ii} \ {\bf y}_i = </span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">{\bf z}_i\f$ for the vectors \f${\bf y}_i\f$ (for \f$i=1,...,5\f$)  using </span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">the precomputed LU decomposition of the diagonal blocks \f${\bf J}_{ii}\f$ </span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">(for \f$i=1,...,5\f$) created during the \c setup() phase.</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">- Combine the five ``block vectors&#39;&#39; \f${\bf y}_i\f$ (for \f$i=1,...,5\f$)</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">to the full-length vector \f${\bf y}\f$ [using the </span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">\c BlockPreconditioner::return\_block\_vectors(...) function].</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">\subsubsection diag_implementation Implementation as a BlockPreconditioner</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">Here is a sample implementation of the diagonal block preconditioner</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">as a class \c Diagonal, derived from the \c BlockPreconditioner base </span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">class. The class provides storage for the subsidiary preconditioners</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">that solve the linear systems associated with the diagonal blocks, </span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">implements the \c setup() and \c preconditioner\_solve(...)</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">functions, and provides a helper function \c clean\_up\_my\_memory()</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">which does what it says. We also provide an access function</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">which allows the user to specify the pointer to the \c Mesh that</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">contains the \c MultiPoissonElements which classify the dofs.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">\dontinclude multi_poisson_block_preconditioners.h</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">\skipline start_of_diagonal_class</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">\until };</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">\subsubsection diag_setup The setup() function</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">As mentioned above, a \c Preconditioner&#39;s \c setup() function is</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">called at the beginning of the \c IterativeLinearSolver&#39;s </span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">\c solve(...) function. In time-dependent and/or nonlinear</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">problems many (different) linear systems have to be solved by the same</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">linear solver (and the associated preconditioner) throughout the code </span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">execution. To avoid memory leaks it is therefore </span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">important to free up any memory that may have been allocated in any</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">previous use of the preconditioner. The \c setup() function of </span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">all block preconditioner should therefore always </span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">start by freeing up such memory. This is best done by using a helper</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">function that can also be called from the destructor. </span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">\skip start_of_setup_for_simple</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">\until this-&gt;clean_up_my_memory();</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">Next we set the pointer to the preconditioner&#39;s one-and-only mesh,</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">and call the \c block_setup() function to set up the internal data</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">structures and lookup tables required to extract blocks from the</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">system matrix.</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">\until this-&gt;block_setup();</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">We create five subsidiary preconditioners (all exact solvers -- SuperLU</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">in its incarnation as an &quot;exact&quot; preconditioner) for the solution of the</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">linear systems involving the diagonal blocks:</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">Next we set up the subsidiary preconditioner by</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">extracting the diagonal blocks from the system matrix</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">and passing them to the subsidiary preconditioners. </span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">Note that each preconditioner is expected to retain a copy</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">of whatever data it needs to subsequently perform its </span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">\c preconditioner_solve(...)</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">function. The deep copy of the block that is returned by the</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">\c get\_block(...) function can therefore be deleted (here simply</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">go out of scope) once the subsidiary preconditioner has been set up.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">(In the specific case of the \c SuperLUPreconditioner, the \c setup(...)</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">function computes and stores the LU decomposition of the matrix;</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">the matrix itself is then no longer required). </span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">\subsubsection diag_solve The preconditioner_solve() function</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">To apply the preconditioner to a given vector, r, we first</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">extract the five block-vectors whose sizes (and permutations) match</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">that of the diagonal matrix blocks, using the</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">\c get_block_vectors(...) function.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">\skip //======</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">\until this-&gt;get_block</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">We then provide storage for the five solution vectors and compute them</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">by applying the subsidiary preconditioners&#39; \c</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">preconditioner_solve(...) function:</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">Finally the solutions in \c block_z are returned into the </span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">full-length solution vector \c z via a call to </span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">\c return_block_vectors(...). </span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">\subsubsection diag_clean The clean_up_my_memory() function</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">This function (which is called by the \c setup()</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">function and the destructor) frees the memory that is</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">allocated when a new linear system is solved -- here the</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">subsidiary preconditioners and their associated data (the</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">LU decompositions of the diagonal blocks).</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">\until // End of clean_up_my_memory function.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">\subsubsection diag_comments Comments and Exercises</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">- \c The function \c get_block_vectors(r,block_r) extracts the five</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">  (or, in general, \c nblock_type() ) block vectors \c block_r from the</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">  full-length vector \c r. The sizes of the block vectors (and the </span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">  permutation of their entries relative</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">  to their order in the full length vector \c r) match that of the</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">  matrix blocks. There is an alternative function \c get_block_vector(...)</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">  (note the missing s) which extracts a single block vector.</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">  An equivalent version exists for the \c return_block_vector[s]</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">  functions. </span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">- In the example above we used an &quot;exact preconditioner&quot; (direct solver)</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">  to solve the five linear systems associated with the diagonal blocks.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">  However, the (approximate) solution of these linear systems can </span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">  be performed by any other matrix-based preconditioner, such as </span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">  \c oomph-lib&#39;s diagonal preconditioner, \c</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">  MatrixBasedDiagPreconditioner, discussed in </span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">  &lt;a href=&quot;../../../linear_solvers/html/index.html&quot;&gt;another tutorial&lt;/a&gt;.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">  The setup and application of this</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">  preconditioner is obviously much faster than for the \c</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">  SuperLUPreconditioner. Its setup merely requires the extraction of the </span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">  diagonal  entries and storage of their inverses (rather than the</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">  computation of the LU decomposition), while the application </span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">  simply requires the multiplication of the input vector by the </span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">  pre-computed inverses of the diagonal entries (rather than a</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">  back-substitution). However, the preconditioner is clearly not</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">  &quot;as good&quot; and therefore results in a larger number of iterations</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">  in the iterative linear solver. In fact, using the diagonal preconditioner</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">  for the approximate solution of the five linear systems involving the</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">  diagonal blocks is mathematically equivalent to using the</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">  diagonal preconditioner on the entire matrix. Try it out! </span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">\subsection upper_triangular A block upper triangular preconditioner</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">NEW FEATURES: How to set up matrix vector products with off-diagonal blocks</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">\subsubsection upper_triangular_theory Theory</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">Next we consider the implementation of an upper triangular</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">preconditioner, formed by retaining only the blocks in the upper right</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">hand part of \f${\bf J}\f$, including the diagonals.</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">{\bf P} = </span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">\begin{array}{ccccc}</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">J_{11} &amp; J_{12} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">&amp; J_{22} &amp;  J_{23} &amp;  J_{24} &amp; J_{25} \\</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment"> &amp; &amp; &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment"> &amp;  &amp; &amp;  &amp; J_{55} \\</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">(6)</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">The application of this preconditioner (i.e. the solution of the</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">linear system \f${\bf P} {\bf</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">  y} ={\bf z}\f$ for \f${\bf y}\f$) again requires the solution of </span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">five much smaller linear systems</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">\begin{array}{l}</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">{\bf J}_{11} \ {\bf y}_1 = \widetilde{\bf z}_1 = {\bf z}_1 - {\bf J}_{15} \ {\bf y}_5 - {\bf J}_{14} \ {\bf y}_4 - {\bf J}_{13} \ {\bf y}_3 - {\bf J}_{12} \ {\bf y}_2, \\</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">{\bf J}_{22} \ {\bf y}_2 = \widetilde{\bf z}_2 = {\bf z}_2 - {\bf J}_{25} \ {\bf y}_5 - {\bf J}_{24} \ {\bf y}_4 - {\bf J}_{23} \ {\bf y}_3, \\</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">{\bf J}_{33} \ {\bf y}_3 = \widetilde{\bf z}_3 ={\bf z}_3 - {\bf J}_{35} \ {\bf y}_5 - {\bf J}_{34} \ {\bf y}_4, \\</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">{\bf J}_{44} \ {\bf y}_4 = \widetilde{\bf z}_4 ={\bf z}_4 - {\bf J}_{45} \ {\bf y}_5, \\</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">{\bf J}_{55} \ {\bf y}_5 = \widetilde{\bf z}_5 = {\bf z}_5, \\</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">(7)</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">where we have again assumed that the two vectors </span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">\f${\bf y}\f$ and \f${\bf z}\f$</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">are re-ordered into ``block vectors&#39;&#39; in the same way as </span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">the vectors \f$\delta {\bf x}\f$ and \f${\bf r}\f$ in </span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">&quot;the original linear system&quot; (2) are re-ordered into</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">the ``block vectors&#39;&#39; in (3).</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">The main difference to the block diagonal preconditioner considered</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">before is that the right hand sides of the linear systems have to be</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">modified. We start by solving the final equation for \f$ {\bf y}_5</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">\f$. We then multiply this vector by the off-diagonal block \f$ {\bf J}_{45}</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">\f$, subtract the result from \f$ {\bf z}_4 \f$ and use the result of</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">this operation as the right-hand-side for the linear system that determines</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">\f$ {\bf y}_4\f$,  etc.</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">The implementation of the preconditioning operations in </span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">(7)  can again be subdivided into two</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">distinct \c setup() and \c preconditioner\_solve(...) phases.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">Assuming that the linear systems in (7)</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">are solved exactly by a direct solver (an ``exact preconditioner&#39;&#39;)</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">that can pre-compute and store the LU decomposition of the diagonal</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">matrix blocks, the \c setup() phase involves the following operations</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">[text in square brackets refers to their \c oomph-lib specific </span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">implementation]:</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">- Set up any data structures/lookup tables that are required to </span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">extract matrix blocks from the original matrix</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">\f${\bf J}\f$ [by calling</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">the \c BlockPreconditioner::block\_setup() function]. </span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">- Extract the five diagonal blocks \f${\bf J}_{ii}\f$ </span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">(for \f$i=1,...,5\f$) [using the </span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">\c BlockPreconditioner::get\_block(...) function].</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">- Compute and store the LU decomposition of the diagonal blocks</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">to allow the rapid solution of the systems \f${\bf J}_{ii} \ {\bf y}_i = </span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">\widetilde{\bf z}_i\f$ (for \f$i=1,...,5\f$) during the \c preconditioner\_solve(...)</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">phase by back-substitution. [This is done by calling the \c setup(...)</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">function of the subsidiary preconditioner/inexact solver. Following this,</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">the diagonal matrix blocks are longer required and can be deleted.]</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">- Extract the relevant off-diagonal blocks from \f${\bf J}\f$ and create </span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">\c MatrixVectorProduct operators. [The matrix vector products are </span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">set up using the </span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">\c setup_matrix_vector_product(...) function. As with the subsidiary</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">preconditioners, the \c MatrixVectorProduct operators retain their own</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">copy of any required data, so the off-diagonal matrix blocks can be</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">deleted (or be allowed to go out of scope) following the setup.]</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">\subsubsection upper_triangular_implementation Implementation as a BlockPreconditioner</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">Here is a sample implementation of the upper triangular block preconditioner</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">as a class \c UpperTriangular, derived from the \c BlockPreconditioner base </span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">class. The class provides storage for the subsidiary preconditioners</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">that solve the linear systems associated with the diagonal blocks, and</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">the \c MatrixVectorProduct operators. We also implement the \c</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">setup() and \c preconditioner\_solve(...) functions, and provide a</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">helper function \c clean\_up\_my\_memory() which does what it says.</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">As before we also provide an access function</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">which allows the user to specify the pointer to the \c Mesh that</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">contains the \c MultiPoissonElements which classify the dofs.</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">\dontinclude multi_poisson_block_preconditioners.h</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">\skipline start_of_upper_triangular_class</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">\until };</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">\subsubsection upper_triangular_setup The setup() function</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">As before, we start by cleaning up the memory, set the pointer to the </span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">mesh, and set up</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">the generic block preconditioner functionality by calling </span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">\c block_setup().</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">\skip start_of_setup_for_upper_triangular</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">\until this-&gt;block_setup();</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">We provide storage for the (pointers to the) matrix vector products</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">and the subsidiary preconditioners.</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">\until Block_preconditioner_pt.resize(nblock_types);</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">Next we create the subsidiary preconditioners which we will use to </span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">solve the linear systems involving the diagonal blocks.</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">\until end of brace</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">We then extract the relevant off-diagonal blocks (those above the</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">diagonal) from the full matrix, create a \c MatrixVectorProduct </span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">operator for each and </span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">use the \c BlockPreconditioner::setup_matrix_vector_product(...) function</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">to make them fully functional. Note that the final argument to this</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">function (the column index of the off-diagonal block in its block enumeration</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">within the current preconditioner) is required to set up additional lookup</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">tables that are required to ensure the correct operation of this object</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">in cases when the preconditioner operates in parallel. The details are</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">messy and not worth explaining here -- just do it!</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">\until // End setup</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">\subsubsection upper_triangular_solve The preconditioner_solve() function</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">As in the block diagonal preconditioner, we start by extracting the</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">block vectors from the full-length vector, \c r.</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">\skip //======</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">\until this-&gt;get_block</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">Next we provide storage for the solution vectors and </span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment">work backwards through the (block)-rows of the (block-)linear</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment">system (7). Following each linear solve</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment">we update the right-hand-side of the next linear system, as discussed</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">above.</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">\until // End for over i</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">Finally, the solutions in \c block_z are combined via \c</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">return_block_vectors(...) which places the results back</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">into the full-length vector \c z that is returned by this function.</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">\subsubsection upper_triangular_clean The clean_up_my_memory() function</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">This  function again deletes any data that was</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">allocated in the setup function -- here the subsidiary preconditioners</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">(and their LU decompositions) and the matrix-vector product operators.</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">\until // End of clean_up_my_memory function.</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">&lt;a name=&quot;compound&quot;&gt;&lt;/a&gt;</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">\subsection two_plus_three Combining multiple dof types into compound blocks. Part 1</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">NEW FEATURES: How to combine multiple dof types into compound blocks</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">\subsubsection two_plus_three_theory Theory</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">So far we have illustrated how to implement block preconditioners </span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">for cases where the dof types (as identified by the elements) </span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">correspond directly to </span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">the block types. This is appropriate for our model PDE system </span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">(1) in which the five fields (and the governing</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">equations) are all of the same type. In many applications,</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">particularly in multi-physics problems, it</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">may be desirable to combine similar/related dof types into single</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">blocks. For instance, in a 2D fluid-structure interaction problem,</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">we may wish to distinguish between the two solid (x and y solid</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">displacements) and three fluid (x and y fluid velocities and the pressure)</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">dofs and employ subsidiary preconditioners that act directly on </span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">the two distinct solid and fluid blocks. A basic block diagonal </span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">preconditioner for such a problem that ignores the coupling between </span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">fluid and solid dofs has the following structure </span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">{\bf P} = </span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">\begin{array}{cc|ccc}</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">J_{11} &amp; J_{12} &amp; &amp; &amp; \\</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">J_{21} &amp; J_{22} &amp;  &amp;  &amp; \\</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">\hline </span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment"> &amp; &amp; J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment"> &amp; &amp; J_{53} &amp; J_{54}  &amp; J_{55} \\</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">\begin{array}{c|c}</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">B_{11}  &amp; \\</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">        &amp; B_{22} \\</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">where \f$ B_{11} \f$ and \f$ B_{22} \f$ are the blocks</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">formed from the corresponding &quot;dof blocks&quot; (the \f$</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">J_{ij} \f$ matrices).</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">The application of this preconditioner (i.e. the solution of the</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">linear system \f${\bf P} {\bf</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">  y} ={\bf z}\f$ for \f${\bf y}\f$) requires the solution of the </span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">two smaller linear systems</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">J_{11} &amp; J_{12} \\</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">J_{21} &amp; J_{22} \\</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">\right) \left(</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">y_1 \\</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">y_2 \\</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">z_1 \\ </span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment">z_2 \\</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">\mbox{\ \ \ \ \ \ \ or \ \ \ \ \ \ }</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">B_{11} \ Y_1 = Z_1</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">(8)</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">and</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment">J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">\right) \left(</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">z_3 \\ </span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">z_4 \\</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">z_5 \\</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">\mbox{\ \ \ \ \ \ \ or \ \ \ \ \ \ }</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">B_{22} \ Y_2 = Z_2.</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">(9)</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">A key feature of the block preconditioning framework is the ability</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">to combine dof types in this manner so that the preconditioner can </span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">operate directly with blocks \f$ B_{11} \f$ and \f$ B_{22} \f$ and</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">the corresponding block vectors  \f$ Y_1, Y_2, Z_1 \f$ and \f$ Z_2 \f$.</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">Assuming again that the linear systems in</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">(8) and (9) are</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">solved exactly by a direct solver (an ``exact preconditioner&#39;&#39;) that </span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">can pre-compute and store the LU decomposition of the diagonal matrix blocks,</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">\f$ B_{11} \f$ and \f$ B_{22} \f$, </span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">the \c setup() phase involves the following operations</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">[text in square brackets refers to their \c oomph-lib specific </span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">implementation]:</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">- Set up any data structures/lookup tables that are required to </span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">extract the matrix blocks \f$ B_{11} \f$ and \f$ B_{22} \f$ and</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">the associated block vectors [by calling</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">the \c BlockPreconditioner::block\_setup(...) function -- this time </span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">with arguments that specify the mapping between &quot;dof types&quot; and </span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">&quot;block types&quot;]. </span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">- Extract the two diagonal blocks, \f$ B_{11} \f$ and \f$ B_{22}\f$  [using the </span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">\c BlockPreconditioner::get\_block(...) function].</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">- Compute and store the LU decomposition of the diagonal blocks</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">to allow the rapid solution of the systems during the</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment"> \c preconditioner\_solve(...)</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">phase by back-substitution. [This is done by calling the \c setup(...)</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">function of the subsidiary preconditioner/inexact solver. Following this,</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">the diagonal matrix blocks are longer required and can be deleted.]</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">Once the \c setup() phase has been completed, the solution of the linear</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">system \f${\bf P} {\bf y} = {\bf z}\f$ by the \c preconditioner\_solve(...) </span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">function involves the following steps:</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">- Extract the two ``block vectors&#39;&#39; \f${\bf Z}_i\f$ (for \f$i=1,2\f$)</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">from the vector \f${\bf z}\f$ [using the </span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">\c BlockPreconditioner::get\_block\_vectors(...) function].</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">- Solve the linear systems \f${\bf B}_{ii} \ {\bf Y}_i = </span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">{\bf Z}_i\f$ for the vectors \f${\bf Y}_i\f$ (for \f$i=1,2\f$)  using </span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">the precomputed LU decomposition of the diagonal blocks \f${\bf B}_{ii}\f$ </span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">(for \f$i=1,2\f$) created during the \c setup() phase.</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">- Combine the two ``block vectors&#39;&#39; \f${\bf Y}_i\f$ (for \f$i=1,...,2\f$)</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">to the full-length vector \f${\bf y}\f$ [using the </span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">\c BlockPreconditioner::return\_block\_vectors(...) function].</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">\subsubsection two_plus_three_implementation Implementation as a BlockPreconditioner</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">The implementation of the preconditioner closely follows that of the </span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">block diagonal preconditioner discussed above, the main difference</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">being that the current preconditioner only ever operates </span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">with exactly two blocks. Therefore we store pointers to the two </span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">subsidiary preconditioners (rather than a vector of pointers </span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">that can store an arbitrary number of these).</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">\skip start_of_two_plus_three_class</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">\until };</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">\subsubsection two_plus_three_setup The setup() function</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment">As usual, we start by freeing up any previously allocated memory,</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">and set the pointer to the mesh:</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">\skip start_of_setup_for_two_plus_three</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">\until set_mesh</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">Since this preconditioner assumes explicitly that the problem involves</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">five dof types we check that this is actually the case.</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">To indicate that several dof types are to be combined into </span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">single blocks, we specify the mapping between dof types and block types</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">as an argument to the \c block_setup(...) function</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">This is done by creating vector of length \c ndof_type()</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">in which each entry indicates the block that the corresponding</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">dof is supposed to end up in:</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">\until this-&gt;block_setup(dof_to_block_map);</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">To show that this actually worked, we output the number of blocks</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">(which should be -- and indeed is -- equal to two).</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">\skip Show that it </span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">\until types</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">Next we create the two subsidiary preconditioners and call their</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">\c setup(...) functions, passing the two diagonal blocks</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment"> \f${\bf B}_{11} \f$  and \f${\bf B}_{22} \f$  to them.</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">\skip // Create the subsidiary preconditioners</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">\until // End of setup</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">\subsubsection two_plus_three_solve The preconditioner_solve() function</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">The \c preconditioner_solve(...) function is equivalent to that</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">in the \c Diagonal preconditioner discussed above, though here it simply</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">acts on a 2x2 block system. </span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">\skip //======</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">\subsubsection two_plus_three_clean The clean_up_my_memory() function</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">This function again deletes the allocated storage --</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">here the subsidiary preconditioners.</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">\until // End of clean_up_my_memory function.</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">\subsection two_plus_three_upper_triangular Combining multiple dof types into compound blocks. Part 2: How to deal with off-diagonal blocks</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">NEW FEATURES: How to set up matrix vector products when multiple dof types</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">have been combined into compound blocks</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_theory Theory</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">The extension of the preconditioner introduced in the</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">previous section to block-triangular form is</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">straightforward: We use the same dof-to-block mapping as before but </span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">now retain the off-diagonal block \f$ B_{12} \f$ so that the </span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">preconditioner has the structure:</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">{\bf P} = </span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">\begin{array}{cc|ccc}</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">J_{11} &amp; J_{12} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">J_{21} &amp; J_{22} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"> &amp; &amp; J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment"> &amp; &amp; J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">\begin{array}{c|c}</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">B_{11}  &amp; B_{12}\\</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">        &amp; B_{22} \\</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">(10)</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">In the FSI context where \f$ B_{11} \f$  and \f$ B_{22} \f$ </span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">represent the solid and fluid sub-blocks, respectively, the inclusion</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">of the off-diagonal block \f$ B_{12} \f$ incorporates the effect of</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">fluid dofs (via pressure and shear stress) onto the solid equations.</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">Since this captures &quot;more of the physics&quot; the preconditioner can be</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">expected to be better than its block diagonal counterpart.</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">The application of the preconditioner (i.e. the solution of the</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">linear system \f${\bf P} {\bf</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">  y} ={\bf z}\f$ for \f${\bf y}\f$) requires the solution of the </span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">two smaller linear systems</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">\ \ \ \ \</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">J_{11} &amp; J_{12} \\</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">J_{21} &amp; J_{22} \\</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">\right) \left(</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">y_1 \\</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">y_2 \\</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">z_1 \\ </span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">z_2 \\</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">\right) - \left(</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">J_{23} &amp; J_{24} &amp; J_{25}  \\</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">\right) \left(</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">\mbox{\ \ \ \ \ \ \ \ \ or \ \ \ \ \ \  \ \ }</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">B_{11} Y_1 =  Z_1 - B_{12} Y_2</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">(11)</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">and </span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \  </span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ </span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">\right) \left(</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">z_3 \\ </span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">z_4 \\</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">z_5 \\</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">\mbox{\ \ \ \ \ \ \ \ \ or \ \ \ \ \ \  \ \ }</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">B_{22} Y_2 =  Z_2.</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">(12)</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_implementation Implementation as a BlockPreconditioner</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">The implementation is very similar to that in the previous example --</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">we simply provide additional storage for the (single) matrix vector</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">product operator required for the multiplication with \f$ B_{12} \f$</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment">when updating the right-hand-side in equation</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">(11).</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">\skip start_of_two_plus_three_upper_triangular_class</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">\until }; </span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_setup The setup() function</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">As before, we start by freeing up any previously allocated memory</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">and set the pointer to the mesh,</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">\skip start_of_setup_for_two_plus_three_upper_triangular</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">\until set_mesh</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment">and check that the number of dof types is correct.</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment">The block setup is again performed with a dof-to-block mapping</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment">that results in a block preconditioner with 2x2 blocks.</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">\until this-&gt;block_setup(dof_to_block_map);</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">We create the two subsidiary preconditioners and pass the </span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment">two diagonal blocks \f$ B_{11} \f$ and  \f$ B_{22} \f$</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment">to their \c setup() functions. As before, the deep copies</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment">of these matrices are then allowed to go out of scope, freeing</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment">up the memory, since the subsidiary preconditioners retain whatever</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">information they require.</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">\skip // Create the subsidiary preconditioners</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">\until end setup of last</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">Finally we create and set up the off-diagonal vector product. Note</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">that the block column index refers to the block enumeration, </span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment">so the block column index of \f$ B_{12} \f$ is 1 (in a C++ zero-based</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">enumeration!). </span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_solve The preconditioner_solve() function</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment">The application of the preconditioner is the exact equivalent of that</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">of the general-purpose block triangular preconditioner discussed</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">above, restricted to a 2x2 system:</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">\skip //======</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_clean The clean_up_my_memory() function</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment">As before, this function frees up any memory that has been allocated</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">in the \c setup() function.</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">\until // End of clean_up_my_memory function.</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">\subsection two_plus_three_upper_triangular_with_sub Using subsidiary block preconditioners</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">NEW FEATURES: How to use subsidiary block preconditioners to</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">(approximately) solve linear systems constructed from subsets of</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment">dof-blocks.</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_sub_theory Theory</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">The two previous examples were motivated by the observation that in </span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">multi-physics problems (such as fluid-structure interaction) it is</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">natural to combine &quot;related&quot; dof blocks into compound block</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">matrices. We showed that the block preconditioning framework makes</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">it easy to extract such matrices from the original</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">system matrix and demonstrated how to solve linear systems involving these </span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">matrices with separate subsidiary preconditioners.  </span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">One problem with this approach is that, once a compound matrix</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">has been created (by the \c get_block(...) function), all </span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">information about its dof types is lost, making it impossible to </span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">employ block preconditioners as subsidiary preconditioners. </span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">We will now revisit the 2x2 block triangular preconditioner </span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment">described in the previous example and demonstrate how to employ</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">subsidiary block preconditioners to (approximately) solve linear</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">systems involving matrices formed (formally) by compound matrices</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment">that are constructed from multiple dof-level blocks. From a</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">mathematical point of view, the structure of</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">the preconditioner therefore remains unchanged and is given by</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">{\bf P} = </span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">\begin{array}{cc|ccc}</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">J_{11} &amp; J_{12} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">J_{21} &amp; J_{22} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment"> &amp; &amp; J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment"> &amp; &amp; J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">\right)=</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">\begin{array}{c|c}</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">B_{11}  &amp; B_{12}\\</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">        &amp; B_{22} \\</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">(13)</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">We will continue to use a dof-to-block mapping to view this as</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">the 2x2 block matrix shown on the right. This makes it easy to </span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">extract the compound off-diagonal block  \f$ B_{12} \f$ from the</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">system matrix when setting up the matrix-vector product (as before).</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment">The setup of the subsidiary block preconditioners used to (approximately)</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">solve the linear systems involving \f$ B_{11} \f$ and \f$ B_{22}\f$ </span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment">is handled differently:</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">- When calling the subsidiary block preconditioner&#39;s </span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">  \c setup(...) function we pass a pointer to the </span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">  entire system matrix, i.e. the matrix containing, formally, </span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">  all the dof-level blocks in equation (3).</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment">- We then turn the preconditioner into a subsidiary block</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">  preconditioner, using its member function </span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">  \c turn_into_subsidiary_block_preconditioner(...) whose arguments </span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">  specify which of the dof-level blocks in the current (master) </span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">  preconditioner are to be used by the subsidiary block preconditioner.</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">The subsidiary block preconditioner is thus given access to all</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">the information required to extract the relevant data directly from the</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">original system matrix (and any associated full-length vectors).</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment">It is in fact a key design principle of the block preconditioning</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">framework that &lt;b&gt;subsidiary block preconditioners</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">are given access to the &quot;full size&quot; matrices and vectors, but only</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">operate on the subset of data that they are &quot;in charge of&quot;.&lt;/b&gt;</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">When employing subsidiary block preconditioners for the approximate </span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">solution of the two smaller linear systems</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">J_{11} &amp; J_{12} \\</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment">J_{21} &amp; J_{22} \\</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">\right) </span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">}_{B_{11}}</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">y_1 \\</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment">y_2 \\</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">}_{Y_{1}}</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment"> = </span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">z_1 \\ </span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">z_2 \\</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">}_{{\bf Z}_1} - </span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">J_{23} &amp; J_{24} &amp; J_{25}  \\</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">}_{B_{12}}</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment">}_{{\bf Y}_2}</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">\\</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">(14)</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">\\</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment">J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">}_{B_{22}}</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">}_{{\bf Y}_2}</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"> = </span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">z_3 \\ </span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">z_4 \\</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">z_5 \\</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">}_{{\bf Z}_2},</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">the subsidiary preconditioners that operate on </span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">the linear systems involving \f$ B_{11} \f$ and \f$ B_{22} \f$ </span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">therefore retain access to the </span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment">relevant dof-level blocks. Hence, if we employ the block triangular </span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">preconditioner discussed above to (approximately) solve the</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">two linear systems in equation </span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">(14),</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">the complete preconditioning operation is described by the</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">following equations:</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">J_{11} &amp; J_{12} \\</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment"> &amp; J_{22} \\</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">\right) </span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">y_1 \\</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">y_2 \\</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">\right) </span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment">= </span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="comment">z_1 \\ </span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">z_2 \\</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">}_{{\bf Z}_1}</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment"> - </span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">J_{23} &amp; J_{24} &amp; J_{25}  \\</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="comment">}_{B_{12}}</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">}_{{\bf Y}_2}</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment">}_{\widehat{\bf Z}_1}</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">\\</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment">J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment"> &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment"> &amp;  &amp; J_{55} \\</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment">\right) \left(</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">z_3 \\ </span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">z_4 \\</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">z_5 \\</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">Note that when we wrote the block triangular preconditioner </span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">we did not have to be aware of the fact that it may subsequently be used</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">as a subsidiary block preconditioner. The</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">internal data structures implemented in the \c BlockPreconditioner</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment">base class ensure that when we call \c get_block(0,0,block_matrix)</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment">in the subsidiary block preconditioner acting on \f$ B_{22} \f$, </span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment">\c block_matrix will </span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment">receive a deep copy of \f$ J_{33} \f$, extracted from the full system matrix. </span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="comment">Similarly, a call to \c get_block_vectors(r,block_r) will</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="comment">extract the three block vectors \f$ {\bf r}_3, {\bf r}_4 \f$</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment">and \f${\bf r}_5 \f$ from the full-length vector \f$ {\bf r} \f$,</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">while \c return_block_vectors(block_z,z) will return the</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">three solution vectors \f$ {\bf z_3}, {\bf z_4} \f$ and </span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="comment">\f$ {\bf z_5} \f$ to the appropriate entries in the full-length</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment">vector \f$ {\bf z}. \f$</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment">The implementation of the preconditioning operations</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment">can again be subdivided into two</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment">distinct \c setup() and \c preconditioner\_solve(...) phases.</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">- Set up the data structures/lookup tables that map dof types</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment">  0 and 1 to block 0 and dof types 2, 3 and 4 to block 1 [by calling</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="comment">  the \c BlockPreconditioner::block\_setup(...) function</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment">  with arguments that specify the mapping between &quot;dof types&quot; and </span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">  &quot;block types&quot; as before]. </span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">- Create two instances of the block triangular preconditioner</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">  (or any other block preconditioner) and turn them into the </span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">  subsidiary preconditioners for the current (master) preconditioner,</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment">  specifying which dof types in the master preconditioner the</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">  subsidiary block preconditioners are to work with.</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">- Extract the compound off-diagonal block \f$ B_{12}\f$  and create </span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">  a \c MatrixVectorProduct operator. </span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">Once the \c setup() phase has been completed, the solution of the linear</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">system \f${\bf P} {\bf y} = {\bf z}\f$ by the \c preconditioner\_solve(...) </span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">function involves the following steps:</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">- Solve the linear systems \f$ {\bf B}_{22} \ {\bf Y}_2 = </span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">{\bf Z}_2\f$ using the subsidiary block preconditioner that works</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">with  \f$ {\bf B}_{22} \f$. [The subsidiary block preconditioner&#39;s</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">\c preconditioner_solve(...) function is given access to the </span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment">full-size vectors \f$ {\bf z} \f$ and \f$ {\bf y} \f$ and</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">extracts/returns \f$ {\bf Z}_2 \f$</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">and \f$ {\bf Y}_2\f$ directly from/into these.]</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">- Extract the solution vector \f$ {\bf Y}_2 \f$ from the just undated full-length</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">vector \f$ {\bf y} \f$, perform the matrix vector product with</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment">\f$ B_{12} \f$ and store the result in a temporary vector \f$ {\bf t} \f$.</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment">- Extract the block vector \f$ {\bf Z}_1\f$ from the full-length</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">vector \f$ {\bf z} \f$, subtract \f$ {\bf t} \f$</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">from it, and return the result, \f$ \widehat{\bf Z}_1 = </span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">{\bf Z}_1 - B_{12} {\bf Z}_2 \f$</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment">into the appropriate entries into the</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">full-length vector \f$ {\bf z} \f$.</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">- Solve the linear systems \f$ {\bf B}_{11} \ {\bf Y}_1 = </span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">\widehat{\bf Z}_1 = {\bf Z}_1 - B_{12} {\bf Z}_2 \f$ using the subsidiary block </span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">preconditioner that works</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">with  \f$ {\bf B}_{11} \f$. [The subsidiary block preconditioner&#39;s</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">\c preconditioner_solve(...) function is given access to the </span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">full-size vectors \f$ {\bf z} \f$ and \f$ {\bf y} \f$ and</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">extracts/returns \f$ \widehat{\bf Z}_1 \f$</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment">and \f$ {\bf Y}_1\f$ directly from/into these; recall that the </span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="comment">relevant entries in \f$ {\bf z}\f$ have been over-written </span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment">in the previous step so that \f$ \widehat{\bf Z}_1 \f$ contains </span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment">the updated right hand side.]</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_sub_implementation Implementation as a BlockPreconditioner</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">The implementation of the preconditioner is completely equivalent to the</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">corresponding block triangular preconditioner considered in the</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment">previous example:</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">\skip start_of_two_plus_three_upper_triangular_with_sub_class</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">\until }; </span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_sub_setup The setup() function</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">As usual we free up any memory and set the pointer to the mesh:</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment">\skip start_of_setup_for_two_plus_three_upper_triangular</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment">\until set_mesh</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment">We check that the number of dof types is appropriate for this preconditioner:</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment">Next we define the block structure of the preconditioner, using</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment">a dof-to-block mapping to combine dofs 0 and 1 into block 0,</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment">and dofs 2, 3 and 4 into block 1:</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="comment">\until this-&gt;block_setup(dof_to_block_map);</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="comment">Next we create the block triangular preconditioner used</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="comment">to (approximately) solve linear systems involving </span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="comment">the compound &quot;top left&quot; 2x2 block:</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">\skip // Create the subsidiary block preconditioners</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment">\until First_sub</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment">Next we specify the pointer to the mesh that contains the elements</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">that classify the degrees of freedom. We note, that, strictly speaking</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">this is not necessary since the preconditioner will only be used</span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">as a subsidiary preconditioner --  the enumeration of the dof types</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">is always handled by the top-most master preconditioner. One (or more)</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">mesh pointers must be set for the master preconditioner, and, if</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">compiled in \c PARANOID mode, \c oomph-lib will throw an error </span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">if this is not done. Some (but not all!) \c oomph-lib developers</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">regard it as &quot;good practice&quot; to set the mesh </span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">pointer anyway, so one is less likely to forget...</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">\skip Set mesh</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment">\until set_multi_poisson_mesh</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">We turn this preconditioner into a subsidiary block preconditioner, specifying</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment">the pointer to the current (master) preconditioner and the</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment">mapping between dof types in the present and the subsidiary</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">block preconditioners (here the identity):</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment">\until turn_into_subsid</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="comment">When calling the subsidiary block preconditioners \c setup(...)</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment">function we pass a pointer to the full matrix:</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">The second subsidiary block preconditioner (for the 3x3 &quot;bottom right&quot;</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">compound matrix) is created similarly,  though the mapping between</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">dof-types is now no longer the identity but maps dof types 2, 3 and 4</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">in the current (master) preconditioner to dof types 0, 1 and 2</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">in the subsidiary block preconditioner:</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">The setup of the matrix-vector product with the off-diagonal matrix </span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">is unchanged from the previous example:</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_sub_solve The preconditioner_solve() function</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="comment">As discussed in the theory section, we start by (approximately)</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">solving the system \f$ B_{22} Y_2 = Z_2 \f$, using the second</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">subsidiary block preconditioner which automatically </span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">extracts \f$ Z_2 \f$ from the full length vector \c z</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">and returns the result \f$ Y_2 \f$ into the appropriate entries</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">of the full length vector \c y.</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">\until Second_subsidiary_preconditioner_pt-&gt;preconditioner_solve(z,y);</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">We now extract the block vector \f$ Y_2 \f$ from the full-length</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">vector \c y,</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">\until get_block_vector</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">multiply it by \f$ B_{12} \f$, using the \c MatrixVectorProduct</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">operator,</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">\until Off_diagonal</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">and subtract the result from \f$ Z_1 \f$ (which we extract from the</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">full length vector \c z ):</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment">\until block_z -= temp; </span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">\c block_z now contains the updated right hand side, \f$ \widehat{{\bf</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment">Z}_1}\f$, for the linear system to be (approximately) solved by the</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment">first subsidiary block preconditioner. We therefore return </span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment">\f$ \widehat{{\bf Z}_1}\f$ to the appropriate entries into a full</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment">length vector of the same size as right hand side vector \c z:</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">\until return_block_vector</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment">We then pass this vector to first subsidiary preconditioner which </span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment">updates the appropriate entries in the full-length solution vector \c</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="comment">y which can therefore be returned directly by this function:</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_sub_clean The clean_up_my_memory() function</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="comment">As usual, we use this helper function to free up any memory </span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">allocated in the \c setup() function to avoid memory leaks.</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment">\until // End of clean_up_my_memory function.</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="comment">\subsection two_plus_three_upper_triangular_with_replace Replacing/modifying blocks</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">NEW FEATURES: How to replace/modify matrix blocks</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_replace_theory Theory</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">So far, we have demonstrated how to extract matrix blocks from the</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">full-sized system matrix (typically the Jacobian matrix used in </span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">Newton&#39;s method) and how to apply a preconditioner via operations</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">involving these blocks. Many preconditioners do not operate directly</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">with the matrix blocks themselves, but on matrices that are derived from them.</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">For instance, &lt;c&gt;oomph-lib&lt;/c&gt;&#39;s  &lt;a href=&quot;../../../preconditioners/lsc_navier_stokes/html/index.html&quot;&gt;Schur complement Navier-Stokes preconditioner&lt;/a&gt;</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="comment">operates on an (approximate) Schur complement;</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment">augmentation preconditioners involve</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="comment">operations on matrices that are obtained by the addition of a diagonal</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="comment">matrix to some of the matrix blocks; etc. Within a given</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="comment">preconditioner such derived matrices are typically pre-computed </span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="comment">by the preconditioner&#39;s \c setup() function and then stored as </span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="comment">private member data which makes them available to the \c</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment">preconditioner_solve() function. Unfortunately, this approach does not </span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="comment">work if the modified block is to be used in a subsidiary block preconditioner</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">because, as discussed in the previous example, </span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment">by default the subsidiary block preconditioner will extract its block</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="comment">matrices directly from the full-size system matrix and will therefore</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="comment">ignore any (local) modifications made by its master preconditioner(s). </span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">What is therefore required is a method that indicates to the block </span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="comment">preconditioning framework that a given sub-block is not to be </span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="comment">extracted from the full system matrix but to be represented by suitable </span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="comment">replacement matrix.</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="comment">We demonstrate this methodology by re-visiting the preconditioner</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">considered in the previous example, namely</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">{\bf P}_{\rm previous} = </span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">\begin{array}{cc|ccc}</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">J_{11} &amp; J_{12} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">J_{21} &amp; J_{22} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment"> &amp; &amp; J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment"> &amp; &amp; J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment">(15)</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="comment">However, here we want to modify the off-diagonal blocks by</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="comment">&quot;replacing&quot; each block \f$J_{ij}\f$ (for \f$ i \ne j \f$) by </span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment">a &quot;replacement matrix&quot; \f$R_{ij}\f$ so that the preconditioner becomes</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment">{\bf P} = </span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="comment">\begin{array}{cc|ccc}</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment">J_{11} &amp; R_{12} &amp; R_{13} &amp; R_{14} &amp; R_{15} \\</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">R_{21} &amp; J_{22} &amp; R_{23} &amp; R_{24} &amp; R_{25} \\</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; R_{34} &amp; R_{35} \\</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;<span class="comment"> &amp; &amp; R_{43} &amp; J_{44} &amp; R_{45} \\</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment"> &amp; &amp; R_{53} &amp; R_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment">\right) =</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment">\begin{array}{c|c}</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment">B_{11}  &amp; B_{12}\\</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment">        &amp; B_{22} \\</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">(16)</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">The application of this preconditioner (i.e. the solution of the</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">linear system \f${\bf P} {\bf</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">  y} ={\bf z}\f$ for \f${\bf y}\f$) still requires the solution of the </span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">two smaller linear systems</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">J_{11} &amp; R_{12} \\</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="comment">R_{21} &amp; J_{22} \\</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="comment">}_{B_{11}}</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="comment">y_1 \\</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">y_2 \\</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment">z_1 \\ </span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment">z_2 \\</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment">\right) - </span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment">R_{13} &amp; R_{14} &amp; R_{15} \\</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">R_{23} &amp; R_{24} &amp; R_{25} \\</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">}_{B_{12}}</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment">z_3 \\</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment">z_4 \\</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment">z_5 \\</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment">\\</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment">(17)</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">\\</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">J_{33} &amp; R_{34} &amp; R_{35} \\</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment">R_{43} &amp; J_{44} &amp; R_{45} \\</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">R_{53} &amp; R_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment">\right) </span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment">}_{B_{22}}</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="comment">z_3 \\ </span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment">z_4 \\</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">z_5 \\</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">where we have again assumed that the two vectors \f${\bf y}\f$ and \f${\bf z}\f$</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">are re-ordered into ``block vectors&#39;&#39; in the same way as </span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">the vectors \f$\delta {\bf x}\f$ and \f${\bf r}\f$ in </span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">&quot;the original linear system&quot; (3) are re-ordered into</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment">the ``block vectors&#39;&#39; in</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">(17).</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">We wish to continue to solve the linear systems involving</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">the compound matrices \f$ B_{11}  \f$ and \f$ B_{22} \f$ </span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">(which involve &quot;replaced&quot; blocks) by two subsidiary block </span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">preconditioners (which operate on 3x3 and 2x2 dof blocks, </span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">respectively).</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment">In the specific example below we replace all of the diagonal </span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">matrices by suitably sized zero matrices, so that the actual </span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">preconditioning operation is defined by the following</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">linear systems</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">J_{11} &amp;  \\</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment">&amp; J_{22} \\</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">\right) </span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">}_{B_{11}}</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment">y_1 \\</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment">y_2 \\</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">z_1 \\ </span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment">z_2 \\</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment">\right) - </span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="comment">&amp; &amp;  \\</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment"> &amp; &amp;  \\</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment">\right) </span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment">}_{B_{12}}</span></div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment">z_3 \\</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment">z_4 \\</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">z_5 \\</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment">\\</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment">\underbrace{</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment">J_{33} &amp; &amp;  \\</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">&amp; J_{44} &amp;  \\</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment"> &amp;  &amp; J_{55} \\</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment">\right) </span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">}_{B_{22}}</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">y_3 \\</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">y_4 \\</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">y_5 \\</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment">\right) = \left(</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">z_3 \\ </span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">z_4 \\</span></div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">z_5 \\</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">\right)</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">which, in effect, turns the preconditioner into the </span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">block-diagonal preconditioner considered at the very</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment">beginning of this tutorial.</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_replace_implementation Implementation as a BlockPreconditioner</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">The implementation of the preconditioner is completely equivalent to the</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">preconditioner considered in the previous example. The only additional</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">feature is the provision a matrix of pointers to the</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment">replacement matrices, \c Replacement_matrix_pt.</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment">\skip start_of_two_plus_three_upper_triangular_with_replace_class</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment">\until }; </span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_replace_setup The setup() function</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">As usual, we start by cleaning up any memory using a call to a</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment">\c clean_up_my_memory() function, and set the pointer to the mesh</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">\skip start_of_setup_for_two_plus_three_upper_triangular_with_replace</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">\until set_mesh</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment">Next we check that the number of dof types is 5, as the</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">preconditioner is designed to only work for that number. </span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">\skip How many dof types do we have</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="comment">The block setup follows exactly the same pattern as in the previous</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment">example: Dof types 0 and 1 are combined into compound block 0, while</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="comment">dof types 2, 3 and 4 are combined into compound block 1.  </span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">On return from the block setup function we should therefore have</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">two block types:</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">\skip Call block setup</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="comment">Now we perform the replacement of the off-diagonal dof blocks.</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment">(Note that there are still five of these. Dof-blocks and compound</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment">blocks are not the same -- if you get them confused you will get into</span></div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment">trouble!). We allocate storage for the pointers to the replacement </span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment">matrices and loop over the off-diagonal blocks:</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="comment">\until (i!=j)</span></div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="comment">\until {</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="comment">Given that the replacement matrices are zero matrices, we could</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment">simply create them without ever looking at the original blocks.</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment">Sadly the creation of zero matrices turns out to be slightly</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment">more painful than one would wish because they have</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment">to be created as a (possibly distributed) \c CRDoubleMatrix. The </span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="comment">relevant code is contained in the source code but we won&#39;t discuss </span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="comment">it here since the more common situation is one where we actually</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment">want to modify the already existing entries of an already </span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment">existing block matrix. </span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">Therefore we simply extract the matrix and set its initially nonzero entries</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment">to zero (admittedly a bit silly -- we now have a sparse matrix full of</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment">zeroes, but it&#39;s just a demonstration!):</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment">\until this is just an example!</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment">We then pass the pointer to the replacement dof block to the</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment">block preconditioner</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment">\skip Replace (i,j)</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment">\until loop of i</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment">The rest of the setup works exactly as in the previous example, only</span></div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment">this time, the subsidiary preconditioners and the matrix vector </span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment">products will work with the replacement dof blocks that we&#39;ve just</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment">defined.</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="comment">We create and set up the first subsidiary block preconditioner </span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">which operates on our dof types 0 and 1 (and treats them as its own</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">dof  types 0 and 1):</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">\skip First subsidiary precond</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">The second  subsidiary block preconditioner </span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment">which operates on our dof types 2, 3 and 4 (and treats them as its own</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment">dof  types 0, 1 and 2):</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">\skip Second subsidiary precond </span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">Finally, we create the matrix vector product operator:</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">\skip Next setup the off diagonal mat vec operators:</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_replace_solve The preconditioner_solve() function</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">The \c preconditioner_solve() function is completely identical to the</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">one used in the previous preconditioner, so we omit the code</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">listing -- the subsidiary preconditioners and the matrix vector </span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">product operator work in the same way but now simply operate on </span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment">the replacement dof blocks where they have been set.</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">\subsubsection two_plus_three_upper_triangular_with_replace_clean The clean_up_my_memory() function</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">Memory is cleaned up as before, so we omit the code listing.</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment">\subsection coarse_two_plus_two_plus_one Coarsening/combining dof types</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">NEW FEATURES: How to coarsen/combine dof types for use by subsidiary</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">block preconditioners.</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">\subsubsection coarse_two_plus_two_plus_one_theory Theory</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment">In the examples presented so far we have demonstrated how</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="comment">to combine various dof-blocks into compound blocks in order to </span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment">facilitate the application of certain preconditioning operations.</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment">For instance, in many of the previous examples we performed a matrix</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="comment">vector product using the compound matrix \f$ B_{12} \f$ that was</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;<span class="comment">(formally) formed by the concatenation of the 2x3 &quot;top right&quot;</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment">off-diagonal dof blocks in the full-sized system.</span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">We also showed how subsidiary block preconditioners which operate on</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">a specific number of dof blocks can be instructed to operate on </span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">selected dof types from the full-sized system. Our standard</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment">example for this was a 2D Navier-Stokes preconditioner which operates on</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">three dof types (two fluid velocities and one pressure) and </span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">is used as a subsidiary block preconditioner in an FSI problem that </span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment">also involves additional dofs associated with the solid mechanics</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">(e.g. the two solid displacement components). This was done</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment">by informing the subsidiary preconditioner which of the dof types</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">in the full-sized system to regard as &quot;its own&quot; when calling</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">its \c turn_into_subsidiary_block_preconditioner(...) function.</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment">This implies that the subsidiary block preconditioner remains unaware of any </span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment"> compound blocks that may have been formed in its master </span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment"> preconditioner. The functionality presented so far only allows us</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">to associate dof-blocks in the master preconditioner with dof</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">blocks in the subsidiary block preconditioner.</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">It is therefore not possible (without further functionality which we explain</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">in this example) to use a subsidiary block preconditioner if the dof-types</span></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="comment">in the master preconditioner are &quot;too fine-grained&quot;. This arises,</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment">for instance, in Navier-Stokes problems where the master preconditioner</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment">sub-divides the two components of the fluid velocity into degrees of freedom</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">on the domain boundary and those in the interior. It is then necessary</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">to make the subsidiary preconditioner act on the combined </span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment">dof types, a process that we describe as &quot;coarsening&quot;.</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment">We illustrate the procedure by returning, yet again, to our 5x5 block</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="comment">linear system that we wish to precondition with</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">{\bf P}_{\rm previous} = </span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment">\begin{array}{cc|ccc}</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment">J_{11} &amp; J_{12} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">J_{21} &amp; J_{22} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment"> &amp; &amp; J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="comment"> &amp; &amp; J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">\right) =</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment">\begin{array}{c|c}</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="comment">B_{11}  &amp; B_{12}\\</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="comment">        &amp; B_{22} \\</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">(18)</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">However, now we wish to solve the two linear systems involving the</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment">compound matrices \f$ B_{11} \f$ and \f$ B_{22} \f$ with a </span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="comment">2x2 upper triangular subsidiary block</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="comment">preconditioner. To make this possible, we &quot;coarsen&quot; the dof types </span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment">such that the subsidiary  block preconditioner acting on </span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment">\f$ B_{22}\f$ treats the global dof types 3 and 4 as a single dof type</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment">so that the block structure can be viewed as</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="comment">{\bf P} = </span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="comment">\begin{array}{c||c}</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment">J_{11} &amp; J_{12} \\</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment">J_{21} &amp; J_{22}  \\</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment">\end{array} &amp;</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment">\begin{array}{ccc}</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment">J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment">J_{23} &amp; J_{24} &amp; J_{25} \\</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="comment">\end{array} \\</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="comment">&amp;</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="comment">\begin{array}{cc|c}</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment">J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="comment">J_{43} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="comment">J_{53} &amp; J_{54} &amp; J_{55} \\</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment">\right) =</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">\begin{array}{c|c}</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">B_{11}  &amp; B_{12}\\</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="comment">        &amp; B_{22} \\</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment">\hspace{3cm}</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">(19)</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="comment">If we now use a 2x2 upper triangular block preconditioner </span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="comment">to (approximately) solve the linear systems involving the</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="comment">diagonal blocks \f$ B_{11} \f$ and \f$ B_{22} \f$ </span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="comment">the preconditioner is given (mathematically) by</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment">{\bf P} = </span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="comment">\left(</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment">\begin{array}{ccccc}</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="comment">J_{11} &amp; J_{12} &amp; J_{13} &amp; J_{14} &amp; J_{15} \\</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="comment">       &amp; J_{22} &amp; J_{23} &amp; J_{24} &amp; J_{25} \\</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="comment"> &amp; &amp; J_{33} &amp; J_{34} &amp; J_{35} \\</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment"> &amp; &amp; J_{34} &amp; J_{44} &amp; J_{45} \\</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment"> &amp; &amp; &amp; &amp; J_{55} \\</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment">[Note that, In the actual implementation discussed below, we also set</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment">the off diagonal dof-blocks to zero, using the replacement methodology</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="comment">discussed in the previous example. The preconditioner therefore</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="comment">becomes mathematically equivalent to the \f$ 5x5  \f$ block </span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="comment">diagonal preconditioner discussed at the very beginning of this tutorial.]</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">\subsubsection coarse_two_plus_two_plus_one_implementation Implementation as a BlockPreconditioner</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="comment">The implementation of the preconditioner is completely equivalent to the</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">preconditioner considered in the previous examples:</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;<span class="comment">\skip start_of_coarse_two_plus_two_plus_one_class</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="comment">\until }; </span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="comment">\subsubsection coarse_two_plus_two_plus_one_setup The setup() function</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="comment">As usual we clean up any previously allocated memory and set the pointer to the</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="comment">mesh:</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment">\skip start_of_setup_for_coarse_two_plus_two_plus_one</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment">\until set_mesh</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment">Next we check that the number of degrees of freedom is 5, as the</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="comment">preconditioner is designed to only work for that number.</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="comment">The block setup follows exactly the same pattern as in the previous </span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment">examples: Dof types 0 and 1 are combined into compound block 0, </span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="comment">while dof types 2, 3 and 4 are combined into compound block 1.</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">\skip //</span></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="comment">\until this-&gt;block_setup(dof_to_block_map);</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment">[We omit the code listing the replacement of the off-diagonal dof</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="comment">blocks with zero matrices since it is identical to what we already</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="comment">discussed in the previous example.]</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="comment">Next we create the two subsidiary preconditioners that (approximately)</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment">solve the linear systems involving the diagonal blocks \f$ B_{11} \f$</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="comment">and \f$ B_{22} \f$. The first subsidiary preconditioner is a</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="comment">standard upper triangular block preconditioner which acts on the</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="comment">compound block formed by dof types 0 and 1:</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="comment">\skip // Create the subsidiary</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="comment">The second subsidiary preconditioner is more interesting. It&#39;s a </span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="comment">block preconditioner that only operates on a 2x2 block system, yet</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment">we want to use it to solve the linear system involving the compound</span></div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="comment">block formed the three dof types 2, 3 and 4. To do this we wish</span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="comment">to combine the dof blocks associated with dof types 2 and 3 into </span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="comment">a single block. We start by setting the mesh pointer and by</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="comment">setting up the usual mapping that identifies the dof types (in the </span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="comment">current preconditioner) that we wish the </span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;<span class="comment">subsidiary preconditioner to act on.</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment">\skip // Second </span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">\until  dof_map[2]</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment">To combine/coarsen dof types 2 and 3 (in the current preconditioner) </span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="comment">into a single dof type for the subsidiary preconditioner we create </span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="comment">a vector of vectors, &lt;code&gt; doftype_coarsening &lt;/code&gt; whose</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment">entries are to be interpreted as</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="comment">&lt;code&gt; doftype_coarsening[coarsened_dof_type][i]=dof_type&lt;/code&gt;</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;<span class="comment">where \c i ranges from 0 to the number of dof types (minus one, because</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;<span class="comment">of the zero-based indexing...) in the enumeration of the</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;<span class="comment">subsidiary preconditioner that are to be</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="comment">combined/coarsened into dof type \c coarsened_dof_type:</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="comment">\skip The subsidiary block preconditioner</span></div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment">\until doftype_coarsening[1][0]=2</span></div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="comment">We pass both lookup schemes to the function that turns the preconditioner</span></div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="comment">into a subsidiary block preconditioner and then call its own setup</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="comment">function, as usual.</span></div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="comment">Finally, we set up the of diagonal matrix-vector product which acts on the</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;<span class="comment">compound (0,1) block (formed from dof types {0,1}x{2,3,4}) in the current</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<span class="comment">preconditioner. </span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;<span class="comment">\until End of setup</span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="comment">\subsubsection coarse_two_plus_two_plus_one__solve The preconditioner_solve() function</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;<span class="comment">The \c preconditioner_solve() function is completely identical to the</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="comment">one used in the previous example, so we omit the code</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;<span class="comment">listing.</span></div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="comment">\subsubsection coarse_two_plus_two_plus_one_clean The clean_up_my_memory() function</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;<span class="comment">Memory is cleaned up as before, so we omit the code listing.</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;<span class="comment">\subsection fsi_multiple_meshes Using multiple meshes -- explained for a genuine fluid-structure interaction problem</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="comment">NEW FEATURES: How to use multiple meshes</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="comment">\subsubsection fsi_multiple_meshes_theory Theory</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="comment">Finally, we demonstrate the use of multiple meshes by discussing a simple </span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;<span class="comment">implementation of the FSI preconditioner described in the </span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="comment">&lt;a href=&quot;../../../preconditioners/fsi/html/index.html&quot;&gt;FSI Preconditioner</span></div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;<span class="comment">Tutorial&lt;/A&gt;. We refer to the tutorial discussing the </span></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;<span class="comment">&lt;a href=&quot;../../../interaction/fsi_channel_with_leaflet/html/index.html&quot;&gt;FSI</span></div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="comment">channel with leaflet problem&lt;/A&gt; for the overall problem setup.</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;<span class="comment">FSI problems involve fluid (velocities and pressures from the </span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;<span class="comment">Navier-Stokes equations) and solid (the nodal positions in the solid</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="comment">domain) degrees of freedom (dofs). We begin by reordering the linear </span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="comment">system to group together the two types of dof </span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment">\left[ </span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="comment">F&amp;C_{fs}\\</span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment">C_{sf}&amp;S</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="comment">\left[ </span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="comment">\bf \delta f\\</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="comment">\bf \delta s</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="comment">-</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="comment">\bf r_f\\</span></div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;<span class="comment">\bf r_s</span></div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="comment">\right] ,</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;<span class="comment">where \f$\bf f\f$ and \f$\bf s\f$ denote the fluid and solid dofs, \f$F\f$</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;<span class="comment">is the Navier-Stokes Jacobian (representing the derivatives of the </span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="comment">discretised fluid equations with respect to the fluid dofs), \f$S\f$ </span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;<span class="comment">is the solid Jacobian, and the</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="comment">blocks \f$C_{fs}\f$ and \f$C_{sf}\f$ arise from the interaction</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="comment">between fluid and solid equations.</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;<span class="comment">The Navier Stokes Jacobian \f$F\f$ has its own block</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;<span class="comment">structure. Decomposing the fluid dofs into velocity and pressure dofs so that</span></div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;<span class="comment">{\bf f}=</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="comment">\bf u\\</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="comment">\bf p</span></div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="comment">\right],</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment">we obtain the well known saddle-point structure of \f$F\f$</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment">F=</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="comment">A&amp;B^T\\</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="comment">B&amp; </span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="comment">\right],</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="comment">where \f$A\f$ is the momentum block, \f$B^T\f$ the discrete gradient</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="comment">operator, and \f$B\f$ the discrete divergence operator (see </span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment">&lt;a href=&quot;../../../preconditioners/lsc_navier_stokes/html/index.html&quot;&gt;Navier</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="comment">Stokes Preconditioner Tutorial&lt;/A&gt;). </span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="comment">This FSI preconditioner </span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="comment">takes the form of a block triangular preconditioner. Here we</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="comment">only consider the lower block triangular version </span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment">P_{FSI}=</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="comment">F&amp; \\</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment">C_{sf}&amp;S</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="comment">obtained by omitting the \f$C_{fs}\f$ block from the Jacobian.</span></div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment">The application of the preconditioner requires the solution of the</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="comment">linear </span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="comment">system</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="comment">F&amp; \\</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="comment">C_{sf}&amp;S</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="comment">\bf z_f\\</span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment">\bf z_s</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment">\bf y_f\\</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment">\bf y_s</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="comment">However, for preconditioning purposes this system does not have to be</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="comment">solved exactly. We therefore replace the solution of the linear</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;<span class="comment">systems involving the diagonal blocks (representing the single-physics</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="comment">fluid and solid Jacobians \f$F\f$ and \f$S\f$) by existing</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="comment">preconditioners (interpreted as inexact solvers). Formally, we write</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="comment">this as</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="comment">\tilde F&amp; \\</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="comment">C_{sf}&amp;\tilde S</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment">\bf z_f\\</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="comment">\bf z_s</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment">\bf y_f\\</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment">\bf y_s</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment">\right] . \ \ \ \ \ \ \ \ \ \ \ \  (20)</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">where  \f$ \tilde F \f$ is the fluid preconditioner and \f$ \tilde{S} \f$</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">the solid preconditioner, both used as </span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="comment">subsidiary preconditioners. </span></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="comment">The application of the preconditioner can be accomplished in four</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="comment">distinct steps:</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="comment">-# Apply the fluid preconditioner \f$ \tilde F \f$ to the fluid dofs of</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment">   the RHS vector \f$ \bf y_f \f$ and store the result in the fluid</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="comment">   solution \f$ {\bf z_f}=\tilde F^{-1}{\bf y_f} \f$ .</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment">-# Multiply the fluid-solid coupling matrix \f$ C_{sf} \f$ with the</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="comment">   fluid solution \f$ \bf z_f \f$ and store the result in the temporary</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="comment">   vector \f$ {\bf w}=C_{sf}\bf z_f \f$ .</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">-# Subtract \f$ \bf w \f$ from the solid dofs of the RHS vector </span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">   \f$ \bf y_s \f$ and store the result in the temporary \f$ \bf w \f$ to</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment">   complete the action of the \f$ C_{sf} \f$ matrix vector product, </span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment">   \f$ {\bf w}={\bf y_s}-{\bf w} \f$ .</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="comment">-# Apply the solid preconditioner \f$\tilde S\f$ to the temporary </span></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="comment">   \f$ \bf w \f$ to compute the solid solution </span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;<span class="comment">   \f$ {\bf z_s}=\tilde S^{-1}{\bf w} \f$ .</span></div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;<span class="comment">This is, of course, extremely similar to the methodology explained in </span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="comment">the section \ref two_plus_three_upper_triangular_with_sub, the main</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="comment">difference being that the fluid and solid dofs are classified</span></div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="comment">by two different elements. In the two-dimensional </span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="comment">&lt;a href=&quot;../../../interaction/fsi_channel_with_leaflet/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="comment">FSI channel with leaflet problem&lt;/A&gt; these are:</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="comment">- The fluid elements are of type \c</span></div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;<span class="comment">   RefineableQTaylorHoodElement&lt;2&gt;. These  elements have </span></div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="comment">  three types of dof; \f$x\f$-velocity dofs are labelled \c 0, </span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="comment">  \f$y\f$-velocity dofs are labelled \c 1 and</span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;<span class="comment">  the pressure dofs are labelled \c 2.\n\n</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;<span class="comment">- The solid elements are of type \c FSIHermiteBeamElement.  </span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;<span class="comment">  They have  one type of dof (the nodal position) labelled \c 0.</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="comment">When classifying the dofs we specify the elements via two separate</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="comment">meshes, the first one containing the pointers to the fluid elements,</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="comment">the second one the pointers to the solid elements. This means that</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">in the global enumeration of the dof types the fluid dofs appear</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment">before the solid dofs.</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="comment">\subsubsection implementing_the_fsi_preconditioner The Implementation of the FSI Preconditioner</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="comment">We implement the FSI preconditioner in the</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="comment">class \c SimpleFSIPreconditioner. This class inherits</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;<span class="comment">from the base class \c BlockPreconditioner which provides the </span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;<span class="comment">generic functionality required for common block preconditioning operations.</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="comment">The overall structure of the class is similar to that of the</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="comment">preconditioners considered before, the main difference being that</span></div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;<span class="comment">we now store pointers to two meshes.</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="comment">\skipline start_of_simple_fsi_preconditioner</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;<span class="comment">\until };</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="comment">\subsubsection setup Preconditioner Setup</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;<span class="comment">We start by setting up the meshes,</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="comment">choosing the fluid mesh to be</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="comment">mesh \c 0 and the solid mesh to be mesh \c 1. The preconditioner therefore</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="comment">has four dof types enumerated in mesh order:</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="comment">- \c 0 fluid \f$x\f$ velocity (dof type 0 in mesh 0)</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="comment">- \c 1 fluid \f$y\f$ velocity (dof type 1 in mesh 0)</span></div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="comment">- \c 2 fluid pressure (dof type 2 in mesh 0)</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="comment">- \c 3 solid (dof type 0 in mesh 1)</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="comment">\skipline start_of_setup</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;<span class="comment">\until n_fluid_dof_type + this-&gt;ndof_types_in_mesh(1);</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;<span class="comment">Next we define the mapping from dof number to block</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="comment">number. The preconditioner has two block types -- fluid and solid --</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;<span class="comment">therefore we group the fluid dofs into block type \c 0 and the solid dofs</span></div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;<span class="comment">into block type \c 1. We define a map from dof type to block</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="comment">type in a vector (the vector indices denote the dof type and the</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;<span class="comment">vector elements denote the block type) and pass it to \c</span></div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;<span class="comment">block_setup(...) to complete the setup of the \c BlockPreconditioner </span></div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="comment">infrastructure.</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;<span class="comment">\skipline This fsi preconditioner has two types of block</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="comment">\until this-&gt;block_setup(dof_to_block_map);</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="comment">Next we set up the subsidiary</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="comment">operators required by the preconditioner. </span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<span class="comment">We start with the solid subsidiary preconditioner (\f$\tilde S\f$). We  extract</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;<span class="comment">the solid matrix block \f$S\f$ from the Jacobian using the \c</span></div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="comment">BlockPreconditioner method \c get_block(...) and then set up the solid</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;<span class="comment">subsidiary preconditioner:</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="comment">\skipline First the solid preconditioner</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="comment">\until delete solid_matrix_pt;</span></div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;<span class="comment">Note that, compared to the previous examples, we have used an </span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="comment">alternative, pointer-based version of the \c get_block(...) function.</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;<span class="comment">However, as before, the block matrix can be deleted once the </span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="comment">subsidiary preconditioner has been set up since the latter</span></div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;<span class="comment">retains whatever data it requires. </span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="comment">The fluid subsidiary preconditioner (\f$\tilde F\f$) a block preconditioner</span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;<span class="comment">itself. Its setup is therefore performed in two steps:</span></div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="comment">-# First we turn the \c NavierStokesSchurComplementPreconditioner</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="comment">   into a subsidiary block preconditioner. We assemble a list a fluid</span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="comment">   dof types in the current (master) preconditioner, and pass this list to the</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;<span class="comment">   Navier-Stokes preconditioner to indicate that dof type \c i in the</span></div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;<span class="comment">   master FSI preconditioner is dof type \c i in the subsidiary</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;<span class="comment">   fluid preconditioner (for \c i \c = \c 0, \c 1, \c 2) (Note that</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="comment">   the fact that this mapping is the identity mapping is a result of</span></div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;<span class="comment">   choosing the fluid mesh to be mesh \c 0; in general the index of \c</span></div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;<span class="comment">   ns_dof_list corresponds to the dof type number in the Navier Stokes</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;<span class="comment">   subsidiary preconditioner and the value corresponds to the index in</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;<span class="comment">   this master preconditioner).</span></div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;<span class="comment">\skipline Next the fluid preconditioner</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;<span class="comment">\until turn_into_subsidiary_block_preconditioner(this,ns_dof_list);</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;<span class="comment">-# Next we set up the \c NavierStokesSchurComplementPreconditioner.  We</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;<span class="comment">   pass the Navier-Stokes mesh to the the subsidiary preconditioner</span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;<span class="comment">   and set up the preconditioner. Note that the pointer to the full FSI</span></div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="comment">   Jacobian is passed to the subsidiary block preconditioner. This</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;<span class="comment">   allows the subsidiary preconditioner to extract the relevant</span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;<span class="comment">   sub-blocks, using the lookup schemes established by the call to \c</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;<span class="comment">   turn_into_subsidiary_block_preconditioner(...).</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="comment">\skipline Set up the NavierStokesSchurComplement preconditioner.</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="comment">\until Navier_stokes_preconditioner_pt-&gt;setup(this-&gt;matrix_pt());</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="comment">Finally, we set up is the matrix-vector product. This mirrors</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;<span class="comment">the set up of the solid subsidiary preconditioner. First the subsidiary</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="comment">matrix is extracted from the Jacobian and then the operator is set up:</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;<span class="comment">\skipline Finally the fluid onto solid matrix vector product operator</span></div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;<span class="comment">\until delete fluid_onto_solid_matrix_pt;</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;<span class="comment">Again, the extracted block can be deleted since the matrix vector</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;<span class="comment">product operator retains the relevant data.</span></div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;<span class="comment">The FSI preconditioner is now ready to be used. </span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;<span class="comment">\subsection solve Preconditioner Solve</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment">The \c preconditioner_solve(...) method applies  </span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment">the preconditioner to the input vector \f$\bf y\f$ and returns the </span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;<span class="comment">result in \f$\bf z\f$.</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;<span class="comment">We start by applying the Navier-Stokes preconditioner \f$\tilde</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;<span class="comment">F\f$ to the fluid elements \c y_f of \c y. Since \f$\tilde F\f$ is a </span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="comment">subsidiary block preconditioner  we apply it to the full-length</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;<span class="comment"> \c y and \c z vectors which contain both the fluid and solid </span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;<span class="comment">unknowns. The block preconditioning infrastructure utilised </span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;<span class="comment">within the \c NavierStokesSchurComplementPreconditioner will ensure that the </span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;<span class="comment">preconditioner only operates on fluid dofs.</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;<span class="comment">\skipline start_of_preconditioner_solve</span></div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;<span class="comment">\until Navier_stokes_preconditioner_pt-&gt;preconditioner_solve(y,z);</span></div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="comment">The fluid elements \c z_f of the vector \c z will now have been updated to</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="comment">contain the action of the SchurComplement preconditioner on the fluid </span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment">elements \c y_f of the vector \c y.</span></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="comment">To apply the fluid-solid coupling matrix vector product \f$C_{sf}\f$, </span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="comment">we copy the fluid elements from \c z into another vector \c z_f. We then apply</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="comment">the matrix-vector product operator to  \c z_f and store the result in a</span></div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="comment">vector \c w. Finally, we subtract \c w from the solid residuals </span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="comment">\c y_s and store the result in \c w to complete the application of </span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="comment">the matrix-vector product.</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="comment">\skipline Fluid Onto Solid Matrix Vector Product Operator</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;<span class="comment">\until w = y_s;</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="comment">Finally, we apply the solid subsidiary preconditioner \f$\tilde S\f$ to \c</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="comment">w and return the result to \c z. We note that because the solid subsidiary</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="comment">preconditioner is not a block preconditioner, the preconditioner solve</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="comment">method must be called with the solid block vectors. The result is then</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="comment">copied to the full-length vector \c z which contains the fluid and solid dofs.</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="comment">\dontinclude fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;<span class="comment">\skipline Solid Subsidiary Preconditioner</span></div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;<span class="comment">\section para Parallelisation</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;<span class="comment">We note that the above discussion did not address the parallelisation </span></div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;<span class="comment">of the preconditioners. This is because all the required parallel features</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="comment">are &quot;hidden&quot; within the block preconditioning framework which relies heavily on the</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="comment">library&#39;s </span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;<span class="comment">&lt;a href=&quot;../../../mpi/distributed_linear_algebra_infrastructure/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="comment">distributed linear algebra infrastructure.&lt;/a&gt; Any of the</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<span class="comment">preconditioners discussed in this tutorial can therefore be used </span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="comment">without change when \c oomph-lib is compiled with MPI support and if the </span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;<span class="comment">the executable is run on multiple processes.</span></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;<span class="comment">\section sources Source files for this tutorial</span></div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;<span class="comment">- The source file for the simple block diagonal preconditioner</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;<span class="comment">  for the linear elasticity problem is</span></div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/linear_solvers/simple_block_preconditioners.h&quot;&gt;</span></div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="comment">demo_drivers/linear_solvers/simple_block_preconditioners.h</span></div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;<span class="comment">\n</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;<span class="comment">- The driver code demonstrating the use of the simple block </span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;<span class="comment">  diagonal preconditioner for the linear elasticity problem is</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/linear_solvers/two_d_linear_elasticity_with_simple_block_diagonal_preconditioner.cc&quot;&gt;</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="comment">demo_drivers/linear_solvers/two_d_linear_elasticity_with_simple_block_diagonal_preconditioner.cc</span></div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="comment">\n</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="comment">- The source files for the &quot;multi-poisson&quot; preconditioners and the</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="comment">serial driver codes are located in the directory:</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/linear_solvers/&quot;&gt;</span></div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="comment">demo_drivers/linear_solvers/</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="comment">\n</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="comment">- The serial &quot;multi-poisson&quot; driver code (which demonstrates the use</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="comment">  of the various &quot;multi-poisson&quot; preconditioners discussed above) is:</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/linear_solvers/two_d_multi_poisson.cc&quot;&gt;</span></div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="comment">demo_drivers/poisson/two_d_multi_poisson.cc</span></div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="comment">\n</span></div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;<span class="comment">- The parallel counterpart is here (note that, as claimed, this code</span></div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;<span class="comment">  uses exactly the same preconditioners as the serial version):</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/mpi/solvers/two_d_multi_poisson.cc&quot;&gt;</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;<span class="comment">demo_drivers/mpi/solvers/two_d_multi_poisson.cc</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="comment">\n</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="comment">- The (parallel) driver code which demonstrates the implementation and </span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="comment">  use of the simple FSI preconditioner (for the &quot;channel with leaflet&quot; problem)</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="comment">  is here:</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/mpi/solvers/fsi_channel_with_leaflet.cc&quot;&gt;</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;<span class="comment">demo_drivers/mpi/solvers/fsi_channel_with_leaflet.cc</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;<span class="comment">\n</span></div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="comment">\section pdf PDF file</span></div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="comment">A &lt;a href=&quot;../latex/refman.pdf&quot;&gt;pdf version&lt;/a&gt; of this document is available.</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="comment">**/</span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="ablock__preconditioners_8txt_html_a8dca676574339d2e48d1ea2d8fde0784"><div class="ttname"><a href="block__preconditioners_8txt.html#a8dca676574339d2e48d1ea2d8fde0784">$J_</a></div><div class="ttdeci">etc Within a given preconditioner such derived matrices are typically pre computed by the preconditioner s c this approach does not work if the modified block is to be used in a subsidiary block preconditioner as discussed in the previous by default the subsidiary block preconditioner will extract its block matrices directly from the full size system matrix and will therefore ignore namely f[\hspace{3cm}{\bf P}_{\rm previous}=\left(\begin{array}{cc|ccc}J_{11} &amp;J_{12} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\J_{21} &amp;J_{22} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\\hline &amp;&amp;J_{33} &amp;J_{34} &amp;J_{35} \\ &amp;&amp;J_{43} &amp;J_{44} &amp;J_{45} \\ &amp;&amp;J_{53} &amp;J_{54} &amp;J_{55} \\\end{array}\right).\hspace{3cm} @E[eqn:two_plus_three_upper_triangular_with_sub_again]@\f] here we want to modify the off diagonal blocks by replacing each block f $J_</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01740">block_preconditioners.txt:1740</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aaa4a7aca829f4e6216b9f8ac69a68022"><div class="ttname"><a href="block__preconditioners_8txt.html#aaa4a7aca829f4e6216b9f8ac69a68022">meshes</a></div><div class="ttdeci">etc n n b Role b of b meshes</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00230">block_preconditioners.txt:230</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a34d93e8cb0f9edca86453c642fcc5c71"><div class="ttname"><a href="block__preconditioners_8txt.html#a34d93e8cb0f9edca86453c642fcc5c71">elements</a></div><div class="ttdeci">for two dimensional c QTaylorHoodElement&lt; 2 &gt; Navier Stokes elements</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00225">block_preconditioners.txt:225</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a0229a9a76573f31c1a563ccbe15b5e8b"><div class="ttname"><a href="block__preconditioners_8txt.html#a0229a9a76573f31c1a563ccbe15b5e8b">dof</a></div><div class="ttdeci">f $x f velocity dofs are labelled f $y f velocity dofs are labelled c and the pressure dofs are labelled c n n The solid elements are of type c FSIHermiteBeamElement They have one type of dof(the nodal position) labelled \c 0. . When classifying the dofs we specify the elements via two separate meshes</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a200481dd99050de703e95310b8d7188a"><div class="ttname"><a href="block__preconditioners_8txt.html#a200481dd99050de703e95310b8d7188a">velocities</a></div><div class="ttdeci">for two dimensional c QTaylorHoodElement&lt; 2 &gt; Navier Stokes the dof types are classified as c and c for the f x f and f $y f velocities</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00227">block_preconditioners.txt:227</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ae1460894b4d4b6fe6973b1d327aedef0"><div class="ttname"><a href="block__preconditioners_8txt.html#ae1460894b4d4b6fe6973b1d327aedef0">memory</a></div><div class="ttdeci">subsubsection upper_triangular_setup The we start by cleaning up the memory</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00768">block_preconditioners.txt:768</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aeef45233f4d17b9819e1856bb579fcf7"><div class="ttname"><a href="block__preconditioners_8txt.html#aeef45233f4d17b9819e1856bb579fcf7">represent</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which represent</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00250">block_preconditioners.txt:250</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ab262b0617d34be2c7573cc2bd4a1ff19"><div class="ttname"><a href="block__preconditioners_8txt.html#ab262b0617d34be2c7573cc2bd4a1ff19">u_y</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f u_y</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00251">block_preconditioners.txt:251</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aee0b46a7944d413c53157110d1f7f4d7"><div class="ttname"><a href="block__preconditioners_8txt.html#aee0b46a7944d413c53157110d1f7f4d7">example</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f p f Note that if certain degrees of freedom are classified by multiple the most recent assignment of the dof type over writes previous assignments The order in which meshes are specified therefore matters n A corollary to this is that a block preconditioner does not need to know about elements that do not introduce any new unknowns For c FaceElements that apply Neumann flux boundary conditions operate on dofs that are already contained if a c FaceElement imposes a boundary condition via Lagrange the dofs that represent these Lagrange multipliers must be classified by the c FaceElements since the bulk elements are not aware of them n If c oomph lib is compiled with the c PARANOID an error is thrown if any of the global unknowns are not associated with a dof type n n b each block is associated with exactly one dof type it is possible create compound blocks that are associated with more than one dof type For example</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00274">block_preconditioners.txt:274</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a193d0baa9ebd9824d79e8e7a441aea18"><div class="ttname"><a href="block__preconditioners_8txt.html#a193d0baa9ebd9824d79e8e7a441aea18">However</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f p f Note that if certain degrees of freedom are classified by multiple the most recent assignment of the dof type over writes previous assignments The order in which meshes are specified therefore matters n A corollary to this is that a block preconditioner does not need to know about elements that do not introduce any new unknowns For c FaceElements that apply Neumann flux boundary conditions operate on dofs that are already contained if a c FaceElement imposes a boundary condition via Lagrange the dofs that represent these Lagrange multipliers must be classified by the c FaceElements since the bulk elements are not aware of them n If c oomph lib is compiled with the c PARANOID an error is thrown if any of the global unknowns are not associated with a dof type n n b each block is associated with exactly one dof type However</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00273">block_preconditioners.txt:273</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a57ad40a9de7c2a027446e1e0b32aa678"><div class="ttname"><a href="block__preconditioners_8txt.html#a57ad40a9de7c2a027446e1e0b32aa678">before</a></div><div class="ttdeci">Next we set up the subsidiary operators required by the preconditioner We start with the solid subsidiary preconditioner(\f$\tilde S\f$). We extract the solid matrix block \f $S\f$ from the Jacobian using the \c BlockPreconditioner method \c get_block(...) and then set up the solid subsidiary preconditioner Note compared to the previous we have used an pointer based version of the c as before</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l02508">block_preconditioners.txt:2508</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a0649c02e803dc777d23f36fbd74b0180"><div class="ttname"><a href="block__preconditioners_8txt.html#a0649c02e803dc777d23f36fbd74b0180">Thus</a></div><div class="ttdeci">Thus</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00182">block_preconditioners.txt:182</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a1f8ac598ec2e995f720ab41e50da1de6"><div class="ttname"><a href="block__preconditioners_8txt.html#a1f8ac598ec2e995f720ab41e50da1de6">until</a></div><div class="ttdeci">etc Within a given preconditioner such derived matrices are typically pre computed by the preconditioner s c this approach does not work if the modified block is to be used in a subsidiary block preconditioner as discussed in the previous by default the subsidiary block preconditioner will extract its block matrices directly from the full size system matrix and will therefore ignore namely f[\hspace{3cm}{\bf P}_{\rm previous}=\left(\begin{array}{cc|ccc}J_{11} &amp;J_{12} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\J_{21} &amp;J_{22} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\\hline &amp;&amp;J_{33} &amp;J_{34} &amp;J_{35} \\ &amp;&amp;J_{43} &amp;J_{44} &amp;J_{45} \\ &amp;&amp;J_{53} &amp;J_{54} &amp;J_{55} \\\end{array}\right).\hspace{3cm} @E[eqn:two_plus_three_upper_triangular_with_sub_again]@\f] here we want to modify the off diagonal blocks by replacing each block f so that the actual preconditioning operation is defined by the following linear systems f[\begin{array}{c}\underbrace{\left(\begin{array}{cc}J_{11} &amp;\\&amp;J_{22} \\\end{array}\right) }_{B_{11}}\left(\begin{array}{c}y_1 \\y_2 \\\end{array}\right)=\left(\begin{array}{c}z_1 \\ z_2 \\\end{array}\right) - \underbrace{\left(\begin{array}{ccc}&amp;&amp;\\ &amp;&amp;\\\end{array}\right) }_{B_{12}}\left(\begin{array}{c}z_3 \\z_4 \\z_5 \\\end{array}\right)\\\underbrace{\left(\begin{array}{ccc}J_{33} &amp;&amp;\\&amp;J_{44} &amp;\\ &amp;&amp;J_{55} \\\end{array}\right) }_{B_{22}}\left(\begin{array}{c}y_3 \\y_4 \\y_5 \\\end{array}\right)=\left(\begin{array}{c}z_3 \\ z_4 \\z_5 \\\end{array}\right)\end{array}\f] in turns the preconditioner into the block diagonal preconditioner considered at the very beginning of this tutorial subsubsection two_plus_three_upper_triangular_with_replace_implementation Implementation as a BlockPreconditioner The implementation of the preconditioner is completely equivalent to the preconditioner considered in the previous example The only additional feature is the provision a matrix of pointers to the replacement c Replacement_matrix_pt skip start_of_two_plus_three_upper_triangular_with_replace_class until</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01922">block_preconditioners.txt:1922</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_afef8e6dcbfc02329c57027873826e842"><div class="ttname"><a href="block__preconditioners_8txt.html#afef8e6dcbfc02329c57027873826e842">Blocks</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f p f Note that if certain degrees of freedom are classified by multiple the most recent assignment of the dof type over writes previous assignments The order in which meshes are specified therefore matters n A corollary to this is that a block preconditioner does not need to know about elements that do not introduce any new unknowns For c FaceElements that apply Neumann flux boundary conditions operate on dofs that are already contained if a c FaceElement imposes a boundary condition via Lagrange the dofs that represent these Lagrange multipliers must be classified by the c FaceElements since the bulk elements are not aware of them n If c oomph lib is compiled with the c PARANOID an error is thrown if any of the global unknowns are not associated with a dof type n n b Blocks</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00272">block_preconditioners.txt:272</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a2dc57b0d0963b87058d0d3c56b259bb7"><div class="ttname"><a href="block__preconditioners_8txt.html#a2dc57b0d0963b87058d0d3c56b259bb7">worked</a></div><div class="ttdeci">subsubsection two_plus_three_setup The we start by freeing up any previously allocated and set the pointer to the we specify the mapping between dof types and block types as an argument to the c block_setup(...) function This is done by creating vector of length \c ndof_type() in which each entry indicates the block that the corresponding dof is supposed to end up in To show that this actually worked</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01020">block_preconditioners.txt:1020</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a8827906ff74d898ef20bb0e9605e7e65"><div class="ttname"><a href="block__preconditioners_8txt.html#a8827906ff74d898ef20bb0e9605e7e65">examples</a></div><div class="ttdeci">Next we set up the subsidiary operators required by the preconditioner We start with the solid subsidiary preconditioner(\f$\tilde S\f$). We extract the solid matrix block \f $S\f$ from the Jacobian using the \c BlockPreconditioner method \c get_block(...) and then set up the solid subsidiary preconditioner Note compared to the previous examples</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l02506">block_preconditioners.txt:2506</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_af3798041dc02c8f13d4f80a123623077"><div class="ttname"><a href="block__preconditioners_8txt.html#af3798041dc02c8f13d4f80a123623077">side</a></div><div class="ttdeci">c block_z now contains the updated right hand side</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01653">block_preconditioners.txt:1653</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_adfe6b2bdd05330e241df296c09b1de2a"><div class="ttname"><a href="block__preconditioners_8txt.html#adfe6b2bdd05330e241df296c09b1de2a">because</a></div><div class="ttdeci">etc Within a given preconditioner such derived matrices are typically pre computed by the preconditioner s c this approach does not work if the modified block is to be used in a subsidiary block preconditioner because</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01712">block_preconditioners.txt:1712</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a2b4b9251f6537b3869c3b68d2e16246c"><div class="ttname"><a href="block__preconditioners_8txt.html#a2b4b9251f6537b3869c3b68d2e16246c">directions</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f directions</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00204">block_preconditioners.txt:204</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a8eaf6a27a1ad9459eb051d39b708b2c4"><div class="ttname"><a href="block__preconditioners_8txt.html#a8eaf6a27a1ad9459eb051d39b708b2c4">y</a></div><div class="ttdeci">subsubsection two_plus_three_upper_triangular_with_sub_setup The setup() function As usual we free up any memory and set the pointer to the mesh Next we create the block triangular preconditioner used to(approximately) solve linear systems involving the compound &quot;top left&quot; 2x2 block We now extract the block vector f Y_2 f from the full length vector c y</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01582">block_preconditioners.txt:1582</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_abc882676ce6535f83eef31e4c8889d44"><div class="ttname"><a href="block__preconditioners_8txt.html#abc882676ce6535f83eef31e4c8889d44">problem</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f respectively They are enumerated as dof types respectively subsection dof_types_and_block_types dof compound blocks and meshes In the block diagonal preconditioner for the two dimensional linear elasticity problem</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00210">block_preconditioners.txt:210</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aaf03ab00a2b72ebf8eb969dedc66e5d4"><div class="ttname"><a href="block__preconditioners_8txt.html#aaf03ab00a2b72ebf8eb969dedc66e5d4">scope</a></div><div class="ttdeci">We create the two subsidiary preconditioners and pass the two diagonal blocks f the deep copies of these matrices are then allowed to go out of scope</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01217">block_preconditioners.txt:1217</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a18f05aeddc212b523b40818fa2b87b33"><div class="ttname"><a href="block__preconditioners_8txt.html#a18f05aeddc212b523b40818fa2b87b33">_</a></div><div class="ttdeci">_</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00154">block_preconditioners.txt:154</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a52086336de840f7dda01f56e7d1cf1ed"><div class="ttname"><a href="block__preconditioners_8txt.html#a52086336de840f7dda01f56e7d1cf1ed">be</a></div><div class="ttdeci">c block_z now contains the updated right hand f for the linear system to be(approximately) solved by the first subsidiary block preconditioner. We therefore return \f$ \widehat</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01654">block_preconditioners.txt:1654</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a09ffc1a7d36a15270a2438aafabc3063"><div class="ttname"><a href="block__preconditioners_8txt.html#a09ffc1a7d36a15270a2438aafabc3063">c</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f respectively They are enumerated as dof types respectively subsection dof_types_and_block_types dof compound blocks and meshes In the block diagonal preconditioner for the two dimensional linear elasticity discussed we have dof types that correspond directly to the blocks in as we will demonstrate&lt; a href=&quot;#compound&quot;&gt; it is also possible to combine the blocks associated with multiple dofs into a block the elemental dof type classification and meshes are as follows b Elemental b dof b type b the dof types are classified as c and c</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00223">block_preconditioners.txt:223</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a115e3d779dcec89667c9b94b99e95f86"><div class="ttname"><a href="block__preconditioners_8txt.html#a115e3d779dcec89667c9b94b99e95f86">get_block</a></div><div class="ttdeci">Next we set up the subsidiary operators required by the preconditioner We start with the solid subsidiary preconditioner(\f$\tilde S\f$). We extract the solid matrix block \f $S\f$ from the Jacobian using the \c BlockPreconditioner method \c get_block(...) and then set up the solid subsidiary preconditioner Note compared to the previous we have used an pointer based version of the c get_block(...) function. However</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a96c78e69860b4a260200153986dca152"><div class="ttname"><a href="block__preconditioners_8txt.html#a96c78e69860b4a260200153986dca152">multipliers</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f p f Note that if certain degrees of freedom are classified by multiple the most recent assignment of the dof type over writes previous assignments The order in which meshes are specified therefore matters n A corollary to this is that a block preconditioner does not need to know about elements that do not introduce any new unknowns For c FaceElements that apply Neumann flux boundary conditions operate on dofs that are already contained if a c FaceElement imposes a boundary condition via Lagrange multipliers</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00262">block_preconditioners.txt:262</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aeb67b16f41be1903f840dc845012c7ec"><div class="ttname"><a href="block__preconditioners_8txt.html#aeb67b16f41be1903f840dc845012c7ec">B_</a></div><div class="ttdeci">We create the two subsidiary preconditioners and pass the two diagonal blocks f B_</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01215">block_preconditioners.txt:1215</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a484447fc0413c753fa95dcff66bc063b"><div class="ttname"><a href="block__preconditioners_8txt.html#a484447fc0413c753fa95dcff66bc063b">matrices</a></div><div class="ttdeci">etc Within a given preconditioner such derived matrices are typically pre computed by the preconditioner s c this approach does not work if the modified block is to be used in a subsidiary block preconditioner as discussed in the previous by default the subsidiary block preconditioner will extract its block matrices directly from the full size system matrix and will therefore ignore namely f[\hspace{3cm}{\bf P}_{\rm previous}=\left(\begin{array}{cc|ccc}J_{11} &amp;J_{12} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\J_{21} &amp;J_{22} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\\hline &amp;&amp;J_{33} &amp;J_{34} &amp;J_{35} \\ &amp;&amp;J_{43} &amp;J_{44} &amp;J_{45} \\ &amp;&amp;J_{53} &amp;J_{54} &amp;J_{55} \\\end{array}\right).\hspace{3cm} @E[eqn:two_plus_three_upper_triangular_with_sub_again]@\f] here we want to modify the off diagonal blocks by replacing each block f so that the actual preconditioning operation is defined by the following linear systems f[\begin{array}{c}\underbrace{\left(\begin{array}{cc}J_{11} &amp;\\&amp;J_{22} \\\end{array}\right) }_{B_{11}}\left(\begin{array}{c}y_1 \\y_2 \\\end{array}\right)=\left(\begin{array}{c}z_1 \\ z_2 \\\end{array}\right) - \underbrace{\left(\begin{array}{ccc}&amp;&amp;\\ &amp;&amp;\\\end{array}\right) }_{B_{12}}\left(\begin{array}{c}z_3 \\z_4 \\z_5 \\\end{array}\right)\\\underbrace{\left(\begin{array}{ccc}J_{33} &amp;&amp;\\&amp;J_{44} &amp;\\ &amp;&amp;J_{55} \\\end{array}\right) }_{B_{22}}\left(\begin{array}{c}y_3 \\y_4 \\y_5 \\\end{array}\right)=\left(\begin{array}{c}z_3 \\ z_4 \\z_5 \\\end{array}\right)\end{array}\f] in turns the preconditioner into the block diagonal preconditioner considered at the very beginning of this tutorial subsubsection two_plus_three_upper_triangular_with_replace_implementation Implementation as a BlockPreconditioner The implementation of the preconditioner is completely equivalent to the preconditioner considered in the previous example The only additional feature is the provision a matrix of pointers to the replacement matrices</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01919">block_preconditioners.txt:1919</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aabbfaa0fa9b8b1653ecd2bcaa42f0f21"><div class="ttname"><a href="block__preconditioners_8txt.html#aabbfaa0fa9b8b1653ecd2bcaa42f0f21">setup</a></div><div class="ttdeci">subsubsection diag_setup The setup() function As mentioned above</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01643">block_preconditioners.txt:1643</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a08e7242cb7e94e970ab57fb65ac4802d"><div class="ttname"><a href="block__preconditioners_8txt.html#a08e7242cb7e94e970ab57fb65ac4802d">preconditioners</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s in a multi physics typically represent different physical quantities A key feature of the framework is that it allows existing block preconditioners(which were developed for a particular single-physics application, say) to be re-used</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_afd557303c309688729c726ec6a5fe6d6"><div class="ttname"><a href="block__preconditioners_8txt.html#afd557303c309688729c726ec6a5fe6d6">alternative</a></div><div class="ttdeci">Next we set up the subsidiary operators required by the preconditioner We start with the solid subsidiary preconditioner(\f$\tilde S\f$). We extract the solid matrix block \f $S\f$ from the Jacobian using the \c BlockPreconditioner method \c get_block(...) and then set up the solid subsidiary preconditioner Note compared to the previous we have used an alternative</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l02507">block_preconditioners.txt:2507</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a5f58c231f40819314e5963748a9eb208"><div class="ttname"><a href="block__preconditioners_8txt.html#a5f58c231f40819314e5963748a9eb208">effect</a></div><div class="ttdeci">etc Within a given preconditioner such derived matrices are typically pre computed by the preconditioner s c this approach does not work if the modified block is to be used in a subsidiary block preconditioner as discussed in the previous by default the subsidiary block preconditioner will extract its block matrices directly from the full size system matrix and will therefore ignore namely f[\hspace{3cm}{\bf P}_{\rm previous}=\left(\begin{array}{cc|ccc}J_{11} &amp;J_{12} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\J_{21} &amp;J_{22} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\\hline &amp;&amp;J_{33} &amp;J_{34} &amp;J_{35} \\ &amp;&amp;J_{43} &amp;J_{44} &amp;J_{45} \\ &amp;&amp;J_{53} &amp;J_{54} &amp;J_{55} \\\end{array}\right).\hspace{3cm} @E[eqn:two_plus_three_upper_triangular_with_sub_again]@\f] here we want to modify the off diagonal blocks by replacing each block f so that the actual preconditioning operation is defined by the following linear systems f[\begin{array}{c}\underbrace{\left(\begin{array}{cc}J_{11} &amp;\\&amp;J_{22} \\\end{array}\right) }_{B_{11}}\left(\begin{array}{c}y_1 \\y_2 \\\end{array}\right)=\left(\begin{array}{c}z_1 \\ z_2 \\\end{array}\right) - \underbrace{\left(\begin{array}{ccc}&amp;&amp;\\ &amp;&amp;\\\end{array}\right) }_{B_{12}}\left(\begin{array}{c}z_3 \\z_4 \\z_5 \\\end{array}\right)\\\underbrace{\left(\begin{array}{ccc}J_{33} &amp;&amp;\\&amp;J_{44} &amp;\\ &amp;&amp;J_{55} \\\end{array}\right) }_{B_{22}}\left(\begin{array}{c}y_3 \\y_4 \\y_5 \\\end{array}\right)=\left(\begin{array}{c}z_3 \\ z_4 \\z_5 \\\end{array}\right)\end{array}\f] in effect</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01910">block_preconditioners.txt:1910</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ad929b1cb755dfec91450fd4b3154900e"><div class="ttname"><a href="block__preconditioners_8txt.html#ad929b1cb755dfec91450fd4b3154900e">Finally</a></div><div class="ttdeci">Finally</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l02540">block_preconditioners.txt:2540</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a3c39f4dd15f1636fd017dfb66d0c71b2"><div class="ttname"><a href="block__preconditioners_8txt.html#a3c39f4dd15f1636fd017dfb66d0c71b2">blocks</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f respectively They are enumerated as dof types respectively subsection dof_types_and_block_types dof blocks</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00207">block_preconditioners.txt:207</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a3c8ce4610088ab0019d3e1fc8c85fe12"><div class="ttname"><a href="block__preconditioners_8txt.html#a3c8ce4610088ab0019d3e1fc8c85fe12">that</a></div><div class="ttdeci">Next we set up the subsidiary operators required by the preconditioner We start with the solid subsidiary preconditioner(\f$\tilde S\f$). We extract the solid matrix block \f $S\f$ from the Jacobian using the \c BlockPreconditioner method \c get_block(...) and then set up the solid subsidiary preconditioner Note that</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l02497">block_preconditioners.txt:2497</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_abe9bd46ad255a73882365ebfb1d80d11"><div class="ttname"><a href="block__preconditioners_8txt.html#abe9bd46ad255a73882365ebfb1d80d11">mesh</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is mesh</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00249">block_preconditioners.txt:249</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a33449913d105ccbc0cdc7540818f248f"><div class="ttname"><a href="block__preconditioners_8txt.html#a33449913d105ccbc0cdc7540818f248f">above</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f respectively They are enumerated as dof types respectively subsection dof_types_and_block_types dof compound blocks and meshes In the block diagonal preconditioner for the two dimensional linear elasticity discussed above</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00210">block_preconditioners.txt:210</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aaf7927e6571f2774f7f329ecd83d3806"><div class="ttname"><a href="block__preconditioners_8txt.html#aaf7927e6571f2774f7f329ecd83d3806">simple</a></div><div class="ttdeci">f introduced with the aim of accelerating the convergence of Krylov subspace solvers such as GMRES or CG The application of the preconditioner requires the solution of f[{\bf P}{\bf z}={\bf y}\f] for f bf z f at each Krylov iteration Block preconditioners are in linear elasticity the re ordered linear system for a two dimensional problem then has the form f[\left[\begin{array}{cc}{\bf J}_{xx}&amp;{\bf J}_{xy}\\{\bf J}_{xy}&amp;{\bf J}_{yy}\end{array}\right]\left[\begin{array}{c}\bf \delta x_x\\\bf \delta x_y\\\end{array}\right]=-\left[\begin{array}{c}\bf r_x\\\bf r_y\\\end{array}\right].\f] A simple(and, in fact, quite effective) block preconditioner for this linear system can be formed by retaining only the diagonal blocks of the system matrix</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a72cb1ad0497d2b223b25bd20fdeac691"><div class="ttname"><a href="block__preconditioners_8txt.html#a72cb1ad0497d2b223b25bd20fdeac691">problems</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s in a multi physics typically represent different physical quantities A key feature of the framework is that it allows existing block in a hierarchical in block preconditioners for related multi physics problems This means that existing Navier Stokes and solid mechanics preconditioners can be used to create preconditioners for fluid structure interaction problems</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00018">block_preconditioners.txt:18</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ac7db1f78b75f7c5bbe6713e45126300f"><div class="ttname"><a href="block__preconditioners_8txt.html#ac7db1f78b75f7c5bbe6713e45126300f">u_x</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f u_x</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00251">block_preconditioners.txt:251</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_afe28b4a00afbea6be3522696074abc04"><div class="ttname"><a href="block__preconditioners_8txt.html#afe28b4a00afbea6be3522696074abc04">block_setup</a></div><div class="ttdeci">Next we set the pointer to the preconditioner s one and only and call the c block_setup() function to set up the internal data structures and lookup tables required to extract blocks from the system matrix. \until this -&gt; block_setup()</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01036">block_preconditioners.txt:1036</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aaf4e33e2bac366e56327e2c241ad0c39"><div class="ttname"><a href="block__preconditioners_8txt.html#aaf4e33e2bac366e56327e2c241ad0c39">based</a></div><div class="ttdeci">f introduced with the aim of accelerating the convergence of Krylov subspace solvers such as GMRES or CG The application of the preconditioner requires the solution of f[{\bf P}{\bf z}={\bf y}\f] for f bf z f at each Krylov iteration Block preconditioners are based(at least formally) on a reordering of the linear system such that related unknowns(e.g. dofs representing the same physical quantity) are grouped together and enumerated consecutively. For instance</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a4d019f81d6887d2717310ff513cc3776"><div class="ttname"><a href="block__preconditioners_8txt.html#a4d019f81d6887d2717310ff513cc3776">flag</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f p f Note that if certain degrees of freedom are classified by multiple the most recent assignment of the dof type over writes previous assignments The order in which meshes are specified therefore matters n A corollary to this is that a block preconditioner does not need to know about elements that do not introduce any new unknowns For c FaceElements that apply Neumann flux boundary conditions operate on dofs that are already contained if a c FaceElement imposes a boundary condition via Lagrange the dofs that represent these Lagrange multipliers must be classified by the c FaceElements since the bulk elements are not aware of them n If c oomph lib is compiled with the c PARANOID flag</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00267">block_preconditioners.txt:267</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_acaf80ed170cd83e90a69d47f31c29ff8"><div class="ttname"><a href="block__preconditioners_8txt.html#acaf80ed170cd83e90a69d47f31c29ff8">Again</a></div><div class="ttdeci">Again</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l02548">block_preconditioners.txt:2548</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a7994473b56f803aacabc944c5e43c208"><div class="ttname"><a href="block__preconditioners_8txt.html#a7994473b56f803aacabc944c5e43c208">a</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s in a multi physics typically represent different physical quantities A key feature of the framework is that it allows existing block in a hierarchical in block preconditioners for related multi physics problems This means that existing Navier Stokes and solid mechanics preconditioners can be used to create preconditioners for fluid structure interaction say Following a brief overview of the underlying ideas and their implementation in c oomph lib this tutorial discusses a sequence of increasingly complex block preconditioners that illustrate the framework s capabilities in the context of a(rather artificial) model problem. The final example illustrates a simple implementation of a block preconditioner for an FSI problem. We conclude with a few comments on the use of block preconditioners in parallel. Other tutorials discuss how the methodology is used in &quot;real&quot; preconditioners. See</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a6160c80ae325c9704514a171abc7cf33"><div class="ttname"><a href="block__preconditioners_8txt.html#a6160c80ae325c9704514a171abc7cf33">$C_</a></div><div class="ttdeci">The fluid elements c z_f of the vector c z will now have been updated to contain the action of the SchurComplement preconditioner on the fluid elements c y_f of the vector c y To apply the fluid solid coupling matrix vector product f $C_</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l02576">block_preconditioners.txt:2576</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_acb2aec021f42d03f2963c9629bd28efb"><div class="ttname"><a href="block__preconditioners_8txt.html#acb2aec021f42d03f2963c9629bd28efb">and</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f respectively They are enumerated as dof types and</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00205">block_preconditioners.txt:205</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a1588f3a894c121120972cf2a5b4c9ac3"><div class="ttname"><a href="block__preconditioners_8txt.html#a1588f3a894c121120972cf2a5b4c9ac3">z</a></div><div class="ttdeci">f to the appropriate entries into a full length vector of the same size as right hand side vector c z</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01670">block_preconditioners.txt:1670</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ab470c8153e3640819d298cb146c946a6"><div class="ttname"><a href="block__preconditioners_8txt.html#ab470c8153e3640819d298cb146c946a6">widehat</a></div><div class="ttdeci">c block_z now contains the updated right hand f widehat</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01653">block_preconditioners.txt:1653</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ad2056ca39a35b38b9f9e0ae618268b2a"><div class="ttname"><a href="block__preconditioners_8txt.html#ad2056ca39a35b38b9f9e0ae618268b2a">types</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f respectively They are enumerated as dof types respectively subsection dof_types_and_block_types dof types</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00207">block_preconditioners.txt:207</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ad0ee0679531b605bbf1858439863e635"><div class="ttname"><a href="block__preconditioners_8txt.html#ad0ee0679531b605bbf1858439863e635">the</a></div><div class="ttdeci">f introduced with the aim of accelerating the convergence of Krylov subspace solvers such as GMRES or CG The application of the preconditioner requires the solution of f[{\bf P}{\bf z}={\bf y}\f] for f bf z f at each Krylov iteration Block preconditioners are in linear elasticity the(discrete) unknowns can be sub-divided according to which component of the displacement vector they represent. Using this classification of the dofs</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a2b6c7a2e8d2a64d9605b3058eab04e50"><div class="ttname"><a href="block__preconditioners_8txt.html#a2b6c7a2e8d2a64d9605b3058eab04e50">with</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s in a multi physics typically represent different physical quantities A key feature of the framework is that it allows existing block in a hierarchical in block preconditioners for related multi physics problems This means that existing Navier Stokes and solid mechanics preconditioners can be used to create preconditioners for fluid structure interaction say Following a brief overview of the underlying ideas and their implementation in c oomph lib this tutorial discusses a sequence of increasingly complex block preconditioners that illustrate the framework s capabilities in the context of for the tutorials discussing c oomph lib s&lt; a href=&quot;../../distributed_general_purpose_block_preconditioners/html/index.html&quot;&gt; general purpose block preconditioners&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/lsc_navier_stokes/html/index.html&quot;&gt; NavierStokesSchurComplementPreconditioner for Navier Stokes problems&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/fsi/html/index.html&quot;&gt; FSIPreconditioner for monolithically discretised fluid structure interaction problems&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/prescribed_displ_lagr_mult/html/index.html&quot;&gt; preconditioner for large displacement solid mechanics problems in which boundary displacements are prescribed&lt;/a &gt; n n The previous preconditioner is mainly used as a subsidiary block preconditioner for the&lt; a href=&quot;../../../preconditioners/pseudo_solid_fsi/html/index.html&quot;&gt; solution of fluid structure interaction problems with(pseudo-) solid fluid mesh updates.&lt;/a &gt; \n\n . \section theory Theoretical background In \c oomph-lib</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a622e9a161fe300e2ba2f734430187e19"><div class="ttname"><a href="block__preconditioners_8txt.html#a622e9a161fe300e2ba2f734430187e19">pressure</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the pressure</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00246">block_preconditioners.txt:246</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a0cfa4c4b32ab0817b1bd25e7b988427c"><div class="ttname"><a href="block__preconditioners_8txt.html#a0cfa4c4b32ab0817b1bd25e7b988427c">v_y</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f v_y</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00251">block_preconditioners.txt:251</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a50c4aa1bb274547431cb31cf515d2b1f"><div class="ttname"><a href="block__preconditioners_8txt.html#a50c4aa1bb274547431cb31cf515d2b1f">context</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s in a multi physics context</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00010">block_preconditioners.txt:10</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a4b5cfadf429584e0826f6ca83f3298aa"><div class="ttname"><a href="block__preconditioners_8txt.html#a4b5cfadf429584e0826f6ca83f3298aa">which</a></div><div class="ttdeci">etc Within a given preconditioner such derived matrices are typically pre computed by the preconditioner s c this approach does not work if the modified block is to be used in a subsidiary block preconditioner as discussed in the previous by default the subsidiary block preconditioner will extract its block matrices directly from the full size system matrix and will therefore ignore namely f[\hspace{3cm}{\bf P}_{\rm previous}=\left(\begin{array}{cc|ccc}J_{11} &amp;J_{12} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\J_{21} &amp;J_{22} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\\hline &amp;&amp;J_{33} &amp;J_{34} &amp;J_{35} \\ &amp;&amp;J_{43} &amp;J_{44} &amp;J_{45} \\ &amp;&amp;J_{53} &amp;J_{54} &amp;J_{55} \\\end{array}\right).\hspace{3cm} @E[eqn:two_plus_three_upper_triangular_with_sub_again]@\f] here we want to modify the off diagonal blocks by replacing each block f so that the actual preconditioning operation is defined by the following linear systems f[\begin{array}{c}\underbrace{\left(\begin{array}{cc}J_{11} &amp;\\&amp;J_{22} \\\end{array}\right) }_{B_{11}}\left(\begin{array}{c}y_1 \\y_2 \\\end{array}\right)=\left(\begin{array}{c}z_1 \\ z_2 \\\end{array}\right) - \underbrace{\left(\begin{array}{ccc}&amp;&amp;\\ &amp;&amp;\\\end{array}\right) }_{B_{12}}\left(\begin{array}{c}z_3 \\z_4 \\z_5 \\\end{array}\right)\\\underbrace{\left(\begin{array}{ccc}J_{33} &amp;&amp;\\&amp;J_{44} &amp;\\ &amp;&amp;J_{55} \\\end{array}\right) }_{B_{22}}\left(\begin{array}{c}y_3 \\y_4 \\y_5 \\\end{array}\right)=\left(\begin{array}{c}z_3 \\ z_4 \\z_5 \\\end{array}\right)\end{array}\f] which</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01910">block_preconditioners.txt:1910</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_acc5ad71a6a78c4a43d21e4fc3970f5b6"><div class="ttname"><a href="block__preconditioners_8txt.html#acc5ad71a6a78c4a43d21e4fc3970f5b6">unknowns</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s unknowns(degrees of freedom;here abbreviated as dofs) into different &quot;dof types&quot; which</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a87d508f461f9f352933f880a0e1a576b"><div class="ttname"><a href="block__preconditioners_8txt.html#a87d508f461f9f352933f880a0e1a576b">via</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements via(possibly multiple) meshes(here simply interpreted as containers for elements)</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a7005143667a7d93ac15567de99c9459d"><div class="ttname"><a href="block__preconditioners_8txt.html#a7005143667a7d93ac15567de99c9459d">any</a></div><div class="ttdeci">etc Within a given preconditioner such derived matrices are typically pre computed by the preconditioner s c this approach does not work if the modified block is to be used in a subsidiary block preconditioner as discussed in the previous by default the subsidiary block preconditioner will extract its block matrices directly from the full size system matrix and will therefore ignore any(local) modifications made by its master preconditioner(s). What is therefore required is a method that indicates to the block preconditioning framework that a given sub-block is not to be extracted from the full system matrix but to be represented by suitable replacement matrix. We demonstrate this methodology by re-visiting the preconditioner considered in the previous example</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a5be663dc283b34c92f797a040c305562"><div class="ttname"><a href="block__preconditioners_8txt.html#a5be663dc283b34c92f797a040c305562">clean_up_my_memory</a></div><div class="ttdeci">subsubsection two_plus_three_setup The we start by freeing up any previously allocated and set the pointer to the we specify the mapping between dof types and block types as an argument to the c block_setup(...) function This is done by creating vector of length \c ndof_type() in which each entry indicates the block that the corresponding dof is supposed to end up in To show that this actually we output the number of passing the two diagonal blocks though here it simply acts on a block system skip until subsubsection two_plus_three_clean The clean_up_my_memory() function This function again deletes the allocated storage -- here the subsidiary preconditioners. \skip \until&lt; HR &gt;&lt; HR &gt; \subsection two_plus_three_upper_triangular Combining multiple dof types into compound blocks. Part 2</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01052">block_preconditioners.txt:1052</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a81d15f54bfaeec0d1a5a83ebb1a1eaa4"><div class="ttname"><a href="block__preconditioners_8txt.html#a81d15f54bfaeec0d1a5a83ebb1a1eaa4">v_x</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f v_x</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00251">block_preconditioners.txt:251</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aea1877bbfb3f4a1f7d7c64edba58d5f5"><div class="ttname"><a href="block__preconditioners_8txt.html#aea1877bbfb3f4a1f7d7c64edba58d5f5">dofs</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of dofs</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00203">block_preconditioners.txt:203</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a488342c731882ee60a1223b02fe1b777"><div class="ttname"><a href="block__preconditioners_8txt.html#a488342c731882ee60a1223b02fe1b777">single</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f respectively They are enumerated as dof types respectively subsection dof_types_and_block_types dof compound blocks and meshes In the block diagonal preconditioner for the two dimensional linear elasticity discussed we have dof types that correspond directly to the blocks in as we will demonstrate&lt; a href=&quot;#compound&quot;&gt; it is also possible to combine the blocks associated with multiple dofs into a single(compound) block in which case the number of blocks is smaller than the number of dof types. The relationship between dof types</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a82be4675960bd62fba9b0af24278d808"><div class="ttname"><a href="block__preconditioners_8txt.html#a82be4675960bd62fba9b0af24278d808">block_z</a></div><div class="ttdeci">temp block_z</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01651">block_preconditioners.txt:1651</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a1ebf85fa72491b7dec0b45191dc0c939"><div class="ttname"><a href="block__preconditioners_8txt.html#a1ebf85fa72491b7dec0b45191dc0c939">in</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in f p f Note that if certain degrees of freedom are classified by multiple the most recent assignment of the dof type over writes previous assignments The order in which meshes are specified therefore matters n A corollary to this is that a block preconditioner does not need to know about elements that do not introduce any new unknowns For c FaceElements that apply Neumann flux boundary conditions operate on dofs that are already contained in(and therefore classified by) the elements in the &quot;bulk&quot; mesh. Conversely</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_acdb7a40a5c0efe5eff5bb57ba88d5b24"><div class="ttname"><a href="block__preconditioners_8txt.html#acdb7a40a5c0efe5eff5bb57ba88d5b24">instance</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s in a multi physics typically represent different physical quantities A key feature of the framework is that it allows existing block in a hierarchical in block preconditioners for related multi physics problems This means that existing Navier Stokes and solid mechanics preconditioners can be used to create preconditioners for fluid structure interaction say Following a brief overview of the underlying ideas and their implementation in c oomph lib this tutorial discusses a sequence of increasingly complex block preconditioners that illustrate the framework s capabilities in the context of for instance</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00028">block_preconditioners.txt:28</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a12586199f621293656e6a34caf0a072e"><div class="ttname"><a href="block__preconditioners_8txt.html#a12586199f621293656e6a34caf0a072e">classification</a></div><div class="ttdeci">in the two dimensional c MyLinearElasticityElement&lt; 2 &gt; we have two types of corresponding to the displacements in the f $x f and f y f respectively They are enumerated as dof types respectively subsection dof_types_and_block_types dof compound blocks and meshes In the block diagonal preconditioner for the two dimensional linear elasticity discussed we have dof types that correspond directly to the blocks in as we will demonstrate&lt; a href=&quot;#compound&quot;&gt; it is also possible to combine the blocks associated with multiple dofs into a block the elemental dof type classification and meshes are as follows b Elemental b dof b type b classification</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00222">block_preconditioners.txt:222</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ae5d3b6fe51905f59612f7a9bf14caea4"><div class="ttname"><a href="block__preconditioners_8txt.html#ae5d3b6fe51905f59612f7a9bf14caea4">f</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s in a multi physics typically represent different physical quantities A key feature of the framework is that it allows existing block in a hierarchical in block preconditioners for related multi physics problems This means that existing Navier Stokes and solid mechanics preconditioners can be used to create preconditioners for fluid structure interaction say Following a brief overview of the underlying ideas and their implementation in c oomph lib this tutorial discusses a sequence of increasingly complex block preconditioners that illustrate the framework s capabilities in the context of for the tutorials discussing c oomph lib s&lt; a href=&quot;../../distributed_general_purpose_block_preconditioners/html/index.html&quot;&gt; general purpose block preconditioners&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/lsc_navier_stokes/html/index.html&quot;&gt; NavierStokesSchurComplementPreconditioner for Navier Stokes problems&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/fsi/html/index.html&quot;&gt; FSIPreconditioner for monolithically discretised fluid structure interaction problems&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/prescribed_displ_lagr_mult/html/index.html&quot;&gt; preconditioner for large displacement solid mechanics problems in which boundary displacements are prescribed&lt;/a &gt; n n The previous preconditioner is mainly used as a subsidiary block preconditioner for the&lt; a href=&quot;../../../preconditioners/pseudo_solid_fsi/html/index.html&quot;&gt; solution of fluid structure interaction problems all problems are solved by Newton s which requires the repeated solution of linear systems of the form f[{\bf J}\;{\bf \delta x}=-{\bf r}\f] for the Newton correction f bf delta x f where f</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00059">block_preconditioners.txt:59</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ae952d4d5c43e9c156e5e64491867ea43"><div class="ttname"><a href="block__preconditioners_8txt.html#ae952d4d5c43e9c156e5e64491867ea43">vector</a></div><div class="ttdeci">Next we create the subsidiary preconditioners which we will use to solve the linear systems involving the diagonal blocks until end of brace We then extract the relevant off diagonal create a c MatrixVectorProduct we start by extracting the block vectors from the full length vector</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00803">block_preconditioners.txt:803</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_afb358f48b1646c750fb9da6c6585be2b"><div class="ttname"><a href="block__preconditioners_8txt.html#afb358f48b1646c750fb9da6c6585be2b">end</a></div><div class="ttdeci">end</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00702">block_preconditioners.txt:702</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ad9db5f1630218a2f27774fa29614ca1e"><div class="ttname"><a href="block__preconditioners_8txt.html#ad9db5f1630218a2f27774fa29614ca1e">begin</a></div><div class="ttdeci">begin</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00696">block_preconditioners.txt:696</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a046c67a251ea97e7af5c51101695e731"><div class="ttname"><a href="block__preconditioners_8txt.html#a046c67a251ea97e7af5c51101695e731">preconditioner</a></div><div class="ttdeci">including the diagonals f[\hspace{3cm}{\bf P}=\left(\begin{array}{ccccc}J_{11} &amp;J_{12} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\&amp;J_{22} &amp;J_{23} &amp;J_{24} &amp;J_{25} \\ &amp;&amp;J_{33} &amp;J_{34} &amp;J_{35} \\ &amp;&amp;&amp;J_{44} &amp;J_{45} \\ &amp;&amp;&amp;&amp;J_{55} \\\end{array}\right).\hspace{3cm} @E[eqn:upper_triangular_reordered_linear_system]@\f] The application of this preconditioner(i.e. the solution of the linear system \f${\bf P} {\bf y}={\bf z}\f$ for \f${\bf y}\f$) again requires the solution of five much smaller linear systems \f[\hspace</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00690">block_preconditioners.txt:690</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_aed55b92e2cd68f214bea36d34e07fc08"><div class="ttname"><a href="block__preconditioners_8txt.html#aed55b92e2cd68f214bea36d34e07fc08">method</a></div><div class="ttdeci">mainpage oomph lib s Block Preconditioning Framework c oomph lib s block preconditioning framework provides an environment for the development of block preconditioners for the iterative solution of linear systems by Krylov subspace methods The framework is based on the classification of the problem s in a multi physics typically represent different physical quantities A key feature of the framework is that it allows existing block in a hierarchical in block preconditioners for related multi physics problems This means that existing Navier Stokes and solid mechanics preconditioners can be used to create preconditioners for fluid structure interaction say Following a brief overview of the underlying ideas and their implementation in c oomph lib this tutorial discusses a sequence of increasingly complex block preconditioners that illustrate the framework s capabilities in the context of for the tutorials discussing c oomph lib s&lt; a href=&quot;../../distributed_general_purpose_block_preconditioners/html/index.html&quot;&gt; general purpose block preconditioners&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/lsc_navier_stokes/html/index.html&quot;&gt; NavierStokesSchurComplementPreconditioner for Navier Stokes problems&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/fsi/html/index.html&quot;&gt; FSIPreconditioner for monolithically discretised fluid structure interaction problems&lt;/a &gt; n n The&lt; a href=&quot;../../../preconditioners/prescribed_displ_lagr_mult/html/index.html&quot;&gt; preconditioner for large displacement solid mechanics problems in which boundary displacements are prescribed&lt;/a &gt; n n The previous preconditioner is mainly used as a subsidiary block preconditioner for the&lt; a href=&quot;../../../preconditioners/pseudo_solid_fsi/html/index.html&quot;&gt; solution of fluid structure interaction problems all problems are solved by Newton s method</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00052">block_preconditioners.txt:52</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a69afdd62ec0bb82c411f0cdfca86dc57"><div class="ttname"><a href="block__preconditioners_8txt.html#a69afdd62ec0bb82c411f0cdfca86dc57">_memory</a></div><div class="ttdeci">the diagonal matrix blocks are longer required and can be deleted Extract the relevant off diagonal blocks from derived from the c BlockPreconditioner base class The class provides storage for the subsidiary preconditioners that solve the linear systems associated with the diagonal blocks and the c MatrixVectorProduct operators We also implement the c and provide a helper function c clean _up _my _memory() which does what it says. As before we also provide an access function which allows the user to specify the pointer to the \c Mesh that contains the \c MultiPoissonElements which classify the dofs. \dontinclude multi_poisson_block_preconditioners.h \skipline start_of_upper_triangular_class \until }</div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_ab2797c2e731d57d96d8dec396dd3f47d"><div class="ttname"><a href="block__preconditioners_8txt.html#ab2797c2e731d57d96d8dec396dd3f47d">order</a></div><div class="ttdeci">etc n n b Role b of b the block preconditioning framework visits all elements that make contributions to the Jacobian matrix and associates the global equation number of each dof with the dof type specified by the element The block preconditioning framework is given access to the elements each of which is assumed to contain elements of a single type The total number of dof types in the block preconditioner is the sum of the dof types of the elements in the meshes For in a fluid structure interaction problem we have two different element the solid f v_x f and f v_y and the f p assumed to be enumerated as dof and by these elements Assuming the mesh of solid elements is specified as mesh and the mesh of fluid elements is the block preconditioner has a total of five dof types which in order</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l00251">block_preconditioners.txt:251</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a223e4d37f6eb107cfb85ab11678b90e1"><div class="ttname"><a href="block__preconditioners_8txt.html#a223e4d37f6eb107cfb85ab11678b90e1">enumeration</a></div><div class="ttdeci">We create the two subsidiary preconditioners and pass the two diagonal blocks f the deep copies of these matrices are then allowed to go out of freeing up the since the subsidiary preconditioners retain whatever information they require skip until end setup of last Finally we create and set up the off diagonal vector product Note that the block column index refers to the block enumeration</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l01225">block_preconditioners.txt:1225</a></div></div>
<div class="ttc" id="ablock__preconditioners_8txt_html_a6dc28d0ec823c5116db403b47a6770c0"><div class="ttname"><a href="block__preconditioners_8txt.html#a6dc28d0ec823c5116db403b47a6770c0">i</a></div><div class="ttdeci">j) \until { Given that the replacement matrices are zero matrices, we could simply create them without ever looking at the original blocks. Sadly the creation of zero matrices turns out to be slightly more painful than one would wish because they have to be created as a(possibly distributed) \c CRDoubleMatrix. The relevant code is contained in the source code but we won 't discuss it here since the more common situation is one where we actually want to modify the already existing entries of an already existing block matrix. Therefore we simply extract the matrix and set its initially nonzero entries to zero(admittedly a bit silly -- we now have a sparse matrix full of zeroes, but it 's just a demonstration!):\until this is just an example! We then pass the pointer to the replacement dof block to the block preconditioner \skip Replace(i, j) \until loop of i The rest of the setup works exactly as in the previous example, only this time, the subsidiary preconditioners and the matrix vector products will work with the replacement dof blocks that we 've just defined. We create and set up the first subsidiary block preconditioner which operates on our dof types 0 and 1(and treats them as its own dof types 0 and 1):\skip First subsidiary precond \until } The second subsidiary block preconditioner which operates on our dof types 2, 3 and 4(and treats them as its own dof types 0, 1 and 2):\skip Second subsidiary precond \until } Finally, we create the matrix vector product operator:\skip Next setup the off diagonal mat vec operators:\until } \until } \subsubsection two_plus_three_upper_triangular_with_replace_solve The preconditioner_solve() function The \c preconditioner_solve() function is completely identical to the one used in the previous preconditioner, so we omit the code listing -- the subsidiary preconditioners and the matrix vector product operator work in the same way but now simply operate on the replacement dof blocks where they have been set. \subsubsection two_plus_three_upper_triangular_with_replace_clean The clean_up_my_memory() function Memory is cleaned up as before, so we omit the code listing. ################################################################## ##################################################################&lt; HR &gt;&lt; HR &gt; ################################################################## ################################################################## \subsection coarse_two_plus_two_plus_one Coarsening/combining dof types NEW FEATURES:How to coarsen/combine dof types for use by subsidiary block preconditioners. \subsubsection coarse_two_plus_two_plus_one_theory Theory In the examples presented so far we have demonstrated how to combine various dof-blocks into compound blocks in order to facilitate the application of certain preconditioning operations. For instance, in many of the previous examples we performed a matrix vector product using the compound matrix \f$ B_{12} \f$ that was(formally) formed by the concatenation of the 2x3 &quot;top right&quot; off-diagonal dof blocks in the full-sized system. We also showed how subsidiary block preconditioners which operate on a specific number of dof blocks can be instructed to operate on selected dof types from the full-sized system. Our standard example for this was a 2D Navier-Stokes preconditioner which operates on three dof types(two fluid velocities and one pressure) and is used as a subsidiary block preconditioner in an FSI problem that also involves additional dofs associated with the solid mechanics(e.g. the two solid displacement components). This was done by informing the subsidiary preconditioner which of the dof types in the full-sized system to regard as &quot;its own&quot; when calling its \c turn_into_subsidiary_block_preconditioner(...) function. This implies that the subsidiary block preconditioner remains unaware of any compound blocks that may have been formed in its master preconditioner. The functionality presented so far only allows us to associate dof-blocks in the master preconditioner with dof blocks in the subsidiary block preconditioner. It is therefore not possible(without further functionality which we explain in this example) to use a subsidiary block preconditioner if the dof-types in the master preconditioner are &quot;too fine-grained&quot;. This arises, for instance, in Navier-Stokes problems where the master preconditioner sub-divides the two components of the fluid velocity into degrees of freedom on the domain boundary and those in the interior. It is then necessary to make the subsidiary preconditioner act on the combined dof types, a process that we describe as &quot;coarsening&quot;. We illustrate the procedure by returning, yet again, to our 5x5 block linear system that we wish to precondition with \f[\hspace{3cm} {\bf P}_{\rm previous}=\left(\begin{array}{cc|ccc} J_{11} &amp;J_{12} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\ J_{21} &amp;J_{22} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\ \hline &amp;&amp;J_{33} &amp;J_{34} &amp;J_{35} \\ &amp;&amp;J_{43} &amp;J_{44} &amp;J_{45} \\ &amp;&amp;J_{53} &amp;J_{54} &amp;J_{55} \\ \end{array} \right)=\left(\begin{array}{c|c} B_{11} &amp;B_{12}\\ \hline &amp;B_{22} \\ \end{array} \right). \hspace{3cm} @E[eqn:two_plus_three_upper_triangular_coarsen]@ \f] However, now we wish to solve the two linear systems involving the compound matrices \f$ B_{11} \f$ and \f$ B_{22} \f$ with a 2x2 upper triangular subsidiary block preconditioner. To make this possible, we &quot;coarsen&quot; the dof types such that the subsidiary block preconditioner acting on \f$ B_{22}\f$ treats the global dof types 3 and 4 as a single dof type so that the block structure can be viewed as \f[{\bf P}=\left(\begin{array}{c||c} \begin{array}{cc} J_{11} &amp;J_{12} \\ J_{21} &amp;J_{22} \\ \end{array} &amp;\begin{array}{ccc} J_{13} &amp;J_{14} &amp;J_{15} \\ J_{23} &amp;J_{24} &amp;J_{25} \\ \end{array} \\ \hline \hline &amp;\begin{array}{cc|c} J_{33} &amp;J_{34} &amp;J_{35} \\ J_{43} &amp;J_{44} &amp;J_{45} \\ \hline J_{53} &amp;J_{54} &amp;J_{55} \\ \end{array} \end{array} \right)=\left(\begin{array}{c|c} B_{11} &amp;B_{12}\\ \hline &amp;B_{22} \\ \end{array} \right). \hspace{3cm} @E[eqn:coarse_two_plus_two_plus_one_reordered_linear_system]@ \f] If we now use a 2x2 upper triangular block preconditioner to(approximately) solve the linear systems involving the diagonal blocks \f$ B_{11} \f$ and \f$ B_{22} \f$ the preconditioner is given(mathematically) by \f[{\bf P}=\left(\begin{array}{ccccc} J_{11} &amp;J_{12} &amp;J_{13} &amp;J_{14} &amp;J_{15} \\ &amp;J_{22} &amp;J_{23} &amp;J_{24} &amp;J_{25} \\ &amp;&amp;J_{33} &amp;J_{34} &amp;J_{35} \\ &amp;&amp;J_{34} &amp;J_{44} &amp;J_{45} \\ &amp;&amp;&amp;&amp;J_{55} \\ \end{array} \right). \f][Note that, In the actual implementation discussed below, we also set the off diagonal dof-blocks to zero, using the replacement methodology discussed in the previous example. The preconditioner therefore becomes mathematically equivalent to the \f$ 5x5 \f$ block diagonal preconditioner discussed at the very beginning of this tutorial.] \subsubsection coarse_two_plus_two_plus_one_implementation Implementation as a BlockPreconditioner The implementation of the preconditioner is completely equivalent to the preconditioner considered in the previous examples:\skip start_of_coarse_two_plus_two_plus_one_class \until } i</div><div class="ttdef"><b>Definition:</b> <a href="block__preconditioners_8txt_source.html#l02162">block_preconditioners.txt:2162</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Fri Jul 16 2021 19:56:15
        </div>
      </div>
    </footer>
</body>
</html>
