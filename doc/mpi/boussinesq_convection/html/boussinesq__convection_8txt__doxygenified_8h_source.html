<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: boussinesq_convection.txt_doxygenified.h Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get it <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/subversion/html/index.html">Get code from subversion repository</a></li>
            <li><a href="../../../../doc/download/html/index.html">Get code as tar file</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">boussinesq_convection.txt_doxygenified.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="boussinesq__convection_8txt__doxygenified_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">\mainpage Parallel solution of the Boussinesq convection problem</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">Part I of this document provides an overview of how to distribute </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">the Boussinesq convection problem, using the </span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">&lt;a href=&quot;../../../multi_physics/refine_b_convect/html/index.html&quot;&gt;single-domain&lt;/a&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">and </span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">&lt;a href=&quot;../../../multi_physics/multi_domain_ref_b_convect/html/index.html&quot;&gt;multi-domain&lt;/a&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">approaches. It is part of a</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">&lt;a href=&quot;../../../example_code_list/html/index.html#distributed&quot;&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">series of tutorials&lt;/a&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">that discuss how to modify existing serial driver codes so that the</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">\c Problem object can be distributed across multiple processors.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">Part II provides a more detailed discussion of the </span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">serial and parallel implementation of the various helper </span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">functions that may be used to set up multi-domain interactions.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">\section boussinesq Part I: Distributing the Boussinesq convection problem</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">For the single-domain discretisation of the Boussinesq convection  </span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">problem, in which the Navier--Stokes and advection-diffusion equations </span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">are combined using a single element, the procedure required to distribute</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">the problem is exactly the same as that described in the</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">&lt;a href=&quot;../../adaptive_driven_cavity/html/index.html&quot;&gt;adaptive driven</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">cavity tutorial&lt;/a&gt;. We therefore omit a detailed discussion </span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">of the changes to the driver code but encourage you to compare</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">the serial driver codes,  </span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">&lt;center&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">&lt;a href=&quot;../../../../demo_drivers/multi_physics/boussinesq_convection/multi_domain_boussinesq_convection.cc&quot;&gt;&lt;code&gt;demo_drivers/multi_physics/boussinesq_convection/multi_domain_boussinesq_convection.cc&lt;/code&gt;&lt;/a&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">&lt;/center&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">and</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">&lt;center&gt;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">&lt;a href=&quot;../../../../demo_drivers/multi_physics/boussinesq_convection/multi_domain_ref_b_convection.cc&quot;&gt;&lt;code&gt;demo_drivers/multi_physics/boussinesq_convection/multi_domain_ref_b_convection.cc&lt;/code&gt;&lt;/a&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">&lt;/center&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">with their distributed counterparts, </span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">&lt;center&gt;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">&lt;a href=&quot;../../../../demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_boussinesq_convection.cc&quot;&gt;&lt;code&gt;demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_boussinesq_convection.cc&lt;/code&gt;&lt;/a&gt;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">&lt;/center&gt;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">and</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">&lt;center&gt;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">&lt;a href=&quot;../../../../demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_ref_b_convection.cc&quot;&gt;&lt;code&gt;demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_ref_convection.cc&lt;/code&gt;&lt;/a&gt;.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">&lt;/center&gt;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">The parallelisation of the </span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">&lt;a href=&quot;../../../multi_physics/multi_domain_ref_b_convect/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">multi-domain driver code &lt;/a&gt; is also quite</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">straightforward. The key point is that the interaction between the domains</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">must be set up again after the distribution of the problem</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">because, on each processor, some of the &quot;external elements&quot; will have been </span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">deleted during the distribution. The required changes to the serial</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">driver code are described below.</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">\subsection main_body The main function</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">The main function begins and ends with the usual calls to </span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">\c MPI_Helpers::init() and  \c MPI_Helpers::finalize(); the </span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">problem is distributed with a simple call to \c Problem::distribute().</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">\subsection problem_class The problem class</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">The problem class is identical to its serial counterpart, apart from </span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">the addition of the \c actions_after_distribute() function, discussed</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">below. </span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">\subsection actions_after_adapt Actions after adaptation</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">The boundary conditions </span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">are such that a single pressure degree of freedom must be pinned after</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">the adaptation. Once</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">the problem has been distributed, pinning the first</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">pressure freedom in the first element no longer works because the</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">first element will be different on  each processor. The required </span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">modifications mirror</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">those in the</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">&lt;a href=&quot;../../adaptive_driven_cavity/html/index.html&quot;&gt;adaptive driven</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">cavity problem&lt;/a&gt; and ensure that the pressure is only pinned in the </span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">first element in the mesh by testing the Eulerian position of the</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">element. The remainder of the function is the same</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">as in the serial driver code.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">\dontinclude multi_domain_ref_b_convection.cc</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">\skipline Actions after adaptation</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">\until //end_of_actions_after_adapt</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">\subsection actions_after_distribute Actions after distribution</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">After the problem distribution, the multi-domain interactions must be</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">set up again because some of the &quot;external elements&quot; may now only </span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">exist on other processors. Such elements are re-created </span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">locally as &quot;external halo elements&quot; when </span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">\c Multi_domain_functions::setup_multi_domain_interactions(...)</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">is called.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">\dontinclude multi_domain_ref_b_convection.cc</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">\skipline  Actions after distribute</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">\subsection doc_solution The doc_solution() routine</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">As usual, the \c doc_solution() function is modified by adding the</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">processor ID to each output file, ensuring that output from one</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">processor does not overwrite that from another.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">The remainder of the driver code is identical to the</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">&lt;a href=&quot;../../../multi_physics/multi_domain_ref_b_convect/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">serial version&lt;/a&gt;.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">\section multi_domain Part II: Setting up multi-domain interactions</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">The namespace \c Multi_domain_functions provides several helper</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">functions that facilitate the location of &quot;external elements&quot;</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">in multi-domain problems, in which the two interacting </span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">domains occupy the same physical space. The namespace also provides functions </span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">that can be used for problems in which the interacting domains </span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">meet at a lower-dimensional interface, &lt;em&gt; e.g.&lt;/em&gt; </span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">in fluid-structure interaction problems.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">The functions have a sensible default behaviour and can </span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">be used as &quot;block-box&quot; routines. We provide a brief overview</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">of their (serial and parallel) implementation, providing enough detail</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">to allow users to appreciate the role of the parameters that</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">can be adjusted in order to optimise the functions&#39; performance in </span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">specific applications.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">The function</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">template&lt;class ELEMENT_0,class ELEMENT_1&gt;     </span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">void Multi_domain_functions::setup_multi_domain_interactions(</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">                                       Problem* problem_pt, </span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">                                       Mesh* const &amp;first_mesh_pt,</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">                                       Mesh* const &amp;second_mesh_pt);</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">sets up a two-way interaction between two domains of the same spatial</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">dimension represented by \c first_mesh_pt, a mesh of elements of type</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">\c ELEMENT_0, and \c second_mesh_pt, a mesh of elements of type \c</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">ELEMENT_1. Both \c ELEMENT_0 and \c ELEMENT_1 must inherit from \c</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">ElementWithExternalElements.  The function loops over the integration</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">points of all the elements</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">in \c first_mesh_pt and establishes which &quot;external element&quot; </span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">in \c second_mesh_pt</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">covers the same spatial position as the integration point. </span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">A pointer to this &quot;external element&quot; and the appropriate local</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">coordinate are stored in the element in the \c first_mesh_pt, using</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">the storage provided by the \c ElementWithExternalElement base class.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">Once the &quot;external elements&quot; have been found for all elements in \c</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">first_mesh_pt, the procedure is repeated with the roles of the two meshes</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">interchanged.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">The corresponding function </span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">\code </span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">template&lt;class EXT_ELEMENT&gt;</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">void Multi_domain_functions::setup_multi_domain_interaction(</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">                                       Problem* problem_pt,</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">                                       Mesh* const &amp;mesh_pt,</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">                                       Mesh* const &amp;external_mesh_pt);</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">(note the singular) sets up a one-way interaction in which the </span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">mesh pointed to by \c external_mesh_pt provides the &quot;external</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">elements&quot; (of type \c EXT_ELEMENT) for the \c ElementWithExternalElements </span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">stored in \c mesh_pt, but not vice versa. In fact, the two-way</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">interaction described above is performed by two successive</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">calls to this function</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">     </span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"> setup_multi_domain_interaction&lt;ELEMENT_1&gt;</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">      (problem_pt,first_mesh_pt,second_mesh_pt);</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment"> setup_multi_domain_interaction&lt;ELEMENT_0&gt;</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">      (problem_pt,second_mesh_pt,first_mesh_pt);</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">Finally, the function </span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">template&lt;class EXT_ELEMENT, class FACE_ELEMENT_GEOM_OBJECT&gt;</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">void Multi_domain_functions:: setup_multi_domain_interaction(</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">                                       Problem* problem_pt,</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">                                       Mesh* const &amp;mesh_pt,</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">                                       Mesh* const &amp;external_mesh_pt,</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">                                       Mesh* const &amp;external_face_mesh_pt);</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">\endcode  </span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">may be used to set up multi-domain interactions for problems in which</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">the interaction occurs across the boundaries of adjacent domains</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">(&lt;em&gt; e.g. &lt;/em&gt; in FSI problems where the fluid and solid domains meet</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">along a lower-dimensional interface).  We do not anticipate that</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">users will have to call this function directly; it is called internally by</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">the function \c FSI_functions::setup_fluid_load_info_for_solid_elements(...).</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">\subsection overview Overview of the implementation</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">The  setup of multi-domain interactions requires the</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">identification of local coordinates within &quot;external elements&quot; </span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">that occupy the same Eulerian position as the integration points of the</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">\c ElementWithExternalElements with which they interact. Initially, </span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">the helper functions convert the mesh containing the &quot;external elements&quot; </span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">into a \c MeshAsGeomObject --- a</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">compound \c GeomObject in which the constituent finite elements act as</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">sub-\c GeomObjects. Given the Eulerian coordinates of a </span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">&quot;target point&quot;, the function </span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">\c MeshAsGeomObject::locate_zeta(...) is used</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">to locate the &quot;external element&quot; (and the local</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">coordinate within it) that contains the &quot;target point&quot;. The simplest</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">implementation of this function is to loop over all the elements in</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">the mesh, calling \c FiniteElement::locate_zeta(...) until the</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">required point is located. The function \c</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">FiniteElement::locate_zeta(...) can be overloaded for specific</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">elements to take into account the interpolation method </span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">used within the element. By default, a Newton method</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">is employed to determine the local coordinates of the </span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">&quot;target point&quot; within an element. If the Newton method fails to</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">converge or if the &quot;target point&quot; is found at a </span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">local coordinate that is outside the element, then the functions</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">return values are set to indicate that the &quot;target point&quot; has not been</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">found within the element.</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">One problem with the naive &quot;loop over all the elements&quot; approach is that</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">in most cases, the candidate element will not contain the &quot;target</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">point&quot;, so there will be a lot of wasted work. In addition, there </span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">is no guarantee that the (default) Newton iteration will converge,</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">even when the element does contain the required point. A further</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">complication in a distributed problem is that </span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">the element that contains the &quot;target point&quot; may not be </span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">located on the current processor. For these reasons, </span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">\c MeshAsGeomObject::locate_zeta(...) uses a bin-based search</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">procedure described below. Conceptually, the algorithm still loops</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">over all elements until it finds the one containing the &quot;target</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">point&quot;; the efficiency gains are achieved by choosing a sensible search</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">order so that the element containing the point is found quickly.</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">\subsection impl Basic (serial) implementation </span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"> To make the search process efficient, the constructor of the</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">\c MeshAsGeomObject automatically creates a bin structure</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">that aids the identification of elements that are close to a</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">given &quot;target point&quot;. The setup of the bin structure is performed as</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">follows:</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">&lt;b&gt;Setting up the bin structure&lt;/b&gt;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">-# We start by sampling the position of the elements in the </span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">   \c MeshAsGeomObject to determine the mesh&#39;s maximum and minimum</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">   Eulerian coordinates. </span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">-# Next we create a rectangular (or cubic) bin structure that spans</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">   the entire mesh (using the extremal coordinates determined</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">   in the previous step, plus a small margin for safety),</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">   using \c Nx_bin \f$ \times \f$ \c Ny_bin (\f$ \times \f$ \c Nz_bin)</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">   equal-sized rectangular (or cubic) bins. </span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">-# Finally, we populate the bin structure by evaluating the position of a </span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">   number of sampling points within each element. For each sampling point</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">   we determine in which bin the point is located and associate </span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">   a pair, comprising the pointer to the element and appropriate local</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">   coordinate, with that bin.</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">. </span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">Once the bin structure has been set up, a given &quot;target point&quot; can be </span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">located very quickly within the \c MeshAsGeomObject by the following</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">procedure:</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">&lt;b&gt;Locating points within the &lt;code&gt;MeshAsGeomObject&lt;/code&gt;&lt;/b&gt;</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">-# Given the coordinates of the &quot;target point&quot;, we identify the bin</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">   in which it is located. This is a cheap operation because all bins</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">   have the same size and are aligned with the coordinate axes.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">-# Next we visit the element/local coordinate pairs associated with </span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">   that bin. For each pair, we use the \c</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">   FiniteElement::locate_zeta(...) function to (attempt to!) </span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">   find the the local coordinate within the element that corresponds </span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">   to the &quot;target point&quot;. The local coordinate stored in the pair is</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">   passed to the function to be used as the initial guess for the</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">   (default) Newton iteration. If the &quot;target point&quot; is</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">   not found, the procedure is repeated </span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">   with next pair of element and local coordinates. </span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">-# If the relevant point is not located within the initial bin </span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">   (&lt;em&gt; e.g. &lt;/em&gt; because the bin is empty) </span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">   the procedure is repeated in adjacent bins, spiralling outwards </span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">   through the bin structure.</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">-# If the &quot;target point&quot; cannot be found in any of the bins,</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">   the search fails, indicating/suggesting that the &quot;target point&quot; is </span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">   not contained in the mesh. (The search may also fail when the</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">   Newton method is used if </span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">   none of the element/local coordinate pairs associated with the </span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">   bins were close enough to the &quot;target point&quot;. If this happens,</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">   we recommend increasing the number of sampling points</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">   by increasing the value of \c Multi_domain_functions::Nsample_points</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">   before re-running the code. Note, however, that we have never encountered</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">   this problem in any of our test cases.)</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">. </span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">A tacit assumption in the above procedure is that, since the two </span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">interacting meshes represent the same physical domain, </span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">any point in one mesh can also be found in the other, regardless</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">of possible differences in the meshes&#39; refinement patterns. While </span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">this is true for meshes that discretise domains with </span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">polygonal boundaries, problems may arise in domains whose boundaries</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">are curvilinear because \c oomph-lib&#39;s </span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">&lt;code&gt;MacroElement/Domain&lt;/code&gt;-based representation of </span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">such domains ensures that during</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">successive mesh refinements, any newly-created nodes are placed</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">exactly on the curvilinear boundary. This procedure is </span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">necessary to guarantee</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">convergence to the exact solution under </span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">mesh refinement, but it creates the problem that a strongly refined mesh (whose</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">boundaries provide a better approximation to the exact curvilinear boundary) </span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">may contain points that are not contained within the coarser mesh with which it</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">interacts. To avoid this problem, we determine the location of</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">&quot;target points&quot; within each element using the </span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">\c MacroElement (exact curvilinear) representation, if there is one. </span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">An important consequence of this approach is that </span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">points in the two interacting meshes deemed to be </span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">located at the same spatial</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">position (same position in the exact representation) </span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">may actually have slightly different positions. </span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">Nonetheless, the difference between their positions </span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">decreases under mesh refinement</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">at the same rate at which the finite-element representation of the curvilinear</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">domain approaches the domain itself.</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">\subsection parallel Parallel implementation</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">When setting up multi-domain interactions for distributed meshes</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">we face the additional challenge that the &quot;external</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">element&quot; that contains a &quot;target point&quot; may not be located on the </span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">same processor as the \c ElementWithExternalElement with which it interacts. </span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">When dealing with distributed meshes, the search procedure described</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">above is therefore modified as follows:</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">-# When creating the \c MeshAsGeomObject representation of the distributed</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">   mesh that contains the &quot;external elements&quot;, each processor sets up</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">   a bin structure for its own part of that mesh. Some communication</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">   takes place at this point so that every processor holds the</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">  &quot;global&quot; extrema of the mesh.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">-# When setting up the multi-domain interaction, </span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">   each processor only</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">   determines the &quot;external elements&quot; for the locally-stored</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">   \c ElementWithExternalElements</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">   Initially, the required &quot;external elements&quot; are sought among </span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">   the locally-stored &quot;external elements&quot; and </span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">   the search is restricted to the bin that</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">   contains the &quot;target point&quot;. Each processor then creates a list of </span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">   the &quot;external elements&quot; that have not been found locally.</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">-# Each processor communicates its list of missing &quot;external elements&quot;</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">   to the &quot;next&quot; processor,  using a ring-like communication pattern.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">-# All processors search for the yet-to-be-found &quot;external</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">   elements&quot; amongst the &quot;external elements&quot; stored in their</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">   part of the distributed mesh. Again the search is restricted to </span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">   the &quot;external elements&quot; that are associated with the bin</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">   that contains the &quot;target point&quot;. If an</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">   &quot;external element&quot; is found, a halo copy of it is created on the</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">   processor that contains the \c ElementWithExternalElement. </span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">-# The list of any remaining missing &quot;external elements&quot; is then</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">   forwarded to the next processor in the communication ring where the</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">   search process is repeated.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">-# If, after a complete sweep through all processors, some</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">   &quot;external elements&quot; have still not been located, we initiate </span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">   another search loop,  re-commencing the search at the next</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">   level of the search spiral through the bins.</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">-# The setup of the multi-domain interaction is complete when </span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">   all &quot;external elements&quot; have been located and halo copies have</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">   been made where required. The setup fails (for the </span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">   same possible reasons listed in the discussion of the serial implementation) </span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">   if none of the processors are able to locate one or more of the required</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">   &quot;external elements&quot;.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"> The algorithm is based on the assumption that the majority of the</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"> pairs of interacting elements will be stored on the same processor, </span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"> which is typically the case when \c METIS is used to determine the</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment"> distribution. The algorithm also assumes that the external elements</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> can usually be found by searching only in the bin containing the &quot;target</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"> point&quot;, which is true provided the bin structure is not too</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"> fine. The algorithm should always find the external elements even if</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment"> these assumptions are not satisfied, but it may not be optimal in</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment"> these situations.</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">\section sources Source files for this tutorial</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">The full parallel driver code for the distributed, multi-domain based</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">solution of the Boussinesq convection problem can be found at</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_ref_b_convection.cc&quot;&gt;</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_ref_b_convection.cc</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">Additional parallel driver codes for the distributed Boussinesq </span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">problem using both single- and multi-domain methods are located in </span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/mpi/multi_domain/boussinesq_convection&quot;&gt;</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">demo_drivers/mpi/multi_domain/boussinesq_convection</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">\section pdf PDF file</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">A &lt;a href=&quot;../latex/refman.pdf&quot;&gt;pdf version&lt;/a&gt; of this document is available.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">**/</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aboussinesq__convection_8txt_html_a8cb7bc96a2ec61fe51b7b81e7ca542df"><div class="ttname"><a href="boussinesq__convection_8txt.html#a8cb7bc96a2ec61fe51b7b81e7ca542df">doc_solution</a></div><div class="ttdeci">the problem is distributed with a simple call to c apart from the addition of the c discussed below&lt; HR &gt; subsection actions_after_adapt Actions after adaptation The boundary conditions are such that a single pressure degree of freedom must be pinned after the adaptation Once the problem has been pinning the first pressure freedom in the first element no longer works because the first element will be different on each processor The required modifications mirror those in the&lt; a href=&quot;../../adaptive_driven_cavity/html/index.html&quot;&gt; adaptive driven cavity problem&lt;/a &gt; and ensure that the pressure is only pinned in the first element in the mesh by testing the Eulerian position of the element The remainder of the function is the same as in the serial driver code dontinclude multi_domain_ref_b_convection cc skipline Actions after adaptation until&lt; HR &gt; subsection actions_after_distribute Actions after distribution After the problem the multi domain interactions must be set up again because some of the external elements may now only exist on other processors Such elements are re created locally as external halo elements when c the c doc_solution() function is modified by adding the processor ID to each output file</div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a356d19314d47bdfcc592322af86fa46e"><div class="ttname"><a href="boussinesq__convection_8txt.html#a356d19314d47bdfcc592322af86fa46e">fact</a></div><div class="ttdeci">but not vice versa In fact</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00184">boussinesq_convection.txt:184</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_afcb00508eab2699b3a51cb4082385eaf"><div class="ttname"><a href="boussinesq__convection_8txt.html#afcb00508eab2699b3a51cb4082385eaf">Basic</a></div><div class="ttdeci">it is called internally by the function c the helper functions convert the mesh containing the external elements into a c MeshAsGeomObject a compound c GeomObject in which the constituent finite elements act as sub c GeomObjects Given the Eulerian coordinates of a target the function c calling c FiniteElement::locate_zeta(...) until the required point is located. The function \c FiniteElement the efficiency gains are achieved by choosing a sensible search order so that the element containing the point is found quickly&lt; hr &gt; subsection impl Basic(serial) implementation To make the search process efficient</div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_ae55dc27b6a9169b989fbdb65e21a2e98"><div class="ttname"><a href="boussinesq__convection_8txt.html#ae55dc27b6a9169b989fbdb65e21a2e98">second_mesh_pt</a></div><div class="ttdeci">endcode sets up a two way interaction between two domains of the same spatial dimension represented by c a mesh of elements of type c and c second_mesh_pt</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00157">boussinesq_convection.txt:157</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a96523c0123a943b4d4c5b5d298ee8faa"><div class="ttname"><a href="boussinesq__convection_8txt.html#a96523c0123a943b4d4c5b5d298ee8faa">II</a></div><div class="ttdeci">the problem is distributed with a simple call to c apart from the addition of the c discussed below&lt; HR &gt; subsection actions_after_adapt Actions after adaptation The boundary conditions are such that a single pressure degree of freedom must be pinned after the adaptation Once the problem has been pinning the first pressure freedom in the first element no longer works because the first element will be different on each processor The required modifications mirror those in the&lt; a href=&quot;../../adaptive_driven_cavity/html/index.html&quot;&gt; adaptive driven cavity problem&lt;/a &gt; and ensure that the pressure is only pinned in the first element in the mesh by testing the Eulerian position of the element The remainder of the function is the same as in the serial driver code dontinclude multi_domain_ref_b_convection cc skipline Actions after adaptation until&lt; HR &gt; subsection actions_after_distribute Actions after distribution After the problem the multi domain interactions must be set up again because some of the external elements may now only exist on other processors Such elements are re created locally as external halo elements when c the c ensuring that output from one processor does not overwrite that from another&lt; HR &gt; The remainder of the driver code is identical to the&lt; a href=&quot;../../../multi_physics/multi_domain_ref_b_convect/html/index.html&quot;&gt; serial version&lt;/a &gt;&lt; HR &gt;&lt; HR &gt; section multi_domain Part II</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00133">boussinesq_convection.txt:133</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a31ddf705989d1e2674d2ff85f7166a89"><div class="ttname"><a href="boussinesq__convection_8txt.html#a31ddf705989d1e2674d2ff85f7166a89">follows</a></div><div class="ttdeci">it is called internally by the function c the helper functions convert the mesh containing the external elements into a c MeshAsGeomObject a compound c GeomObject in which the constituent finite elements act as sub c GeomObjects Given the Eulerian coordinates of a target the function c calling c FiniteElement::locate_zeta(...) until the required point is located. The function \c FiniteElement the efficiency gains are achieved by choosing a sensible search order so that the element containing the point is found quickly&lt; hr &gt; subsection impl the constructor of the c MeshAsGeomObject automatically creates a bin structure that aids the identification of elements that are close to a given target point The setup of the bin structure is performed as follows</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00273">boussinesq_convection.txt:273</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_ac9a36bcf03ba548fe8c6cd17f575635a"><div class="ttname"><a href="boussinesq__convection_8txt.html#ac9a36bcf03ba548fe8c6cd17f575635a">problem</a></div><div class="ttdeci">mainpage Parallel solution of the Boussinesq convection problem Part I of this document provides an overview of how to distribute the Boussinesq convection problem</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00004">boussinesq_convection.txt:4</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_aa9fc119ad80e517a5177a09808e399af"><div class="ttname"><a href="boussinesq__convection_8txt.html#aa9fc119ad80e517a5177a09808e399af">domains</a></div><div class="ttdeci">endcode may be used to set up multi domain interactions for problems in which the interaction occurs across the boundaries of adjacent domains(&lt; em &gt; e.g.&lt;/em &gt; in FSI problems where the fluid and solid domains meet along a lower-dimensional interface). We do not anticipate that users will have to call this function directly</div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a707b60a792e911d3fa7d844de3c21d8a"><div class="ttname"><a href="boussinesq__convection_8txt.html#a707b60a792e911d3fa7d844de3c21d8a">first_mesh_pt</a></div><div class="ttdeci">endcode sets up a two way interaction between two domains of the same spatial dimension represented by c first_mesh_pt</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00156">boussinesq_convection.txt:156</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a90bde6107ef4c4dc27aaa2627e22a2ac"><div class="ttname"><a href="boussinesq__convection_8txt.html#a90bde6107ef4c4dc27aaa2627e22a2ac">href</a></div><div class="ttdeci">&quot;../../../multi_physics/refine_b_convect/html/index.html&quot;&gt;single-domain&lt;/a &gt; and&lt; a href=&quot;../../../multi_physics/multi_domain_ref_b_convect/html/index.html&quot;&gt;multi-domain&lt;/a &gt; approaches. It is part of a&lt; a href=&quot;../../../example_code_list/html/index.html#distributed&quot;&gt; series of tutorials&lt;/a &gt; that discuss how to modify existing serial driver codes so that the \c Problem object can be distributed across multiple processors. Part II provides a more detailed discussion of the serial and parallel implementation of the various helper functions that may be used to set up multi-domain interactions.&lt; HR &gt;&lt; HR &gt; \section boussinesq Part I:Distributing the Boussinesq convection problem For the single-domain discretisation of the Boussinesq convection problem, in which the Navier--Stokes and advection-diffusion equations are combined using a single element, the procedure required to distribute the problem is exactly the same as that described in the&lt; a href=&quot;../../adaptive_driven_cavity/html/index.html&quot;&gt;adaptive driven cavity tutorial&lt;/a &gt;. We therefore omit a detailed discussion of the changes to the driver code but encourage you to compare the serial driver codes,&lt; center &gt;&lt; a href=&quot;../../../../demo_drivers/multi_physics/boussinesq_convection/multi_domain_boussinesq_convection.cc&quot;&gt;&lt; code &gt;demo_drivers/multi_physics/boussinesq_convection/multi_domain_boussinesq_convection.cc&lt;/code &gt;&lt;/a &gt;&lt;/center &gt; and&lt; center &gt;&lt; a href=&quot;../../../../demo_drivers/multi_physics/boussinesq_convection/multi_domain_ref_b_convection.cc&quot;&gt;&lt; code &gt;demo_drivers/multi_physics/boussinesq_convection/multi_domain_ref_b_convection.cc&lt;/code &gt;&lt;/a &gt;&lt;/center &gt; with their distributed counterparts,&lt; center &gt;&lt; a href=&quot;../../../../demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_boussinesq_convection.cc&quot;&gt;&lt; code &gt;demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_boussinesq_convection.cc&lt;/code &gt;&lt;/a &gt;&lt;/center &gt; and&lt; center &gt;&lt; a href=&quot;../../../../demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_ref_b_convection.cc&quot;&gt;&lt; code &gt;demo_drivers/mpi/multi_domain/boussinesq_convection/multi_domain_ref_convection.cc&lt;/code &gt;&lt;/a &gt;.&lt;/center &gt; The parallelisation of the&lt; a href=&quot;../../../multi_physics/multi_domain_ref_b_convect/html/index.html&quot;&gt; multi-domain driver code&lt;/a &gt; is also quite straightforward. The key point is that the interaction between the domains must be set up again after the distribution of the problem because, on each processor, some of the &quot;external elements&quot; will have been deleted during the distribution. The required changes to the serial driver code are described below. \subsection main_body The main function The main function begins and ends with the usual calls to \c MPI_Helpers::init() and \c MPI_Helpers::finalize() href</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00065">boussinesq_convection.txt:65</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a472f479ab997a5a2d889405dce0b7c39"><div class="ttname"><a href="boussinesq__convection_8txt.html#a472f479ab997a5a2d889405dce0b7c39">actions_after_distribute</a></div><div class="ttdeci">the problem is distributed with a simple call to c apart from the addition of the c actions_after_distribute() function</div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a3fd838e673976f66edb6467367d128e7"><div class="ttname"><a href="boussinesq__convection_8txt.html#a3fd838e673976f66edb6467367d128e7">endcode</a></div><div class="ttdeci">endcode(note the singular) sets up a one-way interaction in which the mesh pointed to by \c external_mesh_pt provides the &quot;external elements&quot;(of type \c EXT_ELEMENT) for the \c ElementWithExternalElements stored in \c mesh_pt</div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_aebfb6de1673fdb0de39a31290cb66c71"><div class="ttname"><a href="boussinesq__convection_8txt.html#aebfb6de1673fdb0de39a31290cb66c71">point</a></div><div class="ttdeci">it is called internally by the function c the helper functions convert the mesh containing the external elements into a c MeshAsGeomObject a compound c GeomObject in which the constituent finite elements act as sub c GeomObjects Given the Eulerian coordinates of a target point</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00225">boussinesq_convection.txt:225</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a9256625e8cf9ab7d8142b1eecf964d81"><div class="ttname"><a href="boussinesq__convection_8txt.html#a9256625e8cf9ab7d8142b1eecf964d81">distributed</a></div><div class="ttdeci">the problem is distributed with a simple call to c apart from the addition of the c discussed below&lt; HR &gt; subsection actions_after_adapt Actions after adaptation The boundary conditions are such that a single pressure degree of freedom must be pinned after the adaptation Once the problem has been distributed</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00081">boussinesq_convection.txt:81</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_ac99f9c2c12c1f839d9e86af1b927ca3a"><div class="ttname"><a href="boussinesq__convection_8txt.html#ac99f9c2c12c1f839d9e86af1b927ca3a">ELEMENT_0</a></div><div class="ttdeci">endcode sets up a two way interaction between two domains of the same spatial dimension represented by c a mesh of elements of type c ELEMENT_0</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00157">boussinesq_convection.txt:157</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_acc34b8841d1c42cceb1770cc872fd126"><div class="ttname"><a href="boussinesq__convection_8txt.html#acc34b8841d1c42cceb1770cc872fd126">distribution</a></div><div class="ttdeci">the problem is distributed with a simple call to c apart from the addition of the c discussed below&lt; HR &gt; subsection actions_after_adapt Actions after adaptation The boundary conditions are such that a single pressure degree of freedom must be pinned after the adaptation Once the problem has been pinning the first pressure freedom in the first element no longer works because the first element will be different on each processor The required modifications mirror those in the&lt; a href=&quot;../../adaptive_driven_cavity/html/index.html&quot;&gt; adaptive driven cavity problem&lt;/a &gt; and ensure that the pressure is only pinned in the first element in the mesh by testing the Eulerian position of the element The remainder of the function is the same as in the serial driver code dontinclude multi_domain_ref_b_convection cc skipline Actions after adaptation until&lt; HR &gt; subsection actions_after_distribute Actions after distribution After the problem distribution</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00100">boussinesq_convection.txt:100</a></div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_a2e32fc8f467783c204660c69fca90951"><div class="ttname"><a href="boussinesq__convection_8txt.html#a2e32fc8f467783c204660c69fca90951">their</a></div><div class="ttdeci">namespace also provides functions that can be used for problems in which the interacting domains meet at a lower dimensional interface&lt; em &gt; e g&lt;/em &gt; in fluid structure interaction problems The functions have a sensible default behaviour and can be used as block box routines We provide a brief overview of their(serial and parallel) implementation</div></div>
<div class="ttc" id="aboussinesq__convection_8txt_html_ad241ac225845f23822dafee8cce67441"><div class="ttname"><a href="boussinesq__convection_8txt.html#ad241ac225845f23822dafee8cce67441">Finally</a></div><div class="ttdeci">endcode Finally</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8txt_source.html#l00197">boussinesq_convection.txt:197</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Mon Aug 9 2021 09:15:12
        </div>
      </div>
    </footer>
</body>
</html>
