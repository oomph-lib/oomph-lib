<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: lgr_navier_stokes.txt_doxygenified.h Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get it <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/subversion/html/index.html">Get code from subversion repository</a></li>
            <li><a href="../../../../doc/download/html/index.html">Get code as tar file</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">lgr_navier_stokes.txt_doxygenified.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lgr__navier__stokes_8txt__doxygenified_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">\mainpage Demo problem: A preconditioner for the solution of Navier-Stokes equations with weakly imposed boundary conditions via Lagrange multipliers</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">The purpose of this tutorial is to show how to use \c oomph-lib&#39;s  Lagrange</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">Enforced Flow Navier-Stokes preconditioner. Similarly to the problem considered</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">in the &lt;a href=&quot;../../../navier_stokes/vmtk_fluid/html/index.html&quot;&gt; Steady</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">finite-Reynolds-number flow through an iliac bifurcation&lt;/a&gt; tutorial, the</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">outflow boundary of the demo problem (discussed below) are not aligned with any</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">coordinate planes. Parallel outflow is therefore enforced by a Lagrange</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">multiplier method, implemented using \c oomph-lib&#39;s \c FaceElement framework.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">\section model The model problem, theory and preconditioner</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">We will demonstrate the development and application of the preconditioner using</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">the Poiseuille flow through a unit square domain \f$\Omega^{[\alpha]} \in</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">\mathbb{R}^2\f$ rotated by an arbitrary angle \f$\alpha\f$ (see the figure</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">below). The domain \f$\Omega^{[\alpha]}\f$ is obtained by rotating the discrete</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">points \f$(x_1,x_2)\f$ in the unit square \f$\Omega = [0,1]^2\f$ by the</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">following transformation</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">R(\alpha)=</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">\left( </span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">{\cos(\alpha)} &amp; {-\sin(\alpha)} \\ {\sin(\alpha)} &amp; {\cos(\alpha)} </span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">\end{array} </span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">\right),</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> \ \ \ \ \ \ \ \ \ \ (1)</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">where \f$\alpha\f$ is the angle of rotation.  The figure below show the flow</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">field (velocity vectors and pressure contours) for a unit square domain rotated</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">by an angle of \f$\alpha=30^\circ \f$ and a Reynolds number of \f$ Re = 100</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">\f$. The flow is driven by a prescribed parabolic boundary condition.  </span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">\image html SimAng30Rey100Noel4.gif &quot;Velocity field and pressure &quot; </span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">\image latex SimAng30Rey100Noel4.eps &quot;Velocity field and pressure &quot; width=0.4\textwidth</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">For convenience, we present the boundary conditions for the non-rotated unit</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">square \f$\alpha = 0^{\circ}\f$. In order to obtain the boundary conditions for</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">\f$\alpha \ne 0^\circ\f$, we only have to apply the rotation</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">(1).  The flow is driven by imposing a parabolic velocity</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">profile along the inflow boundary \f$\Omega_I\f$. Along the characteristic</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">boundary, \f$\Omega_C\f$, the no-slip condition \f$u_i = 0\f$, \f$i = 1,2\f$,</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">is prescribed.  We impose `parallel outflow&#39; along the outlet \f$\Omega_O\f$ by</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">insisting that</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">\f[     </span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">{\bf u}\cdot {\bf t}_{} = 0 \mbox{\ \ \ \ on $\Omega_{O}$,}</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> \ \ \ \ \ \ \ \ \ \ (2)</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">where \f$ {\bf t}\f$ is the tangent vector at each discrete point on the</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">boundary \f$ \Omega_{O}\f$.  We weakly enforce the flow constraint by</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">augmenting the Navier-Stokes momentum residual equation (introduced in the &lt;a</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">href=&quot;../../../navier_stokes/rayleigh_traction_channel/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">Unsteady flow in a 2D channel, driven by an applied traction&lt;/a&gt; tutorial) with</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">a Lagrange multiplier term so that it becomes</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">r_{il}^{u}</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">\int_\Omega</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">  Re</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">    \left(</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">      St\frac{\partial u_i}{\partial t}</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">      + u_j\frac{\partial u_i}{\partial x_j}</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">    \right) \psi_l</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">  + \tau_{ij}\frac{\partial \psi_l}{\partial x_j}</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">d\Omega</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">-</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">\int_{\partial\Omega}</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">\tau_{ij} n_j\psi_l dS</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">+ \delta \Pi_{constraint} = 0,</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> \ \ \ \ \ \ \ \ \ \ (3)</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">where</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">\Pi_{constraint}</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">\int_{\partial \Omega} \lambda u_i t_i dS,</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> \ \ \ \ \ \ \ \ \ \ (4)</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">and \f$\lambda\f$ is the Lagrange multiplier. Upon taking the first variation</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">of the constraint with respect to the unknown velocity and the Lagrange</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">multiplier, the residual form of the constrained momentum equation is</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">r_{il}^{u}</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">\int_\Omega</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">  Re</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">    \left(</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">      St\frac{\partial u_i}{\partial t}</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">      + u_j\frac{\partial u_i}{\partial x_j}</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">    \right) \psi_l</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">  + \tau_{ij}\frac{\partial \psi_l}{\partial x_j}</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">d\Omega</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">-</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">\int_{\partial\Omega}</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">\tau_{ij} n_j\psi_l dS</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">+ </span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">\int_{\partial\Omega}</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">\lambda\psi_l t_i = 0.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> \ \ \ \ \ \ \ \ \ \ (5)</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">The weak formulation of (2) is simply</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">r_{l}^{\lambda}</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">\int_\Omega</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">u_i t_i \psi^\lambda</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">dS</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">0,</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> \ \ \ \ \ \ \ \ \ \ (6)</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">where \f$\psi^\lambda\f$ is a suitable basis function.  Equation</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">(5) reveals that the Lagrange multipliers act as</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">the (negative) tangential traction \f$(\lambda =</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">-{\mathbf{n}}^T{\mathbf{\tau}}{\mathbf{t}})\f$ that enforce the parallel flow</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">across the boundary \f$\partial\Omega_{O}\f$.  We discretise this constraint by</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">attaching \c ImposeParallelOutflowElements to the boundaries of the &quot;bulk&quot;</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">Navier-Stokes elements that are adjacent to \f$ \partial \Omega_O \f$ as shown</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">in the &lt;a href=&quot;../../../navier_stokes/vmtk_fluid/html/index.html&quot;&gt; Steady</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">finite-Reynolds-number flow through an iliac bifurcation&lt;/a&gt; tutorial, also see</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">the &lt;a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">Deformation of a solid by a prescribed boundary motion &lt;/a&gt; tutorial which</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">employs a similar technique used to enforce prescribed boundary displacements</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">in solid mechanics problems. We discretise the Navier-Stokes equations using \c</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">oomph-lib&#39;s \c QTaylorHoodElements, see the &lt;a</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">href=&quot;../../../navier_stokes/driven_cavity/html/index.html&quot;&gt; 2D Driven Cavity</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">Problem&lt;/a&gt; tutorial for more information.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">The discretised problem therefore contains the following types of discrete </span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">unknowns:</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">- The fluid degrees of freedom (velocity and pressure).\n\n</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">- The nodal values representing the components of the (vector-valued)</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">  Lagrange multipliers. These only exist for the nodes on </span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">  \f$ \partial \Omega_O\f$. (The nodes are re-sized to</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">  accommodate the additional unknowns when the \c ImposeParallelOutflowElements are</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">  attached to the bulk elements.)</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">. </span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">The preconditioner requires a further sub-division of these degrees of</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">freedom into the following categories:</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">- the unconstrained velocity in the x-direction</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">- the unconstrained velocity in the y-direction</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">- [the unconstrained velocity in the z-direction (only in 3D)]</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">- the constrained velocity in the x-direction</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">- the constrained velocity in the y-direction</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">- [the constrained velocity in the z-direction (only in 3D)]</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">- the Lagrange multiplier at the constrained nodes</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">- [the other Lagrange multiplier at the constrained nodes</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">  (only in 3D)].</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">For a 2D problem, the linear system to be solved in the course of the Newton</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">iteration can then be (formally) re-ordered into the following block structure:</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">\begin{array}{ccccc|c}</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">{ F_{\rm xx}}&amp;{ F_{\rm x\bar{\rm</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">      x}}}&amp;{ F_{\rm xy}}&amp;{ F_{\rm x\bar{\rm y}}}&amp;{ B_{\rm x}^{T}}&amp;\\</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">{ F_{\bar{\rm x}\rm x}}&amp;{ F_{\bar{\rm x}\bar{\rm x}}}&amp;{ F_{\bar{\rm x}\rm y}}&amp;{ F_{\bar{\rm x}\bar{\rm y}}}&amp;{ B_{\bar{\rm x}}^{T}}&amp;{ M_{\rm x}}\\</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">{ F_{\rm yx}}&amp;{ F_{\rm y\bar{\rm</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">      x}}}&amp;{ F_{\rm yy}}&amp;{ F_{\rm y\bar{\rm y}}}&amp;{ B_{\rm y}^{T}}&amp;\\</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">{ F_{\bar{\rm y}\rm x}}&amp;{ F_{\bar{\rm</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">      y}\bar{\rm x}}}&amp;{ F_{\bar{\rm y}\rm y}}&amp;{ </span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">  F_{\bar{\rm y}\bar{\rm y}}}&amp;{ B_{\bar{\rm y}}^{T}}&amp;{ M_{\rm y}}\\</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">{ B_{\rm x}}&amp;{ B_{\bar{\rm x}}}&amp;{ B_{\rm y}}&amp;{ B_{\bar{\rm y}}}&amp;\\</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">&amp;{ M_{\rm x}}&amp;&amp;{ M_{\rm y}}&amp;&amp;</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">\Delta \mathbf{U}_{\rm x}\\</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">\Delta \mathbf{\overline{U}}_{\rm x}\\</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">\Delta \mathbf{U}_{\rm y}\\</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">\Delta \mathbf{\overline{U}}_{\rm y}\\</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">\Delta \mathbf{P}\\</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">\Delta \mathbf{\Lambda}</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"> =</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">-</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">\mathbf{r}_{\rm x}\\</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">\mathbf{r}_{\bar{\rm x}}\\</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">\mathbf{r}_{\rm y}\\</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">\mathbf{r}_{\bar{\rm y}}\\</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">\mathbf{r}_{\rm p}\\</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">\mathbf{r}_{\rm \Lambda}</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">\ \ \ \ \ \   (7)</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">Here the vectors \f${\bf U}_{\rm x}\f$, \f${\bf U}_{\rm y}\f$, \f${\bf P}\f$</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">and \f${\bf \Lambda}\f$ contain the \f$x\f$ and \f$y\f$ components of the</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">velocity unknowns, the pressure unknowns and Lagrange multipliers unknowns,</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">respectively. The overbars identify the unknown nodal positions that are</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">constrained by the Lagrange multiplier. The matrices \f$M_{\rm x}\f$ and</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">\f$M_{\rm y}\f$ are mass-like matrices whose entries are formed from products</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">of the basis functions multiplied by a component of the tangent vector at each</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">discrete point on \f$\partial\Omega_{O}\f$, for example,</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">\f$[M_{{\rm x}}]_{ij}</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">\int_{\partial \Omega_{O}} t_x {\psi_i} \ {\psi_j} \ dS \f$. Denote</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">J_{\rm NS}</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">\begin{array}{ccccc}</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">{ F_{\rm xx}}&amp;{ F_{\rm x\bar{\rm</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">      x}}}&amp;{ F_{\rm xy}}&amp;{ F_{\rm x\bar{\rm y}}}&amp;{ B_{\rm x}^{T}}\\</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">{ F_{\bar{\rm x}\rm x}}&amp;{ F_{\bar{\rm x}\bar{\rm x}}}&amp;{ F_{\bar{\rm x}\rm y}}&amp;{ F_{\bar{\rm x}\bar{\rm y}}}&amp;{ B_{\bar{\rm x}}^{T}}\\</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">{ F_{\rm yx}}&amp;{ F_{\rm y\bar{\rm</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">      x}}}&amp;{ F_{\rm yy}}&amp;{ F_{\rm y\bar{\rm y}}}&amp;{ B_{\rm y}^{T}}\\</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">{ F_{\bar{\rm y}\rm x}}&amp;{ F_{\bar{\rm</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">      y}\bar{\rm x}}}&amp;{ F_{\bar{\rm y}\rm y}}&amp;{ </span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">  F_{\bar{\rm y}\bar{\rm y}}}&amp;{ B_{\bar{\rm y}}^{T}}\\</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">{ B_{\rm x}}&amp;{ B_{\bar{\rm x}}}&amp;{ B_{\rm y}}&amp;{ B_{\bar{\rm y}}}</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">\right],</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"> \ \ \ </span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">L = </span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">\begin{array}{ccccc}</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment"> &amp;{M_{\rm x}}&amp; &amp;{ M_{\rm x}} &amp;</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">\right],</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"> \ \ \ </span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">\Delta \mathbf{X}_{\rm NS}</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">\Delta \mathbf{U}_{\rm x}\\</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">\Delta \mathbf{\overline{U}}_{\rm x}\\</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">\Delta \mathbf{U}_{\rm y}\\</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">\Delta \mathbf{\overline{U}}_{\rm y}\\</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">\Delta \mathbf{P}</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">\right],\mbox{\ \ \ \ and }</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"> \ \ \ </span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">\mathbf{r}_{\rm NS}</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">\mathbf{r}_{\rm x}\\</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">\mathbf{r}_{\bar{\rm x}}\\</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">\mathbf{r}_{\rm y}\\</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">\mathbf{r}_{\bar{\rm y}}\\</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">\mathbf{r}_{\rm p}</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">Then we can re-write (7) as</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">{ J_{\rm NS}}&amp;L^{T}\\</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">L&amp; </span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">\Delta \mathbf{X}_{\rm NS}\\</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">\Delta \mathbf{\Lambda}</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> =</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">-</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">\mathbf{r}_{\rm NS}\\</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">\mathbf{r}_{\rm \Lambda}</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">\ \ \ \ \ \   (8)</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">We have shown that </span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">P=</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">{ J_{\rm NS}} + L^{T}W^{-1} L&amp; \\</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment"> &amp; W</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">\right],</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">\ \ \ \ \ \   (9)</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">where \f$W = \frac{1}{\sigma}LL^{T}\f$ is an optimal preconditioner for the</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">linear system (8) if we set \f$ \sigma=\|F\|_{\infty}</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">\f$ where \f$F\f$ is the compound \f$4\times 4\f$ top-left block </span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">F</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">\begin{array}{ccccc}</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">{ F_{\rm xx}}&amp;{ F_{\rm x\bar{\rm</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">      x}}}&amp;{ F_{\rm xy}}&amp;{ F_{\rm x\bar{\rm y}}}\\</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">{ F_{\bar{\rm x}\rm x}}&amp;{ F_{\bar{\rm x}\bar{\rm x}}}&amp;{ F_{\bar{\rm x}\rm y}}&amp;{ F_{\bar{\rm x}\bar{\rm y}}}\\</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">{ F_{\rm yx}}&amp;{ F_{\rm y\bar{\rm</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">      x}}}&amp;{ F_{\rm yy}}&amp;{ F_{\rm y\bar{\rm y}}}\\</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">{ F_{\bar{\rm y}\rm x}}&amp;{ F_{\bar{\rm</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">      y}\bar{\rm x}}}&amp;{ F_{\bar{\rm y}\rm y}}&amp;{ </span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">  F_{\bar{\rm y}\bar{\rm y}}}</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">in the Jacobian matrix.  Application of the preconditioner \f$P\f$ requires the</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">repeated solution of linear systems involving the diagonal blocks \f${J_{\rm</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">NS}} + L^{T}W^{-1} L\f$ and \f$W\f$.  The matrix \f$W^{-1} = \sigma</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">(LL^{T})^{-1} = \sigma ({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}\f$ is dense and</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">will cause the addition of dense sub-matrices to the Jacobian matrix:</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">\sigma L^{T}(LL^{T})^{-1}L</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">\sigma</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">\begin{array}{ccccc}</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">\cal O &amp;\cal O &amp;\cal O &amp;\cal O &amp;\cal O \\</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"> \cal O&amp;{M_{\rm x}}({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}{M_{\rm x}}&amp;\cal O &amp;{M_{\rm x}}({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}{M_{\rm y}}&amp;\cal O \\</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"> \cal O&amp;\cal O &amp;\cal O &amp;\cal O &amp;\cal O \\</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"> \cal O&amp;{M_{\rm y}}({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}{M_{\rm x}}&amp;\cal O &amp;{M_{\rm y}}({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}{M_{\rm y}}&amp; \cal O\\</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"> \cal O&amp;\cal O &amp;\cal O &amp;\cal O &amp;\cal O</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">Numerical experiments show that an efficient implementation can be obtained by</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">replacing \f$W\f$ by its diagonal approximation \f$\widehat{W} =</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">\mbox{diag}(M_{\rm x}^{2}+M_{\rm y}^{2})\f$.  Then the inversion of \f$W\f$ is</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">straight forward and the addition of \f$L^{T}{\widehat{W}}^{-1}L\f$ to the</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">Jacobian does not significantly increase the number of non-zero entries in the</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">matrix \f$J_{\rm NS}\f$.  Denote the efficient implementation by</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">\tilde{P}</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">=</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">\begin{array}{cc}</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">{ \tilde{J}_{\rm NS}}&amp; \\</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"> &amp; \widehat{W}</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">\right],</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">\ \ \ \ \ \   (10)</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">where \f$\tilde{J}_{\rm NS} =J_{\rm NS}+ L^{T}{\widehat{W}}^{-1}L\f$ is the</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">augmented Navier-Stokes Jacobian matrix.  In our implementation of the</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">preconditioner, the linear system involving \f$\tilde{J}_{\rm NS}\f$ can either</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">be solved &quot;exactly&quot;, using \c SuperLU (in its incarnation as an exact</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">preconditioner; this is the default) or by any other \c Preconditioner</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">(interpreted as an &quot;inexact solver&quot;) specified via the access function</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">LagrangeEnforcedFlowPreconditioner::set_navier_stokes_preconditioner(...)</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">Numerical experiments show that a nearly optimal preconditioner is obtained by</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">replacing the solution of the linear system involving the augmented</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">Navier-Stokes Jacobian \f$ \tilde{J}_{\rm NS} \f$ by an application of Elman,</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">Silvester and Wathen&#39;s &lt;a href=&quot;../../lsc_navier_stokes/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">Least-Squares Commutator (LSC) preconditioner&lt;/a&gt;, and by replacing the</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">remaining block-solves within these preconditioners by a small number of AMG</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">cycles.</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">With these approximations, the computational cost of one application of</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">\f$\tilde P\f$ is linear in the number of unknowns.  The optimality of the</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">preconditioner can therefore be assessed by demonstrating that the number of</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">GMRES iterations remains constant under mesh refinement.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">\section example Demo driver and use of the preconditioner</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">To demonstrate how to use the preconditioner, here are the relevant extracts</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">from the driver code &lt;A</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">HREF=&quot;../../../../demo_drivers/navier_stokes/lagrange_enforced_flow_preconditioner/two_d_tilted_square.cc&quot;&gt;</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">two_d_tilted_square.cc&lt;/A&gt; which solves the model problem described above.  As</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">explained in the &lt;a href=&quot;../../../linear_solvers/html/index.html&quot;&gt;Linear</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">Solvers Tutorial&lt;/A&gt; switching to an iterative linear solver is typically</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">performed in the \c Problem constructor and involves a few straightforward</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">steps:</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">-# &lt;b&gt;Create an instance of the IterativeLinearSolver and pass it to the</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">   Problem&lt;/b&gt; \n\n</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">   In our problem, we choose right preconditioned \c GMRES as the linear </span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">   solver: \n\n</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">   \dontinclude two_d_tilted_square.cc</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">   \skipline Create oomph-lib</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">   \until solver_pt;</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">-# &lt;b&gt;Create an instance of the Preconditioner and give it access to the </span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">   meshes&lt;/b&gt; \n\n</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">   The \c LagrangeEnforceFlowPreconditioner takes a pointer of meshes. </span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">   It is important that the bulk mesh is in position \c 0 :</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">   \skipline Create the preconditioner</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">   \until set_meshes(mesh_pt);</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">   By default, \c SuperLUPreconditioner is used for all subsidiary block</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">   solves. To use the LSC preconditioner to approximately solve the</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">   sub-block system involving the momentum block, we invoke the following:</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">   \skipline Create the NS LSC preconditioner</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">   \until set_navier_stokes_preconditioner(lsc_prec_pt);</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">   The LSC preconditioner is discussed in</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">   &lt;a href=&quot;../../lsc_navier_stokes/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">   another tutorial&lt;/A&gt;.</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">-# &lt;b&gt;Pass the preconditioner to the solver, and the solver to the problem</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">   &lt;/b&gt; \n\n</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">   \skipline Pass the preconditioner to the solver.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">   \until linear_solver_pt() = Solver_pt;</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">&lt;HR&gt; </span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">\section sources Source files for this tutorial</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">- The source files for this tutorial are located in the directory:\n\n</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/navier_stokes/lagrange_enforced_flow_preconditioner&quot;&gt;</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">demo_drivers/navier_stokes/lagrange_enforced_flow_preconditioner</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">&lt;/CENTER&gt;\n</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">- The driver code is: \n\n</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/navier_stokes/lagrange_enforced_flow_preconditioner/two_d_tilted_square.cc&quot;&gt;</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">demo_drivers/navier_stokes/lagrange_enforced_flow_preconditioner/two_d_tilted_square.cc</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">\section pdf PDF file</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">A &lt;a href=&quot;../latex/refman.pdf&quot;&gt;pdf version&lt;/a&gt; of this document is available.</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">**/</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="algr__navier__stokes_8txt_html_a62f0a458352206719cb3775c6648fbfa"><div class="ttname"><a href="lgr__navier__stokes_8txt.html#a62f0a458352206719cb3775c6648fbfa">block</a></div><div class="ttdeci">By c SuperLUPreconditioner is used for all subsidiary block solves To use the LSC preconditioner to approximately solve the sub block system involving the momentum block</div><div class="ttdef"><b>Definition:</b> <a href="lgr__navier__stokes_8txt_source.html#l00405">lgr_navier_stokes.txt:405</a></div></div>
<div class="ttc" id="algr__navier__stokes_8txt_html_a4074baada03976c061d5672f4237cca5"><div class="ttname"><a href="lgr__navier__stokes_8txt.html#a4074baada03976c061d5672f4237cca5">problem</a></div><div class="ttdeci">mainpage Demo problem</div><div class="ttdef"><b>Definition:</b> <a href="lgr__navier__stokes_8txt_source.html#l00007">lgr_navier_stokes.txt:7</a></div></div>
<div class="ttc" id="algr__navier__stokes_8txt_html_a9fe48f37eb1da14c81bb9bb3910ccfc1"><div class="ttname"><a href="lgr__navier__stokes_8txt.html#a9fe48f37eb1da14c81bb9bb3910ccfc1">c</a></div><div class="ttdeci">this is the default or by any other c Preconditioner(interpreted as an &quot;inexact solver&quot;) specified via the access function \code LagrangeEnforcedFlowPreconditioner n n meshes&lt;/b &gt; n n The c LagrangeEnforceFlowPreconditioner takes a pointer of meshes It is important that the bulk mesh is in position c</div><div class="ttdef"><b>Definition:</b> <a href="lgr__navier__stokes_8txt_source.html#l00356">lgr_navier_stokes.txt:356</a></div></div>
<div class="ttc" id="algr__navier__stokes_8txt_html_ae21d0e8035b920d37467483a2b1ac04a"><div class="ttname"><a href="lgr__navier__stokes_8txt.html#ae21d0e8035b920d37467483a2b1ac04a">following</a></div><div class="ttdeci">By c SuperLUPreconditioner is used for all subsidiary block solves To use the LSC preconditioner to approximately solve the sub block system involving the momentum we invoke the following</div><div class="ttdef"><b>Definition:</b> <a href="lgr__navier__stokes_8txt_source.html#l00407">lgr_navier_stokes.txt:407</a></div></div>
<div class="ttc" id="algr__navier__stokes_8txt_html_ac131914a186803ddf7a4d7fddfa83547"><div class="ttname"><a href="lgr__navier__stokes_8txt.html#ac131914a186803ddf7a4d7fddfa83547">Omega</a></div><div class="ttdeci">[0, 1]^2\f$ by the following transformation \f[R(\alpha)=\left(\begin{array}{cc} {\cos(\alpha)} &amp;{-\sin(\alpha)} \\ {\sin(\alpha)} &amp;{\cos(\alpha)} \end{array} \right), \ \ \ \ \ \ \ \ \ \ @E[eqnrotation]@ \f] where \f$\alpha\f$ is the angle of rotation. The figure below show the flow field(velocity vectors and pressure contours) for a unit square domain rotated by an angle of \f$\alpha=30^\circ \f$ and a Reynolds number of \f$ Re=100 \f$. The flow is driven by a prescribed parabolic boundary condition. @I w 0.4\textwidth SimAng30Rey100Noel4 &quot;Velocity field and pressure contours.&quot; For convenience, we present the boundary conditions for the non-rotated unit square \f$\alpha=0^{\circ}\f$. In order to obtain the boundary conditions for \f$\alpha \ne 0^\circ\f$, we only have to apply the rotation( @R[eqnrotation]@). The flow is driven by imposing a parabolic velocity profile along the inflow boundary \f$\Omega_I\f$. Along the characteristic boundary, \f$\Omega_C\f$, the no-slip condition \f $u_i=0\f$, \f $i=1, 2\f$, is prescribed. We impose `parallel outflow' along the outlet \f$\Omega_O\f$ by insisting that \f[{\bf u}\cdot {\bf t}_{}=0 \mbox{\ \ \ \ on $\Omega_{O}$,} \ \ \ \ \ \ \ \ \ \ @E[eqnbcpostrong]@ \f] where \f$ {\bf t}\f$ is the tangent vector at each discrete point on the boundary \f$ \Omega_{O}\f$. We weakly enforce the flow constraint by augmenting the Navier-Stokes momentum residual equation(introduced in the&lt; a href=&quot;../../../navier_stokes/rayleigh_traction_channel/html/index.html&quot;&gt; Unsteady flow in a 2D channel, driven by an applied traction&lt;/a &gt; tutorial) with a Lagrange multiplier term so that it becomes \f[r_{il}^{u}=\int_\Omega \left[Re \left(St\frac{\partial u_i}{\partial t}+u_j\frac{\partial u_i}{\partial x_j} \right) \psi_l+\tau_{ij}\frac{\partial \psi_l}{\partial x_j} \right] d\Omega - \int_{\partial\Omega} \tau_{ij} n_j\psi_l dS+\delta \Pi_{constraint}=0, \ \ \ \ \ \ \ \ \ \ @E[eqnaugmentedresu]@ \f] where \f[\Pi_{constraint}=\int_{\partial \Omega} \lambda u_i t_i dS, \ \ \ \ \ \ \ \ \ \ @E[eqnlgrterm]@ \f] and \f$\lambda\f$ is the Lagrange multiplier. Upon taking the first variation of the constraint with respect to the unknown velocity and the Lagrange multiplier, the residual form of the constrained momentum equation is \f[r_{il}^{u}=\int_\Omega \left[Re \left(St\frac{\partial u_i}{\partial t}+u_j\frac{\partial u_i}{\partial x_j} \right) \psi_l+\tau_{ij}\frac{\partial \psi_l}{\partial x_j} \right] d\Omega - \int_{\partial\Omega} \tau_{ij} n_j\psi_l dS+\int_{\partial\Omega} \lambda\psi_l t_i=0. \ \ \ \ \ \ \ \ \ \ @E[eqnaugmentedresufirstvar]@ \f] The weak formulation of( @R[eqnbcpostrong]@) is simply \f[r_{l}^{\lambda}=\int_\Omega u_i t_i \psi^\lambda dS=0, \ \ \ \ \ \ \ \ \ \ @E[eqnweakconstraint]@ \f] where \f$\psi^\lambda\f$ is a suitable basis function. Equation( @R[eqnaugmentedresufirstvar]@) reveals that the Lagrange multipliers act as the(negative) tangential traction \f$(\lambda=-{\mathbf{n}}^T{\mathbf{\tau}}{\mathbf{t}})\f$ that enforce the parallel flow across the boundary \f$\partial\Omega_{O}\f$. We discretise this constraint by attaching \c ImposeParallelOutflowElements to the boundaries of the &quot;bulk&quot; Navier-Stokes elements that are adjacent to \f$ \partial \Omega_O \f$ as shown in the&lt; a href=&quot;../../../navier_stokes/vmtk_fluid/html/index.html&quot;&gt; Steady finite-Reynolds-number flow through an iliac bifurcation&lt;/a &gt; tutorial, also see the&lt; a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt; Deformation of a solid by a prescribed boundary motion&lt;/a &gt; tutorial which employs a similar technique used to enforce prescribed boundary displacements in solid mechanics problems. We discretise the Navier-Stokes equations using \c oomph-lib 's \c QTaylorHoodElements, see the&lt; a href=&quot;../../../navier_stokes/driven_cavity/html/index.html&quot;&gt; 2D Driven Cavity Problem&lt;/a &gt; tutorial for more information. The discretised problem therefore contains the following types of discrete unknowns:- The fluid degrees of freedom(velocity and pressure).\n\n - The nodal values representing the components of the(vector-valued) Lagrange multipliers. These only exist for the nodes on \f$ \partial \Omega_O\f$.(The nodes are re-sized to accommodate the additional unknowns when the \c ImposeParallelOutflowElements are attached to the bulk elements.) . The preconditioner requires a further sub-division of these degrees of freedom into the following categories:- the unconstrained velocity in the x-direction - the unconstrained velocity in the y-direction -[the unconstrained velocity in the z-direction(only in 3D)] - the constrained velocity in the x-direction - the constrained velocity in the y-direction -[the constrained velocity in the z-direction(only in 3D)] - the Lagrange multiplier at the constrained nodes -[the other Lagrange multiplier at the constrained nodes(only in 3D)]. . For a 2D problem, the linear system to be solved in the course of the Newton iteration can then be(formally) re-ordered into the following block structure:\f[\left[\begin{array}{ccccc|c} { F_{\rm xx}}&amp;{ F_{\rm x\bar{\rm x}}}&amp;{ F_{\rm xy}}&amp;{ F_{\rm x\bar{\rm y}}}&amp;{ B_{\rm x}^{T}}&amp;\\ { F_{\bar{\rm x}\rm x}}&amp;{ F_{\bar{\rm x}\bar{\rm x}}}&amp;{ F_{\bar{\rm x}\rm y}}&amp;{ F_{\bar{\rm x}\bar{\rm y}}}&amp;{ B_{\bar{\rm x}}^{T}}&amp;{ M_{\rm x}}\\ { F_{\rm yx}}&amp;{ F_{\rm y\bar{\rm x}}}&amp;{ F_{\rm yy}}&amp;{ F_{\rm y\bar{\rm y}}}&amp;{ B_{\rm y}^{T}}&amp;\\ { F_{\bar{\rm y}\rm x}}&amp;{ F_{\bar{\rm y}\bar{\rm x}}}&amp;{ F_{\bar{\rm y}\rm y}}&amp;{ F_{\bar{\rm y}\bar{\rm y}}}&amp;{ B_{\bar{\rm y}}^{T}}&amp;{ M_{\rm y}}\\ { B_{\rm x}}&amp;{ B_{\bar{\rm x}}}&amp;{ B_{\rm y}}&amp;{ B_{\bar{\rm y}}}&amp;\\ \hline &amp;{ M_{\rm x}}&amp;&amp;{ M_{\rm y}}&amp;&amp;\end{array} \right] \left[\begin{array}{c} \Delta \mathbf{U}_{\rm x}\\ \Delta \mathbf{\overline{U}}_{\rm x}\\ \Delta \mathbf{U}_{\rm y}\\ \Delta \mathbf{\overline{U}}_{\rm y}\\ \Delta \mathbf{P}\\ \Delta \mathbf{\Lambda} \end{array} \right]=- \left[\begin{array}{c} \mathbf{r}_{\rm x}\\ \mathbf{r}_{\bar{\rm x}}\\ \mathbf{r}_{\rm y}\\ \mathbf{r}_{\bar{\rm y}}\\ \mathbf{r}_{\rm p}\\ \mathbf{r}_{\rm \Lambda} \end{array} \right]. \ \ \ \ \ \ @E[linear_system]@ \f] Here the vectors \f${\bf U}_{\rm x}\f$, \f${\bf U}_{\rm y}\f$, \f${\bf P}\f$ and \f${\bf \Lambda}\f$ contain the \f $x\f$ and \f $y\f$ components of the velocity unknowns, the pressure unknowns and Lagrange multipliers unknowns, respectively. The overbars identify the unknown nodal positions that are constrained by the Lagrange multiplier. The matrices \f $M_{\rm x}\f$ and \f $M_{\rm y}\f$ are mass-like matrices whose entries are formed from products of the basis functions multiplied by a component of the tangent vector at each discrete point on \f$\partial\Omega_{O}\f$, for example, \f$[M_{{\rm x}}]_{ij}=\int_{\partial \Omega_{O}} t_x {\psi_i} \ {\psi_j} \ dS \f$. Denote \f[J_{\rm NS}=\left[\begin{array}{ccccc} { F_{\rm xx}}&amp;{ F_{\rm x\bar{\rm x}}}&amp;{ F_{\rm xy}}&amp;{ F_{\rm x\bar{\rm y}}}&amp;{ B_{\rm x}^{T}}\\ { F_{\bar{\rm x}\rm x}}&amp;{ F_{\bar{\rm x}\bar{\rm x}}}&amp;{ F_{\bar{\rm x}\rm y}}&amp;{ F_{\bar{\rm x}\bar{\rm y}}}&amp;{ B_{\bar{\rm x}}^{T}}\\ { F_{\rm yx}}&amp;{ F_{\rm y\bar{\rm x}}}&amp;{ F_{\rm yy}}&amp;{ F_{\rm y\bar{\rm y}}}&amp;{ B_{\rm y}^{T}}\\ { F_{\bar{\rm y}\rm x}}&amp;{ F_{\bar{\rm y}\bar{\rm x}}}&amp;{ F_{\bar{\rm y}\rm y}}&amp;{ F_{\bar{\rm y}\bar{\rm y}}}&amp;{ B_{\bar{\rm y}}^{T}}\\ { B_{\rm x}}&amp;{ B_{\bar{\rm x}}}&amp;{ B_{\rm y}}&amp;{ B_{\bar{\rm y}}} \end{array} \right], \ \ \ L=\left[\begin{array}{ccccc} &amp;{M_{\rm x}}&amp;&amp;{ M_{\rm x}} &amp;\end{array} \right], \ \ \ \Delta \mathbf{X}_{\rm NS}=\left[\begin{array}{c} \Delta \mathbf{U}_{\rm x}\\ \Delta \mathbf{\overline{U}}_{\rm x}\\ \Delta \mathbf{U}_{\rm y}\\ \Delta \mathbf{\overline{U}}_{\rm y}\\ \Delta \mathbf{P} \end{array} \right],\mbox{\ \ \ \ and } \ \ \ \mathbf{r}_{\rm NS}=\left[\begin{array}{c} \mathbf{r}_{\rm x}\\ \mathbf{r}_{\bar{\rm x}}\\ \mathbf{r}_{\rm y}\\ \mathbf{r}_{\bar{\rm y}}\\ \mathbf{r}_{\rm p} \end{array} \right]. \f] Then we can re-write( @R[linear_system]@) as \f[\left[\begin{array}{cc} { J_{\rm NS}}&amp;L^{T}\\ L &amp;\end{array} \right] \left[\begin{array}{c} \Delta \mathbf{X}_{\rm NS}\\ \Delta \mathbf{\Lambda} \end{array} \right]=- \left[\begin{array}{c} \mathbf{r}_{\rm NS}\\ \mathbf{r}_{\rm \Lambda} \end{array} \right]. \ \ \ \ \ \ @E[linear_system_small]@ \f] We have shown that \f[P=\left[\begin{array}{cc} { J_{\rm NS}}+L^{T}W^{-1} L &amp;\\ &amp;W \end{array} \right], \ \ \ \ \ \ @E[prec_ideal_small]@ \f] where \f $W=\frac{1}{\sigma}LL^{T}\f$ is an optimal preconditioner for the linear system( @R[linear_system_small]@) if we set \f$ \sigma=\|F\|_{\infty} \f$ where \f $F\f$ is the compound \f $4\times 4\f$ top-left block \f[F=\left[\begin{array}{ccccc} { F_{\rm xx}}&amp;{ F_{\rm x\bar{\rm x}}}&amp;{ F_{\rm xy}}&amp;{ F_{\rm x\bar{\rm y}}}\\ { F_{\bar{\rm x}\rm x}}&amp;{ F_{\bar{\rm x}\bar{\rm x}}}&amp;{ F_{\bar{\rm x}\rm y}}&amp;{ F_{\bar{\rm x}\bar{\rm y}}}\\ { F_{\rm yx}}&amp;{ F_{\rm y\bar{\rm x}}}&amp;{ F_{\rm yy}}&amp;{ F_{\rm y\bar{\rm y}}}\\ { F_{\bar{\rm y}\rm x}}&amp;{ F_{\bar{\rm y}\bar{\rm x}}}&amp;{ F_{\bar{\rm y}\rm y}}&amp;{ F_{\bar{\rm y}\bar{\rm y}}} \end{array} \right] \f] in the Jacobian matrix. Application of the preconditioner \f $P\f$ requires the repeated solution of linear systems involving the diagonal blocks \f${J_{\rm NS}}+L^{T}W^{-1} L\f$ and \f $W\f$. The matrix \f $W^{-1}=\sigma(LL^{T})^{-1}=\sigma({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}\f$ is dense and will cause the addition of dense sub-matrices to the Jacobian matrix:\f[\sigma L^{T}(LL^{T})^{-1}L=\sigma \left[\begin{array}{ccccc} \cal O &amp;\cal O &amp;\cal O &amp;\cal O &amp;\cal O \\ \cal O &amp;{M_{\rm x}}({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}{M_{\rm x}}&amp;\cal O &amp;{M_{\rm x}}({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}{M_{\rm y}}&amp;\cal O \\ \cal O &amp;\cal O &amp;\cal O &amp;\cal O &amp;\cal O \\ \cal O &amp;{M_{\rm y}}({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}{M_{\rm x}}&amp;\cal O &amp;{M_{\rm y}}({M_{\rm x}}^{2}+{M_{\rm y}^{2}})^{-1}{M_{\rm y}}&amp;\cal O\\ \cal O &amp;\cal O &amp;\cal O &amp;\cal O &amp;\cal O \end{array} \right]. \f] Numerical experiments show that an efficient implementation can be obtained by replacing \f $W\f$ by its diagonal approximation \f$\widehat{W}=\mbox{diag}(M_{\rm x}^{2}+M_{\rm y}^{2})\f$. Then the inversion of \f $W\f$ is straight forward and the addition of \f $L^{T}{\widehat{W}}^{-1}L\f$ to the Jacobian does not significantly increase the number of non-zero entries in the matrix \f $J_{\rm NS}\f$. Denote the efficient implementation by \f[\tilde{P}=\left[\begin{array}{cc} { \tilde{J}_{\rm NS}}&amp;\\ &amp;\widehat{W} \end{array} \right], \ \ \ \ \ \ @E[prec_eff_small]@ \f] where \f$\tilde{J}_{\rm NS}=J_{\rm NS}+L^{T}{\widehat{W}}^{-1}L\f$ is the augmented Navier-Stokes Jacobian matrix. In our implementation of the preconditioner, the linear system involving \f$\tilde{J}_{\rm NS}\f$ can either be solved &quot;exactly&quot;, using \c SuperLU(in its incarnation as an exact preconditioner Omega</div><div class="ttdef"><b>Definition:</b> <a href="lgr__navier__stokes_8txt_source.html#l00355">lgr_navier_stokes.txt:355</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Wed Jul 21 2021 19:39:43
        </div>
      </div>
    </footer>
</body>
</html>
