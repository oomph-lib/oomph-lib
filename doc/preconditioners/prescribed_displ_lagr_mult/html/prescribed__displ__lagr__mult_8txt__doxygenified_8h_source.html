<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: prescribed_displ_lagr_mult.txt_doxygenified.h Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get it <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/subversion/html/index.html">Get code from subversion repository</a></li>
            <li><a href="../../../../doc/download/html/index.html">Get code as tar file</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">prescribed_displ_lagr_mult.txt_doxygenified.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="prescribed__displ__lagr__mult_8txt__doxygenified_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">\mainpage Demo problem: A preconditioner for the solution of (pseudo-)solid mechanics problems with prescribed boundary motions</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">In this tutorial we </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">&lt;a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt;re-visit</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">&lt;/a&gt; the solution of solid mechanics problems</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">in which the deformation of the domain boundary is prescribed and</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">enforced by Lagrange multipliers. This</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">functionality is required, e.g., when using (pseudo-)solid mechanics</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">to update the shape of the fluid mesh in large-displacement </span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">fluid-structure interaction problems. </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">  Here we focus on the efficient solution of the governing equations</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">by GMRES, using the problem-specific block-preconditioner developed</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">in </span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">&lt;center&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">Muddle, R.L., Mihajlovic, M. &amp; Heil, M. (2012)</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">An efficient preconditioner for monolithically-coupled </span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">large-displacement fluid-structure interaction problems </span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">with pseudo-solid mesh updates. &lt;em&gt;Journal of Computational Physics&lt;/em&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">&lt;b&gt;231&lt;/b&gt;, 7315-7334. DOI: </span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">&lt;a href=&quot;http://dx.doi.org/10.1016/j.jcp.2012.07.001&quot;&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">10.1016/j.jcp.2012.07.001&lt;/a&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">&lt;/center&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">&lt;HR&gt; </span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">\section model Theory: Problem formulation, the resulting linear system and the preconditioner</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">We refer to </span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">&lt;a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">another tutorial&lt;/a&gt; for a detailed description of the problem</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">setup and its discretisation. Briefly, we consider the deformation of</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">an elastic solid body whose shape is parametrised</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">by Lagrangian coordinates \f$ \xi^i \f$. A part of the body&#39;s boundary, </span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">\f$ \partial D_{prescr}\f$, (which is parametrised by the boundary coordinate</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">\f$ \zeta\f$) is displaced to a new position given by </span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">\f$ {\bf R}_{prescr}(\zeta) \f$ while the other boundaries are held</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">in a fixed position (as in the sketch below) or are subject to </span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">traction boundary conditions. </span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">   </span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">\image html sketch.gif &quot;Sketch of the typical problem. &quot; </span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">\image latex sketch.eps &quot;Sketch of the typical problem. &quot; width=0.75\textwidth</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">We discretise the problem using \c SolidElements in the</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">bulk of the domain and employ lower-dimensional </span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">\c FaceElements to impose the displacement constraint</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">along \f$ \partial D_{prescr}\f$. The problem therefore contains the </span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">following types of discrete unknowns:</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">- The nodal positions (which are stored as positional \c Data at each \c</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">  SolidNode). \n\n</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">- The nodal values representing the components of the (vector-valued)</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">  Lagrange multipliers. These only exist for the nodes on </span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">  \f$ \partial D_{prescr}\f$. (The nodes are re-sized to</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">  accommodate the additional unknowns when the \c FaceElements are</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">  attached to the bulk elements.)</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">. </span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">The preconditioner requires a further sub-division of these degrees of</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">freedom into the following categories:</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">- the x-coordinates of the unconstrained nodes</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">- the y-coordinates of the unconstrained nodes</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">- [the z-coordinates of the unconstrained nodes (only in 3D)]</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">- the x-coordinates of the constrained nodes</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">- the y-coordinates of the constrained nodes</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">- [the z-coordinates of the constrained nodes (only in 3D)]</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">- the x-component of the Lagrange multiplier at the constrained nodes</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">- the y-component of the Lagrange multiplier at the constrained nodes</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">- [the z-component of the Lagrange multiplier at the constrained nodes</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">  (only in 3D)].</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">For a 2D problem, the linear system to be solved in the course </span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">of the Newton iteration can then be (formally) re-ordered </span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">into the following block structure:</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">\begin{array}{cccc|cc}</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">{ E_{\rm xx}}&amp;{ E_{\rm x\bar{\rm</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">      x}}}&amp;{ E_{\rm xy}}&amp;{ E_{\rm x\bar{\rm y}}}&amp;&amp;\\</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">{ E_{\bar{\rm x}\rm x}}&amp;{ E_{\bar{\rm</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">      x}\bar{\rm x}}}&amp;{ E_{\bar{\rm x}\rm</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">    y}}&amp;{ E_{\bar{\rm x}\bar{\rm y}}}&amp;{ M_{\rm</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">    x}}&amp;\\</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">{ E_{\rm yx}}&amp;{ E_{\rm y\bar{\rm</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">      x}}}&amp;{ E_{\rm yy}}&amp;{ E_{\rm y\bar{\rm y}}}&amp;&amp;\\</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">{ E_{\bar{\rm y}\rm x}}&amp;{ E_{\bar{\rm</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">      y}\bar{\rm x}}}&amp;{ E_{\bar{\rm y}\rm y}}&amp;{ </span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">  E_{\bar{\rm y}\bar{\rm y}}}&amp;&amp;{ M_{\rm y}}\\</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">\hline</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">&amp;{ M_{\rm x}}&amp;&amp;&amp;\\</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">&amp;&amp;&amp;{ M_{\rm y}}&amp;&amp;</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">\Delta \mathbf{X}_{\rm x}\\</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">\Delta \mathbf{\overline{X}}_{\rm x}\\</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">\Delta \mathbf{X}_{\rm y}\\</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">\Delta \mathbf{\overline{X}}_{\rm y}\\</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">\Delta \mathbf{L}_{\rm x}\\</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">\Delta \mathbf{L}_{\rm y}</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"> =</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">-</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">\mathbf{r}_{\rm x}\\</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">\mathbf{r}_{\bar{\rm x}}\\</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">\mathbf{r}_{\rm y}\\</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">\mathbf{r}_{\bar{\rm y}}\\</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">\mathbf{r}_{\rm l_x}\\</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">\mathbf{r}_{\rm l_y}</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">\ \ \ \ \ \   (1)</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">Here the vectors \f${\bf X}_{\rm x}\f$, \f${\bf X}_{\rm y}\f$, </span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">\f${\bf L}_{\rm x}\f$ and \f${\bf</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">  L}_{\rm y}\f$ contain the \f$x\f$ and \f$y\f$ components of the unknown</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">nodal positions and Lagrange multipliers, respectively. The overbars </span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">identify the unknown nodal positions that are constrained by the </span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">Lagrange multiplier. The matrices \f$M_{\rm x}\f$ and \f$M_{\rm y}\f$ </span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">are mass matrices </span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">whose entries are formed from products of the basis functions,</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">\f$[M_{{\rm x}}]_{ij}=[M_{{\rm y}}]_{ij} = </span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">\int_{\partial D_{\rm prescr}} {\psi_i} \ {\psi_j} \ dS \f$.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">&lt;a href=&quot;http://dx.doi.org/10.1016/j.jcp.2012.07.001&quot;&gt;</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">Muddle, Mihajlovic &amp; Heil (2012) &lt;/a&gt; show that</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">{\cal P}_{\rm PS}=\left[</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">\begin{array}{cccc|cc}</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">E_{\rm xx}&amp;E_{\rm x\bar{\rm x}}&amp;E_{\rm xy}&amp;E_{\rm x\bar{\rm</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">    y}}&amp;&amp;\\ E_{\bar{\rm x}\rm x}&amp;E_{\bar{\rm x}\bar{\rm x}}+\sigma</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">I&amp;E_{\bar{\rm x}\rm y}&amp;E_{\bar{\rm x}\bar{\rm y}}&amp;&amp;\\ E_{\rm</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">  yx}&amp;E_{\rm y\bar{\rm x}}&amp;E_{\rm yy}&amp;E_{\rm y\bar{\rm</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">    y}}&amp;&amp;\\ E_{\bar{\rm y}\rm x}&amp;E_{\bar{\rm y}\bar{\rm</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">    x}}&amp;E_{\bar{\rm y}\rm y}&amp;E_{\bar{\rm y}\bar{\rm y}}+\sigma</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">I&amp;&amp;\\ \hline</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">&amp;&amp;&amp;&amp;\frac{1}{\sigma}M_{\rm x}^2&amp;\\ &amp;&amp;&amp;&amp;&amp;\frac{1}{\sigma}M_{\rm y}^2\\</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">\ \ \ \ \ \   (2)</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">is an optimal preconditioner for the linear system</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">(1) if we set \f$ \sigma=\|E\|_{\infty} \f$ </span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">where \f$ E \f$ is the compound </span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">4x4 top-left block </span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">E =</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">\begin{array}{cccc}</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">E_{\rm xx}&amp;E_{\rm x\bar{\rm x}}&amp;E_{\rm xy}&amp;E_{\rm x\bar{\rm y}}\\ </span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">E_{\bar{\rm x}\rm x}&amp;E_{\bar{\rm x}\bar{\rm x}}</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">&amp;E_{\bar{\rm x}\rm y}&amp;E_{\bar{\rm x}\bar{\rm y}} \\</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"> E_{\rm yx}&amp;E_{\rm y\bar{\rm x}}&amp;E_{\rm yy}&amp;E_{\rm y\bar{\rm y}}\\ </span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">E_{\bar{\rm y}\rm x}&amp;E_{\bar{\rm y}\bar{\rm x}}&amp;</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">E_{\bar{\rm y}\rm y}&amp;E_{\bar{\rm y}\bar{\rm y}}</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">in the Jacobian matrix.</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">The application of the preconditioner (i.e. the </span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">solution of linear systems of the form \f$ {\cal P}_{\rm PS} \ {\bf x} =</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">{\bf y} \f$ for \f$ {\bf x} \f$) requires three </span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">linear solves: One involving the</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">compound 4x4 top-left block in \f$ {\cal P}_{\rm PS} \f$,</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">E_{\rm PS}=</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">\left[</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">\begin{array}{cccc}</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">E_{\rm xx}&amp;E_{\rm x\bar{\rm x}}&amp;E_{\rm xy}&amp;E_{\rm x\bar{\rm y}}\\ </span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">E_{\bar{\rm x}\rm x}&amp;E_{\bar{\rm x}\bar{\rm x}}+\sigma</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">I&amp;E_{\bar{\rm x}\rm y}&amp;E_{\bar{\rm x}\bar{\rm y}} \\</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"> E_{\rm yx}&amp;E_{\rm y\bar{\rm x}}&amp;E_{\rm yy}&amp;E_{\rm y\bar{\rm y}}\\ </span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">E_{\bar{\rm y}\rm x}&amp;E_{\bar{\rm y}\bar{\rm x}}&amp;</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">E_{\bar{\rm y}\rm y}&amp;E_{\bar{\rm y}\bar{\rm y}}+\sigma I</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">\right]</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">and two involving the two squared mass matrices,</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">\f$ M_{\rm x}^2 \f$ and \f$ M_{\rm y}^2 \f$.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">Numerical experiments in &lt;a href=&quot;http://dx.doi.org/10.1016/j.jcp.2012.07.001&quot;&gt;</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">Muddle, Mihajlovic &amp; Heil (2012) &lt;/a&gt; show that an efficient </span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">implementation of the preconditioner is obtained by</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">replacing the \f$ E_{\rm PS} \f$ block in the preconditioner </span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">\f$ {\cal P}_{\rm PS} \f$ by its upper </span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">block-triangular approximation, corresponding to the preconditioner</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">\widetilde{\cal P}_{\rm PS}=\left[</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">\begin{array}{cccc|cc}</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">E_{xx}&amp;E_{x\bar{x}}&amp;E_{xy}&amp;E_{x\bar{y}}&amp;&amp;\\ E_{\bar{x}x}&amp;E_{\bar{x}\bar{x}}+\sigma</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">I&amp;E_{\bar{x}y}&amp;E_{\bar{x}\bar{y}}&amp;&amp;\\ &amp;&amp;E_{yy}&amp;E_{y\bar{y}}&amp;&amp;\\ &amp;&amp;E_{\bar{y}y}&amp;E_{\bar{y}\bar{y}}+\sigma</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">I&amp;&amp;\\ \hline</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">&amp;&amp;&amp;&amp;\frac{1}{\sigma}M_x^2&amp;\\ &amp;&amp;&amp;&amp;&amp;\frac{1}{\sigma}M_y^2\\</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">\right].</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">\ \ \ \ \ \   (3)</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">Furthermore, a fully optimal </span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">preconditioner (in which the solve times scale linearly with the</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">number of unknowns) can be obtained by:</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">- approximately solving the </span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">  subsidiary linear systems involving the diagonal blocks</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">  \f[</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">  \left[</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">  \begin{array}{cc}</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">  E_{xx}&amp;E_{x\bar{x}}\\ E_{\bar{x}x}&amp;E_{\bar{x}\bar{x}}+\sigma I\\</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">  \end{array}</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">  \right]</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">  \mbox{\ \ \ \ and\ \ \ \ \ }</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">  \left[</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">  \begin{array}{cc}</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">  E_{yy}&amp;E_{y\bar{y}}\\ E_{\bar{y}y}&amp;E_{\bar{y}\bar{y}}+\sigma I\\</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">  \end{array}</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">  \right]</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">  \f]</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">  in (3) by performing a fixed number of algebraic </span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">  multigrid (AMG) cycles,</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">and by</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">- approximately solving the subsidiary linear systems </span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">  involving \f$ M_{\rm x}^2 \f$ and \f$ M_{\rm y}^2 \f$ by </span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">  two consecutive linear solves involving the mass matrices</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">  themselves. Following Wathen [A. Wathen, </span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">  &quot;Realistic eigenvalue bounds for the Galerkin mass matrix&quot;, </span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">  IMA Journal of Numerical Analysis 7 (1987) 449-457], </span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">  &lt;a href=&quot;http://dx.doi.org/10.1016/j.jcp.2012.07.001&quot;&gt;</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">  Muddle, Mihajlovic &amp; Heil (2012) &lt;/a&gt;</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">  suggest employing CG, preconditioned by diagonal scaling, as the solver</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">  for these systems. This solver converges so rapidly that a fixed</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">  number of four CG iterations suffices to compute the solution to</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">  sufficient accuracy so that \f$ \widetilde{\cal P}_{\rm PS} \f$ can be treated</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">  as a constant preconditioner.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">With these approximations, the computational</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">cost of one application of \f$ \widetilde{\cal P}_{\rm PS} \f$ is linear</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">in the number of unknowns. The optimality of the preconditioner</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">can therefore be assessed by demonstrating that </span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">the number of GMRES iterations remains constant under </span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">mesh refinement.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">\section implementation Implementation and use of the preconditioner</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">The preconditioner described above is implemented within \c oomph-lib&#39;s</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">(parallel) block preconditioning framework which is described in </span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">&lt;a href=&quot;../../../mpi/block_preconditioners/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">another tutorial&lt;/a&gt;. For the purpose of the implementation,</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">we decompose the preconditioning matrix into the 2x2</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">main blocks indicated by the vertical and horizontal lines</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">in (2) and (3).</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">The application of the preconditioner requires</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">the classification of the unknowns into the six (in 2D) different &quot;dof types&quot;</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">discussed above. This is done on an element-by-element basis (since</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">only the elements &quot;know&quot; what their nodal degrees of freedom correspond</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">to) by implementing/overloading the functions</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">- \c GeneralisedElement::ndof_types(...) which returns the number of</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">  dof types classified by that element.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">- \c GeneralisedElement::get_block_numbers_for_unknowns(...) which</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">  associates each degree of freedom (identified by its global equation</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">  number) with the dof type within its block. </span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">  \n\n</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">For a 2D problem the enumeration of the dofs is chosen as follows. The</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">\c SolidElements classify only the nodal positions and sub-divide them</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">into those that are constrained and not constrained by the </span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">displacement boundary condition so that within that block </span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">- dof type 0 corresponds to the unconstrained x-nodal coordinates,</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">- dof type 1 corresponds to the unconstrained y-nodal coordinates,</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">- dof type 2 corresponds to the constrained x-nodal coordinates,</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">- dof type 3 corresponds to the constrained y-nodal coordinates.</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">The \c FaceElements that apply the displacement constraint </span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">classify the Lagrange multipliers so that within that block</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">- dof type 0 corresponds to the x-component of the Lagrange multiplier,</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">- dof type 1 corresponds to the y-component of the Lagrange multiplier,</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">with the obvious generalisation to 3D.</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">\section results Results</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">We examine the performance of the preconditioner</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">in the test problem discussed in </span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">&lt;a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt;another</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">tutorial&lt;/a&gt;: The upper surface of a unit square is subjected</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">to a prescribed displacement that is imposed by Lagrange multipliers.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">The first of the two tables below shows the GMRES iteration counts (averaged </span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">over all linear solves performed in the course of all Newton</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">iterations) as a function of the mesh refinement (represented by the</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">total number of unknowns) for different implementations of the</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">preconditioner. </span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">- &lt;b&gt;&quot;SuperLU&quot;&lt;/b&gt; corresponds to the exact implementation of the </span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">  preconditioner \f$ E_{\rm PS} \f$ in which the linear systems involving </span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">  the matrix \f$ E_{\rm PS} \f$ and the two squared mass matrices, </span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">  \f$ M_{\rm x}^2 \f$ and \f$ M_{\rm y}^2 \f$, are solved by SuperLU.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">- &lt;b&gt;&quot;Upper triangular E&quot;&lt;/b&gt; corresponds to the case in which </span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">  \f$ E_{\rm PS} \f$ is replaced by its upper block-triangular</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">  approximation (corresponding to \f$ \tilde{\cal P}_{\rm PS} \f$)</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">  but the four linear solves (two involving the diagonal blocks of</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">  \f$ E_{\rm PS} \f$; two involving the squared mass matrices, </span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">  \f$ M_{\rm x}^2 \f$ and \f$ M_{\rm y}^2 \f$), are performed by SuperLU.</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">- &lt;b&gt;&quot;Upper triangular E; Hypre/CG&quot;&lt;/b&gt; are the results obtained when using</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">  the same block approximation of the preconditioner, but using </span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">  two AMG cycles (performed with Hypre) for the approximate solution</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">  of the diagonal blocks of \f$ E_{\rm PS} \f$, and diagonally</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">  preconditioned CG as the approximate solver for the mass matrices.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">&lt;CENTER&gt;&lt;TABLE&gt;</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">&lt;TR&gt; &lt;TD&gt; &lt;CODE&gt;n_dof&lt;/CODE&gt; &lt;/TD&gt; &lt;TD&gt; 798 &lt;/TD&gt; &lt;TD&gt; 3198 &lt;/TD&gt; &lt;TD&gt; 12798 &lt;/TD&gt; &lt;TD&gt; 51198 &lt;/TD&gt; &lt;TD&gt; 204798 &lt;/TD&gt;  &lt;/TR&gt;</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">&lt;TR&gt;&lt;TD&gt;SuperLU &lt;/TD&gt; &lt;TD&gt; 8.1 &lt;/TD&gt; &lt;TD&gt; 8.1 &lt;/TD&gt; &lt;TD&gt; 8.3 &lt;/TD&gt; &lt;TD&gt; 8.3 &lt;/TD&gt; &lt;TD&gt; 8.3 &lt;/TD&gt;  &lt;/TR&gt;</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">&lt;TR&gt;&lt;TD&gt;Upper triangular E&lt;/TD&gt; &lt;TD&gt; 24.9 &lt;/TD&gt; &lt;TD&gt; 26.9 &lt;/TD&gt; &lt;TD&gt; 28.4 &lt;/TD&gt; &lt;TD&gt; 28.7 &lt;/TD&gt; &lt;TD&gt; 28.9 &lt;/TD&gt;  &lt;/TR&gt;</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">&lt;TR&gt;&lt;TD&gt;Upper triangular E; Hypre/CG&lt;/TD&gt; &lt;TD&gt; 24.9 &lt;/TD&gt; &lt;TD&gt; 26.9 &lt;/TD&gt; &lt;TD&gt; 28.4 &lt;/TD&gt; &lt;TD&gt; 28.8 &lt;/TD&gt; &lt;TD&gt; 29.1 &lt;/TD&gt;  &lt;/TR&gt;</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">&lt;/TABLE&gt;&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">&lt;b&gt;Table 1:&lt;/b&gt; Average GMRES iteration counts as a function of the mesh</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">refinement (indicated by</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">the number of unknowns, \c n_dof) for different implementations of the</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">preconditioner.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">As expected, the GMRES iteration counts are small and mesh independent for the</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">exact implementation of the preconditioner. Replacing the (costly) exact </span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">solves by (faster) approximate solves leads to a modest</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">increase in the (absolute) number of GMRES iterations, while </span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">retaining their virtual mesh independence under sufficiently </span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">strong mesh refinement.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">The benefit of switching to the approximate solves becomes apparent</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">in the next table which shows the average cpu times required </span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">for the solution of the linear systems by GMRES. For sufficiently </span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">fine discretisations the larger number of GMRES iterations for the</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">inexact solves is more than compensated for by the much lower cost</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">of the preconditioning operations. The final</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">implementation yields cpu times that are proportional to the</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">number of unknowns -- the hallmark of an optimal solver.</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">&lt;CENTER&gt;&lt;TABLE&gt;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">&lt;TR&gt; &lt;TD&gt; &lt;CODE&gt;n_dof&lt;/CODE&gt; &lt;/TD&gt; &lt;TD&gt; 798 &lt;/TD&gt; &lt;TD&gt; 3198 &lt;/TD&gt; &lt;TD&gt; 12798 &lt;/TD&gt; &lt;TD&gt; 51198 &lt;/TD&gt; &lt;TD&gt; 204798 &lt;/TD&gt;  &lt;/TR&gt;</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">&lt;TR&gt;&lt;TD&gt;SuperLU &lt;/TD&gt; &lt;TD&gt; 0.140409 &lt;/TD&gt; &lt;TD&gt; 0.720991 &lt;/TD&gt; &lt;TD&gt; 4.47518 &lt;/TD&gt; &lt;TD&gt; 35.1349 &lt;/TD&gt; &lt;TD&gt; 336.517 &lt;/TD&gt;  &lt;/TR&gt;</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">&lt;TR&gt;&lt;TD&gt;Upper triangular E&lt;/TD&gt; &lt;TD&gt; 0.160478 &lt;/TD&gt; &lt;TD&gt; 0.737302 &lt;/TD&gt; &lt;TD&gt; 3.80428 &lt;/TD&gt; &lt;TD&gt; 22.6697 &lt;/TD&gt; &lt;TD&gt; 170.048 &lt;/TD&gt;  &lt;/TR&gt;</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">&lt;TR&gt;&lt;TD&gt;Upper triangular E; Hypre/CG&lt;/TD&gt; &lt;TD&gt; 0.225759 &lt;/TD&gt; &lt;TD&gt; 0.895603 &lt;/TD&gt; &lt;TD&gt; 3.61778 &lt;/TD&gt; &lt;TD&gt; 15.8982 &lt;/TD&gt; &lt;TD&gt; 64.4825 &lt;/TD&gt;  &lt;/TR&gt;</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">&lt;/TABLE&gt;&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">&lt;b&gt;Table 2:&lt;/b&gt;  Average GMRES solve times [sec] as a function of the mesh</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">refinement (indicated by the number of unknowns, \c n_dof) for</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">different implementations of the preconditioner.</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">\section modifications Modifications to the driver code</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">Most of the driver code is unchanged from the implementation</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">discussed in the  </span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">&lt;a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt;original</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">tutorial.&lt;/a&gt; We therefore only discuss the modifications required</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">to employ preconditioned GMRES as the linear solver for the Newton method.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">\subsection reclass (Re-)classification of the dof types</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">As discussed above (and in the more detailed </span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">&lt;a href=&quot;../../../mpi/block_preconditioners/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">block-preconditioning tutorial&lt;/a&gt;, the classification of the</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">degrees of freedom into different &quot;dof types&quot; has to be performed</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">by the elements. Our implementation of the pseudo-elastic preconditioner</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">treats the solver for the linear system involving  \f$ E_{\rm PS} \f$</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">as a subsidiary preconditioner. \c oomph-lib&#39;s existing solid mechanics</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">elements already provide dof classification for the </span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">nodal positions according to the coordinate directions (so for a 2D</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">displacement-based solid element the call to</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">\c ndof_types() will return 2 -- the x and y nodal positions). </span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">If these elements are to be used with our preconditioner, this classification</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">must be over-written to distinguish between constrained</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">and unconstrained nodal positions. This is done most easily by providing</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">a wrapper class (templated by the type of the underlying solid</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">element) in the driver code to re-implement (overload) the </span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">relevant functions:</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">\dontinclude prescribed_displ_lagr_mult_precond.cc</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">\skipline start_wrapper</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">\until {}</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">The member function \c ndof_types() returns the number of dof types </span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">associated with (and classified by) this element: twice the number of spatial </span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">dimensions (for the constrained and unconstrained nodal positions).</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">The member function \c get_dof_numbers_for_unknowns() returns a list of</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">pairs, associating each (global) unknown (stored as the </span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">first entry in the pair) with the dof type within its block</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">(stored as the second entry in the pair). We distinguish between</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">constrained and unconstrained nodes by checking if the</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">node has been resized to accommodate storage for the Lagrange</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">multipliers. [Recall that \c FiniteElement::required_nvalue(j)</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">returns the number of nodal values at local node \c j, </span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">required by the element itself (recall that for &quot;pure&quot; solid mechanics</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">elements this number is zero because the nodal coordinates</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">are stored as a separate \c Data item); \c Node::nvalue() returns</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">the number of values actually stored at a \c Node -- if this</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">exceeds the value returned by  \c FiniteElement::required_nvalue(j),</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">node \c j must have been resized when the \c FaceElement applying</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">the displacement constraint by Lagrange multipliers was attached.]</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">\until };</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">The \c ImposeDisplacementByLagrangeMultiplierElements which we use to </span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">impose the displacement constraint already label the x- and y- </span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">[and, in 3D, z-]component of the Lagrange multipliers as</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">dof types 0, 1 [and 2], as required by our preconditioner.</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">Therefore no modification is required.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">\subsection driver Modifications to the main code</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">The main code only requires minor changes, all associated with</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">the specification of different solver options. Since we provide the option to </span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">use Hypre and Trilinos solvers, we need to activate MPI</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">if \c oomph-lib has been compiled with MPI support (even </span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">if the code is run in serial):</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">\dontinclude prescribed_displ_lagr_mult_precond.cc</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">\skipline start_of_main</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">Next we define and process the possible command line flags </span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">which are used to select solver options and to specify the spatial </span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">resolution (in terms of of the number of elements in the</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">x- and y-directions. The \c --no_adapt flag suppresses the</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">spatial adaptivity to facilitate systematic mesh refinement</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">studies. </span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">\until diagonal_scaling_for_elastic_blocks</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">We then assign the command line flags that were specified</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">and document the ones that were recognised before building the</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">problem, specifying the &quot;wrapped&quot; version of the \c</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">RefineableQPVDElement as the template parameter.</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">\skipline Parse command line</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">\until RefineableQPVDElement&lt;2,3&gt;</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">The rest of the main code is identical to the original version </span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">discussed in </span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">&lt;a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">another tutorial&lt;/a&gt; and is therefore omitted here.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">\subsection constr Modifications to the problem constructor</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">The majority of the problem constructor is unchanged from the original version</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">of the code. Having created the bulk mesh (and stored a pointer</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">to it in the private member \c Solid_mesh_pt) and the mesh of Lagrange</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">multiplier elements (with a pointer stored in \c</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">Lagrange_multiplier_mesh_pt), we specify a GMRES as the linear solver</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">(using Trilinos&#39; version of it, if available):</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">\dontinclude prescribed_displ_lagr_mult_precond.cc</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">\skipline Create the linear solver</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">\until linear_solver_pt() = solver_pt;</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">Next, we create an instance of our preconditioner, specify</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">the meshes that contain the &quot;bulk&quot; solid and Lagrange multiplier</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">elements, respectively, and pass the preconditioner to the </span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">iterative linear solver.</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">\until  solver_pt-&gt;preconditioner_pt() = prec_pt;</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">By default the preconditioner performs the</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">preconditioning operations as described above, and performs </span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">the block solves in (2) exactly, using SuperLU.</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">The use of different blocked approximations to \f$ E_{\rm PS} \f$</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">is controlled via the \c elastic_preconditioner_type() function. </span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">It is possible to specify the block approximation in terms of the</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">(self-explanatory) enumeration</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">- \c PseudoElasticPreconditioner::Exact_block_preconditioner [the default]</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">- \c PseudoElasticPreconditioner::Block_diagonal_preconditioner</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">- \c PseudoElasticPreconditioner::Block_upper_triangular_preconditioner</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">- \c PseudoElasticPreconditioner::Block_lower_triangular_preconditioner</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">So, to choose an upper block-triangular approximation for</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">\f$ E_{\rm PS} \f$ we write </span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">By default the linear systems involving </span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">the diagonal blocks of \f$ E_{\rm PS} \f$ are performed by </span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">SuperLU. The function \c set_elastic_subsidiary_preconditioner(...)</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">allows the specification of another (approximate) solver (or subsidiary</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">preconditioner, in the terminology of \c oomph-lib&#39;s block preconditioning</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">framework). The argument to this function is a pointer to a </span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">global function that returns an instance of the required </span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">solver. A function that creates an instantiation of Hypre&#39;s AMG </span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">solver (with suitable settings) is already implemented in the</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">\c Pseudo_Elastic_Preconditioner_Subsidiary_Operator_Helper</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">helper namespace and can be activated as follows:</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">(&lt;a href=&quot;../../../../doc/mpi/distributed_general_purpose_block_preconditioners/html/index.html#application&quot;&gt;Recall&lt;/a&gt;</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">that subsidiary preconditioners are deleted automatically</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">by the master preconditioner when they are no longer required.)</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">A similar construction is used to specify alternative (approximate) solvers</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">for the linear systems involving the mass matrices. To perform the</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">solves with Trilinos&#39; CG solver (and diagonal scaling) we state:</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">\until #endif</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">That&#39;s it!</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">\section comm_and_ex Comments and Exercises</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">\subsection comm Comments</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">- The machinery described here may seem rather heavy for a rather</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">  obscure problem. As mentioned at the beginning of this tutorial,</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">  the main purpose of this preconditioner is to act as a building block</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">  for our preconditioner for large-displacement FSI problems in which </span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">  the ALE node update of the fluid mesh in response to the deformation</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">  of the fluid-loaded solid is handled by (pseudo-)elasticity. We</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">  refer to &lt;a href=&quot;../../pseudo_solid_fsi/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">  another tutorial&lt;/a&gt; for details.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">  \n\n</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">- Further details of the theory, such as the proof of the optimality of</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">  the preconditioner, can be found in  </span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">  &lt;a href=&quot;http://dx.doi.org/10.1016/j.jcp.2012.07.001&quot;&gt;</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">  Muddle, Mihajlovic &amp; Heil (2012).&lt;/a&gt;</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">. </span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">      </span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">\subsection ex Exercises</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">-# Experiment with alternative subsidiary preconditioners</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">   (inexact solvers) for the solution of the \f$ E_{\rm PS}\f$ block. </span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">   For instance, set the argument to</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">   \c PseudoElasticPreconditioner::elastic_preconditioner_type()</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">   to \c PseudoElasticPreconditioner::Block_diagonal_preconditioner.</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">   With this setting, the solution of the linear systems</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">   involving \f$ E_{\rm PS}\f$ is performed using the block-diagonal</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">   approximation of \f$ E_{\rm PS}\f$. This saves one matrix-vector </span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">   product with the off-diagonal blocks per iteration but   </span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">   significantly increases</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">   the GMRES iteration counts. [Don&#39;t take our word for it -- try it!]</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">-# Specify &quot;your own&quot; subsidiary preconditioner (inexact solver)</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">   by writing a global function (well, you should obviously hide</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">   it in a namespace -- remember that global data and functions are</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">   evil!) that creates an instance of that preconditioner. Pass</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">   a function pointer to this function to </span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">   \c PseudoElasticPreconditioner::set_elastic_subsidiary_preconditioner().</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">   [Hint: The driver code already contains the relevant source lines</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">   (omitted in the code listings above) to illustrate how to </span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">   solve the linear systems with a diagonal </span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">   preconditioner. This leads to a fairly catastrophic</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">   deterioration of the GMRES iteration counts -- the point of the</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">   exercise is to demonstrate how to implement such alternative</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">   (and hopefully better!) subsidiary preconditioners &quot;from scratch&quot;.]</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">   \n\n</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">-# Inspect (and experiment with) our settings for Hypre&#39;s AMG </span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">   solver -- defined in</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">   the \c Pseudo_Elastic_Preconditioner_Subsidiary_Operator_Helper</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">   namespace in \n\n</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">   &lt;center&gt;</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">   &lt;code&gt; </span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">   &lt;a href=&quot;../../../../src/multi_physics/pseudo_elastic_preconditioner.h&quot;&gt;</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">   src/multi_physics/pseudo_elastic_preconditioner.h&lt;/a&gt;       </span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">   &lt;/code&gt; </span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">   \n\n and  \n\n</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">   &lt;code&gt; </span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">   &lt;a href=&quot;../../../../src/multi_physics/pseudo_elastic_preconditioner.cc&quot;&gt;</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">   src/multi_physics/pseudo_elastic_preconditioner.cc&lt;/a&gt; </span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">   &lt;/code&gt; </span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">   &lt;/center&gt;</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">\section sources Source files for this tutorial</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">- The source files for this tutorial are located in the directory:\n\n</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/solid/prescribed_displ_lagr_mult&quot;&gt;</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">demo_drivers/solid/prescribed_displ_lagr_mult</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">&lt;/CENTER&gt;\n</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">- The driver code is: \n\n</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/solid/prescribed_displ_lagr_mult/prescribed_displ_lagr_mult_precond.cc&quot;&gt;</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">demo_drivers/solid/prescribed_displ_lagr_mult/prescribed_displ_lagr_mult_precond.cc&lt;/A&gt;</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">\section pdf PDF file</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">A &lt;a href=&quot;../latex/refman.pdf&quot;&gt;pdf version&lt;/a&gt; of this document is available.</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">**/</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_a52114c729dd56a272dc5f6b0ffd36416"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#a52114c729dd56a272dc5f6b0ffd36416">M_</a></div><div class="ttdeci">two involving the squared mass f M_</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00312">prescribed_displ_lagr_mult.txt:312</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_adc9c71264c8fd28ea9b51353f707ef7a"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#adc9c71264c8fd28ea9b51353f707ef7a">g</a></div><div class="ttdeci">mainpage Demo e g</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00008">prescribed_displ_lagr_mult.txt:8</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_aebbe7d9927a145b69b885759da7f7d03"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#aebbe7d9927a145b69b885759da7f7d03">matrices</a></div><div class="ttdeci">two involving the squared mass matrices</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00311">prescribed_displ_lagr_mult.txt:311</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_ad96c337c66344dce050f1f887be694db"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#ad96c337c66344dce050f1f887be694db">changes</a></div><div class="ttdeci">c Node::nvalue() returns the number of values actually stored at a \c Node -- if this exceeds the value returned by \c FiniteElement The c ImposeDisplacementByLagrangeMultiplierElements which we use to impose the displacement constraint already label the x and y[and, in 3D, z-] component of the Lagrange multipliers as dof as required by our preconditioner Therefore no modification is required&lt; HR &gt; subsection driver Modifications to the main code The main code only requires minor changes</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00431">prescribed_displ_lagr_mult.txt:431</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_ab8b40917eda026da4cc056cf8dfdfe69"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#ab8b40917eda026da4cc056cf8dfdfe69">the</a></div><div class="ttdeci">Hypre CG&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt;/TR &gt;&lt;/TABLE &gt;&lt;/CENTER &gt;&lt; CENTER &gt;&lt; b &gt; c n_dof for different implementations of the preconditioner&lt;/CENTER &gt;&lt; HR &gt; As the GMRES iteration counts are small and mesh independent for the exact implementation of the preconditioner Replacing the(costly) exact solves by(faster) approximate solves leads to a modest increase in the(absolute) number of GMRES iterations</div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_a4074baada03976c061d5672f4237cca5"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#a4074baada03976c061d5672f4237cca5">problem</a></div><div class="ttdeci">mainpage Demo problem</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00008">prescribed_displ_lagr_mult.txt:8</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="prescribed__displ__lagr__mult_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdoc">Driver code.</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8cc_source.html#l00484">prescribed_displ_lagr_mult.cc:484</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_ab8b6820b8cafc4421f7547b0da6563c7"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#ab8b6820b8cafc4421f7547b0da6563c7">types</a></div><div class="ttdeci">c Node::nvalue() returns the number of values actually stored at a \c Node -- if this exceeds the value returned by \c FiniteElement The c ImposeDisplacementByLagrangeMultiplierElements which we use to impose the displacement constraint already label the x and y[and, in 3D, z-] component of the Lagrange multipliers as dof types</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00419">prescribed_displ_lagr_mult.txt:419</a></div></div>
<div class="ttc" id="anamespaceoomph_html"><div class="ttname"><a href="namespaceoomph.html">oomph</a></div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult__precond_8cc_source.html#l00046">prescribed_displ_lagr_mult_precond.cc:46</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_a405e4ca90ca08ae8f712a3c537390a7c"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#a405e4ca90ca08ae8f712a3c537390a7c">href</a></div><div class="ttdeci">&quot;http: 10.1016/j.jcp.2012.07.001&lt;/a&gt; &lt;/center&gt; &lt;HR&gt; &lt;HR&gt; \section model Theory: Problem formulation, the resulting linear system and the preconditioner We refer to &lt;a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt; another tutorial&lt;/a&gt; for a detailed description of the problem setup and its discretisation. Briefly, we consider the deformation of an elastic solid body whose shape is parametrised by Lagrangian coordinates \f$ \xi^i \f$. A part of the body's boundary, \f$ \partial D_{prescr}\f$, (which is parametrised by the boundary coordinate \f$ \zeta\f$) is displaced to a new position given by \f$ {\bf R}_{prescr}(\zeta) \f$ while the other boundaries are held in a fixed position (as in the sketch below) or are subject to traction boundary conditions. @I w 0.75\textwidth sketch &quot;Sketch of the typical problem. &quot; We discretise the problem using \c SolidElements in the bulk of the domain and employ lower-dimensional \c FaceElements to impose the displacement constraint along \f$ \partial D_{prescr}\f$. The problem therefore contains the following types of discrete unknowns: - The nodal positions (which are stored as positional \c Data at each \c SolidNode). \n\n - The nodal values representing the components of the (vector-valued) Lagrange multipliers. These only exist for the nodes on \f$ \partial D_{prescr}\f$. (The nodes are re-sized to accommodate the additional unknowns when the \c FaceElements are attached to the bulk elements.) . The preconditioner requires a further sub-division of these degrees of freedom into the following categories: - the x-coordinates of the unconstrained nodes - the y-coordinates of the unconstrained nodes - [the z-coordinates of the unconstrained nodes (only in 3D)] - the x-coordinates of the constrained nodes - the y-coordinates of the constrained nodes - [the z-coordinates of the constrained nodes (only in 3D)] - the x-component of the Lagrange multiplier at the constrained nodes - the y-component of the Lagrange multiplier at the constrained nodes - [the z-component of the Lagrange multiplier at the constrained nodes (only in 3D)]. . For a 2D problem, the linear system to be solved in the course of the Newton iteration can then be (formally) re-ordered into the following block structure: \f[ \left[ \begin{array}{cccc|cc} { E_{\rm xx}}&amp;{ E_{\rm x\bar{\rm x}}}&amp;{ E_{\rm xy}}&amp;{ E_{\rm x\bar{\rm y}}}&amp;&amp;\\ { E_{\bar{\rm x}\rm x}}&amp;{ E_{\bar{\rm x}\bar{\rm x}}}&amp;{ E_{\bar{\rm x}\rm y}}&amp;{ E_{\bar{\rm x}\bar{\rm y}}}&amp;{ M_{\rm x}}&amp;\\ { E_{\rm yx}}&amp;{ E_{\rm y\bar{\rm x}}}&amp;{ E_{\rm yy}}&amp;{ E_{\rm y\bar{\rm y}}}&amp;&amp;\\ { E_{\bar{\rm y}\rm x}}&amp;{ E_{\bar{\rm y}\bar{\rm x}}}&amp;{ E_{\bar{\rm y}\rm y}}&amp;{ E_{\bar{\rm y}\bar{\rm y}}}&amp;&amp;{ M_{\rm y}}\\ \hline &amp;{ M_{\rm x}}&amp;&amp;&amp;\\ &amp;&amp;&amp;{ M_{\rm y}}&amp;&amp; \end{array} \right] \left[ \begin{array}{c} \Delta \mathbf{X}_{\rm x}\\ \Delta \mathbf{\overline{X}}_{\rm x}\\ \Delta \mathbf{X}_{\rm y}\\ \Delta \mathbf{\overline{X}}_{\rm y}\\ \Delta \mathbf{L}_{\rm x}\\ \Delta \mathbf{L}_{\rm y} \end{array} \right] = - \left[ \begin{array}{c} \mathbf{r}_{\rm x}\\ \mathbf{r}_{\bar{\rm x}}\\ \mathbf{r}_{\rm y}\\ \mathbf{r}_{\bar{\rm y}}\\ \mathbf{r}_{\rm l_x}\\ \mathbf{r}_{\rm l_y} \end{array} \right]. \ \ \ \ \ \ @E[linear_system]@ \f] Here the vectors \f${\bf X}_{\rm x}\f$, \f${\bf X}_{\rm y}\f$, \f${\bf L}_{\rm x}\f$ and \f${\bf L}_{\rm y}\f$ contain the \f$x\f$ and \f$y\f$ components of the unknown nodal positions and Lagrange multipliers, respectively. The overbars identify the unknown nodal positions that are constrained by the Lagrange multiplier. The matrices \f$M_{\rm x}\f$ and \f$M_{\rm y}\f$ are mass matrices whose entries are formed from products of the basis functions, \f$[M_{{\rm x}}]_{ij}=[M_{{\rm y}}]_{ij} = \int_{\partial D_{\rm prescr}} {\psi_i} \ {\psi_j} \ dS \f$. &lt;a href=&quot;http:Muddle, Mihajlovic &amp;Heil(2012)&lt;/a &gt; show that \f[{\cal P}_{\rm PS}=\left[\begin{array}{cccc|cc} E_{\rm xx}&amp;E_{\rm x\bar{\rm x}}&amp;E_{\rm xy}&amp;E_{\rm x\bar{\rm y}}&amp;&amp;\\ E_{\bar{\rm x}\rm x}&amp;E_{\bar{\rm x}\bar{\rm x}}+\sigma I &amp;E_{\bar{\rm x}\rm y}&amp;E_{\bar{\rm x}\bar{\rm y}}&amp;&amp;\\ E_{\rm yx}&amp;E_{\rm y\bar{\rm x}}&amp;E_{\rm yy}&amp;E_{\rm y\bar{\rm y}}&amp;&amp;\\ E_{\bar{\rm y}\rm x}&amp;E_{\bar{\rm y}\bar{\rm x}}&amp;E_{\bar{\rm y}\rm y}&amp;E_{\bar{\rm y}\bar{\rm y}}+\sigma I &amp;&amp;\\ \hline &amp;&amp;&amp;&amp;\frac{1}{\sigma}M_{\rm x}^2 &amp;\\ &amp;&amp;&amp;&amp;&amp;\frac{1}{\sigma}M_{\rm y}^2\\ \end{array} \right] \ \ \ \ \ \ @E[P_ps]@ \f] is an optimal preconditioner for the linear system( @R[linear_system]@) if we set \f$ \sigma=\|E\|_{\infty} \f$ where \f$ E \f$ is the compound 4x4 top-left block \f[E=\left[\begin{array}{cccc} E_{\rm xx}&amp;E_{\rm x\bar{\rm x}}&amp;E_{\rm xy}&amp;E_{\rm x\bar{\rm y}}\\ E_{\bar{\rm x}\rm x}&amp;E_{\bar{\rm x}\bar{\rm x}} &amp;E_{\bar{\rm x}\rm y}&amp;E_{\bar{\rm x}\bar{\rm y}} \\ E_{\rm yx}&amp;E_{\rm y\bar{\rm x}}&amp;E_{\rm yy}&amp;E_{\rm y\bar{\rm y}}\\ E_{\bar{\rm y}\rm x}&amp;E_{\bar{\rm y}\bar{\rm x}}&amp;E_{\bar{\rm y}\rm y}&amp;E_{\bar{\rm y}\bar{\rm y}} \end{array} \right] \f] in the Jacobian matrix. The application of the preconditioner(i.e. the solution of linear systems of the form \f$ {\cal P}_{\rm PS} \ {\bf x}={\bf y} \f$ for \f$ {\bf x} \f$) requires three linear solves:One involving the compound 4x4 top-left block in \f$ {\cal P}_{\rm PS} \f$, \f[E_{\rm PS}=\left[\begin{array}{cccc} E_{\rm xx}&amp;E_{\rm x\bar{\rm x}}&amp;E_{\rm xy}&amp;E_{\rm x\bar{\rm y}}\\ E_{\bar{\rm x}\rm x}&amp;E_{\bar{\rm x}\bar{\rm x}}+\sigma I &amp;E_{\bar{\rm x}\rm y}&amp;E_{\bar{\rm x}\bar{\rm y}} \\ E_{\rm yx}&amp;E_{\rm y\bar{\rm x}}&amp;E_{\rm yy}&amp;E_{\rm y\bar{\rm y}}\\ E_{\bar{\rm y}\rm x}&amp;E_{\bar{\rm y}\bar{\rm x}}&amp;E_{\bar{\rm y}\rm y}&amp;E_{\bar{\rm y}\bar{\rm y}}+\sigma I \end{array} \right] \f] and two involving the two squared mass matrices, \f$ M_{\rm x}^2 \f$ and \f$ M_{\rm y}^2 \f$. Numerical experiments in&lt; a href=&quot;http: Muddle, Mihajlovic &amp; Heil (2012) &lt;/a&gt; show that an efficient implementation of the preconditioner is obtained by replacing the \f$ E_{\rm PS} \f$ block in the preconditioner \f$ {\cal P}_{\rm PS} \f$ by its upper block-triangular approximation, corresponding to the preconditioner \f[ \widetilde{\cal P}_{\rm PS}=\left[ \begin{array}{cccc|cc} E_{xx}&amp;E_{x\bar{x}}&amp;E_{xy}&amp;E_{x\bar{y}}&amp;&amp;\\ E_{\bar{x}x}&amp;E_{\bar{x}\bar{x}}+\sigma I&amp;E_{\bar{x}y}&amp;E_{\bar{x}\bar{y}}&amp;&amp;\\ &amp;&amp;E_{yy}&amp;E_{y\bar{y}}&amp;&amp;\\ &amp;&amp;E_{\bar{y}y}&amp;E_{\bar{y}\bar{y}}+\sigma I&amp;&amp;\\ \hline &amp;&amp;&amp;&amp;\frac{1}{\sigma}M_x^2&amp;\\ &amp;&amp;&amp;&amp;&amp;\frac{1}{\sigma}M_y^2\\ \end{array} \right]. \ \ \ \ \ \ @E[P_ps_tilde]@ \f] Furthermore, a fully optimal preconditioner (in which the solve times scale linearly with the number of unknowns) can be obtained by: - approximately solving the subsidiary linear systems involving the diagonal blocks \f[ \left[ \begin{array}{cc} E_{xx}&amp;E_{x\bar{x}}\\ E_{\bar{x}x}&amp;E_{\bar{x}\bar{x}}+\sigma I\\ \end{array} \right] \mbox{\ \ \ \ and\ \ \ \ \ } \left[ \begin{array}{cc} E_{yy}&amp;E_{y\bar{y}}\\ E_{\bar{y}y}&amp;E_{\bar{y}\bar{y}}+\sigma I\\ \end{array} \right] \f] in (@R[P_ps_tilde]@) by performing a fixed number of algebraic multigrid (AMG) cycles, . and by - approximately solving the subsidiary linear systems involving \f$ M_{\rm x}^2 \f$ and \f$ M_{\rm y}^2 \f$ by two consecutive linear solves involving the mass matrices themselves. Following Wathen [A. Wathen, &quot;Realistic eigenvalue bounds for the Galerkin mass matrix&quot;, IMA Journal of Numerical Analysis 7 (1987) 449-457], &lt;a href=&quot;http:Muddle, Mihajlovic &amp;Heil(2012)&lt;/a &gt; suggest employing CG, preconditioned by diagonal scaling, as the solver for these systems. This solver converges so rapidly that a fixed number of four CG iterations suffices to compute the solution to sufficient accuracy so that \f$ \widetilde{\cal P}_{\rm PS} \f$ can be treated as a constant preconditioner. . With these approximations, the computational cost of one application of \f$ \widetilde{\cal P}_{\rm PS} \f$ is linear in the number of unknowns. The optimality of the preconditioner can therefore be assessed by demonstrating that the number of GMRES iterations remains constant under mesh refinement.&lt; HR &gt;&lt; HR &gt; \section implementation Implementation and use of the preconditioner The preconditioner described above is implemented within \c oomph-lib 's(parallel) block preconditioning framework which is described in&lt; a href=&quot;../../../mpi/block_preconditioners/html/index.html&quot;&gt; another tutorial&lt;/a &gt;. For the purpose of the implementation, we decompose the preconditioning matrix into the 2x2 main blocks indicated by the vertical and horizontal lines in( @R[P_ps]@) and( @R[P_ps_tilde]@). The application of the preconditioner requires the classification of the unknowns into the six(in 2D) different &quot;dof types&quot; discussed above. This is done on an element-by-element basis(since only the elements &quot;know&quot; what their nodal degrees of freedom correspond to) by implementing/overloading the functions - \c GeneralisedElement::ndof_types(...) which returns the number of dof types classified by that element. - \c GeneralisedElement::get_block_numbers_for_unknowns(...) which associates each degree of freedom(identified by its global equation number) with the dof type within its block. \n\n . For a 2D problem the enumeration of the dofs is chosen as follows. The \c SolidElements classify only the nodal positions and sub-divide them into those that are constrained and not constrained by the displacement boundary condition so that within that block - dof type 0 corresponds to the unconstrained x-nodal coordinates, - dof type 1 corresponds to the unconstrained y-nodal coordinates, - dof type 2 corresponds to the constrained x-nodal coordinates, - dof type 3 corresponds to the constrained y-nodal coordinates. . The \c FaceElements that apply the displacement constraint classify the Lagrange multipliers so that within that block - dof type 0 corresponds to the x-component of the Lagrange multiplier, - dof type 1 corresponds to the y-component of the Lagrange multiplier,. with the obvious generalisation to 3D.&lt; HR &gt;&lt; HR &gt; \section results Results We examine the performance of the preconditioner in the test problem discussed in&lt; a href=&quot;../../../solid/prescribed_displ_lagr_mult/html/index.html&quot;&gt;another tutorial&lt;/a &gt;:The upper surface of a unit square is subjected to a prescribed displacement that is imposed by Lagrange multipliers. The first of the two tables below shows the GMRES iteration counts(averaged over all linear solves performed in the course of all Newton iterations) as a function of the mesh refinement(represented by the total number of unknowns) for different implementations of the preconditioner. -&lt; b &gt;&quot;SuperLU&quot;&lt;/b &gt; corresponds to the exact implementation of the preconditioner \f$ E_{\rm PS} \f$ in which the linear systems involving the matrix \f$ E_{\rm PS} \f$ and the two squared mass matrices, \f$ M_{\rm x}^2 \f$ and \f$ M_{\rm y}^2 \f$, are solved by SuperLU. -&lt; b &gt;&quot;Upper triangular E&quot;&lt;/b &gt; corresponds to the case in which \f$ E_{\rm PS} \f$ is replaced by its upper block-triangular approximation(corresponding to \f$ \tilde{\cal P}_{\rm PS} \f$) but the four linear solves(two involving the diagonal blocks of \f$ E_{\rm PS} \f$ href</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00311">prescribed_displ_lagr_mult.txt:311</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_a8c3099b6591d9f1ca3c845994f62b2a2"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#a8c3099b6591d9f1ca3c845994f62b2a2">solvers</a></div><div class="ttdeci">c Node::nvalue() returns the number of values actually stored at a \c Node -- if this exceeds the value returned by \c FiniteElement The c ImposeDisplacementByLagrangeMultiplierElements which we use to impose the displacement constraint already label the x and y[and, in 3D, z-] component of the Lagrange multipliers as dof as required by our preconditioner Therefore no modification is required&lt; HR &gt; subsection driver Modifications to the main code The main code only requires minor all associated with the specification of different solver options Since we provide the option to use Hypre and Trilinos solvers</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00440">prescribed_displ_lagr_mult.txt:440</a></div></div>
<div class="ttc" id="aprescribed__displ__lagr__mult_8txt_html_a1fd791a35e5f41934843ddbee6ff65e2"><div class="ttname"><a href="prescribed__displ__lagr__mult_8txt.html#a1fd791a35e5f41934843ddbee6ff65e2">E</a></div><div class="ttdeci">Hypre CG&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt;/TR &gt;&lt;/TABLE &gt;&lt;/CENTER &gt;&lt; CENTER &gt;&lt; b &gt; c n_dof for different implementations of the preconditioner&lt;/CENTER &gt;&lt; HR &gt; As the GMRES iteration counts are small and mesh independent for the exact implementation of the preconditioner Replacing while retaining virtual their mesh independence under sufficiently strong mesh refinement The benefit of switching to the approximate solves becomes apparent in the next table which shows the average cpu times required for the solution of the linear systems by GMRES For sufficiently fine discretisations the larger number of GMRES iterations for the inexact solves is more than compensated for by the much lower cost of the preconditioning operations The final implementation yields cpu times that are proportional to the number of unknowns the hallmark of an optimal solver&lt; HR &gt;&lt; CENTER &gt;&lt; TABLE &gt;&lt; TR &gt;&lt; TD &gt;&lt; CODE &gt; n_dof&lt;/CODE &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt;/TR &gt;&lt; TR &gt;&lt; TD &gt; SuperLU&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt;/TR &gt;&lt; TR &gt;&lt; TD &gt; Upper triangular E&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt; TD &gt;&lt;/TD &gt;&lt;/TR &gt;&lt; TR &gt;&lt; TD &gt; Upper triangular E</div><div class="ttdef"><b>Definition:</b> <a href="prescribed__displ__lagr__mult_8txt_source.html#l00356">prescribed_displ_lagr_mult.txt:356</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Wed Aug 18 2021 18:07:35
        </div>
      </div>
    </footer>
</body>
</html>
