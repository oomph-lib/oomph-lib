<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: Bending of a cantilever beam</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Demo problem: Bending of a cantilever beam </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this example we solve a classical solid mechanics problem, the bending of a cantilever beam, subject to a pressure loading on its upper face and/or gravity. We assume that the material behaves like a generalised Hookean solid with elastic modulus <img class="formulaInl" alt="$ E^* $" src="form_0.png" width="15" height="10"/> and Poisson's ratio <img class="formulaInl" alt="$ \nu $" src="form_1.png" width="6" height="6"/> Here is a sketch:</p>
<div class="image">
<img src="airy_cantilever_sketch.gif" alt=""/>
<div class="caption">
Sketch of the problem. </div></div>
 <p>This problem is interesting because it has an (approximate) St. Venant solution for the stress field which may be constructed in terms of an Airy stress function (see, e.g. H. Eschenauer &amp; W. Schnell "Elastizitaetstheorie I", BI Wissenschaftsverlag, 2nd edition, 1986).</p>
<hr  />
<p> <br  />
 </p><hr  />
<h1><a class="anchor" id="results"></a>
Results</h1>
<p>The following figure shows an animation of beam's deformation in response to an increase in the uniform pressure, <img class="formulaInl" alt="$ P $" src="form_2.png" width="10" height="10"/>, at zero gravity, <img class="formulaInl" alt="$ g=0 $" src="form_3.png" width="30" height="11"/>. The colour contours represent the magnitude of the "horizontal" component of the 2nd Piola-Kirchhoff stress tensor, <img class="formulaInl" alt="$ \sigma_{11} $" src="form_4.png" width="16" height="9"/> . Its approximately linear variation across the beam's thickness indicates a bending-type stress distribution with the stress being positive (tensile) at the top and negative (compressive) at the bottom.</p>
<div class="image">
<img src="beam_animation.gif" alt=""/>
<div class="caption">
Animation of the beam's deformation with contours of its `horizontal' stress component. </div></div>
 <p>The next figure shows a comparison of the computational predictions for <img class="formulaInl" alt="$ \sigma_{11} $" src="form_4.png" width="16" height="9"/> (in green), and the approximate analytical solution (in red).</p>
<div class="image">
<img src="stress_comparison.gif" alt=""/>
<div class="caption">
Comparison of the computed distribution of the `horizontal' stress (in green) against the approximate analytical solution (in red). </div></div>
 <p>The agreement between the two solutions is excellent over most of the domain, apart from two small regions near the left end of the beam where stress singularities develop at the vertices of the domain. The singularities arise because the zero-tangential stress boundary condition on the top and bottom faces is inconsistent with the zero-displacement boundary condition on the left face. The singularities are not captured by the approximate analytical solution. <code>oomph-lib's</code> automatic mesh adaptation refines the mesh in an attempt to capture the rapid variations of the stresses in these regions.</p>
<hr  />
<p> <br  />
 </p><hr  />
<h1><a class="anchor" id="global"></a>
Global parameters and functions</h1>
<p>As usual, we define a namespace, <code><a class="el" href="namespaceGlobal__Physical__Variables.html" title="//////////////////////////////////////////////////////////////////// ////////////////////////////////...">Global_Physical_Variables</a></code>, to define the problem parameters: the dimensions of the cantilever beam, (a pointer to) a constitutive equation, and its parameters <img class="formulaInl" alt="$ E $" src="form_5.png" width="10" height="9"/> and <img class="formulaInl" alt="$ \nu $" src="form_1.png" width="6" height="6"/>.</p>
 <div class="fragment"><div class="line"><span class="comment">//=======start_namespace==========================================</span></div>
<div class="line"><span class="comment">/// Global variables</span></div>
<div class="line"><span class="comment"></span><span class="comment">//================================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Half height of beam</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">H</a>=0.5;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Length of beam</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a1b8bfc451f6b7ac89eca18f04338f47f">L</a>=10.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to constitutive law</span></div>
<div class="line"><span class="comment"></span> ConstitutiveLaw* <a class="code" href="namespaceGlobal__Physical__Variables.html#a5d5f19442938130d36ee7476ae25049c">Constitutive_law_pt</a>;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Elastic modulus</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a09a019474b7405b35da2437f7779bc7e">E</a>=1.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Poisson&#39;s ratio</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a3962c36313826b19f216f6bbbdd6a477">Nu</a>=0.3;</div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html">Global_Physical_Variables</a></div><div class="ttdoc">//////////////////////////////////////////////////////////////////// ////////////////////////////////...</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00148">airy_cantilever.cc:149</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a09a019474b7405b35da2437f7779bc7e"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a09a019474b7405b35da2437f7779bc7e">Global_Physical_Variables::E</a></div><div class="ttdeci">double E</div><div class="ttdoc">Elastic modulus.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00161">airy_cantilever.cc:161</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a1b8bfc451f6b7ac89eca18f04338f47f"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a1b8bfc451f6b7ac89eca18f04338f47f">Global_Physical_Variables::L</a></div><div class="ttdeci">double L</div><div class="ttdoc">Length of beam.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00155">airy_cantilever.cc:155</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a3962c36313826b19f216f6bbbdd6a477"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a3962c36313826b19f216f6bbbdd6a477">Global_Physical_Variables::Nu</a></div><div class="ttdeci">double Nu</div><div class="ttdoc">Poisson's ratio.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00164">airy_cantilever.cc:164</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a5d5f19442938130d36ee7476ae25049c"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a5d5f19442938130d36ee7476ae25049c">Global_Physical_Variables::Constitutive_law_pt</a></div><div class="ttdeci">ConstitutiveLaw * Constitutive_law_pt</div><div class="ttdoc">Pointer to constitutive law.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00158">airy_cantilever.cc:158</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_af6e07423e22c0991084d9a2f43727805"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a></div><div class="ttdeci">double H</div><div class="ttdoc">Half height of beam.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00152">airy_cantilever.cc:152</a></div></div>
</div><!-- fragment --><p>We refer to the document <a href="../../solid_theory/html/index.html">"Solid mechanics: Theory and implementation"</a> for a detailed discussion of the non-dimensionalisation and merely recall that by setting <img class="formulaInl" alt="$ E = 1$" src="form_6.png" width="33" height="9"/>, we imply that all stresses are non-dimensionalised with the structure's dimensional Young's modulus <img class="formulaInl" alt="$ E^* $" src="form_0.png" width="15" height="10"/>. Similarly, by setting the half-thickness of the beam to 0.5, we imply that the beam's dimensional thickness, <img class="formulaInl" alt="$ 2H^*$" src="form_7.png" width="23" height="10"/> is used to non-dimensionalise all lengths.</p>
<p>Next, we define a function that defines the constant pressure load on the upper face of the cantilever,</p>
<div class="fragment"><div class="line"> <span class="comment">/// Uniform pressure</span></div>
<div class="line"> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">P</a> = 0.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constant pressure load. The arguments to this function are imposed</span></div>
<div class="line"><span class="comment"> /// on us by the SolidTractionElements which allow the traction to </span></div>
<div class="line"><span class="comment"> /// depend on the Lagrangian and Eulerian coordinates x and xi, and on the </span></div>
<div class="line"><span class="comment"> /// outer unit normal to the surface. Here we only need the outer unit</span></div>
<div class="line"><span class="comment"> /// normal.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a19f4e20a92e7d216b4d2b00308f96917">constant_pressure</a>(<span class="keyword">const</span> Vector&lt;double&gt; &amp;xi, <span class="keyword">const</span> Vector&lt;double&gt; &amp;x,</div>
<div class="line">                        <span class="keyword">const</span> Vector&lt;double&gt; &amp;n, Vector&lt;double&gt; &amp;traction)</div>
<div class="line"> {</div>
<div class="line">  <span class="keywordtype">unsigned</span> dim = traction.size();</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;dim;i++)</div>
<div class="line">   {</div>
<div class="line">    traction[i] = -<a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">P</a>*n[i];</div>
<div class="line">   }</div>
<div class="line"> } <span class="comment">// end traction</span></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a19f4e20a92e7d216b4d2b00308f96917"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a19f4e20a92e7d216b4d2b00308f96917">Global_Physical_Variables::constant_pressure</a></div><div class="ttdeci">void constant_pressure(const Vector&lt; double &gt; &amp;xi, const Vector&lt; double &gt; &amp;x, const Vector&lt; double &gt; &amp;n, Vector&lt; double &gt; &amp;traction)</div><div class="ttdoc">Constant pressure load. The arguments to this function are imposed on us by the SolidTractionElements...</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00174">airy_cantilever.cc:174</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a23c2ade6398f54040b869f7f3a2bcc4b"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">Global_Physical_Variables::P</a></div><div class="ttdeci">double P</div><div class="ttdoc">Uniform pressure.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00167">airy_cantilever.cc:167</a></div></div>
</div><!-- fragment --><p> and a gravitational body force, acting in the negative <img class="formulaInl" alt="$ x_2 $" src="form_8.png" width="13" height="9"/> -direction,</p>
<div class="fragment"><div class="line"> <span class="comment">/// Non-dim gravity</span></div>
<div class="line"> <span class="keywordtype">double</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a8b80d3e8d63b8d0a0ed435a2dd7fe2ad">Gravity</a>=0.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Non-dimensional gravity as body force</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceGlobal__Physical__Variables.html#a0777aef63372db7f91ad894c38159681">gravity</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; time, </div>
<div class="line">              <span class="keyword">const</span> Vector&lt;double&gt; &amp;xi, </div>
<div class="line">              Vector&lt;double&gt; &amp;b)</div>
<div class="line"> {</div>
<div class="line">  b[0]=0.0;</div>
<div class="line">  b[1]=-<a class="code" href="namespaceGlobal__Physical__Variables.html#a8b80d3e8d63b8d0a0ed435a2dd7fe2ad">Gravity</a>;</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end namespace</span></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a0777aef63372db7f91ad894c38159681"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a0777aef63372db7f91ad894c38159681">Global_Physical_Variables::gravity</a></div><div class="ttdeci">void gravity(const double &amp;time, const Vector&lt; double &gt; &amp;xi, Vector&lt; double &gt; &amp;b)</div><div class="ttdoc">Non-dimensional gravity as body force.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00189">airy_cantilever.cc:189</a></div></div>
<div class="ttc" id="anamespaceGlobal__Physical__Variables_html_a8b80d3e8d63b8d0a0ed435a2dd7fe2ad"><div class="ttname"><a href="namespaceGlobal__Physical__Variables.html#a8b80d3e8d63b8d0a0ed435a2dd7fe2ad">Global_Physical_Variables::Gravity</a></div><div class="ttdeci">double Gravity</div><div class="ttdoc">Non-dim gravity.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00186">airy_cantilever.cc:186</a></div></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="main"></a>
The driver code</h1>
<p>The driver code is very short. We start by building a <code>GeneralisedHookean</code> constitutive equation object and store a pointer to it in the namespace <code><a class="el" href="namespaceGlobal__Physical__Variables.html" title="//////////////////////////////////////////////////////////////////// ////////////////////////////////...">Global_Physical_Variables</a></code>. Next we construct the problem object, using (a wrapped version of) <code>oomph-lib's</code> <code>RefineableQPVDElement&lt;2,3&gt;</code> &ndash; a nine-node quadrilateral displacement-based solid mechanics element. (The wrapper is used to change the element's output function; see <a class="el" href="index.html#com">Comment: Customising an element's output function</a> for details).</p>
 <div class="fragment"><div class="line"><span class="comment">//=======start_of_main==================================================</span></div>
<div class="line"><span class="comment">/// Driver for cantilever beam loaded by surface traction and/or</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// gravity</span></div>
<div class="line"><span class="comment"></span><span class="comment">//======================================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="airy__cantilever_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create generalised Hookean constitutive equations</span></div>
<div class="line"> <a class="code" href="namespaceGlobal__Physical__Variables.html#a5d5f19442938130d36ee7476ae25049c">Global_Physical_Variables::Constitutive_law_pt</a> = </div>
<div class="line">  <span class="keyword">new</span> GeneralisedHookean(&amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#a3962c36313826b19f216f6bbbdd6a477">Global_Physical_Variables::Nu</a>,</div>
<div class="line">                         &amp;<a class="code" href="namespaceGlobal__Physical__Variables.html#a09a019474b7405b35da2437f7779bc7e">Global_Physical_Variables::E</a>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Set up the problem</span></div>
<div class="line"> <a class="code" href="classCantileverProblem.html">CantileverProblem&lt;MySolidElement&lt;RefineableQPVDElement&lt;2,3&gt;</a> &gt; &gt; problem;</div>
<div class="ttc" id="aairy__cantilever_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="airy__cantilever_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdoc">Driver for cantilever beam loaded by surface traction and/or gravity.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00600">airy_cantilever.cc:600</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html"><div class="ttname"><a href="classCantileverProblem.html">CantileverProblem</a></div><div class="ttdoc">Problem class for the cantilever &quot;beam&quot; structure.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00205">airy_cantilever.cc:206</a></div></div>
</div><!-- fragment --><p> The subsequent lines may be uncommented to experiment with different element types as suggested in the <a class="el" href="index.html#ex">Exercises</a>.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Uncomment these as an exercise</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// CantileverProblem&lt;MySolidElement&lt;</span></div>
<div class="line"> <span class="comment">//  RefineableQPVDElementWithContinuousPressure&lt;2&gt; &gt; &gt; problem;</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// CantileverProblem&lt;MySolidElement&lt;</span></div>
<div class="line"> <span class="comment">//  RefineableQPVDElementWithPressure&lt;2&gt; &gt; &gt; problem;</span></div>
</div><!-- fragment --><p> We initialise the load parameters and perform a parameter study in which we increment the pressure load in small steps. The gravitational body force remains switched off to allow the comparison with the analytical solution which only applies to the case with zero body force.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Initial values for parameter values</span></div>
<div class="line"> <a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">Global_Physical_Variables::P</a>=0.0; </div>
<div class="line"> <a class="code" href="namespaceGlobal__Physical__Variables.html#a8b80d3e8d63b8d0a0ed435a2dd7fe2ad">Global_Physical_Variables::Gravity</a>=0.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Max. number of adaptations per solve</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> max_adapt=3;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Parameter incrementation</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nstep=5; </div>
<div class="line"> <span class="keywordtype">double</span> p_increment=1.0e-5;   </div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;nstep;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Increment pressure load</span></div>
<div class="line">   <a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">Global_Physical_Variables::P</a>+=p_increment;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Solve the problem with Newton&#39;s method, allowing</span></div>
<div class="line">   <span class="comment">// up to max_adapt mesh adaptations after every solve.</span></div>
<div class="line">   problem.newton_solve(max_adapt);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Doc solution</span></div>
<div class="line">   problem.<a class="code" href="classCantileverProblem.html#a7571348f8724e71be4e67dc64cea3877">doc_solution</a>();</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end of main</span></div>
<div class="ttc" id="aclassCantileverProblem_html_a7571348f8724e71be4e67dc64cea3877"><div class="ttname"><a href="classCantileverProblem.html#a7571348f8724e71be4e67dc64cea3877">CantileverProblem::doc_solution</a></div><div class="ttdeci">void doc_solution()</div><div class="ttdoc">Doc the solution.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00495">airy_cantilever.cc:495</a></div></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="class"></a>
The problem class</h1>
<p>The problem class contains the usual member functions, including separate access functions to the two sub-meshes: The "bulk" mesh that contains the 2D solid elements, and a separate mesh in which we store the 1D <code>SolidTractionElements</code> that apply the traction boundary condition on the beam's upper face. As usual, we remove these elements before adapting the bulk mesh and re-attach them afterwards, using the functions <code>Problem::actions_before_adapt()</code> and <code>Problem::actions_after_adapt()</code>.</p>
 <div class="fragment"><div class="line"><span class="comment">//=============begin_problem============================================ </span></div>
<div class="line"><span class="comment">/// Problem class for the cantilever &quot;beam&quot; structure.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//====================================================================== </span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keyword">class </span><a class="code" href="classCantileverProblem.html">CantileverProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor:</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classCantileverProblem.html#abba97fc4b8402bc0363fdf16322f6572">CantileverProblem</a>();</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Update function (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#a4a70a4328d287aaa15c7811562122013">actions_after_newton_solve</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update function (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#a293902b825898ce043ffce3f0691f5a5">actions_before_newton_solve</a>() {}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function for the solid mesh</span></div>
<div class="line"><span class="comment"></span> ElasticRefineableRectangularQuadMesh&lt;ELEMENT&gt;*&amp; <a class="code" href="classCantileverProblem.html#a26843782873897ee5e45647d17204b86">solid_mesh_pt</a>() </div>
<div class="line">  {<span class="keywordflow">return</span> <a class="code" href="classCantileverProblem.html#a263ff19e4aa0fa4391582242763f08f1">Solid_mesh_pt</a>;} </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Access function to the mesh of surface traction elements</span></div>
<div class="line"><span class="comment"></span> SolidMesh*&amp; <a class="code" href="classCantileverProblem.html#af9e9b4a4686ac29bc7e4ef5d6baeae5a">traction_mesh_pt</a>(){<span class="keywordflow">return</span> <a class="code" href="classCantileverProblem.html#a52485434aab5d653010c48a0b0f89088">Traction_mesh_pt</a>;} </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Actions before adapt: Wipe the mesh of traction elements</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#a50f8964219c507562945655e0ed5fc23">actions_before_adapt</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Actions after adapt: Rebuild the mesh of traction elements</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#af4d135ace3eac657b38de362e1644c75">actions_after_adapt</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc the solution</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#a7571348f8724e71be4e67dc64cea3877">doc_solution</a>();</div>
<div class="ttc" id="aclassCantileverProblem_html_a263ff19e4aa0fa4391582242763f08f1"><div class="ttname"><a href="classCantileverProblem.html#a263ff19e4aa0fa4391582242763f08f1">CantileverProblem::Solid_mesh_pt</a></div><div class="ttdeci">ElasticRefineableRectangularQuadMesh&lt; ELEMENT &gt; * Solid_mesh_pt</div><div class="ttdoc">Pointer to solid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00254">airy_cantilever.cc:254</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html_a26843782873897ee5e45647d17204b86"><div class="ttname"><a href="classCantileverProblem.html#a26843782873897ee5e45647d17204b86">CantileverProblem::solid_mesh_pt</a></div><div class="ttdeci">ElasticRefineableRectangularQuadMesh&lt; ELEMENT &gt; *&amp; solid_mesh_pt()</div><div class="ttdoc">Access function for the solid mesh.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00220">airy_cantilever.cc:220</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html_a293902b825898ce043ffce3f0691f5a5"><div class="ttname"><a href="classCantileverProblem.html#a293902b825898ce043ffce3f0691f5a5">CantileverProblem::actions_before_newton_solve</a></div><div class="ttdeci">void actions_before_newton_solve()</div><div class="ttdoc">Update function (empty)</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00217">airy_cantilever.cc:217</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html_a4a70a4328d287aaa15c7811562122013"><div class="ttname"><a href="classCantileverProblem.html#a4a70a4328d287aaa15c7811562122013">CantileverProblem::actions_after_newton_solve</a></div><div class="ttdeci">void actions_after_newton_solve()</div><div class="ttdoc">Update function (empty)</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00214">airy_cantilever.cc:214</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html_a50f8964219c507562945655e0ed5fc23"><div class="ttname"><a href="classCantileverProblem.html#a50f8964219c507562945655e0ed5fc23">CantileverProblem::actions_before_adapt</a></div><div class="ttdeci">void actions_before_adapt()</div><div class="ttdoc">Actions before adapt: Wipe the mesh of traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00372">airy_cantilever.cc:372</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html_a52485434aab5d653010c48a0b0f89088"><div class="ttname"><a href="classCantileverProblem.html#a52485434aab5d653010c48a0b0f89088">CantileverProblem::Traction_mesh_pt</a></div><div class="ttdeci">SolidMesh * Traction_mesh_pt</div><div class="ttdoc">Pointer to mesh of traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00257">airy_cantilever.cc:257</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html_abba97fc4b8402bc0363fdf16322f6572"><div class="ttname"><a href="classCantileverProblem.html#abba97fc4b8402bc0363fdf16322f6572">CantileverProblem::CantileverProblem</a></div><div class="ttdeci">CantileverProblem()</div><div class="ttdoc">Constructor:</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00269">airy_cantilever.cc:269</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html_af4d135ace3eac657b38de362e1644c75"><div class="ttname"><a href="classCantileverProblem.html#af4d135ace3eac657b38de362e1644c75">CantileverProblem::actions_after_adapt</a></div><div class="ttdeci">void actions_after_adapt()</div><div class="ttdoc">Actions after adapt: Rebuild the mesh of traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00388">airy_cantilever.cc:388</a></div></div>
<div class="ttc" id="aclassCantileverProblem_html_af9e9b4a4686ac29bc7e4ef5d6baeae5a"><div class="ttname"><a href="classCantileverProblem.html#af9e9b4a4686ac29bc7e4ef5d6baeae5a">CantileverProblem::traction_mesh_pt</a></div><div class="ttdeci">SolidMesh *&amp; traction_mesh_pt()</div><div class="ttdoc">Access function to the mesh of surface traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00224">airy_cantilever.cc:224</a></div></div>
</div><!-- fragment --><p> The creation/deletion of the <code>SolidTractionElements</code> is performed by private helper functions. We also store a pointer to a node on the tip of the beam and will record its displacement as a function of the applied load in a trace file.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pass pointer to traction function to the</span></div>
<div class="line"><span class="comment"> /// elements in the traction mesh</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> set_traction_pt();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Create traction elements</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> create_traction_elements();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Delete traction elements</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> delete_traction_elements();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Trace file</span></div>
<div class="line"><span class="comment"></span> ofstream Trace_file;</div>
<div class="line"> <span class="comment"></span></div>
<div class="line"><span class="comment"> /// Pointers to node whose position we&#39;re tracing</span></div>
<div class="line"><span class="comment"></span> Node* Trace_node_pt;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to solid mesh</span></div>
<div class="line"><span class="comment"></span> ElasticRefineableRectangularQuadMesh&lt;ELEMENT&gt;* Solid_mesh_pt;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to mesh of traction elements</span></div>
<div class="line"><span class="comment"></span> SolidMesh* Traction_mesh_pt;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// DocInfo object for output</span></div>
<div class="line"><span class="comment"></span> DocInfo Doc_info;</div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="constructor"></a>
The problem constructor</h1>
<p>The constructor builds the bulk mesh (the standard <code>RefineableRectangularQuadMesh</code> that we already used in many previous examples, upgraded to a <code>SolidMesh</code>, via the procedure discussed in the document <a href="../../solid_theory/html/index.html#solid_mesh">Solid mechanics: Theory and implementation</a>), using the element type specified by the template parameter and the dimensions specified in the namespace <code><a class="el" href="namespaceGlobal__Physical__Variables.html" title="//////////////////////////////////////////////////////////////////// ////////////////////////////////...">Global_Physical_Variables</a></code>.</p>
 <div class="fragment"><div class="line"><span class="comment">//===========start_of_constructor======================================= </span></div>
<div class="line"><span class="comment">/// Constructor: </span></div>
<div class="line"><span class="comment"></span><span class="comment">//====================================================================== </span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a class="code" href="classCantileverProblem.html#abba97fc4b8402bc0363fdf16322f6572">CantileverProblem&lt;ELEMENT&gt;::CantileverProblem</a>() </div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create the mesh</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// # of elements in x-direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_x=20;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// # of elements in y-direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_y=2;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Domain length in x-direction</span></div>
<div class="line"> <span class="keywordtype">double</span> l_x= <a class="code" href="namespaceGlobal__Physical__Variables.html#a1b8bfc451f6b7ac89eca18f04338f47f">Global_Physical_Variables::L</a>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Domain length in y-direction</span></div>
<div class="line"> <span class="keywordtype">double</span> l_y=2.0*<a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Shift mesh downwards so that centreline is at y=0:</span></div>
<div class="line"> Vector&lt;double&gt; origin(2);</div>
<div class="line"> origin[0]=0.0;</div>
<div class="line"> origin[1]=-0.5*l_y;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Now create the mesh </span></div>
<div class="line"> solid_mesh_pt() = <span class="keyword">new</span> ElasticRefineableRectangularQuadMesh&lt;ELEMENT&gt;(</div>
<div class="line">  n_x,n_y,l_x,l_y,origin);</div>
</div><!-- fragment --><p> We employ the <code>Z2ErrorEstimator</code> to assess the accuracy of the computed solution and to control the adaptive mesh refinement. When used with the <code>RefineableQPVDElements</code>, the <code>Z2ErrorEstimator</code> uses the components of Green's strain tensor as "fluxes" in its "flux recovery procedure".</p>
<div class="fragment"><div class="line"> <span class="comment">// Set error estimator</span></div>
<div class="line"> solid_mesh_pt()-&gt;spatial_error_estimator_pt()=<span class="keyword">new</span> Z2ErrorEstimator;</div>
</div><!-- fragment --><p> Next, we pass the constitutive equations and the gravitational body force to the elements, select a control node, and perform one uniform mesh refinement.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">//Assign the physical properties to the elements before any refinement</span></div>
<div class="line"> <span class="comment">//Loop over the elements in the main mesh</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element =solid_mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_element;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">//Cast to a solid element</span></div>
<div class="line">   ELEMENT *el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(solid_mesh_pt()-&gt;element_pt(i));</div>
<div class="line">   </div>
<div class="line">   <span class="comment">// Set the constitutive law</span></div>
<div class="line">   el_pt-&gt;constitutive_law_pt() =</div>
<div class="line">    <a class="code" href="namespaceGlobal__Physical__Variables.html#a5d5f19442938130d36ee7476ae25049c">Global_Physical_Variables::Constitutive_law_pt</a>;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Set the body force</span></div>
<div class="line">   el_pt-&gt;body_force_fct_pt() = <a class="code" href="namespaceGlobal__Physical__Variables.html#a0777aef63372db7f91ad894c38159681">Global_Physical_Variables::gravity</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Choose a control node: The last node in the solid mesh</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nnod=solid_mesh_pt()-&gt;nnode();</div>
<div class="line"> Trace_node_pt=solid_mesh_pt()-&gt;node_pt(nnod-1);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Refine the mesh uniformly</span></div>
<div class="line"> solid_mesh_pt()-&gt;refine_uniformly();</div>
</div><!-- fragment --><p> We create a new mesh for the <code>SolidTractionElements</code> and build the elements using the helper function <code>create_traction_elements()</code> before adding both submeshes to the problem and combining them into a global mesh.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Construct the traction element mesh</span></div>
<div class="line"> Traction_mesh_pt=<span class="keyword">new</span> SolidMesh;</div>
<div class="line"> create_traction_elements();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pass pointer to traction function to the elements</span></div>
<div class="line"> <span class="comment">// in the traction mesh</span></div>
<div class="line"> set_traction_pt();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Solid mesh is first sub-mesh</span></div>
<div class="line"> add_sub_mesh(solid_mesh_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Add traction sub-mesh</span></div>
<div class="line"> add_sub_mesh(traction_mesh_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build combined &quot;global&quot; mesh</span></div>
<div class="line"> build_global_mesh();</div>
</div><!-- fragment --><p> We pin the position of all nodes on the left boundary (boundary 3) of the bulk mesh. The subsequent call to <code>PVDEquationsBase&lt;2&gt;::pin_redundant_nodal_solid_pressures()</code> is unnecessary (but harmless) for the solid elements used in this driver code since <code>RefineableQPVDElements</code> do not contain pressure degrees of freedom. It is a good idea to include this call anyway since our problem class is templated by the element type and may therefore also be used with other elements (see <a class="el" href="index.html#ex">Exercises</a> ; we refer to <a href="../../../navier_stokes/adaptive_driven_cavity/html/index.html">another tutorial</a> for a detailed discussion of the need to pin "redundant" pressure degrees of freedom in computations with spatial adaptivity.)</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">// Pin the left boundary (boundary 3) in both directions</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_side = mesh_pt()-&gt;nboundary_node(3);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over the nodes</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_side;i++)</div>
<div class="line">  {</div>
<div class="line">   solid_mesh_pt()-&gt;boundary_node_pt(3,i)-&gt;pin_position(0);</div>
<div class="line">   solid_mesh_pt()-&gt;boundary_node_pt(3,i)-&gt;pin_position(1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin the redundant solid pressures (if any)</span></div>
<div class="line"> PVDEquationsBase&lt;2&gt;::pin_redundant_nodal_solid_pressures(</div>
<div class="line">  solid_mesh_pt()-&gt;element_pt());</div>
</div><!-- fragment --><p> Finally, we assign the equation numbers, create a <code>DocInfo</code> object and open a trace file in which we shall record the beam's load/displacement characteristics.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> <span class="comment">//Attach the boundary conditions to the mesh</span></div>
<div class="line"> cout &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set output directory</span></div>
<div class="line"> Doc_info.set_directory(<span class="stringliteral">&quot;RESLT&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Open trace file</span></div>
<div class="line"> <span class="keywordtype">char</span> filename[100];   </div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/trace.dat&quot;</span>,Doc_info.directory().c_str());</div>
<div class="line"> Trace_file.open(filename);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end of constructor</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="before_adapt"></a>
Actions before adaptation</h1>
<p>Following our usual procedure, we delete the <code>SolidTractionElements</code> before adapting the bulk mesh:</p>
 <div class="fragment"><div class="line"><span class="comment">//=====================start_of_actions_before_adapt======================</span></div>
<div class="line"><span class="comment">/// Actions before adapt: Wipe the mesh of traction elements</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#a50f8964219c507562945655e0ed5fc23">CantileverProblem&lt;ELEMENT&gt;::actions_before_adapt</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Kill the traction elements and wipe surface mesh</span></div>
<div class="line"> delete_traction_elements();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Rebuild the Problem&#39;s global mesh from its various sub-meshes</span></div>
<div class="line"> rebuild_global_mesh();</div>
<div class="line"> </div>
<div class="line">}<span class="comment">// end of actions_before_adapt</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="after_adapt"></a>
Actions after adaptation</h1>
<p>The <code>SolidTractionElements</code> are re-attached after the mesh adaptation. Again, the call to <code>PVDEquationsBase&lt;2&gt;::pin_redundant_nodal_solid_pressures()</code> is not strictly necessary for the elements used in the present driver code but is included "for safety".</p>
 <div class="fragment"><div class="line"><span class="comment">//=====================start_of_actions_after_adapt=======================</span></div>
<div class="line"><span class="comment">///  Actions after adapt: Rebuild the mesh of traction elements</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#af4d135ace3eac657b38de362e1644c75">CantileverProblem&lt;ELEMENT&gt;::actions_after_adapt</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Create traction elements from all elements that are </span></div>
<div class="line"> <span class="comment">// adjacent to boundary 2 and add them to surface meshes</span></div>
<div class="line"> create_traction_elements();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Rebuild the Problem&#39;s global mesh from its various sub-meshes</span></div>
<div class="line"> rebuild_global_mesh();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pin the redundant solid pressures (if any)</span></div>
<div class="line"> PVDEquationsBase&lt;2&gt;::pin_redundant_nodal_solid_pressures(</div>
<div class="line">  solid_mesh_pt()-&gt;element_pt());</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set pointer to prescribed traction function for traction elements</span></div>
<div class="line"> set_traction_pt();</div>
<div class="line"> </div>
<div class="line">}<span class="comment">// end of actions_after_adapt</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="set_traction"></a>
Setting the pointer to the traction function</h1>
<p>The helper function <code>set_traction_pt()</code> is used to pass the pointer to the traction function to the <code>SolidTractionElements</code>.</p>
 <div class="fragment"><div class="line"><span class="comment">//==================start_of_set_traction_pt==============================</span></div>
<div class="line"><span class="comment">/// Set pointer to traction function for the relevant</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// elements in the traction mesh</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#a96a9716947a15930f3881fcec6d448e2">CantileverProblem&lt;ELEMENT&gt;::set_traction_pt</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Loop over the elements in the traction element mesh</span></div>
<div class="line"> <span class="comment">// for elements on the top boundary (boundary 2)</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element=traction_mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_element;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">//Cast to a solid traction element</span></div>
<div class="line">   SolidTractionElement&lt;ELEMENT&gt; *el_pt = </div>
<div class="line">    <span class="keyword">dynamic_cast&lt;</span>SolidTractionElement&lt;ELEMENT&gt;*<span class="keyword">&gt;</span></div>
<div class="line">    (traction_mesh_pt()-&gt;element_pt(i));</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Set the traction function</span></div>
<div class="line">   el_pt-&gt;traction_fct_pt() = <a class="code" href="namespaceGlobal__Physical__Variables.html#a19f4e20a92e7d216b4d2b00308f96917">Global_Physical_Variables::constant_pressure</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">}<span class="comment">// end of set traction pt</span></div>
<div class="ttc" id="aclassCantileverProblem_html_a96a9716947a15930f3881fcec6d448e2"><div class="ttname"><a href="classCantileverProblem.html#a96a9716947a15930f3881fcec6d448e2">CantileverProblem::set_traction_pt</a></div><div class="ttdeci">void set_traction_pt()</div><div class="ttdoc">Pass pointer to traction function to the elements in the traction mesh.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00413">airy_cantilever.cc:413</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="create_traction"></a>
Creating the traction elements</h1>
<p>The helper function <code>create_traction_elements()</code> is used to create the <code>SolidTractionElements</code> and to store them in the appropriate sub-mesh.</p>
 <div class="fragment"><div class="line"><span class="comment">//============start_of_create_traction_elements==============================</span></div>
<div class="line"><span class="comment">/// Create traction elements </span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#abb6f19d964d96a531bf1a60732c72ce9">CantileverProblem&lt;ELEMENT&gt;::create_traction_elements</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// Traction elements are located on boundary 2:</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> b=2;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// How many bulk elements are adjacent to boundary b?</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element = solid_mesh_pt()-&gt;nboundary_element(b);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over the bulk elements adjacent to boundary b</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Get pointer to the bulk element that is adjacent to boundary b</span></div>
<div class="line">   ELEMENT* bulk_elem_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(</div>
<div class="line">    solid_mesh_pt()-&gt;boundary_element_pt(b,e));</div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Find the index of the face of element e along boundary b</span></div>
<div class="line">   <span class="keywordtype">int</span> face_index = solid_mesh_pt()-&gt;face_index_at_boundary(b,e);</div>
<div class="line">      </div>
<div class="line">   <span class="comment">// Create new element and add to mesh</span></div>
<div class="line">   Traction_mesh_pt-&gt;add_element_pt(<span class="keyword">new</span> SolidTractionElement&lt;ELEMENT&gt;</div>
<div class="line">                                    (bulk_elem_pt,face_index));   </div>
<div class="line">  }  </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Pass the pointer to the traction function to the traction elements</span></div>
<div class="line"> set_traction_pt();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of create_traction_elements</span></div>
<div class="ttc" id="aclassCantileverProblem_html_abb6f19d964d96a531bf1a60732c72ce9"><div class="ttname"><a href="classCantileverProblem.html#abb6f19d964d96a531bf1a60732c72ce9">CantileverProblem::create_traction_elements</a></div><div class="ttdeci">void create_traction_elements()</div><div class="ttdoc">Create traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00437">airy_cantilever.cc:437</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="delete_traction"></a>
Deleting the traction elements</h1>
<p>The helper function <code>delete_traction_elements()</code> is used to delete the <code>SolidTractionElements</code>.</p>
 <div class="fragment"><div class="line"><span class="comment">//============start_of_delete_traction_elements==============================</span></div>
<div class="line"><span class="comment">/// Delete traction elements and wipe the  traction meshes</span></div>
<div class="line"><span class="comment"></span><span class="comment">//=======================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#aeb64122ce3783bf36df3696c41e5d2a5">CantileverProblem&lt;ELEMENT&gt;::delete_traction_elements</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// How many surface elements are in the surface mesh</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element = Traction_mesh_pt-&gt;nelement();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over the surface elements</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> e=0;e&lt;n_element;e++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Kill surface element</span></div>
<div class="line">   <span class="keyword">delete</span> Traction_mesh_pt-&gt;element_pt(e);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Wipe the mesh</span></div>
<div class="line"> Traction_mesh_pt-&gt;flush_element_and_node_storage();</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of delete_traction_elements</span></div>
<div class="ttc" id="aclassCantileverProblem_html_aeb64122ce3783bf36df3696c41e5d2a5"><div class="ttname"><a href="classCantileverProblem.html#aeb64122ce3783bf36df3696c41e5d2a5">CantileverProblem::delete_traction_elements</a></div><div class="ttdeci">void delete_traction_elements()</div><div class="ttdoc">Delete traction elements.</div><div class="ttdef"><b>Definition:</b> <a href="airy__cantilever_8cc_source.html#l00472">airy_cantilever.cc:472</a></div></div>
</div><!-- fragment --> <hr  />
 <hr  />
<h1><a class="anchor" id="doc"></a>
Post-processing</h1>
<p>The post-processing function <code>doc_solution()</code> outputs the finite-element solution, using the modified output function defined in the wrapper class <code>MySolidElement</code>, discussed below.</p>
 <div class="fragment"><div class="line"><span class="comment">//==============start_doc===========================================</span></div>
<div class="line"><span class="comment">/// Doc the solution</span></div>
<div class="line"><span class="comment"></span><span class="comment">//==================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classCantileverProblem.html#a7571348f8724e71be4e67dc64cea3877">CantileverProblem&lt;ELEMENT&gt;::doc_solution</a>()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> ofstream some_file;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of plot points</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_plot = 5; </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output shape of and stress in deformed body</span></div>
<div class="line"> <span class="comment">//--------------------------------------------</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/soln%i.dat&quot;</span>,Doc_info.directory().c_str(),</div>
<div class="line">         Doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> solid_mesh_pt()-&gt;output(some_file,n_plot);</div>
<div class="line"> some_file.close();</div>
</div><!-- fragment --><p> Next we output the approximate St. Venant solution at the same plot points and write the load/displacement characteristics to the trace file.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output St. Venant solution</span></div>
<div class="line"> <span class="comment">//---------------------------</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/exact_soln%i.dat&quot;</span>,Doc_info.directory().c_str(),</div>
<div class="line">         Doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Element dimension</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> el_dim=2;</div>
<div class="line"> </div>
<div class="line"> Vector&lt;double&gt; s(el_dim);</div>
<div class="line"> Vector&lt;double&gt; x(el_dim);</div>
<div class="line"> Vector&lt;double&gt; xi(el_dim);</div>
<div class="line"> DenseMatrix&lt;double&gt; sigma(el_dim,el_dim);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Constants for exact (St. Venant) solution</span></div>
<div class="line"> <span class="keywordtype">double</span> a=-1.0/4.0*<a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">Global_Physical_Variables::P</a>;</div>
<div class="line"> <span class="keywordtype">double</span> b=-3.0/8.0*<a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">Global_Physical_Variables::P</a>/<a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a>;</div>
<div class="line"> <span class="keywordtype">double</span> c=1.0/8.0*<a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">Global_Physical_Variables::P</a>/</div>
<div class="line">  pow(<a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a>,3);</div>
<div class="line"> <span class="keywordtype">double</span> d=1.0/20.0*<a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">Global_Physical_Variables::P</a>/<a class="code" href="namespaceGlobal__Physical__Variables.html#af6e07423e22c0991084d9a2f43727805">Global_Physical_Variables::H</a>;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over all elements to plot exact solution for stresses</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nel=solid_mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> e=0;e&lt;nel;e++)</div>
<div class="line">  {   </div>
<div class="line">   <span class="comment">// Get pointer to element</span></div>
<div class="line">   SolidFiniteElement* el_pt=<span class="keyword">dynamic_cast&lt;</span>SolidFiniteElement*<span class="keyword">&gt;</span>(</div>
<div class="line">    solid_mesh_pt()-&gt;element_pt(e));</div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Tecplot header info </span></div>
<div class="line">   some_file &lt;&lt; <span class="stringliteral">&quot;ZONE I=&quot;</span> &lt;&lt; n_plot &lt;&lt; <span class="stringliteral">&quot;, J=&quot;</span> &lt;&lt; n_plot &lt;&lt; std::endl;</div>
<div class="line">   </div>
<div class="line">   <span class="comment">//Loop over plot points</span></div>
<div class="line">   <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l2=0;l2&lt;n_plot;l2++)</div>
<div class="line">    {</div>
<div class="line">     s[1] = -1.0 + l2*2.0/(n_plot-1);</div>
<div class="line">     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l1=0;l1&lt;n_plot;l1++)</div>
<div class="line">      {</div>
<div class="line">       s[0] = -1.0 + l1*2.0/(n_plot-1);</div>
<div class="line">       </div>
<div class="line">       <span class="comment">// Get Eulerian and Lagrangian coordinates</span></div>
<div class="line">       el_pt-&gt;interpolated_x(s,x);</div>
<div class="line">       el_pt-&gt;interpolated_xi(s,xi);</div>
<div class="line">       </div>
<div class="line">       <span class="comment">//Output the x,y,..</span></div>
<div class="line">       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;el_dim;i++) </div>
<div class="line">        {some_file &lt;&lt; x[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;}</div>
<div class="line">       </div>
<div class="line">       <span class="comment">// Change orientation of coordinate system relative</span></div>
<div class="line">       <span class="comment">// to solution in lecture notes</span></div>
<div class="line">       <span class="keywordtype">double</span> xx=<a class="code" href="namespaceGlobal__Physical__Variables.html#a1b8bfc451f6b7ac89eca18f04338f47f">Global_Physical_Variables::L</a>-xi[0];</div>
<div class="line">       <span class="keywordtype">double</span> yy=xi[1];</div>
<div class="line"> </div>
<div class="line">         <span class="comment">// Approximate analytical (St. Venant) solution</span></div>
<div class="line">         sigma(0,0)=c*(6.0*xx*xx*yy-4.0*yy*yy*yy)+</div>
<div class="line">          6.0*d*yy;</div>
<div class="line">         sigma(1,1)=2.0*(a+b*yy+c*yy*yy*yy);</div>
<div class="line">         sigma(1,0)=2.0*(b*xx+3.0*c*xx*yy*yy);</div>
<div class="line">         sigma(0,1)=sigma(1,0);</div>
<div class="line"> </div>
<div class="line">         <span class="comment">// Output stress</span></div>
<div class="line">         some_file &lt;&lt; sigma(0,0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                   &lt;&lt; sigma(1,0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                   &lt;&lt; sigma(1,1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                   &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Write trace file: Load/displacement characteristics</span></div>
<div class="line"> Trace_file &lt;&lt; <a class="code" href="namespaceGlobal__Physical__Variables.html#a23c2ade6398f54040b869f7f3a2bcc4b">Global_Physical_Variables::P</a>  &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; Trace_node_pt-&gt;x(0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; Trace_node_pt-&gt;x(1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> </div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Increment label for output files</span></div>
<div class="line"> Doc_info.number()++;</div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end doc</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="exercises"></a>
Comments and exercises</h1>
<h2><a class="anchor" id="ex"></a>
Exercises</h2>
<ol type="1">
<li>Modify the driver code so that the cantilever beam is loaded by gravity rather than a pressure load. Consult the document <a href="../../solid_theory/html/index.html">"Solid mechanics: Theory and implementation"</a> for details on the non-dimensionalisation of the body force. Verify that for modest deflections and for sufficiently thin beams, the macroscopic deformation due to a gravitational load is identical to that induced by an equivalent pressure load, equivalent meaning that the total force on the beam is the same for both cases. <br  />
 <br  />
</li>
<li>Change the element type to a <code>RefineableQPVDElementWithPressure&lt;2&gt;</code> and <code>RefineableQPVDElementWithContinuousPressure&lt;2&gt;</code> and compare the results. Both of these two elements are based on a pressure-displacement formulation, the former employing a discontinuous pressure representation (as in Crouzeix-Raviart Navier-Stokes elements), the latter employing a continuous pressure representation (as in Taylor-Hood elements). Confirm that calls to <code>PVDEquationsBase&lt;2&gt;::pin_redundant_nodal_solid_pressures()</code> are essential if a continuous pressure representation is used. Explain the code's behaviour when you comment out the calls to this function. <br  />
 <br  />
</li>
<li>Repeat the computation without adaptivity, by using the non-refineable versions of the various solid mechanics elements discussed above, namely the <code>QPVDElement&lt;2&gt;</code>, <code>QPVDElementWithPressure&lt;2&gt;</code> and <code>QPVDElementWithContinuousPressure&lt;2&gt;</code>. This will require various changes to the code:<ol type="a">
<li>You will have to create a solid mechanics version of the (non-refineable) <code>RectangularQuadMesh</code>. This is necessary because non-refineable elements cannot be used with refineable meshes. Try it to find out why! [Note: You could, of course, use the existing driver code with its refineable mesh and the refineable elements and simply not use the adaptive capabilities by omitting the <code>max_adapt</code> argument when calling the Newton solver. However, the main point of this exercise is to force you to understand how to upgrade an existing <code>Mesh</code> to a <code>SolidMesh</code>. It's easy: Simply follow the steps used to create a refineable <code>SolidMesh</code> from the <code>RefineableRectangularQuadMesh</code>, in <a href="../../../../src/meshes/rectangular_quadmesh.template.h">src/meshes/rectangular_quadmesh.template.h</a>. Instead of inheriting the mesh from the <code>RefineableRectangularQuadMesh</code> and the <code>SolidMesh</code> classes, inherit from the non-refineable <code>RectangularQuadMesh</code> and the <code>SolidMesh</code>.]</li>
<li>You must not pass the pointer to the error estimator to the non-refineable mesh &ndash; it has no use for it.</li>
<li>You cannot call the adaptive Newton solver.</li>
</ol>
</li>
</ol>
<hr  />
<h2><a class="anchor" id="com"></a>
Comment: Customising an element's output function</h2>
<p>In the driver code discussed above we used the "wrapper" class <code>MySolidElement</code> to customise the solid elements' output function so that each element outputs its shape and the three independent components of the second Piola Kirchhoff stress, <img class="formulaInl" alt="$ \sigma_{11}, \sigma_{12} $" src="form_9.png" width="40" height="9"/> and <img class="formulaInl" alt="$ \sigma_{22}. $" src="form_10.png" width="20" height="9"/></p>
<p>Here is the implementation: The "wrapping" element inherits from the element type specified by the template parameter and calls its constructor (recall that element constructors are always argument-free!).</p>
 <div class="fragment"><div class="line"><span class="comment">//=================start_wrapper==================================</span></div>
<div class="line"><span class="comment">/// Wrapper class for solid elements to modify their output </span></div>
<div class="line"><span class="comment"></span><span class="comment">/// functions.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//================================================================</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keyword">class </span>MySolidElement : <span class="keyword">public</span> <span class="keyword">virtual</span> ELEMENT</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor: Call constructor of underlying element</span></div>
<div class="line"><span class="comment"></span> MySolidElement() : ELEMENT() {};</div>
</div><!-- fragment --><p> We then overload the (virtual) output function so that the element outputs its shape, i.e. the <img class="formulaInl" alt="$ x $" src="form_11.png" width="8" height="6"/> and <img class="formulaInl" alt="$ y $" src="form_12.png" width="8" height="9"/> coordinates of its plot points, and the three independent components of the second Piola Kirchhoff stress at those points. Other than that, the element behaves exactly as the underlying "wrapped" element.</p>
<div class="fragment"><div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Overload output function:</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> output(std::ostream &amp;outfile, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;n_plot)</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Element dimension</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> el_dim = this-&gt;dim();</div>
<div class="line"> </div>
<div class="line">   Vector&lt;double&gt; s(el_dim);</div>
<div class="line">   Vector&lt;double&gt; x(el_dim);</div>
<div class="line">   DenseMatrix&lt;double&gt; sigma(el_dim,el_dim);</div>
<div class="line">   </div>
<div class="line">   <span class="keywordflow">switch</span>(el_dim)</div>
<div class="line">    {</div>
<div class="line">     </div>
<div class="line">    <span class="keywordflow">case</span> 2:</div>
<div class="line"> </div>
<div class="line">     <span class="comment">//Tecplot header info </span></div>
<div class="line">     outfile &lt;&lt; <span class="stringliteral">&quot;ZONE I=&quot;</span> &lt;&lt; n_plot &lt;&lt; <span class="stringliteral">&quot;, J=&quot;</span> &lt;&lt; n_plot &lt;&lt; std::endl;</div>
<div class="line">     </div>
<div class="line">     <span class="comment">//Loop over element nodes</span></div>
<div class="line">     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l2=0;l2&lt;n_plot;l2++)</div>
<div class="line">      {</div>
<div class="line">       s[1] = -1.0 + l2*2.0/(n_plot-1);</div>
<div class="line">       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> l1=0;l1&lt;n_plot;l1++)</div>
<div class="line">        {</div>
<div class="line">         s[0] = -1.0 + l1*2.0/(n_plot-1);</div>
<div class="line">         </div>
<div class="line">         <span class="comment">// Get Eulerian coordinates and stress</span></div>
<div class="line">         this-&gt;interpolated_x(s,x);</div>
<div class="line">         this-&gt;get_stress(s,sigma);</div>
<div class="line"> </div>
<div class="line">         <span class="comment">//Output the x,y,..</span></div>
<div class="line">         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;el_dim;i++) </div>
<div class="line">          {outfile &lt;&lt; x[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;}</div>
<div class="line"> </div>
<div class="line">         <span class="comment">// Output stress</span></div>
<div class="line">         outfile &lt;&lt; sigma(0,0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                 &lt;&lt; sigma(1,0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                 &lt;&lt; sigma(1,1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                 &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">     <span class="keywordflow">break</span>;</div>
<div class="line">     </div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line"> </div>
<div class="line">     std::ostringstream error_message;</div>
<div class="line">     error_message &lt;&lt; <span class="stringliteral">&quot;Output for dim !=2 not implemented&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">     <span class="keywordflow">throw</span> OomphLibError(error_message.str(),</div>
<div class="line">                         OOMPH_CURRENT_FUNCTION,</div>
<div class="line">                         OOMPH_EXCEPTION_LOCATION);</div>
<div class="line">    }</div>
<div class="line">  </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --><p> [<b>Note:</b> Since this element is only defined and used in a 2D driver code, there is little point in implementing the output for 1D or 3D elements. However, paranoid as we are, we check the dimension of the element and throw an error if it is wrong.]</p>
<p>Finally we declare that the <code>FaceGeometry</code> of the "wrapped" element is the same as that of the underlying element. This step is required to allow the automatic construction of <code>SolidTractionElements</code> in <code>create_traction_elements()</code>.</p>
 <div class="fragment"><div class="line"><span class="comment">//===========start_face_geometry==============================================</span></div>
<div class="line"><span class="comment">/// FaceGeometry of wrapped element is the same as the underlying element</span></div>
<div class="line"><span class="comment"></span><span class="comment">//============================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keyword">class </span>FaceGeometry&lt;MySolidElement&lt;ELEMENT&gt; &gt; :</div>
<div class="line"> <span class="keyword">public</span> <span class="keyword">virtual</span> FaceGeometry&lt;ELEMENT&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor [this was only required explicitly</span></div>
<div class="line"><span class="comment"> /// from gcc 4.5.2 onwards...]</span></div>
<div class="line"><span class="comment"></span> FaceGeometry() : FaceGeometry&lt;ELEMENT&gt;() {}</div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory:<br  />
<br  />
<center> <a href="
../../../../
demo_drivers/solid/airy_cantilever/
">demo_drivers/solid/airy_cantilever/ </a> </center><br  />
</li>
<li>The driver code is: <br  />
<br  />
<center> <a href="
../../../../
demo_drivers/solid/airy_cantilever/airy_cantilever.cc
">demo_drivers/solid/airy_cantilever/airy_cantilever.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:26:08
        </div>
      </div>
    </footer>
</body>
</html>
