<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: refine_b_convect.txt_doxygenified.h Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">refine_b_convect.txt_doxygenified.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="refine__b__convect_8txt__doxygenified_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">\mainpage Refineable Boussinesq Convection: Combining Refineable Navier--Stokes and Advection--Diffusion equations</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">\image html cells.gif &quot;Steady Convection Rolls: contours of temperature and element boundaries for a two-dimensional domain heated from below at Ra = 1800 &quot; </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">\image latex cells.eps &quot;Steady Convection Rolls: contours of temperature and element boundaries for a two-dimensional domain heated from below at Ra = 1800 &quot; width=0.75\textwidth</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> We study convection of an</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> incompressible Newtonian fluid heated from below in a</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> two-dimensional domain of height \f$ H \f$ :</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> the B&amp;eacute;nard problem. The lower wall is maintained at a</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> temperature \f$ \theta_{bottom} \f$ and the upper wall is maintained at</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> a temperature \f$ \theta_{top} \f$, where \f$ \theta_{bottom} &gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> \theta_{top} \f$. The theory is described </span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> &lt;a  href=&quot;../../b_convection/html/index.html&quot;&gt; the non-refineable </span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> version of the problem. &lt;/a&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> In this example, we solve the same physical problem, but using refineable</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> elements. As an alternative to the time-stepping procedure adopted</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> previously, we perturb the trivial steady-state solution and re-solve</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> the steady equations to obtain the steady symmetry-broken solution.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> In what follows, we shall only describe those parts of the code that</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> differ from the non-refineable version.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">\section main The driver code</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">We start by setting the direction of gravity, and constructing </span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">the problem using the new</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">\ref element &quot;RefineableBuoyantQCrouzeixRaviartElements&quot;, described</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">&lt;A HREF=&quot;#element&quot;&gt;below.&lt;/A&gt; </span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">\dontinclude refineable_b_convection.cc</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">\skipline start_of_main</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">\until problem;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">As discussed in the  &lt;a href=&quot;../../b_convection/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">previous example,&lt;/a&gt; a small perturbation is required to force</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">the solution from the trivial steady state of zero velocity</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">and linear temperature variation. Therefore, we add</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">a small perturbation to the vertical velocity on the</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">upper wall before solving the steady problem, allowing for up to </span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">two levels of adaptive mesh refinement. </span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">\until doc_solution</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">Having forced the solution into a non-trivial symmetry-broken state,</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">we switch off the perturbation and re-solve the problem, allowing</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">for another two levels of adaptive refinement. The Newton solver</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">now converges to the unperturbed but symmetry-broken solution</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">shown above.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">\until end of main</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">\section problem The problem class</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">The problem class contains the constructor and (empty) destructor,</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">the usual action functions, and an access function to the specific </span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">mesh used in this problem. </span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">\dontinclude refineable_b_convection.cc</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">\skipline start_of_problem_class</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">\until end of access</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">No specific action is required before the adaptation but</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">following the mesh adaptation exactly one pressure degree of freedom</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">must be pinned in the problem. (Since the domain is enclosed the </span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">pressure is only determined up to an arbitrary constant.) </span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">The pressure degree of freedom that was pinned before the adaptation</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">may have disappeared during the adaptation, therefore </span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">the constraint must be re-applied. However, we unpin all pressure</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">degrees of freedom first to ensure that we do not accidentally </span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">pin two pressure degrees of freedom. </span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">\until end_of_fix</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">The remaining member functions provide access to the boolean flag</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">that controls the application of the imperfection, and document</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">the solution:</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">\until end of problem class</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">\section const The constructor</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">We pass the element type as a template parameter to the problem </span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">constructor, which has no arguments. The constructor builds a</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">coarse initial \c RefineableRectangularQuadMesh, using </span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">\f$ 9 \times 8 \f$ elements and allocates a spatial error </span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">estimator that is attached to the mesh.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">\dontinclude refineable_b_convection.cc</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">\skipline start_of_con </span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">\until min_permitted_error</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">Next, the boundary constraints are imposed. We pin all velocities and</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">the temperature on the top and bottom walls and pin only the horizontal</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">velocity on the sidewalls. As discussed above, a single pressure </span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">value must be pinned to ensure a unique solution.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">\skipline Set the boundary</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">\until fix_pressure(</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">We complete the build of the elements by setting the pointers </span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">to the physical parameters and finally assign the equation numbers</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">\skipline unsigned n_element</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">\until end of constructor</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">\subsection fix_p The function fix_pressure(...)</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> This function is a simple wrapper to the element&#39;s \c</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"> fix_pressure(...) function.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">\dontinclude refineable_b_convection.cc</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">\skipline Fix pressure</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">\until end_of_fix_pressure </span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">\subsection actions_before The function actions_before_newton_solve(...)</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">The function is used to set the specific values of the Dirichlet</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">boundary conditions. If the boolean flag \c Imperfect is true then a</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">small mass-conserving imperfection is added to the velocity boundary</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">condition on the top wall.</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">\dontinclude refineable_b_convection.cc</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">\skipline start_actions_before_newton_solve</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">\until end of actions before solve</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">\subsection doc The function doc_solution(...)</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">This function writes the complete velocity, pressure and temperature</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">fields to a file in the output directory specified in the \c DocInfo</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">object.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">\dontinclude refineable_b_convection.cc</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">\skipline start_of_doc_solution</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">\section element Creating the new RefineableBouyantQCrouzeixRaviartElement class</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">As in the  &lt;a href=&quot;../../b_convection/html/index.html&quot;&gt;non-refineable </span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">version of the problem&lt;/a&gt; we create the refineable element</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">\c RefineableBuoyantQCrouzeixRaviartElement by multiple inheritance from the </span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">\c RefineableQCrouzeixRaviartElement and </span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">\c RefineableQAdvectionDiffusionElement:</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">\dontinclude boussinesq_elements.h</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">\skipline start_element_class</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">\until {</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">Many of the</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">additional member functions required in the combined multi-physics element are </span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">identical to those in the non-refineable version:</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">- the access function to (the pointer to the) Rayleigh number, \c ra_pt(),</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">- the output functions, \c output(...),</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">- the function \c required_n_value(...) which specifies the number of</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">  values required at each node,</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">- the function \c u_index_adv_diff(...) which specifies the index at </span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">  which the temperature is stored within the elements&#39; \c Nodes,</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">- the function  \c get_wind_adv_diff(...) which specifies the &quot;wind&quot; in</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">  the advection diffusion equations in terms of the </span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">  Navier-Stokes velocities,</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">- the function \c get_body_force_nst(...) which specifies the body</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">  force in the Navier-Stokes equations in terms of the temperature.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">- the two &quot;fill in&quot; function are implemented as in the non-refineable</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">  element. The function \c fill_in_contribution_to_residuals(...) </span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">  concatenates the contributions from the two underlying elements;</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">  the function \c fill_in_contribution_to_jacobian(...) computes</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">  the coupled elemental Jacobian matrix by finite-differencing. </span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">We shall only discuss those additional functions that are required </span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">in the refineable version of the combined multi-physics element.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">Both constituent elements are derived from the</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">\c ElementWithZ2ErrorEstimator base class and each element</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">provides its own definition of the &quot;Z2-flux&quot; that is used</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">by the Z2 error estimator to compute elemental error estimates. </span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">We must decide on a single error estimator for the combined</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">element. We could base the error estimation entirely on the fluid</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">flow, or the temperature field, but instead we shall choose our single</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">error estimate to be the maximum of the fluid and temperature error</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">estimates. The functions required by the \c Z2ErrorEstimator are</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">overloaded to return all the flux terms associated with</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">both the velocity and temperature</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">fields, with the velocity field terms stored first. </span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">\dontinclude boussinesq_elements.h</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">\skipline The recovery order is that of</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">\until end of get_Z2_flux</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">The default behaviour of the Z2 error estimator is to combine all</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">components of the flux vector into a single compound flux. In the present</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">multi-physics element, we instead define two compound fluxes: one</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">corresponding to the combined</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">temperature fluxes and the other to the combined velocity field</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">fluxes. The flux components associated with each compound flux must</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">specified by overloading the function \c get_Z2_compound_flux_indices</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">which returns a vector of the same length as the number of flux</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">components, containing the index of the compound flux to which</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">the flux component contributes.</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">\dontinclude boussinesq_elements.h</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">\skipline The number of compound fluxes</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">\until end of get_Z2_compound_flux_indices</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">The \c Z2ErrorEstimator calculates the error estimates for each compound flux.</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">The individual error estimates are then combined to a single </span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">error estimate by the function</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">\c Z2ErrorEstimator::get_combined_error_estimate(). By default the single</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">error estimate is chosen to be the maximum of all calculated error estimates.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">Alternative user-defined functions</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">can be specified via the function pointer </span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">\c Z2ErrorEstimator::CombinedErrorEstimateFctPt&amp; \c combined_error_fct_pt(),</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">see \ref comments for a more detailed discussion of this aspect.  </span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">The vertex nodes are defined by the underlying geometric element, but</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">require a final overload to prevent ambiguities:</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">\dontinclude boussinesq_elements.h</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">\skipline Number of vertex nodes</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">\dontinclude boussinesq_elements.h</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">\skipline Pointer to the j-th</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">The number of continuously interpolated values is \c DIM \c + \c 1:</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">\c DIM velocity components and one temperature.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">\dontinclude boussinesq_elements.h</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">\skipline ncont_interpolated_values</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">The two versions of the \c get_interpolated_values(...) function</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">must return the continuously interpolated variables at a </span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">specified position within the element:</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">\dontinclude boussinesq_elements.h</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">\skipline Get the continuously interpolated</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">\until end of get_interpolated_values</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">Finally, the setup and build functions must call the build functions of the</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">two constituent elements. In addition, the pointer to the Rayleigh number</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">must be passed to the sons after refinement.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">\dontinclude boussinesq_elements.h</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">\skipline The additional hanging</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">\until end of further build</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">\section comm_and_exercises Comments and Exercises</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">\subsection comments Comments</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">- &lt;B&gt;Error estimation for multi-physics elements&lt;/B&gt;\n\n</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">  The error estimation for the combined multi-physics element is</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">  performed with the \c Z2ErrorEstimator which computes an error</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">  estimate based Zienkiewicz and Zhu&#39;s flux recovery technique,</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">  using the elemental &quot;Z2 flux&quot; defined in the pure virtual</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">  function \c get_Z2_flux(...). The two constituent elements </span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">  already provide their own implementation of this function: \n\n</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">  - In the \c RefineableQAdvectionDiffusionElement the</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">    temperature gradient is used as the flux.\n\n</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">  - In the \c RefineableQCrouzeixRaviartElement the flux is defined by</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">    the components of the fluid&#39;s rate of strain tensor. \n\n</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">  .</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">  It is not obvious what combination of these flux terms should </span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">  be used to compute the error estimates for the combined</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">  multi-physics element. The most general option would be </span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">  to combine the two flux vectors, possibly using</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">  a weighting factor to control the relative importance of the</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">  various components. </span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">  \n\n</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">  In the example above, we chose an error estimate that was the maximum value</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">  of the individual error estimates for the Navier-Stokes flux and the</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">  temperature flux. Refinement will be performed if either of the</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">  single-physics error estimates are above the chosen thresholds. It is also</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">  possible to base the error estimation entirely on the Navier-Stokes fluxes;</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">  an appropriate choice for problems in which the variations in the velocity</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">  field are expected to be much more rapid than those in the</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">  temperature field. Alternatively,  </span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">  the error estimation could be based exclusively on the temperature field;</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">  a choice that would be appropriate for problems with thin</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">  thermal boundary layers. The different error estimates can all be </span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">  specified by user-defined functions that combine the vector of </span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">  compound-flux error estimates into a single number. For example, </span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">  the function</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">  \code</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">   double navier_stokes_flux_error(const Vector&lt;double&gt; &amp;errors)</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">    {return errors[0];}</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">  \endcode</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">   specifies that the combined error estimate is the first of the </span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">   compound error estimates ---</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">   the error estimate for the Navier--Stokes equations.</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">  \n\n</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">  In the current example both fields vary very smoothly, and as a result</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">  spatial adaptivity is not really required in this problem. This is why</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">  we set a very narrow range of target errors -- if the default</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">  targets are used, \c oomph-lib refines the mesh uniformly.</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">\subsection exercises Exercises</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">-# Confirm that for a Rayleigh number of \f$ Ra = 1700 \f$  the system </span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">   is stable, i.e. it returns to the trivial state,</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">   when the perturbation to the vertical velocity on the upper wall</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">   is switched off.\n\n</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">-# Re-write the multi-physics elements so that the temperature is</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">   stored \b before the fluid velocities. Confirm that the solution is</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">   unchanged in this case.\n\n</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">-# Try using \c RefineableQTaylorHoodElements as the &quot;fluid&quot; element </span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">   part of the multi-physics elements. </span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">-# Change the error estimate to be based entirely on the error in the</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">   Navier--Stokes fluxes by using a user-defined function. Is there any</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">   difference in the refinement pattern?</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">\section sources Source files for this tutorial</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">- The source files for this tutorial are located in the directory:\n\n</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/multi_physics/boussinesq_convection/&quot;&gt;</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">demo_drivers/multi_physics/boussinesq_convection/</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">&lt;/CENTER&gt;\n</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">- The driver code is: \n\n</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/multi_physics/boussinesq_convection/boussinesq_convection.cc&quot;&gt;</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">demo_drivers/multi_physics/boussinesq_convection/boussinesq_convection.cc</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">\n</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">- The source code for the elements is in: \n\n</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../src/multi_physics/boussinesq_elements.h&quot;&gt;</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">src/multi_physics/boussinesq_elements.h&lt;/A&gt;</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">\section pdf PDF file</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">A &lt;a href=&quot;../latex/refman.pdf&quot;&gt;pdf version&lt;/a&gt; of this document is available.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">**/</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="arefine__b__convect_8txt_html_a45c28d7c95e6c5c1c6023e8af810b0cb"><div class="ttname"><a href="refine__b__convect_8txt.html#a45c28d7c95e6c5c1c6023e8af810b0cb">Convection</a></div><div class="ttdeci">mainpage Refineable Boussinesq Convection</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00008">refine_b_convect.txt:8</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a8243e0f56e579a9799a10c24a49568d9"><div class="ttname"><a href="refine__b__convect_8txt.html#a8243e0f56e579a9799a10c24a49568d9">used</a></div><div class="ttdeci">endcode specifies that the combined error estimate is the first of the compound error estimates the error estimate for the Navier Stokes equations n n In the current example both fields vary very and as a result spatial adaptivity is not really required in this problem This is why we set a very narrow range of target errors if the default targets are used</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00313">refine_b_convect.txt:313</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a11778e96d5cb3a43210ca8e38083780f"><div class="ttname"><a href="refine__b__convect_8txt.html#a11778e96d5cb3a43210ca8e38083780f">problem</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation we add a small perturbation to the vertical velocity on the upper wall before solving the steady problem</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00040">refine_b_convect.txt:40</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a00f33da8657b7c8459f10df3ab2c3272"><div class="ttname"><a href="refine__b__convect_8txt.html#a00f33da8657b7c8459f10df3ab2c3272">Therefore</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation Therefore</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00038">refine_b_convect.txt:38</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a7c1fa6e10991638196020d39232e43d1"><div class="ttname"><a href="refine__b__convect_8txt.html#a7c1fa6e10991638196020d39232e43d1">state</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation we add a small perturbation to the vertical velocity on the upper wall before solving the steady allowing for up to two levels of adaptive mesh refinement until doc_solution Having forced the solution into a non trivial symmetry broken state</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00045">refine_b_convect.txt:45</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a9a325f28a20fa4ec06f5574b0c0b4e61"><div class="ttname"><a href="refine__b__convect_8txt.html#a9a325f28a20fa4ec06f5574b0c0b4e61">imperfection</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation we add a small perturbation to the vertical velocity on the upper wall before solving the steady allowing for up to two levels of adaptive mesh refinement until doc_solution Having forced the solution into a non trivial symmetry broken we switch off the perturbation and re solve the allowing for another two levels of adaptive refinement The Newton solver now converges to the unperturbed but symmetry broken solution shown above until end of main&lt; HR &gt;&lt; HR &gt; section problem The problem class The problem class contains the constructor the usual action and an access function to the specific mesh used in this problem dontinclude refineable_b_convection cc skipline start_of_problem_class until end of access No specific action is required before the adaptation but following the mesh adaptation exactly one pressure degree of freedom must be pinned in the therefore the constraint must be re applied we unpin all pressure degrees of freedom first to ensure that we do not accidentally pin two pressure degrees of freedom until end_of_fix The remaining member functions provide access to the boolean flag that controls the application of the imperfection</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00078">refine_b_convect.txt:78</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a3bc94e43fb4273f87ea807c066ffd698"><div class="ttname"><a href="refine__b__convect_8txt.html#a3bc94e43fb4273f87ea807c066ffd698">example</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous example</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00036">refine_b_convect.txt:36</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a0da63057661cd5950bb6ea2e67737e60"><div class="ttname"><a href="refine__b__convect_8txt.html#a0da63057661cd5950bb6ea2e67737e60">functions</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation we add a small perturbation to the vertical velocity on the upper wall before solving the steady allowing for up to two levels of adaptive mesh refinement until doc_solution Having forced the solution into a non trivial symmetry broken we switch off the perturbation and re solve the allowing for another two levels of adaptive refinement The Newton solver now converges to the unperturbed but symmetry broken solution shown above until end of main&lt; HR &gt;&lt; HR &gt; section problem The problem class The problem class contains the constructor the usual action functions</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00058">refine_b_convect.txt:58</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a652760e0529a489769c0132b14a1bdef"><div class="ttname"><a href="refine__b__convect_8txt.html#a652760e0529a489769c0132b14a1bdef">href</a></div><div class="ttdeci">&quot;../../b_convection/html/index.html&quot;&gt;non-refineable version of the problem&lt;/a &gt; we create the refineable element \c RefineableBuoyantQCrouzeixRaviartElement by multiple inheritance from the \c RefineableQCrouzeixRaviartElement and \c RefineableQAdvectionDiffusionElement:\dontinclude boussinesq_elements.h \skipline start_element_class \until { Many of the additional member functions required in the combined multi-physics element are identical to those in the non-refineable version:- the access function to(the pointer to the) Rayleigh number, \c ra_pt(), - the output functions, \c output(...), - the function \c required_n_value(...) which specifies the number of values required at each node, - the function \c u_index_adv_diff(...) which specifies the index at which the temperature is stored within the elements' \c Nodes, - the function \c get_wind_adv_diff(...) which specifies the &quot;wind&quot; in the advection diffusion equations in terms of the Navier-Stokes velocities, - the function \c get_body_force_nst(...) which specifies the body force in the Navier-Stokes equations in terms of the temperature. - the two &quot;fill in&quot; function are implemented as in the non-refineable element. The function \c fill_in_contribution_to_residuals(...) concatenates the contributions from the two underlying elements href</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00180">refine_b_convect.txt:180</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a94a201c7ba6a4bac422b4209ddd924f4"><div class="ttname"><a href="refine__b__convect_8txt.html#a94a201c7ba6a4bac422b4209ddd924f4">and</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation we add a small perturbation to the vertical velocity on the upper wall before solving the steady allowing for up to two levels of adaptive mesh refinement until doc_solution Having forced the solution into a non trivial symmetry broken we switch off the perturbation and re solve the allowing for another two levels of adaptive refinement The Newton solver now converges to the unperturbed but symmetry broken solution shown above until end of main&lt; HR &gt;&lt; HR &gt; section problem The problem class The problem class contains the constructor and(empty) destructor</div></div>
<div class="ttc" id="aboussinesq__convection_8cc_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="boussinesq__convection_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdoc">Driver code for 2D Boussinesq convection problem.</div><div class="ttdef"><b>Definition:</b> <a href="boussinesq__convection_8cc_source.html#l00314">boussinesq_convection.cc:314</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a3ab223d59a01d8efabc714852a703bbe"><div class="ttname"><a href="refine__b__convect_8txt.html#a3ab223d59a01d8efabc714852a703bbe">RefineableRectangularQuadMesh</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation we add a small perturbation to the vertical velocity on the upper wall before solving the steady allowing for up to two levels of adaptive mesh refinement until doc_solution Having forced the solution into a non trivial symmetry broken we switch off the perturbation and re solve the allowing for another two levels of adaptive refinement The Newton solver now converges to the unperturbed but symmetry broken solution shown above until end of main&lt; HR &gt;&lt; HR &gt; section problem The problem class The problem class contains the constructor the usual action and an access function to the specific mesh used in this problem dontinclude refineable_b_convection cc skipline start_of_problem_class until end of access No specific action is required before the adaptation but following the mesh adaptation exactly one pressure degree of freedom must be pinned in the therefore the constraint must be re applied we unpin all pressure degrees of freedom first to ensure that we do not accidentally pin two pressure degrees of freedom until end_of_fix The remaining member functions provide access to the boolean flag that controls the application of the and document the which has no arguments The constructor builds a coarse initial c RefineableRectangularQuadMesh</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00090">refine_b_convect.txt:90</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a4a045af2547c93c6b9801986cc145179"><div class="ttname"><a href="refine__b__convect_8txt.html#a4a045af2547c93c6b9801986cc145179">theta_</a></div><div class="ttdeci">nard problem The lower wall is maintained at a temperature f theta_</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00009">refine_b_convect.txt:9</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a80824adb7703bf8f436e10e7386f2692"><div class="ttname"><a href="refine__b__convect_8txt.html#a80824adb7703bf8f436e10e7386f2692">solution</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation we add a small perturbation to the vertical velocity on the upper wall before solving the steady allowing for up to two levels of adaptive mesh refinement until doc_solution Having forced the solution into a non trivial symmetry broken we switch off the perturbation and re solve the allowing for another two levels of adaptive refinement The Newton solver now converges to the unperturbed but symmetry broken solution shown above until end of main&lt; HR &gt;&lt; HR &gt; section problem The problem class The problem class contains the constructor the usual action and an access function to the specific mesh used in this problem dontinclude refineable_b_convection cc skipline start_of_problem_class until end of access No specific action is required before the adaptation but following the mesh adaptation exactly one pressure degree of freedom must be pinned in the therefore the constraint must be re applied we unpin all pressure degrees of freedom first to ensure that we do not accidentally pin two pressure degrees of freedom until end_of_fix The remaining member functions provide access to the boolean flag that controls the application of the and document the solution</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00089">refine_b_convect.txt:89</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_a76374ef3c6061f3c4786702a50a907ed"><div class="ttname"><a href="refine__b__convect_8txt.html#a76374ef3c6061f3c4786702a50a907ed">element</a></div><div class="ttdeci">the function c or the temperature but instead we shall choose our single error estimate to be the maximum of the fluid and temperature error estimates The functions required by the c Z2ErrorEstimator are overloaded to return all the flux terms associated with both the velocity and temperature with the velocity field terms stored first dontinclude boussinesq_elements h skipline The recovery order is that of until end of get_Z2_flux The default behaviour of the Z2 error estimator is to combine all components of the flux vector into a single compound flux In the present multi physics element</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00206">refine_b_convect.txt:206</a></div></div>
<div class="ttc" id="arefine__b__convect_8txt_html_ad36caf34ab0237a3578c42f2c4a9244a"><div class="ttname"><a href="refine__b__convect_8txt.html#ad36caf34ab0237a3578c42f2c4a9244a">However</a></div><div class="ttdeci">As discussed in the&lt; a href=&quot;../../b_convection/html/index.html&quot;&gt; previous&lt;/a &gt; a small perturbation is required to force the solution from the trivial steady state of zero velocity and linear temperature variation we add a small perturbation to the vertical velocity on the upper wall before solving the steady allowing for up to two levels of adaptive mesh refinement until doc_solution Having forced the solution into a non trivial symmetry broken we switch off the perturbation and re solve the allowing for another two levels of adaptive refinement The Newton solver now converges to the unperturbed but symmetry broken solution shown above until end of main&lt; HR &gt;&lt; HR &gt; section problem The problem class The problem class contains the constructor the usual action and an access function to the specific mesh used in this problem dontinclude refineable_b_convection cc skipline start_of_problem_class until end of access No specific action is required before the adaptation but following the mesh adaptation exactly one pressure degree of freedom must be pinned in the therefore the constraint must be re applied However</div><div class="ttdef"><b>Definition:</b> <a href="refine__b__convect_8txt_source.html#l00071">refine_b_convect.txt:71</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Wed Aug 25 2021 20:14:26
        </div>
      </div>
    </footer>
</body>
</html>
