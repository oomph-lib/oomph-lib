<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Hijacking degrees of freedom in oomph-lib</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../figures/manifest.json">
<link rel="mask-icon" href="../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../html/index.html"><img alt="oomph-lib" src="../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Hijacking degrees of freedom in oomph-lib </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Certain problem formulations require changing the equation corresponding to (having the same global number as) a particular degree of freedom.</p>
<p>For example, in steady free surface problems, there is a constraint on the total fluid volume, but no "obvious" associated degree of freedom. For these problems, a fluid pressure degree of freedom may be "traded" for the volume constraint. The "traded" degree of freedom remains a fluid pressure and must appear in the governing equations in that role. However, the equation associated with that unknown is no longer the continuity equation, but the volume constraint, see <a href="../../navier_stokes/static_single_layer/html/index.html">another tutorial </a> for more details.</p>
<p>A similar situation arises when applying complex boundary conditions: perhaps the fluid velocity on the boundary is itself the solution of an equation depending on a local chemical concentration. One way of implementing such boundary conditions is to introduce a new variable representing the boundary velocity, solve the additional equation for that velocity and then impose that as a Dirichlet condition. However, the condition can be implemented without introducing a new variable by changing the equation associated with the fluid velocity on the boundary.</p>
<p>In <code>oomph-lib</code>, this type of process is known as <b>hijacking</b> and uses the <code>Hijacked</code> wrapper class, which adds new member functions to the element: </p><div class="fragment"><div class="line">Data* hijack_internal_value(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;n, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;i)</div>
<div class="line">Data* hijack_external_value(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;n, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;i)</div>
<div class="line">Data* hijack_nodal_value(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;n, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;i)</div>
<div class="line">Data* hijack_nodal_position_value(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;n, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;i)</div>
<div class="line">Data* hijack_nodal_spine_value(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;n, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> &amp;i)</div>
</div><!-- fragment --><p>Calling any of these functions instructs the bulk element to set the specified residual and associated row in the Jacobian matrix to zero. For example, </p><div class="fragment"><div class="line">Hijacked&lt;QPoissonElement&lt;1,2&gt; &gt; *el_pt = <span class="keyword">new</span> Hijacked&lt;QPoissonElement&lt;1,3&gt; &gt;;</div>
<div class="line">el_pt-&gt;hijack_nodal_value(0,0);</div>
</div><!-- fragment --><p> sets to zero the residual associated with the first data value stored at the first (local) node in the element.</p>
<p>Note that hijacking is on a per element basis, so that if a degree of freedom is shared between elements it can be hijacked in all, none or some of them, as required.</p>
<p>The return type of each member function is a pointer to a <code>Data</code> object. This <code>Data</code> object is a "custom" object that consists of a (copy of a) single value corresponding to the "hijacked" degree of freedom and its global equation number. This object is provided so that it can be used as external data in other elements that assemble the "new" equations for the unknown, see <a href="../../navier_stokes/static_single_layer/html/index.html">another tutorial </a> for an example. Note that this can lead to memory leaks unless the new object is safely deleted, so if you do not want to make use of the <code>Data</code> object you should precede the call to the member function by <code>delete</code>, e.g. </p><div class="fragment"><div class="line"><span class="keyword">delete</span> el_pt-&gt;hijack_internal_value(0,0);</div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="notes"></a>
Notes and Guidelines</h1>
<ul>
<li>If you do not assign a new equation to the "hijacked" unknown the Jacobian matrix will be singular because there will be a zero row.</li>
<li>Hijacking should take place before equation numbering.</li>
<li>The member function <code>Hijacked::unhijack_all_data()</code> can be used to reset all hijacked values in an element.</li>
<li>Hijacking will persist throughout adaptation, but only if the degree of freedom remains "active". It is safest to <code>unhijack_all_data()</code> before adaptation and then hijack again in <code>actions_after_adapt()</code>.</li>
<li>All free surface elements are actually <code>Hijacked</code>, because hijacking is used to enforce the contact angle condition in certain circumstances.</li>
<li>The member function <div class="fragment"><div class="line"><span class="keywordtype">double</span>* &amp;Hijacked::residual_multiplier_pt() </div>
</div><!-- fragment --> can be used to set a double value that multiplies the hijacked residuals. The default and most common case it that the multiplier is zero, but non-zero values may be useful in homotopy continuation calculations in order to move smoothly between different types of boundary condition.</li>
</ul>
<hr  />
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:33:21
        </div>
      </div>
    </footer>
</body>
</html>
