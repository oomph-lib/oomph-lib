<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: two_d_poisson.cc Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get it <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/subversion/html/index.html">Get code from subversion repository</a></li>
            <li><a href="../../../../doc/download/html/index.html">Get code as tar file</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ddb094a380b94394dbbcf95a63b535e6.html">demo_drivers</a></li><li class="navelem"><a class="el" href="dir_5e95af49491505dfde4ba94a1a4cc2d9.html">poisson</a></li><li class="navelem"><a class="el" href="dir_72c27b1371898755d8f679b9760698c7.html">two_d_poisson</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">two_d_poisson.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="two__d__poisson_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//LIC// ====================================================================</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//LIC// This file forms part of oomph-lib, the object-oriented, </span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//LIC// multi-physics finite-element library, available </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//LIC// at http://www.oomph-lib.org.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//LIC// Copyright (C) 2006-2021 Matthias Heil and Andrew Hazel</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//LIC// This library is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//LIC// modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//LIC// License as published by the Free Software Foundation; either</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//LIC// version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//LIC// This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//LIC// Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//LIC// You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//LIC// License along with this library; if not, write to the Free Software</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//LIC// 02110-1301  USA.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//LIC// The authors may be contacted at oomph-lib@maths.man.ac.uk.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//LIC// </span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//LIC//====================================================================</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//Driver for a simple 2D poisson problem</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//Generic routines</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;generic.h&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// The Poisson equations</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;poisson.h&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">// The mesh</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;meshes/simple_rectangular_quadmesh.h&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">using namespace </span>oomph;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//===== start_of_namespace=============================================</span><span class="comment"></span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">/// Namespace for exact solution for Poisson equation with &quot;sharp step&quot; </span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"></span><span class="comment">//=====================================================================</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="namespaceTanhSolnForPoisson.html">   45</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceTanhSolnForPoisson.html">TanhSolnForPoisson</a></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> /// Parameter for steepness of &quot;step&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">   49</a></span>&#160;<span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>=1.0;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> /// Parameter for angle Phi of &quot;step&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">   52</a></span>&#160;<span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>=0.0;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> /// Exact solution as a Vector</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">   55</a></span>&#160;<span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">get_exact_u</a>(<span class="keyword">const</span> Vector&lt;double&gt;&amp; x, Vector&lt;double&gt;&amp; u)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  u[0]=tanh(1.0-<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1]));</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> /// Source function required to make the solution above an exact solution </span></div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="namespaceTanhSolnForPoisson.html#a967bc28320e02534beb714846b63e251">   61</a></span>&#160;<span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceTanhSolnForPoisson.html#a967bc28320e02534beb714846b63e251">source_function</a>(<span class="keyword">const</span> Vector&lt;double&gt;&amp; x, <span class="keywordtype">double</span>&amp; source)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  source = 2.0*tanh(-1.0+<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1]))*</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;   (1.0-pow(tanh(-1.0+<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1])),2.0))*</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>+2.0*tanh(-1.0+<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1]))*</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   (1.0-pow(tanh(-1.0+<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1])),2.0))*<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;} <span class="comment">// end of namespace</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">//====== start_of_problem_class=======================================</span><span class="comment"></span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">/// 2D Poisson problem on rectangular domain, discretised with</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/// 2D QPoisson elements. The specific type of element is</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">/// specified via the template parameter.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"></span><span class="comment">//====================================================================</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt; </div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="classPoissonProblem.html">   84</a></span>&#160;<span class="keyword">class </span><a class="code" href="classPoissonProblem.html">PoissonProblem</a> : <span class="keyword">public</span> Problem</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> /// Constructor: Pass pointer to source function</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span> <a class="code" href="classPoissonProblem.html">PoissonProblem</a>(PoissonEquations&lt;2&gt;::PoissonSourceFctPt source_fct_pt);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> /// Destructor (empty)</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="classPoissonProblem.html#ac247e42d2d292200617f4b9db7ed1ab8">   93</a></span>&#160;<span class="comment"></span> <a class="code" href="classPoissonProblem.html#ac247e42d2d292200617f4b9db7ed1ab8">~PoissonProblem</a>(){}</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> /// \short Update the problem specs before solve: Reset boundary conditions</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> /// to the values from the exact solution.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"></span> <span class="keywordtype">void</span> actions_before_newton_solve();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> /// Update the problem after solve (empty)</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="classPoissonProblem.html#a7a9478d8e1e5c7d3a886b00ab7d50bbd">  100</a></span>&#160;<span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classPoissonProblem.html#a7a9478d8e1e5c7d3a886b00ab7d50bbd">actions_after_newton_solve</a>(){}</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> /// \short Doc the solution. DocInfo object stores flags/labels for where the</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"> /// output gets written to</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"></span> <span class="keywordtype">void</span> doc_solution(DocInfo&amp; doc_info);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> /// Pointer to source function</span></div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="classPoissonProblem.html#a2ba5bb705abab012b72bbd7f4016d5fe">  109</a></span>&#160;<span class="comment"></span> PoissonEquations&lt;2&gt;::PoissonSourceFctPt <a class="code" href="classPoissonProblem.html#a2ba5bb705abab012b72bbd7f4016d5fe">Source_fct_pt</a>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}; <span class="comment">// end of problem class</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">//=====start_of_constructor===============================================</span><span class="comment"></span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">/// Constructor for Poisson problem: Pass pointer to source function.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<a class="code" href="classPoissonProblem.html#a9c28346c473d246d8f61022365e742ea">PoissonProblem&lt;ELEMENT&gt;::</a></div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="classPoissonProblem.html#a9c28346c473d246d8f61022365e742ea">  121</a></span>&#160;<a class="code" href="classPoissonProblem.html#a9c28346c473d246d8f61022365e742ea">      PoissonProblem</a>(PoissonEquations&lt;2&gt;::PoissonSourceFctPt source_fct_pt)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;       :  Source_fct_pt(source_fct_pt)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;{ </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; <span class="comment">// Setup mesh</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; <span class="comment">// # of elements in x-direction</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; <span class="keywordtype">unsigned</span> n_x=4;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; <span class="comment">// # of elements in y-direction</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; <span class="keywordtype">unsigned</span> n_y=4;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; <span class="comment">// Domain length in x-direction</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; <span class="keywordtype">double</span> l_x=1.0;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; <span class="comment">// Domain length in y-direction</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; <span class="keywordtype">double</span> l_y=2.0;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; <span class="comment">// Build and assign mesh</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; Problem::mesh_pt() = <span class="keyword">new</span> SimpleRectangularQuadMesh&lt;ELEMENT&gt;(n_x,n_y,l_x,l_y);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; <span class="comment">// Set the boundary conditions for this problem: All nodes are</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; <span class="comment">// free by default -- only need to pin the ones that have Dirichlet conditions</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; <span class="comment">// here. </span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; <span class="keywordtype">unsigned</span> n_bound = mesh_pt()-&gt;nboundary();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>=0;<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>&lt;n_bound;<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>++)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   <span class="keywordtype">unsigned</span> n_node = mesh_pt()-&gt;nboundary_node(<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> n=0;n&lt;n_node;n++)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;     mesh_pt()-&gt;boundary_node_pt(<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>,n)-&gt;pin(0); </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; <span class="comment">// Complete the build of all elements so they are fully functional</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; <span class="comment">// Loop over the elements to set up element-specific </span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; <span class="comment">// things that cannot be handled by the (argument-free!) ELEMENT </span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; <span class="comment">// constructor: Pass pointer to source function</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; <span class="keywordtype">unsigned</span> n_element = mesh_pt()-&gt;nelement();</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>=0;<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>&lt;n_element;<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>++)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   <span class="comment">// Upcast from GeneralsedElement to the present element</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   ELEMENT *el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(mesh_pt()-&gt;element_pt(<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>));</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;   <span class="comment">//Set the source function pointer</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;   el_pt-&gt;source_fct_pt() = <a class="code" href="classPoissonProblem.html#a2ba5bb705abab012b72bbd7f4016d5fe">Source_fct_pt</a>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; <span class="comment">// Setup equation numbering scheme</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; cout &lt;&lt;<span class="stringliteral">&quot;Number of equations: &quot;</span> &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;} <span class="comment">// end of constructor</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">//========================================start_of_actions_before_newton_solve===</span><span class="comment"></span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">/// Update the problem specs before solve: (Re-)set boundary conditions</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">/// to the values from the exact solution.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="classPoissonProblem.html#a398608a5ff73b74c5a387b3f794c58df">  183</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classPoissonProblem.html#a398608a5ff73b74c5a387b3f794c58df">PoissonProblem&lt;ELEMENT&gt;::actions_before_newton_solve</a>()</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; <span class="comment">// How many boundaries are there?</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; <span class="keywordtype">unsigned</span> n_bound = mesh_pt()-&gt;nboundary();</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; <span class="comment">//Loop over the boundaries</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>=0;<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>&lt;n_bound;<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>++)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;   <span class="comment">// How many nodes are there on this boundary?</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   <span class="keywordtype">unsigned</span> n_node = mesh_pt()-&gt;nboundary_node(<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="comment">// Loop over the nodes on boundary</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> n=0;n&lt;n_node;n++)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;     <span class="comment">// Get pointer to node</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;     Node* nod_pt=mesh_pt()-&gt;boundary_node_pt(<a class="code" href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a>,n);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;     <span class="comment">// Extract nodal coordinates from node:</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;     Vector&lt;double&gt; x(2);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;     x[0]=nod_pt-&gt;x(0);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;     x[1]=nod_pt-&gt;x(1);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;     <span class="comment">// Compute the value of the exact solution at the nodal point</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;     Vector&lt;double&gt; u(1);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;     <a class="code" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">TanhSolnForPoisson::get_exact_u</a>(x,u);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;     <span class="comment">// Assign the value to the one (and only) nodal value at this node</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;     nod_pt-&gt;set_value(0,u[0]);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  } </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;}  <span class="comment">// end of actions before solve</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">//===============start_of_doc=============================================</span><span class="comment"></span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">/// Doc the solution: doc_info contains labels/output directory etc.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="classPoissonProblem.html#aab6f503fa242f687bb8452527bb7688f">  221</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classPoissonProblem.html#aab6f503fa242f687bb8452527bb7688f">PoissonProblem&lt;ELEMENT&gt;::doc_solution</a>(DocInfo&amp; doc_info)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;{ </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; ofstream some_file;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; <span class="keywordtype">char</span> filename[100];</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; <span class="comment">// Number of plot points: npts x npts</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; <span class="keywordtype">unsigned</span> npts=5;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; <span class="comment">// Output solution </span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; <span class="comment">//-----------------</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; sprintf(filename,<span class="stringliteral">&quot;%s/soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;         doc_info.number());</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; some_file.open(filename);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; mesh_pt()-&gt;output(some_file,npts);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; some_file.close();</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; <span class="comment">// Output exact solution </span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; <span class="comment">//----------------------</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; sprintf(filename,<span class="stringliteral">&quot;%s/exact_soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;         doc_info.number());</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; some_file.open(filename);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; mesh_pt()-&gt;output_fct(some_file,npts,<a class="code" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">TanhSolnForPoisson::get_exact_u</a>); </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; some_file.close();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; <span class="comment">// Doc error and return of the square of the L2 error</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; <span class="comment">//---------------------------------------------------</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; <span class="keywordtype">double</span> error,norm;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; sprintf(filename,<span class="stringliteral">&quot;%s/error%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;         doc_info.number());</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; some_file.open(filename);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; mesh_pt()-&gt;compute_error(some_file,<a class="code" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">TanhSolnForPoisson::get_exact_u</a>,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                          error,norm); </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; some_file.close();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; <span class="comment">// Doc L2 error and norm of solution</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; cout &lt;&lt; <span class="stringliteral">&quot;\nNorm of error   : &quot;</span> &lt;&lt; sqrt(error) &lt;&lt; std::endl; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; cout &lt;&lt; <span class="stringliteral">&quot;Norm of solution: &quot;</span> &lt;&lt; sqrt(norm) &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;} <span class="comment">// end of doc</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">//===== start_of_main=====================================================</span><span class="comment"></span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">/// Driver code for 2D Poisson problem</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="two__d__poisson_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">  271</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="two__d__poisson_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;{</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; <span class="comment">//Set up the problem</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; <span class="comment">//------------------</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; <span class="comment">// Create the problem with 2D nine-node elements from the</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; <span class="comment">// QPoissonElement family. Pass pointer to source function. </span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; <a class="code" href="classPoissonProblem.html">PoissonProblem&lt;QPoissonElement&lt;2,3&gt;</a> &gt; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="two__d__poisson_8txt.html#a4074baada03976c061d5672f4237cca5">problem</a>(&amp;<a class="code" href="namespaceTanhSolnForPoisson.html#a967bc28320e02534beb714846b63e251">TanhSolnForPoisson::source_function</a>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; <span class="comment">// Create label for output</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; <span class="comment">//------------------------</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; DocInfo doc_info;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; <span class="comment">// Set output directory</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; doc_info.set_directory(<span class="stringliteral">&quot;RESLT&quot;</span>);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; <span class="comment">// Step number</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; doc_info.number()=0;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; <span class="comment">// Check that we&#39;re ready to go:</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; <span class="comment">//----------------------------</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; cout &lt;&lt; <span class="stringliteral">&quot;\n\n\nProblem self-test &quot;</span>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; <span class="keywordflow">if</span> (<a class="code" href="two__d__poisson_8txt.html#a4074baada03976c061d5672f4237cca5">problem</a>.self_test()==0) </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   cout &lt;&lt; <span class="stringliteral">&quot;passed: Problem can be solved.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keywordflow">throw</span> OomphLibError(<span class="stringliteral">&quot;Self test failed&quot;</span>,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                       OOMPH_CURRENT_FUNCTION,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                       OOMPH_EXCEPTION_LOCATION);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; <span class="comment">// Set the orientation of the &quot;step&quot; to 45 degrees</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; <a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanhSolnForPoisson::TanPhi</a>=1.0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; <span class="comment">// Initial value for the steepness of the &quot;step&quot;</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">TanhSolnForPoisson::Alpha</a>=1.0; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; <span class="comment">// Do a couple of solutions for different forcing functions</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; <span class="comment">//---------------------------------------------------------</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; <span class="keywordtype">unsigned</span> nstep=4;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> istep=0;istep&lt;nstep;istep++)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;   <span class="comment">// Increase the steepness of the step:</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;   <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">TanhSolnForPoisson::Alpha</a>+=1.0;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   cout &lt;&lt; <span class="stringliteral">&quot;\n\nSolving for TanhSolnForPoisson::Alpha=&quot;</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        &lt;&lt; <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">TanhSolnForPoisson::Alpha</a> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="comment">// Solve the problem</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <a class="code" href="two__d__poisson_8txt.html#a4074baada03976c061d5672f4237cca5">problem</a>.newton_solve();</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="comment">//Output the solution</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <a class="code" href="two__d__poisson_8txt.html#a4074baada03976c061d5672f4237cca5">problem</a>.doc_solution(doc_info);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   <span class="comment">//Increment counter for solutions </span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   doc_info.number()++;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;} <span class="comment">//end of main</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespaceTanhSolnForPoisson_html_a967bc28320e02534beb714846b63e251"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html#a967bc28320e02534beb714846b63e251">TanhSolnForPoisson::source_function</a></div><div class="ttdeci">void source_function(const Vector&lt; double &gt; &amp;x, double &amp;source)</div><div class="ttdoc">Source function required to make the solution above an exact solution.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00061">two_d_poisson.cc:61</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html_a785ccd00a727125a5138fbbcac173294"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanhSolnForPoisson::TanPhi</a></div><div class="ttdeci">double TanPhi</div><div class="ttdoc">Parameter for angle Phi of &quot;step&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00052">two_d_poisson.cc:52</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_aab6f503fa242f687bb8452527bb7688f"><div class="ttname"><a href="classPoissonProblem.html#aab6f503fa242f687bb8452527bb7688f">PoissonProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(DocInfo &amp;doc_info)</div><div class="ttdoc">Doc the solution. DocInfo object stores flags/labels for where the output gets written to.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00221">two_d_poisson.cc:221</a></div></div>
<div class="ttc" id="atwo__d__poisson_8txt_html_a4074baada03976c061d5672f4237cca5"><div class="ttname"><a href="two__d__poisson_8txt.html#a4074baada03976c061d5672f4237cca5">problem</a></div><div class="ttdeci">mainpage Demo problem</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8txt_source.html#l00002">two_d_poisson.txt:2</a></div></div>
<div class="ttc" id="atwo__d__poisson_8txt_html_aa166dca8d99a7a36f016ae036351695c"><div class="ttname"><a href="two__d__poisson_8txt.html#aa166dca8d99a7a36f016ae036351695c">i</a></div><div class="ttdeci">1}^2 \frac{\partial^2u}{\partial x_i^2}=f(x_1, x_2), \ \ \ \ \ \ \ \ \ \ @E[2DPoisson]@ \f] in the rectangular domain \f $D=\left\{(x_1, x_2) \in[0, 1] \times[0, 2]\right\}\f$, with Dirichlet boundary conditions \f[\left. u\right|_{\partial D}=u_0 \ \ \ \ \ \ \ \ \ \ @E[2DPoisson_BC]@ \f] where the function \f$ u_0 \f$ is given.&lt;/TD &gt;&lt;/TR &gt;&lt;/TABLE &gt;&lt;/CENTER &gt; We provide a detailed discussion of the driver code&lt; A HREF=&quot;../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson.cc&quot;&gt; two_d_poisson.cc&lt;/A &gt; which solves the problem for \f[u_0(x_1, x_2)=\tanh(1-\alpha(x_1 \tan\Phi - x_2)), \ \ \ \ \ \ \ \ \ @E[ExactSoln]@ \f] and \f[f(x_1, x_2)=\sum_{i=1}^2 \frac{\partial^2 u_0}{\partial x_i^2}, \ \ \ \ \ \ \ \ \ @E[SourceFct]@ \f] so that \f $u_0(x_1, x_2) \f$ represents the exact solution of the problem. For large values of \f$ \alpha \f$ the solution approaches a step function \f[u_{step}(x_1, x_2)=\left\{ \begin{array}{rl} -1 &amp;\mbox {for $x_2&lt; x_1 \ \tan\Phi$} \\ 1 &amp;\mbox {for $x_2 &gt; x_1 \ \tan\Phi$} \end{array} \right. \f] which presents a serious challenge for any numerical method. The figure below compares the numerical and exact solutions for \f$ \alpha=1 \f$ and \f$\Phi=45^o\f$. @I w 0.75\textwidth two_d_poisson_soln &quot;Plot of the solution &quot;&lt; HR &gt;&lt; HR &gt; \section global Global parameters and functions Following our usual practice, we use a namespace, \c TanhSolnForPoisson, to define the source function( @R[SourceFct]@) and the exact solution( @R[ExactSoln]@). Both functions permit arbitrary values of the tangent \f$ \tan \Phi \f$ and the steepness parameter \f$ \alpha \f$, which are stored in TanhSolnForPoisson::TanPhi and TanhSolnForPoisson::Alpha, respectively, so that the &quot;user&quot; can set their values from the driver code. \dontinclude two_d_poisson.cc \skipline start_of_namespace \until end of namespace&lt; HR &gt;&lt; HR &gt; \section main The driver code In order to solve the 2D Poisson problem using \c oomph-lib, we represent the mathematical problem defined by equations( @R[2DPoisson]@) and( @R[2DPoisson_BC]@) in a specific \c Problem object, \c PoissonProblem. \c oomph-lib provides a variety of 2D Poisson elements(e.g. 2D quadrilateral elements with bi-linear, bi-quadratic and bi-cubic representations for the unknown function) and we pass the specific element type as a template parameter to the \c Problem. In the driver code, listed below, we use the \c QPoissonElement&lt; 2, 3 &gt;, a nine-node(bi-quadratic) 2D Poisson element. The next few lines of the \c main() function create a \c DocInfo object -- an \c oomph-lib object that collates various items of data that can be used to label output files:Here we specify that the output files are to be written to the directory &quot;RESLT&quot;, and that the first batch of output files should be labelled with the identifier &quot;0&quot;. See the discussion of the postprocessing routine \c doc_solution(...) for details.[\b Note:While the ability to specify an output directory from the driver code is useful, it does rely on the &quot;user&quot; having created the directory before the code is executed. We could use the C++\c system(...) function to issue a system command which creates the directory if it does not exist. Since this would make the code non-portable, we only issue a warning suggesting the likely cause of the problem if the output file cannot be opened. If you want to make absolutely sure that the output directory does exist and can be written to, you can change this forgiving behaviour with the function \c DocInfo::directory_must_exist(). This function provides access to a boolean flag which is set to \c false by default. If set to \c true, the code execution terminates with \c assert(false) if the directory specified with \c DocInfo::set_directory(...) cannot be written to.] Next we execute the \c Problem::self_test() function to check whether the \c Problem has been correctly initialised. If this test is passed, we proceed to the solution. We choose the angle of the &quot;step&quot; as 45 degrees(corresponding to \f$ \tan \Phi=1 \f$) and then solve the problem for a number of values of the steepness parameter \f$ \alpha. \f$ We document each solution with the post-processing routine \c doc_solution(...) which accesses the step number and the output directory via the \c DocInfo object. \dontinclude two_d_poisson.cc \skipline start_of_main \until end of main&lt; HR &gt;&lt; HR &gt; \section problem The problem class The \c PoissonProblem is derived from \c oomph-lib 's generic \c Problem class and the specific element type is specified as a template parameter to make it easy for the &quot;user&quot; to change the element type from the driver code. \dontinclude two_d_poisson.cc \skipline start_of_problem_class \until public Problem The problem class has five member functions, only three of which are non-trivial:- the constructor \c PoissonProblem(...) - the function \c actions_before_newton_solve() - the function \c doc_solution(...) . The function \c Problem::actions_after_newton_solve() is a pure virtual member function of the \c Problem base class and must be provided. However, it is not required in the present problem and we leave it empty. Similarly, the problem destructor can remain empty as all memory de-allocation is handled in the destructor of the \c Problem base class. The Problem only stores one private data member, the pointer to the source function. \skipline public:\until end of problem class[See the discussion of the&lt; A HREF=&quot;../../../poisson/one_d_poisson/html/index.html&quot;&gt; 1D Poisson problem&lt;/A &gt; for a more detailed discussion of the function type PoissonEquations&lt; 2 &gt;::PoissonSourceFctPt.]&lt; HR &gt;&lt; HR &gt; \section constructor The Problem constructor In the \c Problem constructor, we start by discretising the rectangular domain, using \c oomph-lib 's \c SimpleRectangularQuadMesh object. The arguments of this object 's constructor are the number of elements(whose type is specified by the template parameter), and the domain lengths in the \f $x_1 \f$ and \f $x_2 \f$ directions, respectively. The subsequent lines of code pin the nodal values along the entire domain boundary. In the&lt; A HREF=&quot;../../../poisson/one_d_poisson/html/index.html&quot;&gt; 1D example&lt;/A &gt; considered earlier, the identification of the nodes on the domain boundaries was trivial. In higher-dimensional problems, this task can become rather involved. \c oomph-lib 's \c Mesh base class provides the helper function \c Mesh::boundary_node_pt(...) giving(pointer-based) access to nodes on specified mesh boundaries.[The total number of boundaries can be obtained from \c Mesh::nboundary(), while the number of nodes on a specific boundary is available from \c Mesh::nboundary_node(...).] The nested loops over the mesh boundaries and the nodes on these boundaries therefore provide a convenient and completely generic method of accessing all boundary nodes. Finally we loop over all elements to assign the source function pointer, and then call the generic \c Problem::assign_eqn_numbers() routine to set up the equation numbers. \skipline start_of_constructor \until end of constructor&lt; HR &gt;&lt; HR &gt; \section actions_before &quot;Actions before solve&quot; We use \c Problem::actions_before_newton_solve() to update the boundary conditions in response to possible changes in the problem parameters. We use the exact solution, specified in \c TanhSolnForPoisson::get_exact_u(...), to determine the boundary values that are appropriate for the current values of \f$ \alpha \f$ and \f$ \tan \Phi \f$. \skipline start_of_actions_before_newton_solve \until end of actions before solve[See the discussion of the&lt; A HREF=&quot;../../../poisson 1D Poisson problem&lt;/A&gt; for a more detailed discussion of the pure virtual functions \c Problem::actions_before_newton_solve() and \c Problem::actions_after_newton_solve().] &lt;HR&gt; &lt;HR&gt; \section doc Post-processing The function \c doc_solution(...) writes the FE solution and the corresponding exact solution, defined in \c TanhSolnForPoisson::get_exact_u(...) to disk. The \c DocInfo object specifies the output directory and the label for the file names. [See the discussion of the &lt;A HREF=&quot;../../../poisson/one_d_poisson/html/index.html&quot;&gt; 1D Poisson problem&lt;/A&gt; for a more detailed discussion of the generic \c Mesh member functions \c Mesh::output(...), \c Mesh::output_fct(...) and \c Mesh::compute_error(...)]. \skipline start_of_doc \until end of doc &lt;HR&gt; &lt;HR&gt; \section exercises Comments and exercises -# In its current form, the number of elements and the dimensions of the domain are hard-coded in the \c Problem constructor. Change the \c Problem constructor so that these quantities become input parameters that can be set from the \c main() function. -# Note how the accuracy of the FE solution decreases as the steepness of the &quot;step&quot; is increased: @I w 0.75\textwidth alpha &quot;Plot of the solution for different values of the steepness parameter &quot; How many elements are required to resolve the solution with \f$ \alpha = 10 \f$ as accurately as in the case of \f$ \alpha = 1\f$? [\b Note: Since the solution has steep gradients only in a very narrow region, uniform mesh refinement is an extremely wasteful method of improving the accuracy of the computed solution. \c oomph-lib provides powerful mesh adaptation routines which perform fully-automatic mesh refinement and unrefinement, based on a posteriori error estimates of the solution. We will demonstrate these in &lt;A HREF=&quot;../../../poisson/fish_poisson/html/index.html&quot;&gt; another example.&lt;/A&gt;] -# Repeat the numerical experiments with different element types. Replace the nine-node Poisson element, \c QPoissonElement&lt;2,3&gt;, by its lower- and higher-order counterparts \c QPoissonElement&lt;2,2&gt; and \c QPoissonElement&lt;2,4&gt;, respectively. Compare the total number of degrees of freedom, the errors, and the run-times for the different discretisations. \subsection precompile_mesh Header files and precompiled meshes We have repeatedly stressed that \c oomph-lib \c Mesh objects are (and any user-written ones should be) templated by the element type, so that meshes can be used with all finite elements that are derived from the same geometric element (2D quad elements from the \c QElement family, say). Typically, the element type is specified in the driver code. Consequently, the compiler must instantiate the \c Mesh object for a particular element type when the driver code is compiled -- there is no point in trying to &quot;pre-compile&quot; a \c Mesh object for &quot;all possible element types&quot;. The source code for \c Mesh objects is therefore usually contained in a single (header) file which must be included in the driver code. The first few lines of the driver code &lt;A HREF=&quot;../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson.cc&quot;&gt; two_d_poisson.cc&lt;/A&gt; illustrate the technique: \dontinclude two_d_poisson.cc \skipline Driver for \until meshes/simple The code uses objects from the \c generic and \c poisson libraries whose function prototypes are contained in the header files \c generic.h and \c poisson.h, located in the \c oomph-lib \c include directory. All objects in these libraries are fully instantiated and no re-compilation is required -- we simply link against the libraries which are located in \c oomph-lib's \c lib directory. The mesh header files (which include the entire source code for each mesh) are located in the include (sub-)directory \c include/meshes, and are included into the driver code with a C++ include directive While this strategy greatly facilitates code reuse, it can incur significant compile-time overheads as the (possibly very lengthy) mesh sources must be recompiled whenever the driver code is changed. During code development, this overhead can become unacceptable. To avoid the constant re-compilation of the mesh sources, all \c oomph-lib mesh objects are contained in two separate source files. In the case of the \c SimpleRectangularMesh, the class definition and function prototypes are contained in the small auxiliary header file \c simple_rectangular_quadmesh.template.h, while the actual function definitions are contained in \c simple_rectangular_quadmesh.template.cc. These are the only sources that the mesh-writer has to provide. The header file \c simple_rectangular_quadmesh.h is generated (automatically) by concatenating the two *.template.* files and all three files are contained in the mesh include directory. This allows the &quot;user&quot; to pre-compile the mesh for a specific element type (or for a range of specific elements) to produce a separate object file that can be linked against when the driver code is built. The procedure is illustrated in the alternative source code &lt;A HREF=&quot;../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson2.cc&quot;&gt; two_d_poisson2.cc&lt;/A&gt; and the associated mesh file, &lt;A HREF=&quot;../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson2_mesh.cc&quot;&gt; two_d_poisson2_mesh.cc&lt;/A&gt;. In the original version of the code, &lt;A HREF=&quot;../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson.cc&quot;&gt; two_d_poisson.cc&lt;/A&gt;, the mesh was instantiated with the element type \c QPoissonElement&lt;2,3&gt; and we will assume that this is the only element type required in the driver code. We force the instantiation of the \c SimpleRectangularQuadMesh for this element type by employing the C++ &quot;template&quot; statement in the mesh file, &lt;A HREF=&quot;../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson2_mesh.cc&quot;&gt; two_d_poisson2_mesh.cc&lt;/A&gt;, which is listed in its entirety here: \include two_d_poisson2_mesh.cc This source file can be pre-compiled into an object file, \c two_d_poisson2_mesh.o, say. The driver code only needs to include the templated header file (which contains the class definition and the function prototypes) so that the first few lines of the modified driver code look like this: \dontinclude two_d_poisson2.cc \skipline Driver for \until meshes/simple The driver code can now be compiled separately (without having to recompile the mesh sources every time) and the correctly instantiated version of the \c SimpleRectangularQuadMesh can be made available by including \c two_d_poisson2_mesh.o during the linking phase. \subsection different_solvers How to choose the linear solver for the Newton method \c oomph-lib treats all problems as nonlinear problems and provides steady (and unsteady) Newton solvers to solve the system of nonlinear algebraic equations that arise from the spatial (and temporal) discretisation of the governing equations. Typically, the repeated assembly of the Jacobian matrix and the solution of the linear systems during the Newton iteration provides the major part of the computational work. Within this framework linear problems are simply special cases of nonlinear problems for which the Newton method converges in one iteration. The assembly of the Jacobian matrix and the solution of the linear system is performed by \c oomph-lib's \c LinearSolver objects. These typically provide interfaces to general purpose linear solvers such as \c SuperLUSolver (our default solver). The list of solvers includes: - \c SuperLUSolver: An interface to Demmel, Eistenstat, Gilbert, Li &amp; Liu's serial SuperLU solver. See &lt;A HREF=&quot;http:http:- \c HSL_MA42:An interface to the MA42 frontal solver from the HSL library. See&lt; A HREF=&quot;http: http: for details. - \c FD_LU: An extremely inefficient solver which computes the Jacobian matrix by finite differencing and stores it in a dense matrix. This solver is mainly provided to facilitate sanity checks during code development. (The residuals are easier to compute than the the Jacobian matrix!) - ...and many others. See the &lt;a href=&quot;../../../linear_solvers/html/index.html&quot;&gt;Linear Solvers Tutorial&lt;/a&gt; for a more detailed discussion of \c oomph-lib's various direct and iterative solvers. . By default the \c oomph-lib Newton solvers use \c SuperLU with compressed row storage for the Jacobian matrix as the linear solver. To change the linear solver to another type you can over-write the \c Problem's pointer to its linear solver. For instance, to change the linear solver to \c HSL_MA42, add the following lines to the \c Problem constructor: \code Problem::linear_solver_pt() = new HSL_MA42 i</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8txt_source.html#l00408">two_d_poisson.txt:408</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_a7a9478d8e1e5c7d3a886b00ab7d50bbd"><div class="ttname"><a href="classPoissonProblem.html#a7a9478d8e1e5c7d3a886b00ab7d50bbd">PoissonProblem::actions_after_newton_solve</a></div><div class="ttdeci">void actions_after_newton_solve()</div><div class="ttdoc">Update the problem after solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00100">two_d_poisson.cc:100</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html"><div class="ttname"><a href="classPoissonProblem.html">PoissonProblem</a></div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00084">two_d_poisson.cc:84</a></div></div>
<div class="ttc" id="atwo__d__poisson_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="two__d__poisson_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdoc">Driver code for 2D Poisson problem.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00271">two_d_poisson.cc:271</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_a2ba5bb705abab012b72bbd7f4016d5fe"><div class="ttname"><a href="classPoissonProblem.html#a2ba5bb705abab012b72bbd7f4016d5fe">PoissonProblem::Source_fct_pt</a></div><div class="ttdeci">PoissonEquations&lt; 2 &gt;::PoissonSourceFctPt Source_fct_pt</div><div class="ttdoc">Pointer to source function.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00109">two_d_poisson.cc:109</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_ac247e42d2d292200617f4b9db7ed1ab8"><div class="ttname"><a href="classPoissonProblem.html#ac247e42d2d292200617f4b9db7ed1ab8">PoissonProblem::~PoissonProblem</a></div><div class="ttdeci">~PoissonProblem()</div><div class="ttdoc">Destructor (empty)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00093">two_d_poisson.cc:93</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_a398608a5ff73b74c5a387b3f794c58df"><div class="ttname"><a href="classPoissonProblem.html#a398608a5ff73b74c5a387b3f794c58df">PoissonProblem::actions_before_newton_solve</a></div><div class="ttdeci">void actions_before_newton_solve()</div><div class="ttdoc">Update the problem specs before solve: Reset boundary conditions to the values from the exact solutio...</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00183">two_d_poisson.cc:183</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_a9c28346c473d246d8f61022365e742ea"><div class="ttname"><a href="classPoissonProblem.html#a9c28346c473d246d8f61022365e742ea">PoissonProblem::PoissonProblem</a></div><div class="ttdeci">PoissonProblem(PoissonEquations&lt; 2 &gt;::PoissonSourceFctPt source_fct_pt)</div><div class="ttdoc">Constructor: Pass pointer to source function.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00121">two_d_poisson.cc:121</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html_ae676ccd186d5df119cce811596d949c1"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">TanhSolnForPoisson::Alpha</a></div><div class="ttdeci">double Alpha</div><div class="ttdoc">Parameter for steepness of &quot;step&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00049">two_d_poisson.cc:49</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html">TanhSolnForPoisson</a></div><div class="ttdoc">Namespace for exact solution for Poisson equation with &quot;sharp step&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00045">two_d_poisson.cc:45</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html_af7896e9c18ce6438c73ae2a875e8b7de"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">TanhSolnForPoisson::get_exact_u</a></div><div class="ttdeci">void get_exact_u(const Vector&lt; double &gt; &amp;x, Vector&lt; double &gt; &amp;u)</div><div class="ttdoc">Exact solution as a Vector.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00055">two_d_poisson.cc:55</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Jul 8 2021 23:04:00
        </div>
      </div>
    </footer>
</body>
</html>
