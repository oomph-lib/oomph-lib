<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: Demo problem: A two-dimensional Poisson problem</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Demo problem: A two-dimensional Poisson problem </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this document, we demonstrate how to solve a 2D Poisson problem using existing objects from the <code>oomph-lib</code> library: </p><center> <table class="doxtable">
<tr>
<td><center> <b>Two-dimensional model Poisson problem</b> </center> Solve <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \sum_{i=1}^2 \frac{\partial^2u}{\partial x_i^2} = f(x_1,x_2), \ \ \ \ \ \ \ \ \ \ (1) \]" src="form_0.png" width="170" height="38"/>
</p>
 in the rectangular domain <img class="formulaInl" alt="$D =\left\{ (x_1,x_2) \in [0,1] \times [0,2]\right\}$" src="form_1.png" width="160" height="14"/>, with Dirichlet boundary conditions <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \left. u\right|_{\partial D}=u_0 \ \ \ \ \ \ \ \ \ \ (2) \]" src="form_2.png" width="113" height="14"/>
</p>
 where the function <img class="formulaInl" alt="$ u_0 $" src="form_3.png" width="14" height="9"/> is given.   </td></tr>
</table>
<br  />
 </center><p>We provide a detailed discussion of the driver code <a href="../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson.cc">two_d_poisson.cc</a> which solves the problem for </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ u_0(x_1,x_2) = \tanh(1-\alpha(x_1 \tan\Phi - x_2)), \ \ \ \ \ \ \ \ \ (3) \]" src="form_4.png" width="274" height="14"/>
</p>
<p> and </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ f(x_1,x_2) = \sum_{i=1}^2 \frac{\partial^2 u_0}{\partial x_i^2}, \ \ \ \ \ \ \ \ \ (4) \]" src="form_5.png" width="171" height="38"/>
</p>
<p> so that <img class="formulaInl" alt="$u_0(x_1,x_2) $" src="form_6.png" width="54" height="14"/> represents the exact solution of the problem. For large values of <img class="formulaInl" alt="$ \alpha $" src="form_7.png" width="8" height="6"/> the solution approaches a step function </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ u_{step}(x_1,x_2) = \left\{ \begin{array}{rl} -1 &amp; \mbox {for $x_2 &lt; x_1 \ \tan\Phi$} \\ 1 &amp; \mbox {for $x_2 &gt; x_1 \ \tan\Phi$} \end{array} \right. \]" src="form_8.png" width="224" height="31"/>
</p>
<p> which presents a serious challenge for any numerical method. The figure below compares the numerical and exact solutions for <img class="formulaInl" alt="$ \alpha = 1 $" src="form_9.png" width="30" height="9"/> and <img class="formulaInl" alt="$\Phi = 45^o$" src="form_10.png" width="43" height="10"/>.</p>
<div class="image">
<img src="two_d_poisson_soln.gif" alt=""/>
<div class="caption">
Plot of the solution </div></div>
 <hr  />
<p> <br  />
 </p><hr  />
<h1><a class="anchor" id="global"></a>
Global parameters and functions</h1>
<p>Following our usual practice, we use a namespace, <code><a class="el" href="namespaceTanhSolnForPoisson.html" title="Namespace for exact solution for Poisson equation with &quot;sharp step&quot;.">TanhSolnForPoisson</a></code>, to define the source function (4) and the exact solution (3). Both functions permit arbitrary values of the tangent <img class="formulaInl" alt="$ \tan \Phi $" src="form_11.png" width="30" height="10"/> and the steepness parameter <img class="formulaInl" alt="$ \alpha $" src="form_7.png" width="8" height="6"/>, which are stored in <a class="el" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294" title="Parameter for angle Phi of &quot;step&quot;.">TanhSolnForPoisson::TanPhi</a> and <a class="el" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1" title="Parameter for steepness of &quot;step&quot;.">TanhSolnForPoisson::Alpha</a>, respectively, so that the "user" can set their values from the driver code.</p>
 <div class="fragment"><div class="line"><span class="comment">//===== start_of_namespace=============================================</span></div>
<div class="line"><span class="comment">/// Namespace for exact solution for Poisson equation with &quot;sharp step&quot; </span></div>
<div class="line"><span class="comment"></span><span class="comment">//=====================================================================</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceTanhSolnForPoisson.html">TanhSolnForPoisson</a></div>
<div class="line">{</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Parameter for steepness of &quot;step&quot;</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>=1.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Parameter for angle Phi of &quot;step&quot;</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">double</span> <a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>=0.0;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Exact solution as a Vector</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">get_exact_u</a>(<span class="keyword">const</span> Vector&lt;double&gt;&amp; x, Vector&lt;double&gt;&amp; u)</div>
<div class="line"> {</div>
<div class="line">  u[0]=tanh(1.0-<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1]));</div>
<div class="line"> }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Source function required to make the solution above an exact solution </span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="namespaceTanhSolnForPoisson.html#a967bc28320e02534beb714846b63e251">source_function</a>(<span class="keyword">const</span> Vector&lt;double&gt;&amp; x, <span class="keywordtype">double</span>&amp; source)</div>
<div class="line"> {</div>
<div class="line">  source = 2.0*tanh(-1.0+<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1]))*</div>
<div class="line">   (1.0-pow(tanh(-1.0+<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1])),2.0))*</div>
<div class="line">   <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>+2.0*tanh(-1.0+<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1]))*</div>
<div class="line">   (1.0-pow(tanh(-1.0+<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*(<a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanPhi</a>*x[0]-x[1])),2.0))*<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>*<a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">Alpha</a>;</div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of namespace</span></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html">TanhSolnForPoisson</a></div><div class="ttdoc">Namespace for exact solution for Poisson equation with &quot;sharp step&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00045">two_d_poisson.cc:46</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html_a785ccd00a727125a5138fbbcac173294"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanhSolnForPoisson::TanPhi</a></div><div class="ttdeci">double TanPhi</div><div class="ttdoc">Parameter for angle Phi of &quot;step&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00052">two_d_poisson.cc:52</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html_a967bc28320e02534beb714846b63e251"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html#a967bc28320e02534beb714846b63e251">TanhSolnForPoisson::source_function</a></div><div class="ttdeci">void source_function(const Vector&lt; double &gt; &amp;x, double &amp;source)</div><div class="ttdoc">Source function required to make the solution above an exact solution.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00061">two_d_poisson.cc:61</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html_ae676ccd186d5df119cce811596d949c1"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">TanhSolnForPoisson::Alpha</a></div><div class="ttdeci">double Alpha</div><div class="ttdoc">Parameter for steepness of &quot;step&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00049">two_d_poisson.cc:49</a></div></div>
<div class="ttc" id="anamespaceTanhSolnForPoisson_html_af7896e9c18ce6438c73ae2a875e8b7de"><div class="ttname"><a href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">TanhSolnForPoisson::get_exact_u</a></div><div class="ttdeci">void get_exact_u(const Vector&lt; double &gt; &amp;x, Vector&lt; double &gt; &amp;u)</div><div class="ttdoc">Exact solution as a Vector.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00055">two_d_poisson.cc:55</a></div></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="main"></a>
The driver code</h1>
<p>In order to solve the 2D Poisson problem using <code>oomph-lib</code>, we represent the mathematical problem defined by equations (1) and (2) in a specific <code>Problem</code> object, <code><a class="el" href="classPoissonProblem.html" title="2D Poisson problem on rectangular domain, discretised with 2D QPoisson elements. The specific type of...">PoissonProblem</a></code>. <code>oomph-lib</code> provides a variety of 2D Poisson elements (e.g. 2D quadrilateral elements with bi-linear, bi-quadratic and bi-cubic representations for the unknown function) and we pass the specific element type as a template parameter to the <code>Problem</code>. In the driver code, listed below, we use the <code>QPoissonElement&lt;2,3&gt;</code>, a nine-node (bi-quadratic) 2D Poisson element.</p>
<p>The next few lines of the <code><a class="el" href="two__d__poisson_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="Driver code for 2D Poisson problem.">main()</a></code> function create a <code>DocInfo</code> object &ndash; an <code>oomph-lib</code> object that collates various items of data that can be used to label output files: Here we specify that the output files are to be written to the directory "RESLT", and that the first batch of output files should be labelled with the identifier "0". See the discussion of the postprocessing routine <code>doc_solution(...)</code> for details. [<b>Note:</b> While the ability to specify an output directory from the driver code is useful, it does rely on the "user" having created the directory before the code is executed. We could use the C++ <code>system(...)</code> function to issue a system command which creates the directory if it does not exist. Since this would make the code non-portable, we only issue a warning suggesting the likely cause of the problem if the output file cannot be opened. If you want to make absolutely sure that the output directory does exist and can be written to, you can change this forgiving behaviour with the function <code>DocInfo::directory_must_exist()</code>. This function provides access to a boolean flag which is set to <code>false</code> by default. If set to <code>true</code>, the code execution terminates with <code>assert(false)</code> if the directory specified with <code>DocInfo::set_directory(...)</code> cannot be written to.]</p>
<p>Next we execute the <code>Problem::self_test()</code> function to check whether the <code>Problem</code> has been correctly initialised. If this test is passed, we proceed to the solution. We choose the angle of the "step" as 45 degrees (corresponding to <img class="formulaInl" alt="$ \tan \Phi = 1 $" src="form_12.png" width="53" height="10"/>) and then solve the problem for a number of values of the steepness parameter <img class="formulaInl" alt="$ \alpha. $" src="form_13.png" width="10" height="6"/> We document each solution with the post-processing routine <code>doc_solution(...)</code> which accesses the step number and the output directory via the <code>DocInfo</code> object.</p>
 <div class="fragment"><div class="line"><span class="comment">//===== start_of_main=====================================================</span></div>
<div class="line"><span class="comment">/// Driver code for 2D Poisson problem</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="two__d__poisson_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Set up the problem</span></div>
<div class="line"> <span class="comment">//------------------</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create the problem with 2D nine-node elements from the</span></div>
<div class="line"> <span class="comment">// QPoissonElement family. Pass pointer to source function. </span></div>
<div class="line"> <a class="code" href="classPoissonProblem.html">PoissonProblem&lt;QPoissonElement&lt;2,3&gt;</a> &gt; </div>
<div class="line">  problem(&amp;<a class="code" href="namespaceTanhSolnForPoisson.html#a967bc28320e02534beb714846b63e251">TanhSolnForPoisson::source_function</a>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Create label for output</span></div>
<div class="line"> <span class="comment">//------------------------</span></div>
<div class="line"> DocInfo doc_info;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set output directory</span></div>
<div class="line"> doc_info.set_directory(<span class="stringliteral">&quot;RESLT&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Step number</span></div>
<div class="line"> doc_info.number()=0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Check that we&#39;re ready to go:</span></div>
<div class="line"> <span class="comment">//----------------------------</span></div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;\n\n\nProblem self-test &quot;</span>;</div>
<div class="line"> <span class="keywordflow">if</span> (problem.self_test()==0) </div>
<div class="line">  {</div>
<div class="line">   cout &lt;&lt; <span class="stringliteral">&quot;passed: Problem can be solved.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line"> <span class="keywordflow">else</span> </div>
<div class="line">  {</div>
<div class="line">   <span class="keywordflow">throw</span> OomphLibError(<span class="stringliteral">&quot;Self test failed&quot;</span>,</div>
<div class="line">                       OOMPH_CURRENT_FUNCTION,</div>
<div class="line">                       OOMPH_EXCEPTION_LOCATION);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set the orientation of the &quot;step&quot; to 45 degrees</span></div>
<div class="line"> <a class="code" href="namespaceTanhSolnForPoisson.html#a785ccd00a727125a5138fbbcac173294">TanhSolnForPoisson::TanPhi</a>=1.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Initial value for the steepness of the &quot;step&quot;</span></div>
<div class="line"> <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">TanhSolnForPoisson::Alpha</a>=1.0; </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Do a couple of solutions for different forcing functions</span></div>
<div class="line"> <span class="comment">//---------------------------------------------------------</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> nstep=4;</div>
<div class="line"> <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> istep=0;istep&lt;nstep;istep++)</div>
<div class="line">  {</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Increase the steepness of the step:</span></div>
<div class="line">   <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">TanhSolnForPoisson::Alpha</a>+=1.0;</div>
<div class="line"> </div>
<div class="line">   cout &lt;&lt; <span class="stringliteral">&quot;\n\nSolving for TanhSolnForPoisson::Alpha=&quot;</span></div>
<div class="line">        &lt;&lt; <a class="code" href="namespaceTanhSolnForPoisson.html#ae676ccd186d5df119cce811596d949c1">TanhSolnForPoisson::Alpha</a> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Solve the problem</span></div>
<div class="line">   problem.newton_solve();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Output the solution</span></div>
<div class="line">   problem.doc_solution(doc_info);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Increment counter for solutions </span></div>
<div class="line">   doc_info.number()++;</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">} <span class="comment">//end of main</span></div>
<div class="ttc" id="aclassPoissonProblem_html"><div class="ttname"><a href="classPoissonProblem.html">PoissonProblem</a></div><div class="ttdoc">2D Poisson problem on rectangular domain, discretised with 2D QPoisson elements. The specific type of...</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00084">two_d_poisson.cc:85</a></div></div>
<div class="ttc" id="atwo__d__poisson_8cc_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="two__d__poisson_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdoc">Driver code for 2D Poisson problem.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00271">two_d_poisson.cc:271</a></div></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="problem"></a>
The problem class</h1>
<p>The <code><a class="el" href="classPoissonProblem.html" title="2D Poisson problem on rectangular domain, discretised with 2D QPoisson elements. The specific type of...">PoissonProblem</a></code> is derived from <code>oomph-lib's</code> generic <code>Problem</code> class and the specific element type is specified as a template parameter to make it easy for the "user" to change the element type from the driver code.</p>
 <div class="fragment"><div class="line"><span class="comment">//====== start_of_problem_class=======================================</span></div>
<div class="line"><span class="comment">/// 2D Poisson problem on rectangular domain, discretised with</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// 2D QPoisson elements. The specific type of element is</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// specified via the template parameter.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//====================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt; </div>
<div class="line"><span class="keyword">class </span><a class="code" href="classPoissonProblem.html">PoissonProblem</a> : <span class="keyword">public</span> Problem</div>
</div><!-- fragment --><p> The problem class has five member functions, only three of which are non-trivial:</p><ul>
<li>the constructor <code><a class="el" href="classPoissonProblem.html" title="2D Poisson problem on rectangular domain, discretised with 2D QPoisson elements. The specific type of...">PoissonProblem(...)</a></code> </li>
<li>the function <code>actions_before_newton_solve()</code> </li>
<li>the function <code>doc_solution(...)</code> </li>
</ul>
<p>The function <code>Problem::actions_after_newton_solve()</code> is a pure virtual member function of the <code>Problem</code> base class and must be provided. However, it is not required in the present problem and we leave it empty. Similarly, the problem destructor can remain empty as all memory de-allocation is handled in the destructor of the <code>Problem</code> base class. The Problem only stores one private data member, the pointer to the source function.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Constructor: Pass pointer to source function</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classPoissonProblem.html#a9c28346c473d246d8f61022365e742ea">PoissonProblem</a>(PoissonEquations&lt;2&gt;::PoissonSourceFctPt source_fct_pt);</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Destructor (empty)</span></div>
<div class="line"><span class="comment"></span> <a class="code" href="classPoissonProblem.html#ac247e42d2d292200617f4b9db7ed1ab8">~PoissonProblem</a>(){}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the problem specs before solve: Reset boundary conditions</span></div>
<div class="line"><span class="comment"> /// to the values from the exact solution.</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classPoissonProblem.html#a398608a5ff73b74c5a387b3f794c58df">actions_before_newton_solve</a>();</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Update the problem after solve (empty)</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classPoissonProblem.html#a7a9478d8e1e5c7d3a886b00ab7d50bbd">actions_after_newton_solve</a>(){}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Doc the solution. DocInfo object stores flags/labels for where the</span></div>
<div class="line"><span class="comment"> /// output gets written to</span></div>
<div class="line"><span class="comment"></span> <span class="keywordtype">void</span> <a class="code" href="classPoissonProblem.html#aab6f503fa242f687bb8452527bb7688f">doc_solution</a>(DocInfo&amp; doc_info);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> /// Pointer to source function</span></div>
<div class="line"><span class="comment"></span> PoissonEquations&lt;2&gt;::PoissonSourceFctPt <a class="code" href="classPoissonProblem.html#a2ba5bb705abab012b72bbd7f4016d5fe">Source_fct_pt</a>;</div>
<div class="line"> </div>
<div class="line">}; <span class="comment">// end of problem class</span></div>
<div class="ttc" id="aclassPoissonProblem_html_a2ba5bb705abab012b72bbd7f4016d5fe"><div class="ttname"><a href="classPoissonProblem.html#a2ba5bb705abab012b72bbd7f4016d5fe">PoissonProblem::Source_fct_pt</a></div><div class="ttdeci">PoissonEquations&lt; 2 &gt;::PoissonSourceFctPt Source_fct_pt</div><div class="ttdoc">Pointer to source function.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00109">two_d_poisson.cc:109</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_a398608a5ff73b74c5a387b3f794c58df"><div class="ttname"><a href="classPoissonProblem.html#a398608a5ff73b74c5a387b3f794c58df">PoissonProblem::actions_before_newton_solve</a></div><div class="ttdeci">void actions_before_newton_solve()</div><div class="ttdoc">Update the problem specs before solve: Reset boundary conditions to the values from the exact solutio...</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00183">two_d_poisson.cc:183</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_a7a9478d8e1e5c7d3a886b00ab7d50bbd"><div class="ttname"><a href="classPoissonProblem.html#a7a9478d8e1e5c7d3a886b00ab7d50bbd">PoissonProblem::actions_after_newton_solve</a></div><div class="ttdeci">void actions_after_newton_solve()</div><div class="ttdoc">Update the problem after solve (empty)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00100">two_d_poisson.cc:100</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_a9c28346c473d246d8f61022365e742ea"><div class="ttname"><a href="classPoissonProblem.html#a9c28346c473d246d8f61022365e742ea">PoissonProblem::PoissonProblem</a></div><div class="ttdeci">PoissonProblem(PoissonEquations&lt; 2 &gt;::PoissonSourceFctPt source_fct_pt)</div><div class="ttdoc">Constructor: Pass pointer to source function.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00120">two_d_poisson.cc:121</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_aab6f503fa242f687bb8452527bb7688f"><div class="ttname"><a href="classPoissonProblem.html#aab6f503fa242f687bb8452527bb7688f">PoissonProblem::doc_solution</a></div><div class="ttdeci">void doc_solution(DocInfo &amp;doc_info)</div><div class="ttdoc">Doc the solution. DocInfo object stores flags/labels for where the output gets written to.</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00221">two_d_poisson.cc:221</a></div></div>
<div class="ttc" id="aclassPoissonProblem_html_ac247e42d2d292200617f4b9db7ed1ab8"><div class="ttname"><a href="classPoissonProblem.html#ac247e42d2d292200617f4b9db7ed1ab8">PoissonProblem::~PoissonProblem</a></div><div class="ttdeci">~PoissonProblem()</div><div class="ttdoc">Destructor (empty)</div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson_8cc_source.html#l00093">two_d_poisson.cc:93</a></div></div>
</div><!-- fragment --><p> [See the discussion of the <a href="../../../poisson/one_d_poisson/html/index.html">1D Poisson problem</a> for a more detailed discussion of the function type PoissonEquations&lt;2&gt;::PoissonSourceFctPt.]</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="constructor"></a>
The Problem constructor</h1>
<p>In the <code>Problem</code> constructor, we start by discretising the rectangular domain, using <code>oomph-lib's</code> <code>SimpleRectangularQuadMesh</code> object. The arguments of this object's constructor are the number of elements (whose type is specified by the template parameter), and the domain lengths in the <img class="formulaInl" alt="$x_1 $" src="form_14.png" width="13" height="9"/> and <img class="formulaInl" alt="$x_2 $" src="form_15.png" width="13" height="9"/> directions, respectively.</p>
<p>The subsequent lines of code pin the nodal values along the entire domain boundary. In the <a href="../../../poisson/one_d_poisson/html/index.html">1D example</a> considered earlier, the identification of the nodes on the domain boundaries was trivial. In higher-dimensional problems, this task can become rather involved. <code>oomph-lib's</code> <code>Mesh</code> base class provides the helper function <code>Mesh::boundary_node_pt(...)</code> giving (pointer-based) access to nodes on specified mesh boundaries. [The total number of boundaries can be obtained from <code>Mesh::nboundary()</code>, while the number of nodes on a specific boundary is available from <code>Mesh::nboundary_node(...)</code>.] The nested loops over the mesh boundaries and the nodes on these boundaries therefore provide a convenient and completely generic method of accessing all boundary nodes.</p>
<p>Finally we loop over all elements to assign the source function pointer, and then call the generic <code>Problem::assign_eqn_numbers()</code> routine to set up the equation numbers.</p>
<div class="fragment"><div class="line"><span class="comment">//=====start_of_constructor===============================================</span></div>
<div class="line"><span class="comment">/// Constructor for Poisson problem: Pass pointer to source function.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><a class="code" href="classPoissonProblem.html#a9c28346c473d246d8f61022365e742ea">PoissonProblem&lt;ELEMENT&gt;::</a></div>
<div class="line"><a class="code" href="classPoissonProblem.html#a9c28346c473d246d8f61022365e742ea">      PoissonProblem</a>(PoissonEquations&lt;2&gt;::PoissonSourceFctPt source_fct_pt)</div>
<div class="line">       :  <a class="code" href="classPoissonProblem.html#a2ba5bb705abab012b72bbd7f4016d5fe">Source_fct_pt</a>(source_fct_pt)</div>
<div class="line">{ </div>
<div class="line"> <span class="comment">// Setup mesh</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// # of elements in x-direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_x=4;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// # of elements in y-direction</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_y=4;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Domain length in x-direction</span></div>
<div class="line"> <span class="keywordtype">double</span> l_x=1.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Domain length in y-direction</span></div>
<div class="line"> <span class="keywordtype">double</span> l_y=2.0;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Build and assign mesh</span></div>
<div class="line"> Problem::mesh_pt() = <span class="keyword">new</span> SimpleRectangularQuadMesh&lt;ELEMENT&gt;(n_x,n_y,l_x,l_y);</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Set the boundary conditions for this problem: All nodes are</span></div>
<div class="line"> <span class="comment">// free by default -- only need to pin the ones that have Dirichlet conditions</span></div>
<div class="line"> <span class="comment">// here. </span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_bound = mesh_pt()-&gt;nboundary();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_bound;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="keywordtype">unsigned</span> n_node = mesh_pt()-&gt;nboundary_node(i);</div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> n=0;n&lt;n_node;n++)</div>
<div class="line">    {</div>
<div class="line">     mesh_pt()-&gt;boundary_node_pt(i,n)-&gt;pin(0); </div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Complete the build of all elements so they are fully functional</span></div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Loop over the elements to set up element-specific </span></div>
<div class="line"> <span class="comment">// things that cannot be handled by the (argument-free!) ELEMENT </span></div>
<div class="line"> <span class="comment">// constructor: Pass pointer to source function</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_element = mesh_pt()-&gt;nelement();</div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_element;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// Upcast from GeneralsedElement to the present element</span></div>
<div class="line">   ELEMENT *el_pt = <span class="keyword">dynamic_cast&lt;</span>ELEMENT*<span class="keyword">&gt;</span>(mesh_pt()-&gt;element_pt(i));</div>
<div class="line"> </div>
<div class="line">   <span class="comment">//Set the source function pointer</span></div>
<div class="line">   el_pt-&gt;source_fct_pt() = <a class="code" href="classPoissonProblem.html#a2ba5bb705abab012b72bbd7f4016d5fe">Source_fct_pt</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Setup equation numbering scheme</span></div>
<div class="line"> cout &lt;&lt;<span class="stringliteral">&quot;Number of equations: &quot;</span> &lt;&lt; assign_eqn_numbers() &lt;&lt; std::endl; </div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of constructor</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="actions_before"></a>
"Actions before solve"</h1>
<p>We use <code>Problem::actions_before_newton_solve()</code> to update the boundary conditions in response to possible changes in the problem parameters. We use the exact solution, specified in <code>TanhSolnForPoisson::get_exact_u(...)</code>, to determine the boundary values that are appropriate for the current values of <img class="formulaInl" alt="$ \alpha $" src="form_7.png" width="8" height="6"/> and <img class="formulaInl" alt="$ \tan \Phi $" src="form_11.png" width="30" height="10"/>.</p>
<div class="fragment"><div class="line"><span class="comment">//========================================start_of_actions_before_newton_solve===</span></div>
<div class="line"><span class="comment">/// Update the problem specs before solve: (Re-)set boundary conditions</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// to the values from the exact solution.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classPoissonProblem.html#a398608a5ff73b74c5a387b3f794c58df">PoissonProblem&lt;ELEMENT&gt;::actions_before_newton_solve</a>()</div>
<div class="line">{</div>
<div class="line"> <span class="comment">// How many boundaries are there?</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> n_bound = mesh_pt()-&gt;nboundary();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">//Loop over the boundaries</span></div>
<div class="line"> <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0;i&lt;n_bound;i++)</div>
<div class="line">  {</div>
<div class="line">   <span class="comment">// How many nodes are there on this boundary?</span></div>
<div class="line">   <span class="keywordtype">unsigned</span> n_node = mesh_pt()-&gt;nboundary_node(i);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// Loop over the nodes on boundary</span></div>
<div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> n=0;n&lt;n_node;n++)</div>
<div class="line">    {</div>
<div class="line">     <span class="comment">// Get pointer to node</span></div>
<div class="line">     Node* nod_pt=mesh_pt()-&gt;boundary_node_pt(i,n);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Extract nodal coordinates from node:</span></div>
<div class="line">     Vector&lt;double&gt; x(2);</div>
<div class="line">     x[0]=nod_pt-&gt;x(0);</div>
<div class="line">     x[1]=nod_pt-&gt;x(1);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Compute the value of the exact solution at the nodal point</span></div>
<div class="line">     Vector&lt;double&gt; u(1);</div>
<div class="line">     <a class="code" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">TanhSolnForPoisson::get_exact_u</a>(x,u);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Assign the value to the one (and only) nodal value at this node</span></div>
<div class="line">     nod_pt-&gt;set_value(0,u[0]);</div>
<div class="line">    }</div>
<div class="line">  } </div>
<div class="line">}  <span class="comment">// end of actions before solve</span></div>
</div><!-- fragment --><p>[See the discussion of the <br  />
 <a href="../../../poisson//one_d_poisson/html/index.html">1D Poisson problem</a> for a more detailed discussion of the pure virtual functions <code>Problem::actions_before_newton_solve()</code> and <code>Problem::actions_after_newton_solve()</code>.]</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="doc"></a>
Post-processing</h1>
<p>The function <code>doc_solution(...)</code> writes the FE solution and the corresponding exact solution, defined in <code>TanhSolnForPoisson::get_exact_u(...)</code> to disk. The <code>DocInfo</code> object specifies the output directory and the label for the file names. [See the discussion of the <br  />
 <a href="../../../poisson/one_d_poisson/html/index.html">1D Poisson problem</a> for a more detailed discussion of the generic <code>Mesh</code> member functions <code>Mesh::output(...)</code>, <code>Mesh::output_fct(...)</code> and <code>Mesh::compute_error(...)</code>].</p>
<div class="fragment"><div class="line"><span class="comment">//===============start_of_doc=============================================</span></div>
<div class="line"><span class="comment">/// Doc the solution: doc_info contains labels/output directory etc.</span></div>
<div class="line"><span class="comment"></span><span class="comment">//========================================================================</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ELEMENT&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classPoissonProblem.html#aab6f503fa242f687bb8452527bb7688f">PoissonProblem&lt;ELEMENT&gt;::doc_solution</a>(DocInfo&amp; doc_info)</div>
<div class="line">{ </div>
<div class="line"> </div>
<div class="line"> ofstream some_file;</div>
<div class="line"> <span class="keywordtype">char</span> filename[100];</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Number of plot points: npts x npts</span></div>
<div class="line"> <span class="keywordtype">unsigned</span> npts=5;</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output solution </span></div>
<div class="line"> <span class="comment">//-----------------</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> mesh_pt()-&gt;output(some_file,npts);</div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Output exact solution </span></div>
<div class="line"> <span class="comment">//----------------------</span></div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/exact_soln%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> mesh_pt()-&gt;output_fct(some_file,npts,<a class="code" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">TanhSolnForPoisson::get_exact_u</a>); </div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Doc error and return of the square of the L2 error</span></div>
<div class="line"> <span class="comment">//---------------------------------------------------</span></div>
<div class="line"> <span class="keywordtype">double</span> error,norm;</div>
<div class="line"> sprintf(filename,<span class="stringliteral">&quot;%s/error%i.dat&quot;</span>,doc_info.directory().c_str(),</div>
<div class="line">         doc_info.number());</div>
<div class="line"> some_file.open(filename);</div>
<div class="line"> mesh_pt()-&gt;compute_error(some_file,<a class="code" href="namespaceTanhSolnForPoisson.html#af7896e9c18ce6438c73ae2a875e8b7de">TanhSolnForPoisson::get_exact_u</a>,</div>
<div class="line">                          error,norm); </div>
<div class="line"> some_file.close();</div>
<div class="line"> </div>
<div class="line"> <span class="comment">// Doc L2 error and norm of solution</span></div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;\nNorm of error   : &quot;</span> &lt;&lt; sqrt(error) &lt;&lt; std::endl; </div>
<div class="line"> cout &lt;&lt; <span class="stringliteral">&quot;Norm of solution: &quot;</span> &lt;&lt; sqrt(norm) &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// end of doc</span></div>
</div><!-- fragment --><hr  />
 <hr  />
<h1><a class="anchor" id="exercises"></a>
Comments and exercises</h1>
<ol type="1">
<li>In its current form, the number of elements and the dimensions of the domain are hard-coded in the <code>Problem</code> constructor. Change the <code>Problem</code> constructor so that these quantities become input parameters that can be set from the <code><a class="el" href="two__d__poisson_8cc.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="Driver code for 2D Poisson problem.">main()</a></code> function.</li>
<li>Note how the accuracy of the FE solution decreases as the steepness of the "step" is increased: <div class="image">
<img src="alpha.gif" alt=""/>
<div class="caption">
Plot of the solution for different values of the steepness parameter </div></div>
  How many elements are required to resolve the solution with <img class="formulaInl" alt="$ \alpha = 10 $" src="form_16.png" width="36" height="9"/> as accurately as in the case of <img class="formulaInl" alt="$ \alpha = 1$" src="form_17.png" width="30" height="9"/>? [<b>Note:</b> Since the solution has steep gradients only in a very narrow region, uniform mesh refinement is an extremely wasteful method of improving the accuracy of the computed solution. <code>oomph-lib</code> provides powerful mesh adaptation routines which perform fully-automatic mesh refinement and unrefinement, based on a posteriori error estimates of the solution. We will demonstrate these in <a href="../../../poisson/fish_poisson/html/index.html">another example.</a>]</li>
<li>Repeat the numerical experiments with different element types. Replace the nine-node Poisson element, <code>QPoissonElement&lt;2,3&gt;</code>, by its lower- and higher-order counterparts <code>QPoissonElement&lt;2,2&gt;</code> and <code>QPoissonElement&lt;2,4&gt;</code>, respectively. Compare the total number of degrees of freedom, the errors, and the run-times for the different discretisations.</li>
</ol>
<h2><a class="anchor" id="precompile_mesh"></a>
Header files and precompiled meshes</h2>
<p>We have repeatedly stressed that <code>oomph-lib</code> <code>Mesh</code> objects are (and any user-written ones should be) templated by the element type, so that meshes can be used with all finite elements that are derived from the same geometric element (2D quad elements from the <code>QElement</code> family, say). Typically, the element type is specified in the driver code. Consequently, the compiler must instantiate the <code>Mesh</code> object for a particular element type when the driver code is compiled &ndash; there is no point in trying to "pre-compile" a <code>Mesh</code> object for "all possible element types". The source code for <code>Mesh</code> objects is therefore usually contained in a single (header) file which must be included in the driver code. The first few lines of the driver code <a href="../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson.cc">two_d_poisson.cc</a> illustrate the technique:</p>
 <div class="fragment"><div class="line"><span class="comment">//Driver for a simple 2D poisson problem</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//Generic routines</span></div>
<div class="line"><span class="preprocessor">#include &quot;generic.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The Poisson equations</span></div>
<div class="line"><span class="preprocessor">#include &quot;poisson.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The mesh</span></div>
<div class="line"><span class="preprocessor">#include &quot;meshes/simple_rectangular_quadmesh.h&quot;</span></div>
</div><!-- fragment --><p> The code uses objects from the <code>generic</code> and <code>poisson</code> libraries whose function prototypes are contained in the header files <code>generic.h</code> and <code>poisson.h</code>, located in the <code>oomph-lib</code> <code>include</code> directory. All objects in these libraries are fully instantiated and no re-compilation is required &ndash; we simply link against the libraries which are located in <code>oomph-lib's</code> <code>lib</code> directory. The mesh header files (which include the entire source code for each mesh) are located in the include (sub-)directory <code>include/meshes</code>, and are included into the driver code with a C++ include directive</p>
<p>While this strategy greatly facilitates code reuse, it can incur significant compile-time overheads as the (possibly very lengthy) mesh sources must be recompiled whenever the driver code is changed. During code development, this overhead can become unacceptable. To avoid the constant re-compilation of the mesh sources, all <code>oomph-lib</code> mesh objects are contained in two separate source files. In the case of the <code>SimpleRectangularMesh</code>, the class definition and function prototypes are contained in the small auxiliary header file <code>simple_rectangular_quadmesh.template.h</code>, while the actual function definitions are contained in <code>simple_rectangular_quadmesh.template.cc</code>. These are the only sources that the mesh-writer has to provide. The header file <code>simple_rectangular_quadmesh.h</code> is generated (automatically) by concatenating the two *.template.* files and all three files are contained in the mesh include directory. This allows the "user" to pre-compile the mesh for a specific element type (or for a range of specific elements) to produce a separate object file that can be linked against when the driver code is built.</p>
<p>The procedure is illustrated in the alternative source code <br  />
 <a href="../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson2.cc">two_d_poisson2.cc</a> and the associated mesh file, <a href="../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson2_mesh.cc">two_d_poisson2_mesh.cc</a>. In the original version of the code, <a href="../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson.cc">two_d_poisson.cc</a>, the mesh was instantiated with the element type <code>QPoissonElement&lt;2,3&gt;</code> and we will assume that this is the only element type required in the driver code. We force the instantiation of the <code>SimpleRectangularQuadMesh</code> for this element type by employing the C++ "template" statement in the mesh file, <a href="../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson2_mesh.cc">two_d_poisson2_mesh.cc</a>, which is listed in its entirety here:</p>
<div class="fragment"><div class="line"><span class="comment">// LIC// ====================================================================</span></div>
<div class="line"><span class="comment">// LIC// This file forms part of oomph-lib, the object-oriented,</span></div>
<div class="line"><span class="comment">// LIC// multi-physics finite-element library, available</span></div>
<div class="line"><span class="comment">// LIC// at http://www.oomph-lib.org.</span></div>
<div class="line"><span class="comment">// LIC//</span></div>
<div class="line"><span class="comment">// LIC// Copyright (C) 2006-2024 Matthias Heil and Andrew Hazel</span></div>
<div class="line"><span class="comment">// LIC//</span></div>
<div class="line"><span class="comment">// LIC// This library is free software; you can redistribute it and/or</span></div>
<div class="line"><span class="comment">// LIC// modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment">// LIC// License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment">// LIC// version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment">// LIC//</span></div>
<div class="line"><span class="comment">// LIC// This library is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">// LIC// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">// LIC// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><span class="comment">// LIC// Lesser General Public License for more details.</span></div>
<div class="line"><span class="comment">// LIC//</span></div>
<div class="line"><span class="comment">// LIC// You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment">// LIC// License along with this library; if not, write to the Free Software</span></div>
<div class="line"><span class="comment">// LIC// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span></div>
<div class="line"><span class="comment">// LIC// 02110-1301  USA.</span></div>
<div class="line"><span class="comment">// LIC//</span></div>
<div class="line"><span class="comment">// LIC// The authors may be contacted at oomph-lib@maths.man.ac.uk.</span></div>
<div class="line"><span class="comment">// LIC//</span></div>
<div class="line"><span class="comment">// LIC//====================================================================</span></div>
<div class="line"><span class="comment">// Mesh builder: This builds the mesh with a specific element</span></div>
<div class="line"><span class="comment">// so that the mesh sources don&#39;t have to be re-compiled over</span></div>
<div class="line"><span class="comment">// and over again in the driver code... Useful strategy if</span></div>
<div class="line"><span class="comment">// the driver code is under development and uses a complicated</span></div>
<div class="line"><span class="comment">// mesh with long compile times</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Include Poisson elements/equations</span></div>
<div class="line"><span class="preprocessor">#include &quot;poisson.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Include the full source for mesh (this is the automatically generated</span></div>
<div class="line"><span class="comment">// combined header file that contains the templated header and the</span></div>
<div class="line"><span class="comment">// templated sources)</span></div>
<div class="line"><span class="preprocessor">#include &quot;meshes/simple_rectangular_quadmesh.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceoomph.html">oomph</a></div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Force build of specific mesh</span></div>
<div class="line">  <span class="keyword">template</span> <span class="keyword">class </span>SimpleRectangularQuadMesh&lt;QPoissonElement&lt;2, 3&gt;&gt;;</div>
<div class="line">} <span class="comment">// namespace oomph</span></div>
<div class="ttc" id="anamespaceoomph_html"><div class="ttname"><a href="namespaceoomph.html">oomph</a></div><div class="ttdef"><b>Definition:</b> <a href="two__d__poisson2__mesh_8cc_source.html#l00040">two_d_poisson2_mesh.cc:41</a></div></div>
</div><!-- fragment --><p>This source file can be pre-compiled into an object file, <code>two_d_poisson2_mesh.o</code>, say.</p>
<p>The driver code only needs to include the templated header file (which contains the class definition and the function prototypes) so that the first few lines of the modified driver code look like this:</p>
 <div class="fragment"><div class="line"><span class="comment">//Driver for a simple 2D poisson problem</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//Generic routines</span></div>
<div class="line"><span class="preprocessor">#include &quot;generic.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The Poisson equations</span></div>
<div class="line"><span class="preprocessor">#include &quot;poisson.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Include the templated mesh header only -- the mesh is</span></div>
<div class="line"><span class="comment">// precompiled and instantiated with the required element type</span></div>
<div class="line"><span class="comment">// in the separate file, two_d_poisson2_mesh.cc to avoid</span></div>
<div class="line"><span class="comment">// recompilation.</span></div>
<div class="line"><span class="preprocessor">#include &quot;meshes/simple_rectangular_quadmesh.template.h&quot;</span></div>
</div><!-- fragment --><p> The driver code can now be compiled separately (without having to recompile the mesh sources every time) and the correctly instantiated version of the <code>SimpleRectangularQuadMesh</code> can be made available by including <code>two_d_poisson2_mesh.o</code> during the linking phase.</p>
<h2><a class="anchor" id="different_solvers"></a>
How to choose the linear solver for the Newton method</h2>
<p><code>oomph-lib</code> treats all problems as nonlinear problems and provides steady (and unsteady) Newton solvers to solve the system of nonlinear algebraic equations that arise from the spatial (and temporal) discretisation of the governing equations. Typically, the repeated assembly of the Jacobian matrix and the solution of the linear systems during the Newton iteration provides the major part of the computational work. Within this framework linear problems are simply special cases of nonlinear problems for which the Newton method converges in one iteration. The assembly of the Jacobian matrix and the solution of the linear system is performed by <code>oomph-lib's</code> <code>LinearSolver</code> objects. These typically provide interfaces to general purpose linear solvers such as <code>SuperLUSolver</code> (our default solver). The list of solvers includes:</p><ul>
<li><code>SuperLUSolver:</code> An interface to Demmel, Eistenstat, Gilbert, Li &amp; Liu's serial SuperLU solver. See <a href="http://crd.lbl.gov/~xiaoye/SuperLU/">http://crd.lbl.gov/~xiaoye/SuperLU/</a> for details.</li>
<li><code>HSL_MA42:</code> An interface to the MA42 frontal solver from the HSL library. See <a href="http://www.hsl.rl.ac.uk/">http://www.hsl.rl.ac.uk</a> for details.</li>
<li><code>FD_LU:</code> An extremely inefficient solver which computes the Jacobian matrix by finite differencing and stores it in a dense matrix. This solver is mainly provided to facilitate sanity checks during code development. (The residuals are easier to compute than the the Jacobian matrix!)</li>
<li>...and many others. See the <a href="../../../linear_solvers/html/index.html">Linear Solvers Tutorial</a> for a more detailed discussion of <code>oomph-lib's</code> various direct and iterative solvers.</li>
</ul>
<p>By default the <code>oomph-lib</code> Newton solvers use <code>SuperLU</code> with compressed row storage for the Jacobian matrix as the linear solver. To change the linear solver to another type you can over-write the <code>Problem's</code> pointer to its linear solver. For instance, to change the linear solver to <code>HSL_MA42</code>, add the following lines to the <code>Problem</code> constructor:</p>
<div class="fragment"><div class="line"><span class="comment">/// Build a linear solver: Use HSL&#39;s MA42 frontal solver</span></div>
<div class="line"><span class="comment"></span>Problem::linear_solver_pt() = <span class="keyword">new</span> HSL_MA42;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/// Switch on full doc for frontal solver</span></div>
<div class="line"><span class="comment"></span><span class="keyword">static_cast&lt;</span>HSL_MA42*<span class="keyword">&gt;</span>(Problem::linear_solver_pt())-&gt;doc_stats()=<span class="keyword">true</span>;</div>
</div><!-- fragment --><p><code>HSL_MA42</code> can document various statistics such the memory usage etc. This is enabled with the second command. Other solvers have similar member functions. See the <a href="../../../the_data_structure/html/index.html">full documentation of all <code>oomph-lib</code> classes</a> for details.</p>
<p>We provide an example code <a href="../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson_compare_solvers.cc">two_d_poisson_compare_solvers.cc</a> which can be used to explore the performance of various linear solvers for the 2D Poisson problem considered above.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="sources"></a>
Source files for this tutorial</h1>
<ul>
<li>The source files for this tutorial are located in the directory: <center> <a href="../../../../demo_drivers/poisson/two_d_poisson/">demo_drivers/poisson/two_d_poisson/ </a> </center></li>
<li>The driver code is: <center> <a href="../../../../demo_drivers/poisson/two_d_poisson/two_d_poisson.cc">demo_drivers/poisson/two_d_poisson/two_d_poisson.cc </a> </center></li>
</ul>
<hr  />
 <hr  />
 <h1><a class="anchor" id="pdf"></a>
PDF file</h1>
<p>A <a href="../latex/refman.pdf">pdf version</a> of this document is available. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Thu Dec 19 2024 11:14:01
        </div>
      </div>
    </footer>
</body>
</html>
