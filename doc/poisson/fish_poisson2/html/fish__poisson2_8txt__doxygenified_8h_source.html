<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>oomph-lib: fish_poisson2.txt_doxygenified.h Source File</title>
<link rel="apple-touch-icon" sizes="57x57" href="../../../figures/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../figures/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../figures/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../figures/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../figures/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../figures/apple-touch-icon-120x120.png">
<link rel="icon" type="image/png" href="../../../figures/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../figures/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../figures/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="../../../figures/manifest.json">
<link rel="mask-icon" href="../../../figures/safari-pinned-tab.svg" color="#008000">
<link rel="shortcut icon" href="../../../figures/favicon.ico">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-config" content="../../../figures/browserconfig.xml">
<meta name="theme-color" content="#008000">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
<!-- Doxygen css-->
<!-- <link rel="stylesheet" type="text/css" href="doxygen.css"> -->
<!-- Bootstrap -->
<link href="../../../css/bootstrap.css" rel="stylesheet">
<!-- oomph-lib specific overrides -->
<link rel="stylesheet" type="text/css" href="../../../css/oomph_header.css">
</head>
<body>
<nav class="navbar navbar-default">
<div class="container">
<div class="container-fluid">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="../../../html/index.html"><img alt="oomph-lib" src="../../../figures/oomph_logo.png"></a>
  </div>
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="nav navbar-nav">          
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li class="dropdown-header">Big picture</li>
          <li><a href="../../../../doc/intro/html/index.html">The finite element method</a></li>
          <li><a href="../../../../doc/the_data_structure/html/index.html">The data structure</a></li>
          <li><a href="../../../../doc/quick_guide/html/index.html">Not-so-quick guide</a></li>
          <li><a href="../../../../doc/optimisation/html/index.html">Optimisation</a></li>
          <li><a href="../../../../doc/order_of_action_functions/html/index.html">Order of action functions</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Example codes and tutorials</li>
          <li><a href="../../../../doc/example_code_list/html/index.html">List of example codes and tutorials</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#meshes">Meshing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#solvers">Solvers</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#parallel">MPI parallel processing</a></li>
          <li><a href="../../../../doc/example_code_list/html/index.html#visualisation">Post-processing/visualisation</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Other</li>
          <li><a href="../../../../doc/change_log/html/index.html">Change log</a></li>
          <li><a href="../../../../doc/creating_doc/html/index.html">Creating documentation</a></li>
          <li><a href="../../../../doc/coding_conventions/html/index.html">Coding conventions</a></li>
          <li><a href="../../../../doc/index/html/index.html">Index</a></li>
          <li><a href="../../../../doc/FAQ/html/index.html">FAQ</a></li>
        </ul>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Installation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/the_distribution/html/index.html">Installation guide</a></li>
            <li><a href="../../../../doc/copyright/html/index.html">Copyright</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../../../../doc/people/html/index.html">People</a></li>            
            <li><a href="../../../../doc/contact/html/index.html">Contact/Get involved</a></li>
            <li><a href="../../../../doc/publications/html/index.html">Publications</a></li>
            <li><a href="../../../../doc/acknowledgements/html/index.html">Acknowledgements</a></li>
            <li><a href="../../../../doc/picture_show/index.html">Picture show</a></li>
          </ul>
        </li>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-search">
      <form class="navbar-form" role="search" action="../../../../doc/search_results/html/index.html">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search" name="q">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit">Go</button>
          </span>
        </div><!-- /input-group -->
       <!--<div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>-->
      </form>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</div>
</nav>
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">fish_poisson2.txt_doxygenified.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="fish__poisson2_8txt__doxygenified_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">\mainpage Demo problem: How to create refineable meshes in domains with curvilinear and/or moving boundaries</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">In an </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../doc/poisson/two_d_poisson_adapt/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">earlier example&lt;/A&gt; we demonstrated how easy it is to &quot;upgrade&quot; </span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">an existing quad mesh to a \c RefineableMesh that can be used</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">with \c oomph-lib&#39;s mesh adaptation routines. The &quot;upgrade&quot; </span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">was achieved by multiple inheritance: We combined the basic </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">(non-refineable) mesh object with \c oomph-lib&#39;s \c RefineableQuadMesh</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">-- a class that implements the required mesh adaptation procedures,</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">using  \c QuadTree - based refinement techniques for meshes</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">that contain quadrilateral elements. During the</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">refinement process, selected elements are split into four &quot;son&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">elements and the nodal values and coordinates of any newly created </span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">nodes are determined by interpolation from the &quot;father&quot; element.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">This procedure is perfectly adequate for problems with polygonal</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">domain boundaries in which the initial coarse mesh provides a</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">perfect representation of the domain. The situation is more</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">complicated in problems with curvilinear domain boundaries since</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">we must ensure that successive mesh refinements lead to an</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">increasingly accurate representation of the domain boundary.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">To illustrate these issues we (re-)consider the 2D Poisson problem</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">&lt;TABLE&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">&lt;TR&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">&lt;TD&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">&lt;B&gt;Two-dimensional model Poisson problem in a non-trivial domain&lt;/B&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">&lt;/CENTER&gt; </span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">Solve</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">\sum_{i=1}^2 \frac{\partial^2u}{\partial x_i^2} = -1,</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> \ \ \ \ \ \ \ \ \ \ (1)</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">in the fish-shaped domain \f$D_{fish} \f$ with homogeneous</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">Dirichlet boundary conditions</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">\left. u\right|_{\partial D_{fish}}=0.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">\ \ \ \ \ \ \ \ \ \ (2)</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">\f]</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">&lt;/TD&gt;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">&lt;/TR&gt;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">&lt;/TABLE&gt;  </span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">&lt;/CENTER&gt;  </span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">In Part 1 of this document we shall explain how \c oomph-lib&#39;s mesh </span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">adaptation procedures employ the \c Domain and \c MacroElement objects to adapt</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">meshes in domains with curvilinear  boundaries. In Part 2, </span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">we demonstrate how to create new \c Domain objects.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">\section adapt Part 1: Mesh adaptation in domains with curvilinear boundaries, using Domain and MacroElement objects</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">The plot below shows the domain  \f$D_{fish} \f$, represented by the</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">multi-coloured, shaded region and its (extremely coarse) </span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">discretisation with four four-node quad elements. The elements&#39; </span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">edges and nodes are shown in black.</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">\image html coarse_fish_mesh_and_domain.gif &quot;The fish-shaped domain and its discretisation with four four-node quad elements &quot; </span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">\image latex coarse_fish_mesh_and_domain.eps &quot;The fish-shaped domain and its discretisation with four four-node quad elements &quot; width=0.75\textwidth</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">Obviously, the curvilinear boundaries of the fish-shaped domain</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">(arcs of circles) are very poorly resolved by the elements&#39; straight</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">edges. Simple mesh adaptation, based on the techniques</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">described in the </span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../doc/poisson/two_d_poisson_adapt/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">earlier example&lt;/A&gt; will not result in convergence to the</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">exact solution since the refined mesh never approaches the exact</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">domain geometry:</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">\image html fish_poisson_soln_no_macro.gif &quot;Plot of the mesh adaptation without MacroElements &quot; </span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">\image latex fish_poisson_soln_no_macro.eps &quot;Plot of the mesh adaptation without MacroElements &quot; width=0.75\textwidth</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">To overcome this problem, the mesh adaptation routines must be given access to</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">an exact, analytical representation of the actual domain. This is</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">the purpose of \c oomph-lib&#39;s \c Domain object. A \c Domain</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">provides an analytical description of a mathematical</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">domain, by decomposing it into a number of so-called \c MacroElements.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">Each \c MacroElement provides a mapping between a set of local</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">and global coordinates \f$ {\bf r}_{macro}({\bf s})\f$ -- similar to the </span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">mapping between the local and global coordinates in a finite element. </span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">The key difference between the two types of element is that the</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">\c MacroElement mapping resolves curvilinear domain boundaries</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">exactly, whereas the finite element mapping interpolates the global coordinates</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">between the coordinates of its nodes. The topology of \c MacroElements </span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">mirrors that of the associated (geometric) finite elements: </span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">For instance, the \c QMacroElement family is the counterpart </span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">of the \c QElement family of geometric finite elements. Both are </span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">templated by the spatial dimension, and the local coordinates </span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">(in their right-handed local coordinate systems) are in the range </span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">between -1 and +1. </span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">  The different-coloured, shaded regions in the above sketch</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">represent the four two-dimensional \c QMacroElements </span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">by which the \c FishDomain represents the fish-shaped</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">domain \f$ D_{fish} \f$. For instance, \c MacroElement 0</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">(shown in orange) represents the lower half of the fish&#39;s body; </span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">within this \c MacroElement, the curved &quot;belly&quot; is represented by the line</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">\f$ {\bf r}_{macro}(s_0,s_1=-1)\f$ for \f$s_0\in[-1,1]\f$; the lower</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">&quot;jaw&quot; is represented by \f$ {\bf r}_{macro}(s_0=-1,s_1)\f$ </span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">for \f$s_1\in[-1,1]\f$; etc.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">To illustrate the use of \c MacroElements / \c Domains, </span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">the following code fragment (from  </span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../src/meshes/fish_mesh.template.cc&quot;&gt;fish_mesh.template.cc</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">&lt;/A&gt;) demonstrates how the constructor of the original, </span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">non-refineable \c FishMesh assigns the nodal positions. </span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">Each of the \c FishDomain&#39;s four \c</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">QMacroElements is associated with one of the four finite elements in the mesh.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">Since both types of elements are parametrised by the same</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">local coordinate systems, we determine the position of</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">the node that is located at \f$(s_0, s_1)\f$</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">(in the finite element&#39;s local coordinate system) from the </span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">corresponding \c MacroElement mapping, \f${\bf r}_{macro}(s_0, s_1)\f$:</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">\dontinclude fish_mesh.template.cc</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">\skipline Create elements</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">\until end of loop </span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">This technique ensures that the mesh&#39;s boundary nodes</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">are placed on the exact domain boundary when the mesh is created.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">  To retain this functionality during the mesh adaptation,</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">each \c FiniteElement provides storage for a pointer to an </span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">associated \c MacroElement. By default,  the \c MacroElement pointer </span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">is set to \c NULL, indicating that the element is not associated </span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">with a \c MacroElement. In that case, the coordinates of newly created </span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">nodes are determined by interpolation from the father element, as discussed</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">above. If the \c MacroElement pointer is non-\c NULL, the refinement process</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">refers to the element&#39;s \c MacroElement representation to determine</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">the new nodal positions.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">  To enable the mesh adaptation process to respect the domain&#39;s</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">curvilinear boundaries, each element in the coarse base mesh must </span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">therefore be given a pointer to its associated \c MacroElement,</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">e.g. by using the following loop:</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">\dontinclude fish_mesh.template.cc</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">\skipline Loop over all elements and set macro element pointer</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">\until }</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">Once the mesh is aware of the curvilinear boundaries, each level of </span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">mesh refinement produces a better representation of the </span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">curvilinear domain, ensuring the convergence to the exact solution:</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">\image html fish_poisson_adapt_soln.gif &quot;Plot of the mesh adaptation with MacroElements &quot; </span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">\image latex fish_poisson_adapt_soln.eps &quot;Plot of the mesh adaptation with MacroElements &quot; width=0.75\textwidth</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">The  results shown in this animation were computed with the demo code </span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/poisson/fish_poisson2/fish_poisson_adapt.cc&quot;&gt;</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">fish_poisson_adapt.cc&lt;/A&gt; -- a simple modification</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">of the code  </span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/poisson/fish_poisson/fish_poisson.cc&quot;&gt;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">fish_poisson.cc&lt;/A&gt; that we used in the</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../doc/poisson/fish_poisson/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">earlier example&lt;/A&gt;. The only difference between the two codes</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">is that in the present example, the \c FishDomain is discretised with </span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">four-node rather than nine-node \c RefineableQPoissonElements to </span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">highlight the inadequacy of the basic mesh refinement process.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">Note that, as a result of lower accuracy of the four-node elements,</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">we require a much finer discretisation in the interior of the domain. </span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">\section domain Part 2: How to represent domains with curvilinear boundaries by Domain and MacroElement objects</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">The above example demonstrated that &quot;upgrading&quot; existing </span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">meshes to \c RefineableMeshes that can be used with \c oomph-lib&#39;s</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">mesh adaptation procedures, can be achieved in two trivial steps:</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">-# Associate each \c RefineableQElement with a \c QuadTree --</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">   this can done completely automatically by calling the function</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">   \c RefineableQuadMesh::setup_quadtree_forest().</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">-# If the problem&#39;s domain has curvilinear boundaries, associate </span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">   each \c RefineableQElement with a \c MacroElement -- </span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">   defined in the \c Domain object that provides an     </span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">   analytical representation of the domain. </span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">. </span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">While this looks (and indeed is) impressively simple, we still have to </span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">explain how to create \c Domain objects. We start by introducing</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">yet another useful \c oomph-lib class, the \c GeomObject.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">\subsection geom_object The geometric object, GeomObject</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">As the name suggests, \c GeomObjects are \c oomph-lib objects that </span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">provide an analytical description/parametrisation of geometric</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">objects. Mathematically, \c GeomObjects define a mapping from </span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">a set of &quot;Lagrangian&quot; (intrinsic) coordinates to the global </span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">&quot;Eulerian&quot; coordinates of the object. The number of Lagrangian</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">and Eulerian coordinates can differ. For instance, the unit circle,</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">centred at the origin may be parametrised by a single coordinate, \f$ \xi</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">\f$ (representing the polar angle), as</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">{\bf r}_{circle} = </span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">\left( </span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">\cos \xi \\</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">\sin \xi</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">\right),</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">\f] </span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">while a 2D disk may be parametrised by two coordinates </span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"> \f$ \xi_1 \f$ and \f$ \xi_2 \f$ (representing the radius and the</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">polar angle, respectively) as</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">\f[</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">{\bf r}_{disk} = </span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">\xi_1 \left(</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">\begin{array}{c}</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">\cos \xi_2 \\</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">\sin \xi_2</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">\end{array}</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">\right).</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">\f] </span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">All specific \c GeomObjects must implement the pure virtual function</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">\c GeomObject::position(...) which computes the Eulerian</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">position vector \f$ {\bf r}\f$ as a function of the </span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">(vector of) Lagrangian coordinates \f$ {\bf \xi}\f$.</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">(The \c GeomObject base class also provides interfaces for</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">a multitude of other functions, such as functions that compute</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">the spatial and temporal derivatives of the position vector. </span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">These functions are implemented as &quot;broken&quot; virtual functions and </span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">their implementation is optional; see the </span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../doc/poisson/two_d_poisson_flux_bc/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">earlier example&lt;/A&gt; for a discussion of &quot;broken&quot; virtual functions.)</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">  Here is a complete example of a specific \c GeomObject:</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">\dontinclude fish_domain.cc</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">\skipline start_of_unit_circle</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">\until end of unit circle</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">[The dummy time-dependent version of the \c position(...) function is</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">required to stop the compiler from complaining about &quot;only partially </span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">overridden&quot; virtual functions]. </span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">\subsection domain_objects Domains</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">\c GeomObjects provide a natural way of representing a \c Domain&#39;s</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">curvilinear boundaries. For instance, the fish&#39;s body in  \f$</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">D_{fish}\f$ is bounded by two circular arcs. These may be</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">represented by \c GeomObjects of type \c Circle -- a slight generalisation</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">of the \c UnitCircle class shown above. The \c FishDomain constructor</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">therefore takes a pointer to a 2D \c GeomObject and the &quot;start&quot; </span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">and &quot;end&quot; values of the Lagrangian coordinate along this object. </span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">The \c GeomObject represents the curvilinear boundary </span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">of the fish&#39;s  (upper) body and the two coordinates represent the </span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">Lagrangian coordinates of the &quot;nose&quot; and the &quot;tail&quot; </span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">on this \c GeomObject, as shown in this sketch:</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">\image html fish_domain.gif &quot;The fish-shaped domain and its MacroElement-based representation by the FishDomain object. The arrows show the orientation of the MacroElements&#39; local coordinate systems. &quot; </span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">\image latex fish_domain.eps &quot;The fish-shaped domain and its MacroElement-based representation by the FishDomain object. The arrows show the orientation of the MacroElements&#39; local coordinate systems. &quot; width=0.75\textwidth</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">To construct a \c FishDomain whose curvilinear boundaries</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">are arcs of unit circles, centred at \f$ (x_0,x_1) = (1/2 , 0) \f$</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">we create a \c GeomObject of type \c Circle, passing the</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">appropriate parameters to its constructor:</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> // Fish back is a circle of radius 1, centred at (0.5,0.0)</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> double x_c=0.5;</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"> double y_c=0.0;</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"> double r_back=1.0;</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"> GeomObject* back_pt=new Circle(x_c,y_c,r_back);</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">Next, we pass the (pointer to the)  \c Circle object</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">to the constructor of the \c FishDomain, locating</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">the &quot;nose end&quot; of the fish&#39;s back at \f$\xi=2.4\f$ </span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">and  its &quot;tail end&quot; at \f$\xi=0.4\f$:</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment"> double xi_nose=2.6; </span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"> double xi_tail=0.4; </span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment"> Domain* domain_pt=new FishDomain(back_pt,xi_nose,xi_tail);</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"> To see how this works internally, let us have a look at the</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">\c FishDomain constructor. The constructor stores the </span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">pointer to the fish&#39;s &quot;back&quot;, and the start and end values of the</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">Lagrangian coordinates in the private data members \c Back_pt, </span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">\c Xi_nose and \c Xi_tail. Next we set some additional parameters,</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">that define the geometry (the mouth is located at the origin; </span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">the fin is a vertical line at \f$ x=1.7\f$, ranging from </span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">\f$ y=-0.9\f$ to  \f$ y=+0.9\f$). Finally, we allocate storage for </span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">the four \c MacroElements and build them. Note that the constructor </span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">of the \c MacroElement takes a pointer to the Domain, and the</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">\c MacroElement&#39;s number within that \c Domain:</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">\dontinclude fish_domain.h</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">\skipline Constructor: Pass pointer to GeomObject that </span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">\until end of constructor</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">Most of the remaining public member functions are equally</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">straightforward. We provide various access functions to the geometric parameters</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">such as \c X_mouth, etc -- we will not list these explicitly.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">All the &quot;real work&quot; is done in the implementation of the pure </span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">virtual function \c Domain::macro_element_boundary(...). Given </span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">- the number of the \c MacroElement in its \c Domain</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">- the direction of its boundary (N[orth], S[outh], E[ast], W[est],</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">  enumerated in the namespace \c QuadTreeNames)</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">this function must compute the vector \f$ {\bf r}(\zeta)\f$ to the </span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">\c MacroElement&#39;s boundary.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">Here \f$ \zeta \in [-1,1]\f$ is the 1D coordinate along the element</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">boundary, aligned with the direction of the \c </span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">MacroElement&#39;s 2D coordinates \f$(s_0,s_1) \f$ as indicated in this sketch:</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">\image html macro_element_sketch.gif &quot;Sketch illustrating the parametrisation of the MacroElement&#39;s four boundaries. &quot; </span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">\image latex macro_element_sketch.eps &quot;Sketch illustrating the parametrisation of the MacroElement&#39;s four boundaries. &quot; width=0.75\textwidth</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">Since the shape of the domain can evolve in time, the full interface </span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">for the function includes an additional parameter, \c t, </span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">which indicates the (discrete) time level at which the domain shape</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">is to be evaluated. If \c t=0 the function computes the domain shape</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">at the current time; if \c t&gt;0 it computes the shape at the \c t -th </span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">previous timestep. </span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">(&lt;A HREF=&quot;../../../unsteady_heat/two_d_unsteady_heat_ALE/html/index.html&quot;&gt;</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">Another example&lt;/A&gt; in which we solve the unsteady</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">heat equation in a moving domain, provides a a more detailed discussion of </span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">this aspect.) Here is the full</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">interface for the \c FishDomain::macro_element_boundary(...) function:</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">\skipline Vector repre</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">\until r);</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">The implementation of this function is the only tedious task that</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">needs to be performed by the &quot;mesh writer&quot;. Once </span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">\c Domain::macro_element_boundary(...) </span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">is implemented, the \c Domain&#39;s constituent \c MacroElements</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">can refer to this function to establish the positions of their</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">boundaries (recall that we passed the pointer to the \c Domain and</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">the \c MacroElement&#39;s number in the \c Domain to the \c MacroElement</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">constructor). The \c MacroElement::macro_map(...) functions</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">interpolate the position of the \c MacroElement&#39;s boundaries into their</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">interior. </span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">To illustrate the general procedure, here is the complete listing of </span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">the \c FishDomain::macro_element_boundary(...) function. </span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">The function employs switch statements to identify the private member functions</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">that provide the parametrisation of individual \c MacroElement</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">boundaries. Some of these functions are listed below.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">\dontinclude fish_domain.h</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">\skipline start_of_macro_element_boundary</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">\until end of macro_element_boundary</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">Here are a few of the private member functions that define individual </span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">\c MacroElement boundaries:</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">- The N[orthern] boundary</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">  of macro element 2 (which represents the upper body) </span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">  coincides with the domain boundary that is parametrised by the</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">  geometric object pointed to by \c Back_pt. The function </span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">  translates the coordinate \f$ \zeta \in [-1,1] \f$ to the</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">  Lagrangian coordinate \f$ \xi \in [\xi_{nose}, \xi_{tail}] \f$</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">  along the geometric object. We use this Lagrangian coordinate</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">  to obtain the position vector to the domain boundary via a call to the</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">  \c GeomObject::position(...) function of the geometric object </span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">  pointed to by \c Back_pt:</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">\dontinclude fish_domain.h</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">\skipline start_of_r_upper_body_N</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">\until  end of r_upper_body_N </span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">- The E[astern] boundary of macro element 2 is a straight vertical</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">  line from the &quot;tail end&quot; of the curved fish back to the</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">  x-axis: </span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">\dontinclude fish_domain.h</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">\skipline start_of_r_upper_body_E</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">\until  end of r_upper_body_E</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">- The S[outhern] boundary of macro element 2 is a straight horizontal</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">  line from the &quot;mouth&quot; to the end of the</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">  body: </span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">\dontinclude fish_domain.h</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">\skipline start_of_r_upper_body_S</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">\until  end of r_upper_body_S</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">- The W[estern] boundary of macro element 2 is a straight</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">  line from the &quot;mouth&quot; to the &quot;mouth&quot; end of the</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">  curved upper boundary of the body:</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">\dontinclude fish_domain.h</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">\skipline start_of_r_upper_body_W</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">\until  end of r_upper_body_W</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">- The S[outhern] boundary of macro element 0 (which represents the</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">  lower body) is simply a reflection of the N[orthern] boundary</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">  of macro element 2:</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">\dontinclude fish_domain.h</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">\skipline  Southern boundary of lower body macro element</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">\until  }</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">- etc.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">Tedious? Yes! Rocket Science? No!</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"> </span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">\section com Further comments</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">\subsection nod_update Node updates in response to changes in the Domain shape.</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">You may have noticed that, even though we introduced</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">\c MacroElements in the context of adaptive mesh refinement, </span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">the pointer to a refineable element&#39;s \c MacroElement is </span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">stored in the \c FiniteElement, rather than the (derived) \c</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">RefineableElement class, suggesting that \c MacroElements</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">have additional uses outside the context of mesh adaptation. </span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">Indeed, the code fragment that illustrated the use of \c Domains </span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">and \c MacroElements during mesh generation, was taken from </span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">the constructor of the \e non-refineable \c FishMesh,</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">rather than its adaptive counterpart. During the mesh generation</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">process, the \c FiniteElement&#39;s \c MacroElement representation </span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">was used to determine the position of its \c Nodes within the \c Domain. </span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">The same procedure can be employed to \e update the nodal positions in </span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">response to changes in the domain shape. This is implemented, generically,</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">in the function</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">Mesh::node_update()</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">This function loops over all elements in a \c Mesh and updates</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">their nodal positions in response to changes in the domain boundary.</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">(If the \c Mesh&#39;s constituent elements&#39;s are not associated with </span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">\c MacroElements and if the \c Mesh does not implement the node update</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">by other means, this function does not change the mesh.)</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">The following code fragment illustrates the trivial modifications</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">to the driver code required to compute the solution of Poisson&#39;s </span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">equation in fish-shaped  domain of various widths. We simply</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">change the position of the \c GeomObject that specifies the</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">curvilinear boundary (by changing the position of the circle&#39;s</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">centre), call the \c Mesh::node_update() function, and recompute</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">the solution.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">\dontinclude fish_poisson_node_update.cc</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">\skipline start_of_main</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">\until end of main</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">The </span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment"> &lt;A HREF=&quot;../../../../demo_drivers/poisson/fish_poisson2/fish_poisson_node_update.cc&quot;&gt;rest</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment"> of the code&lt;/A&gt; remains unchanged. Here is a plot of the solution for </span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">various widths of the domain (computed with nine-node elements).</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">\image html fish_poisson_node_update.gif &quot;Adaptive solution of Poisson&#39;s equation in fish-shaped domains of varying width. &quot; </span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">\image latex fish_poisson_node_update.eps &quot;Adaptive solution of Poisson&#39;s equation in fish-shaped domains of varying width. &quot; width=0.75\textwidth</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">\subsection boundary_coords Good practice: Storing boundary coordinates</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">The above example demonstrated how the representation of curvilinear </span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">domain boundaries by \c GeomObjects</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">allows \c oomph-lib&#39;s mesh generation and adaptation procedures to </span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">place nodes on these boundaries. We note that the </span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">Lagrangian coordinate(s) that parametrise(s) the relevant \c</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">GeomObjects also provide a parametrisation of the</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">corresponding domain boundaries. In certain applications (such as </span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">free-boundary or fluid-structure interaction problems) it is useful</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">to have direct access to these boundary coordinates. For this purpose</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">the \c Node class provides the function</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">Node::set_coordinates_on_boundary(const unsigned&amp; b, </span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">                                  const Vector&lt;double&gt;&amp; xi);</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">which allows the mesh writer to store the (vector of) boundary</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">coordinates that a given (\c Boundary)\c Node is located at. The argument \c b </span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">specifies the number of the mesh boundary, reflecting the fact that nodes may</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">be located on multiple domain boundaries, each of which is likely to have</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">a different set of surface coordinates. [\b Note: The function is</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">implemented as a broken virtual function in the \c Node base class.</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">The actual functionality to store boundary coordinates is only</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">provided in (and required by) the derived \c BoundaryNode class.]</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">Since the storage of boundary coordinates is optional, </span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">the \c Mesh base class provides a protected vector of bools,</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">\code</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">std::vector&lt;bool&gt; Mesh::Boundary_coordinate_exists;</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">\endcode</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">that indicates if the boundary coordinates have been stored for</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">all \c Nodes on a specific mesh boundary. This vector</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">is resized and its entries are initialised to \c false, when</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">the number of mesh boundaries is declared with a call</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">to \c Mesh::set_nboundary(...). If, during mesh refinement, </span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">a new  \c BoundaryNode is created on the mesh&#39;s boundary \c b, </span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">its boundary coordinates are computed by interpolation from the</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">corresponding values at the nodes in the father element, if </span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">\c Mesh::Boundary_coordinate_exists[b] has been set to \c true.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">We regard it as good practice to set boundary coordinates for</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">all \c BoundaryNodes that are located on curvlinear mesh boundaries. </span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">The source code</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../src/meshes/fish_mesh.template.cc&quot;&gt;fish_mesh.template.cc&lt;/A&gt;</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">for the refineable FishMesh illustrates the methodology.</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">&lt;HR&gt;</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">\section sources Source files for this tutorial</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">- The source files for this tutorial are located in the directory:</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/poisson/fish_poisson2/&quot;&gt;</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">demo_drivers/poisson/fish_poisson2/</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">- The driver code is:</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">&lt;CENTER&gt;</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">&lt;A HREF=&quot;../../../../demo_drivers/poisson/fish_poisson2/fish_poisson_adapt.cc&quot;&gt;</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">demo_drivers/poisson/fish_poisson2/fish_poisson_adapt.cc</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">&lt;/A&gt;</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">&lt;/CENTER&gt;</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">&lt;hr&gt;</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">\section pdf PDF file</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">A &lt;a href=&quot;../latex/refman.pdf&quot;&gt;pdf version&lt;/a&gt; of this document is available.</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">**/</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassUnitCircle_html"><div class="ttname"><a href="classUnitCircle.html">UnitCircle</a></div><div class="ttdef"><b>Definition:</b> <a href="fish__domain_8cc_source.html#l00043">fish_domain.cc:43</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a58e51ab235154a1195588ccaa1f44dd1"><div class="ttname"><a href="fish__poisson2_8txt.html#a58e51ab235154a1195588ccaa1f44dd1">Next</a></div><div class="ttdeci">endcode Next</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00279">fish_poisson2.txt:279</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a99e2aa635b080dbb0c8093c7ab7584d0"><div class="ttname"><a href="fish__poisson2_8txt.html#a99e2aa635b080dbb0c8093c7ab7584d0">geometry</a></div><div class="ttdeci">endcode To see how this works let us have a look at the c FishDomain constructor The constructor stores the pointer to the fish s and the start and end values of the Lagrangian coordinates in the private data members c c Xi_nose and c Xi_tail Next we set some additional that define the geometry(the mouth is located at the origin;the fin is a vertical line at \f$ x=1.7\f$, ranging from \f$ y=-0.9\f$ to \f$ y=+0.9\f$). Finally</div></div>
<div class="ttc" id="afish__poisson2_8txt_html_ad787fe505e26650164ed6dc4986df653"><div class="ttname"><a href="fish__poisson2_8txt.html#ad787fe505e26650164ed6dc4986df653">MacroElement</a></div><div class="ttdeci">within this c MacroElement</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00107">fish_poisson2.txt:107</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a9127800e9d85ec4f62139d98b22f7bdb"><div class="ttname"><a href="fish__poisson2_8txt.html#a9127800e9d85ec4f62139d98b22f7bdb">parameters</a></div><div class="ttdeci">endcode To see how this works let us have a look at the c FishDomain constructor The constructor stores the pointer to the fish s and the start and end values of the Lagrangian coordinates in the private data members c c Xi_nose and c Xi_tail Next we set some additional parameters</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00297">fish_poisson2.txt:297</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a4074baada03976c061d5672f4237cca5"><div class="ttname"><a href="fish__poisson2_8txt.html#a4074baada03976c061d5672f4237cca5">problem</a></div><div class="ttdeci">mainpage Demo problem</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00012">fish_poisson2.txt:12</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a7ac19cf035a3f378028c7167eb0ec0bf"><div class="ttname"><a href="fish__poisson2_8txt.html#a7ac19cf035a3f378028c7167eb0ec0bf">b</a></div><div class="ttdeci">endcode that indicates if the boundary coordinates have been stored for all c Nodes on a specific mesh boundary This vector is resized and its entries are initialised to c when the number of mesh boundaries is declared with a call to c during mesh a new c BoundaryNode is created on the mesh s boundary c b</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00507">fish_poisson2.txt:507</a></div></div>
<div class="ttc" id="anamespacef_html"><div class="ttname"><a href="namespacef.html">f</a></div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00317">fish_poisson2.txt:317</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_adc8dfcb80486292f301bea1d18a8f58e"><div class="ttname"><a href="fish__poisson2_8txt.html#adc8dfcb80486292f301bea1d18a8f58e">D_</a></div><div class="ttdeci">see the&lt; A HREF=&quot;../../../../doc/poisson/two_d_poisson_flux_bc/html/index.html&quot;&gt; earlier example&lt;/A &gt; for a discussion of virtual broken functions Here is a complete example of a specific c the fish s body in f D_</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00250">fish_poisson2.txt:250</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a53d54d0ed5ad7eb738a9ec1d1ee6230a"><div class="ttname"><a href="fish__poisson2_8txt.html#a53d54d0ed5ad7eb738a9ec1d1ee6230a">sketch</a></div><div class="ttdeci">see the&lt; A HREF=&quot;../../../../doc/poisson/two_d_poisson_flux_bc/html/index.html&quot;&gt; earlier example&lt;/A &gt; for a discussion of virtual broken functions Here is a complete example of a specific c the fish s body in f as shown in this sketch</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00265">fish_poisson2.txt:265</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a726d8b64175aea9f546e00402ad8110f"><div class="ttname"><a href="fish__poisson2_8txt.html#a726d8b64175aea9f546e00402ad8110f">refinement</a></div><div class="ttdeci">endcode that indicates if the boundary coordinates have been stored for all c Nodes on a specific mesh boundary This vector is resized and its entries are initialised to c when the number of mesh boundaries is declared with a call to c during mesh refinement</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00506">fish_poisson2.txt:506</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a17d0392f435f19774bad77a5798f61fe"><div class="ttname"><a href="fish__poisson2_8txt.html#a17d0392f435f19774bad77a5798f61fe">systems</a></div><div class="ttdeci">etc To illustrate the use of c MacroElements c the following code non refineable c FishMesh assigns the nodal positions Each of the c FishDomain s four c QMacroElements is associated with one of the four finite elements in the mesh Since both types of elements are parametrised by the same coordinate systems</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00120">fish_poisson2.txt:120</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a36182deccc274d25f67a270c999c54c3"><div class="ttname"><a href="fish__poisson2_8txt.html#a36182deccc274d25f67a270c999c54c3">Domain</a></div><div class="ttdeci">endcode To see how this works let us have a look at the c FishDomain constructor The constructor stores the pointer to the fish s and the start and end values of the Lagrangian coordinates in the private data members c c Xi_nose and c Xi_tail Next we set some additional that define the we allocate storage for the four c MacroElements and build them Note that the constructor of the c MacroElement takes a pointer to the Domain</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00302">fish_poisson2.txt:302</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a20a441512b1c378bcc3e5484b08c91a1"><div class="ttname"><a href="fish__poisson2_8txt.html#a20a441512b1c378bcc3e5484b08c91a1">HREF</a></div><div class="ttdeci">&quot;../../../../demo_drivers/poisson/fish_poisson2/fish_poisson_adapt.cc&quot;&gt; fish_poisson_adapt.cc&lt;/A &gt; -- a simple modification of the code&lt; A HREF=&quot;../../../../demo_drivers/poisson/fish_poisson/fish_poisson.cc&quot;&gt; fish_poisson.cc&lt;/A &gt; that we used in the&lt; A HREF=&quot;../../../../doc/poisson/fish_poisson/html/index.html&quot;&gt; earlier example&lt;/A &gt;. The only difference between the two codes is that in the present example, the \c FishDomain is discretised with four-node rather than nine-node \c RefineableQPoissonElements to highlight the inadequacy of the basic mesh refinement process. Note that, as a result of lower accuracy of the four-node elements, we require a much finer discretisation in the interior of the domain.&lt; HR &gt; \section domain Part 2:How to represent domains with curvilinear boundaries by Domain and MacroElement objects The above example demonstrated that &quot;upgrading&quot; existing meshes to \c RefineableMeshes that can be used with \c oomph-lib 's mesh adaptation procedures, can be achieved in two trivial steps:-# Associate each \c RefineableQElement with a \c QuadTree -- this can done completely automatically by calling the function \c RefineableQuadMesh::setup_quadtree_forest(). -# If the problem 's domain has curvilinear boundaries, associate each \c RefineableQElement with a \c MacroElement -- defined in the \c Domain object that provides an analytical representation of the domain. . While this looks(and indeed is) impressively simple, we still have to explain how to create \c Domain objects. We start by introducing yet another useful \c oomph-lib class, the \c GeomObject. \subsection geom_object The geometric object, GeomObject As the name suggests, \c GeomObjects are \c oomph-lib objects that provide an analytical description/parametrisation of geometric objects. Mathematically, \c GeomObjects define a mapping from a set of &quot;Lagrangian&quot;(intrinsic) coordinates to the global &quot;Eulerian&quot; coordinates of the object. The number of Lagrangian and Eulerian coordinates can differ. For instance, the unit circle, centred at the origin may be parametrised by a single coordinate, \f$ \xi \f$(representing the polar angle), as \f[{\bf r}_{circle}=\left(\begin{array}{c} \cos \xi \\ \sin \xi \end{array} \right), \f] while a 2D disk may be parametrised by two coordinates \f$ \xi_1 \f$ and \f$ \xi_2 \f$(representing the radius and the polar angle, respectively) as \f[{\bf r}_{disk}=\xi_1 \left(\begin{array}{c} \cos \xi_2 \\ \sin \xi_2 \end{array} \right). \f] All specific \c GeomObjects must implement the pure virtual function \c GeomObject::position(...) which computes the Eulerian position vector \f$ {\bf r}\f$ as a function of the(vector of) Lagrangian coordinates \f$ {\bf \xi}\f$.(The \c GeomObject base class also provides interfaces for a multitude of other functions, such as functions that compute the spatial and temporal derivatives of the position vector. These functions are implemented as &quot;broken&quot; virtual functions and their implementation is optional HREF</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00231">fish_poisson2.txt:231</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a4f499ba251dff6813d20832f9f36834a"><div class="ttname"><a href="fish__poisson2_8txt.html#a4f499ba251dff6813d20832f9f36834a">r_back</a></div><div class="ttdeci">double r_back</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00274">fish_poisson2.txt:274</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_aabaa549287079204cdb454cac455c10c"><div class="ttname"><a href="fish__poisson2_8txt.html#aabaa549287079204cdb454cac455c10c">optional</a></div><div class="ttdeci">zeta f to the c MacroElement s boundary Here f zeta in[-1, 1] f is the coordinate along the element aligned with the direction of the c MacroElement s coordinates f(s_0, s_1) \f$ as indicated in this sketch if c t it computes the shape at the c t th previous timestep(&lt; A HREF=&quot;../../../unsteady_heat/two_d_unsteady_heat_ALE/html/index.html&quot;&gt; Another example&lt;/A &gt; in which we solve the unsteady heat equation in a moving domain, provides a a more detailed discussion of this aspect.) Here is the full interface for the \c FishDomain The implementation of this function is the only tedious task that needs to be performed by the mesh writer Once c the c Domain s constituent c MacroElements can refer to this function to establish the positions of their boundaries(recall that we passed the pointer to the \c Domain and the \c MacroElement 's number in the \c Domain to the \c MacroElement constructor). The \c MacroElement endcode which allows the mesh writer to store reflecting the fact that nodes may be located on multiple domain each of which is likely to have a different set of surface coordinates[\b Note:The function isimplemented as a broken virtual function in the \c Node base class.The actual functionality to store boundary coordinates is onlyprovided in(and required by) the derived \c BoundaryNode class.] Since the storage of boundary coordinates is optional</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00497">fish_poisson2.txt:497</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a89fdd2b4b3c4b954a1fc0a6fe79d2896"><div class="ttname"><a href="fish__poisson2_8txt.html#a89fdd2b4b3c4b954a1fc0a6fe79d2896">NULL</a></div><div class="ttdeci">etc To illustrate the use of c MacroElements c the following code non refineable c FishMesh assigns the nodal positions Each of the c FishDomain s four c QMacroElements is associated with one of the four finite elements in the mesh Since both types of elements are parametrised by the same coordinate we determine the position of the node that is located at each c FiniteElement provides storage for a pointer to an associated c MacroElement By the c MacroElement pointer is set to c NULL</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00135">fish_poisson2.txt:135</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a04763e696f9abee872a515865c843251"><div class="ttname"><a href="fish__poisson2_8txt.html#a04763e696f9abee872a515865c843251">i</a></div><div class="ttdeci">1}^2 \frac{\partial^2u}{\partial x_i^2}=-1, \ \ \ \ \ \ \ \ \ \ @E[2DPoisson]@ \f] in the fish-shaped domain \f $D_{fish} \f$ with homogeneous Dirichlet boundary conditions \f[\left. u\right|_{\partial D_{fish}}=0. \ \ \ \ \ \ \ \ \ \ @E[2DPoisson_BC]@ \f]&lt;/TD &gt;&lt;/TR &gt;&lt;/TABLE &gt;&lt;/CENTER &gt; In Part 1 of this document we shall explain how \c oomph-lib 's mesh adaptation procedures employ the \c Domain and \c MacroElement objects to adapt meshes in domains with curvilinear boundaries. In Part 2, we demonstrate how to create new \c Domain objects.&lt; HR &gt; \section adapt Part 1:Mesh adaptation in domains with curvilinear boundaries, using Domain and MacroElement objects The plot below shows the domain \f $D_{fish} \f$, represented by the multi-coloured, shaded region and its(extremely coarse) discretisation with four four-node quad elements. The elements' edges and nodes are shown in black. @I w 0.75\textwidth coarse_fish_mesh_and_domain &quot;The fish-shaped domain and its discretisation with four four-node quad elements &quot; Obviously, the curvilinear boundaries of the fish-shaped domain(arcs of circles) are very poorly resolved by the elements' straight edges. Simple mesh adaptation, based on the techniques described in the&lt; A HREF=&quot;../../../../doc/poisson/two_d_poisson_adapt/html/index.html&quot;&gt; earlier example&lt;/A &gt; will not result in convergence to the exact solution since the refined mesh never approaches the exact domain geometry:@I w 0.75\textwidth fish_poisson_soln_no_macro &quot;Plot of the mesh adaptation without MacroElements &quot; To overcome this problem, the mesh adaptation routines must be given access to an exact, analytical representation of the actual domain. This is the purpose of \c oomph-lib 's \c Domain object. A \c Domain provides an analytical description of a mathematical domain, by decomposing it into a number of so-called \c MacroElements. Each \c MacroElement provides a mapping between a set of local and global coordinates \f$ {\bf r}_{macro}({\bf s})\f$ -- similar to the mapping between the local and global coordinates in a finite element. The key difference between the two types of element is that the \c MacroElement mapping resolves curvilinear domain boundaries exactly, whereas the finite element mapping interpolates the global coordinates between the coordinates of its nodes. The topology of \c MacroElements mirrors that of the associated(geometric) finite elements:For instance, the \c QMacroElement family is the counterpart of the \c QElement family of geometric finite elements. Both are templated by the spatial dimension, and the local coordinates(in their right-handed local coordinate systems) are in the range between -1 and+1. The different-coloured, shaded regions in the above sketch represent the four two-dimensional \c QMacroElements by which the \c FishDomain represents the fish-shaped domain \f$ D_{fish} \f$. For instance, \c MacroElement 0(shown in orange) represents the lower half of the fish 's body i</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00106">fish_poisson2.txt:106</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a3c5b1b2d1878b33b32cd5ad783098f1d"><div class="ttname"><a href="fish__poisson2_8txt.html#a3c5b1b2d1878b33b32cd5ad783098f1d">Domains</a></div><div class="ttdeci">etc To illustrate the use of c MacroElements c Domains</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00112">fish_poisson2.txt:112</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a1dd57e71f0a03a149fc08b4d09197ca0"><div class="ttname"><a href="fish__poisson2_8txt.html#a1dd57e71f0a03a149fc08b4d09197ca0">boundary</a></div><div class="ttdeci">zeta f to the c MacroElement s boundary Here f zeta in[-1, 1] f is the coordinate along the element boundary</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00322">fish_poisson2.txt:322</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_ad51b9368b9f3d83f4952266f9befa933"><div class="ttname"><a href="fish__poisson2_8txt.html#ad51b9368b9f3d83f4952266f9befa933">f</a></div><div class="ttdeci">within this c the curved belly is represented by the line f</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00108">fish_poisson2.txt:108</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_abecec0ffd252d5c008335db6e6a529b4"><div class="ttname"><a href="fish__poisson2_8txt.html#abecec0ffd252d5c008335db6e6a529b4">Back_pt</a></div><div class="ttdeci">endcode To see how this works let us have a look at the c FishDomain constructor The constructor stores the pointer to the fish s and the start and end values of the Lagrangian coordinates in the private data members c Back_pt</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00296">fish_poisson2.txt:296</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a68a3f92caf63697dc8a7fa23dcd50d53"><div class="ttname"><a href="fish__poisson2_8txt.html#a68a3f92caf63697dc8a7fa23dcd50d53">back_pt</a></div><div class="ttdeci">GeomObject * back_pt</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00275">fish_poisson2.txt:275</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a296cf8991ee09d7e9a1beeb8ad3da837"><div class="ttname"><a href="fish__poisson2_8txt.html#a296cf8991ee09d7e9a1beeb8ad3da837">xi</a></div><div class="ttdeci">endcode we pass locating the nose end of the fish s back at f xi</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00281">fish_poisson2.txt:281</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_ac377fb796c46b4781247c0e7c9ac214a"><div class="ttname"><a href="fish__poisson2_8txt.html#ac377fb796c46b4781247c0e7c9ac214a">false</a></div><div class="ttdeci">endcode that indicates if the boundary coordinates have been stored for all c Nodes on a specific mesh boundary This vector is resized and its entries are initialised to c false</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00498">fish_poisson2.txt:498</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a2230505c3c31d1cc0748621135727a72"><div class="ttname"><a href="fish__poisson2_8txt.html#a2230505c3c31d1cc0748621135727a72">the</a></div><div class="ttdeci">endcode we pass the(pointer to the) \c Circle object to the const ructor of the \c FishDomain</div></div>
<div class="ttc" id="afish__poisson2_8txt_html_ad53df09f59155e1a8570e458b6123ca8"><div class="ttname"><a href="fish__poisson2_8txt.html#ad53df09f59155e1a8570e458b6123ca8">boundaries</a></div><div class="ttdeci">etc To illustrate the use of c MacroElements c the following code non refineable c FishMesh assigns the nodal positions Each of the c FishDomain s four c QMacroElements is associated with one of the four finite elements in the mesh Since both types of elements are parametrised by the same coordinate we determine the position of the node that is located at each c FiniteElement provides storage for a pointer to an associated c MacroElement By the c MacroElement pointer is set to c indicating that the element is not associated with a c MacroElement In that the coordinates of newly created nodes are determined by interpolation from the father as discussed above If the c MacroElement pointer is non c the refinement process refers to the element s c MacroElement representation to determine the new nodal positions To enable the mesh adaptation process to respect the domain s curvilinear boundaries</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00143">fish_poisson2.txt:143</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_ac46afde3a6f32c8134c97743ab0222da"><div class="ttname"><a href="fish__poisson2_8txt.html#ac46afde3a6f32c8134c97743ab0222da">constructor</a></div><div class="ttdeci">see the&lt; A HREF=&quot;../../../../doc/poisson/two_d_poisson_flux_bc/html/index.html&quot;&gt; earlier example&lt;/A &gt; for a discussion of virtual broken functions Here is a complete example of a specific c the fish s body in f as shown in this centred at passing the appropriate parameters to its constructor</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00272">fish_poisson2.txt:272</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a2c64ac93016b2a9d654b00373385da79"><div class="ttname"><a href="fish__poisson2_8txt.html#a2c64ac93016b2a9d654b00373385da79">element</a></div><div class="ttdeci">etc To illustrate the use of c MacroElements c the following code non refineable c FishMesh assigns the nodal positions Each of the c FishDomain s four c QMacroElements is associated with one of the four finite elements in the mesh Since both types of elements are parametrised by the same coordinate we determine the position of the node that is located at each c FiniteElement provides storage for a pointer to an associated c MacroElement By the c MacroElement pointer is set to c indicating that the element is not associated with a c MacroElement In that the coordinates of newly created nodes are determined by interpolation from the father element</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00137">fish_poisson2.txt:137</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_ac3e00526534ae96f709b8a3ec072ea4e"><div class="ttname"><a href="fish__poisson2_8txt.html#ac3e00526534ae96f709b8a3ec072ea4e">E</a></div><div class="ttdeci">endcode To see how this works let us have a look at the c FishDomain constructor The constructor stores the pointer to the fish s and the start and end values of the Lagrangian coordinates in the private data members c c Xi_nose and c Xi_tail Next we set some additional that define the we allocate storage for the four c MacroElements and build them Note that the constructor of the c MacroElement takes a pointer to the and the c MacroElement s number within that c etc we will not list these explicitly All the real work is done in the implementation of the virtual pure function c E[ast]</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00316">fish_poisson2.txt:316</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a21f866477909132765bd833a91c16259"><div class="ttname"><a href="fish__poisson2_8txt.html#a21f866477909132765bd833a91c16259">GeomObject</a></div><div class="ttdeci">see the&lt; A HREF=&quot;../../../../doc/poisson/two_d_poisson_flux_bc/html/index.html&quot;&gt; earlier example&lt;/A &gt; for a discussion of virtual broken functions Here is a complete example of a specific c GeomObject</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00249">fish_poisson2.txt:249</a></div></div>
<div class="ttc" id="afish__poisson2_8txt_html_a824e389b6c88d0ae12c1e97b08712cd3"><div class="ttname"><a href="fish__poisson2_8txt.html#a824e389b6c88d0ae12c1e97b08712cd3">y_c</a></div><div class="ttdeci">double y_c</div><div class="ttdef"><b>Definition:</b> <a href="fish__poisson2_8txt_source.html#l00273">fish_poisson2.txt:273</a></div></div>

    <!-- jQuery for Bootstrap and Doxygen -->
    <script src="../../../js/jquery-1.12.0.min.js"></script>
    <!-- Minified boostrap plugins-->
    <script src="../../../js/bootstrap.js"></script>
    <!-- Doxygen dependency to add powertips to source code-->
    <script src="../../../js/jquery.powertip.min.js"></script>
    <!-- The  following script is generated by doxygen and hides/shows levels in 
         the data structure lists and adds powertips to source code-->
    <script src="../../../js/dynsections.js" ></script>
    <!-- add to Doxygen's class names so bootstrap css and js recognises them-->
    <script type="text/javascript">
    $(".contents").addClass("container");
    $(".header").addClass("container");
    $(".navpath").addClass("container");
    $("#navrow3").addClass("container");
    $("#navrow4").addClass("container");
    $(".mlabel").addClass("label");
    $(".mlabel").addClass("label-default");
    $(".memitem").addClass("panel");
    $(".memitem").addClass("panel-info");
    $(".memproto").addClass("panel-heading");
    $(".memdoc").addClass("panel-body");
    </script>
    <footer>
      <div class="container">
        <div class="text-muted" style="float:right;">Generated by <a href="http://www.doxygen.org/index.html">
          <img style="height:18px;" class="footer-img" src="doxygen.png" alt="doxygen"></a> on Wed Aug 25 2021 19:55:38
        </div>
      </div>
    </footer>
</body>
</html>
