--- # ------------------------------------------------------------------------------

name: cache-mumps
on:
  workflow_call:
    inputs:
      mumps-version:
        required: true
        type: string

# ------------------------------------------------------------------------------

jobs:
  cache-mumps:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare tarball directory
        run: mkdir -p external_distributions/tarballs

      - name: Restore cached MUMPS tarball
        id: mumps-cache
        uses: actions/cache/restore@v4
        with:
          path: external_distributions/tarballs
          key: mumps-${{ inputs.mumps-version }}

      - name: Download MUMPS tarball if missing
        if: steps.mumps-cache.outputs.cache-hit != 'true'
        run: |
          set -e
          FILE="MUMPS_${{ inputs.mumps-version }}.tar.gz"
          DEST="external_distributions/tarballs/${FILE}"
          URL="https://mumps-solver.org/${FILE}"

          echo "Cache miss, downloading $URL to $DEST"
          curl --fail --location --retry 5 --retry-delay 5 -o "$DEST" "$URL"

      - name: Save MUMPS tarball cache
        if: steps.mumps-cache.outputs.cache-hit != 'true'
        uses: actions/cache/save@v4
        with:
          path: external_distributions/tarballs
          key: ${{ steps.mumps-cache.outputs.cache-primary-key }}
# ------------------------------------------------------------------------------
